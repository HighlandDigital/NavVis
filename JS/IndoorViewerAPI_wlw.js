/**
 * Dynamically load a file
 */
var loadFile = function(filename, filetype, callback)
{
	var file = undefined;

	if (filetype == 'js') // JavaScript file
	{
		file = document.createElement('script');
		file.setAttribute('type', 'text/javascript');
		file.setAttribute('src',  filename);
	}
	else if (filetype == 'css') // CSS file
	{
		file = document.createElement('link');
		file.setAttribute('rel',  'stylesheet');
		file.setAttribute('type', 'text/css');
		file.setAttribute('href', filename);
	}

	if (file !== undefined)
	{
		document.getElementsByTagName('head')[0].appendChild(file);
		if (callback)
		{
			file.onreadystatechange = file.onload = callback;
		}
	}
}

/**
 * Load the IV styles and set up a global ckeditor basepath
 */
var loadIndoorViewer = function()
{
	var api_filename_actual     = 'IndoorViewerAPI.js';
	var api_filename_deprecated = 'scripts/IndoorViewer.all.min.js';
	
	// Get a script element which requested an API file
	var script_el_actual = document.querySelector('script[src$="' + api_filename_actual + '"]');
	var script_el_deprecated = document.querySelector('script[src$="' + api_filename_deprecated + '"]');
	if (!script_el_actual && !script_el_deprecated)
	{
		return;
	}

	// Check how an API was requested (using an actual or deprecated file)
	var script_el = script_el_actual || script_el_deprecated;
	var api_filename = script_el_actual ? api_filename_actual : api_filename_deprecated;

	// Gather a base URL
	var src = script_el.getAttribute('src');
	var base_url = src.substring(0, src.indexOf(api_filename));
	
	// Set a global base path used by ckeditor
	// http://docs.ckeditor.com/#!/api/CKEDITOR-property-basePath
	CKEDITOR_BASEPATH = base_url;
	
	loadFile(base_url + 'styles/vendor-69b781a84c.css', 'css', function() // load vendor as a first one
	{
		loadFile(base_url + 'styles/app-29dd68bb53.css', 'css', forceScenesResize);

		// Force resize of the scenes after CSS styles were applied
		function forceScenesResize()
		{
			if (IV.injector)
			{
				var mainView = IV.injector.get('IV').getMainView();
				if (mainView)
				{
					mainView.forceResize();
				}

				var mapView = IV.injector.get('IV').getMapView();
				if (mapView)
				{
					mapView.forceResize();
				}
			}
		}
	});
}
loadIndoorViewer();

/**
 * Vendor & App 
 */
function XMLWriter(e,t){e&&(this.encoding=e),t&&(this.version=t)}function earcut(e,t,i){i=i||2;var n=t&&t.length,r=n?t[0]*i:e.length,o=linkedList(e,0,r,i,!0),s=[];if(!o)return s;var a,l,u,c,h,d,p;if(n&&(o=eliminateHoles(e,t,o,i)),e.length>80*i){a=u=e[0],l=c=e[1];for(var f=i;f<r;f+=i)h=e[f],d=e[f+1],h<a&&(a=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-a,c-l)}return earcutLinked(o,s,i,a,l,p),s}function linkedList(e,t,i,n,r){var o,s;if(r===signedArea(e,t,i,n)>0)for(o=t;o<i;o+=n)s=insertNode(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=insertNode(o,e[o],e[o+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(e,t){if(!e)return e;t||(t=e);var i,n=e;do if(i=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),n=t=n.prev,n===n.next)return null;i=!0}while(i||n!==t);return t}function earcutLinked(e,t,i,n,r,o,s){if(e){!s&&o&&indexCurve(e,n,r,o);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?isEarHashed(e,n,r,o):isEar(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),removeNode(e),e=l.next,u=l.next;else if(e=l,e===u){s?1===s?(e=cureLocalIntersections(e,t,i),earcutLinked(e,t,i,n,r,o,2)):2===s&&splitEarcut(e,t,i,n,r,o):earcutLinked(filterPoints(e),t,i,n,r,o,1);break}}}function isEar(e){var t=e.prev,i=e,n=e.next;if(area(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(e,t,i,n){var r=e.prev,o=e,s=e.next;if(area(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,u=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,c=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=zOrder(a,l,t,i,n),d=zOrder(u,c,t,i,n),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!equals(r,o)&&intersects(r,n,n.next,o)&&locallyInside(r,o)&&locallyInside(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),removeNode(n),removeNode(n.next),n=e=o),n=n.next}while(n!==e);return n}function splitEarcut(e,t,i,n,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&isValidDiagonal(s,a)){var l=splitPolygon(s,a);return s=filterPoints(s,s.next),l=filterPoints(l,l.next),earcutLinked(s,t,i,n,r,o),void earcutLinked(l,t,i,n,r,o)}a=a.next}s=s.next}while(s!==e)}function eliminateHoles(e,t,i,n){var r,o,s,a,l,u=[];for(r=0,o=t.length;r<o;r++)s=t[r]*n,a=r<o-1?t[r+1]*n:e.length,l=linkedList(e,s,a,n,!1),l===l.next&&(l.steiner=!0),u.push(getLeftmost(l));for(u.sort(compareX),r=0;r<u.length;r++)eliminateHole(u[r],i),i=filterPoints(i,i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var i=splitPolygon(t,e);filterPoints(i,i.next)}}function findHoleBridge(e,t){var i,n=t,r=e.x,o=e.y,s=-(1/0);do{if(o<=n.y&&o>=n.next.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s){if(s=a,a===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===s)return i.prev;var l,u=i,c=i.x,h=i.y,d=1/0;for(n=i.next;n!==u;)r>=n.x&&n.x>=c&&pointInTriangle(o<h?r:s,o,c,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),(l<d||l===d&&n.x>i.x)&&locallyInside(n,e)&&(i=n,d=l)),n=n.next;return i}function indexCurve(e,t,i,n){var r=e;do null===r.z&&(r.z=zOrder(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(e){var t,i,n,r,o,s,a,l,u=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;t<u&&(a++,n=n.nextZ,n);t++);for(l=u;a>0||l>0&&n;)0===a?(r=n,n=n.nextZ,l--):0!==l&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--):(r=i,i=i.nextZ,a--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(s>1);return e}function zOrder(e,t,i,n,r){return e=32767*(e-i)/r,t=32767*(t-n)/r,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function getLeftmost(e){var t=e,i=e;do t.x<i.x&&(i=t),t=t.next;while(t!==e);return i}function pointInTriangle(e,t,i,n,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,n){return!!(equals(e,t)&&equals(i,n)||equals(e,n)&&equals(i,t))||area(e,t,i)>0!=area(e,t,n)>0&&area(i,n,e)>0!=area(i,n,t)>0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}function splitPolygon(e,t){var i=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function insertNode(e,t,i,n){var r=new Node(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,n){for(var r=0,o=t,s=i-n;o<i;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}function Potree(){}function LRUItem(e){this.previous=null,this.next=null,this.node=e}function LRU(){this.first=null,this.last=null,this.items={},this.elements=0,this.numPoints=0}function getMousePointCloudIntersection(e,t,i,n){var r=new THREE.Vector3(e.x,e.y,.5);r.unproject(t);for(var o=r.sub(t.position).normalize(),s=new THREE.Ray(t.position,o),a=null,l=null,u=0;u<n.length;u++){var c=n[u],h=c.pick(i,t,s);if(h){var d=t.position.distanceTo(h.position);(!a||d<l)&&(a=h,l=d)}}return a?a.position:null}function pixelsArrayToImage(e,t,i){var n=document.createElement("canvas");n.width=t,n.height=i;var r=n.getContext("2d");e=new e.constructor(e);for(var o=0;o<e.length;o++)e[4*o+3]=255;var s=r.createImageData(t,i);s.data.set(e),r.putImageData(s,0,0);var a=new Image;return a.src=n.toDataURL(),a.style.transform="scaleY(-1)",a}function projectedRadius(e,t,i,n){var r=1/Math.tan(t/2)/i;return r=r*n/2,e*r}function BinaryHeap(e){this.content=[],this.scoreFunction=e}String.prototype.startsWith||!function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,i=t(e,e,e)&&t}catch(n){}return i}(),t={}.toString,i=function(e){if(null==this)throw TypeError();var i=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=i.length,r=String(e),o=r.length,s=arguments.length>1?arguments[1]:void 0,a=s?Number(s):0;a!=a&&(a=0);var l=Math.min(Math.max(a,0),n);if(o+l>n)return!1;for(var u=-1;++u<o;)if(i.charCodeAt(l+u)!=r.charCodeAt(u))return!1;return!0};e?e(String.prototype,"startsWith",{value:i,configurable:!0,writable:!0}):String.prototype.startsWith=i}(),function(e,t){function i(e){var t=e.length,i=le.type(e);return!le.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===i||"function"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function n(e){var t=Oe[e]={};return le.each(e.match(ce)||[],function(e,i){t[i]=!0}),t}function r(e,i,n,r){if(le.acceptData(e)){var o,s,a=le.expando,l="string"==typeof i,u=e.nodeType,c=u?le.cache:e,h=u?e[a]:e[a]&&a;if(h&&c[h]&&(r||c[h].data)||!l||n!==t)return h||(u?e[a]=h=Q.pop()||le.guid++:h=a),c[h]||(c[h]={},u||(c[h].toJSON=le.noop)),"object"!=typeof i&&"function"!=typeof i||(r?c[h]=le.extend(c[h],i):c[h].data=le.extend(c[h].data,i)),o=c[h],r||(o.data||(o.data={}),o=o.data),n!==t&&(o[le.camelCase(i)]=n),l?(s=o[i],null==s&&(s=o[le.camelCase(i)])):s=o,s}}function o(e,t,i){if(le.acceptData(e)){var n,r,o,s=e.nodeType,l=s?le.cache:e,u=s?e[le.expando]:le.expando;if(l[u]){if(t&&(o=i?l[u]:l[u].data)){le.isArray(t)?t=t.concat(le.map(t,le.camelCase)):t in o?t=[t]:(t=le.camelCase(t),t=t in o?[t]:t.split(" "));for(n=0,r=t.length;n<r;n++)delete o[t[n]];if(!(i?a:le.isEmptyObject)(o))return}(i||(delete l[u].data,a(l[u])))&&(s?le.cleanData([e],!0):le.support.deleteExpando||l!=l.window?delete l[u]:l[u]=null)}}}function s(e,i,n){if(n===t&&1===e.nodeType){var r="data-"+i.replace(we,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:xe.test(n)?le.parseJSON(n):n)}catch(o){}le.data(e,i,n)}else n=t}return n}function a(e){var t;for(t in e)if(("data"!==t||!le.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function u(){return!1}function c(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function h(e,t,i){if(t=t||0,le.isFunction(t))return le.grep(e,function(e,n){var r=!!t.call(e,n,e);return r===i});if(t.nodeType)return le.grep(e,function(e){return e===t===i});if("string"==typeof t){var n=le.grep(e,function(e){return 1===e.nodeType});if(Ve.test(t))return le.filter(t,n,!i);t=le.filter(t,n)}return le.grep(e,function(e){return le.inArray(e,t)>=0===i})}function d(e){var t=We.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}function p(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function f(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function m(e){var t=rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var i,n=0;null!=(i=e[n]);n++)le._data(i,"globalEval",!t||le._data(t[n],"globalEval"))}function y(e,t){if(1===t.nodeType&&le.hasData(e)){var i,n,r,o=le._data(e),s=le._data(t,o),a=o.events;if(a){delete s.handle,s.events={};for(i in a)for(n=0,r=a[i].length;n<r;n++)le.event.add(t,i,a[i][n])}s.data&&(s.data=le.extend({},s.data))}}function v(e,t){var i,n,r;if(1===t.nodeType){if(i=t.nodeName.toLowerCase(),!le.support.noCloneEvent&&t[le.expando]){r=le._data(t);for(n in r.events)le.removeEvent(t,n,r.handle);t.removeAttribute(le.expando)}"script"===i&&t.text!==e.text?(f(t).text=e.text,m(t)):"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),le.support.html5Clone&&e.innerHTML&&!le.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&tt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.defaultSelected=t.selected=e.defaultSelected:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}}function E(e,i){var n,r,o=0,s=typeof e.getElementsByTagName!==j?e.getElementsByTagName(i||"*"):typeof e.querySelectorAll!==j?e.querySelectorAll(i||"*"):t;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[o]);o++)!i||le.nodeName(r,i)?s.push(r):le.merge(s,E(r,i));return i===t||i&&le.nodeName(e,i)?le.merge([e],s):s}function T(e){tt.test(e.type)&&(e.defaultChecked=e.checked)}function b(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=xt.length;r--;)if(t=xt[r]+i,t in e)return t;return n}function C(e,t){return e=t||e,"none"===le.css(e,"display")||!le.contains(e.ownerDocument,e)}function O(e,t){for(var i,n,r,o=[],s=0,a=e.length;s<a;s++)n=e[s],n.style&&(o[s]=le._data(n,"olddisplay"),i=n.style.display,t?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&C(n)&&(o[s]=le._data(n,"olddisplay",L(n.nodeName)))):o[s]||(r=C(n),(i&&"none"!==i||!r)&&le._data(n,"olddisplay",r?i:le.css(n,"display"))));for(s=0;s<a;s++)n=e[s],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[s]||"":"none"));return e}function x(e,t,i){var n=yt.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function w(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,s=0;o<4;o+=2)"margin"===i&&(s+=le.css(e,i+Ot[o],!0,r)),n?("content"===i&&(s-=le.css(e,"padding"+Ot[o],!0,r)),"margin"!==i&&(s-=le.css(e,"border"+Ot[o]+"Width",!0,r))):(s+=le.css(e,"padding"+Ot[o],!0,r),"padding"!==i&&(s+=le.css(e,"border"+Ot[o]+"Width",!0,r)));return s}function R(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=ct(e),s=le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,o);if(r<=0||null==r){if(r=ht(e,t,o),(r<0||null==r)&&(r=e.style[t]),vt.test(r))return r;n=s&&(le.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+w(e,t,i||(s?"border":"content"),n,o)+"px"}function L(e){var t=X,i=Tt[e];return i||(i=S(e,t),"none"!==i&&i||(ut=(ut||le("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(ut[0].contentWindow||ut[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),i=S(e,t),ut.detach()),Tt[e]=i),i}function S(e,t){var i=le(t.createElement(e)).appendTo(t.body),n=le.css(i[0],"display");return i.remove(),n}function _(e,t,i,n){var r;if(le.isArray(t))le.each(t,function(t,r){i||Rt.test(e)?n(e,r):_(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==le.type(t))n(e,t);else for(r in t)_(e+"["+r+"]",t[r],i,n)}function I(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(ce)||[];if(le.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function D(e,t,i,n){function r(a){var l;return o[a]=!0,le.each(e[a]||[],function(e,a){var u=a(t,i,n);return"string"!=typeof u||s||o[u]?s?!(l=u):void 0:(t.dataTypes.unshift(u),r(u),!1)}),l}var o={},s=e===Vt;return r(t.dataTypes[0])||!o["*"]&&r("*")}function M(e,i){var n,r,o=le.ajaxSettings.flatOptions||{};for(r in i)i[r]!==t&&((o[r]?e:n||(n={}))[r]=i[r]);return n&&le.extend(!0,e,n),e}function A(e,i,n){var r,o,s,a,l=e.contents,u=e.dataTypes,c=e.responseFields;for(a in c)a in n&&(i[c[a]]=n[a]);for(;"*"===u[0];)u.shift(),o===t&&(o=e.mimeType||i.getResponseHeader("Content-Type"));if(o)for(a in l)if(l[a]&&l[a].test(o)){u.unshift(a);break}if(u[0]in n)s=u[0];else{for(a in n){if(!u[0]||e.converters[a+" "+u[0]]){s=a;break}r||(r=a)}s=s||r}if(s)return s!==u[0]&&u.unshift(s),n[s]}function N(e,t){var i,n,r,o,s={},a=0,l=e.dataTypes.slice(),u=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(r in e.converters)s[r.toLowerCase()]=e.converters[r];for(;n=l[++a];)if("*"!==n){if("*"!==u&&u!==n){if(r=s[u+" "+n]||s["* "+n],!r)for(i in s)if(o=i.split(" "),o[1]===n&&(r=s[u+" "+o[0]]||s["* "+o[0]])){r===!0?r=s[i]:s[i]!==!0&&(n=o[0],l.splice(a--,0,n));break}if(r!==!0)if(r&&e["throws"])t=r(t);else try{t=r(t)}catch(c){return{state:"parsererror",error:r?c:"No conversion from "+u+" to "+n}}}u=n}return{state:"success",data:t}}function P(){try{return new e.XMLHttpRequest}catch(t){}}function k(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function H(){return setTimeout(function(){Jt=t}),Jt=le.now()}function F(e,t){le.each(t,function(t,i){for(var n=(ri[t]||[]).concat(ri["*"]),r=0,o=n.length;r<o;r++)if(n[r].call(e,t,i))return})}function B(e,t,i){var n,r,o=0,s=ni.length,a=le.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Jt||H(),i=Math.max(0,u.startTime+u.duration-t),n=i/u.duration||0,o=1-n,s=0,l=u.tweens.length;s<l;s++)u.tweens[s].run(o);return a.notifyWith(e,[u,o,i]),o<1&&l?i:(a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:le.extend({},t),opts:le.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:Jt||H(),duration:i.duration,tweens:[],createTween:function(t,i){var n=le.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var i=0,n=t?u.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)u.tweens[i].run(1);return t?a.resolveWith(e,[u,t]):a.rejectWith(e,[u,t]),this}}),c=u.props;for(K(c,u.opts.specialEasing);o<s;o++)if(n=ni[o].call(u,e,c,u.opts))return n;return F(u,c),le.isFunction(u.opts.start)&&u.opts.start.call(e,u),le.fx.timer(le.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function K(e,t){var i,n,r,o,s;for(r in e)if(n=le.camelCase(r),o=t[n],i=e[r],le.isArray(i)&&(o=i[1],i=e[r]=i[0]),r!==n&&(e[n]=i,delete e[r]),s=le.cssHooks[n],s&&"expand"in s){i=s.expand(i),delete e[n];for(r in i)r in e||(e[r]=i[r],t[r]=o)}else t[n]=o}function z(e,t,i){var n,r,o,s,a,l,u,c,h,d=this,p=e.style,f={},m=[],g=e.nodeType&&C(e);i.queue||(c=le._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,h=c.empty.fire,c.empty.fire=function(){c.unqueued||h()}),c.unqueued++,d.always(function(){d.always(function(){c.unqueued--,le.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===le.css(e,"display")&&"none"===le.css(e,"float")&&(le.support.inlineBlockNeedsLayout&&"inline"!==L(e.nodeName)?p.zoom=1:p.display="inline-block")),i.overflow&&(p.overflow="hidden",le.support.shrinkWrapBlocks||d.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(r in t)if(s=t[r],ei.exec(s)){if(delete t[r],l=l||"toggle"===s,s===(g?"hide":"show"))continue;m.push(r)}if(o=m.length){a=le._data(e,"fxshow")||le._data(e,"fxshow",{}),"hidden"in a&&(g=a.hidden),l&&(a.hidden=!g),g?le(e).show():d.done(function(){le(e).hide()}),d.done(function(){var t;le._removeData(e,"fxshow");for(t in f)le.style(e,t,f[t])});for(r=0;r<o;r++)n=m[r],u=d.createTween(n,g?a[n]:0),f[n]=a[n]||le.style(e,n),n in a||(a[n]=u.start,g&&(u.end=u.start,u.start="width"===n||"height"===n?1:0))}}function U(e,t,i,n,r){return new U.prototype.init(e,t,i,n,r)}function V(e,t){var i,n={height:e},r=0;for(t=t?1:0;r<4;r+=2-t)i=Ot[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function G(e){return le.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var $,W,j=typeof t,X=e.document,q=e.location,Z=e.jQuery,Y=e.$,J={},Q=[],ee="1.9.1",te=Q.concat,ie=Q.push,ne=Q.slice,re=Q.indexOf,oe=J.toString,se=J.hasOwnProperty,ae=ee.trim,le=function(e,t){return new le.fn.init(e,t,W)},ue=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ce=/\S+/g,he=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,de=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,pe=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^[\],:{}\s]*$/,me=/(?:^|:|,)(?:\s*\[)+/g,ge=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ye=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,ve=/^-ms-/,Ee=/-([\da-z])/gi,Te=function(e,t){return t.toUpperCase()},be=function(e){(X.addEventListener||"load"===e.type||"complete"===X.readyState)&&(Ce(),le.ready())},Ce=function(){X.addEventListener?(X.removeEventListener("DOMContentLoaded",be,!1),e.removeEventListener("load",be,!1)):(X.detachEvent("onreadystatechange",be),e.detachEvent("onload",be))};le.fn=le.prototype={jquery:ee,constructor:le,init:function(e,i,n){var r,o;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:de.exec(e),!r||!r[1]&&i)return!i||i.jquery?(i||n).find(e):this.constructor(i).find(e);if(r[1]){if(i=i instanceof le?i[0]:i,le.merge(this,le.parseHTML(r[1],i&&i.nodeType?i.ownerDocument||i:X,!0)),pe.test(r[1])&&le.isPlainObject(i))for(r in i)le.isFunction(this[r])?this[r](i[r]):this.attr(r,i[r]);return this}if(o=X.getElementById(r[2]),o&&o.parentNode){if(o.id!==r[2])return n.find(e);this.length=1,this[0]=o}return this.context=X,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):le.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),le.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return ne.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=le.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return le.each(this,e,t)},ready:function(e){return le.ready.promise().done(e),this},slice:function(){return this.pushStack(ne.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},map:function(e){return this.pushStack(le.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ie,sort:[].sort,splice:[].splice},le.fn.init.prototype=le.fn,le.extend=le.fn.extend=function(){var e,i,n,r,o,s,a=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},l=2),"object"==typeof a||le.isFunction(a)||(a={}),u===l&&(a=this,--l);l<u;l++)if(null!=(o=arguments[l]))for(r in o)e=a[r],n=o[r],a!==n&&(c&&n&&(le.isPlainObject(n)||(i=le.isArray(n)))?(i?(i=!1,s=e&&le.isArray(e)?e:[]):s=e&&le.isPlainObject(e)?e:{},a[r]=le.extend(c,s,n)):n!==t&&(a[r]=n));return a},le.extend({noConflict:function(t){return e.$===le&&(e.$=Y),t&&e.jQuery===le&&(e.jQuery=Z),le},isReady:!1,readyWait:1,holdReady:function(e){e?le.readyWait++:le.ready(!0)},ready:function(e){if(e===!0?!--le.readyWait:!le.isReady){if(!X.body)return setTimeout(le.ready);le.isReady=!0,e!==!0&&--le.readyWait>0||($.resolveWith(X,[le]),le.fn.trigger&&le(X).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===le.type(e)},isArray:Array.isArray||function(e){return"array"===le.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?J[oe.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==le.type(e)||e.nodeType||le.isWindow(e))return!1;try{if(e.constructor&&!se.call(e,"constructor")&&!se.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}var n;for(n in e);return n===t||se.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||X;var n=pe.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=le.buildFragment([e],t,r),r&&le(r).remove(),le.merge([],n.childNodes))},parseJSON:function(t){return e.JSON&&e.JSON.parse?e.JSON.parse(t):null===t?t:"string"==typeof t&&(t=le.trim(t),t&&fe.test(t.replace(ge,"@").replace(ye,"]").replace(me,"")))?new Function("return "+t)():void le.error("Invalid JSON: "+t)},parseXML:function(i){var n,r;if(!i||"string"!=typeof i)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(i,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(i))}catch(o){n=t}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||le.error("Invalid XML: "+i),n},noop:function(){},globalEval:function(t){t&&le.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(ve,"ms-").replace(Ee,Te)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,s=e.length,a=i(e);if(n){if(a)for(;o<s&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(a)for(;o<s&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:ae&&!ae.call("\ufeff ")?function(e){return null==e?"":ae.call(e)}:function(e){return null==e?"":(e+"").replace(he,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?le.merge(n,"string"==typeof e?[e]:e):ie.call(n,e)),n},inArray:function(e,t,i){var n;if(t){if(re)return re.call(t,e,i);for(n=t.length,i=i?i<0?Math.max(0,n+i):i:0;i<n;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,i){var n=i.length,r=e.length,o=0;if("number"==typeof n)for(;o<n;o++)e[r++]=i[o];else for(;i[o]!==t;)e[r++]=i[o++];return e.length=r,e},grep:function(e,t,i){var n,r=[],o=0,s=e.length;for(i=!!i;o<s;o++)n=!!t(e[o],o),i!==n&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,s=e.length,a=i(e),l=[];if(a)for(;o<s;o++)r=t(e[o],o,n),null!=r&&(l[l.length]=r);else for(o in e)r=t(e[o],o,n),null!=r&&(l[l.length]=r);return te.apply([],l)},guid:1,proxy:function(e,i){var n,r,o;return"string"==typeof i&&(o=e[i],i=e,e=o),le.isFunction(e)?(n=ne.call(arguments,2),r=function(){return e.apply(i||this,n.concat(ne.call(arguments)))},r.guid=e.guid=e.guid||le.guid++,r):t},access:function(e,i,n,r,o,s,a){var l=0,u=e.length,c=null==n;if("object"===le.type(n)){o=!0;for(l in n)le.access(e,i,l,n[l],!0,s,a)}else if(r!==t&&(o=!0,le.isFunction(r)||(a=!0),c&&(a?(i.call(e,r),i=null):(c=i,i=function(e,t,i){return c.call(le(e),i)})),i))for(;l<u;l++)i(e[l],n,a?r:r.call(e[l],l,i(e[l],n)));return o?e:c?i.call(e):u?i(e[0],n):s},now:function(){return(new Date).getTime()}}),le.ready.promise=function(t){if(!$)if($=le.Deferred(),"complete"===X.readyState)setTimeout(le.ready);else if(X.addEventListener)X.addEventListener("DOMContentLoaded",be,!1),e.addEventListener("load",be,!1);else{X.attachEvent("onreadystatechange",be),e.attachEvent("onload",be);var i=!1;try{i=null==e.frameElement&&X.documentElement}catch(n){}i&&i.doScroll&&!function r(){if(!le.isReady){try{i.doScroll("left")}catch(e){return setTimeout(r,50)}Ce(),le.ready()}}()}return $.promise(t)},le.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){J["[object "+t+"]"]=t.toLowerCase()}),W=le(X);var Oe={};le.Callbacks=function(e){e="string"==typeof e?Oe[e]||n(e):le.extend({},e);var i,r,o,s,a,l,u=[],c=!e.once&&[],h=function(t){for(r=e.memory&&t,o=!0,a=l||0,l=0,s=u.length,i=!0;u&&a<s;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}i=!1,u&&(c?c.length&&h(c.shift()):r?u=[]:d.disable())},d={add:function(){if(u){var t=u.length;!function n(t){le.each(t,function(t,i){var r=le.type(i);"function"===r?e.unique&&d.has(i)||u.push(i):i&&i.length&&"string"!==r&&n(i)})}(arguments),i?s=u.length:r&&(l=t,h(r))}return this},remove:function(){return u&&le.each(arguments,function(e,t){for(var n;(n=le.inArray(t,u,n))>-1;)u.splice(n,1),i&&(n<=s&&s--,n<=a&&a--)}),this},has:function(e){return e?le.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=c=r=t,this},disabled:function(){return!u},lock:function(){return c=t,r||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||o&&!c||(i?c.push(t):h(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!o}};return d},le.extend({Deferred:function(e){var t=[["resolve","done",le.Callbacks("once memory"),"resolved"],["reject","fail",le.Callbacks("once memory"),"rejected"],["notify","progress",le.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return le.Deferred(function(i){le.each(t,function(t,o){var s=o[0],a=le.isFunction(e[t])&&e[t];r[o[1]](function(){var e=a&&a.apply(this,arguments);e&&le.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[s+"With"](this===n?i.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?le.extend(e,n):n}},r={};return n.pipe=n.then,le.each(t,function(e,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=ne.call(arguments),s=o.length,a=1!==s||e&&le.isFunction(e.promise)?s:0,l=1===a?e:le.Deferred(),u=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?ne.call(arguments):r,n===t?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(s>1)for(t=new Array(s),i=new Array(s),n=new Array(s);r<s;r++)o[r]&&le.isFunction(o[r].promise)?o[r].promise().done(u(r,n,o)).fail(l.reject).progress(u(r,i,t)):--a;return a||l.resolveWith(n,o),l.promise()}}),le.support=function(){var t,i,n,r,o,s,a,l,u,c,h=X.createElement("div");if(h.setAttribute("className","t"),h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=h.getElementsByTagName("*"),n=h.getElementsByTagName("a")[0],!i||!n||!i.length)return{};o=X.createElement("select"),a=o.appendChild(X.createElement("option")),r=h.getElementsByTagName("input")[0],n.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==h.className,leadingWhitespace:3===h.firstChild.nodeType,tbody:!h.getElementsByTagName("tbody").length,htmlSerialize:!!h.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:!!r.value,optSelected:a.selected,enctype:!!X.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==X.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===X.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,t.noCloneChecked=r.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!a.disabled;try{delete h.test}catch(d){t.deleteExpando=!1}r=X.createElement("input"),r.setAttribute("value",""),t.input=""===r.getAttribute("value"),r.value="t",r.setAttribute("type","radio"),t.radioValue="t"===r.value,r.setAttribute("checked","t"),r.setAttribute("name","t"),s=X.createDocumentFragment(),s.appendChild(r),t.appendChecked=r.checked,t.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,h.attachEvent&&(h.attachEvent("onclick",function(){t.noCloneEvent=!1}),h.cloneNode(!0).click());for(c in{submit:!0,change:!0,focusin:!0})h.setAttribute(l="on"+c,"t"),t[c+"Bubbles"]=l in e||h.attributes[l].expando===!1;return h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===h.style.backgroundClip,le(function(){var i,n,r,o="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",s=X.getElementsByTagName("body")[0];s&&(i=X.createElement("div"),i.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(i).appendChild(h),h.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=h.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",u=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",t.reliableHiddenOffsets=u&&0===r[0].offsetHeight,h.innerHTML="",h.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===h.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(h,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(h,null)||{width:"4px"}).width,n=h.appendChild(X.createElement("div")),n.style.cssText=h.style.cssText=o,n.style.marginRight=n.style.width="0",h.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)),typeof h.style.zoom!==j&&(h.innerHTML="",h.style.cssText=o+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===h.offsetWidth,h.style.display="block",h.innerHTML="<div></div>",h.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==h.offsetWidth,t.inlineBlockNeedsLayout&&(s.style.zoom=1)),s.removeChild(i),i=h=r=n=null)}),i=o=s=a=n=r=null,t}();var xe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,we=/([A-Z])/g;
le.extend({cache:{},expando:"jQuery"+(ee+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?le.cache[e[le.expando]]:e[le.expando],!!e&&!a(e)},data:function(e,t,i){return r(e,t,i)},removeData:function(e,t){return o(e,t)},_data:function(e,t,i){return r(e,t,i,!0)},_removeData:function(e,t){return o(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&le.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),le.fn.extend({data:function(e,i){var n,r,o=this[0],a=0,l=null;if(e===t){if(this.length&&(l=le.data(o),1===o.nodeType&&!le._data(o,"parsedAttrs"))){for(n=o.attributes;a<n.length;a++)r=n[a].name,r.indexOf("data-")||(r=le.camelCase(r.slice(5)),s(o,r,l[r]));le._data(o,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){le.data(this,e)}):le.access(this,function(i){return i===t?o?s(o,e,le.data(o,e)):null:void this.each(function(){le.data(this,e,i)})},null,i,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){le.removeData(this,e)})}}),le.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=le._data(e,t),i&&(!n||le.isArray(i)?n=le._data(e,t,le.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=le.queue(e,t),n=i.length,r=i.shift(),o=le._queueHooks(e,t),s=function(){le.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),o.cur=r,r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return le._data(e,i)||le._data(e,i,{empty:le.Callbacks("once memory").add(function(){le._removeData(e,t+"queue"),le._removeData(e,i)})})}}),le.fn.extend({queue:function(e,i){var n=2;return"string"!=typeof e&&(i=e,e="fx",n--),arguments.length<n?le.queue(this[0],e):i===t?this:this.each(function(){var t=le.queue(this,e,i);le._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&le.dequeue(this,e)})},dequeue:function(e){return this.each(function(){le.dequeue(this,e)})},delay:function(e,t){return e=le.fx?le.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){var n,r=1,o=le.Deferred(),s=this,a=this.length,l=function(){--r||o.resolveWith(s,[s])};for("string"!=typeof e&&(i=e,e=t),e=e||"fx";a--;)n=le._data(s[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(l));return l(),o.promise(i)}});var Re,Le,Se=/[\t\r\n]/g,_e=/\r/g,Ie=/^(?:input|select|textarea|button|object)$/i,De=/^(?:a|area)$/i,Me=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Ae=/^(?:checked|selected)$/i,Ne=le.support.getSetAttribute,Pe=le.support.input;le.fn.extend({attr:function(e,t){return le.access(this,le.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){le.removeAttr(this,e)})},prop:function(e,t){return le.access(this,le.prop,e,t,arguments.length>1)},removeProp:function(e){return e=le.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(i){}})},addClass:function(e){var t,i,n,r,o,s=0,a=this.length,l="string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s<a;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Se," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");i.className=le.trim(n)}return this},removeClass:function(e){var t,i,n,r,o,s=0,a=this.length,l=0===arguments.length||"string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s<a;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Se," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");i.className=e?le.trim(n):""}return this},toggleClass:function(e,t){var i=typeof e,n="boolean"==typeof t;return le.isFunction(e)?this.each(function(i){le(this).toggleClass(e.call(this,i,this.className,t),t)}):this.each(function(){if("string"===i)for(var r,o=0,s=le(this),a=t,l=e.match(ce)||[];r=l[o++];)a=n?a:!s.hasClass(r),s[a?"addClass":"removeClass"](r);else i!==j&&"boolean"!==i||(this.className&&le._data(this,"__className__",this.className),this.className=this.className||e===!1?"":le._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;i<n;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Se," ").indexOf(t)>=0)return!0;return!1},val:function(e){var i,n,r,o=this[0];{if(arguments.length)return r=le.isFunction(e),this.each(function(i){var o,s=le(this);1===this.nodeType&&(o=r?e.call(this,i,s.val()):e,null==o?o="":"number"==typeof o?o+="":le.isArray(o)&&(o=le.map(o,function(e){return null==e?"":e+""})),n=le.valHooks[this.type]||le.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,o,"value")!==t||(this.value=o))});if(o)return n=le.valHooks[o.type]||le.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(i=n.get(o,"value"))!==t?i:(i=o.value,"string"==typeof i?i.replace(_e,""):null==i?"":i)}}}),le.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||r<0,s=o?null:[],a=o?r+1:n.length,l=r<0?a:o?r:0;l<a;l++)if(i=n[l],(i.selected||l===r)&&(le.support.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!le.nodeName(i.parentNode,"optgroup"))){if(t=le(i).val(),o)return t;s.push(t)}return s},set:function(e,t){var i=le.makeArray(t);return le(e).find("option").each(function(){this.selected=le.inArray(le(this).val(),i)>=0}),i.length||(e.selectedIndex=-1),i}}},attr:function(e,i,n){var r,o,s,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return typeof e.getAttribute===j?le.prop(e,i,n):(o=1!==a||!le.isXMLDoc(e),o&&(i=i.toLowerCase(),r=le.attrHooks[i]||(Me.test(i)?Le:Re)),n===t?r&&o&&"get"in r&&null!==(s=r.get(e,i))?s:(typeof e.getAttribute!==j&&(s=e.getAttribute(i)),null==s?t:s):null!==n?r&&o&&"set"in r&&(s=r.set(e,n,i))!==t?s:(e.setAttribute(i,n+""),n):void le.removeAttr(e,i))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(ce);if(o&&1===e.nodeType)for(;i=o[r++];)n=le.propFix[i]||i,Me.test(i)?!Ne&&Ae.test(i)?e[le.camelCase("default-"+i)]=e[n]=!1:e[n]=!1:le.attr(e,i,""),e.removeAttribute(Ne?i:n)},attrHooks:{type:{set:function(e,t){if(!le.support.radioValue&&"radio"===t&&le.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,i,n){var r,o,s,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return s=1!==a||!le.isXMLDoc(e),s&&(i=le.propFix[i]||i,o=le.propHooks[i]),n!==t?o&&"set"in o&&(r=o.set(e,n,i))!==t?r:e[i]=n:o&&"get"in o&&null!==(r=o.get(e,i))?r:e[i]},propHooks:{tabIndex:{get:function(e){var i=e.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):Ie.test(e.nodeName)||De.test(e.nodeName)&&e.href?0:t}}}}),Le={get:function(e,i){var n=le.prop(e,i),r="boolean"==typeof n&&e.getAttribute(i),o="boolean"==typeof n?Pe&&Ne?null!=r:Ae.test(i)?e[le.camelCase("default-"+i)]:!!r:e.getAttributeNode(i);return o&&o.value!==!1?i.toLowerCase():t},set:function(e,t,i){return t===!1?le.removeAttr(e,i):Pe&&Ne||!Ae.test(i)?e.setAttribute(!Ne&&le.propFix[i]||i,i):e[le.camelCase("default-"+i)]=e[i]=!0,i}},Pe&&Ne||(le.attrHooks.value={get:function(e,i){var n=e.getAttributeNode(i);return le.nodeName(e,"input")?e.defaultValue:n&&n.specified?n.value:t},set:function(e,t,i){return le.nodeName(e,"input")?void(e.defaultValue=t):Re&&Re.set(e,t,i)}}),Ne||(Re=le.valHooks.button={get:function(e,i){var n=e.getAttributeNode(i);return n&&("id"===i||"name"===i||"coords"===i?""!==n.value:n.specified)?n.value:t},set:function(e,i,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=i+="","value"===n||i===e.getAttribute(n)?i:t}},le.attrHooks.contenteditable={get:Re.get,set:function(e,t,i){Re.set(e,""!==t&&t,i)}},le.each(["width","height"],function(e,t){le.attrHooks[t]=le.extend(le.attrHooks[t],{set:function(e,i){if(""===i)return e.setAttribute(t,"auto"),i}})})),le.support.hrefNormalized||(le.each(["href","src","width","height"],function(e,i){le.attrHooks[i]=le.extend(le.attrHooks[i],{get:function(e){var n=e.getAttribute(i,2);return null==n?t:n}})}),le.each(["href","src"],function(e,t){le.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),le.support.style||(le.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),le.support.optSelected||(le.propHooks.selected=le.extend(le.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),le.support.enctype||(le.propFix.enctype="encoding"),le.support.checkOn||le.each(["radio","checkbox"],function(){le.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),le.each(["radio","checkbox"],function(){le.valHooks[this]=le.extend(le.valHooks[this],{set:function(e,t){if(le.isArray(t))return e.checked=le.inArray(le(e).val(),t)>=0}})});var ke=/^(?:input|select|textarea)$/i,He=/^key/,Fe=/^(?:mouse|contextmenu)|click/,Be=/^(?:focusinfocus|focusoutblur)$/,Ke=/^([^.]*)(?:\.(.+)|)$/;le.event={global:{},add:function(e,i,n,r,o){var s,a,l,u,c,h,d,p,f,m,g,y=le._data(e);if(y){for(n.handler&&(u=n,n=u.handler,o=u.selector),n.guid||(n.guid=le.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof le===j||e&&le.event.triggered===e.type?t:le.event.dispatch.apply(h.elem,arguments)},h.elem=e),i=(i||"").match(ce)||[""],l=i.length;l--;)s=Ke.exec(i[l])||[],f=g=s[1],m=(s[2]||"").split(".").sort(),c=le.event.special[f]||{},f=(o?c.delegateType:c.bindType)||f,c=le.event.special[f]||{},d=le.extend({type:f,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&le.expr.match.needsContext.test(o),namespace:m.join(".")},u),(p=a[f])||(p=a[f]=[],p.delegateCount=0,c.setup&&c.setup.call(e,r,m,h)!==!1||(e.addEventListener?e.addEventListener(f,h,!1):e.attachEvent&&e.attachEvent("on"+f,h))),c.add&&(c.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),o?p.splice(p.delegateCount++,0,d):p.push(d),le.event.global[f]=!0;e=null}},remove:function(e,t,i,n,r){var o,s,a,l,u,c,h,d,p,f,m,g=le.hasData(e)&&le._data(e);if(g&&(c=g.events)){for(t=(t||"").match(ce)||[""],u=t.length;u--;)if(a=Ke.exec(t[u])||[],p=m=a[1],f=(a[2]||"").split(".").sort(),p){for(h=le.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,d=c[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=d.length;o--;)s=d[o],!r&&m!==s.origType||i&&i.guid!==s.guid||a&&!a.test(s.namespace)||n&&n!==s.selector&&("**"!==n||!s.selector)||(d.splice(o,1),s.selector&&d.delegateCount--,h.remove&&h.remove.call(e,s));l&&!d.length&&(h.teardown&&h.teardown.call(e,f,g.handle)!==!1||le.removeEvent(e,p,g.handle),delete c[p])}else for(p in c)le.event.remove(e,p+t[u],i,n,!0);le.isEmptyObject(c)&&(delete g.handle,le._removeData(e,"events"))}},trigger:function(i,n,r,o){var s,a,l,u,c,h,d,p=[r||X],f=se.call(i,"type")?i.type:i,m=se.call(i,"namespace")?i.namespace.split("."):[];if(l=h=r=r||X,3!==r.nodeType&&8!==r.nodeType&&!Be.test(f+le.event.triggered)&&(f.indexOf(".")>=0&&(m=f.split("."),f=m.shift(),m.sort()),a=f.indexOf(":")<0&&"on"+f,i=i[le.expando]?i:new le.Event(f,"object"==typeof i&&i),i.isTrigger=!0,i.namespace=m.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=t,i.target||(i.target=r),n=null==n?[i]:le.makeArray(n,[i]),c=le.event.special[f]||{},o||!c.trigger||c.trigger.apply(r,n)!==!1)){if(!o&&!c.noBubble&&!le.isWindow(r)){for(u=c.delegateType||f,Be.test(u+f)||(l=l.parentNode);l;l=l.parentNode)p.push(l),h=l;h===(r.ownerDocument||X)&&p.push(h.defaultView||h.parentWindow||e)}for(d=0;(l=p[d++])&&!i.isPropagationStopped();)i.type=d>1?u:c.bindType||f,s=(le._data(l,"events")||{})[i.type]&&le._data(l,"handle"),s&&s.apply(l,n),s=a&&l[a],s&&le.acceptData(l)&&s.apply&&s.apply(l,n)===!1&&i.preventDefault();if(i.type=f,!o&&!i.isDefaultPrevented()&&(!c._default||c._default.apply(r.ownerDocument,n)===!1)&&("click"!==f||!le.nodeName(r,"a"))&&le.acceptData(r)&&a&&r[f]&&!le.isWindow(r)){h=r[a],h&&(r[a]=null),le.event.triggered=f;try{r[f]()}catch(g){}le.event.triggered=t,h&&(r[a]=h)}return i.result}},dispatch:function(e){e=le.event.fix(e);var i,n,r,o,s,a=[],l=ne.call(arguments),u=(le._data(this,"events")||{})[e.type]||[],c=le.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(a=le.event.handlers.call(this,e,u),i=0;(o=a[i++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,s=0;(r=o.handlers[s++])&&!e.isImmediatePropagationStopped();)e.namespace_re&&!e.namespace_re.test(r.namespace)||(e.handleObj=r,e.data=r.data,n=((le.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,l),n!==t&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,i){var n,r,o,s,a=[],l=i.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],s=0;s<l;s++)r=i[s],n=r.selector+" ",o[n]===t&&(o[n]=r.needsContext?le(n,this).index(u)>=0:le.find(n,this,null,[u]).length),o[n]&&o.push(r);o.length&&a.push({elem:u,handlers:o})}return l<i.length&&a.push({elem:this,handlers:i.slice(l)}),a},fix:function(e){if(e[le.expando])return e;var t,i,n,r=e.type,o=e,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Fe.test(r)?this.mouseHooks:He.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,e=new le.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=o.srcElement||X),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,i){var n,r,o,s=i.button,a=i.fromElement;return null==e.pageX&&null!=i.clientX&&(r=e.target.ownerDocument||X,o=r.documentElement,n=r.body,e.pageX=i.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),e.pageY=i.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?i.toElement:a),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){if(le.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1}},focus:{trigger:function(){if(this!==X.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===X.activeElement&&this.blur)return this.blur(),!1},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=le.extend(new le.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?le.event.trigger(r,null,t):le.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},le.removeEvent=X.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var n="on"+t;e.detachEvent&&(typeof e[n]===j&&(e[n]=null),e.detachEvent(n,i))},le.Event=function(e,t){return this instanceof le.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?l:u):this.type=e,t&&le.extend(this,t),this.timeStamp=e&&e.timeStamp||le.now(),void(this[le.expando]=!0)):new le.Event(e,t)},le.Event.prototype={isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()}},le.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){le.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return r&&(r===n||le.contains(n,r))||(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),le.support.submitBubbles||(le.event.special.submit={setup:function(){return!le.nodeName(this,"form")&&void le.event.add(this,"click._submit keypress._submit",function(e){var i=e.target,n=le.nodeName(i,"input")||le.nodeName(i,"button")?i.form:t;n&&!le._data(n,"submitBubbles")&&(le.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),le._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&le.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!le.nodeName(this,"form")&&void le.event.remove(this,"._submit")}}),le.support.changeBubbles||(le.event.special.change={setup:function(){return ke.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(le.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),le.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),le.event.simulate("change",this,e,!0)})),!1):void le.event.add(this,"beforeactivate._change",function(e){var t=e.target;ke.test(t.nodeName)&&!le._data(t,"changeBubbles")&&(le.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||le.event.simulate("change",this.parentNode,e,!0)}),le._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return le.event.remove(this,"._change"),!ke.test(this.nodeName)}}),le.support.focusinBubbles||le.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,n=function(e){le.event.simulate(t,e.target,le.event.fix(e),!0)};le.event.special[t]={setup:function(){0===i++&&X.addEventListener(e,n,!0)},teardown:function(){0===--i&&X.removeEventListener(e,n,!0)}}}),le.fn.extend({on:function(e,i,n,r,o){var s,a;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=t);for(s in e)this.on(s,i,n,e[s],o);return this}if(null==n&&null==r?(r=i,n=i=t):null==r&&("string"==typeof i?(r=n,n=t):(r=n,n=i,i=t)),r===!1)r=u;else if(!r)return this;return 1===o&&(a=r,r=function(e){return le().off(e),a.apply(this,arguments)},r.guid=a.guid||(a.guid=le.guid++)),this.each(function(){le.event.add(this,e,r,n,i)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,i,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,le(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,i,e[o]);return this}return i!==!1&&"function"!=typeof i||(n=i,i=t),n===!1&&(n=u),this.each(function(){le.event.remove(this,e,n,i)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},trigger:function(e,t){return this.each(function(){le.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return le.event.trigger(e,t,i,!0)}}),function(e,t){function i(e){return fe.test(e+"")}function n(){var e,t=[];return e=function(i,n){return t.push(i+=" ")>x.cacheLength&&delete e[t.shift()],e[i]=n}}function r(e){return e[B]=!0,e}function o(e){var t=D.createElement("div");try{return e(t)}catch(i){return!1}finally{t=null}}function s(e,t,i,n){var r,o,s,a,l,u,c,p,f,m;if((t?t.ownerDocument||t:K)!==D&&I(t),t=t||D,i=i||[],!e||"string"!=typeof e)return i;if(1!==(a=t.nodeType)&&9!==a)return[];if(!A&&!n){if(r=me.exec(e))if(s=r[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&H(t,o)&&o.id===s)return i.push(o),i}else{if(r[2])return Y.apply(i,J.call(t.getElementsByTagName(e),0)),i;if((s=r[3])&&z.getByClassName&&t.getElementsByClassName)return Y.apply(i,J.call(t.getElementsByClassName(s),0)),i}if(z.qsa&&!N.test(e)){if(c=!0,p=B,f=t,m=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(u=h(e),(c=t.getAttribute("id"))?p=c.replace(ve,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=u.length;l--;)u[l]=p+d(u[l]);f=pe.test(e)&&t.parentNode||t,m=u.join(",")}if(m)try{return Y.apply(i,J.call(f.querySelectorAll(m),0)),i}catch(g){}finally{c||t.removeAttribute("id")}}}return T(e.replace(se,"$1"),t,i,n)}function a(e,t){var i=t&&e,n=i&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function l(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function u(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return r(function(t){return t=+t,r(function(i,n){for(var r,o=e([],i.length,t),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function h(e,t){var i,n,r,o,a,l,u,c=$[e+" "];if(c)return t?0:c.slice(0);for(a=e,l=[],u=x.preFilter;a;){i&&!(n=ae.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(r=[])),i=!1,(n=ue.exec(a))&&(i=n.shift(),r.push({value:i,type:n[0].replace(se," ")}),a=a.slice(i.length));for(o in x.filter)!(n=de[o].exec(a))||u[o]&&!(n=u[o](n))||(i=n.shift(),r.push({value:i,type:o,matches:n}),a=a.slice(i.length));if(!i)break}return t?a.length:a?s.error(e):$(e,l).slice(0)}function d(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function p(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=V++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,s){var a,l,u,c=U+" "+o;if(s){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,s))return!0}else for(;t=t[n];)if(1===t.nodeType||r)if(u=t[B]||(t[B]={}),(l=u[n])&&l[0]===c){if((a=l[1])===!0||a===O)return a===!0}else if(l=u[n]=[c],l[1]=e(t,i,s)||O,l[1]===!0)return!0}}function f(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,t,i,n,r){for(var o,s=[],a=0,l=e.length,u=null!=t;a<l;a++)(o=e[a])&&(i&&!i(o,n,r)||(s.push(o),u&&t.push(a)));return s}function g(e,t,i,n,o,s){return n&&!n[B]&&(n=g(n)),o&&!o[B]&&(o=g(o,s)),r(function(r,s,a,l){var u,c,h,d=[],p=[],f=s.length,g=r||E(t||"*",a.nodeType?[a]:a,[]),y=!e||!r&&t?g:m(g,d,e,a,l),v=i?o||(r?e:f||n)?[]:s:y;if(i&&i(y,v,a,l),n)for(u=m(v,p),n(u,[],a,l),c=u.length;c--;)(h=u[c])&&(v[p[c]]=!(y[p[c]]=h));if(r){if(o||e){if(o){for(u=[],c=v.length;c--;)(h=v[c])&&u.push(y[c]=h);o(null,v=[],u,l)}for(c=v.length;c--;)(h=v[c])&&(u=o?Q.call(r,h):d[c])>-1&&(r[u]=!(s[u]=h))}}else v=m(v===s?v.splice(f,v.length):v),o?o(null,s,v,l):Y.apply(s,v)})}function y(e){for(var t,i,n,r=e.length,o=x.relative[e[0].type],s=o||x.relative[" "],a=o?1:0,l=p(function(e){return e===t},s,!0),u=p(function(e){return Q.call(t,e)>-1},s,!0),c=[function(e,i,n){return!o&&(n||i!==_)||((t=i).nodeType?l(e,i,n):u(e,i,n))}];a<r;a++)if(i=x.relative[e[a].type])c=[p(f(c),i)];else{if(i=x.filter[e[a].type].apply(null,e[a].matches),i[B]){for(n=++a;n<r&&!x.relative[e[n].type];n++);return g(a>1&&f(c),a>1&&d(e.slice(0,a-1)).replace(se,"$1"),i,a<n&&y(e.slice(a,n)),n<r&&y(e=e.slice(n)),n<r&&d(e))}c.push(i)}return f(c)}function v(e,t){var i=0,n=t.length>0,o=e.length>0,a=function(r,a,l,u,c){var h,d,p,f=[],g=0,y="0",v=r&&[],E=null!=c,T=_,b=r||o&&x.find.TAG("*",c&&a.parentNode||a),C=U+=null==T?1:Math.random()||.1;for(E&&(_=a!==D&&a,O=i);null!=(h=b[y]);y++){if(o&&h){for(d=0;p=e[d++];)if(p(h,a,l)){u.push(h);break}E&&(U=C,O=++i)}n&&((h=!p&&h)&&g--,r&&v.push(h))}if(g+=y,n&&y!==g){for(d=0;p=t[d++];)p(v,f,a,l);if(r){if(g>0)for(;y--;)v[y]||f[y]||(f[y]=Z.call(u));f=m(f)}Y.apply(u,f),E&&!r&&f.length>0&&g+t.length>1&&s.uniqueSort(u)}return E&&(U=C,_=T),v};return n?r(a):a}function E(e,t,i){for(var n=0,r=t.length;n<r;n++)s(e,t[n],i);return i}function T(e,t,i,n){var r,o,s,a,l,u=h(e);if(!n&&1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&!A&&x.relative[o[1].type]){if(t=x.find.ID(s.matches[0].replace(Te,be),t)[0],!t)return i;e=e.slice(o.shift().value.length)}for(r=de.needsContext.test(e)?0:o.length;r--&&(s=o[r],!x.relative[a=s.type]);)if((l=x.find[a])&&(n=l(s.matches[0].replace(Te,be),pe.test(o[0].type)&&t.parentNode||t))){if(o.splice(r,1),e=n.length&&d(o),!e)return Y.apply(i,J.call(n,0)),i;break}}return L(e,u)(n,t,A,i,pe.test(e)),i}function b(){}var C,O,x,w,R,L,S,_,I,D,M,A,N,P,k,H,F,B="sizzle"+-new Date,K=e.document,z={},U=0,V=0,G=n(),$=n(),W=n(),j=typeof t,X=1<<31,q=[],Z=q.pop,Y=q.push,J=q.slice,Q=q.indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(this[t]===e)return t;return-1},ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ie=te.replace("w","w#"),ne="([*^$|!~]?=)",re="\\["+ee+"*("+te+")"+ee+"*(?:"+ne+ee+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ie+")|)|)"+ee+"*\\]",oe=":("+te+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+re.replace(3,8)+")*)|.*)\\)|)",se=new RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),ae=new RegExp("^"+ee+"*,"+ee+"*"),ue=new RegExp("^"+ee+"*([\\x20\\t\\r\\n\\f>+~])"+ee+"*"),ce=new RegExp(oe),he=new RegExp("^"+ie+"$"),de={ID:new RegExp("^#("+te+")"),CLASS:new RegExp("^\\.("+te+")"),NAME:new RegExp("^\\[name=['\"]?("+te+")['\"]?\\]"),TAG:new RegExp("^("+te.replace("w","w*")+")"),ATTR:new RegExp("^"+re),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),needsContext:new RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},pe=/[\x20\t\r\n\f]*[+~]/,fe=/^[^{]+\{\s*\[native code/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ge=/^(?:input|select|textarea|button)$/i,ye=/^h\d$/i,ve=/'|\\/g,Ee=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,Te=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,be=function(e,t){var i="0x"+t-65536;return i!==i?t:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)};try{J.call(K.documentElement.childNodes,0)[0].nodeType}catch(Ce){J=function(e){for(var t,i=[];t=this[e++];)i.push(t);return i}}R=s.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},I=s.setDocument=function(e){var n=e?e.ownerDocument||e:K;return n!==D&&9===n.nodeType&&n.documentElement?(D=n,M=n.documentElement,A=R(n),z.tagNameNoComments=o(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),z.attributes=o(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),z.getByClassName=o(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),z.getByName=o(function(e){e.id=B+0,e.innerHTML="<a name='"+B+"'></a><div name='"+B+"'></div>",M.insertBefore(e,M.firstChild);var t=n.getElementsByName&&n.getElementsByName(B).length===2+n.getElementsByName(B+0).length;return z.getIdNotName=!n.getElementById(B),M.removeChild(e),t}),x.attrHandle=o(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==j&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},z.getIdNotName?(x.find.ID=function(e,t){if(typeof t.getElementById!==j&&!A){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},x.filter.ID=function(e){var t=e.replace(Te,be);return function(e){return e.getAttribute("id")===t}}):(x.find.ID=function(e,i){if(typeof i.getElementById!==j&&!A){var n=i.getElementById(e);return n?n.id===e||typeof n.getAttributeNode!==j&&n.getAttributeNode("id").value===e?[n]:t:[]}},x.filter.ID=function(e){var t=e.replace(Te,be);return function(e){var i=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return i&&i.value===t}}),x.find.TAG=z.tagNameNoComments?function(e,t){if(typeof t.getElementsByTagName!==j)return t.getElementsByTagName(e)}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},x.find.NAME=z.getByName&&function(e,t){if(typeof t.getElementsByName!==j)return t.getElementsByName(name)},x.find.CLASS=z.getByClassName&&function(e,t){if(typeof t.getElementsByClassName!==j&&!A)return t.getElementsByClassName(e)},P=[],N=[":focus"],(z.qsa=i(n.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||N.push("\\["+ee+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||N.push(":checked")}),o(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&N.push("[*^$]="+ee+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),N.push(",.*:")})),(z.matchesSelector=i(k=M.matchesSelector||M.mozMatchesSelector||M.webkitMatchesSelector||M.oMatchesSelector||M.msMatchesSelector))&&o(function(e){z.disconnectedMatch=k.call(e,"div"),k.call(e,"[s!='']:x"),P.push("!=",oe)}),N=new RegExp(N.join("|")),P=new RegExp(P.join("|")),H=i(M.contains)||M.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},F=M.compareDocumentPosition?function(e,t){var i;return e===t?(S=!0,0):(i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&i||e.parentNode&&11===e.parentNode.nodeType?e===n||H(K,e)?-1:t===n||H(K,t)?1:0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var i,r=0,o=e.parentNode,s=t.parentNode,l=[e],u=[t];if(e===t)return S=!0,0;if(!o||!s)return e===n?-1:t===n?1:o?-1:s?1:0;if(o===s)return a(e,t);for(i=e;i=i.parentNode;)l.unshift(i);for(i=t;i=i.parentNode;)u.unshift(i);for(;l[r]===u[r];)r++;return r?a(l[r],u[r]):l[r]===K?-1:u[r]===K?1:0},S=!1,[0,0].sort(F),z.detectDuplicates=S,D):D},s.matches=function(e,t){return s(e,null,null,t)},s.matchesSelector=function(e,t){if((e.ownerDocument||e)!==D&&I(e),t=t.replace(Ee,"='$1']"),z.matchesSelector&&!A&&(!P||!P.test(t))&&!N.test(t))try{var i=k.call(e,t);if(i||z.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(n){}return s(t,D,null,[e]).length>0},s.contains=function(e,t){return(e.ownerDocument||e)!==D&&I(e),H(e,t)},s.attr=function(e,t){var i;return(e.ownerDocument||e)!==D&&I(e),A||(t=t.toLowerCase()),(i=x.attrHandle[t])?i(e):A||z.attributes?e.getAttribute(t):((i=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:i&&i.specified?i.value:null;
},s.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},s.uniqueSort=function(e){var t,i=[],n=1,r=0;if(S=!z.detectDuplicates,e.sort(F),S){for(;t=e[n];n++)t===e[n-1]&&(r=i.push(n));for(;r--;)e.splice(i[r],1)}return e},w=s.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=w(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n];n++)i+=w(t);return i},x=s.selectors={cacheLength:50,createPseudo:r,match:de,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Te,be),e[3]=(e[4]||e[5]||"").replace(Te,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||s.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&s.error(e[0]),e},PSEUDO:function(e){var t,i=!e[5]&&e[2];return de.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:i&&ce.test(i)&&(t=h(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(Te,be).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&G(e,function(e){return t.test(e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(n){var r=s.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var u,c,h,d,p,f,m=o!==s?"nextSibling":"previousSibling",g=t.parentNode,y=a&&t.nodeName.toLowerCase(),v=!l&&!a;if(g){if(o){for(;m;){for(h=t;h=h[m];)if(a?h.nodeName.toLowerCase()===y:1===h.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&v){for(c=g[B]||(g[B]={}),u=c[e]||[],p=u[0]===U&&u[1],d=u[0]===U&&u[2],h=p&&g.childNodes[p];h=++p&&h&&h[m]||(d=p=0)||f.pop();)if(1===h.nodeType&&++d&&h===t){c[e]=[U,p,d];break}}else if(v&&(u=(t[B]||(t[B]={}))[e])&&u[0]===U)d=u[1];else for(;(h=++p&&h&&h[m]||(d=p=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==y:1!==h.nodeType)||!++d||(v&&((h[B]||(h[B]={}))[e]=[U,d]),h!==t)););return d-=r,d===n||d%n===0&&d/n>=0}}},PSEUDO:function(e,t){var i,n=x.pseudos[e]||x.setFilters[e.toLowerCase()]||s.error("unsupported pseudo: "+e);return n[B]?n(t):n.length>1?(i=[e,e,"",t],x.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,i){for(var r,o=n(e,t),s=o.length;s--;)r=Q.call(e,o[s]),e[r]=!(i[r]=o[s])}):function(e){return n(e,0,i)}):n}},pseudos:{not:r(function(e){var t=[],i=[],n=L(e.replace(se,"$1"));return n[B]?r(function(e,t,i,r){for(var o,s=n(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,r,o){return t[0]=e,n(t,null,o,i),!i.pop()}}),has:r(function(e){return function(t){return s(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||w(t)).indexOf(e)>-1}}),lang:r(function(e){return he.test(e||"")||s.error("unsupported lang: "+e),e=e.replace(Te,be).toLowerCase(),function(t){var i;do if(i=A?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===M},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return ye.test(e.nodeName)},input:function(e){return ge.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[i<0?i+t:i]}),even:c(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:c(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:c(function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e}),gt:c(function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e})}};for(C in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[C]=l(C);for(C in{submit:!0,reset:!0})x.pseudos[C]=u(C);L=s.compile=function(e,t){var i,n=[],r=[],o=W[e+" "];if(!o){for(t||(t=h(e)),i=t.length;i--;)o=y(t[i]),o[B]?n.push(o):r.push(o);o=W(e,v(r,n))}return o},x.pseudos.nth=x.pseudos.eq,x.filters=b.prototype=x.pseudos,x.setFilters=new b,I(),s.attr=le.attr,le.find=s,le.expr=s.selectors,le.expr[":"]=le.expr.pseudos,le.unique=s.uniqueSort,le.text=s.getText,le.isXMLDoc=s.isXML,le.contains=s.contains}(e);var ze=/Until$/,Ue=/^(?:parents|prev(?:Until|All))/,Ve=/^.[^:#\[\.,]*$/,Ge=le.expr.match.needsContext,$e={children:!0,contents:!0,next:!0,prev:!0};le.fn.extend({find:function(e){var t,i,n,r=this.length;if("string"!=typeof e)return n=this,this.pushStack(le(e).filter(function(){for(t=0;t<r;t++)if(le.contains(n[t],this))return!0}));for(i=[],t=0;t<r;t++)le.find(e,this[t],i);return i=this.pushStack(r>1?le.unique(i):i),i.selector=(this.selector?this.selector+" ":"")+e,i},has:function(e){var t,i=le(e,this),n=i.length;return this.filter(function(){for(t=0;t<n;t++)if(le.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(h(this,e,!1))},filter:function(e){return this.pushStack(h(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?Ge.test(e)?le(e,this.context).index(this[0])>=0:le.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var i,n=0,r=this.length,o=[],s=Ge.test(e)||"string"!=typeof e?le(e,t||this.context):0;n<r;n++)for(i=this[n];i&&i.ownerDocument&&i!==t&&11!==i.nodeType;){if(s?s.index(i)>-1:le.find.matchesSelector(i,e)){o.push(i);break}i=i.parentNode}return this.pushStack(o.length>1?le.unique(o):o)},index:function(e){return e?"string"==typeof e?le.inArray(this[0],le(e)):le.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var i="string"==typeof e?le(e,t):le.makeArray(e&&e.nodeType?[e]:e),n=le.merge(this.get(),i);return this.pushStack(le.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),le.fn.andSelf=le.fn.addBack,le.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return le.dir(e,"parentNode")},parentsUntil:function(e,t,i){return le.dir(e,"parentNode",i)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return le.dir(e,"nextSibling")},prevAll:function(e){return le.dir(e,"previousSibling")},nextUntil:function(e,t,i){return le.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return le.dir(e,"previousSibling",i)},siblings:function(e){return le.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return le.sibling(e.firstChild)},contents:function(e){return le.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:le.merge([],e.childNodes)}},function(e,t){le.fn[e]=function(i,n){var r=le.map(this,t,i);return ze.test(e)||(n=i),n&&"string"==typeof n&&(r=le.filter(n,r)),r=this.length>1&&!$e[e]?le.unique(r):r,this.length>1&&Ue.test(e)&&(r=r.reverse()),this.pushStack(r)}}),le.extend({filter:function(e,t,i){return i&&(e=":not("+e+")"),1===t.length?le.find.matchesSelector(t[0],e)?[t[0]]:[]:le.find.matches(e,t)},dir:function(e,i,n){for(var r=[],o=e[i];o&&9!==o.nodeType&&(n===t||1!==o.nodeType||!le(o).is(n));)1===o.nodeType&&r.push(o),o=o[i];return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var We="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",je=/ jQuery\d+="(?:null|\d+)"/g,Xe=new RegExp("<(?:"+We+")[\\s/>]","i"),qe=/^\s+/,Ze=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ye=/<([\w:]+)/,Je=/<tbody/i,Qe=/<|&#?\w+;/,et=/<(?:script|style|link)/i,tt=/^(?:checkbox|radio)$/i,it=/checked\s*(?:[^=]|=\s*.checked.)/i,nt=/^$|\/(?:java|ecma)script/i,rt=/^true\/(.*)/,ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,st={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:le.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},at=d(X),lt=at.appendChild(X.createElement("div"));st.optgroup=st.option,st.tbody=st.tfoot=st.colgroup=st.caption=st.thead,st.th=st.td,le.fn.extend({text:function(e){return le.access(this,function(e){return e===t?le.text(this):this.empty().append((this[0]&&this[0].ownerDocument||X).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(le.isFunction(e))return this.each(function(t){le(this).wrapAll(e.call(this,t))});if(this[0]){var t=le(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return le.isFunction(e)?this.each(function(t){le(this).wrapInner(e.call(this,t))}):this.each(function(){var t=le(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=le.isFunction(e);return this.each(function(i){le(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){le.nodeName(this,"body")||le(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=0;null!=(i=this[n]);n++)(!e||le.filter(e,[i]).length>0)&&(t||1!==i.nodeType||le.cleanData(E(i)),i.parentNode&&(t&&le.contains(i.ownerDocument,i)&&g(E(i,"script")),i.parentNode.removeChild(i)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&le.cleanData(E(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&le.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return le.clone(this,e,t)})},html:function(e){return le.access(this,function(e){var i=this[0]||{},n=0,r=this.length;if(e===t)return 1===i.nodeType?i.innerHTML.replace(je,""):t;if("string"==typeof e&&!et.test(e)&&(le.support.htmlSerialize||!Xe.test(e))&&(le.support.leadingWhitespace||!qe.test(e))&&!st[(Ye.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ze,"<$1></$2>");try{for(;n<r;n++)i=this[n]||{},1===i.nodeType&&(le.cleanData(E(i,!1)),i.innerHTML=e);i=0}catch(o){}}i&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=le.isFunction(e);return t||"string"==typeof e||(e=le(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,i=this.parentNode;i&&(le(this).remove(),i.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,i,n){e=te.apply([],e);var r,o,s,a,l,u,c=0,h=this.length,d=this,g=h-1,y=e[0],v=le.isFunction(y);if(v||!(h<=1||"string"!=typeof y||le.support.checkClone)&&it.test(y))return this.each(function(r){var o=d.eq(r);v&&(e[0]=y.call(this,r,i?o.html():t)),o.domManip(e,i,n)});if(h&&(u=le.buildFragment(e,this[0].ownerDocument,!1,this),r=u.firstChild,1===u.childNodes.length&&(u=r),r)){for(i=i&&le.nodeName(r,"tr"),a=le.map(E(u,"script"),f),s=a.length;c<h;c++)o=u,c!==g&&(o=le.clone(o,!0,!0),s&&le.merge(a,E(o,"script"))),n.call(i&&le.nodeName(this[c],"table")?p(this[c],"tbody"):this[c],o,c);if(s)for(l=a[a.length-1].ownerDocument,le.map(a,m),c=0;c<s;c++)o=a[c],nt.test(o.type||"")&&!le._data(o,"globalEval")&&le.contains(l,o)&&(o.src?le.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):le.globalEval((o.text||o.textContent||o.innerHTML||"").replace(ot,"")));u=r=null}return this}}),le.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){le.fn[e]=function(e){for(var i,n=0,r=[],o=le(e),s=o.length-1;n<=s;n++)i=n===s?this:this.clone(!0),le(o[n])[t](i),ie.apply(r,i.get());return this.pushStack(r)}}),le.extend({clone:function(e,t,i){var n,r,o,s,a,l=le.contains(e.ownerDocument,e);if(le.support.html5Clone||le.isXMLDoc(e)||!Xe.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(lt.innerHTML=e.outerHTML,lt.removeChild(o=lt.firstChild)),!(le.support.noCloneEvent&&le.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||le.isXMLDoc(e)))for(n=E(o),a=E(e),s=0;null!=(r=a[s]);++s)n[s]&&v(r,n[s]);if(t)if(i)for(a=a||E(e),n=n||E(o),s=0;null!=(r=a[s]);s++)y(r,n[s]);else y(e,o);return n=E(o,"script"),n.length>0&&g(n,!l&&E(e,"script")),n=a=r=null,o},buildFragment:function(e,t,i,n){for(var r,o,s,a,l,u,c,h=e.length,p=d(t),f=[],m=0;m<h;m++)if(o=e[m],o||0===o)if("object"===le.type(o))le.merge(f,o.nodeType?[o]:o);else if(Qe.test(o)){for(a=a||p.appendChild(t.createElement("div")),l=(Ye.exec(o)||["",""])[1].toLowerCase(),c=st[l]||st._default,a.innerHTML=c[1]+o.replace(Ze,"<$1></$2>")+c[2],r=c[0];r--;)a=a.lastChild;if(!le.support.leadingWhitespace&&qe.test(o)&&f.push(t.createTextNode(qe.exec(o)[0])),!le.support.tbody)for(o="table"!==l||Je.test(o)?"<table>"!==c[1]||Je.test(o)?0:a:a.firstChild,r=o&&o.childNodes.length;r--;)le.nodeName(u=o.childNodes[r],"tbody")&&!u.childNodes.length&&o.removeChild(u);for(le.merge(f,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=p.lastChild}else f.push(t.createTextNode(o));for(a&&p.removeChild(a),le.support.appendChecked||le.grep(E(f,"input"),T),m=0;o=f[m++];)if((!n||le.inArray(o,n)===-1)&&(s=le.contains(o.ownerDocument,o),a=E(p.appendChild(o),"script"),s&&g(a),i))for(r=0;o=a[r++];)nt.test(o.type||"")&&i.push(o);return a=null,p},cleanData:function(e,t){for(var i,n,r,o,s=0,a=le.expando,l=le.cache,u=le.support.deleteExpando,c=le.event.special;null!=(i=e[s]);s++)if((t||le.acceptData(i))&&(r=i[a],o=r&&l[r])){if(o.events)for(n in o.events)c[n]?le.event.remove(i,n):le.removeEvent(i,n,o.handle);l[r]&&(delete l[r],u?delete i[a]:typeof i.removeAttribute!==j?i.removeAttribute(a):i[a]=null,Q.push(r))}}});var ut,ct,ht,dt=/alpha\([^)]*\)/i,pt=/opacity\s*=\s*([^)]*)/,ft=/^(top|right|bottom|left)$/,mt=/^(none|table(?!-c[ea]).+)/,gt=/^margin/,yt=new RegExp("^("+ue+")(.*)$","i"),vt=new RegExp("^("+ue+")(?!px)[a-z%]+$","i"),Et=new RegExp("^([+-])=("+ue+")","i"),Tt={BODY:"block"},bt={position:"absolute",visibility:"hidden",display:"block"},Ct={letterSpacing:0,fontWeight:400},Ot=["Top","Right","Bottom","Left"],xt=["Webkit","O","Moz","ms"];le.fn.extend({css:function(e,i){return le.access(this,function(e,i,n){var r,o,s={},a=0;if(le.isArray(i)){for(o=ct(e),r=i.length;a<r;a++)s[i[a]]=le.css(e,i[a],!1,o);return s}return n!==t?le.style(e,i,n):le.css(e,i)},e,i,arguments.length>1)},show:function(){return O(this,!0)},hide:function(){return O(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:C(this))?le(this).show():le(this).hide()})}}),le.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=ht(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":le.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,i,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,s,a,l=le.camelCase(i),u=e.style;if(i=le.cssProps[l]||(le.cssProps[l]=b(u,l)),a=le.cssHooks[i]||le.cssHooks[l],n===t)return a&&"get"in a&&(o=a.get(e,!1,r))!==t?o:u[i];if(s=typeof n,"string"===s&&(o=Et.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(le.css(e,i)),s="number"),!(null==n||"number"===s&&isNaN(n)||("number"!==s||le.cssNumber[l]||(n+="px"),le.support.clearCloneStyle||""!==n||0!==i.indexOf("background")||(u[i]="inherit"),a&&"set"in a&&(n=a.set(e,n,r))===t)))try{u[i]=n}catch(c){}}},css:function(e,i,n,r){var o,s,a,l=le.camelCase(i);return i=le.cssProps[l]||(le.cssProps[l]=b(e.style,l)),a=le.cssHooks[i]||le.cssHooks[l],a&&"get"in a&&(s=a.get(e,!0,n)),s===t&&(s=ht(e,i,r)),"normal"===s&&i in Ct&&(s=Ct[i]),""===n||n?(o=parseFloat(s),n===!0||le.isNumeric(o)?o||0:s):s},swap:function(e,t,i,n){var r,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=s[o];return r}}),e.getComputedStyle?(ct=function(t){return e.getComputedStyle(t,null)},ht=function(e,i,n){var r,o,s,a=n||ct(e),l=a?a.getPropertyValue(i)||a[i]:t,u=e.style;return a&&(""!==l||le.contains(e.ownerDocument,e)||(l=le.style(e,i)),vt.test(l)&&gt.test(i)&&(r=u.width,o=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=a.width,u.width=r,u.minWidth=o,u.maxWidth=s)),l}):X.documentElement.currentStyle&&(ct=function(e){return e.currentStyle},ht=function(e,i,n){var r,o,s,a=n||ct(e),l=a?a[i]:t,u=e.style;return null==l&&u&&u[i]&&(l=u[i]),vt.test(l)&&!ft.test(i)&&(r=u.left,o=e.runtimeStyle,s=o&&o.left,s&&(o.left=e.currentStyle.left),u.left="fontSize"===i?"1em":l,l=u.pixelLeft+"px",u.left=r,s&&(o.left=s)),""===l?"auto":l}),le.each(["height","width"],function(e,t){le.cssHooks[t]={get:function(e,i,n){if(i)return 0===e.offsetWidth&&mt.test(le.css(e,"display"))?le.swap(e,bt,function(){return R(e,t,n)}):R(e,t,n)},set:function(e,i,n){var r=n&&ct(e);return x(e,i,n?w(e,t,n,le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,r),r):0)}}}),le.support.opacity||(le.cssHooks.opacity={get:function(e,t){return pt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,r=le.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,(t>=1||""===t)&&""===le.trim(o.replace(dt,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===t||n&&!n.filter)||(i.filter=dt.test(o)?o.replace(dt,r):o+" "+r)}}),le(function(){le.support.reliableMarginRight||(le.cssHooks.marginRight={get:function(e,t){if(t)return le.swap(e,{display:"inline-block"},ht,[e,"marginRight"])}}),!le.support.pixelPosition&&le.fn.position&&le.each(["top","left"],function(e,t){le.cssHooks[t]={get:function(e,i){if(i)return i=ht(e,t),vt.test(i)?le(e).position()[t]+"px":i}}})}),le.expr&&le.expr.filters&&(le.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!le.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||le.css(e,"display"))},le.expr.filters.visible=function(e){return!le.expr.filters.hidden(e)}),le.each({margin:"",padding:"",border:"Width"},function(e,t){le.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];n<4;n++)r[e+Ot[n]+t]=o[n]||o[n-2]||o[0];return r}},gt.test(e)||(le.cssHooks[e+t].set=x)});var wt=/%20/g,Rt=/\[\]$/,Lt=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,_t=/^(?:input|select|textarea|keygen)/i;le.fn.extend({serialize:function(){return le.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=le.prop(this,"elements");return e?le.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!le(this).is(":disabled")&&_t.test(this.nodeName)&&!St.test(e)&&(this.checked||!tt.test(e))}).map(function(e,t){var i=le(this).val();return null==i?null:le.isArray(i)?le.map(i,function(e){return{name:t.name,value:e.replace(Lt,"\r\n")}}):{name:t.name,value:i.replace(Lt,"\r\n")}}).get()}}),le.param=function(e,i){var n,r=[],o=function(e,t){t=le.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(i===t&&(i=le.ajaxSettings&&le.ajaxSettings.traditional),le.isArray(e)||e.jquery&&!le.isPlainObject(e))le.each(e,function(){o(this.name,this.value)});else for(n in e)_(n,e[n],i,o);return r.join("&").replace(wt,"+")},le.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){le.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),le.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var It,Dt,Mt=le.now(),At=/\?/,Nt=/#.*$/,Pt=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ht=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ft=/^(?:GET|HEAD)$/,Bt=/^\/\//,Kt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,zt=le.fn.load,Ut={},Vt={},Gt="*/".concat("*");try{Dt=q.href}catch($t){Dt=X.createElement("a"),Dt.href="",Dt=Dt.href}It=Kt.exec(Dt.toLowerCase())||[],le.fn.load=function(e,i,n){if("string"!=typeof e&&zt)return zt.apply(this,arguments);var r,o,s,a=this,l=e.indexOf(" ");return l>=0&&(r=e.slice(l,e.length),e=e.slice(0,l)),le.isFunction(i)?(n=i,i=t):i&&"object"==typeof i&&(s="POST"),a.length>0&&le.ajax({url:e,type:s,dataType:"html",data:i}).done(function(e){o=arguments,a.html(r?le("<div>").append(le.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){a.each(n,o||[e.responseText,t,e])}),this},le.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){le.fn[t]=function(e){return this.on(t,e)}}),le.each(["get","post"],function(e,i){le[i]=function(e,n,r,o){return le.isFunction(n)&&(o=o||r,r=n,n=t),le.ajax({url:e,type:i,dataType:o,data:n,success:r})}}),le.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Dt,type:"GET",isLocal:Ht.test(It[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Gt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":le.parseJSON,"text xml":le.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?M(M(e,le.ajaxSettings),t):M(le.ajaxSettings,e)},ajaxPrefilter:I(Ut),ajaxTransport:I(Vt),ajax:function(e,i){function n(e,i,n,r){var o,h,v,E,b,O=i;2!==T&&(T=2,l&&clearTimeout(l),c=t,a=r||"",C.readyState=e>0?4:0,n&&(E=A(d,C,n)),e>=200&&e<300||304===e?(d.ifModified&&(b=C.getResponseHeader("Last-Modified"),b&&(le.lastModified[s]=b),b=C.getResponseHeader("etag"),b&&(le.etag[s]=b)),204===e?(o=!0,O="nocontent"):304===e?(o=!0,O="notmodified"):(o=N(d,E),O=o.state,h=o.data,v=o.error,o=!v)):(v=O,!e&&O||(O="error",e<0&&(e=0))),C.status=e,C.statusText=(i||O)+"",o?m.resolveWith(p,[h,O,C]):m.rejectWith(p,[C,O,v]),C.statusCode(y),y=t,u&&f.trigger(o?"ajaxSuccess":"ajaxError",[C,d,o?h:v]),g.fireWith(p,[C,O]),u&&(f.trigger("ajaxComplete",[C,d]),--le.active||le.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=t),i=i||{};var r,o,s,a,l,u,c,h,d=le.ajaxSetup({},i),p=d.context||d,f=d.context&&(p.nodeType||p.jquery)?le(p):le.event,m=le.Deferred(),g=le.Callbacks("once memory"),y=d.statusCode||{},v={},E={},T=0,b="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===T){if(!h)for(h={};t=kt.exec(a);)h[t[1].toLowerCase()]=t[2];t=h[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===T?a:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return T||(e=E[i]=E[i]||e,v[e]=t),this},overrideMimeType:function(e){return T||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(T<2)for(t in e)y[t]=[y[t],e[t]];else C.always(e[C.status]);return this},abort:function(e){var t=e||b;return c&&c.abort(t),n(0,t),this}};if(m.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,d.url=((e||d.url||Dt)+"").replace(Nt,"").replace(Bt,It[1]+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=le.trim(d.dataType||"*").toLowerCase().match(ce)||[""],null==d.crossDomain&&(r=Kt.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]===It[1]&&r[2]===It[2]&&(r[3]||("http:"===r[1]?80:443))==(It[3]||("http:"===It[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=le.param(d.data,d.traditional)),D(Ut,d,i,C),2===T)return C;u=d.global,u&&0===le.active++&&le.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Ft.test(d.type),s=d.url,d.hasContent||(d.data&&(s=d.url+=(At.test(s)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=Pt.test(s)?s.replace(Pt,"$1_="+Mt++):s+(At.test(s)?"&":"?")+"_="+Mt++)),d.ifModified&&(le.lastModified[s]&&C.setRequestHeader("If-Modified-Since",le.lastModified[s]),le.etag[s]&&C.setRequestHeader("If-None-Match",le.etag[s])),(d.data&&d.hasContent&&d.contentType!==!1||i.contentType)&&C.setRequestHeader("Content-Type",d.contentType),C.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Gt+"; q=0.01":""):d.accepts["*"]);for(o in d.headers)C.setRequestHeader(o,d.headers[o]);if(d.beforeSend&&(d.beforeSend.call(p,C,d)===!1||2===T))return C.abort();b="abort";for(o in{success:1,error:1,complete:1})C[o](d[o]);if(c=D(Vt,d,i,C)){C.readyState=1,u&&f.trigger("ajaxSend",[C,d]),d.async&&d.timeout>0&&(l=setTimeout(function(){C.abort("timeout")},d.timeout));try{T=1,c.send(v,n)}catch(O){if(!(T<2))throw O;n(-1,O)}}else n(-1,"No Transport");return C},getScript:function(e,i){return le.get(e,t,i,"script")},getJSON:function(e,t,i){return le.get(e,t,i,"json")}}),le.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return le.globalEval(e),e}}}),le.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),le.ajaxTransport("script",function(e){if(e.crossDomain){var i,n=X.head||le("head")[0]||X.documentElement;return{send:function(t,r){i=X.createElement("script"),i.async=!0,e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),i=null,t||r(200,"success"))},n.insertBefore(i,n.firstChild)},abort:function(){i&&i.onload(t,!0)}}}});var Wt=[],jt=/(=)\?(?=&|$)|\?\?/;le.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Wt.pop()||le.expando+"_"+Mt++;return this[e]=!0,e}}),le.ajaxPrefilter("json jsonp",function(i,n,r){var o,s,a,l=i.jsonp!==!1&&(jt.test(i.url)?"url":"string"==typeof i.data&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&jt.test(i.data)&&"data");if(l||"jsonp"===i.dataTypes[0])return o=i.jsonpCallback=le.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,l?i[l]=i[l].replace(jt,"$1"+o):i.jsonp!==!1&&(i.url+=(At.test(i.url)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return a||le.error(o+" was not called"),a[0]},i.dataTypes[0]="json",s=e[o],e[o]=function(){a=arguments},r.always(function(){e[o]=s,i[o]&&(i.jsonpCallback=n.jsonpCallback,Wt.push(o)),a&&le.isFunction(s)&&s(a[0]),a=s=t}),"script"});var Xt,qt,Zt=0,Yt=e.ActiveXObject&&function(){var e;for(e in Xt)Xt[e](t,!0)};le.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&P()||k()}:P,qt=le.ajaxSettings.xhr(),le.support.cors=!!qt&&"withCredentials"in qt,qt=le.support.ajax=!!qt,qt&&le.ajaxTransport(function(i){if(!i.crossDomain||le.support.cors){var n;return{send:function(r,o){var s,a,l=i.xhr();if(i.username?l.open(i.type,i.url,i.async,i.username,i.password):l.open(i.type,i.url,i.async),i.xhrFields)for(a in i.xhrFields)l[a]=i.xhrFields[a];i.mimeType&&l.overrideMimeType&&l.overrideMimeType(i.mimeType),i.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(a in r)l.setRequestHeader(a,r[a])}catch(u){}l.send(i.hasContent&&i.data||null),n=function(e,r){var a,u,c,h;try{if(n&&(r||4===l.readyState))if(n=t,s&&(l.onreadystatechange=le.noop,Yt&&delete Xt[s]),r)4!==l.readyState&&l.abort();else{h={},a=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(h.text=l.responseText);try{c=l.statusText}catch(d){c=""}a||!i.isLocal||i.crossDomain?1223===a&&(a=204):a=h.text?200:404}}catch(p){r||o(-1,p)}h&&o(a,c,h,u)},i.async?4===l.readyState?setTimeout(n):(s=++Zt,Yt&&(Xt||(Xt={},le(e).unload(Yt)),Xt[s]=n),l.onreadystatechange=n):n()},abort:function(){n&&n(t,!0)}}}});var Jt,Qt,ei=/^(?:toggle|show|hide)$/,ti=new RegExp("^(?:([+-])=|)("+ue+")([a-z%]*)$","i"),ii=/queueHooks$/,ni=[z],ri={"*":[function(e,t){var i,n,r=this.createTween(e,t),o=ti.exec(t),s=r.cur(),a=+s||0,l=1,u=20;if(o){if(i=+o[2],n=o[3]||(le.cssNumber[e]?"":"px"),"px"!==n&&a){a=le.css(r.elem,e,!0)||i||1;do l=l||".5",a/=l,le.style(r.elem,e,a+n);while(l!==(l=r.cur()/s)&&1!==l&&--u)}r.unit=n,r.start=a,r.end=o[1]?a+(o[1]+1)*i:i}return r}]};le.Animation=le.extend(B,{tweener:function(e,t){le.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;n<r;n++)i=e[n],ri[i]=ri[i]||[],ri[i].unshift(t)},prefilter:function(e,t){t?ni.unshift(e):ni.push(e)}}),le.Tween=U,U.prototype={constructor:U,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(le.cssNumber[i]?"":"px")},cur:function(){var e=U.propHooks[this.prop];return e&&e.get?e.get(this):U.propHooks._default.get(this)},run:function(e){var t,i=U.propHooks[this.prop];return this.options.duration?this.pos=t=le.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):U.propHooks._default.set(this),this}},U.prototype.init.prototype=U.prototype,U.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=le.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){le.fx.step[e.prop]?le.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[le.cssProps[e.prop]]||le.cssHooks[e.prop])?le.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},U.propHooks.scrollTop=U.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},le.each(["toggle","show","hide"],function(e,t){var i=le.fn[t];le.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(V(t,!0),e,n,r)}}),le.fn.extend({fadeTo:function(e,t,i,n){return this.filter(C).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=le.isEmptyObject(e),o=le.speed(t,i,n),s=function(){var t=B(this,le.extend({},e),o);s.finish=function(){t.stop(!0)},(r||le._data(this,"finish"))&&t.stop(!0);
};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,i,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=i,i=e,e=t),i&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=le.timers,s=le._data(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&ii.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||le.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=le._data(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=le.timers,s=n?n.length:0;for(i.finish=!0,le.queue(this,e,[]),r&&r.cur&&r.cur.finish&&r.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),le.each({slideDown:V("show"),slideUp:V("hide"),slideToggle:V("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){le.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),le.speed=function(e,t,i){var n=e&&"object"==typeof e?le.extend({},e):{complete:i||!i&&t||le.isFunction(e)&&e,duration:e,easing:i&&t||t&&!le.isFunction(t)&&t};return n.duration=le.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in le.fx.speeds?le.fx.speeds[n.duration]:le.fx.speeds._default,null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(){le.isFunction(n.old)&&n.old.call(this),n.queue&&le.dequeue(this,n.queue)},n},le.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},le.timers=[],le.fx=U.prototype.init,le.fx.tick=function(){var e,i=le.timers,n=0;for(Jt=le.now();n<i.length;n++)e=i[n],e()||i[n]!==e||i.splice(n--,1);i.length||le.fx.stop(),Jt=t},le.fx.timer=function(e){e()&&le.timers.push(e)&&le.fx.start()},le.fx.interval=13,le.fx.start=function(){Qt||(Qt=setInterval(le.fx.tick,le.fx.interval))},le.fx.stop=function(){clearInterval(Qt),Qt=null},le.fx.speeds={slow:600,fast:200,_default:400},le.fx.step={},le.expr&&le.expr.filters&&(le.expr.filters.animated=function(e){return le.grep(le.timers,function(t){return e===t.elem}).length}),le.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){le.offset.setOffset(this,e,t)});var i,n,r={top:0,left:0},o=this[0],s=o&&o.ownerDocument;if(s)return i=s.documentElement,le.contains(i,o)?(typeof o.getBoundingClientRect!==j&&(r=o.getBoundingClientRect()),n=G(s),{top:r.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0),left:r.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0)}):r},le.offset={setOffset:function(e,t,i){var n=le.css(e,"position");"static"===n&&(e.style.position="relative");var r,o,s=le(e),a=s.offset(),l=le.css(e,"top"),u=le.css(e,"left"),c=("absolute"===n||"fixed"===n)&&le.inArray("auto",[l,u])>-1,h={},d={};c?(d=s.position(),r=d.top,o=d.left):(r=parseFloat(l)||0,o=parseFloat(u)||0),le.isFunction(t)&&(t=t.call(e,i,a)),null!=t.top&&(h.top=t.top-a.top+r),null!=t.left&&(h.left=t.left-a.left+o),"using"in t?t.using.call(e,h):s.css(h)}},le.fn.extend({position:function(){if(this[0]){var e,t,i={top:0,left:0},n=this[0];return"fixed"===le.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),le.nodeName(e[0],"html")||(i=e.offset()),i.top+=le.css(e[0],"borderTopWidth",!0),i.left+=le.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-le.css(n,"marginTop",!0),left:t.left-i.left-le.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||X.documentElement;e&&!le.nodeName(e,"html")&&"static"===le.css(e,"position");)e=e.offsetParent;return e||X.documentElement})}}),le.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var n=/Y/.test(i);le.fn[e]=function(r){return le.access(this,function(e,r,o){var s=G(e);return o===t?s?i in s?s[i]:s.document.documentElement[r]:e[r]:void(s?s.scrollTo(n?le(s).scrollLeft():o,n?o:le(s).scrollTop()):e[r]=o)},e,r,arguments.length,null)}}),le.each({Height:"height",Width:"width"},function(e,i){le.each({padding:"inner"+e,content:i,"":"outer"+e},function(n,r){le.fn[r]=function(r,o){var s=arguments.length&&(n||"boolean"!=typeof r),a=n||(r===!0||o===!0?"margin":"border");return le.access(this,function(i,n,r){var o;return le.isWindow(i)?i.document.documentElement["client"+e]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+e],o["scroll"+e],i.body["offset"+e],o["offset"+e],o["client"+e])):r===t?le.css(i,n,a):le.style(i,n,r,a)},i,s?r:t,s,null)}})}),e.jQuery=e.$=le,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return le})}(window),function(e,t,i){"use strict";function n(e){return function(){var t,i,n=arguments[0],r="["+(e?e+":":"")+n+"] ",o=arguments[1],s=arguments,a=function(e){return"function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof e?"undefined":"string"!=typeof e?JSON.stringify(e):e};for(t=r+o.replace(/\{\d+\}/g,function(e){var t,i=+e.slice(1,-1);return i+2<s.length?(t=s[i+2],"function"==typeof t?t.toString().replace(/ ?\{[\s\S]*$/,""):"undefined"==typeof t?"undefined":"string"!=typeof t?U(t):t):e}),t=t+"\nhttp://errors.angularjs.org/1.2.32/"+(e?e+"/":"")+n,i=2;i<arguments.length;i++)t=t+(2==i?"?":"&")+"p"+(i-2)+"="+encodeURIComponent(a(arguments[i]));return new Error(t)}}function r(e){if(null==e||w(e))return!1;var t=e.length;return!(1!==e.nodeType||!t)||(T(e)||Mi(e)||0===t||"number"==typeof t&&t>0&&t-1 in e)}function o(e,t,i){var n;if(e)if(O(e))for(n in e)"prototype"==n||"length"==n||"name"==n||e.hasOwnProperty&&!e.hasOwnProperty(n)||t.call(i,e[n],n);else if(Mi(e)||r(e))for(n=0;n<e.length;n++)t.call(i,e[n],n);else if(e.forEach&&e.forEach!==o)e.forEach(t,i);else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n);return e}function s(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t.sort()}function a(e,t,i){for(var n=s(e),r=0;r<n.length;r++)t.call(i,e[n[r]],n[r]);return n}function l(e){return function(t,i){e(i,t)}}function u(){for(var e,t=Di.length;t;){if(t--,e=Di[t].charCodeAt(0),57==e)return Di[t]="A",Di.join("");if(90!=e)return Di[t]=String.fromCharCode(e+1),Di.join("");Di[t]="0"}return Di.unshift("0"),Di.join("")}function c(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function h(e){var t=e.$$hashKey;return o(arguments,function(t){t!==e&&o(t,function(t,i){e[i]=t})}),c(e,t),e}function d(e){return parseInt(e,10)}function p(e,t){return h(new(h(function(){},{prototype:e})),t)}function f(){}function m(e){return e}function g(e){return function(){return e}}function y(e){return"undefined"==typeof e}function v(e){return"undefined"!=typeof e}function E(e){return null!=e&&"object"==typeof e}function T(e){return"string"==typeof e}function b(e){return"number"==typeof e}function C(e){return"[object Date]"===Si.call(e)}function O(e){return"function"==typeof e}function x(e){return"[object RegExp]"===Si.call(e)}function w(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function R(e){return e&&e.$evalAsync&&e.$watch}function L(e){return"[object File]"===Si.call(e)}function S(e){return"[object Blob]"===Si.call(e)}function _(e){return e&&O(e.then)}function I(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}function D(e,t,i){var n=[];return o(e,function(e,r,o){n.push(t.call(i,e,r,o))}),n}function M(e,t){return A(e,t)!=-1}function A(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(t===e[i])return i;return-1}function N(e,t){var i=A(e,t);return i>=0&&e.splice(i,1),t}function P(e,t,i,n){if(w(e)||R(e))throw _i("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");if(t){if(e===t)throw _i("cpi","Can't copy! Source and destination are identical.");if(i=i||[],n=n||[],E(e)){var r=A(i,e);if(r!==-1)return n[r];i.push(e),n.push(t)}var s;if(Mi(e)){t.length=0;for(var a=0;a<e.length;a++)s=P(e[a],null,i,n),E(e[a])&&(i.push(e[a]),n.push(s)),t.push(s)}else{var l=t.$$hashKey;Mi(t)?t.length=0:o(t,function(e,i){delete t[i]});for(var u in e)s=P(e[u],null,i,n),E(e[u])&&(i.push(e[u]),n.push(s)),t[u]=s;c(t,l)}}else t=e,e&&(Mi(e)?t=P(e,[],i,n):C(e)?t=new Date(e.getTime()):x(e)?(t=new RegExp(e.source,e.toString().match(/[^\/]*$/)[0]),t.lastIndex=e.lastIndex):E(e)&&(t=P(e,{},i,n)));return t}function k(e,t){if(Mi(e)){t=t||[];for(var i=0;i<e.length;i++)t[i]=e[i]}else if(E(e)){t=t||{};for(var n in e)!yi.call(e,n)||"$"===n.charAt(0)&&"$"===n.charAt(1)||(t[n]=e[n])}return t||e}function H(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!==e&&t!==t)return!0;var n,r,o,s=typeof e,a=typeof t;if(s==a&&"object"==s){if(!Mi(e)){if(C(e))return!!C(t)&&(isNaN(e.getTime())&&isNaN(t.getTime())||e.getTime()===t.getTime());if(x(e)&&x(t))return e.toString()==t.toString();if(R(e)||R(t)||w(e)||w(t)||Mi(t))return!1;o={};for(r in e)if("$"!==r.charAt(0)&&!O(e[r])){if(!H(e[r],t[r]))return!1;o[r]=!0}for(r in t)if(!o.hasOwnProperty(r)&&"$"!==r.charAt(0)&&t[r]!==i&&!O(t[r]))return!1;return!0}if(!Mi(t))return!1;if((n=e.length)==t.length){for(r=0;r<n;r++)if(!H(e[r],t[r]))return!1;return!0}}return!1}function F(e,t,i){return e.concat(Ri.call(t,i))}function B(e,t){return Ri.call(e,t||0)}function K(e,t){var i=arguments.length>2?B(arguments,2):[];return!O(t)||t instanceof RegExp?t:i.length?function(){return arguments.length?t.apply(e,i.concat(Ri.call(arguments,0))):t.apply(e,i)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}function z(e,n){var r=n;return"string"==typeof e&&"$"===e.charAt(0)?r=i:w(n)?r="$WINDOW":n&&t===n?r="$DOCUMENT":R(n)&&(r="$SCOPE"),r}function U(e,t){return"undefined"==typeof e?i:JSON.stringify(e,z,t?"  ":null)}function V(e){return T(e)?JSON.parse(e):e}function G(e){if("function"==typeof e)e=!0;else if(e&&0!==e.length){var t=gi(""+e);e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}function $(e){e=Ci(e).clone();try{e.empty()}catch(t){}var i=3,n=Ci("<div>").append(e).html();try{return e[0].nodeType===i?gi(n):n.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(e,t){return"<"+gi(t)})}catch(t){return gi(n)}}function W(e){try{return decodeURIComponent(e)}catch(t){}}function j(e){var t,i,n={};return o((e||"").split("&"),function(e){if(e&&(t=e.replace(/\+/g,"%20").split("="),i=W(t[0]),v(i))){var r=!v(t[1])||W(t[1]);yi.call(n,i)?Mi(n[i])?n[i].push(r):n[i]=[n[i],r]:n[i]=r}}),n}function X(e){var t=[];return o(e,function(e,i){Mi(e)?o(e,function(e){t.push(Z(i,!0)+(e===!0?"":"="+Z(e,!0)))}):t.push(Z(i,!0)+(e===!0?"":"="+Z(e,!0)))}),t.length?t.join("&"):""}function q(e){return Z(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function Z(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function Y(e,i){function n(e){e&&a.push(e)}var r,s,a=[e],l=["ng:app","ng-app","x-ng-app","data-ng-app"],u=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;o(l,function(i){l[i]=!0,n(t.getElementById(i)),i=i.replace(":","\\:"),e.querySelectorAll&&(o(e.querySelectorAll("."+i),n),o(e.querySelectorAll("."+i+"\\:"),n),o(e.querySelectorAll("["+i+"]"),n))}),o(a,function(e){if(!r){var t=" "+e.className+" ",i=u.exec(t);i?(r=e,s=(i[2]||"").replace(/\s+/g,",")):o(e.attributes,function(t){!r&&l[t.name]&&(r=e,s=t.value)})}}),r&&i(r,s?[s]:[])}function J(i,n){var r=function(){if(i=Ci(i),i.injector()){var e=i[0]===t?"document":$(i);throw _i("btstrpd","App Already Bootstrapped with this Element '{0}'",e.replace(/</,"&lt;").replace(/>/,"&gt;"))}n=n||[],n.unshift(["$provide",function(e){e.value("$rootElement",i)}]),n.unshift("ng");var r=Ae(n);return r.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(e,t,i,n,r){e.$apply(function(){t.data("$injector",n),i(t)(e)})}]),r},s=/^NG_DEFER_BOOTSTRAP!/;return e&&!s.test(e.name)?r():(e.name=e.name.replace(s,""),void(Ii.resumeBootstrap=function(e){o(e,function(e){n.push(e)}),r()}))}function Q(e,t){return t=t||"_",e.replace(Pi,function(e,i){return(i?t:"")+e.toLowerCase()})}function ee(){Oi=e.jQuery,Oi&&Oi.fn.on?(Ci=Oi,h(Oi.fn,{scope:qi.scope,isolateScope:qi.isolateScope,controller:qi.controller,injector:qi.injector,inheritedData:qi.inheritedData}),ce("remove",!0,!0,!1),ce("empty",!1,!1,!1),ce("html",!1,!1,!0)):Ci=fe,Ii.element=Ci}function te(e,t,i){if(!e)throw _i("areq","Argument '{0}' is {1}",t||"?",i||"required");return e}function ie(e,t,i){return i&&Mi(e)&&(e=e[e.length-1]),te(O(e),t,"not a function, got "+(e&&"object"==typeof e?e.constructor.name||"Object":typeof e)),e}function ne(e,t){if("hasOwnProperty"===e)throw _i("badname","hasOwnProperty is not a valid {0} name",t)}function re(e,t,i){if(!t)return e;for(var n,r=t.split("."),o=e,s=r.length,a=0;a<s;a++)n=r[a],e&&(e=(o=e)[n]);return!i&&O(e)?K(o,e):e}function oe(e){var t=e[0],i=e[e.length-1];if(t===i)return Ci(t);var n=t,r=[n];do{if(n=n.nextSibling,!n)break;r.push(n)}while(n!==i);return Ci(r)}function se(e){function t(e,t,i){return e[t]||(e[t]=i())}var i=n("$injector"),r=n("ng"),o=t(e,"angular",Object);return o.$$minErr=o.$$minErr||n,t(o,"module",function(){var e={};return function(n,o,s){var a=function(e,t){if("hasOwnProperty"===e)throw r("badname","hasOwnProperty is not a valid {0} name",t)};return a(n,"module"),o&&e.hasOwnProperty(n)&&(e[n]=null),t(e,n,function(){function e(e,i,n){return function(){return t[n||"push"]([e,i,arguments]),l}}if(!o)throw i("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",n);var t=[],r=[],a=e("$injector","invoke"),l={_invokeQueue:t,_runBlocks:r,requires:o,name:n,provider:e("$provide","provider"),factory:e("$provide","factory"),service:e("$provide","service"),value:e("$provide","value"),constant:e("$provide","constant","unshift"),animation:e("$animateProvider","register"),filter:e("$filterProvider","register"),controller:e("$controllerProvider","register"),directive:e("$compileProvider","directive"),config:a,run:function(e){return r.push(e),this}};return s&&a(s),l})}})}function ae(t){h(t,{bootstrap:J,copy:P,extend:h,equals:H,element:Ci,forEach:o,injector:Ae,noop:f,bind:K,toJson:U,fromJson:V,identity:m,isUndefined:y,isDefined:v,isString:T,isFunction:O,isObject:E,isNumber:b,isElement:I,isArray:Mi,version:ki,isDate:C,lowercase:gi,uppercase:vi,callbacks:{counter:0},$$minErr:n,$$csp:Ni}),xi=se(e);try{xi("ngLocale")}catch(i){xi("ngLocale",[]).provider("$locale",it)}xi("ng",["ngLocale"],["$provide",function(e){e.provider({$$sanitizeUri:Mt}),e.provider("$compile",Ke).directive({a:Nn,input:$n,textarea:$n,form:Fn,script:Lr,select:Ir,style:Mr,option:Dr,ngBind:nr,ngBindHtml:or,ngBindTemplate:rr,ngClass:sr,ngClassEven:lr,ngClassOdd:ar,ngCloak:ur,ngController:cr,ngForm:Bn,ngHide:br,ngIf:pr,ngInclude:fr,ngInit:gr,ngNonBindable:yr,ngPluralize:vr,ngRepeat:Er,ngShow:Tr,ngStyle:Cr,ngSwitch:Or,ngSwitchWhen:xr,ngSwitchDefault:wr,ngOptions:_r,ngTransclude:Rr,ngModel:Yn,ngList:er,ngChange:Jn,required:Qn,ngRequired:Qn,ngValue:ir}).directive({ngInclude:mr}).directive(Pn).directive(hr),e.provider({$anchorScroll:Ne,$animate:on,$browser:He,$cacheFactory:Fe,$controller:Ve,$document:Ge,$exceptionHandler:$e,$filter:Vt,$interpolate:et,$interval:tt,$http:Ze,$httpBackend:Je,$location:gt,$log:yt,$parse:Lt,$rootScope:Dt,$q:St,$sce:Ht,$sceDelegate:kt,$sniffer:Ft,$templateCache:Be,$timeout:Bt,$window:Ut,$$rAF:It,$$asyncCallback:Pe})}])}function le(){return++Fi}function ue(e){return e.replace(zi,function(e,t,i,n){return n?i.toUpperCase():i}).replace(Ui,"Moz$1")}function ce(e,t,i,n){function r(e){var r,s,a,l,u,c,h,d=i&&e?[this.filter(e)]:[this],p=t;if(!n||null!=e)for(;d.length;)for(r=d.shift(),s=0,a=r.length;s<a;s++)for(l=Ci(r[s]),p?l.triggerHandler("$destroy"):p=!p,u=0,c=(h=l.children()).length;u<c;u++)d.push(Oi(h[u]));return o.apply(this,arguments)}var o=Oi.fn[e];o=o.$original||o,r.$original=o,Oi.fn[e]=r}function he(e){return!$i.test(e)}function de(e,t){var i,n,r,o,s,a,l=t.createDocumentFragment(),u=[];if(he(e))u.push(t.createTextNode(e));else{for(i=l.appendChild(t.createElement("div")),n=(Wi.exec(e)||["",""])[1].toLowerCase(),r=Xi[n]||Xi._default,i.innerHTML="<div>&#160;</div>"+r[1]+e.replace(ji,"<$1></$2>")+r[2],i.removeChild(i.firstChild),o=r[0];o--;)i=i.lastChild;for(s=0,a=i.childNodes.length;s<a;++s)u.push(i.childNodes[s]);i=l.firstChild,i.textContent=""}return l.textContent="",l.innerHTML="",u}function pe(e,i){i=i||t;var n;return(n=Gi.exec(e))?[i.createElement(n[1])]:de(e,i)}function fe(e){if(e instanceof fe)return e;if(T(e)&&(e=Ai(e)),!(this instanceof fe)){if(T(e)&&"<"!=e.charAt(0))throw Vi("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new fe(e)}if(T(e)){xe(this,pe(e));var i=Ci(t.createDocumentFragment());i.append(this)}else xe(this,e)}function me(e){return e.cloneNode(!0)}function ge(e){ve(e);for(var t=0,i=e.childNodes||[];t<i.length;t++)ge(i[t])}function ye(e,t,i,n){if(v(n))throw Vi("offargs","jqLite#off() does not support the `selector` argument");var r=Ee(e,"events"),s=Ee(e,"handle");s&&(y(t)?o(r,function(t,i){Ki(e,i,t),delete r[i]}):o(t.split(" "),function(t){y(i)?(Ki(e,t,r[t]),delete r[t]):N(r[t]||[],i)}))}function ve(e,t){var n=e.ng339,r=Hi[n];if(r){if(t)return void delete Hi[n].data[t];r.handle&&(r.events.$destroy&&r.handle({},"$destroy"),ye(e)),delete Hi[n],e.ng339=i}}function Ee(e,t,i){var n=e.ng339,r=Hi[n||-1];return v(i)?(r||(e.ng339=n=le(),r=Hi[n]={}),void(r[t]=i)):r&&r[t]}function Te(e,t,i){var n=Ee(e,"data"),r=v(i),o=!r&&v(t),s=o&&!E(t);if(n||s||Ee(e,"data",n={}),r)n[t]=i;else{if(!o)return n;if(s)return n&&n[t];h(n,t)}}function be(e,t){return!!e.getAttribute&&(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1}function Ce(e,t){t&&e.setAttribute&&o(t.split(" "),function(t){e.setAttribute("class",Ai((" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+Ai(t)+" "," ")))})}function Oe(e,t){if(t&&e.setAttribute){var i=(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");o(t.split(" "),function(e){e=Ai(e),i.indexOf(" "+e+" ")===-1&&(i+=e+" ")}),e.setAttribute("class",Ai(i))}}function xe(e,t){if(t){t=t.nodeName||!v(t.length)||w(t)?[t]:t;for(var i=0;i<t.length;i++)e.push(t[i])}}function we(e,t){return Re(e,"$"+(t||"ngController")+"Controller")}function Re(e,t,n){9==e.nodeType&&(e=e.documentElement);for(var r=Mi(t)?t:[t];e;){for(var o=0,s=r.length;o<s;o++)if((n=Ci.data(e,r[o]))!==i)return n;e=e.parentNode||11===e.nodeType&&e.host}}function Le(e){for(var t=0,i=e.childNodes;t<i.length;t++)ge(i[t]);for(;e.firstChild;)e.removeChild(e.firstChild)}function Se(e,t){var i=Zi[t.toLowerCase()];return i&&Yi[e.nodeName]&&i}function _e(e,i){var n=function(n,r){if(n.preventDefault||(n.preventDefault=function(){n.returnValue=!1}),n.stopPropagation||(n.stopPropagation=function(){n.cancelBubble=!0}),n.target||(n.target=n.srcElement||t),y(n.defaultPrevented)){var s=n.preventDefault;n.preventDefault=function(){n.defaultPrevented=!0,s.call(n)},n.defaultPrevented=!1}n.isDefaultPrevented=function(){return n.defaultPrevented||n.returnValue===!1};var a=k(i[r||n.type]||[]);o(a,function(t){t.call(e,n)}),bi<=8?(n.preventDefault=null,n.stopPropagation=null,n.isDefaultPrevented=null):(delete n.preventDefault,delete n.stopPropagation,delete n.isDefaultPrevented)};return n.elem=e,n}function Ie(e,t){var n,r=typeof e;return"function"==r||"object"==r&&null!==e?"function"==typeof(n=e.$$hashKey)?n=e.$$hashKey():n===i&&(n=e.$$hashKey=(t||u)()):n=e,r+":"+n}function De(e,t){if(t){var i=0;this.nextUid=function(){return++i}}o(e,this.put,this)}function Me(e){var t,i,n,r;return"function"==typeof e?(t=e.$inject)||(t=[],e.length&&(i=e.toString().replace(tn,""),n=i.match(Ji),o(n[1].split(Qi),function(e){e.replace(en,function(e,i,n){t.push(n)})})),e.$inject=t):Mi(e)?(r=e.length-1,ie(e[r],"fn"),t=e.slice(0,r)):ie(e,"fn",!0),t}function Ae(e){function t(e){return function(t,i){return E(t)?void o(t,l(e)):e(t,i)}}function i(e,t){if(ne(e,"service"),(O(t)||Mi(t))&&(t=b.instantiate(t)),!t.$get)throw nn("pget","Provider '{0}' must define $get factory method.",e);return v[e+p]=t}function n(e,t){return i(e,{$get:t})}function r(e,t){return n(e,["$injector",function(e){return e.instantiate(t)}])}function s(e,t){return n(e,g(t))}function a(e,t){ne(e,"constant"),v[e]=t,C[e]=t}function u(e,t){var i=b.get(e+p),n=i.$get;i.$get=function(){var e=x.invoke(n,i);return x.invoke(t,null,{$delegate:e})}}function c(e){var t,i,n,r,s=[];return o(e,function(e){if(!y.get(e)){y.put(e,!0);try{if(T(e))for(t=xi(e),s=s.concat(c(t.requires)).concat(t._runBlocks),i=t._invokeQueue,n=0,r=i.length;n<r;n++){var o=i[n],a=b.get(o[0]);a[o[1]].apply(a,o[2])}else O(e)?s.push(b.invoke(e)):Mi(e)?s.push(b.invoke(e)):ie(e,"module")}catch(l){throw Mi(e)&&(e=e[e.length-1]),l.message&&l.stack&&l.stack.indexOf(l.message)==-1&&(l=l.message+"\n"+l.stack),nn("modulerr","Failed to instantiate module {0} due to:\n{1}",e,l.stack||l.message||l)}}}),s}function h(e,t){function i(i){if(e.hasOwnProperty(i)){if(e[i]===d)throw nn("cdep","Circular dependency found: {0}",i+" <- "+m.join(" <- "));return e[i]}try{return m.unshift(i),e[i]=d,e[i]=t(i)}catch(n){throw e[i]===d&&delete e[i],n}finally{m.shift()}}function n(e,t,n){var r,o,s,a=[],l=Me(e);for(o=0,r=l.length;o<r;o++){if(s=l[o],"string"!=typeof s)throw nn("itkn","Incorrect injection token! Expected service name as string, got {0}",s);a.push(n&&n.hasOwnProperty(s)?n[s]:i(s))}return Mi(e)&&(e=e[r]),e.apply(t,a)}function r(e,t){var i,r,o=function(){};return o.prototype=(Mi(e)?e[e.length-1]:e).prototype,i=new o,r=n(e,i,t),E(r)||O(r)?r:i}return{invoke:n,instantiate:r,get:i,annotate:Me,has:function(t){return v.hasOwnProperty(t+p)||e.hasOwnProperty(t)}}}var d={},p="Provider",m=[],y=new De([],(!0)),v={$provide:{provider:t(i),factory:t(n),service:t(r),value:t(s),constant:t(a),decorator:u}},b=v.$injector=h(v,function(){throw nn("unpr","Unknown provider: {0}",m.join(" <- "))}),C={},x=C.$injector=h(C,function(e){var t=b.get(e+p);return x.invoke(t.$get,t)});return o(c(e),function(e){x.invoke(e||f)}),x}function Ne(){var e=!0;this.disableAutoScrolling=function(){e=!1},this.$get=["$window","$location","$rootScope",function(t,i,n){function r(e){var t=null;return o(e,function(e){t||"a"!==gi(e.nodeName)||(t=e)}),t}function s(){var e,n=i.hash();n?(e=a.getElementById(n))?e.scrollIntoView():(e=r(a.getElementsByName(n)))?e.scrollIntoView():"top"===n&&t.scrollTo(0,0):t.scrollTo(0,0)}var a=t.document;return e&&n.$watch(function(){return i.hash()},function(){n.$evalAsync(s)}),s}]}function Pe(){this.$get=["$$rAF","$timeout",function(e,t){return e.supported?function(t){return e(t)}:function(e){return t(e,0,!1)}}]}function ke(e,t,n,r){function s(e){try{e.apply(null,B(arguments,1))}finally{if(E--,0===E)for(;b.length;)try{b.pop()()}catch(t){n.error(t)}}}function a(e){var t=e.indexOf("#");return t===-1?"":e.substr(t+1)}function l(e,t){!function i(){o(O,function(e){e()}),C=t(i,e)}()}function u(){x!=c.url()&&(x=c.url(),o(L,function(e){e(c.url())}))}var c=this,h=t[0],d=e.location,p=e.history,m=e.setTimeout,g=e.clearTimeout,v={};c.isMock=!1;var E=0,b=[];c.$$completeOutstandingRequest=s,c.$$incOutstandingRequestCount=function(){E++},c.notifyWhenNoOutstandingRequests=function(e){o(O,function(e){e()}),0===E?e():b.push(e)};var C,O=[];c.addPollFn=function(e){return y(C)&&l(100,m),O.push(e),e};var x=d.href,w=t.find("base"),R=null;c.url=function(t,i){if(d!==e.location&&(d=e.location),p!==e.history&&(p=e.history),t){if(x==t)return;var n=x&&at(x)===at(t);return x=t,!n&&r.history?i?p.replaceState(null,"",t):(p.pushState(null,"",t),w.attr("href",w.attr("href"))):(n||(R=t),i?d.replace(t):n?d.hash=a(t):d.href=t),c}return R||d.href.replace(/%27/g,"'")};var L=[],S=!1;c.onUrlChange=function(t){return S||(r.history&&Ci(e).on("popstate",u),r.hashchange?Ci(e).on("hashchange",u):c.addPollFn(u),S=!0),L.push(t),t},c.$$checkUrlChange=u,c.baseHref=function(){var e=w.attr("href");return e?e.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var _={},I="",D=c.baseHref();c.cookies=function(e,t){var r,o,s,a,l;if(!e){if(h.cookie!==I)for(I=h.cookie,o=I.split("; "),_={},a=0;a<o.length;a++)s=o[a],l=s.indexOf("="),l>0&&(e=unescape(s.substring(0,l)),_[e]===i&&(_[e]=unescape(s.substring(l+1))));return _}t===i?h.cookie=escape(e)+"=;path="+D+";expires=Thu, 01 Jan 1970 00:00:00 GMT":T(t)&&(r=(h.cookie=escape(e)+"="+escape(t)+";path="+D).length+1,r>4096&&n.warn("Cookie '"+e+"' possibly not set or overflowed because it was too large ("+r+" > 4096 bytes)!"))},c.defer=function(e,t){var i;return E++,i=m(function(){delete v[i],s(e)},t||0),v[i]=!0,i},c.defer.cancel=function(e){return!!v[e]&&(delete v[e],g(e),s(f),!0)}}function He(){this.$get=["$window","$log","$sniffer","$document",function(e,t,i,n){return new ke(e,n,t,i)}]}function Fe(){this.$get=function(){function e(e,i){function r(e){e!=d&&(p?p==e&&(p=e.n):p=e,o(e.n,e.p),o(e,d),d=e,d.n=null)}function o(e,t){e!=t&&(e&&(e.p=t),t&&(t.n=e))}if(e in t)throw n("$cacheFactory")("iid","CacheId '{0}' is already taken!",e);var s=0,a=h({},i,{id:e}),l={},u=i&&i.capacity||Number.MAX_VALUE,c={},d=null,p=null;return t[e]={put:function(e,t){if(u<Number.MAX_VALUE){var i=c[e]||(c[e]={key:e});r(i)}if(!y(t))return e in l||s++,l[e]=t,s>u&&this.remove(p.key),t},get:function(e){if(u<Number.MAX_VALUE){var t=c[e];if(!t)return;r(t)}return l[e]},remove:function(e){if(u<Number.MAX_VALUE){var t=c[e];if(!t)return;t==d&&(d=t.p),t==p&&(p=t.n),o(t.n,t.p),delete c[e]}delete l[e],s--},removeAll:function(){l={},s=0,c={},d=p=null},destroy:function(){l=null,a=null,c=null,delete t[e]},info:function(){return h({},a,{size:s})}}}var t={};return e.info=function(){var e={};return o(t,function(t,i){e[i]=t.info()}),e},e.get=function(e){return t[e]},e}}function Be(){this.$get=["$cacheFactory",function(e){return e("templates")}]}function Ke(e,n){var r={},s="Directive",a=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,u=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,c=/^(on[a-z]+|formaction)$/;this.directive=function d(t,i){return ne(t,"directive"),T(t)?(te(i,"directiveFactory"),r.hasOwnProperty(t)||(r[t]=[],e.factory(t+s,["$injector","$exceptionHandler",function(e,i){var n=[];return o(r[t],function(r,o){try{var s=e.invoke(r);O(s)?s={compile:g(s)}:!s.compile&&s.link&&(s.compile=g(s.link)),s.priority=s.priority||0,s.index=o,s.name=s.name||t,s.require=s.require||s.controller&&s.name,s.restrict=s.restrict||"A",n.push(s)}catch(a){i(a)}}),n}])),r[t].push(i)):o(t,l(d)),this},this.aHrefSanitizationWhitelist=function(e){return v(e)?(n.aHrefSanitizationWhitelist(e),this):n.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(e){return v(e)?(n.imgSrcSanitizationWhitelist(e),this):n.imgSrcSanitizationWhitelist()},this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(e,n,l,d,f,g,y,v,b,C,x,w){function R(e,t,i,n,r){e instanceof Ci||(e=Ci(e)),o(e,function(t,i){3==t.nodeType&&t.nodeValue.match(/\S+/)&&(e[i]=t=Ci(t).wrap("<span></span>").parent()[0])});var s=S(e,t,e,i,n,r);return L(e,"ng-scope"),function(t,i,n,r){te(t,"scope");var a=i?qi.clone.call(e):e;o(n,function(e,t){a.data("$"+t+"Controller",e)});for(var l=0,u=a.length;l<u;l++){var c=a[l],h=c.nodeType;1!==h&&9!==h||a.eq(l).data("$scope",t)}return i&&i(a,t),s&&s(t,a,a,r),a}}function L(e,t){try{e.addClass(t)}catch(i){}}function S(e,t,n,r,o,s){function a(e,n,r,o){var s,a,l,u,c,h,d,p,m=n.length,g=new Array(m);for(c=0;c<m;c++)g[c]=n[c];for(c=0,d=0,h=f.length;c<h;d++)l=g[d],s=f[c++],a=f[c++],s?(s.scope?(u=e.$new(),Ci.data(l,"$scope",u)):u=e,p=s.transcludeOnThisElement?_(e,s.transclude,o):!s.templateOnThisElement&&o?o:!o&&t?_(e,t):null,s(a,u,l,r,p)):a&&a(e,l.childNodes,i,o)}for(var l,u,c,h,d,p,f=[],m=0;m<e.length;m++)l=new q,u=I(e[m],[],l,0===m?r:i,o),c=u.length?A(u,e[m],l,t,n,null,[],[],s):null,c&&c.scope&&L(l.$$element,"ng-scope"),d=c&&c.terminal||!(h=e[m].childNodes)||!h.length?null:S(h,c?(c.transcludeOnThisElement||!c.templateOnThisElement)&&c.transclude:t),f.push(c,d),p=p||c||d,s=null;return p?a:null}function _(e,t,i){var n=function(n,r,o){var s=!1;n||(n=e.$new(),n.$$transcluded=!0,s=!0);var a=t(n,r,o,i);return s&&a.on("$destroy",function(){n.$destroy()}),a};return n}function I(e,t,i,n,r){var o,s,l,c=e.nodeType,h=i.$attr;switch(c){case 1:s=wi(e).toLowerCase(),P(t,ze(s),"E",n,r);for(var d,p,f,m,g,y,v=e.attributes,E=0,b=v&&v.length;E<b;E++){var C=!1,O=!1;if(d=v[E],!bi||bi>=8||d.specified){p=d.name,g=Ai(d.value),m=ze(p),(y=ee.test(m))&&(p=Q(m.substr(6),"-"));var x=m.replace(/(Start|End)$/,"");m===x+"Start"&&(C=p,O=p.substr(0,p.length-5)+"end",p=p.substr(0,p.length-6)),f=ze(p.toLowerCase()),h[f]=p,!y&&i.hasOwnProperty(f)||(i[f]=g,Se(e,f)&&(i[f]=!0)),W(e,t,g,f),P(t,f,"A",n,r,C,O)}}if("input"===s&&"hidden"===e.getAttribute("type")&&e.setAttribute("autocomplete","off"),l=e.className,T(l)&&""!==l)for(;o=u.exec(l);)f=ze(o[2]),P(t,f,"C",n,r)&&(i[f]=Ai(o[3])),l=l.substr(o.index+o[0].length);break;case 3:if(11===bi)for(;e.parentNode&&e.nextSibling&&3===e.nextSibling.nodeType;)e.nodeValue=e.nodeValue+e.nextSibling.nodeValue,e.parentNode.removeChild(e.nextSibling);V(t,e.nodeValue);break;case 8:try{o=a.exec(e.nodeValue),o&&(f=ze(o[1]),P(t,f,"M",n,r)&&(i[f]=Ai(o[2])))}catch(w){}}return t.sort(z),t}function D(e,t,i){var n=[],r=0;if(t&&e.hasAttribute&&e.hasAttribute(t)){do{if(!e)throw sn("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",t,i);1==e.nodeType&&(e.hasAttribute(t)&&r++,e.hasAttribute(i)&&r--),n.push(e),e=e.nextSibling}while(r>0)}else n.push(e);return Ci(n)}function M(e,t,i){return function(n,r,o,s,a){return r=D(r[0],t,i),e(n,r,o,s,a)}}function A(e,r,s,a,u,c,h,d,p){function f(e,t,i,n){e&&(i&&(e=M(e,i,n)),e.require=C.require,e.directiveName=x,(z===C||C.$$isolateScope)&&(e=X(e,{isolateScope:!0})),h.push(e)),t&&(i&&(t=M(t,i,n)),t.require=C.require,t.directiveName=x,(z===C||C.$$isolateScope)&&(t=X(t,{isolateScope:!0})),d.push(t))}function m(e,t,i,n){var r,s="data",a=!1;if(T(t)){for(;"^"==(r=t.charAt(0))||"?"==r;)t=t.substr(1),"^"==r&&(s="inheritedData"),a=a||"?"==r;if(r=null,n&&"data"===s&&(r=n[t]),r=r||i[s]("$"+t+"Controller"),!r&&!a)throw sn("ctreq","Controller '{0}', required by directive '{1}', can't be found!",t,e);return r}return Mi(t)&&(r=[],o(t,function(t){r.push(m(e,t,i,n))})),r}function v(e,t,a,u,c){function p(e,t){var n;return arguments.length<2&&(t=e,e=i),Y&&(n=w),c(e,t,n)}var f,v,E,T,b,C,O,x,w={};if(f=r===a?s:k(s,new q(Ci(a),s.$attr)),v=f.$$element,z){var R=/^\s*([@=&])(\??)\s*(\w*)\s*$/;O=t.$new(!0),!V||V!==z&&V!==z.$$originalDirective?v.data("$isolateScopeNoTemplate",O):v.data("$isolateScope",O),L(v,"ng-isolate-scope"),o(z.scope,function(e,i){var r,o,s,a,l=e.match(R)||[],u=l[3]||i,c="?"==l[2],h=l[1];switch(O.$$isolateBindings[i]=h+u,h){case"@":f.$observe(u,function(e){O[i]=e}),f.$$observers[u].$$scope=t,f[u]&&(O[i]=n(f[u])(t));break;case"=":if(c&&!f[u])return;o=g(f[u]),a=o.literal?H:function(e,t){return e===t||e!==e&&t!==t},s=o.assign||function(){throw r=O[i]=o(t),sn("nonassign","Expression '{0}' used with directive '{1}' is non-assignable!",f[u],z.name)},r=O[i]=o(t),O.$watch(function(){var e=o(t);return a(e,O[i])||(a(e,r)?s(t,e=O[i]):O[i]=e),r=e},null,o.literal);break;case"&":o=g(f[u]),O[i]=function(e){return o(t,e)};break;default:throw sn("iscp","Invalid isolate scope definition for directive '{0}'. Definition: {... {1}: '{2}' ...}",z.name,i,e)}})}for(x=c&&p,P&&o(P,function(e){var i,n={$scope:e===z||e.$$isolateScope?O:t,$element:v,$attrs:f,$transclude:x};C=e.controller,"@"==C&&(C=f[e.name]),i=y(C,n),w[e.name]=i,Y||v.data("$"+e.name+"Controller",i),e.controllerAs&&(n.$scope[e.controllerAs]=i)}),E=0,T=h.length;E<T;E++)try{b=h[E],b(b.isolateScope?O:t,v,f,b.require&&m(b.directiveName,b.require,v,w),x)}catch(S){l(S,$(v))}var _=t;for(z&&(z.template||null===z.templateUrl)&&(_=O),e&&e(_,a.childNodes,i,c),E=d.length-1;E>=0;E--)try{b=d[E],b(b.isolateScope?O:t,v,f,b.require&&m(b.directiveName,b.require,v,w),x);
}catch(S){l(S,$(v))}}p=p||{};for(var b,C,x,w,S,_,A=-Number.MAX_VALUE,P=p.controllerDirectives,z=p.newIsolateScopeDirective,V=p.templateDirective,G=p.nonTlbTranscludeDirective,W=!1,Z=!1,Y=p.hasElementTranscludeDirective,Q=s.$$element=Ci(r),ee=c,te=a,ie=0,ne=e.length;ie<ne;ie++){C=e[ie];var re=C.$$start,oe=C.$$end;if(re&&(Q=D(r,re,oe)),w=i,A>C.priority)break;if((_=C.scope)&&(b=b||C,C.templateUrl||(U("new/isolated scope",z,C,Q),E(_)&&(z=C))),x=C.name,!C.templateUrl&&C.controller&&(_=C.controller,P=P||{},U("'"+x+"' controller",P[x],C,Q),P[x]=C),(_=C.transclude)&&(W=!0,C.$$tlb||(U("transclusion",G,C,Q),G=C),"element"==_?(Y=!0,A=C.priority,w=Q,Q=s.$$element=Ci(t.createComment(" "+x+": "+s[x]+" ")),r=Q[0],j(u,B(w),r),te=R(w,a,A,ee&&ee.name,{nonTlbTranscludeDirective:G})):(w=Ci(me(r)).contents(),Q.empty(),te=R(w,a))),C.template)if(Z=!0,U("template",V,C,Q),V=C,_=O(C.template)?C.template(Q,s):C.template,_=J(_),C.replace){if(ee=C,w=he(_)?[]:Ci(Ai(_)),r=w[0],1!=w.length||1!==r.nodeType)throw sn("tplrt","Template for directive '{0}' must have exactly one root element. {1}",x,"");j(u,Q,r);var se={$attr:{}},ae=I(r,[],se),le=e.splice(ie+1,e.length-(ie+1));z&&N(ae),e=e.concat(ae).concat(le),F(s,se),ne=e.length}else Q.html(_);if(C.templateUrl)Z=!0,U("template",V,C,Q),V=C,C.replace&&(ee=C),v=K(e.splice(ie,e.length-ie),Q,s,u,W&&te,h,d,{controllerDirectives:P,newIsolateScopeDirective:z,templateDirective:V,nonTlbTranscludeDirective:G}),ne=e.length;else if(C.compile)try{S=C.compile(Q,s,te),O(S)?f(null,S,re,oe):S&&f(S.pre,S.post,re,oe)}catch(ue){l(ue,$(Q))}C.terminal&&(v.terminal=!0,A=Math.max(A,C.priority))}return v.scope=b&&b.scope===!0,v.transcludeOnThisElement=W,v.templateOnThisElement=Z,v.transclude=te,p.hasElementTranscludeDirective=Y,v}function N(e){for(var t=0,i=e.length;t<i;t++)e[t]=p(e[t],{$$isolateScope:!0})}function P(t,n,o,a,u,c,h){if(n===u)return null;var d=null;if(r.hasOwnProperty(n))for(var f,m=e.get(n+s),g=0,y=m.length;g<y;g++)try{f=m[g],(a===i||a>f.priority)&&f.restrict.indexOf(o)!=-1&&(c&&(f=p(f,{$$start:c,$$end:h})),t.push(f),d=f)}catch(v){l(v)}return d}function F(e,t){var i=t.$attr,n=e.$attr,r=e.$$element;o(e,function(n,r){"$"!=r.charAt(0)&&(t[r]&&t[r]!==n&&(n+=("style"===r?";":" ")+t[r]),e.$set(r,n,!0,i[r]))}),o(t,function(t,o){"class"==o?(L(r,t),e["class"]=(e["class"]?e["class"]+" ":"")+t):"style"==o?(r.attr("style",r.attr("style")+";"+t),e.style=(e.style?e.style+";":"")+t):"$"==o.charAt(0)||e.hasOwnProperty(o)||(e[o]=t,n[o]=i[o])})}function K(e,t,i,n,r,s,a,l){var u,c,p=[],m=t[0],g=e.shift(),y=h({},g,{templateUrl:null,transclude:null,replace:null,$$originalDirective:g}),v=O(g.templateUrl)?g.templateUrl(t,i):g.templateUrl;return t.empty(),d.get(C.getTrustedResourceUrl(v),{cache:f}).success(function(h){var d,f,T,b;if(h=J(h),g.replace){if(T=he(h)?[]:Ci(Ai(h)),d=T[0],1!=T.length||1!==d.nodeType)throw sn("tplrt","Template for directive '{0}' must have exactly one root element. {1}",g.name,v);f={$attr:{}},j(n,t,d);var C=I(d,[],f);E(g.scope)&&N(C),e=C.concat(e),F(i,f)}else d=m,t.html(h);for(e.unshift(y),u=A(e,d,i,r,t,g,s,a,l),o(n,function(e,i){e==d&&(n[i]=t[0])}),c=S(t[0].childNodes,r);p.length;){var O=p.shift(),x=p.shift(),w=p.shift(),R=p.shift(),D=t[0];if(x!==m){var M=x.className;l.hasElementTranscludeDirective&&g.replace||(D=me(d)),j(w,Ci(x),D),L(Ci(D),M)}b=u.transcludeOnThisElement?_(O,u.transclude,R):R,u(c,O,D,n,b)}p=null}).error(function(e,t,i,n){throw sn("tpload","Failed to load template: {0}",n.url)}),function(e,t,i,n,r){var o=r;p?(p.push(t),p.push(i),p.push(n),p.push(o)):(u.transcludeOnThisElement&&(o=_(t,u.transclude,r)),u(c,t,i,n,o))}}function z(e,t){var i=t.priority-e.priority;return 0!==i?i:e.name!==t.name?e.name<t.name?-1:1:e.index-t.index}function U(e,t,i,n){if(t)throw sn("multidir","Multiple directives [{0}, {1}] asking for {2} on: {3}",t.name,i.name,e,$(n))}function V(e,t){var i=n(t,!0);i&&e.push({priority:0,compile:function(e){var t=e.parent(),n=t.length;return n&&L(e.parent(),"ng-binding"),function(e,t){var r=t.parent(),o=r.data("$binding")||[];o.push(i),r.data("$binding",o),n||L(r,"ng-binding"),e.$watch(i,function(e){t[0].nodeValue=e})}}})}function G(e,t){if("srcdoc"==t)return C.HTML;var i=wi(e);return"xlinkHref"==t||"FORM"==i&&"action"==t||"LINK"==i&&"href"==t||"IMG"!=i&&("src"==t||"ngSrc"==t)?C.RESOURCE_URL:void 0}function W(e,t,i,r){var o=n(i,!0);if(o){if("multiple"===r&&"SELECT"===wi(e))throw sn("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",$(e));t.push({priority:100,compile:function(){return{pre:function(t,i,s){var a=s.$$observers||(s.$$observers={});if(c.test(r))throw sn("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");o=n(s[r],!0,G(e,r)),o&&(s[r]=o(t),(a[r]||(a[r]=[])).$$inter=!0,(s.$$observers&&s.$$observers[r].$$scope||t).$watch(o,function(e,t){"class"===r&&e!=t?s.$updateClass(e,t):s.$set(r,e)}))}}}})}}function j(e,i,n){var r,o,s=i[0],a=i.length,l=s.parentNode;if(e)for(r=0,o=e.length;r<o;r++)if(e[r]==s){e[r++]=n;for(var u=r,c=u+a-1,h=e.length;u<h;u++,c++)c<h?e[u]=e[c]:delete e[u];e.length-=a-1;break}l&&l.replaceChild(n,s);var d=t.createDocumentFragment();d.appendChild(s),n[Ci.expando]=s[Ci.expando];for(var p=1,f=i.length;p<f;p++){var m=i[p];Ci(m).remove(),d.appendChild(m),delete i[p]}i[0]=n,i.length=1}function X(e,t){return h(function(){return e.apply(null,arguments)},e,t)}var q=function(e,t){this.$$element=e,this.$attr=t||{}};q.prototype={$normalize:ze,$addClass:function(e){e&&e.length>0&&x.addClass(this.$$element,e)},$removeClass:function(e){e&&e.length>0&&x.removeClass(this.$$element,e)},$updateClass:function(e,t){var i=Ue(e,t),n=Ue(t,e);0===i.length?x.removeClass(this.$$element,n):0===n.length?x.addClass(this.$$element,i):x.setClass(this.$$element,i,n)},$set:function(e,t,n,r){var s,a=Se(this.$$element[0],e);a&&(this.$$element.prop(e,t),r=a),this[e]=t,r?this.$attr[e]=r:(r=this.$attr[e],r||(this.$attr[e]=r=Q(e,"-"))),s=wi(this.$$element).toUpperCase(),("A"===s&&("href"===e||"xlinkHref"===e)||"IMG"===s&&"src"===e)&&(this[e]=t=w(t,"src"===e)),n!==!1&&(null===t||t===i?this.$$element.removeAttr(r):this.$$element.attr(r,t));var u=this.$$observers;u&&o(u[e],function(e){try{e(t)}catch(i){l(i)}})},$observe:function(e,t){var i=this,n=i.$$observers||(i.$$observers={}),r=n[e]||(n[e]=[]);return r.push(t),v.$evalAsync(function(){r.$$inter||t(i[e])}),t}};var Z=n.startSymbol(),Y=n.endSymbol(),J="{{"==Z||"}}"==Y?m:function(e){return e.replace(/\{\{/g,Z).replace(/}}/g,Y)},ee=/^ngAttr[A-Z]/;return R}]}function ze(e){return ue(e.replace(an,""))}function Ue(e,t){var i="",n=e.split(/\s+/),r=t.split(/\s+/);e:for(var o=0;o<n.length;o++){for(var s=n[o],a=0;a<r.length;a++)if(s==r[a])continue e;i+=(i.length>0?" ":"")+s}return i}function Ve(){var e={},t=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(t,i){ne(t,"controller"),E(t)?h(e,t):e[t]=i},this.$get=["$injector","$window",function(i,r){return function(o,s){var a,l,u,c;if(T(o)&&(l=o.match(t),u=l[1],c=l[3],o=e.hasOwnProperty(u)?e[u]:re(s.$scope,u,!0)||re(r,u,!0),ie(o,u,!0)),a=i.instantiate(o,s),c){if(!s||"object"!=typeof s.$scope)throw n("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",u||o.name,c);s.$scope[c]=a}return a}}]}function Ge(){this.$get=["$window",function(e){return Ci(e.document)}]}function $e(){this.$get=["$log",function(e){return function(t,i){e.error.apply(e,arguments)}}]}function We(e){var t,i,n,r={};return e?(o(e.split("\n"),function(e){n=e.indexOf(":"),t=gi(Ai(e.substr(0,n))),i=Ai(e.substr(n+1)),t&&(r[t]=r[t]?r[t]+", "+i:i)}),r):r}function je(e){var t=E(e)?e:i;return function(i){return t||(t=We(e)),i?t[gi(i)]||null:t}}function Xe(e,t,i){return O(i)?i(e,t):(o(i,function(i){e=i(e,t)}),e)}function qe(e){return 200<=e&&e<300}function Ze(){var e=/^\s*(\[|\{[^\{])/,t=/[\}\]]\s*$/,n=/^\)\]\}',?\n/,r={"Content-Type":"application/json;charset=utf-8"},s=this.defaults={transformResponse:[function(i){return T(i)&&(i=i.replace(n,""),e.test(i)&&t.test(i)&&(i=V(i))),i}],transformRequest:[function(e){return!E(e)||L(e)||S(e)?e:U(e)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:k(r),put:k(r),patch:k(r)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},l=this.interceptors=[],u=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(e,t,n,r,c,d){function p(e){function t(e){var t=h({},e,{data:Xe(e.data,e.headers,r.transformResponse)});return qe(e.status)?t:c.reject(t)}function n(e){function t(e){var t;o(e,function(i,n){O(i)&&(t=i(),null!=t?e[n]=t:delete e[n])})}var i,n,r,a=s.headers,l=h({},e.headers);a=h({},a.common,a[gi(e.method)]);e:for(i in a){n=gi(i);for(r in l)if(gi(r)===n)continue e;l[i]=a[i]}return t(l),l}var r={method:"get",transformRequest:s.transformRequest,transformResponse:s.transformResponse},a=n(e);h(r,e),r.headers=a,r.method=vi(r.method);var l=function(e){a=e.headers;var i=Xe(e.data,je(a),e.transformRequest);return y(i)&&o(a,function(e,t){"content-type"===gi(t)&&delete a[t]}),y(e.withCredentials)&&!y(s.withCredentials)&&(e.withCredentials=s.withCredentials),g(e,i,a).then(t,t)},u=[l,i],d=c.when(r);for(o(w,function(e){(e.request||e.requestError)&&u.unshift(e.request,e.requestError),(e.response||e.responseError)&&u.push(e.response,e.responseError)});u.length;){var p=u.shift(),f=u.shift();d=d.then(p,f)}return d.success=function(e){return d.then(function(t){e(t.data,t.status,t.headers,r)}),d},d.error=function(e){return d.then(null,function(t){e(t.data,t.status,t.headers,r)}),d},d}function f(e){o(arguments,function(e){p[e]=function(t,i){return p(h(i||{},{method:e,url:t}))}})}function m(e){o(arguments,function(e){p[e]=function(t,i,n){return p(h(n||{},{method:e,url:t,data:i}))}})}function g(n,o,a){function l(e,t,i,n){d&&(qe(e)?d.put(T,[e,t,We(i),n]):d.remove(T)),u(t,e,i,n),r.$$phase||r.$apply()}function u(e,t,i,r){t=Math.max(t,0),(qe(t)?m.resolve:m.reject)({data:e,status:t,headers:je(i),config:n,statusText:r})}function h(){var e=A(p.pendingRequests,n);e!==-1&&p.pendingRequests.splice(e,1)}var d,f,m=c.defer(),g=m.promise,T=b(n.url,n.params);if(p.pendingRequests.push(n),g.then(h,h),!n.cache&&!s.cache||n.cache===!1||"GET"!==n.method&&"JSONP"!==n.method||(d=E(n.cache)?n.cache:E(s.cache)?s.cache:x),d)if(f=d.get(T),v(f)){if(_(f))return f.then(h,h),f;Mi(f)?u(f[1],f[0],k(f[2]),f[3]):u(f,200,{},"OK")}else d.put(T,g);if(y(f)){var C=zt(n.url)?t.cookies()[n.xsrfCookieName||s.xsrfCookieName]:i;C&&(a[n.xsrfHeaderName||s.xsrfHeaderName]=C),e(n.method,T,o,l,a,n.timeout,n.withCredentials,n.responseType)}return g}function b(e,t){if(!t)return e;var i=[];return a(t,function(e,t){null===e||y(e)||(Mi(e)||(e=[e]),o(e,function(e){E(e)&&(e=C(e)?e.toISOString():U(e)),i.push(Z(t)+"="+Z(e))}))}),i.length>0&&(e+=(e.indexOf("?")==-1?"?":"&")+i.join("&")),e}var x=n("$http"),w=[];return o(l,function(e){w.unshift(T(e)?d.get(e):d.invoke(e))}),o(u,function(e,t){var i=T(e)?d.get(e):d.invoke(e);w.splice(t,0,{response:function(e){return i(c.when(e))},responseError:function(e){return i(c.reject(e))}})}),p.pendingRequests=[],f("get","delete","head","jsonp"),m("post","put","patch"),p.defaults=s,p}]}function Ye(t){if(bi<=8&&(!t.match(/^(get|post|head|put|delete|options)$/i)||!e.XMLHttpRequest))return new e.ActiveXObject("Microsoft.XMLHTTP");if(e.XMLHttpRequest)return new e.XMLHttpRequest;throw n("$httpBackend")("noxhr","This browser does not support XMLHttpRequest.")}function Je(){this.$get=["$browser","$window","$document",function(e,t,i){return Qe(e,Ye,e.defer,t.angular.callbacks,i[0])}]}function Qe(e,t,i,n,r){function s(e,t,i){var o=r.createElement("script"),s=null;return o.type="text/javascript",o.src=e,o.async=!0,s=function(e){Ki(o,"load",s),Ki(o,"error",s),r.body.removeChild(o),o=null;var a=-1,l="unknown";e&&("load"!==e.type||n[t].called||(e={type:"error"}),l=e.type,a="error"===e.type?404:200),i&&i(a,l)},Bi(o,"load",s),Bi(o,"error",s),bi<=8&&(o.onreadystatechange=function(){T(o.readyState)&&/loaded|complete/.test(o.readyState)&&(o.onreadystatechange=null,s({type:"load"}))}),r.body.appendChild(o),s}var a=-1;return function(r,l,u,c,h,d,p,m){function g(){E=a,b&&b(),C&&C.abort()}function y(t,n,r,o,s){x&&i.cancel(x),b=C=null,0===n&&(n=r?200:"file"==Kt(l).protocol?404:0),n=1223===n?204:n,s=s||"",t(n,r,o,s),e.$$completeOutstandingRequest(f)}var E;if(e.$$incOutstandingRequestCount(),l=l||e.url(),"jsonp"==gi(r)){var T="_"+(n.counter++).toString(36);n[T]=function(e){n[T].data=e,n[T].called=!0};var b=s(l.replace("JSON_CALLBACK","angular.callbacks."+T),T,function(e,t){y(c,e,n[T].data,"",t),n[T]=f})}else{var C=t(r);if(C.open(r,l,!0),o(h,function(e,t){v(e)&&C.setRequestHeader(t,e)}),C.onreadystatechange=function(){if(C&&4==C.readyState){var e=null,t=null,i="";E!==a&&(e=C.getAllResponseHeaders(),t="response"in C?C.response:C.responseText),E===a&&bi<10||(i=C.statusText),y(c,E||C.status,t,e,i)}},p&&(C.withCredentials=!0),m)try{C.responseType=m}catch(O){if("json"!==m)throw O}C.send(u||null)}if(d>0)var x=i(g,d);else _(d)&&d.then(g)}}function et(){var e="{{",t="}}";this.startSymbol=function(t){return t?(e=t,this):e},this.endSymbol=function(e){return e?(t=e,this):t},this.$get=["$parse","$exceptionHandler","$sce",function(i,n,r){function o(o,l,u){for(var c,h,d,p,f=0,m=[],g=o.length,y=!1,v=[];f<g;)(c=o.indexOf(e,f))!=-1&&(h=o.indexOf(t,c+s))!=-1?(f!=c&&m.push(o.substring(f,c)),m.push(d=i(p=o.substring(c+s,h))),d.exp=p,f=h+a,y=!0):(f!=g&&m.push(o.substring(f)),f=g);if((g=m.length)||(m.push(""),g=1),u&&m.length>1)throw ln("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",o);if(!l||y)return v.length=g,d=function(e){try{for(var t,i=0,s=g;i<s;i++){if("function"==typeof(t=m[i]))if(t=t(e),t=u?r.getTrusted(u,t):r.valueOf(t),null==t)t="";else switch(typeof t){case"string":break;case"number":t=""+t;break;default:t=U(t)}v[i]=t}return v.join("")}catch(a){var l=ln("interr","Can't interpolate: {0}\n{1}",o,a.toString());n(l)}},d.exp=o,d.parts=m,d}var s=e.length,a=t.length;return o.startSymbol=function(){return e},o.endSymbol=function(){return t},o}]}function tt(){this.$get=["$rootScope","$window","$q",function(e,t,i){function n(n,o,s,a){var l=t.setInterval,u=t.clearInterval,c=i.defer(),h=c.promise,d=0,p=v(a)&&!a;return s=v(s)?s:0,h.then(null,null,n),h.$$intervalId=l(function(){c.notify(d++),s>0&&d>=s&&(c.resolve(d),u(h.$$intervalId),delete r[h.$$intervalId]),p||e.$apply()},o),r[h.$$intervalId]=c,h}var r={};return n.cancel=function(e){return!!(e&&e.$$intervalId in r)&&(r[e.$$intervalId].reject("canceled"),t.clearInterval(e.$$intervalId),delete r[e.$$intervalId],!0)},n}]}function it(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(e){return 1===e?"one":"other"}}}}function nt(e){for(var t=e.split("/"),i=t.length;i--;)t[i]=q(t[i]);return t.join("/")}function rt(e,t,i){var n=Kt(e,i);t.$$protocol=n.protocol,t.$$host=n.hostname,t.$$port=d(n.port)||cn[n.protocol]||null}function ot(e,t,i){var n="/"!==e.charAt(0);n&&(e="/"+e);var r=Kt(e,i);t.$$path=decodeURIComponent(n&&"/"===r.pathname.charAt(0)?r.pathname.substring(1):r.pathname),t.$$search=j(r.search),t.$$hash=decodeURIComponent(r.hash),t.$$path&&"/"!=t.$$path.charAt(0)&&(t.$$path="/"+t.$$path)}function st(e,t){if(0===t.indexOf(e))return t.substr(e.length)}function at(e){var t=e.indexOf("#");return t==-1?e:e.substr(0,t)}function lt(e){return e.replace(/(#.+)|#$/,"$1")}function ut(e){return e.substr(0,at(e).lastIndexOf("/")+1)}function ct(e){return e.substring(0,e.indexOf("/",e.indexOf("//")+2))}function ht(e,t){this.$$html5=!0,t=t||"";var n=ut(e);rt(e,this,e),this.$$parse=function(t){var i=st(n,t);if(!T(i))throw hn("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',t,n);ot(i,this,e),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var e=X(this.$$search),t=this.$$hash?"#"+q(this.$$hash):"";this.$$url=nt(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=n+this.$$url.substr(1)},this.$$parseLinkUrl=function(r,o){var s,a,l;return(s=st(e,r))!==i?(a=s,l=(s=st(t,s))!==i?n+(st("/",s)||s):e+a):(s=st(n,r))!==i?l=n+s:n==r+"/"&&(l=n),l&&this.$$parse(l),!!l}}function dt(e,t){var i=ut(e);rt(e,this,e),this.$$parse=function(n){function r(e,t,i){var n,r=/^\/[A-Z]:(\/.*)/;return 0===t.indexOf(i)&&(t=t.replace(i,"")),r.exec(t)?e:(n=r.exec(e),n?n[1]:e)}var o=st(e,n)||st(i,n),s="#"==o.charAt(0)?st(t,o):this.$$html5?o:"";if(!T(s))throw hn("ihshprfx",'Invalid url "{0}", missing hash prefix "{1}".',n,t);ot(s,this,e),this.$$path=r(this.$$path,s,e),this.$$compose()},this.$$compose=function(){var i=X(this.$$search),n=this.$$hash?"#"+q(this.$$hash):"";this.$$url=nt(this.$$path)+(i?"?"+i:"")+n,this.$$absUrl=e+(this.$$url?t+this.$$url:"")},this.$$parseLinkUrl=function(t,i){return at(e)==at(t)&&(this.$$parse(t),!0)}}function pt(e,t){this.$$html5=!0,dt.apply(this,arguments);var i=ut(e);this.$$parseLinkUrl=function(n,r){var o,s;return e==at(n)?o=n:(s=st(i,n))?o=e+t+s:i===n+"/"&&(o=i),o&&this.$$parse(o),!!o},this.$$compose=function(){var i=X(this.$$search),n=this.$$hash?"#"+q(this.$$hash):"";this.$$url=nt(this.$$path)+(i?"?"+i:"")+n,this.$$absUrl=e+t+this.$$url}}function ft(e){return function(){return this[e]}}function mt(e,t){return function(i){return y(i)?this[e]:(this[e]=t(i),this.$$compose(),this)}}function gt(){var t="",i=!1;this.hashPrefix=function(e){return v(e)?(t=e,this):t},this.html5Mode=function(e){return v(e)?(i=e,this):i},this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(n,r,o,s){function a(e){n.$broadcast("$locationChangeSuccess",l.absUrl(),e)}var l,u,c,h=r.baseHref(),d=r.url();i?(c=ct(d)+(h||"/"),u=o.history?ht:pt):(c=at(d),u=dt),l=new u(c,"#"+t),l.$$parseLinkUrl(d,d);var p=/^\s*(javascript|mailto):/i;s.on("click",function(t){if(!t.ctrlKey&&!t.metaKey&&2!=t.which){for(var i=Ci(t.target);"a"!==gi(i[0].nodeName);)if(i[0]===s[0]||!(i=i.parent())[0])return;var o=i.prop("href"),a=i.attr("href")||i.attr("xlink:href");E(o)&&"[object SVGAnimatedString]"===o.toString()&&(o=Kt(o.animVal).href),p.test(o)||!o||i.attr("target")||t.isDefaultPrevented()||l.$$parseLinkUrl(o,a)&&(t.preventDefault(),l.absUrl()!=r.url()&&(n.$apply(),e.angular["ff-684208-preventDefault"]=!0))}}),l.absUrl()!=d&&r.url(l.absUrl(),!0),r.onUrlChange(function(e){l.absUrl()!=e&&(n.$evalAsync(function(){var t=l.absUrl();l.$$parse(e),n.$broadcast("$locationChangeStart",e,t).defaultPrevented?(l.$$parse(t),r.url(t)):a(t)}),n.$$phase||n.$digest())});var f=0;return n.$watch(function(){var e=lt(r.url()),t=lt(l.absUrl()),i=l.$$replace;return f&&e==t||(f++,n.$evalAsync(function(){n.$broadcast("$locationChangeStart",l.absUrl(),e).defaultPrevented?l.$$parse(e):(r.url(l.absUrl(),i),a(e))})),l.$$replace=!1,f}),l}]}function yt(){var e=!0,t=this;this.debugEnabled=function(t){return v(t)?(e=t,this):e},this.$get=["$window",function(i){function n(e){return e instanceof Error&&(e.stack?e=e.message&&e.stack.indexOf(e.message)===-1?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function r(e){var t=i.console||{},r=t[e]||t.log||f,s=!1;try{s=!!r.apply}catch(a){}return s?function(){var e=[];return o(arguments,function(t){e.push(n(t))}),r.apply(t,e)}:function(e,t){r(e,null==t?"":t)}}return{log:r("log"),info:r("info"),warn:r("warn"),error:r("error"),debug:function(){var i=r("debug");return function(){e&&i.apply(t,arguments)}}()}}]}function vt(e,t){if("__defineGetter__"===e||"__defineSetter__"===e||"__lookupGetter__"===e||"__lookupSetter__"===e||"__proto__"===e)throw pn("isecfld","Attempting to access a disallowed field in Angular expressions! Expression: {0}",t);return e}function Et(e,t){if(e+="",!T(e))throw pn("iseccst","Cannot convert object to primitive value! Expression: {0}",t);return e}function Tt(e,t){if(e){if(e.constructor===e)throw pn("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e.document&&e.location&&e.alert&&e.setInterval)throw pn("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",t);if(e.children&&(e.nodeName||e.prop&&e.attr&&e.find))throw pn("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",t);if(e===Object)throw pn("isecobj","Referencing Object in Angular expressions is disallowed! Expression: {0}",t)}return e}function bt(e,t){if(e){if(e.constructor===e)throw pn("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e===mn||e===gn||yn&&e===yn)throw pn("isecff","Referencing call, apply or bind in Angular expressions is disallowed! Expression: {0}",t)}}function Ct(e,t,n,r,o){Tt(e,r),o=o||{};for(var s,a=t.split("."),l=0;a.length>1;l++){s=vt(a.shift(),r);var u=Tt(e[s],r);u||(u={},e[s]=u),e=u,e.then&&o.unwrapPromises&&(dn(r),"$$v"in e||!function(e){e.then(function(t){e.$$v=t})}(e),e.$$v===i&&(e.$$v={}),e=e.$$v)}return s=vt(a.shift(),r),Tt(e[s],r),e[s]=n,n}function Ot(e){return"constructor"==e}function xt(e,t,n,r,o,s,a){vt(e,s),vt(t,s),vt(n,s),vt(r,s),vt(o,s);var l=function(e){return Tt(e,s)},u=a.expensiveChecks,c=u||Ot(e)?l:m,h=u||Ot(t)?l:m,d=u||Ot(n)?l:m,p=u||Ot(r)?l:m,f=u||Ot(o)?l:m;return a.unwrapPromises?function(a,l){var u,m=l&&l.hasOwnProperty(e)?l:a;return null==m?m:(m=c(m[e]),m&&m.then&&(dn(s),"$$v"in m||(u=m,u.$$v=i,u.then(function(e){u.$$v=c(e)})),m=c(m.$$v)),t?null==m?i:(m=h(m[t]),m&&m.then&&(dn(s),"$$v"in m||(u=m,u.$$v=i,u.then(function(e){u.$$v=h(e)})),m=h(m.$$v)),n?null==m?i:(m=d(m[n]),m&&m.then&&(dn(s),"$$v"in m||(u=m,u.$$v=i,u.then(function(e){u.$$v=d(e)})),m=d(m.$$v)),r?null==m?i:(m=p(m[r]),m&&m.then&&(dn(s),"$$v"in m||(u=m,u.$$v=i,u.then(function(e){u.$$v=p(e)})),m=p(m.$$v)),o?null==m?i:(m=f(m[o]),m&&m.then&&(dn(s),"$$v"in m||(u=m,u.$$v=i,u.then(function(e){u.$$v=f(e)})),m=f(m.$$v)),m):m):m):m):m)}:function(s,a){var l=a&&a.hasOwnProperty(e)?a:s;return null==l?l:(l=c(l[e]),t?null==l?i:(l=h(l[t]),n?null==l?i:(l=d(l[n]),r?null==l?i:(l=p(l[r]),o?null==l?i:l=f(l[o]):l):l):l):l)}}function wt(e,t){return function(i,n){return e(i,n,dn,Tt,t)}}function Rt(e,t,n){var r=t.expensiveChecks,s=r?On:Cn;if(s.hasOwnProperty(e))return s[e];var a,l=e.split("."),u=l.length;if(t.csp)a=u<6?xt(l[0],l[1],l[2],l[3],l[4],n,t):function(e,r){var o,s=0;do o=xt(l[s++],l[s++],l[s++],l[s++],l[s++],n,t)(e,r),r=i,e=o;while(s<u);return o};else{var c="var p;\n";r&&(c+="s = eso(s, fe);\nl = eso(l, fe);\n");var h=r;o(l,function(e,i){vt(e,n);var o=(i?"s":'((l&&l.hasOwnProperty("'+e+'"))?l:s)')+'["'+e+'"]',s=r||Ot(e);s&&(o="eso("+o+", fe)",h=!0),c+="if(s == null) return undefined;\ns="+o+";\n",t.unwrapPromises&&(c+='if (s && s.then) {\n pw("'+n.replace(/(["\r\n])/g,"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v='+(s?"eso(v)":"v")+";});\n}\n s="+(s?"eso(s.$$v)":"s.$$v")+"\n}\n")}),c+="return s;";var d=new Function("s","l","pw","eso","fe",c);d.toString=g(c),(h||t.unwrapPromises)&&(d=wt(d,n)),a=d}return"hasOwnProperty"!==e&&(s[e]=a),a}function Lt(){var e={},t={},i={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0,expensiveChecks:!1};this.unwrapPromises=function(e){return v(e)?(i.unwrapPromises=!!e,this):i.unwrapPromises},this.logPromiseWarnings=function(e){return v(e)?(i.logPromiseWarnings=e,this):i.logPromiseWarnings},this.$get=["$filter","$sniffer","$log",function(n,r,o){i.csp=r.csp;var s={csp:i.csp,unwrapPromises:i.unwrapPromises,logPromiseWarnings:i.logPromiseWarnings,expensiveChecks:!0};return dn=function(e){i.logPromiseWarnings&&!fn.hasOwnProperty(e)&&(fn[e]=!0,o.warn("[$parse] Promise found in the expression `"+e+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))},function(r,o){var a;switch(typeof r){case"string":var l=o?t:e;if(l.hasOwnProperty(r))return l[r];var u=o?s:i,c=new Tn(u),h=new bn(c,n,u);return a=h.parse(r),"hasOwnProperty"!==r&&(l[r]=a),a;case"function":return r;default:return f}}}]}function St(){this.$get=["$rootScope","$exceptionHandler",function(e,t){return _t(function(t){e.$evalAsync(t)},t)}]}function _t(e,t){function n(e){return e}function r(e){return u(e)}function s(e){var t=a(),i=0,n=Mi(e)?[]:{};return o(e,function(e,r){i++,l(e).then(function(e){n.hasOwnProperty(r)||(n[r]=e,--i||t.resolve(n))},function(e){n.hasOwnProperty(r)||t.reject(e)})}),0===i&&t.resolve(n),t.promise}var a=function(){var o,s,u=[];return s={resolve:function(t){if(u){var n=u;u=i,o=l(t),n.length&&e(function(){for(var e,t=0,i=n.length;t<i;t++)e=n[t],o.then(e[0],e[1],e[2])})}},reject:function(e){s.resolve(c(e))},notify:function(t){if(u){var i=u;u.length&&e(function(){for(var e,n=0,r=i.length;n<r;n++)e=i[n],e[2](t)})}},promise:{then:function(e,i,s){var l=a(),c=function(i){try{l.resolve((O(e)?e:n)(i))}catch(r){l.reject(r),t(r)}},h=function(e){try{l.resolve((O(i)?i:r)(e))}catch(n){l.reject(n),t(n)}},d=function(e){try{l.notify((O(s)?s:n)(e))}catch(i){t(i)}};return u?u.push([c,h,d]):o.then(c,h,d),l.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var i=a();return t?i.resolve(e):i.reject(e),i.promise}function i(i,r){var o=null;try{o=(e||n)()}catch(s){return t(s,!1)}return _(o)?o.then(function(){return t(i,r)},function(e){return t(e,!1)}):t(i,r)}return this.then(function(e){return i(e,!0)},function(e){return i(e,!1)})}}}},l=function(t){return _(t)?t:{then:function(i){var n=a();return e(function(){n.resolve(i(t))}),n.promise}}},u=function(e){var t=a();return t.reject(e),t.promise},c=function(i){return{then:function(n,o){var s=a();return e(function(){try{s.resolve((O(o)?o:r)(i))}catch(e){s.reject(e),t(e)}}),s.promise}}},h=function(i,o,s,c){var h,d=a(),p=function(e){try{return(O(o)?o:n)(e)}catch(i){return t(i),u(i)}},f=function(e){try{return(O(s)?s:r)(e)}catch(i){return t(i),u(i)}},m=function(e){try{return(O(c)?c:n)(e)}catch(i){t(i)}};return e(function(){l(i).then(function(e){h||(h=!0,d.resolve(l(e).then(p,f,m)))},function(e){h||(h=!0,d.resolve(f(e)))},function(e){h||d.notify(m(e))})}),d.promise};return{defer:a,reject:u,when:h,all:s}}function It(){this.$get=["$window","$timeout",function(e,t){var i=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame,n=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelRequestAnimationFrame,r=!!i,o=r?function(e){var t=i(e);return function(){n(t)}}:function(e){var i=t(e,16.66,!1);return function(){t.cancel(i)}};return o.supported=r,o}]}function Dt(){var e=10,t=n("$rootScope"),i=null;this.digestTtl=function(t){return arguments.length&&(e=t),e},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(n,s,a,l){function c(){this.$id=u(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this["this"]=this.$root=this,this.$$destroyed=!1,this.$$asyncQueue=[],this.$$postDigestQueue=[],this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings={}}function h(e){if(y.$$phase)throw t("inprog","{0} already in progress",y.$$phase);y.$$phase=e}function d(){y.$$phase=null}function p(e,t){var i=a(e);return ie(i,t),i}function m(e,t,i){do e.$$listenerCount[i]-=t,0===e.$$listenerCount[i]&&delete e.$$listenerCount[i];while(e=e.$parent)}function g(){}c.prototype={constructor:c,$new:function(e){var t;return e?(t=new c,t.$root=this.$root,t.$$asyncQueue=this.$$asyncQueue,t.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$id=u(),this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),t=new this.$$childScopeClass),t["this"]=t,t.$parent=this,t.$$prevSibling=this.$$childTail,this.$$childHead?(this.$$childTail.$$nextSibling=t,this.$$childTail=t):this.$$childHead=this.$$childTail=t,t},$watch:function(e,t,n){var r=this,o=p(e,"watch"),s=r.$$watchers,a={fn:t,last:g,get:o,exp:e,eq:!!n};if(i=null,!O(t)){var l=p(t||f,"listener");a.fn=function(e,t,i){l(i)}}if("string"==typeof e&&o.constant){var u=a.fn;a.fn=function(e,t,i){u.call(this,e,t,i),N(s,a)}}return s||(s=r.$$watchers=[]),s.unshift(a),function(){N(s,a),i=null}},$watchCollection:function(e,t){function i(){o=d(u);var e,t,i;if(E(o))if(r(o)){s!==p&&(s=p,g=s.length=0,h++),e=o.length,g!==e&&(h++,s.length=g=e);for(var n=0;n<e;n++)i=s[n]!==s[n]&&o[n]!==o[n],i||s[n]===o[n]||(h++,s[n]=o[n])}else{s!==f&&(s=f={},g=0,h++),e=0;for(t in o)o.hasOwnProperty(t)&&(e++,s.hasOwnProperty(t)?(i=s[t]!==s[t]&&o[t]!==o[t],i||s[t]===o[t]||(h++,s[t]=o[t])):(g++,s[t]=o[t],h++));if(g>e){h++;for(t in s)s.hasOwnProperty(t)&&!o.hasOwnProperty(t)&&(g--,delete s[t])}}else s!==o&&(s=o,h++);return h}function n(){if(m?(m=!1,t(o,o,u)):t(o,l,u),c)if(E(o))if(r(o)){l=new Array(o.length);for(var e=0;e<o.length;e++)l[e]=o[e]}else{l={};for(var i in o)yi.call(o,i)&&(l[i]=o[i])}else l=o}var o,s,l,u=this,c=t.length>1,h=0,d=a(e),p=[],f={},m=!0,g=0;return this.$watch(i,n)},$digest:function(){var n,r,o,a,u,c,p,f,m,y,v,E=this.$$asyncQueue,T=this.$$postDigestQueue,b=e,C=this,x=[];h("$digest"),l.$$checkUrlChange(),i=null;do{for(c=!1,f=C;E.length;){try{v=E.shift(),v.scope.$eval(v.expression)}catch(w){d(),s(w)}i=null}e:do{if(a=f.$$watchers)for(u=a.length;u--;)try{if(n=a[u])if((r=n.get(f))===(o=n.last)||(n.eq?H(r,o):"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))){if(n===i){c=!1;break e}}else c=!0,i=n,n.last=n.eq?P(r,null):r,n.fn(r,o===g?r:o,f),b<5&&(m=4-b,x[m]||(x[m]=[]),y=O(n.exp)?"fn: "+(n.exp.name||n.exp.toString()):n.exp,y+="; newVal: "+U(r)+"; oldVal: "+U(o),x[m].push(y))}catch(w){d(),s(w)}if(!(p=f.$$childHead||f!==C&&f.$$nextSibling))for(;f!==C&&!(p=f.$$nextSibling);)f=f.$parent}while(f=p);if((c||E.length)&&!b--)throw d(),t("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",e,U(x))}while(c||E.length);for(d();T.length;)try{T.shift()()}catch(w){s(w)}},$destroy:function(){if(!this.$$destroyed){var e=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,this!==y&&(o(this.$$listenerCount,K(null,m,this)),e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=f,this.$on=this.$watch=function(){return f})}},$eval:function(e,t){return a(e)(this,t)},$evalAsync:function(e){y.$$phase||y.$$asyncQueue.length||l.defer(function(){y.$$asyncQueue.length&&y.$digest()}),this.$$asyncQueue.push({scope:this,expression:e})},$$postDigest:function(e){this.$$postDigestQueue.push(e)},$apply:function(e){try{return h("$apply"),this.$eval(e)}catch(t){s(t)}finally{d();try{y.$digest()}catch(t){throw s(t),t}}},$on:function(e,t){var i=this.$$listeners[e];i||(this.$$listeners[e]=i=[]),i.push(t);var n=this;do n.$$listenerCount[e]||(n.$$listenerCount[e]=0),n.$$listenerCount[e]++;while(n=n.$parent);var r=this;
return function(){var n=A(i,t);n!==-1&&(i[n]=null,m(r,1,e))}},$emit:function(e,t){var i,n,r,o=[],a=this,l=!1,u={name:e,targetScope:a,stopPropagation:function(){l=!0},preventDefault:function(){u.defaultPrevented=!0},defaultPrevented:!1},c=F([u],arguments,1);do{for(i=a.$$listeners[e]||o,u.currentScope=a,n=0,r=i.length;n<r;n++)if(i[n])try{i[n].apply(null,c)}catch(h){s(h)}else i.splice(n,1),n--,r--;if(l)return u;a=a.$parent}while(a);return u},$broadcast:function(e,t){for(var i,n,r,o=this,a=o,l=o,u={name:e,targetScope:o,preventDefault:function(){u.defaultPrevented=!0},defaultPrevented:!1},c=F([u],arguments,1);a=l;){for(u.currentScope=a,i=a.$$listeners[e]||[],n=0,r=i.length;n<r;n++)if(i[n])try{i[n].apply(null,c)}catch(h){s(h)}else i.splice(n,1),n--,r--;if(!(l=a.$$listenerCount[e]&&a.$$childHead||a!==o&&a.$$nextSibling))for(;a!==o&&!(l=a.$$nextSibling);)a=a.$parent}return u}};var y=new c;return y}]}function Mt(){var e=/^\s*(https?|ftp|mailto|tel|file):/,t=/^\s*((https?|ftp|file):|data:image\/)/;this.aHrefSanitizationWhitelist=function(t){return v(t)?(e=t,this):e},this.imgSrcSanitizationWhitelist=function(e){return v(e)?(t=e,this):t},this.$get=function(){return function(i,n){var r,o=n?t:e;return bi&&!(bi>=8)||(r=Kt(i).href,""===r||r.match(o))?i:"unsafe:"+r}}}function At(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function Nt(e){if("self"===e)return e;if(T(e)){if(e.indexOf("***")>-1)throw xn("iwcard","Illegal sequence *** in string matcher.  String: {0}",e);return e=At(e).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+e+"$")}if(x(e))return new RegExp("^"+e.source+"$");throw xn("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}function Pt(e){var t=[];return v(e)&&o(e,function(e){t.push(Nt(e))}),t}function kt(){this.SCE_CONTEXTS=wn;var e=["self"],t=[];this.resourceUrlWhitelist=function(t){return arguments.length&&(e=Pt(t)),e},this.resourceUrlBlacklist=function(e){return arguments.length&&(t=Pt(e)),t},this.$get=["$injector",function(n){function r(e,t){return"self"===e?zt(t):!!e.exec(t.href)}function o(i){var n,o,s=Kt(i.toString()),a=!1;for(n=0,o=e.length;n<o;n++)if(r(e[n],s)){a=!0;break}if(a)for(n=0,o=t.length;n<o;n++)if(r(t[n],s)){a=!1;break}return a}function s(e){var t=function(e){this.$$unwrapTrustedValue=function(){return e}};return e&&(t.prototype=new e),t.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},t.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},t}function a(e,t){var n=d.hasOwnProperty(e)?d[e]:null;if(!n)throw xn("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",e,t);if(null===t||t===i||""===t)return t;if("string"!=typeof t)throw xn("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",e);return new n(t)}function l(e){return e instanceof h?e.$$unwrapTrustedValue():e}function u(e,t){if(null===t||t===i||""===t)return t;var n=d.hasOwnProperty(e)?d[e]:null;if(n&&t instanceof n)return t.$$unwrapTrustedValue();if(e===wn.RESOURCE_URL){if(o(t))return t;throw xn("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",t.toString())}if(e===wn.HTML)return c(t);throw xn("unsafe","Attempting to use an unsafe value in a safe context.")}var c=function(e){throw xn("unsafe","Attempting to use an unsafe value in a safe context.")};n.has("$sanitize")&&(c=n.get("$sanitize"));var h=s(),d={};return d[wn.HTML]=s(h),d[wn.CSS]=s(h),d[wn.URL]=s(h),d[wn.JS]=s(h),d[wn.RESOURCE_URL]=s(d[wn.URL]),{trustAs:a,getTrusted:u,valueOf:l}}]}function Ht(){var e=!0;this.enabled=function(t){return arguments.length&&(e=!!t),e},this.$get=["$parse","$sniffer","$sceDelegate",function(t,i,n){if(e&&i.msie&&i.msieDocumentMode<8)throw xn("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 9 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var r=k(wn);r.isEnabled=function(){return e},r.trustAs=n.trustAs,r.getTrusted=n.getTrusted,r.valueOf=n.valueOf,e||(r.trustAs=r.getTrusted=function(e,t){return t},r.valueOf=m),r.parseAs=function(e,i){var n=t(i);return n.literal&&n.constant?n:function(t,i){return r.getTrusted(e,n(t,i))}};var s=r.parseAs,a=r.getTrusted,l=r.trustAs;return o(wn,function(e,t){var i=gi(t);r[ue("parse_as_"+i)]=function(t){return s(e,t)},r[ue("get_trusted_"+i)]=function(t){return a(e,t)},r[ue("trust_as_"+i)]=function(t){return l(e,t)}}),r}]}function Ft(){this.$get=["$window","$document",function(e,t){var i,n,r={},o=d((/android (\d+)/.exec(gi((e.navigator||{}).userAgent))||[])[1]),s=/Boxee/i.test((e.navigator||{}).userAgent),a=t[0]||{},l=a.documentMode,u=/^(Moz|webkit|O|ms)(?=[A-Z])/,c=a.body&&a.body.style,h=!1,p=!1;if(c){for(var f in c)if(n=u.exec(f)){i=n[0],i=i.substr(0,1).toUpperCase()+i.substr(1);break}i||(i="WebkitOpacity"in c&&"webkit"),h=!!("transition"in c||i+"Transition"in c),p=!!("animation"in c||i+"Animation"in c),!o||h&&p||(h=T(a.body.style.webkitTransition),p=T(a.body.style.webkitAnimation))}return{history:!(!e.history||!e.history.pushState||o<4||s),hashchange:"onhashchange"in e&&(!l||l>7),hasEvent:function(e){if("input"==e&&9==bi)return!1;if(y(r[e])){var t=a.createElement("div");r[e]="on"+e in t}return r[e]},csp:Ni(),vendorPrefix:i,transitions:h,animations:p,android:o,msie:bi,msieDocumentMode:l}}]}function Bt(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(e,t,i,n){function r(r,s,a){var l,u=i.defer(),c=u.promise,h=v(a)&&!a;return l=t.defer(function(){try{u.resolve(r())}catch(t){u.reject(t),n(t)}finally{delete o[c.$$timeoutId]}h||e.$apply()},s),c.$$timeoutId=l,o[l]=u,c}var o={};return r.cancel=function(e){return!!(e&&e.$$timeoutId in o)&&(o[e.$$timeoutId].reject("canceled"),delete o[e.$$timeoutId],t.defer.cancel(e.$$timeoutId))},r}]}function Kt(e,t){var i=e;return bi&&(Rn.setAttribute("href",i),i=Rn.href),Rn.setAttribute("href",i),{href:Rn.href,protocol:Rn.protocol?Rn.protocol.replace(/:$/,""):"",host:Rn.host,search:Rn.search?Rn.search.replace(/^\?/,""):"",hash:Rn.hash?Rn.hash.replace(/^#/,""):"",hostname:Rn.hostname,port:Rn.port,pathname:"/"===Rn.pathname.charAt(0)?Rn.pathname:"/"+Rn.pathname}}function zt(e){var t=T(e)?Kt(e):e;return t.protocol===Ln.protocol&&t.host===Ln.host}function Ut(){this.$get=g(e)}function Vt(e){function t(n,r){if(E(n)){var s={};return o(n,function(e,i){s[i]=t(i,e)}),s}return e.factory(n+i,r)}var i="Filter";this.register=t,this.$get=["$injector",function(e){return function(t){return e.get(t+i)}}],t("currency",$t),t("date",Qt),t("filter",Gt),t("json",ei),t("limitTo",ti),t("lowercase",Mn),t("number",Wt),t("orderBy",ii),t("uppercase",An)}function Gt(){return function(e,t,i){if(!Mi(e))return e;var n=typeof i,r=[];r.check=function(e){for(var t=0;t<r.length;t++)if(!r[t](e))return!1;return!0},"function"!==n&&(i="boolean"===n&&i?function(e,t){return Ii.equals(e,t)}:function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){for(var n in e)if("$"!==n.charAt(0)&&yi.call(e,n)&&i(e[n],t[n]))return!0;return!1}return t=(""+t).toLowerCase(),(""+e).toLowerCase().indexOf(t)>-1});var o=function(e,t){if("string"==typeof t&&"!"===t.charAt(0))return!o(e,t.substr(1));switch(typeof e){case"boolean":case"number":case"string":return i(e,t);case"object":switch(typeof t){case"object":return i(e,t);default:for(var n in e)if("$"!==n.charAt(0)&&o(e[n],t))return!0}return!1;case"array":for(var r=0;r<e.length;r++)if(o(e[r],t))return!0;return!1;default:return!1}};switch(typeof t){case"boolean":case"number":case"string":t={$:t};case"object":for(var s in t)!function(e){"undefined"!=typeof t[e]&&r.push(function(i){return o("$"==e?i:i&&i[e],t[e])})}(s);break;case"function":r.push(t);break;default:return e}for(var a=[],l=0;l<e.length;l++){var u=e[l];r.check(u)&&a.push(u)}return a}}function $t(e){var t=e.NUMBER_FORMATS;return function(e,i){return y(i)&&(i=t.CURRENCY_SYM),jt(e,t.PATTERNS[1],t.GROUP_SEP,t.DECIMAL_SEP,2).replace(/\u00A4/g,i)}}function Wt(e){var t=e.NUMBER_FORMATS;return function(e,i){return jt(e,t.PATTERNS[0],t.GROUP_SEP,t.DECIMAL_SEP,i)}}function jt(e,t,i,n,r){if(null==e||!isFinite(e)||E(e))return"";var o=e<0;e=Math.abs(e);var s=e+"",a="",l=[],u=!1;if(s.indexOf("e")!==-1){var c=s.match(/([\d\.]+)e(-?)(\d+)/);c&&"-"==c[2]&&c[3]>r+1?(s="0",e=0):(a=s,u=!0)}if(u)r>0&&e>-1&&e<1&&(a=e.toFixed(r));else{var h=(s.split(Sn)[1]||"").length;y(r)&&(r=Math.min(Math.max(t.minFrac,h),t.maxFrac)),e=+(Math.round(+(e.toString()+"e"+r)).toString()+"e"+-r),0===e&&(o=!1);var d=(""+e).split(Sn),p=d[0];d=d[1]||"";var f,m=0,g=t.lgSize,v=t.gSize;if(p.length>=g+v)for(m=p.length-g,f=0;f<m;f++)(m-f)%v===0&&0!==f&&(a+=i),a+=p.charAt(f);for(f=m;f<p.length;f++)(p.length-f)%g===0&&0!==f&&(a+=i),a+=p.charAt(f);for(;d.length<r;)d+="0";r&&"0"!==r&&(a+=n+d.substr(0,r))}return l.push(o?t.negPre:t.posPre),l.push(a),l.push(o?t.negSuf:t.posSuf),l.join("")}function Xt(e,t,i){var n="";for(e<0&&(n="-",e=-e),e=""+e;e.length<t;)e="0"+e;return i&&(e=e.substr(e.length-t)),n+e}function qt(e,t,i,n){return i=i||0,function(r){var o=r["get"+e]();return(i>0||o>-i)&&(o+=i),0===o&&i==-12&&(o=12),Xt(o,t,n)}}function Zt(e,t){return function(i,n){var r=i["get"+e](),o=vi(t?"SHORT"+e:e);return n[o][r]}}function Yt(e){var t=-1*e.getTimezoneOffset(),i=t>=0?"+":"";return i+=Xt(Math[t>0?"floor":"ceil"](t/60),2)+Xt(Math.abs(t%60),2)}function Jt(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function Qt(e){function t(e){var t;if(t=e.match(i)){var n=new Date(0),r=0,o=0,s=t[8]?n.setUTCFullYear:n.setFullYear,a=t[8]?n.setUTCHours:n.setHours;t[9]&&(r=d(t[9]+t[10]),o=d(t[9]+t[11])),s.call(n,d(t[1]),d(t[2])-1,d(t[3]));var l=d(t[4]||0)-r,u=d(t[5]||0)-o,c=d(t[6]||0),h=Math.round(1e3*parseFloat("0."+(t[7]||0)));return a.call(n,l,u,c,h),n}return e}var i=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(i,n){var r,s,a="",l=[];if(n=n||"mediumDate",n=e.DATETIME_FORMATS[n]||n,T(i)&&(i=Dn.test(i)?d(i):t(i)),b(i)&&(i=new Date(i)),!C(i))return i;for(;n;)s=In.exec(n),s?(l=F(l,s,1),n=l.pop()):(l.push(n),n=null);return o(l,function(t){r=_n[t],a+=r?r(i,e.DATETIME_FORMATS):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),a}}function ei(){return function(e){return U(e,!0)}}function ti(){return function(e,t){return Mi(e)||T(e)?(t=Math.abs(Number(t))===1/0?Number(t):d(t),t?t>0?e.slice(0,t):e.slice(t):T(e)?"":[]):e}}function ii(e){return function(t,i,n){function o(e,t){for(var n=0;n<i.length;n++){var r=i[n](e,t);if(0!==r)return r}return 0}function s(e,t){return G(t)?function(t,i){return e(i,t)}:e}function a(e,t){var i=typeof e,n=typeof t;return i==n?(C(e)&&C(t)&&(e=e.valueOf(),t=t.valueOf()),"string"==i&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t?0:e<t?-1:1):i<n?-1:1}return r(t)?(i=Mi(i)?i:[i],0===i.length&&(i=["+"]),i=D(i,function(t){var i=!1,n=t||m;if(T(t)){if("+"!=t.charAt(0)&&"-"!=t.charAt(0)||(i="-"==t.charAt(0),t=t.substring(1)),""===t)return s(function(e,t){return a(e,t)},i);if(n=e(t),n.constant){var r=n();return s(function(e,t){return a(e[r],t[r])},i)}}return s(function(e,t){return a(n(e),n(t))},i)}),Ri.call(t).sort(s(o,n))):t}}function ni(e){return O(e)&&(e={link:e}),e.restrict=e.restrict||"AC",g(e)}function ri(e,t,i,n){function r(t,i){i=i?"-"+Q(i,"-"):"",n.setClass(e,(t?Wn:jn)+i,(t?jn:Wn)+i)}var s=this,a=e.parent().controller("form")||kn,l=0,u=s.$error={},c=[];s.$name=t.name||t.ngForm,s.$dirty=!1,s.$pristine=!0,s.$valid=!0,s.$invalid=!1,a.$addControl(s),e.addClass(Xn),r(!0),s.$addControl=function(e){ne(e.$name,"input"),c.push(e),e.$name&&(s[e.$name]=e)},s.$removeControl=function(e){e.$name&&s[e.$name]===e&&delete s[e.$name],o(u,function(t,i){s.$setValidity(i,!0,e)}),N(c,e)},s.$setValidity=function(e,t,i){var n=u[e];if(t)n&&(N(n,i),n.length||(l--,l||(r(t),s.$valid=!0,s.$invalid=!1),u[e]=!1,r(!0,e),a.$setValidity(e,!0,s)));else{if(l||r(t),n){if(M(n,i))return}else u[e]=n=[],l++,r(!1,e),a.$setValidity(e,!1,s);n.push(i),s.$valid=!1,s.$invalid=!0}},s.$setDirty=function(){n.removeClass(e,Xn),n.addClass(e,qn),s.$dirty=!0,s.$pristine=!1,a.$setDirty()},s.$setPristine=function(){n.removeClass(e,qn),n.addClass(e,Xn),s.$dirty=!1,s.$pristine=!0,o(c,function(e){e.$setPristine()})}}function oi(e,t,n,r){return e.$setValidity(t,n),n?r:i}function si(e,t){var i,n;if(t)for(i=0;i<t.length;++i)if(n=t[i],e[n])return!0;return!1}function ai(e,t,i,n,r){if(E(r)){e.$$hasNativeValidators=!0;var o=function(o){return e.$error[t]||si(r,n)||!si(r,i)?o:void e.$setValidity(t,!1)};e.$parsers.push(o)}}function li(e,t,i,r,o,s){var a=t.prop(mi),l=t[0].placeholder,u={},c=gi(t[0].type);if(r.$$validityState=a,!o.android){var h=!1;t.on("compositionstart",function(e){h=!0}),t.on("compositionend",function(){h=!1,p()})}var p=function(n){if(!h){var o=t.val();if(bi&&"input"===(n||u).type&&t[0].placeholder!==l)return void(l=t[0].placeholder);"password"!==c&&G(i.ngTrim||"T")&&(o=Ai(o));var s=a&&r.$$hasNativeValidators;(r.$viewValue!==o||""===o&&s)&&(e.$root.$$phase?r.$setViewValue(o):e.$apply(function(){r.$setViewValue(o)}))}};if(o.hasEvent("input"))t.on("input",p);else{var f,m=function(){f||(f=s.defer(function(){p(),f=null}))};t.on("keydown",function(e){var t=e.keyCode;91===t||15<t&&t<19||37<=t&&t<=40||m()}),o.hasEvent("paste")&&t.on("paste cut",m)}t.on("change",p),r.$render=function(){t.val(r.$isEmpty(r.$viewValue)?"":r.$viewValue)};var g,y,v=i.ngPattern;if(v){var E=function(e,t){return oi(r,"pattern",r.$isEmpty(t)||e.test(t),t)};y=v.match(/^\/(.*)\/([gim]*)$/),y?(v=new RegExp(y[1],y[2]),g=function(e){return E(v,e)}):g=function(i){var r=e.$eval(v);if(!r||!r.test)throw n("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",v,r,$(t));return E(r,i)},r.$formatters.push(g),r.$parsers.push(g)}if(i.ngMinlength){var T=d(i.ngMinlength),b=function(e){return oi(r,"minlength",r.$isEmpty(e)||e.length>=T,e)};r.$parsers.push(b),r.$formatters.push(b)}if(i.ngMaxlength){var C=d(i.ngMaxlength),O=function(e){return oi(r,"maxlength",r.$isEmpty(e)||e.length<=C,e)};r.$parsers.push(O),r.$formatters.push(O)}}function ui(e,t,n,r,o,s){if(li(e,t,n,r,o,s),r.$parsers.push(function(e){var t=r.$isEmpty(e);return t||Un.test(e)?(r.$setValidity("number",!0),""===e?null:t?e:parseFloat(e)):(r.$setValidity("number",!1),i)}),ai(r,"number",Gn,null,r.$$validityState),r.$formatters.push(function(e){return r.$isEmpty(e)?"":""+e}),n.min){var a=function(e){var t=parseFloat(n.min);return oi(r,"min",r.$isEmpty(e)||e>=t,e)};r.$parsers.push(a),r.$formatters.push(a)}if(n.max){var l=function(e){var t=parseFloat(n.max);return oi(r,"max",r.$isEmpty(e)||e<=t,e)};r.$parsers.push(l),r.$formatters.push(l)}r.$formatters.push(function(e){return oi(r,"number",r.$isEmpty(e)||b(e),e)})}function ci(e,t,i,n,r,o){li(e,t,i,n,r,o);var s=function(e){return oi(n,"url",n.$isEmpty(e)||Kn.test(e),e)};n.$formatters.push(s),n.$parsers.push(s)}function hi(e,t,i,n,r,o){li(e,t,i,n,r,o);var s=function(e){return oi(n,"email",n.$isEmpty(e)||zn.test(e),e)};n.$formatters.push(s),n.$parsers.push(s)}function di(e,t,i,n){y(i.name)&&t.attr("name",u()),t.on("click",function(){t[0].checked&&e.$apply(function(){n.$setViewValue(i.value)})}),n.$render=function(){var e=i.value;t[0].checked=e==n.$viewValue},i.$observe("value",n.$render)}function pi(e,t,i,n){var r=i.ngTrueValue,o=i.ngFalseValue;T(r)||(r=!0),T(o)||(o=!1),t.on("click",function(){e.$apply(function(){n.$setViewValue(t[0].checked)})}),n.$render=function(){t[0].checked=n.$viewValue},n.$isEmpty=function(e){return e!==r},n.$formatters.push(function(e){return e===r}),n.$parsers.push(function(e){return e?r:o})}function fi(e,t){return e="ngClass"+e,["$animate",function(i){function n(e,t){var i=[];e:for(var n=0;n<e.length;n++){for(var r=e[n],o=0;o<t.length;o++)if(r==t[o])continue e;i.push(r)}return i}function r(e){if(Mi(e))return e;if(T(e))return e.split(" ");if(E(e)){var t=[];return o(e,function(e,i){e&&(t=t.concat(i.split(" ")))}),t}return e}return{restrict:"AC",link:function(s,a,l){function u(e){var t=h(e,1);l.$addClass(t)}function c(e){var t=h(e,-1);l.$removeClass(t)}function h(e,t){var i=a.data("$classCounts")||{},n=[];return o(e,function(e){(t>0||i[e])&&(i[e]=(i[e]||0)+t,i[e]===+(t>0)&&n.push(e))}),a.data("$classCounts",i),n.join(" ")}function d(e,t){var r=n(t,e),o=n(e,t);o=h(o,-1),r=h(r,1),0===r.length?i.removeClass(a,o):0===o.length?i.addClass(a,r):i.setClass(a,r,o)}function p(e){if(t===!0||s.$index%2===t){var i=r(e||[]);if(f){if(!H(e,f)){var n=r(f);d(n,i)}}else u(i)}f=k(e)}var f;s.$watch(l[e],p,!0),l.$observe("class",function(t){p(s.$eval(l[e]))}),"ngClass"!==e&&s.$watch("$index",function(i,n){var o=1&i;if(o!==(1&n)){var a=r(s.$eval(l[e]));o===t?u(a):c(a)}})}}}]}var mi="validity",gi=function(e){return T(e)?e.toLowerCase():e},yi=Object.prototype.hasOwnProperty,vi=function(e){return T(e)?e.toUpperCase():e},Ei=function(e){return T(e)?e.replace(/[A-Z]/g,function(e){return String.fromCharCode(32|e.charCodeAt(0))}):e},Ti=function(e){return T(e)?e.replace(/[a-z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)&-33)}):e};"i"!=="I".toLowerCase()&&(gi=Ei,vi=Ti);var bi,Ci,Oi,xi,wi,Ri=[].slice,Li=[].push,Si=Object.prototype.toString,_i=n("ng"),Ii=e.angular||(e.angular={}),Di=["0","0","0"];bi=d((/msie (\d+)/.exec(gi(navigator.userAgent))||[])[1]),isNaN(bi)&&(bi=d((/trident\/.*; rv:(\d+)/.exec(gi(navigator.userAgent))||[])[1])),f.$inject=[],m.$inject=[];var Mi=function(){return O(Array.isArray)?Array.isArray:function(e){return"[object Array]"===Si.call(e)}}(),Ai=function(){return String.prototype.trim?function(e){return T(e)?e.trim():e}:function(e){return T(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();wi=bi<9?function(e){return e=e.nodeName?e:e[0],e.scopeName&&"HTML"!=e.scopeName?vi(e.scopeName+":"+e.nodeName):e.nodeName}:function(e){return e.nodeName?e.nodeName:e[0].nodeName};var Ni=function(){if(v(Ni.isActive_))return Ni.isActive_;var e=!(!t.querySelector("[ng-csp]")&&!t.querySelector("[data-ng-csp]"));if(!e)try{new Function("")}catch(i){e=!0}return Ni.isActive_=e},Pi=/[A-Z]/g,ki={full:"1.2.32",major:1,minor:2,dot:32,codeName:"alternation-intention"};fe.expando="ng339";var Hi=fe.cache={},Fi=1,Bi=e.document.addEventListener?function(e,t,i){e.addEventListener(t,i,!1)}:function(e,t,i){e.attachEvent("on"+t,i)},Ki=e.document.removeEventListener?function(e,t,i){e.removeEventListener(t,i,!1)}:function(e,t,i){e.detachEvent("on"+t,i)},zi=(fe._data=function(e){return this.cache[e[this.expando]]||{}},/([\:\-\_]+(.))/g),Ui=/^moz([A-Z])/,Vi=n("jqLite"),Gi=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,$i=/<|&#?\w+;/,Wi=/<([\w:]+)/,ji=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Xi={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Xi.optgroup=Xi.option,Xi.tbody=Xi.tfoot=Xi.colgroup=Xi.caption=Xi.thead,Xi.th=Xi.td;var qi=fe.prototype={ready:function(i){function n(){r||(r=!0,i())}var r=!1;"complete"===t.readyState?setTimeout(n):(this.on("DOMContentLoaded",n),fe(e).on("load",n))},toString:function(){var e=[];return o(this,function(t){e.push(""+t)}),"["+e.join(", ")+"]"},eq:function(e){return Ci(e>=0?this[e]:this[this.length+e])},length:0,push:Li,sort:[].sort,splice:[].splice},Zi={};o("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(e){Zi[gi(e)]=e});var Yi={};o("input,select,option,textarea,button,form,details".split(","),function(e){Yi[vi(e)]=!0}),o({data:Te,removeData:ve},function(e,t){fe[t]=e}),o({data:Te,inheritedData:Re,scope:function(e){return Ci.data(e,"$scope")||Re(e.parentNode||e,["$isolateScope","$scope"])},isolateScope:function(e){return Ci.data(e,"$isolateScope")||Ci.data(e,"$isolateScopeNoTemplate")},controller:we,injector:function(e){return Re(e,"$injector")},removeAttr:function(e,t){e.removeAttribute(t)},hasClass:be,css:function(e,t,n){if(t=ue(t),!v(n)){var r;return bi<=8&&(r=e.currentStyle&&e.currentStyle[t],""===r&&(r="auto")),r=r||e.style[t],bi<=8&&(r=""===r?i:r),r}e.style[t]=n},attr:function(e,t,n){var r=gi(t);if(Zi[r]){if(!v(n))return e[t]||(e.attributes.getNamedItem(t)||f).specified?r:i;n?(e[t]=!0,e.setAttribute(t,r)):(e[t]=!1,e.removeAttribute(r))}else if(v(n))e.setAttribute(t,n);else if(e.getAttribute){var o=e.getAttribute(t,2);return null===o?i:o}},prop:function(e,t,i){return v(i)?void(e[t]=i):e[t]},text:function(){function e(e,i){var n=t[e.nodeType];return y(i)?n?e[n]:"":void(e[n]=i)}var t=[];return bi<9?(t[1]="innerText",t[3]="nodeValue"):t[1]=t[3]="textContent",e.$dv="",e}(),val:function(e,t){if(y(t)){if("SELECT"===wi(e)&&e.multiple){var i=[];return o(e.options,function(e){e.selected&&i.push(e.value||e.text)}),0===i.length?null:i}return e.value}e.value=t},html:function(e,t){if(y(t))return e.innerHTML;for(var i=0,n=e.childNodes;i<n.length;i++)ge(n[i]);e.innerHTML=t},empty:Le},function(e,t){fe.prototype[t]=function(t,n){var r,o,s=this.length;if(e!==Le&&(2==e.length&&e!==be&&e!==we?t:n)===i){if(E(t)){for(r=0;r<s;r++)if(e===Te)e(this[r],t);else for(o in t)e(this[r],o,t[o]);return this}for(var a=e.$dv,l=a===i?Math.min(s,1):s,u=0;u<l;u++){var c=e(this[u],t,n);a=a?a+c:c}return a}for(r=0;r<s;r++)e(this[r],t,n);return this}}),o({removeData:ve,dealoc:ge,on:function Ar(e,i,n,r){if(v(r))throw Vi("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");var s=Ee(e,"events"),a=Ee(e,"handle");s||Ee(e,"events",s={}),a||Ee(e,"handle",a=_e(e,s)),o(i.split(" "),function(i){var r=s[i];if(!r){if("mouseenter"==i||"mouseleave"==i){var o=t.body.contains||t.body.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};s[i]=[];var l={mouseleave:"mouseout",mouseenter:"mouseover"};Ar(e,l[i],function(e){var t=this,n=e.relatedTarget;n&&(n===t||o(t,n))||a(e,i)})}else Bi(e,i,a),s[i]=[];r=s[i]}r.push(n)})},off:ye,one:function(e,t,i){e=Ci(e),e.on(t,function n(){e.off(t,i),e.off(t,n)}),e.on(t,i)},replaceWith:function(e,t){var i,n=e.parentNode;ge(e),o(new fe(t),function(t){i?n.insertBefore(t,i.nextSibling):n.replaceChild(t,e),i=t})},children:function(e){var t=[];return o(e.childNodes,function(e){1===e.nodeType&&t.push(e)}),t},contents:function(e){return e.contentDocument||e.childNodes||[]},append:function(e,t){o(new fe(t),function(t){1!==e.nodeType&&11!==e.nodeType||e.appendChild(t)})},prepend:function(e,t){if(1===e.nodeType){var i=e.firstChild;o(new fe(t),function(t){e.insertBefore(t,i)})}},wrap:function(e,t){t=Ci(t)[0];var i=e.parentNode;i&&i.replaceChild(t,e),t.appendChild(e)},remove:function(e){ge(e);var t=e.parentNode;t&&t.removeChild(e)},after:function(e,t){var i=e,n=e.parentNode;o(new fe(t),function(e){n.insertBefore(e,i.nextSibling),i=e})},addClass:Oe,removeClass:Ce,toggleClass:function(e,t,i){t&&o(t.split(" "),function(t){var n=i;y(n)&&(n=!be(e,t)),(n?Oe:Ce)(e,t)})},parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},next:function(e){if(e.nextElementSibling)return e.nextElementSibling;for(var t=e.nextSibling;null!=t&&1!==t.nodeType;)t=t.nextSibling;return t},find:function(e,t){return e.getElementsByTagName?e.getElementsByTagName(t):[]},clone:me,triggerHandler:function(e,t,i){var n,r,s,a=t.type||t,l=(Ee(e,"events")||{})[a];l&&(n={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return this.defaultPrevented===!0},stopPropagation:f,type:a,target:e},t.type&&(n=h(n,t)),r=k(l),s=i?[n].concat(i):[n],o(r,function(t){t.apply(e,s)}))}},function(e,t){fe.prototype[t]=function(t,i,n){for(var r,o=0;o<this.length;o++)y(r)?(r=e(this[o],t,i,n),v(r)&&(r=Ci(r))):xe(r,e(this[o],t,i,n));return v(r)?r:this},fe.prototype.bind=fe.prototype.on,fe.prototype.unbind=fe.prototype.off}),De.prototype={put:function(e,t){this[Ie(e,this.nextUid)]=t},get:function(e){return this[Ie(e,this.nextUid)]},remove:function(e){var t=this[e=Ie(e,this.nextUid)];return delete this[e],t}};var Ji=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,Qi=/,/,en=/^\s*(_?)(\S+?)\1\s*$/,tn=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,nn=n("$injector"),rn=n("$animate"),on=["$provide",function(e){this.$$selectors={},this.register=function(t,i){var n=t+"-animation";if(t&&"."!=t.charAt(0))throw rn("notcsel","Expecting class selector starting with '.' got '{0}'.",t);this.$$selectors[t.substr(1)]=n,e.factory(n,i)},this.classNameFilter=function(e){return 1===arguments.length&&(this.$$classNameFilter=e instanceof RegExp?e:null),this.$$classNameFilter},this.$get=["$timeout","$$asyncCallback",function(e,t){function i(e){e&&t(e)}return{enter:function(e,t,n,r){n?n.after(e):(t&&t[0]||(t=n.parent()),t.append(e)),i(r)},leave:function(e,t){e.remove(),i(t)},move:function(e,t,i,n){this.enter(e,t,i,n)},addClass:function(e,t,n){t=T(t)?t:Mi(t)?t.join(" "):"",o(e,function(e){Oe(e,t)}),i(n)},removeClass:function(e,t,n){t=T(t)?t:Mi(t)?t.join(" "):"",o(e,function(e){Ce(e,t)}),i(n)},setClass:function(e,t,n,r){o(e,function(e){Oe(e,t),Ce(e,n)}),i(r)},enabled:f}}]}],sn=n("$compile");Ke.$inject=["$provide","$$sanitizeUriProvider"];var an=/^(x[\:\-_]|data[\:\-_])/i,ln=n("$interpolate"),un=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,cn={http:80,https:443,ftp:21},hn=n("$location");pt.prototype=dt.prototype=ht.prototype={$$html5:!1,$$replace:!1,absUrl:ft("$$absUrl"),url:function(e){if(y(e))return this.$$url;var t=un.exec(e);return t[1]&&this.path(decodeURIComponent(t[1])),(t[2]||t[1])&&this.search(t[3]||""),this.hash(t[5]||""),this},protocol:ft("$$protocol"),host:ft("$$host"),port:ft("$$port"),path:mt("$$path",function(e){return e=null!==e?e.toString():"","/"==e.charAt(0)?e:"/"+e}),search:function(e,t){switch(arguments.length){case 0:return this.$$search;case 1:if(T(e)||b(e))e=e.toString(),this.$$search=j(e);else{if(!E(e))throw hn("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");o(e,function(t,i){null==t&&delete e[i]}),this.$$search=e}break;default:y(t)||null===t?delete this.$$search[e]:this.$$search[e]=t}return this.$$compose(),this},hash:mt("$$hash",function(e){return null!==e?e.toString():""}),replace:function(){return this.$$replace=!0,this}};var dn,pn=n("$parse"),fn={},mn=Function.prototype.call,gn=Function.prototype.apply,yn=Function.prototype.bind,vn={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:f,"+":function(e,t,n,r){return n=n(e,t),r=r(e,t),v(n)?v(r)?n+r:n:v(r)?r:i},"-":function(e,t,i,n){return i=i(e,t),n=n(e,t),(v(i)?i:0)-(v(n)?n:0)},"*":function(e,t,i,n){return i(e,t)*n(e,t)},"/":function(e,t,i,n){return i(e,t)/n(e,t)},"%":function(e,t,i,n){return i(e,t)%n(e,t)},"^":function(e,t,i,n){return i(e,t)^n(e,t)},"=":f,"===":function(e,t,i,n){return i(e,t)===n(e,t)},"!==":function(e,t,i,n){return i(e,t)!==n(e,t)},"==":function(e,t,i,n){return i(e,t)==n(e,t)},"!=":function(e,t,i,n){return i(e,t)!=n(e,t)},"<":function(e,t,i,n){return i(e,t)<n(e,t)},">":function(e,t,i,n){return i(e,t)>n(e,t)},"<=":function(e,t,i,n){return i(e,t)<=n(e,t)},">=":function(e,t,i,n){return i(e,t)>=n(e,t)},"&&":function(e,t,i,n){return i(e,t)&&n(e,t)},"||":function(e,t,i,n){return i(e,t)||n(e,t)},"&":function(e,t,i,n){return i(e,t)&n(e,t)},"|":function(e,t,i,n){return n(e,t)(e,t,i(e,t))},"!":function(e,t,i){return!i(e,t)}},En={n:"\n",f:"\f",r:"\r",t:"\t",v:"\x0B","'":"'",'"':'"'},Tn=function(e){this.options=e};Tn.prototype={constructor:Tn,lex:function(e){for(this.text=e,this.index=0,this.ch=i,this.lastCh=":",this.tokens=[];this.index<this.text.length;){if(this.ch=this.text.charAt(this.index),this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),this.index++;else{if(this.isWhitespace(this.ch)){this.index++;continue}var t=this.ch+this.peek(),n=t+this.peek(2),r=vn[this.ch],o=vn[t],s=vn[n];s?(this.tokens.push({index:this.index,text:n,fn:s}),this.index+=3):o?(this.tokens.push({index:this.index,text:t,fn:o}),this.index+=2):r?(this.tokens.push({index:this.index,text:this.ch,fn:r}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(e){return e.indexOf(this.ch)!==-1},was:function(e){return e.indexOf(this.lastCh)!==-1},peek:function(e){var t=e||1;return this.index+t<this.text.length&&this.text.charAt(this.index+t)},isNumber:function(e){return"0"<=e&&e<="9"},isWhitespace:function(e){return" "===e||"\r"===e||"\t"===e||"\n"===e||"\x0B"===e||" "===e},isIdent:function(e){return"a"<=e&&e<="z"||"A"<=e&&e<="Z"||"_"===e||"$"===e},isExpOperator:function(e){return"-"===e||"+"===e||this.isNumber(e)},throwError:function(e,t,i){i=i||this.index;var n=v(t)?"s "+t+"-"+this.index+" ["+this.text.substring(t,i)+"]":" "+i;throw pn("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",e,n,this.text)},readNumber:function(){for(var e="",t=this.index;this.index<this.text.length;){var i=gi(this.text.charAt(this.index));if("."==i||this.isNumber(i))e+=i;else{var n=this.peek();if("e"==i&&this.isExpOperator(n))e+=i;else if(this.isExpOperator(i)&&n&&this.isNumber(n)&&"e"==e.charAt(e.length-1))e+=i;else{if(!this.isExpOperator(i)||n&&this.isNumber(n)||"e"!=e.charAt(e.length-1))break;this.throwError("Invalid exponent")}}this.index++}e=1*e,this.tokens.push({index:t,text:e,literal:!0,constant:!0,fn:function(){return e}})},readIdent:function(){for(var e,t,i,n,r=this,o="",s=this.index;this.index<this.text.length&&(n=this.text.charAt(this.index),"."===n||this.isIdent(n)||this.isNumber(n));)"."===n&&(e=this.index),o+=n,this.index++;if(e)for(t=this.index;t<this.text.length;){if(n=this.text.charAt(t),"("===n){i=o.substr(e-s+1),o=o.substr(0,e-s),this.index=t;break}if(!this.isWhitespace(n))break;t++}var a={index:s,text:o};if(vn.hasOwnProperty(o))a.fn=vn[o],a.literal=!0,a.constant=!0;else{var l=Rt(o,this.options,this.text);a.fn=h(function(e,t){return l(e,t)},{assign:function(e,t){return Ct(e,o,t,r.text,r.options)}})}this.tokens.push(a),i&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:i}))},readString:function(e){var t=this.index;this.index++;for(var i="",n=e,r=!1;this.index<this.text.length;){var o=this.text.charAt(this.index);if(n+=o,r){if("u"===o){var s=this.text.substring(this.index+1,this.index+5);s.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+s+"]"),this.index+=4,i+=String.fromCharCode(parseInt(s,16))}else{var a=En[o];i+=a||o}r=!1}else if("\\"===o)r=!0;else{if(o===e)return this.index++,void this.tokens.push({index:t,text:n,string:i,literal:!0,constant:!0,fn:function(){return i}});i+=o}this.index++}this.throwError("Unterminated quote",t)}};var bn=function(e,t,i){this.lexer=e,this.$filter=t,this.options=i};bn.ZERO=h(function(){return 0},{constant:!0}),bn.prototype={constructor:bn,parse:function(e){this.text=e,this.tokens=this.lexer.lex(e);var t=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),t.literal=!!t.literal,t.constant=!!t.constant,t},primary:function(){var e;if(this.expect("("))e=this.filterChain(),this.consume(")");else if(this.expect("["))e=this.arrayDeclaration();else if(this.expect("{"))e=this.object();else{var t=this.expect();e=t.fn,e||this.throwError("not a primary expression",t),e.literal=!!t.literal,e.constant=!!t.constant}for(var i,n;i=this.expect("(","[",".");)"("===i.text?(e=this.functionCall(e,n),n=null):"["===i.text?(n=e,e=this.objectIndex(e)):"."===i.text?(n=e,e=this.fieldAccess(e)):this.throwError("IMPOSSIBLE");return e},throwError:function(e,t){throw pn("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",t.text,e,t.index+1,this.text,this.text.substring(t.index));
},peekToken:function(){if(0===this.tokens.length)throw pn("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e,t,i,n){if(this.tokens.length>0){var r=this.tokens[0],o=r.text;if(o===e||o===t||o===i||o===n||!e&&!t&&!i&&!n)return r}return!1},expect:function(e,t,i,n){var r=this.peek(e,t,i,n);return!!r&&(this.tokens.shift(),r)},consume:function(e){this.expect(e)||this.throwError("is unexpected, expecting ["+e+"]",this.peek())},unaryFn:function(e,t){return h(function(i,n){return e(i,n,t)},{constant:t.constant})},ternaryFn:function(e,t,i){return h(function(n,r){return e(n,r)?t(n,r):i(n,r)},{constant:e.constant&&t.constant&&i.constant})},binaryFn:function(e,t,i){return h(function(n,r){return t(n,r,e,i)},{constant:e.constant&&i.constant})},statements:function(){for(var e=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&e.push(this.filterChain()),!this.expect(";"))return 1===e.length?e[0]:function(t,i){for(var n,r=0;r<e.length;r++){var o=e[r];o&&(n=o(t,i))}return n}},filterChain:function(){for(var e,t=this.expression();;){if(!(e=this.expect("|")))return t;t=this.binaryFn(t,e.fn,this.filter())}},filter:function(){for(var e=this.expect(),t=this.$filter(e.text),i=[];;){if(!(e=this.expect(":"))){var n=function(e,n,r){for(var o=[r],s=0;s<i.length;s++)o.push(i[s](e,n));return t.apply(e,o)};return function(){return n}}i.push(this.expression())}},expression:function(){return this.assignment()},assignment:function(){var e,t,i=this.ternary();return(t=this.expect("="))?(i.assign||this.throwError("implies assignment but ["+this.text.substring(0,t.index)+"] can not be assigned to",t),e=this.ternary(),function(t,n){return i.assign(t,e(t,n),n)}):i},ternary:function(){var e,t,i=this.logicalOR();return(t=this.expect("?"))?(e=this.assignment(),(t=this.expect(":"))?this.ternaryFn(i,e,this.assignment()):void this.throwError("expected :",t)):i},logicalOR:function(){for(var e,t=this.logicalAND();;){if(!(e=this.expect("||")))return t;t=this.binaryFn(t,e.fn,this.logicalAND())}},logicalAND:function(){var e,t=this.equality();return(e=this.expect("&&"))&&(t=this.binaryFn(t,e.fn,this.logicalAND())),t},equality:function(){var e,t=this.relational();return(e=this.expect("==","!=","===","!=="))&&(t=this.binaryFn(t,e.fn,this.equality())),t},relational:function(){var e,t=this.additive();return(e=this.expect("<",">","<=",">="))&&(t=this.binaryFn(t,e.fn,this.relational())),t},additive:function(){for(var e,t=this.multiplicative();e=this.expect("+","-");)t=this.binaryFn(t,e.fn,this.multiplicative());return t},multiplicative:function(){for(var e,t=this.unary();e=this.expect("*","/","%");)t=this.binaryFn(t,e.fn,this.unary());return t},unary:function(){var e;return this.expect("+")?this.primary():(e=this.expect("-"))?this.binaryFn(bn.ZERO,e.fn,this.unary()):(e=this.expect("!"))?this.unaryFn(e.fn,this.unary()):this.primary()},fieldAccess:function(e){var t=this,i=this.expect().text,n=Rt(i,this.options,this.text);return h(function(t,i,r){return n(r||e(t,i))},{assign:function(n,r,o){var s=e(n,o);return s||e.assign(n,s={}),Ct(s,i,r,t.text,t.options)}})},objectIndex:function(e){var t=this,n=this.expression();return this.consume("]"),h(function(r,o){var s,a,l=e(r,o),u=Et(n(r,o),t.text);return vt(u,t.text),l?(s=Tt(l[u],t.text),s&&s.then&&t.options.unwrapPromises&&(a=s,"$$v"in s||(a.$$v=i,a.then(function(e){a.$$v=e})),s=s.$$v),s):i},{assign:function(i,r,o){var s=vt(Et(n(i,o),t.text),t.text),a=Tt(e(i,o),t.text);return a||e.assign(i,a={}),a[s]=r}})},functionCall:function(e,t){var i=[];if(")"!==this.peekToken().text)do i.push(this.expression());while(this.expect(","));this.consume(")");var n=this;return function(r,o){for(var s=[],a=t?t(r,o):r,l=0;l<i.length;l++)s.push(Tt(i[l](r,o),n.text));var u=e(r,o,a)||f;Tt(a,n.text),bt(u,n.text);var c=u.apply?u.apply(a,s):u(s[0],s[1],s[2],s[3],s[4]);return Tt(c,n.text)}},arrayDeclaration:function(){var e=[],t=!0;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;var i=this.expression();e.push(i),i.constant||(t=!1)}while(this.expect(","));return this.consume("]"),h(function(t,i){for(var n=[],r=0;r<e.length;r++)n.push(e[r](t,i));return n},{literal:!0,constant:t})},object:function(){var e=[],t=!0;if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var i=this.expect(),n=i.string||i.text;this.consume(":");var r=this.expression();e.push({key:n,value:r}),r.constant||(t=!1)}while(this.expect(","));return this.consume("}"),h(function(t,i){for(var n={},r=0;r<e.length;r++){var o=e[r];n[o.key]=o.value(t,i)}return n},{literal:!0,constant:t})}};var Cn={},On={},xn=n("$sce"),wn={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Rn=t.createElement("a"),Ln=Kt(e.location.href,!0);Vt.$inject=["$provide"],$t.$inject=["$locale"],Wt.$inject=["$locale"];var Sn=".",_n={yyyy:qt("FullYear",4),yy:qt("FullYear",2,0,!0),y:qt("FullYear",1),MMMM:Zt("Month"),MMM:Zt("Month",!0),MM:qt("Month",2,1),M:qt("Month",1,1),dd:qt("Date",2),d:qt("Date",1),HH:qt("Hours",2),H:qt("Hours",1),hh:qt("Hours",2,-12),h:qt("Hours",1,-12),mm:qt("Minutes",2),m:qt("Minutes",1),ss:qt("Seconds",2),s:qt("Seconds",1),sss:qt("Milliseconds",3),EEEE:Zt("Day"),EEE:Zt("Day",!0),a:Jt,Z:Yt},In=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,Dn=/^\-?\d+$/;Qt.$inject=["$locale"];var Mn=g(gi),An=g(vi);ii.$inject=["$parse"];var Nn=g({restrict:"E",compile:function(e,i){if(bi<=8&&(i.href||i.name||i.$set("href",""),e.append(t.createComment("IE fix"))),!i.href&&!i.xlinkHref&&!i.name)return function(e,t){var i="[object SVGAnimatedString]"===Si.call(t.prop("href"))?"xlink:href":"href";t.on("click",function(e){t.attr(i)||e.preventDefault()})}}}),Pn={};o(Zi,function(e,t){if("multiple"!=e){var i=ze("ng-"+t);Pn[i]=function(){return{priority:100,link:function(e,n,r){e.$watch(r[i],function(e){r.$set(t,!!e)})}}}}}),o(["src","srcset","href"],function(e){var t=ze("ng-"+e);Pn[t]=function(){return{priority:99,link:function(i,n,r){var o=e,s=e;"href"===e&&"[object SVGAnimatedString]"===Si.call(n.prop("href"))&&(s="xlinkHref",r.$attr[s]="xlink:href",o=null),r.$observe(t,function(t){return t?(r.$set(s,t),void(bi&&o&&n.prop(o,r[s]))):void("href"===e&&r.$set(s,null))})}}}});var kn={$addControl:f,$removeControl:f,$setValidity:f,$setDirty:f,$setPristine:f};ri.$inject=["$element","$attrs","$scope","$animate"];var Hn=function(e){return["$timeout",function(t){var n={name:"form",restrict:e?"EAC":"E",controller:ri,compile:function(){return{pre:function(e,n,r,o){if(!r.action){var s=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};Bi(n[0],"submit",s),n.on("$destroy",function(){t(function(){Ki(n[0],"submit",s)},0,!1)})}var a=n.parent().controller("form"),l=r.name||r.ngForm;l&&Ct(e,l,o,l),a&&n.on("$destroy",function(){a.$removeControl(o),l&&Ct(e,l,i,l),h(o,kn)})}}}};return n}]},Fn=Hn(),Bn=Hn(!0),Kn=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,zn=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,Un=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Vn={text:li,number:ui,url:ci,email:hi,radio:di,checkbox:pi,hidden:f,button:f,submit:f,reset:f,file:f},Gn=["badInput"],$n=["$browser","$sniffer",function(e,t){return{restrict:"E",require:"?ngModel",link:function(i,n,r,o){o&&(Vn[gi(r.type)]||Vn.text)(i,n,r,o,t,e)}}}],Wn="ng-valid",jn="ng-invalid",Xn="ng-pristine",qn="ng-dirty",Zn=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(e,t,i,r,s,a){function l(e,t){t=t?"-"+Q(t,"-"):"",a.removeClass(r,(e?jn:Wn)+t),a.addClass(r,(e?Wn:jn)+t)}this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$name=i.name;var u=s(i.ngModel),c=u.assign;if(!c)throw n("ngModel")("nonassign","Expression '{0}' is non-assignable. Element: {1}",i.ngModel,$(r));this.$render=f,this.$isEmpty=function(e){return y(e)||""===e||null===e||e!==e};var h=r.inheritedData("$formController")||kn,d=0,p=this.$error={};r.addClass(Xn),l(!0),this.$setValidity=function(e,t){p[e]!==!t&&(t?(p[e]&&d--,d||(l(!0),this.$valid=!0,this.$invalid=!1)):(l(!1),this.$invalid=!0,this.$valid=!1,d++),p[e]=!t,l(t,e),h.$setValidity(e,t,this))},this.$setPristine=function(){this.$dirty=!1,this.$pristine=!0,a.removeClass(r,qn),a.addClass(r,Xn)},this.$setViewValue=function(i){this.$viewValue=i,this.$pristine&&(this.$dirty=!0,this.$pristine=!1,a.removeClass(r,Xn),a.addClass(r,qn),h.$setDirty()),o(this.$parsers,function(e){i=e(i)}),this.$modelValue!==i&&(this.$modelValue=i,c(e,i),o(this.$viewChangeListeners,function(e){try{e()}catch(i){t(i)}}))};var m=this;e.$watch(function(){var t=u(e);if(m.$modelValue!==t){var i=m.$formatters,n=i.length;for(m.$modelValue=t;n--;)t=i[n](t);m.$viewValue!==t&&(m.$viewValue=t,m.$render())}return t})}],Yn=function(){return{require:["ngModel","^?form"],controller:Zn,link:function(e,t,i,n){var r=n[0],o=n[1]||kn;o.$addControl(r),e.$on("$destroy",function(){o.$removeControl(r)})}}},Jn=g({require:"ngModel",link:function(e,t,i,n){n.$viewChangeListeners.push(function(){e.$eval(i.ngChange)})}}),Qn=function(){return{require:"?ngModel",link:function(e,t,i,n){if(n){i.required=!0;var r=function(e){return i.required&&n.$isEmpty(e)?void n.$setValidity("required",!1):(n.$setValidity("required",!0),e)};n.$formatters.push(r),n.$parsers.unshift(r),i.$observe("required",function(){r(n.$viewValue)})}}}},er=function(){return{require:"ngModel",link:function(e,t,n,r){var s=/\/(.*)\//.exec(n.ngList),a=s&&new RegExp(s[1])||n.ngList||",",l=function(e){if(!y(e)){var t=[];return e&&o(e.split(a),function(e){e&&t.push(Ai(e))}),t}};r.$parsers.push(l),r.$formatters.push(function(e){return Mi(e)?e.join(", "):i}),r.$isEmpty=function(e){return!e||!e.length}}}},tr=/^(true|false|\d+)$/,ir=function(){return{priority:100,compile:function(e,t){return tr.test(t.ngValue)?function(e,t,i){i.$set("value",e.$eval(i.ngValue))}:function(e,t,i){e.$watch(i.ngValue,function(e){i.$set("value",e)})}}}},nr=ni({compile:function(e){return e.addClass("ng-binding"),function(e,t,n){t.data("$binding",n.ngBind),e.$watch(n.ngBind,function(e){t.text(e==i?"":e)})}}}),rr=["$interpolate",function(e){return function(t,i,n){var r=e(i.attr(n.$attr.ngBindTemplate));i.addClass("ng-binding").data("$binding",r),n.$observe("ngBindTemplate",function(e){i.text(e)})}}],or=["$sce","$parse",function(e,t){return{compile:function(i){return i.addClass("ng-binding"),function(i,n,r){function o(){return(s(i)||"").toString()}n.data("$binding",r.ngBindHtml);var s=t(r.ngBindHtml);i.$watch(o,function(t){n.html(e.getTrustedHtml(s(i))||"")})}}}}],sr=fi("",!0),ar=fi("Odd",0),lr=fi("Even",1),ur=ni({compile:function(e,t){t.$set("ngCloak",i),e.removeClass("ng-cloak")}}),cr=[function(){return{scope:!0,controller:"@",priority:500}}],hr={},dr={blur:!0,focus:!0};o("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(e){var t=ze("ng-"+e);hr[t]=["$parse","$rootScope",function(i,n){return{compile:function(r,o){var s=i(o[t],!0);return function(t,i){i.on(e,function(i){var r=function(){s(t,{$event:i})};dr[e]&&n.$$phase?t.$evalAsync(r):t.$apply(r)})}}}}]});var pr=["$animate",function(e){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(i,n,r,o,s){var a,l,u;i.$watch(r.ngIf,function(o){G(o)?l||(l=i.$new(),s(l,function(i){i[i.length++]=t.createComment(" end ngIf: "+r.ngIf+" "),a={clone:i},e.enter(i,n.parent(),n)})):(u&&(u.remove(),u=null),l&&(l.$destroy(),l=null),a&&(u=oe(a.clone),e.leave(u,function(){u=null}),a=null))})}}}],fr=["$http","$templateCache","$anchorScroll","$animate","$sce",function(e,t,i,n,r){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:Ii.noop,compile:function(o,s){var a=s.ngInclude||s.src,l=s.onload||"",u=s.autoscroll;return function(o,s,c,h,d){var p,f,m,g=0,y=function(){f&&(f.remove(),f=null),p&&(p.$destroy(),p=null),m&&(n.leave(m,function(){f=null}),f=m,m=null)};o.$watch(r.parseAsResourceUrl(a),function(r){var a=function(){!v(u)||u&&!o.$eval(u)||i()},c=++g;r?(e.get(r,{cache:t}).success(function(e){if(c===g){var t=o.$new();h.template=e;var i=d(t,function(e){y(),n.enter(e,null,s,a)});p=t,m=i,p.$emit("$includeContentLoaded"),o.$eval(l)}}).error(function(){c===g&&y()}),o.$emit("$includeContentRequested")):(y(),h.template=null)})}}}}],mr=["$compile",function(e){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(t,i,n,r){i.html(r.template),e(i.contents())(t)}}}],gr=ni({priority:450,compile:function(){return{pre:function(e,t,i){e.$eval(i.ngInit)}}}}),yr=ni({terminal:!0,priority:1e3}),vr=["$locale","$interpolate",function(e,t){var i=/{}/g;return{restrict:"EA",link:function(n,r,s){var a=s.count,l=s.$attr.when&&r.attr(s.$attr.when),u=s.offset||0,c=n.$eval(l)||{},h={},d=t.startSymbol(),p=t.endSymbol(),f=/^when(Minus)?(.+)$/;o(s,function(e,t){f.test(t)&&(c[gi(t.replace("when","").replace("Minus","-"))]=r.attr(s.$attr[t]))}),o(c,function(e,n){h[n]=t(e.replace(i,d+a+"-"+u+p))}),n.$watch(function(){var t=parseFloat(n.$eval(a));return isNaN(t)?"":(t in c||(t=e.pluralCat(t-u)),h[t](n,r,!0))},function(e){r.text(e)})}}}],Er=["$parse","$animate",function(e,i){function s(e){return e.clone[0]}function a(e){return e.clone[e.clone.length-1]}var l="$$NG_REMOVED",u=n("ngRepeat");return{transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,link:function(n,c,h,d,p){var f,m,g,y,v,E,T,b,C,O=h.ngRepeat,x=O.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),w={$id:Ie};if(!x)throw u("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",O);if(E=x[1],T=x[2],f=x[3],f?(m=e(f),g=function(e,t,i){return C&&(w[C]=e),w[b]=t,w.$index=i,m(n,w)}):(y=function(e,t){return Ie(t)},v=function(e){return e}),x=E.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!x)throw u("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",E);b=x[3]||x[1],C=x[2];var R={};n.$watchCollection(T,function(e){var h,d,f,m,E,T,x,w,L,S,_,I,D=c[0],M={},A=[];if(r(e))S=e,L=g||y;else{L=g||v,S=[];for(T in e)e.hasOwnProperty(T)&&"$"!=T.charAt(0)&&S.push(T);S.sort()}for(m=S.length,d=A.length=S.length,h=0;h<d;h++)if(T=e===S?h:S[h],x=e[T],w=L(T,x,h),ne(w,"`track by` id"),R.hasOwnProperty(w))_=R[w],delete R[w],M[w]=_,A[h]=_;else{if(M.hasOwnProperty(w))throw o(A,function(e){e&&e.scope&&(R[e.id]=e)}),u("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",O,w,U(x));A[h]={id:w},M[w]=!1}for(T in R)R.hasOwnProperty(T)&&(_=R[T],I=oe(_.clone),i.leave(I),o(I,function(e){e[l]=!0}),_.scope.$destroy());for(h=0,d=S.length;h<d;h++){if(T=e===S?h:S[h],x=e[T],_=A[h],A[h-1]&&(D=a(A[h-1])),_.scope){E=_.scope,f=D;do f=f.nextSibling;while(f&&f[l]);s(_)!=f&&i.move(oe(_.clone),null,Ci(D)),D=a(_)}else E=n.$new();E[b]=x,C&&(E[C]=T),E.$index=h,E.$first=0===h,E.$last=h===m-1,E.$middle=!(E.$first||E.$last),E.$odd=!(E.$even=0===(1&h)),_.scope||p(E,function(e){e[e.length++]=t.createComment(" end ngRepeat: "+O+" "),i.enter(e,null,Ci(D)),D=e,_.scope=E,_.clone=e,M[_.id]=_})}R=M})}}}],Tr=["$animate",function(e){return function(t,i,n){t.$watch(n.ngShow,function(t){e[G(t)?"removeClass":"addClass"](i,"ng-hide")})}}],br=["$animate",function(e){return function(t,i,n){t.$watch(n.ngHide,function(t){e[G(t)?"addClass":"removeClass"](i,"ng-hide")})}}],Cr=ni(function(e,t,i){e.$watch(i.ngStyle,function(e,i){i&&e!==i&&o(i,function(e,i){t.css(i,"")}),e&&t.css(e)},!0)}),Or=["$animate",function(e){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(t,i,n,r){var s=n.ngSwitch||n.on,a=[],l=[],u=[],c=[];t.$watch(s,function(i){var s,h;for(s=0,h=u.length;s<h;++s)u[s].remove();for(u.length=0,s=0,h=c.length;s<h;++s){var d=l[s];c[s].$destroy(),u[s]=d,e.leave(d,function(){u.splice(s,1)})}l.length=0,c.length=0,(a=r.cases["!"+i]||r.cases["?"])&&(t.$eval(n.change),o(a,function(i){var n=t.$new();c.push(n),i.transclude(n,function(t){var n=i.element;l.push(t),e.enter(t,n.parent(),n)})}))})}}}],xr=ni({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,i,n,r){n.cases["!"+i.ngSwitchWhen]=n.cases["!"+i.ngSwitchWhen]||[],n.cases["!"+i.ngSwitchWhen].push({transclude:r,element:t})}}),wr=ni({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,i,n,r){n.cases["?"]=n.cases["?"]||[],n.cases["?"].push({transclude:r,element:t})}}),Rr=ni({link:function(e,t,i,r,o){if(!o)throw n("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",$(t));o(function(e){t.empty(),t.append(e)})}}),Lr=["$templateCache",function(e){return{restrict:"E",terminal:!0,compile:function(t,i){if("text/ng-template"==i.type){var n=i.id,r=t[0].text;e.put(n,r)}}}}],Sr=n("ngOptions"),_r=g({terminal:!0}),Ir=["$compile","$parse",function(e,n){var r=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,a={$setViewValue:f};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(e,t,i){var n,r,o=this,s={},l=a;o.databound=i.ngModel,o.init=function(e,t,i){l=e,n=t,r=i},o.addOption=function(t){ne(t,'"option value"'),s[t]=!0,l.$viewValue==t&&(e.val(t),r.parent()&&r.remove())},o.removeOption=function(e){this.hasOption(e)&&(delete s[e],l.$viewValue==e&&this.renderUnknownOption(e))},o.renderUnknownOption=function(t){var i="? "+Ie(t)+" ?";r.val(i),e.prepend(r),e.val(i),r.prop("selected",!0)},o.hasOption=function(e){return s.hasOwnProperty(e)},t.$on("$destroy",function(){o.renderUnknownOption=f})}],link:function(a,l,u,c){function h(e,t,i,n){i.$render=function(){var e=i.$viewValue;n.hasOption(e)?(x.parent()&&x.remove(),t.val(e),""===e&&f.prop("selected",!0)):y(e)&&f?t.val(""):n.renderUnknownOption(e)},t.on("change",function(){e.$apply(function(){x.parent()&&x.remove(),i.$setViewValue(t.val())})})}function d(e,t,i){var n;i.$render=function(){var e=new De(i.$viewValue);o(t.find("option"),function(t){t.selected=v(e.get(t.value))})},e.$watch(function(){H(n,i.$viewValue)||(n=k(i.$viewValue),i.$render())}),t.on("change",function(){e.$apply(function(){var e=[];o(t.find("option"),function(t){t.selected&&e.push(t.value)}),i.$setViewValue(e)})})}function p(t,o,a){function l(){var e=!1;if(E){var i=a.$modelValue;if(w&&Mi(i)){e=new De([]);for(var n={},r=0;r<i.length;r++)n[d]=i[r],e.put(w(t,n),i[r])}else e=new De(i)}return e}function u(){var e,i,n,r,u,c,T,x,L,S,_,I,D,M,A,N={"":[]},P=[""],k=a.$modelValue,H=y(t)||[],F=p?s(H):H,B={},K=l();for(_=0;L=F.length,_<L;_++){if(T=_,p){if(T=F[_],"$"===T.charAt(0))continue;B[p]=T}if(B[d]=H[T],e=f(t,B)||"",(i=N[e])||(i=N[e]=[],P.push(e)),E)I=v(K.remove(w?w(t,B):g(t,B)));else{if(w){var z={};z[d]=k,I=w(t,z)===w(t,B)}else I=k===g(t,B);K=K||I}A=h(t,B),A=v(A)?A:"",i.push({id:w?w(t,B):p?F[_]:_,label:A,selected:I})}for(E||(b||null===k?N[""].unshift({id:"",label:"",selected:!K}):K||N[""].unshift({id:"?",label:"",selected:!0})),S=0,x=P.length;S<x;S++){for(e=P[S],i=N[e],R.length<=S?(r={element:O.clone().attr("label",e),label:i.label},u=[r],R.push(u),o.append(r.element)):(u=R[S],r=u[0],r.label!=e&&r.element.attr("label",r.label=e)),D=null,_=0,L=i.length;_<L;_++)n=i[_],(c=u[_+1])?(D=c.element,c.label!==n.label&&(D.text(c.label=n.label),D.prop("label",c.label)),c.id!==n.id&&D.val(c.id=n.id),D[0].selected!==n.selected&&(D.prop("selected",c.selected=n.selected),bi&&D.prop("selected",c.selected))):(""===n.id&&b?M=b:(M=C.clone()).val(n.id).prop("selected",n.selected).attr("selected",n.selected).prop("label",n.label).text(n.label),u.push(c={element:M,label:n.label,id:n.id,selected:n.selected}),m.addOption(n.label,M),D?D.after(M):r.element.append(M),D=M);for(_++;u.length>_;)n=u.pop(),m.removeOption(n.label),n.element.remove()}for(;R.length>S;)R.pop()[0].element.remove()}var c;if(!(c=T.match(r)))throw Sr("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",T,$(o));var h=n(c[2]||c[1]),d=c[4]||c[6],p=c[5],f=n(c[3]||""),g=n(c[2]?c[1]:d),y=n(c[7]),x=c[8],w=x?n(c[8]):null,R=[[{element:o,label:""}]];b&&(e(b)(t),b.removeClass("ng-scope"),b.remove()),o.empty(),o.on("change",function(){t.$apply(function(){var e,n,r,s,l,c,h,f,m,v=y(t)||[],T={};if(E){for(r=[],c=0,f=R.length;c<f;c++)for(e=R[c],l=1,h=e.length;l<h;l++)if((s=e[l].element)[0].selected){if(n=s.val(),p&&(T[p]=n),w)for(m=0;m<v.length&&(T[d]=v[m],w(t,T)!=n);m++);else T[d]=v[n];r.push(g(t,T))}}else if(n=o.val(),"?"==n)r=i;else if(""===n)r=null;else if(w){for(m=0;m<v.length;m++)if(T[d]=v[m],w(t,T)==n){r=g(t,T);break}}else T[d]=v[n],p&&(T[p]=n),r=g(t,T);a.$setViewValue(r),u()})}),a.$render=u,t.$watchCollection(y,u),t.$watchCollection(function(){var e={},i=y(t);if(i){for(var n=new Array(i.length),r=0,o=i.length;r<o;r++)e[d]=i[r],n[r]=h(t,e);return n}},u),E&&t.$watchCollection(function(){return a.$modelValue},u)}if(c[1]){for(var f,m=c[0],g=c[1],E=u.multiple,T=u.ngOptions,b=!1,C=Ci(t.createElement("option")),O=Ci(t.createElement("optgroup")),x=C.clone(),w=0,R=l.children(),L=R.length;w<L;w++)if(""===R[w].value){f=b=R.eq(w);break}m.init(g,b,x),E&&(g.$isEmpty=function(e){return!e||0===e.length}),T?p(a,l,g):E?d(a,l,g):h(a,l,g,m)}}}}],Dr=["$interpolate",function(e){var t={addOption:f,removeOption:f};return{restrict:"E",priority:100,compile:function(i,n){if(y(n.value)){var r=e(i.text(),!0);r||n.$set("value",i.text())}return function(e,i,n){var o="$selectController",s=i.parent(),a=s.data(o)||s.parent().data(o);a&&a.databound?i.prop("selected",!1):a=t,r?e.$watch(r,function(e,t){n.$set("value",e),e!==t&&a.removeOption(t),a.addOption(e)}):a.addOption(n.value),i.on("$destroy",function(){a.removeOption(n.value)})}}}}],Mr=g({restrict:"E",terminal:!0});return e.angular.bootstrap?void console.log("WARNING: Tried to load angular more than once."):(ee(),ae(Ii),void Ci(t).ready(function(){Y(t,J)}))}(window,document),!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>'),function(e,t,i){"use strict";t.module("ngAnimate",["ng"]).directive("ngAnimateChildren",function(){var e="$$ngAnimateChildren";return function(i,n,r){var o=r.ngAnimateChildren;t.isString(o)&&0===o.length?n.data(e,!0):i.$watch(o,function(t){n.data(e,!!t)})}}).factory("$$animateReflow",["$$rAF","$document",function(e,t){var i=t[0].body;return function(t){return e(function(){t(i.offsetWidth)})}}]).config(["$provide","$animateProvider",function(n,r){function o(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.nodeType==d)return i}}function s(e){return e&&t.element(e)}function a(e){return t.element(o(e))}function l(e,t){return o(e)==o(t)}var u=t.noop,c=t.forEach,h=r.$$selectors,d=1,p="$$ngAnimateState",f="$$ngAnimateChildren",m="ng-animate",g={running:!0};n.decorator("$animate",["$delegate","$injector","$sniffer","$rootElement","$$asyncCallback","$rootScope","$document",function(e,i,n,d,y,v,E){function T(e){var t=e.data(p)||{};t.running=!0,e.data(p,t)}function b(e){if(e){var t=[],r={},o=e.substr(1).split(".");(n.transitions||n.animations)&&t.push(i.get(h[""]));for(var s=0;s<o.length;s++){var a=o[s],l=h[a];l&&!r[a]&&(t.push(i.get(l)),r[a]=!0)}return t}}function C(e,i,n){function r(e,t){var i=e[t],n=e["before"+t.charAt(0).toUpperCase()+t.substr(1)];if(i||n)return"leave"==t&&(n=i,i=null),T.push({event:t,fn:i}),y.push({event:t,fn:n}),!0}function o(t,i,r){function o(e){if(i){if((i[e]||u)(),++h<s.length)return;i=null}r()}var s=[];c(t,function(e){e.fn&&s.push(e)});var h=0;c(s,function(t,r){var s=function(){o(r)};switch(t.event){case"setClass":i.push(t.fn(e,a,l,s));break;case"addClass":i.push(t.fn(e,a||n,s));break;case"removeClass":i.push(t.fn(e,l||n,s));break;default:i.push(t.fn(e,s))}}),i&&0===i.length&&r()}var s=e[0];if(s){var a,l,h="setClass"==i,d=h||"addClass"==i||"removeClass"==i;t.isArray(n)&&(a=n[0],l=n[1],n=a+" "+l);var p=e.attr("class"),f=p+" "+n;if(_(f)){var m=u,g=[],y=[],v=u,E=[],T=[],C=(" "+f).replace(/\s+/g,".");return c(b(C),function(e){var t=r(e,i);!t&&h&&(r(e,"addClass"),r(e,"removeClass"))}),{node:s,event:i,className:n,isClassBased:d,isSetClassOperation:h,before:function(e){m=e,o(y,g,function(){m=u,e()})},after:function(e){v=e,o(T,E,function(){v=u,e()})},cancel:function(){g&&(c(g,function(e){(e||u)(!0)}),m(!0)),E&&(c(E,function(e){(e||u)(!0)}),v(!0))}}}}}function O(e,i,n,r,o,s,a){function l(t){var r="$animate:"+t;E&&E[r]&&E[r].length>0&&y(function(){n.triggerHandler(r,{event:e,className:i})})}function u(){l("before")}function h(){l("after")}function d(){l("close"),a&&y(function(){a()})}function f(){f.hasBeenRun||(f.hasBeenRun=!0,s())}function g(){if(!g.hasBeenRun){g.hasBeenRun=!0;var t=n.data(p);t&&(v&&v.isClassBased?w(n,i):(y(function(){var t=n.data(p)||{};A==t.index&&w(n,i,e)}),n.data(p,t))),d()}}var v=C(n,e,i);if(!v)return f(),u(),h(),void g();i=v.className;var E=t.element._data(v.node);E=E&&E.events,r||(r=o?o.parent():n.parent());var T,b=n.data(p)||{},O=b.active||{},x=b.totalActive||0,S=b.last;if(v.isClassBased&&(T=b.running||b.disabled||S&&!S.isClassBased),T||R(n,r))return f(),u(),h(),void g();var _=!1;if(x>0){var I=[];if(v.isClassBased){if("setClass"==S.event)I.push(S),w(n,i);else if(O[i]){var D=O[i];D.event==e?_=!0:(I.push(D),w(n,i))}}else if("leave"==e&&O["ng-leave"])_=!0;else{for(var M in O)I.push(O[M]),w(n,M);O={},x=0}I.length>0&&c(I,function(e){e.cancel()})}if(!v.isClassBased||v.isSetClassOperation||_||(_="addClass"==e==n.hasClass(i)),_)return f(),u(),h(),void d();"leave"==e&&n.one("$destroy",function(e){var i=t.element(this),n=i.data(p);if(n){var r=n.active["ng-leave"];r&&(r.cancel(),w(i,"ng-leave"))}}),n.addClass(m);var A=L++;x++,O[i]=v,n.data(p,{last:v,active:O,index:A,totalActive:x}),u(),v.before(function(t){var r=n.data(p);t=t||!r||!r.active[i]||v.isClassBased&&r.active[i].event!=e,f(),t===!0?g():(h(),v.after(g))})}function x(e){var i=o(e);if(i){var n=t.isFunction(i.getElementsByClassName)?i.getElementsByClassName(m):i.querySelectorAll("."+m);c(n,function(e){e=t.element(e);var i=e.data(p);i&&i.active&&c(i.active,function(e){e.cancel()})})}}function w(e,t){if(l(e,d))g.disabled||(g.running=!1,g.structural=!1);else if(t){var i=e.data(p)||{},n=t===!0;!n&&i.active&&i.active[t]&&(i.totalActive--,delete i.active[t]),!n&&i.totalActive||(e.removeClass(m),e.removeData(p))}}function R(e,i){if(g.disabled)return!0;if(l(e,d))return g.running;var n,r,o;do{if(0===i.length)break;var s=l(i,d),a=s?g:i.data(p)||{};if(a.disabled)return!0;if(s&&(o=!0),n!==!1){var u=i.data(f);t.isDefined(u)&&(n=u)}r=r||a.running||a.last&&!a.last.isClassBased}while(i=i.parent());return!o||!n&&r}var L=0;d.data(p,g),v.$$postDigest(function(){v.$$postDigest(function(){g.running=!1})});var S=r.classNameFilter(),_=S?function(e){return S.test(e)}:function(){return!0};return{enter:function(i,n,r,o){i=t.element(i),n=s(n),r=s(r),T(i),e.enter(i,n,r),v.$$postDigest(function(){i=a(i),O("enter","ng-enter",i,n,r,u,o)})},leave:function(i,n){i=t.element(i),x(i),T(i),v.$$postDigest(function(){O("leave","ng-leave",a(i),null,null,function(){e.leave(i)},n)})},move:function(i,n,r,o){i=t.element(i),n=s(n),r=s(r),x(i),T(i),e.move(i,n,r),v.$$postDigest(function(){i=a(i),O("move","ng-move",i,n,r,u,o)})},addClass:function(i,n,r){i=t.element(i),i=a(i),O("addClass",n,i,null,null,function(){e.addClass(i,n)},r)},removeClass:function(i,n,r){i=t.element(i),i=a(i),O("removeClass",n,i,null,null,function(){e.removeClass(i,n)},r)},setClass:function(i,n,r,o){i=t.element(i),i=a(i),O("setClass",[n,r],i,null,null,function(){e.setClass(i,n,r)},o)},enabled:function(e,t){switch(arguments.length){case 2:if(e)w(t);else{var i=t.data(p)||{};i.disabled=!0,t.data(p,i)}break;case 1:g.disabled=!e;break;default:e=!g.disabled}return!!e}}}]),r.register("",["$window","$sniffer","$timeout","$$animateReflow",function(n,r,s,a){function l(){k||(k=a(function(){q=[],k=null,j={}}))}function h(e,t){k&&k(),q.push(t),k=a(function(){c(q,function(e){e()}),q=[],k=null,j={}})}function p(e,i){var n=o(e);e=t.element(n),J.push(e);var r=Date.now()+i;r<=Y||(s.cancel(Z),Y=r,Z=s(function(){f(J),J=[]},i,!1))}function f(e){c(e,function(e){var t=e.data(U);t&&(t.closeAnimationFn||u)()})}function m(e,t){var i=t?j[t]:null;if(!i){var r,o,s,a,l=0,u=0,h=0,p=0;c(e,function(e){if(e.nodeType==d){var t=n.getComputedStyle(e)||{};s=t[D+H],l=Math.max(g(s),l),a=t[D+F],r=t[D+B],u=Math.max(g(r),u),o=t[A+B],p=Math.max(g(o),p);var i=g(t[A+H]);i>0&&(i*=parseInt(t[A+K],10)||1),h=Math.max(i,h)}}),i={total:0,transitionPropertyStyle:a,transitionDurationStyle:s,transitionDelayStyle:r,transitionDelay:u,transitionDuration:l,animationDelayStyle:o,animationDelay:p,animationDuration:h},t&&(j[t]=i)}return i}function g(e){var i=0,n=t.isString(e)?e.split(/\s*,\s*/):[];return c(n,function(e){i=Math.max(parseFloat(e)||0,i)}),i}function y(e){var t=e.parent(),i=t.data(z);return i||(t.data(z,++X),i=X),i+"-"+o(e).getAttribute("class")}function v(e,t,i,n){var r=y(t),o=r+" "+i,s=j[o]?++j[o].total:0,a={};if(s>0){var l=i+"-stagger",c=r+" "+l,h=!j[c];h&&t.addClass(l),a=m(t,c),h&&t.removeClass(l)}n=n||function(e){return e()},t.addClass(i);var d=t.data(U)||{},p=n(function(){return m(t,o)}),f=p.transitionDuration,g=p.animationDuration;if(0===f&&0===g)return t.removeClass(i),!1;t.data(U,{running:d.running||0,itemIndex:s,stagger:a,timings:p,closeAnimationFn:u});var v=d.running>0||"setClass"==e;return f>0&&T(t,i,v),g>0&&a.animationDelay>0&&0===a.animationDuration&&b(t),!0}function E(e){return"ng-enter"==e||"ng-move"==e||"ng-leave"==e}function T(e,t,i){E(t)||!i?o(e).style[D+F]="none":e.addClass(V)}function b(e){o(e).style[A]="none 0s"}function C(e,t){var i=D+F,n=o(e);n.style[i]&&n.style[i].length>0&&(n.style[i]=""),e.removeClass(V)}function O(e){var t=A,i=o(e);i.style[t]&&i.style[t].length>0&&(i.style[t]="")}function x(e,t,i,n){function r(e){t.off(E,s),t.removeClass(u),_(t,i);var n=o(t);for(var r in b)n.style.removeProperty(b[r])}function s(e){e.stopPropagation();var t=e.originalEvent||e,i=t.$manualTimeStamp||Date.now(),r=parseFloat(t.elapsedTime.toFixed(G));Math.max(i-v,0)>=y&&r>=m&&n()}var a=o(t),l=t.data(U);if(a.getAttribute("class").indexOf(i)==-1||!l)return void n();var u="";c(i.split(" "),function(e,t){u+=(t>0?" ":"")+e+"-active"});var h=l.stagger,d=l.timings,f=l.itemIndex,m=Math.max(d.transitionDuration,d.animationDuration),g=Math.max(d.transitionDelay,d.animationDelay),y=g*W,v=Date.now(),E=N+" "+M,T="",b=[];if(d.transitionDuration>0){var C=d.transitionPropertyStyle;C.indexOf("all")==-1&&(T+=P+"transition-property: "+C+";",T+=P+"transition-duration: "+d.transitionDurationStyle+";",b.push(P+"transition-property"),b.push(P+"transition-duration"))}if(f>0){if(h.transitionDelay>0&&0===h.transitionDuration){var O=d.transitionDelayStyle;T+=P+"transition-delay: "+w(O,h.transitionDelay,f)+"; ",b.push(P+"transition-delay")}h.animationDelay>0&&0===h.animationDuration&&(T+=P+"animation-delay: "+w(d.animationDelayStyle,h.animationDelay,f)+"; ",b.push(P+"animation-delay"))}if(b.length>0){var x=a.getAttribute("style")||"";a.setAttribute("style",x+"; "+T)}t.on(E,s),t.addClass(u),l.closeAnimationFn=function(){r(),n()};var R=f*(Math.max(h.animationDelay,h.transitionDelay)||0),L=(g+m)*$,S=(R+L)*W;return l.running++,p(t,S),r}function w(e,t,i){var n="";return c(e.split(","),function(e,r){n+=(r>0?",":"")+(i*t+parseInt(e,10))+"s"}),n}function R(e,t,i,n){if(v(e,t,i,n))return function(e){e&&_(t,i)}}function L(e,t,i,n){return t.data(U)?x(e,t,i,n):(_(t,i),
void n())}function S(e,t,i,n){var r=R(e,t,i);if(!r)return l(),void n();var o=r;return h(t,function(){C(t,i),O(t),o=L(e,t,i,n)}),function(e){(o||u)(e)}}function _(e,t){e.removeClass(t);var i=e.data(U);i&&(i.running&&i.running--,i.running&&0!==i.running||e.removeData(U))}function I(e,i){var n="";return e=t.isArray(e)?e:e.split(/\s+/),c(e,function(e,t){e&&e.length>0&&(n+=(t>0?" ":"")+e+i)}),n}var D,M,A,N,P="";e.ontransitionend===i&&e.onwebkittransitionend!==i?(P="-webkit-",D="WebkitTransition",M="webkitTransitionEnd transitionend"):(D="transition",M="transitionend"),e.onanimationend===i&&e.onwebkitanimationend!==i?(P="-webkit-",A="WebkitAnimation",N="webkitAnimationEnd animationend"):(A="animation",N="animationend");var k,H="Duration",F="Property",B="Delay",K="IterationCount",z="$$ngAnimateKey",U="$$ngAnimateCSS3Data",V="ng-animate-block-transitions",G=3,$=1.5,W=1e3,j={},X=0,q=[],Z=null,Y=0,J=[];return{enter:function(e,t){return S("enter",e,"ng-enter",t)},leave:function(e,t){return S("leave",e,"ng-leave",t)},move:function(e,t){return S("move",e,"ng-move",t)},beforeSetClass:function(e,t,i,n){var r=I(i,"-remove")+" "+I(t,"-add"),o=R("setClass",e,r,function(n){var r=e.attr("class");e.removeClass(i),e.addClass(t);var o=n();return e.attr("class",r),o});return o?(h(e,function(){C(e,r),O(e),n()}),o):(l(),void n())},beforeAddClass:function(e,t,i){var n=R("addClass",e,I(t,"-add"),function(i){e.addClass(t);var n=i();return e.removeClass(t),n});return n?(h(e,function(){C(e,t),O(e),i()}),n):(l(),void i())},setClass:function(e,t,i,n){i=I(i,"-remove"),t=I(t,"-add");var r=i+" "+t;return L("setClass",e,r,n)},addClass:function(e,t,i){return L("addClass",e,I(t,"-add"),i)},beforeRemoveClass:function(e,t,i){var n=R("removeClass",e,I(t,"-remove"),function(i){var n=e.attr("class");e.removeClass(t);var r=i();return e.attr("class",n),r});return n?(h(e,function(){C(e,t),O(e),i()}),n):void i()},removeClass:function(e,t,i){return L("removeClass",e,I(t,"-remove"),i)}}}])}])}(window,window.angular),function(e,t,i){"use strict";t.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(e,n){function r(){var e,r,o,l;for(e in a)c(s[e])&&n.cookies(e,i);for(e in s)r=s[e],t.isString(r)||(r=""+r,s[e]=r),r!==a[e]&&(n.cookies(e,r),l=!0);if(l){l=!1,o=n.cookies();for(e in s)s[e]!==o[e]&&(c(o[e])?delete s[e]:s[e]=o[e],l=!0)}}var o,s={},a={},l=!1,u=t.copy,c=t.isUndefined;return n.addPollFn(function(){var t=n.cookies();o!=t&&(o=t,u(t,a),u(t,s),l&&e.$apply())})(),l=!0,e.$watch(r),s}]).factory("$cookieStore",["$cookies",function(e){return{get:function(i){var n=e[i];return n?t.fromJson(n):n},put:function(i,n){e[i]=t.toJson(n)},remove:function(t){delete e[t]}}}])}(window,window.angular),function(e,t,i){"use strict";function n(){this.$get=["$$sanitizeUri",function(e){return function(t){var i=[];return s(t,u(i,function(t,i){return!/^unsafe/.test(e(t,i))})),i.join("")}}]}function r(e){var i=[],n=u(i,t.noop);return n.chars(e),i.join("")}function o(e){var t,i={},n=e.split(",");for(t=0;t<n.length;t++)i[n[t]]=!0;return i}function s(e,i){function n(e,n,o,s){if(n=t.lowercase(n),w[n])for(;E.last()&&R[E.last()];)r("",E.last());x[n]&&E.last()==n&&r("",n),s=b[n]||!!s,s||E.push(n);var l={};o.replace(p,function(e,t,i,n,r){var o=i||n||r||"";l[t]=a(o)}),i.start&&i.start(n,l,s)}function r(e,n){var r,o=0;if(n=t.lowercase(n))for(o=E.length-1;o>=0&&E[o]!=n;o--);if(o>=0){for(r=E.length-1;r>=o;r--)i.end&&i.end(E[r]);E.length=o}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var o,s,l,u,E=[],T=e;for(E.last=function(){return E[E.length-1]};e;){if(u="",s=!0,E.last()&&L[E.last()]?(e=e.replace(new RegExp("(.*)<\\s*\\/\\s*"+E.last()+"[^>]*>","i"),function(e,t){return t=t.replace(g,"$1").replace(v,"$1"),i.chars&&i.chars(a(t)),""}),r("",E.last())):(0===e.indexOf("<!--")?(o=e.indexOf("--",4),o>=0&&e.lastIndexOf("-->",o)===o&&(i.comment&&i.comment(e.substring(4,o)),e=e.substring(o+3),s=!1)):y.test(e)?(l=e.match(y),l&&(e=e.replace(l[0],""),s=!1)):m.test(e)?(l=e.match(d),l&&(e=e.substring(l[0].length),l[0].replace(d,r),s=!1)):f.test(e)&&(l=e.match(h),l?(l[4]&&(e=e.substring(l[0].length),l[0].replace(h,n)),s=!1):(u+="<",e=e.substring(1))),s&&(o=e.indexOf("<"),u+=o<0?e:e.substring(0,o),e=o<0?"":e.substring(o),i.chars&&i.chars(a(u)))),e==T)throw c("badparse","The sanitizer was unable to parse the following block of html: {0}",e);T=e}r()}function a(e){if(!e)return"";var t=M.exec(e),i=t[1],n=t[3],r=t[2];return r&&(D.innerHTML=r.replace(/</g,"&lt;"),r="textContent"in D?D.textContent:D.innerText),i+r+n}function l(e){return e.replace(/&/g,"&amp;").replace(E,function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(i-56320)+65536)+";"}).replace(T,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(e,i){var n=!1,r=t.bind(e,e.push);return{start:function(e,o,s){e=t.lowercase(e),!n&&L[e]&&(n=e),n||S[e]!==!0||(r("<"),r(e),t.forEach(o,function(n,o){var s=t.lowercase(o),a="img"===e&&"src"===s||"background"===s;I[s]!==!0||_[s]===!0&&!i(n,a)||(r(" "),r(o),r('="'),r(l(n)),r('"'))}),r(s?"/>":">"))},end:function(e){e=t.lowercase(e),n||S[e]!==!0||(r("</"),r(e),r(">")),e==n&&(n=!1)},chars:function(e){n||r(l(e))}}}var c=t.$$minErr("$sanitize"),h=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,d=/^<\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,f=/^</,m=/^<\//,g=/<!--(.*?)-->/g,y=/<!DOCTYPE([^>]*?)>/i,v=/<!\[CDATA\[(.*?)]]>/g,E=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,T=/([^\#-~| |!])/g,b=o("area,br,col,hr,img,wbr"),C=o("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),O=o("rp,rt"),x=t.extend({},O,C),w=t.extend({},C,o("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),R=t.extend({},O,o("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var,iframe,audio,source")),L=o("script,style"),S=t.extend({},b,w,R,x),_=o("background,cite,href,longdesc,src"),I=t.extend({},_,o("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width,controls,autoplay,style")),D=document.createElement("pre"),M=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var i=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"]/,n=/^mailto:/;return function(o,s){function a(e){e&&p.push(r(e))}function l(e,i){p.push("<a "),t.isDefined(s)&&(p.push('target="'),p.push(s),p.push('" ')),p.push('href="',e.replace('"',"&quot;"),'">'),a(i),p.push("</a>")}if(!o)return o;for(var u,c,h,d=o,p=[];u=d.match(i);)c=u[0],u[2]==u[3]&&(c="mailto:"+c),h=u.index,a(d.substr(0,h)),l(c,u[0].replace(n,"")),d=d.substring(h+u[0].length);return a(d),e(p.join(""))}}])}(window,window.angular),function(){var e=function(){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(e)return!0}catch(t){if(void 0!=navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1};if(window.XMLHttpRequest&&(window.FormData?window.XMLHttpRequest=function(e){return function(){var t=new e;return t.setRequestHeader=function(e){return function(i,n){if("__setXHR_"===i){var r=n(t);r instanceof Function&&r(t)}else e.apply(t,arguments)}}(t.setRequestHeader),t}}(window.XMLHttpRequest):(window.XMLHttpRequest=function(t){return function(){var i=new t,n=i.send;return i.__requestHeaders=[],i.open=function(e){return i.upload||(i.upload={}),i.__listeners=[],i.upload.addEventListener=function(e,t,n){i.__listeners[e]=t},function(t,n,r){e.apply(i,[t,n,r]),i.__url=n}}(i.open),i.getResponseHeader=function(e){return function(t){return i.__fileApiXHR?i.__fileApiXHR.getResponseHeader(t):e.apply(i,[t])}}(i.getResponseHeader),i.getAllResponseHeaders=function(e){return function(){return i.__fileApiXHR?i.__fileApiXHR.getAllResponseHeaders():e.apply(i)}}(i.getAllResponseHeaders),i.abort=function(e){return function(){return i.__fileApiXHR?i.__fileApiXHR.abort():null==e?null:e.apply(i)}}(i.abort),i.setRequestHeader=function(e){return function(t,n){if("__setXHR_"===t){var r=n(i);r instanceof Function&&r(i)}else e.apply(i,arguments)}}(i.setRequestHeader),i.send=function(){if(arguments[0]&&arguments[0].__isShim){var t=arguments[0],r={url:i.__url,complete:function(e,t){!e&&i.__listeners.load&&i.__listeners.load({type:"load",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),!e&&i.__listeners.loadend&&i.__listeners.loadend({type:"loadend",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),"abort"===e&&i.__listeners.abort&&i.__listeners.abort({type:"abort",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),void 0!==t.status&&Object.defineProperty(i,"status",{get:function(){return t.status}}),void 0!==t.statusText&&Object.defineProperty(i,"statusText",{get:function(){return t.statusText}}),Object.defineProperty(i,"readyState",{get:function(){return 4}}),void 0!==t.response&&Object.defineProperty(i,"response",{get:function(){return t.response}}),Object.defineProperty(i,"responseText",{get:function(){return t.responseText}}),i.__fileApiXHR=t,i.onreadystatechange()},progress:function(e){e.target=i,i.__listeners.progress&&i.__listeners.progress(e),i.__total=e.total,i.__loaded=e.loaded},headers:i.__requestHeaders};r.data={},r.files={};for(var o=0;o<t.data.length;o++){var s=t.data[o];null!=s.val&&null!=s.val.name&&null!=s.val.size&&null!=s.val.type?r.files[s.key]=s.val:r.data[s.key]=s.val}setTimeout(function(){if(!e())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';i.__fileApiXHR=FileAPI.upload(r)},1)}else n.apply(i,arguments)},i}}(window.XMLHttpRequest),window.XMLHttpRequest.__hasFlash=e()),window.XMLHttpRequest.__isShim=!0),!window.FormData){var t=function(t){if(!e())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';if(!t.__isWrapped&&(null!=t.getAttribute("ng-file-select")||null!=t.getAttribute("data-ng-file-select"))){var i=document.createElement("div");i.innerHTML='<div class="js-fileapi-wrapper" style="position:relative; overflow:hidden"></div>',i=i.firstChild;var n=t.parentNode;n.insertBefore(i,t),n.removeChild(t),i.appendChild(t),t.__isWrapped=!0}},i=function(e){return function(t){var i=FileAPI.getFiles(t);t.target||(t.target={}),t.target.files=i,t.target.files.item=function(e){return t.target.files[e]||null},e(t)}},n=function(e,t){return("change"===t.toLowerCase()||"onchange"===t.toLowerCase())&&"file"==e.getAttribute("type")};HTMLInputElement.prototype.addEventListener&&(HTMLInputElement.prototype.addEventListener=function(e){return function(r,o,s,a){n(this,r)?(t(this),e.apply(this,[r,i(o),s,a])):e.apply(this,[r,o,s,a])}}(HTMLInputElement.prototype.addEventListener)),HTMLInputElement.prototype.attachEvent&&(HTMLInputElement.prototype.attachEvent=function(e){return function(r,o){n(this,r)?(t(this),e.apply(this,[r,i(o)])):e.apply(this,[r,o])}}(HTMLInputElement.prototype.attachEvent)),window.FormData=FormData=function(){return{append:function(e,t,i){this.data.push({key:e,val:t,name:i})},data:[],__isShim:!0}},function(){if(window.FileAPI||(window.FileAPI={}),!FileAPI.upload){var t,i,n,r,o,s=document.createElement("script"),a=document.getElementsByTagName("script");if(window.FileAPI.jsUrl)t=window.FileAPI.jsUrl;else if(window.FileAPI.jsPath)i=window.FileAPI.jsPath;else for(n=0;n<a.length;n++)if(o=a[n].src,r=o.indexOf("angular-file-upload-shim.js"),r==-1&&(r=o.indexOf("angular-file-upload-shim.min.js")),r>-1){i=o.substring(0,r);break}null==FileAPI.staticPath&&(FileAPI.staticPath=i),s.setAttribute("src",t||i+"FileAPI.min.js"),document.getElementsByTagName("head")[0].appendChild(s),FileAPI.hasFlash=e()}}()}window.FileReader||(window.FileReader=function(){function e(e,i){var n={type:e,target:t,loaded:i.loaded,total:i.total,error:i.error};return null!=i.result&&(n.target.result=i.result),n}var t=this,i=!1;this.listeners={},this.addEventListener=function(e,i){t.listeners[e]=t.listeners[e]||[],t.listeners[e].push(i)},this.removeEventListener=function(e,i){t.listeners[e]&&t.listeners[e].splice(t.listeners[e].indexOf(i),1)},this.dispatchEvent=function(e){var i=t.listeners[e.type];if(i)for(var n=0;n<i.length;n++)i[n].call(t,e)},this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;var n=function(n){if(i||(i=!0,t.onloadstart&&this.onloadstart(e("loadstart",n))),"load"===n.type){t.onloadend&&t.onloadend(e("loadend",n));var r=e("load",n);t.onload&&t.onload(r),t.dispatchEvent(r)}else if("progress"===n.type){var r=e("progress",n);t.onprogress&&t.onprogress(r),t.dispatchEvent(r)}else{var r=e("error",n);t.onerror&&t.onerror(r),t.dispatchEvent(r)}};this.readAsArrayBuffer=function(e){FileAPI.readAsBinaryString(e,n)},this.readAsBinaryString=function(e){FileAPI.readAsBinaryString(e,n)},this.readAsDataURL=function(e){FileAPI.readAsDataURL(e,n)},this.readAsText=function(e){FileAPI.readAsText(e,n)}})}(),function(){var e=angular.module("angularFileUpload",[]);e.service("$upload",["$http","$timeout",function(e,t){function i(i){i.method=i.method||"POST",i.headers=i.headers||{},i.transformRequest=i.transformRequest||function(t,i){return window.ArrayBuffer&&t instanceof window.ArrayBuffer?t:e.defaults.transformRequest[0](t,i)},window.XMLHttpRequest.__isShim&&(i.headers.__setXHR_=function(){return function(e){i.__XHR=e,i.xhrFn&&i.xhrFn(e),e.upload.addEventListener("progress",function(e){i.progress&&t(function(){i.progress&&i.progress(e)})},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&t(function(){i.progress&&i.progress(e)})},!1)}});var n=e(i);return n.progress=function(e){return i.progress=e,n},n.abort=function(){return i.__XHR&&t(function(){i.__XHR.abort()}),n},n.xhr=function(e){return i.xhrFn=e,n},n.then=function(e,t){return function(n,r,o){i.progress=o||i.progress;var s=t.apply(e,[n,r,o]);return s.abort=e.abort,s.progress=e.progress,s.xhr=e.xhr,s}}(n,n.then),n}this.upload=function(t){t.headers=t.headers||{},t.headers["Content-Type"]=void 0,t.transformRequest=t.transformRequest||e.defaults.transformRequest;var n=new FormData,r=t.transformRequest,o=t.data;return t.transformRequest=function(e,i){if(o)if(t.formDataAppender)for(var n in o){var s=o[n];t.formDataAppender(e,n,s)}else for(var n in o){var s=o[n];if("function"==typeof r)s=r(s,i);else for(var a=0;a<r.length;a++){var l=r[a];"function"==typeof l&&(s=l(s,i))}e.append(n,s)}if(null!=t.file){var u=t.fileFormDataName||"file";if("[object Array]"===Object.prototype.toString.call(t.file))for(var c="[object String]"===Object.prototype.toString.call(u),a=0;a<t.file.length;a++)e.append(c?u+a:u[a],t.file[a],t.file[a].name);else e.append(u,t.file,t.file.name)}return e},t.data=n,i(t)},this.http=function(e){return i(e)}}]),e.directive("ngFileSelect",["$parse","$timeout",function(e,t){return function(i,n,r){var o=e(r.ngFileSelect);n.bind("change",function(e){var n,r,s=[];if(n=e.target.files,null!=n)for(r=0;r<n.length;r++)s.push(n.item(r));t(function(){o(i,{$files:s,$event:e})})}),n.bind("click",function(){this.value=null})}}]),e.directive("ngFileDropAvailable",["$parse","$timeout",function(e,t){return function(i,n,r){if("draggable"in document.createElement("span")){var o=e(r.ngFileDropAvailable);t(function(){o(i)})}}}]),e.directive("ngFileDrop",["$parse","$timeout",function(e,t){return function(i,n,r){if("draggable"in document.createElement("span")){var o=null,s=e(r.ngFileDrop);n[0].addEventListener("dragover",function(e){t.cancel(o),e.stopPropagation(),e.preventDefault(),n.addClass(r.ngFileDragOverClass||"dragover")},!1),n[0].addEventListener("dragleave",function(e){o=t(function(){n.removeClass(r.ngFileDragOverClass||"dragover")})},!1),n[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n.removeClass(r.ngFileDragOverClass||"dragover");var o,a=[],l=e.dataTransfer.files;if(null!=l)for(o=0;o<l.length;o++)a.push(l.item(o));t(function(){s(i,{$files:a,$event:e})})},!1)}}}])}(),function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.Autolinker=t()}):"object"==typeof exports?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t)};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,truncate:void 0,className:"",htmlParser:void 0,matchParser:void 0,tagBuilder:void 0,link:function(e){for(var t=this.getHtmlParser(),i=t.parse(e),n=0,r=[],o=0,s=i.length;o<s;o++){var a=i[o],l=a.getType(),u=a.getText();if("element"===l)"a"===a.getTagName()&&(a.isClosing()?n=Math.max(n-1,0):n++),r.push(u);else if("entity"===l)r.push(u);else if(0===n){var c=this.linkifyStr(u);r.push(c)}else r.push(u)}return r.join("")},linkifyStr:function(e){return this.getMatchParser().replace(e,this.createMatchReturnVal,this)},createMatchReturnVal:function(t){var i;if(this.replaceFn&&(i=this.replaceFn.call(this,this,t)),"string"==typeof i)return i;if(i===!1)return t.getMatchedText();if(i instanceof e.HtmlTag)return i.toString();var n=this.getTagBuilder(),r=n.build(t);return r.toString()},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.htmlParser.HtmlParser),t},getMatchParser:function(){var t=this.matchParser;return t||(t=this.matchParser=new e.matchParser.MatchParser({urls:this.urls,email:this.email,twitter:this.twitter,stripPrefix:this.stripPrefix})),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t}},e.link=function(t,i){var n=new e(i);return n.link(t)},e.match={},e.htmlParser={},e.matchParser={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},extend:function(t,i){var n=t.prototype,r=function(){};r.prototype=n;var o;o=i.hasOwnProperty("constructor")?i.constructor:function(){n.constructor.apply(this,arguments)};var s=o.prototype=new r;return s.constructor=o,s.superclass=n,delete i.constructor,e.Util.assign(s,i),o},ellipsis:function(e,t,i){return e.length>t&&(i=null==i?"..":i,e=e.substring(0,t-i.length)+i),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var i,n=[],r=0;i=t.exec(e);)n.push(e.substring(r,i.index)),n.push(i[0]),r=i.index+i[0].length;return n.push(e.substring(r)),n}},e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var i=this.getAttrs();return i[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var i=this.getAttrs();return e.Util.assign(i,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var i,n=this.getClass(),r=this.whitespaceRegex,o=e.Util.indexOf,s=n?n.split(r):[],a=t.split(r);i=a.shift();)o(s,i)===-1&&s.push(i);return this.getAttrs()["class"]=s.join(" "),this},removeClass:function(t){for(var i,n=this.getClass(),r=this.whitespaceRegex,o=e.Util.indexOf,s=n?n.split(r):[],a=t.split(r);s.length&&(i=a.shift());){var l=o(s,i);l!==-1&&s.splice(l,1)}return this.getAttrs()["class"]=s.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return(" "+this.getClass()+" ").indexOf(" "+e+" ")!==-1},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+'="'+e[i]+'"');return t.join(" ")}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var i=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return i},createAttrs:function(e,t){var i={href:t},n=this.createCssClass(e);return n&&(i["class"]=n),this.newWindow&&(i.target="_blank"),i},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.htmlParser.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,i=/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/,n=t.source+"(?:\\s*=\\s*"+i.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",n,"|",i.source+")",")*",">",")","|","(?:","<(/)?","("+e.source+")","(?:","\\s+",n,")*","\\s*/?",">",")"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(e){for(var t,i,n=this.htmlRegex,r=0,o=[];null!==(t=n.exec(e));){var s=t[0],a=t[1]||t[3],l=!!t[2],u=e.substring(r,t.index);u&&(i=this.parseTextAndEntityNodes(u),o.push.apply(o,i)),o.push(this.createElementNode(s,a,l)),r=t.index+s.length}if(r<e.length){var c=e.substring(r);c&&(i=this.parseTextAndEntityNodes(c),o.push.apply(o,i))}return o},parseTextAndEntityNodes:function(t){for(var i=[],n=e.Util.splitAndCapture(t,this.htmlCharacterEntitiesRegex),r=0,o=n.length;r<o;r+=2){var s=n[r],a=n[r+1];s&&i.push(this.createTextNode(s)),a&&i.push(this.createEntityNode(a))}return i},createElementNode:function(t,i,n){return new e.htmlParser.ElementNode({text:t,tagName:i.toLowerCase(),closing:n})},createEntityNode:function(t){return new e.htmlParser.EntityNode({text:t})},createTextNode:function(t){return new e.htmlParser.TextNode({text:t})}}),e.htmlParser.HtmlNode=e.Util.extend(Object,{text:"",constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getText:function(){return this.text}}),e.htmlParser.ElementNode=e.Util.extend(e.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}}),e.htmlParser.EntityNode=e.Util.extend(e.htmlParser.HtmlNode,{getType:function(){return"entity"}}),e.htmlParser.TextNode=e.Util.extend(e.htmlParser.HtmlNode,{getType:function(){return"text"}}),e.matchParser.MatchParser=e.Util.extend(Object,{urls:!0,email:!0,twitter:!0,stripPrefix:!0,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,i=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,n=/(?:www\.)/,r=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,o=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,s=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",t.source,r.source,o.source,")","|","(","(?:","(",i.source,r.source,")","|","(?:","(.?//)?",n.source,r.source,")","|","(?:","(.?//)?",r.source,o.source,")",")","(?:"+s.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,constructor:function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator},replace:function(e,t,i){var n=this;return e.replace(this.matcherRegex,function(e,r,o,s,a,l,u,c,h){var d=n.processCandidateMatch(e,r,o,s,a,l,u,c,h);if(d){var p=t.call(i,d.match);return d.prefixStr+p+d.suffixStr}return e})},processCandidateMatch:function(t,i,n,r,o,s,a,l,u){var c,h=l||u,d="",p="";if(i&&!this.twitter||o&&!this.email||s&&!this.urls||!this.matchValidator.isValidMatch(s,a,h))return null;if(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),p=")"),o)c=new e.match.Email({matchedText:t,email:o});else if(i)n&&(d=n,t=t.slice(1)),c=new e.match.Twitter({matchedText:t,twitterHandle:r});else{if(h){var f=h.match(this.charBeforeProtocolRelMatchRegex)[1]||"";f&&(d=f,t=t.slice(1))}c=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!a,protocolRelativeMatch:!!h,stripPrefix:this.stripPrefix})}return{prefixStr:d,suffixStr:p,match:c}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var i=e.match(/\(/g),n=e.match(/\)/g),r=i&&i.length||0,o=n&&n.length||0;if(r<o)return!0}return!1}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,i){return!(t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(i))},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0].toLowerCase();return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||e.indexOf(".")!==-1)},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return!(!e||!t)&&!this.hasWordCharAfterProtocolRegex.test(e)},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&amp;/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e});var numeric="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var i,n,r,o;for("undefined"==typeof t&&(t=15),r=.5,i=new Date;;){for(r*=2,o=r;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;if(n=new Date,n-i>t)break}for(o=r;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;return n=new Date,1e3*(3*r-1)/(n-i)},numeric._myIndexOf=function(e){var t,i=this.length;for(t=0;t<i;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var i=Math.floor(Math.log(e)/Math.log(10)),n=e/Math.pow(10,i),r=n.toPrecision(numeric.precision);return 10===parseFloat(r)&&(i++,n=1,r=n.toPrecision(numeric.precision)),parseFloat(r).toString()+"e"+i.toString()}return"Infinity"}function i(e){var r;if("undefined"==typeof e)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof e)return n.push('"'+e+'"'),!1;if("boolean"==typeof e)return n.push(e.toString()),!1;if("number"==typeof e){var o=t(e),s=e.toPrecision(numeric.precision),a=parseFloat(e.toString()).toString(),l=[o,s,a,parseFloat(s).toString(),parseFloat(a).toString()];for(r=1;r<l.length;r++)l[r].length<o.length&&(o=l[r]);return n.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===e)return n.push("null"),!1;if("function"==typeof e){n.push(e.toString());var u=!1;for(r in e)e.hasOwnProperty(r)&&(u?n.push(",\n"):n.push("\n{"),u=!0,n.push(r),n.push(": \n"),i(e[r]));return u&&n.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return n.push("...Large Array..."),!0;var u=!1;for(n.push("["),r=0;r<e.length;r++)r>0&&(n.push(","),u&&n.push("\n ")),u=i(e[r]);return n.push("]"),!0}n.push("{");var u=!1;for(r in e)e.hasOwnProperty(r)&&(u&&n.push(",\n"),u=!0,n.push(r),n.push(": \n"),i(e[r]));return n.push("}"),!0}var n=[];return i(e),n.join("")},numeric.parseDate=function(e){function t(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var i,n=[];for(i=0;i<e.length;i++)n[i]=t(e[i]);return n}return t(e)},numeric.parseFloat=function(e){function t(e){if("string"==typeof e)return parseFloat(e);if(!(e instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var i,n=[];for(i=0;i<e.length;i++)n[i]=t(e[i]);return n}return t(e)},numeric.parseCSV=function(e){var t,i,n=e.split("\n"),r=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,s=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,a=function(e){return e.substr(0,e.length-1)},l=0;for(i=0;i<n.length;i++){var u,c=(n[i]+",").match(o);
if(c.length>0){for(r[l]=[],t=0;t<c.length;t++)u=a(c[t]),s.test(u)?r[l][t]=parseFloat(u):r[l][t]=u;l++}}return r},numeric.toCSV=function(e){var t,i,n,r,o,s,a=numeric.dim(e);for(n=a[0],r=a[1],s=[],t=0;t<n;t++){for(o=[],i=0;i<n;i++)o[i]=e[t][i].toString();s[t]=o.join(", ")}return s.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e){var t,i,n,r,o,s,a,l,u=e.length,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="";for(t=0;t<u;t+=3)i=e[t],n=e[t+1],r=e[t+2],o=i>>2,s=((3&i)<<4)+(n>>4),a=((15&n)<<2)+(r>>6),l=63&r,t+1>=u?a=l=64:t+2>=u&&(l=64),h+=c.charAt(o)+c.charAt(s)+c.charAt(a)+c.charAt(l);return h}function i(e,t,i){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=e.length);var n,r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1,s=0;e.length;for(n=t;n<i;n++)s=255&(o^e[n]),o=o>>>8^r[s];return o^-1}var n,r,o,s,a,l,u,c,h,d,p=e[0].length,f=e[0][0].length,m=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,f>>24&255,f>>16&255,f>>8&255,255&f,p>>24&255,p>>16&255,p>>8&255,255&p,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(d=i(m,12,29),m[29]=d>>24&255,m[30]=d>>16&255,m[31]=d>>8&255,m[32]=255&d,n=1,r=0,u=0;u<p;u++){for(u<p-1?m.push(0):m.push(1),a=3*f+1+(0===u)&255,l=3*f+1+(0===u)>>8&255,m.push(a),m.push(l),m.push(255&~a),m.push(255&~l),0===u&&m.push(0),c=0;c<f;c++)for(o=0;o<3;o++)a=e[o][u][c],a=a>255?255:a<0?0:Math.round(a),n=(n+a)%65521,r=(r+n)%65521,m.push(a);m.push(0)}return h=(r<<16)+n,m.push(h>>24&255),m.push(h>>16&255),m.push(h>>8&255),m.push(255&h),s=m.length-41,m[33]=s>>24&255,m[34]=s>>16&255,m[35]=s>>8&255,m[36]=255&s,d=i(m,37),m.push(d>>24&255),m.push(d>>16&255),m.push(d>>8&255),m.push(255&d),m.push(0),m.push(0),m.push(0),m.push(0),m.push(73),m.push(69),m.push(78),m.push(68),m.push(174),m.push(66),m.push(96),m.push(130),"data:image/png;base64,"+t(m)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t,i;return"object"==typeof e?(t=e[0],"object"==typeof t?(i=t[0],"object"==typeof i?numeric._dim(e):[e.length,t.length]):[e.length]):[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,i){var n,r;if(!(t instanceof Array&&i instanceof Array))return!1;if(r=t.length,r!==i.length)return!1;for(n=0;n<r;n++)if(t[n]!==i[n]){if("object"!=typeof t[n])return!1;if(!e(t[n],i[n]))return!1}return!0},numeric.rep=function(e,t,i){"undefined"==typeof i&&(i=0);var n,r=e[i],o=Array(r);if(i===e.length-1){for(n=r-2;n>=0;n-=2)o[n+1]=t,o[n]=t;return n===-1&&(o[0]=t),o}for(n=r-1;n>=0;n--)o[n]=numeric.rep(e,t,i+1);return o},numeric.dotMMsmall=function(e,t){var i,n,r,o,s,a,l,u,c,h,d;for(o=e.length,s=t.length,a=t[0].length,l=Array(o),i=o-1;i>=0;i--){for(u=Array(a),c=e[i],r=a-1;r>=0;r--){for(h=c[s-1]*t[s-1][r],n=s-2;n>=1;n-=2)d=n-1,h+=c[n]*t[n][r]+c[d]*t[d][r];0===n&&(h+=c[0]*t[0][r]),u[r]=h}l[i]=u}return l},numeric._getCol=function(e,t,i){var n,r=e.length;for(n=r-1;n>0;--n)i[n]=e[n][t],--n,i[n]=e[n][t];0===n&&(i[0]=e[0][t])},numeric.dotMMbig=function(e,t){var i,n,r,o,s=numeric._getCol,a=t.length,l=Array(a),u=e.length,c=t[0].length,h=new Array(u),d=numeric.dotVV;for(--a,--u,n=u;n!==-1;--n)h[n]=Array(c);for(--c,n=c;n!==-1;--n)for(s(t,n,l),r=u;r!==-1;--r)o=0,i=e[r],h[r][n]=d(i,l);return h},numeric.dotMV=function(e,t){var i,n=e.length,r=(t.length,Array(n)),o=numeric.dotVV;for(i=n-1;i>=0;i--)r[i]=o(e[i],t);return r},numeric.dotVM=function(e,t){var i,n,r,o,s,a,l;for(r=e.length,o=t[0].length,s=Array(o),n=o-1;n>=0;n--){for(a=e[r-1]*t[r-1][n],i=r-2;i>=1;i-=2)l=i-1,a+=e[i]*t[i][n]+e[l]*t[l][n];0===i&&(a+=e[0]*t[0][n]),s[n]=a}return s},numeric.dotVV=function(e,t){var i,n,r=e.length,o=e[r-1]*t[r-1];for(i=r-2;i>=1;i-=2)n=i-1,o+=e[i]*t[i]+e[n]*t[n];return 0===i&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var i=numeric.dim;switch(1e3*i(e).length+i(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,i,n,r,o=e.length,s=Array(o);for(t=o-1;t>=0;t--){for(r=Array(o),i=t+2,n=o-1;n>=i;n-=2)r[n]=0,r[n-1]=0;for(n>t&&(r[n]=0),r[t]=e[t],n=t-1;n>=1;n-=2)r[n]=0,r[n-1]=0;0===n&&(r[0]=0),s[t]=r}return s},numeric.getDiag=function(e){var t,i=Math.min(e.length,e[0].length),n=Array(i);for(t=i-1;t>=1;--t)n[t]=e[t][t],--t,n[t]=e[t][t];return 0===t&&(n[0]=e[0][0]),n},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,i){"undefined"==typeof i&&(i="");var n,r,o=[],s=/\[i\]$/,a="",l=!1;for(n=0;n<e.length;n++)s.test(e[n])?(r=e[n].substring(0,e[n].length-3),a=r):r=e[n],"ret"===r&&(l=!0),o.push(r);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(l?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+i+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,i){"undefined"==typeof i&&(i="");var n,r,o=[],s=/\[i\]$/,a="",l=!1;for(n=0;n<e.length;n++)s.test(e[n])?(r=e[n].substring(0,e[n].length-3),a=r):r=e[n],"ret"===r&&(l=!0),o.push(r);return o[e.length]="var _n = "+a+".length;\nvar i"+(l?"":", ret = Array(_n)")+";\n"+i+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function t(e,i,n,r,o){if(r===n.length-1)return void o(e,i);var s,a=n[r];for(s=a-1;s>=0;s--)t("object"==typeof e?e[s]:e,"object"==typeof i?i[s]:i,n,r+1,o)},numeric._biforeach2=function n(e,t,i,r,o){if(r===i.length-1)return o(e,t);var s,a=i[r],l=Array(a);for(s=a-1;s>=0;--s)l[s]=n("object"==typeof e?e[s]:e,"object"==typeof t?t[s]:t,i,r+1,o);return l},numeric._foreach=function r(e,t,i,n){if(i===t.length-1)return void n(e);var o,s=t[i];for(o=s-1;o>=0;o--)r(e[o],t,i+1,n)},numeric._foreach2=function o(e,t,i,n){if(i===t.length-1)return n(e);var r,s=t[i],a=Array(s);for(r=s-1;r>=0;r--)a[r]=o(e[r],t,i+1,n);return a},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var i,n,r="";numeric.myIndexOf.call(numeric.mathfuns2,e)!==-1?(r="var "+t+" = Math."+t+";\n",i=function(e,i,n){return e+" = "+t+"("+i+","+n+")"},n=function(e,i){return e+" = "+t+"("+e+","+i+")"}):(i=function(e,i,n){return e+" = "+i+" "+t+" "+n},n=numeric.opseq.hasOwnProperty(e+"eq")?function(e,i){return e+" "+t+"= "+i}:function(e,i){return e+" = "+e+" "+t+" "+i}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],i("ret[i]","x[i]","y[i]"),r),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],i("ret[i]","x","y[i]"),r),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],i("ret[i]","x[i]","y"),r),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+n("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],n("ret[i]","x[i]"),r),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],n("ret[i]","x"),r),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(r="",t=numeric.ops1[e],numeric.myIndexOf.call(numeric.mathfuns,e)!==-1&&Math.hasOwnProperty(t)&&(r="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",r),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",r),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,i,n,r,o,s,a,e,l=numeric.dim(e),u=Math.abs,c=l[0],h=l[1],d=numeric.clone(e),p=numeric.identity(c);for(s=0;s<h;++s){var f=-1,m=-1;for(o=s;o!==c;++o)a=u(d[o][s]),a>m&&(f=o,m=a);for(i=d[f],d[f]=d[s],d[s]=i,r=p[f],p[f]=p[s],p[s]=r,e=i[s],a=s;a!==h;++a)i[a]/=e;for(a=h-1;a!==-1;--a)r[a]/=e;for(o=c-1;o!==-1;--o)if(o!==s){for(t=d[o],n=p[o],e=t[s],a=s+1;a!==h;++a)t[a]-=i[a]*e;for(a=h-1;a>0;--a)n[a]-=r[a]*e,--a,n[a]-=r[a]*e;0===a&&(n[0]-=r[0]*e)}}return p},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var i,n,r,o,s,a,l,u,c=t[0],h=1,d=numeric.clone(e);for(n=0;n<c-1;n++){for(r=n,i=n+1;i<c;i++)Math.abs(d[i][n])>Math.abs(d[r][n])&&(r=i);for(r!==n&&(l=d[r],d[r]=d[n],d[n]=l,h*=-1),o=d[n],i=n+1;i<c;i++){for(s=d[i],a=s[n]/o[n],r=n+1;r<c-1;r+=2)u=r+1,s[r]-=o[r]*a,s[u]-=o[u]*a;r!==c&&(s[r]-=o[r]*a)}if(0===o[n])return 0;h*=o[n]}return h*d[n][n]},numeric.transpose=function(e){var t,i,n,r,o,s=e.length,a=e[0].length,l=Array(a);for(i=0;i<a;i++)l[i]=Array(s);for(t=s-1;t>=1;t-=2){for(r=e[t],n=e[t-1],i=a-1;i>=1;--i)o=l[i],o[t]=r[i],o[t-1]=n[i],--i,o=l[i],o[t]=r[i],o[t-1]=n[i];0===i&&(o=l[0],o[t]=r[0],o[t-1]=n[0])}if(0===t){for(n=e[0],i=a-1;i>=1;--i)l[i][0]=n[i],--i,l[i][0]=n[i];0===i&&(l[0][0]=n[0])}return l},numeric.negtranspose=function(e){var t,i,n,r,o,s=e.length,a=e[0].length,l=Array(a);for(i=0;i<a;i++)l[i]=Array(s);for(t=s-1;t>=1;t-=2){for(r=e[t],n=e[t-1],i=a-1;i>=1;--i)o=l[i],o[t]=-r[i],o[t-1]=-n[i],--i,o=l[i],o[t]=-r[i],o[t-1]=-n[i];0===i&&(o=l[0],o[t]=-r[0],o[t-1]=-n[0])}if(0===t){for(n=e[0],i=a-1;i>=1;--i)l[i][0]=-n[i],--i,l[i][0]=-n[i];0===i&&(l[0][0]=-n[0])}return l},numeric._random=function s(e,t){var i,n,r=e[t],o=Array(r);if(t===e.length-1){for(n=Math.random,i=r-1;i>=1;i-=2)o[i]=n(),o[i-1]=n();return 0===i&&(o[0]=n()),o}for(i=r-1;i>=0;i--)o[i]=s(e,t+1);return o},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,i){if("undefined"==typeof i&&(i=Math.max(Math.round(t-e)+1,1)),i<2)return 1===i?[e]:[];var n,r=Array(i);for(i--,n=i;n>=0;n--)r[n]=(n*t+(i-n)*e)/i;return r},numeric.getBlock=function(e,t,i){function n(e,o){var s,a=t[o],l=i[o]-a,u=Array(l);if(o===r.length-1){for(s=l;s>=0;s--)u[s]=e[s+a];return u}for(s=l;s>=0;s--)u[s]=n(e[s+a],o+1);return u}var r=numeric.dim(e);return n(e,0)},numeric.setBlock=function(e,t,i,n){function r(e,n,s){var a,l=t[s],u=i[s]-l;if(s===o.length-1)for(a=u;a>=0;a--)e[a+l]=n[a];for(a=u;a>=0;a--)r(e[a+l],n[a],s+1)}var o=numeric.dim(e);return r(e,n,0),e},numeric.getRange=function(e,t,i){var n,r,o,s,a=t.length,l=i.length,u=Array(a);for(n=a-1;n!==-1;--n)for(u[n]=Array(l),o=u[n],s=e[t[n]],r=l-1;r!==-1;--r)o[r]=s[i[r]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var i,n,r,o,s,a=t[0],l=t[1];for(i=0,n=0,r=0;r<a;++r)i+=e[r][0].length;for(o=0;o<l;++o)n+=e[0][o][0].length;var u=Array(i);for(r=0;r<i;++r)u[r]=Array(n);var c,h,d,p,f,m=0;for(r=0;r<a;++r){for(c=n,o=l-1;o!==-1;--o)for(s=e[r][o],c-=s[0].length,d=s.length-1;d!==-1;--d)for(f=s[d],h=u[m+d],p=f.length-1;p!==-1;--p)h[c+p]=f[p];m+=e[r][0].length}return u},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var i=numeric.dim(e),n=numeric.dim(t);if(1!==i.length||1!==n.length)throw new Error("numeric: tensor product is only defined for vectors");var r,o,s,a,l=i[0],u=n[0],c=Array(l);for(o=l-1;o>=0;o--){for(r=Array(u),a=e[o],s=u-1;s>=3;--s)r[s]=a*t[s],--s,r[s]=a*t[s],--s,r[s]=a*t[s],--s,r[s]=a*t[s];for(;s>=0;)r[s]=a*t[s],--s;c[o]=r}return c},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,i,n,r){numeric.indexOf;if("string"!=typeof r){var o;r="";for(o in numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||i.indexOf(o)>=0||n.indexOf(o)>=0)&&o.length>1&&(r+="var "+o+" = numeric."+o+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+r+"\nif(x.y) {  if(y.y) {    return new numeric.T("+n+");\n  }\n  return new numeric.T("+i+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var i=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,i),t(numeric.neg(this.y),i))}return new T(t(1,this.x))},numeric.T.prototype.div=function a(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var a=numeric.div;return this.y?new numeric.T(a(this.x,e.x),a(this.y,e.x)):new numeric.T(a(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,i=this.y;return i?new numeric.T(e(t),e(i)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,i=this.y;return i?new numeric.T(e(t),numeric.negtranspose(i)):new numeric.T(e(t))},numeric.Tunop=function(e,t,i){return"string"!=typeof i&&(i=""),Function("var x = this;\n"+i+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if("undefined"==typeof e.y)return new numeric.T(numeric.inv(e.x));var t,i,n,r,o,s,a,l,u,c,h,t,i,n,d,p,f,m,g,y,v,E=e.x.length,T=numeric.identity(E),b=numeric.rep([E,E],0),C=numeric.clone(e.x),O=numeric.clone(e.y);for(t=0;t<E;t++){for(f=C[t][t],m=O[t][t],d=f*f+m*m,n=t,i=t+1;i<E;i++)f=C[i][t],m=O[i][t],p=f*f+m*m,p>d&&(n=i,d=p);for(n!==t&&(v=C[t],C[t]=C[n],C[n]=v,v=O[t],O[t]=O[n],O[n]=v,v=T[t],T[t]=T[n],T[n]=v,v=b[t],b[t]=b[n],b[n]=v),r=C[t],o=O[t],l=T[t],u=b[t],f=r[t],m=o[t],i=t+1;i<E;i++)g=r[i],y=o[i],r[i]=(g*f+y*m)/d,o[i]=(y*f-g*m)/d;for(i=0;i<E;i++)g=l[i],y=u[i],l[i]=(g*f+y*m)/d,u[i]=(y*f-g*m)/d;for(i=t+1;i<E;i++){for(s=C[i],a=O[i],c=T[i],h=b[i],f=s[t],m=a[t],n=t+1;n<E;n++)g=r[n],y=o[n],s[n]-=g*f-y*m,a[n]-=y*f+g*m;for(n=0;n<E;n++)g=l[n],y=u[n],c[n]-=g*f-y*m,h[n]-=y*f+g*m}}for(t=E-1;t>0;t--)for(l=T[t],u=b[t],i=t-1;i>=0;i--)for(c=T[i],h=b[i],f=C[i][t],m=O[i][t],n=E-1;n>=0;n--)g=l[n],y=u[n],c[n]-=f*g-m*y,h[n]-=f*y+m*g;return new numeric.T(T,b)},numeric.T.prototype.get=function(e){var t,i=this.x,n=this.y,r=0,o=e.length;if(n){for(;r<o;)t=e[r],i=i[t],n=n[t],r++;return new numeric.T(i,n)}for(;r<o;)t=e[r],i=i[t],r++;return new numeric.T(i)},numeric.T.prototype.set=function(e,t){var i,n=this.x,r=this.y,o=0,s=e.length,a=t.x,l=t.y;if(0===s)return l?this.y=l:r&&(this.y=void 0),this.x=n,this;if(l){for(r||(r=numeric.rep(numeric.dim(n),0),this.y=r);o<s-1;)i=e[o],n=n[i],r=r[i],o++;return i=e[o],n[i]=a,r[i]=l,this}if(r){for(;o<s-1;)i=e[o],n=n[i],r=r[i],o++;return i=e[o],n[i]=a,a instanceof Array?r[i]=numeric.rep(numeric.dim(a),0):r[i]=0,this}for(;o<s-1;)i=e[o],n=n[i],o++;return i=e[o],n[i]=a,this},numeric.T.prototype.getRows=function(e,t){var i,n,r=t-e+1,o=Array(r),s=this.x,a=this.y;for(i=e;i<=t;i++)o[i-e]=s[i];if(a){for(n=Array(r),i=e;i<=t;i++)n[i-e]=a[i];return new numeric.T(o,n)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,i){var n,r=this.x,o=this.y,s=i.x,a=i.y;for(n=e;n<=t;n++)r[n]=s[n-e];if(a)for(o||(o=numeric.rep(numeric.dim(r),0),this.y=o),n=e;n<=t;n++)o[n]=a[n-e];else if(o)for(n=e;n<=t;n++)o[n]=numeric.rep([s[n-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,i=this.y;return i?new numeric.T(t[e],i[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var i=this.x,n=this.y,r=t.x,o=t.y;return i[e]=r,o?(n||(n=numeric.rep(numeric.dim(i),0),this.y=n),n[e]=o):n&&(n=numeric.rep([r.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var i=this.x,n=this.y,r=numeric.getBlock;return n?new numeric.T(r(i,e,t),r(n,e,t)):new numeric.T(r(i,e,t))},numeric.T.prototype.setBlock=function(e,t,i){i instanceof numeric.T||(i=new numeric.T(i));var n=this.x,r=this.y,o=numeric.setBlock,s=i.x,a=i.y;return a?(r||(this.y=numeric.rep(numeric.dim(this),0),r=this.y),o(n,e,t,s),o(r,e,t,a),this):(o(n,e,t,s),void(r&&o(r,e,t,numeric.rep(numeric.dim(s),0))))},numeric.T.rep=function(e,t){var i=numeric.T;t instanceof i||(t=new i(t));var n=t.x,r=t.y,o=numeric.rep;return r?new i(o(e,n),o(e,r)):new i(o(e,n))},numeric.T.diag=function l(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,i=e.y,l=numeric.diag;return i?new numeric.T(l(t),l(i)):new numeric.T(l(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,i=this.y;return i?new e.T(e.getDiag(t),e.getDiag(i)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),i=e[0]>=0?1:-1,n=i*numeric.norm2(e);t[0]+=n;var r=numeric.norm2(t);if(0===r)throw new Error("eig: internal error");return numeric.div(t,r)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var i,n,r,o,s,a,l,u,c,h,d=t[0],p=numeric.clone(e),f=numeric.identity(d);for(n=0;n<d-2;n++){for(o=Array(d-n-1),i=n+1;i<d;i++)o[i-n-1]=p[i][n];if(numeric.norm2(o)>0){for(s=numeric.house(o),a=numeric.getBlock(p,[n+1,n],[d-1,d-1]),l=numeric.tensor(s,numeric.dot(s,a)),i=n+1;i<d;i++)for(u=p[i],c=l[i-n-1],r=n;r<d;r++)u[r]-=2*c[r-n];for(a=numeric.getBlock(p,[0,n+1],[d-1,d-1]),l=numeric.tensor(numeric.dot(a,s),s),i=0;i<d;i++)for(u=p[i],c=l[i],r=n+1;r<d;r++)u[r]-=2*c[r-n-1];for(a=Array(d-n-1),i=n+1;i<d;i++)a[i-n-1]=f[i];for(l=numeric.tensor(s,numeric.dot(s,a)),i=n+1;i<d;i++)for(h=f[i],c=l[i-n-1],r=0;r<d;r++)h[r]-=2*c[r]}}return{H:p,Q:f}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,t){"undefined"==typeof t&&(t=1e4),e=numeric.clone(e);var i,n,r,o,s,a,l,u,c,h,d,p,f,m,g,y,v,E,T=(numeric.clone(e),numeric.dim(e)),b=T[0],C=numeric.identity(b);if(b<3)return{Q:C,B:[[0,b-1]]};var O=numeric.epsilon;for(E=0;E<t;E++){for(y=0;y<b-1;y++)if(Math.abs(e[y+1][y])<O*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),w=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(p=Array(y+1),g=0;g<=y;g++)p[g]=C[g];for(f=numeric.dot(x.Q,p),g=0;g<=y;g++)C[g]=f[g];for(p=Array(b-y-1),g=y+1;g<b;g++)p[g-y-1]=C[g];for(f=numeric.dot(w.Q,p),g=y+1;g<b;g++)C[g]=f[g-y-1];return{Q:C,B:x.B.concat(numeric.add(w.B,y+1))}}if(r=e[b-2][b-2],o=e[b-2][b-1],s=e[b-1][b-2],a=e[b-1][b-1],u=r+a,l=r*a-o*s,c=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*l){var R,L;R=.5*(u+Math.sqrt(u*u-4*l)),L=.5*(u-Math.sqrt(u*u-4*l)),c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,R+L)),numeric.diag(numeric.rep([3],R*L)))}else c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,u)),numeric.diag(numeric.rep([3],l)));for(i=[c[0][0],c[1][0],c[2][0]],n=numeric.house(i),p=[e[0],e[1],e[2]],f=numeric.tensor(n,numeric.dot(n,p)),g=0;g<3;g++)for(d=e[g],m=f[g],v=0;v<b;v++)d[v]-=2*m[v];for(p=numeric.getBlock(e,[0,0],[b-1,2]),f=numeric.tensor(numeric.dot(p,n),n),g=0;g<b;g++)for(d=e[g],m=f[g],v=0;v<3;v++)d[v]-=2*m[v];for(p=[C[0],C[1],C[2]],f=numeric.tensor(n,numeric.dot(n,p)),g=0;g<3;g++)for(h=C[g],m=f[g],v=0;v<b;v++)h[v]-=2*m[v];var S;for(y=0;y<b-2;y++){for(v=y;v<=y+1;v++)if(Math.abs(e[v+1][v])<O*(Math.abs(e[v][v])+Math.abs(e[v+1][v+1]))){var x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[v,v]),t),w=numeric.QRFrancis(numeric.getBlock(e,[v+1,v+1],[b-1,b-1]),t);for(p=Array(v+1),g=0;g<=v;g++)p[g]=C[g];for(f=numeric.dot(x.Q,p),g=0;g<=v;g++)C[g]=f[g];for(p=Array(b-v-1),g=v+1;g<b;g++)p[g-v-1]=C[g];for(f=numeric.dot(w.Q,p),g=v+1;g<b;g++)C[g]=f[g-v-1];return{Q:C,B:x.B.concat(numeric.add(w.B,v+1))}}for(S=Math.min(b-1,y+3),i=Array(S-y),g=y+1;g<=S;g++)i[g-y-1]=e[g][y];for(n=numeric.house(i),p=numeric.getBlock(e,[y+1,y],[S,b-1]),f=numeric.tensor(n,numeric.dot(n,p)),g=y+1;g<=S;g++)for(d=e[g],m=f[g-y-1],v=y;v<b;v++)d[v]-=2*m[v-y];for(p=numeric.getBlock(e,[0,y+1],[b-1,S]),f=numeric.tensor(numeric.dot(p,n),n),g=0;g<b;g++)for(d=e[g],m=f[g],v=y+1;v<=S;v++)d[v]-=2*m[v-y-1];for(p=Array(S-y),g=y+1;g<=S;g++)p[g-y-1]=C[g];for(f=numeric.tensor(n,numeric.dot(n,p)),g=y+1;g<=S;g++)for(h=C[g],m=f[g-y-1],v=0;v<b;v++)h[v]-=2*m[v]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var i,n,r,o,s,a,l,u,c,h,d,p,f,m,g,y,v,E=numeric.toUpperHessenberg(e),T=numeric.QRFrancis(E.H,t),b=numeric.T,C=e.length,O=T.B,x=numeric.dot(T.Q,numeric.dot(E.H,numeric.transpose(T.Q))),w=new b(numeric.dot(T.Q,E.Q)),R=O.length,L=Math.sqrt;for(n=0;n<R;n++)if(i=O[n][0],i===O[n][1]);else{if(o=i+1,s=x[i][i],a=x[i][o],l=x[o][i],u=x[o][o],0===a&&0===l)continue;c=-s-u,h=s*u-a*l,d=c*c-4*h,d>=0?(p=c<0?-.5*(c-L(d)):-.5*(c+L(d)),y=(s-p)*(s-p)+a*a,v=l*l+(u-p)*(u-p),y>v?(y=L(y),m=(s-p)/y,g=a/y):(v=L(v),m=l/v,g=(u-p)/v),r=new b([[g,-m],[m,g]]),w.setRows(i,o,r.dot(w.getRows(i,o)))):(p=-.5*c,f=.5*L(-d),y=(s-p)*(s-p)+a*a,v=l*l+(u-p)*(u-p),y>v?(y=L(y+f*f),m=(s-p)/y,g=a/y,p=0,f/=y):(v=L(v+f*f),m=l/v,g=(u-p)/v,p=f/v,f=0),r=new b([[g,-m],[m,g]],[[p,f],[f,-p]]),w.setRows(i,o,r.dot(w.getRows(i,o))))}var S=w.dot(e).dot(w.transjugate()),C=e.length,_=numeric.T.identity(C);for(o=0;o<C;o++)if(o>0)for(n=o-1;n>=0;n--){var I=S.get([n,n]),D=S.get([o,o]);numeric.neq(I.x,D.x)||numeric.neq(I.y,D.y)?(p=S.getRow(n).getBlock([n],[o-1]),f=_.getRow(o).getBlock([n],[o-1]),_.set([o,n],S.get([n,o]).neg().sub(p.dot(f)).div(I.sub(D)))):_.setRow(o,_.getRow(n))}for(o=0;o<C;o++)p=_.getRow(o),_.setRow(o,p.div(p.norm2()));return _=_.transpose(),_=w.transjugate().dot(_),{lambda:S.getDiag(),E:_}},numeric.ccsSparse=function(e){var t,i,n,r,o=e.length,s=[];for(n=o-1;n!==-1;--n){i=e[n];for(r in i){for(r=parseInt(r);r>=s.length;)s[s.length]=0;0!==i[r]&&s[r]++}}var t=s.length,a=Array(t+1);for(a[0]=0,n=0;n<t;++n)a[n+1]=a[n]+s[n];var l=Array(a[t]),u=Array(a[t]);for(n=o-1;n!==-1;--n){i=e[n];for(r in i)0!==i[r]&&(s[r]--,l[a[r]+s[r]]=n,u[a[r]+s[r]]=i[r])}return[a,l,u]},numeric.ccsFull=function(e){var t,i,n,r,o=e[0],s=e[1],a=e[2],l=numeric.ccsDim(e),u=l[0],c=l[1],h=numeric.rep([u,c],0);for(t=0;t<c;t++)for(n=o[t],r=o[t+1],i=n;i<r;++i)h[s[i]][t]=a[i];return h},numeric.ccsTSolve=function(e,t,i,n,r){function o(e){var t;if(0===i[e]){for(i[e]=1,t=s[e];t<s[e+1];++t)o(a[t]);r[h]=e,++h}}var s=e[0],a=e[1],l=e[2],u=s.length-1,c=Math.max,h=0;"undefined"==typeof n&&(i=numeric.rep([u],0)),"undefined"==typeof n&&(n=numeric.linspace(0,i.length-1)),"undefined"==typeof r&&(r=[]);var d,p,f,m,g,y,v;for(d=n.length-1;d!==-1;--d)o(n[d]);for(r.length=h,d=r.length-1;d!==-1;--d)i[r[d]]=0;for(d=n.length-1;d!==-1;--d)p=n[d],i[p]=t[p];for(d=r.length-1;d!==-1;--d){for(p=r[d],f=s[p],m=c(s[p+1],f),g=f;g!==m;++g)if(a[g]===p){i[p]/=l[g];break}for(v=i[p],g=f;g!==m;++g)y=a[g],y!==p&&(i[y]-=v*l[g])}return i},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,i,n,r,o){var s,a,l,u=0,c=r.length,h=this.k,d=this.k1,p=this.j;if(0===n[e])for(n[e]=1,p[0]=e,h[0]=a=t[e],d[0]=l=t[e+1];;)if(a>=l){if(r[c]=p[u],0===u)return;++c,--u,a=h[u],l=d[u]}else s=o[i[a]],0===n[s]?(n[s]=1,h[u]=a,++u,p[u]=s,a=t[s],d[u]=l=t[s+1]):++a},numeric.ccsLPSolve=function(e,t,i,n,r,o,s){var a,l,u,c,h,d,p,f,m,g=e[0],y=e[1],v=e[2],E=(g.length-1,t[0]),T=t[1],b=t[2];for(l=E[r],u=E[r+1],n.length=0,a=l;a<u;++a)s.dfs(o[T[a]],g,y,i,n,o);for(a=n.length-1;a!==-1;--a)i[n[a]]=0;for(a=l;a!==u;++a)c=o[T[a]],i[c]=b[a];for(a=n.length-1;a!==-1;--a){for(c=n[a],h=g[c],d=g[c+1],p=h;p<d;++p)if(o[y[p]]===c){i[c]/=v[p];break}for(m=i[c],p=h;p<d;++p)f=o[y[p]],f!==c&&(i[f]-=m*v[p])}return i},numeric.ccsLUP1=function(e,t){var i,n,r,o,s,a,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],p=c[1],f=c[2],m=h[0],g=h[1],y=h[2],v=numeric.rep([u],0),E=numeric.rep([u],0),T=numeric.ccsLPSolve,b=(Math.max,
Math.abs),C=numeric.linspace(0,u-1),O=numeric.linspace(0,u-1),x=new numeric.ccsDFS(u);for("undefined"==typeof t&&(t=1),i=0;i<u;++i){for(T(c,e,v,E,i,O,x),o=-1,s=-1,n=E.length-1;n!==-1;--n)r=E[n],r<=i||(a=b(v[r]),a>o&&(s=r,o=a));for(b(v[i])<t*o&&(n=C[i],o=C[s],C[i]=o,O[o]=i,C[s]=n,O[n]=s,o=v[i],v[i]=v[s],v[s]=o),o=d[i],s=m[i],l=v[i],p[o]=C[i],f[o]=1,++o,n=E.length-1;n!==-1;--n)r=E[n],a=v[r],E[n]=0,v[r]=0,r<=i?(g[s]=r,y[s]=a,++s):(p[o]=C[r],f[o]=a/l,++o);d[i+1]=o,m[i+1]=s}for(n=p.length-1;n!==-1;--n)p[n]=O[p[n]];return{L:c,U:h,P:C,Pinv:O}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,i,n,r,o,s){var a,l,u,c=0,h=r.length,d=this.k,p=this.k1,f=this.j;if(0===n[e])for(n[e]=1,f[0]=e,d[0]=l=t[o[e]],p[0]=u=t[o[e]+1];;){if(isNaN(l))throw new Error("Ow!");if(l>=u){if(r[h]=o[f[c]],0===c)return;++h,--c,l=d[c],u=p[c]}else a=i[l],0===n[a]?(n[a]=1,d[c]=l,++c,f[c]=a,a=o[a],l=t[a],p[c]=u=t[a+1]):++l}},numeric.ccsLPSolve0=function(e,t,i,n,r,o,s,a){var l,u,c,h,d,p,f,m,g,y=e[0],v=e[1],E=e[2],T=(y.length-1,t[0]),b=t[1],C=t[2];for(u=T[r],c=T[r+1],n.length=0,l=u;l<c;++l)a.dfs(b[l],y,v,i,n,o,s);for(l=n.length-1;l!==-1;--l)h=n[l],i[s[h]]=0;for(l=u;l!==c;++l)h=b[l],i[h]=C[l];for(l=n.length-1;l!==-1;--l){for(h=n[l],m=s[h],d=y[h],p=y[h+1],f=d;f<p;++f)if(v[f]===m){i[m]/=E[f];break}for(g=i[m],f=d;f<p;++f)i[v[f]]-=g*E[f];i[m]=g}},numeric.ccsLUP0=function(e,t){var i,n,r,o,s,a,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],p=c[1],f=c[2],m=h[0],g=h[1],y=h[2],v=numeric.rep([u],0),E=numeric.rep([u],0),T=numeric.ccsLPSolve0,b=(Math.max,Math.abs),C=numeric.linspace(0,u-1),O=numeric.linspace(0,u-1),x=new numeric.ccsDFS0(u);for("undefined"==typeof t&&(t=1),i=0;i<u;++i){for(T(c,e,v,E,i,O,C,x),o=-1,s=-1,n=E.length-1;n!==-1;--n)r=E[n],r<=i||(a=b(v[C[r]]),a>o&&(s=r,o=a));for(b(v[C[i]])<t*o&&(n=C[i],o=C[s],C[i]=o,O[o]=i,C[s]=n,O[n]=s),o=d[i],s=m[i],l=v[C[i]],p[o]=C[i],f[o]=1,++o,n=E.length-1;n!==-1;--n)r=E[n],a=v[C[r]],E[n]=0,v[C[r]]=0,r<=i?(g[s]=r,y[s]=a,++s):(p[o]=C[r],f[o]=a/l,++o);d[i+1]=o,m[i+1]=s}for(n=p.length-1;n!==-1;--n)p[n]=O[p[n]];return{L:c,U:h,P:C,Pinv:O}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,i){var n=numeric.ccsDim(e),r=n[0],o=n[1];"undefined"==typeof t?t=numeric.linspace(0,r-1):"number"==typeof t&&(t=[t]),"undefined"==typeof i?i=numeric.linspace(0,o-1):"number"==typeof i&&(i=[i]);var s,a,l,u,c,h=t.length,d=i.length,p=numeric.rep([o],0),f=[],m=[],g=[p,f,m],y=e[0],v=e[1],E=e[2],T=numeric.rep([r],0),b=0,C=numeric.rep([r],0);for(a=0;a<d;++a){u=i[a];var O=y[u],x=y[u+1];for(s=O;s<x;++s)l=v[s],C[l]=1,T[l]=E[s];for(s=0;s<h;++s)c=t[s],C[c]&&(f[b]=s,m[b]=T[t[s]],++b);for(s=O;s<x;++s)l=v[s],C[l]=0;p[a+1]=b}return g},numeric.ccsDot=function(e,t){var i,n,r,o,s,a,l,u,c,h,d,p=e[0],f=e[1],m=e[2],g=t[0],y=t[1],v=t[2],E=numeric.ccsDim(e),T=numeric.ccsDim(t),b=E[0],C=(E[1],T[1]),O=numeric.rep([b],0),x=numeric.rep([b],0),w=Array(b),R=numeric.rep([C],0),L=[],S=[],_=[R,L,S];for(r=0;r!==C;++r){for(o=g[r],s=g[r+1],c=0,n=o;n<s;++n)for(h=y[n],d=v[n],a=p[h],l=p[h+1],i=a;i<l;++i)u=f[i],0===x[u]&&(w[c]=u,x[u]=1,c+=1),O[u]=O[u]+m[i]*d;for(o=R[r],s=o+c,R[r+1]=s,n=c-1;n!==-1;--n)d=o+n,i=w[n],L[d]=i,S[d]=O[i],x[i]=0,O[i]=0;R[r+1]=R[r]+c}return _},numeric.ccsLUPSolve=function(e,t){var i=e.L,n=e.U,r=(e.P,t[0]),o=!1;"object"!=typeof r&&(t=[[0,t.length],numeric.linspace(0,t.length-1),t],r=t[0],o=!0);var s,a,l,u,c,h,d=t[1],p=t[2],f=i[0].length-1,m=r.length-1,g=numeric.rep([f],0),y=Array(f),v=numeric.rep([f],0),E=Array(f),T=numeric.rep([m+1],0),b=[],C=[],O=numeric.ccsTSolve,x=0;for(s=0;s<m;++s){for(c=0,l=r[s],u=r[s+1],a=l;a<u;++a)h=e.Pinv[d[a]],E[c]=h,v[h]=p[a],++c;for(E.length=c,O(i,v,g,E,y),a=E.length-1;a!==-1;--a)v[E[a]]=0;if(O(n,g,v,y,E),o)return v;for(a=y.length-1;a!==-1;--a)g[y[a]]=0;for(a=E.length-1;a!==-1;--a)h=E[a],b[x]=h,C[x]=v[h],v[h]=0,++x;T[s+1]=x}return[T,b,C]},numeric.ccsbinop=function(e,t){return"undefined"==typeof t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,i=e[0],n=e[1],r=e[2],o=numeric.sup(n)+1,s=i.length,a=numeric.rep([o],0),l=Array(s),u=Array(s),c=numeric.rep([o],0);for(t=0;t<s;++t)c[n[t]]++;for(t=0;t<o;++t)a[t+1]=a[t]+c[t];var h,d,p=a.slice(0);for(t=0;t<s;++t)d=n[t],h=p[d],l[h]=i[t],u[h]=r[t],p[d]=p[d]+1;return[a,l,u]},numeric.ccsGather=function(e){var t,i,n,r,o,s=e[0],a=e[1],l=e[2],u=s.length-1,c=a.length,h=Array(c),d=Array(c),p=Array(c);for(o=0,t=0;t<u;++t)for(n=s[t],r=s[t+1],i=n;i!==r;++i)d[o]=t,h[o]=a[i],p[o]=l[i],++o;return[h,d,p]},numeric.sdim=function u(e,t,i){if("undefined"==typeof t&&(t=[]),"object"!=typeof e)return t;"undefined"==typeof i&&(i=0),i in t||(t[i]=0),e.length>t[i]&&(t[i]=e.length);var n;for(n in e)e.hasOwnProperty(n)&&u(e[n],t,i+1);return t},numeric.sclone=function c(e,t,i){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=numeric.sdim(e).length);var n,r=Array(e.length);if(t===i-1){for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r}for(n in e)e.hasOwnProperty(n)&&(r[n]=c(e[n],t+1,i));return r},numeric.sdiag=function(e){var t,i,n=e.length,r=Array(n);for(t=n-1;t>=1;t-=2)i=t-1,r[t]=[],r[t][t]=e[t],r[i]=[],r[i][i]=e[i];return 0===t&&(r[0]=[],r[0][0]=e[t]),r},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,i,n,r=[];e.length;for(t in e)if(e.hasOwnProperty(t)){n=e[t];for(i in n)n.hasOwnProperty(i)&&("object"!=typeof r[i]&&(r[i]=[]),r[i][t]=n[i])}return r},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var i,n,r,o,s,a,l,u=e.length,c=(t.length,numeric.stranspose(t)),h=c.length,d=Array(u);for(r=u-1;r>=0;r--){for(l=[],i=e[r],s=h-1;s>=0;s--){a=0,n=c[s];for(o in i)i.hasOwnProperty(o)&&o in n&&(a+=i[o]*n[o]);a&&(l[s]=a)}d[r]=l}return d},numeric.sdotMV=function(e,t){var i,n,r,o,s=e.length,a=Array(s);for(n=s-1;n>=0;n--){i=e[n],o=0;for(r in i)i.hasOwnProperty(r)&&t[r]&&(o+=i[r]*t[r]);o&&(a[n]=o)}return a},numeric.sdotVM=function(e,t){var i,n,r,o,s=[];for(i in e)if(e.hasOwnProperty(i)){r=t[i],o=e[i];for(n in r)r.hasOwnProperty(n)&&(s[n]||(s[n]=0),s[n]+=o*r[n])}return s},numeric.sdotVV=function(e,t){var i,n=0;for(i in e)e[i]&&t[i]&&(n+=e[i]*t[i]);return n},numeric.sdot=function(e,t){var i=numeric.sdim(e).length,n=numeric.sdim(t).length,r=1e3*i+n;switch(r){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+i+" and "+n)}},numeric.sscatter=function(e){var t,i,n,r,o=e[0].length,s=e.length,a=[];for(i=o-1;i>=0;--i)if(e[s-1][i]){for(r=a,n=0;n<s-2;n++)t=e[n][i],r[t]||(r[t]=[]),r=r[t];r[e[n][i]]=e[n+1][i]}return a},numeric.sgather=function h(e,t,i){"undefined"==typeof t&&(t=[]),"undefined"==typeof i&&(i=[]);var n,r,o;n=i.length;for(r in e)if(e.hasOwnProperty(r))if(i[n]=parseInt(r),o=e[r],"number"==typeof o){if(o){if(0===t.length)for(r=n+1;r>=0;--r)t[r]=[];for(r=n;r>=0;--r)t[r].push(i[r]);t[n+1].push(o)}}else h(o,t,i);return i.length>n&&i.pop(),t},numeric.cLU=function(e){var t,i,n,r,o,s,a=e[0],l=e[1],u=e[2],c=a.length,h=0;for(t=0;t<c;t++)a[t]>h&&(h=a[t]);h++;var d,p,f,m=Array(h),g=Array(h),y=numeric.rep([h],1/0),v=numeric.rep([h],-(1/0));for(n=0;n<c;n++)t=a[n],i=l[n],i<y[t]&&(y[t]=i),i>v[t]&&(v[t]=i);for(t=0;t<h-1;t++)v[t]>v[t+1]&&(v[t+1]=v[t]);for(t=h-1;t>=1;t--)y[t]<y[t-1]&&(y[t-1]=y[t]);var E=0,T=0;for(t=0;t<h;t++)g[t]=numeric.rep([v[t]-y[t]+1],0),m[t]=numeric.rep([t-y[t]],0),E+=t-y[t]+1,T+=v[t]-t+1;for(n=0;n<c;n++)t=a[n],g[t][l[n]-y[t]]=u[n];for(t=0;t<h-1;t++)for(r=t-y[t],d=g[t],i=t+1;y[i]<=t&&i<h;i++)if(o=t-y[i],s=v[t]-t,p=g[i],f=p[o]/d[r]){for(n=1;n<=s;n++)p[n+o]-=f*d[n+r];m[i][t-y[i]]=f}var c,b,C,d=[],p=[],O=[],x=[],w=[],R=[];for(c=0,b=0,t=0;t<h;t++){for(r=y[t],o=v[t],C=g[t],i=t;i<=o;i++)C[i-r]&&(d[c]=t,p[c]=i,O[c]=C[i-r],c++);for(C=m[t],i=r;i<t;i++)C[i-r]&&(x[b]=t,w[b]=i,R[b]=C[i-r],b++);x[b]=t,w[b]=t,R[b]=1,b++}return{U:[d,p,O],L:[x,w,R]}},numeric.cLUsolve=function(e,t){var i,n,r=e.L,o=e.U,s=numeric.clone(t),a=r[0],l=r[1],u=r[2],c=o[0],h=o[1],d=o[2],p=c.length,f=(a.length,s.length);for(n=0,i=0;i<f;i++){for(;l[n]<i;)s[i]-=u[n]*s[l[n]],n++;n++}for(n=p-1,i=f-1;i>=0;i--){for(;h[n]>i;)s[i]-=d[n]*s[h[n]],n--;s[i]/=d[n],n--}return s},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var i,n,r,o=numeric.rep(e,-1);if("function"!=typeof t)switch(t){case"L":t=function(t,i){return t>=e[0]/2||i<e[1]/2};break;default:t=function(e,t){return!0}}for(r=0,i=1;i<e[0]-1;i++)for(n=1;n<e[1]-1;n++)t(i,n)&&(o[i][n]=r,r++);return o},numeric.cdelsq=function(e){var t,i,n,r,o,s=[[-1,0],[0,-1],[0,1],[1,0]],a=numeric.dim(e),l=a[0],u=a[1],c=[],h=[],d=[];for(t=1;t<l-1;t++)for(i=1;i<u-1;i++)if(!(e[t][i]<0)){for(n=0;n<4;n++)r=t+s[n][0],o=i+s[n][1],e[r][o]<0||(c.push(e[t][i]),h.push(e[r][o]),d.push(-1));c.push(e[t][i]),h.push(e[t][i]),d.push(4)}return[c,h,d]},numeric.cdotMV=function(e,t){var i,n,r,o=e[0],s=e[1],a=e[2],l=o.length;for(r=0,n=0;n<l;n++)o[n]>r&&(r=o[n]);for(r++,i=numeric.rep([r],0),n=0;n<l;n++)i[o[n]]+=a[n]*t[s[n]];return i},numeric.Spline=function(e,t,i,n,r){this.x=e,this.yl=t,this.yr=i,this.kl=n,this.kr=r},numeric.Spline.prototype._at=function(e,t){var e,i,n,r,o=this.x,s=this.yl,a=this.yr,l=this.kl,u=this.kr,c=numeric.add,h=numeric.sub,d=numeric.mul;i=h(d(l[t],o[t+1]-o[t]),h(a[t+1],s[t])),n=c(d(u[t+1],o[t]-o[t+1]),h(a[t+1],s[t])),r=(e-o[t])/(o[t+1]-o[t]);var p=r*(1-r);return c(c(c(d(1-r,s[t]),d(r,a[t+1])),d(i,p*(1-r))),d(n,p*r))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,i,n,r=this.x,o=r.length,s=Math.floor;for(t=0,i=o-1;i-t>1;)n=s((t+i)/2),r[n]<=e?t=n:i=n;return this._at(e,t)}var a,o=e.length,l=Array(o);for(a=o-1;a!==-1;--a)l[a]=this.at(e[a]);return l},numeric.Spline.prototype.diff=function(){var e,t,i,n=this.x,r=this.yl,o=this.yr,s=this.kl,a=this.kr,l=r.length,u=s,c=a,h=Array(l),d=Array(l),p=numeric.add,f=numeric.mul,m=numeric.div,g=numeric.sub;for(e=l-1;e!==-1;--e)t=n[e+1]-n[e],i=g(o[e+1],r[e]),h[e]=m(p(f(i,6),f(s[e],-4*t),f(a[e+1],-2*t)),t*t),d[e+1]=m(p(f(i,-6),f(s[e],2*t),f(a[e+1],4*t)),t*t);return new numeric.Spline(n,u,c,h,d)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],i=this.x,n=this.yl,r=this.yr,o=this.kl,s=this.kr;"number"==typeof n[0]&&(n=[n],r=[r],o=[o],s=[s]);var a,l,u,c,h,d,p,f,m,g,y,v,E,T,b,C,O,x,w,R,L,S,_,I,D=n.length,M=i.length-1,t=Array(D),A=Math.sqrt;for(a=0;a!==D;++a){for(c=n[a],h=r[a],d=o[a],p=s[a],f=[],l=0;l!==M;l++){for(l>0&&h[l]*c[l]<0&&f.push(i[l]),C=i[l+1]-i[l],O=i[l],y=c[l],v=h[l+1],m=d[l]/C,g=p[l+1]/C,b=e(m-g+3*(y-v))+12*g*y,E=g+3*y+2*m-3*v,T=3*(g+m+2*(y-v)),b<=0?(w=E/T,x=w>i[l]&&w<i[l+1]?[i[l],w,i[l+1]]:[i[l],i[l+1]]):(w=(E-A(b))/T,R=(E+A(b))/T,x=[i[l]],w>i[l]&&w<i[l+1]&&x.push(w),R>i[l]&&R<i[l+1]&&x.push(R),x.push(i[l+1])),S=x[0],w=this._at(S,l),u=0;u<x.length-1;u++)if(_=x[u+1],R=this._at(_,l),0!==w)if(0===R||w*R>0)S=_,w=R;else{for(var N=0;;){if(I=(w*_-R*S)/(w-R),I<=S||I>=_)break;if(L=this._at(I,l),L*R>0)_=I,R=L,N===-1&&(w*=.5),N=-1;else{if(!(L*w>0))break;S=I,w=L,1===N&&(R*=.5),N=1}}f.push(I),S=x[u+1],w=this._at(S,l)}else f.push(S),S=_,w=R;0===R&&f.push(_)}t[a]=f}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,i,n){var r,o=e.length,s=[],a=[],l=[],u=numeric.sub,c=numeric.mul,h=numeric.add;for(r=o-2;r>=0;r--)a[r]=e[r+1]-e[r],l[r]=u(t[r+1],t[r]);"string"!=typeof i&&"string"!=typeof n||(i=n="periodic");var d=[[],[],[]];switch(typeof i){case"undefined":s[0]=c(3/(a[0]*a[0]),l[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/a[0],1/a[0]);break;case"string":s[0]=h(c(3/(a[o-2]*a[o-2]),l[o-2]),c(3/(a[0]*a[0]),l[0])),d[0].push(0,0,0),d[1].push(o-2,0,1),d[2].push(1/a[o-2],2/a[o-2]+2/a[0],1/a[0]);break;default:s[0]=i,d[0].push(0),d[1].push(0),d[2].push(1)}for(r=1;r<o-1;r++)s[r]=h(c(3/(a[r-1]*a[r-1]),l[r-1]),c(3/(a[r]*a[r]),l[r])),d[0].push(r,r,r),d[1].push(r-1,r,r+1),d[2].push(1/a[r-1],2/a[r-1]+2/a[r],1/a[r]);switch(typeof n){case"undefined":s[o-1]=c(3/(a[o-2]*a[o-2]),l[o-2]),d[0].push(o-1,o-1),d[1].push(o-2,o-1),d[2].push(1/a[o-2],2/a[o-2]);break;case"string":d[1][d[1].length-1]=0;break;default:s[o-1]=n,d[0].push(o-1),d[1].push(o-1),d[2].push(1)}s="number"!=typeof s[0]?numeric.transpose(s):[s];var p=Array(s.length);if("string"==typeof i)for(r=p.length-1;r!==-1;--r)p[r]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(d)),s[r]),p[r][o-1]=p[r][0];else for(r=p.length-1;r!==-1;--r)p[r]=numeric.cLUsolve(numeric.cLU(d),s[r]);return p="number"==typeof t[0]?p[0]:numeric.transpose(p),new numeric.Spline(e,t,t,p,p)},numeric.fftpow2=function d(e,t){var i=e.length;if(1!==i){var n,r,o=Math.cos,s=Math.sin,a=Array(i/2),l=Array(i/2),u=Array(i/2),c=Array(i/2);for(r=i/2,n=i-1;n!==-1;--n)--r,u[r]=e[n],c[r]=t[n],--n,a[r]=e[n],l[r]=t[n];d(a,l),d(u,c),r=i/2;var h,p,f,m=-6.283185307179586/i;for(n=i-1;n!==-1;--n)--r,r===-1&&(r=i/2-1),h=m*n,p=o(h),f=s(h),e[n]=a[r]+p*u[r]-f*c[r],t[n]=l[r]+p*c[r]+f*u[r]}},numeric._ifftpow2=function p(e,t){var i=e.length;if(1!==i){var n,r,o=Math.cos,s=Math.sin,a=Array(i/2),l=Array(i/2),u=Array(i/2),c=Array(i/2);for(r=i/2,n=i-1;n!==-1;--n)--r,u[r]=e[n],c[r]=t[n],--n,a[r]=e[n],l[r]=t[n];p(a,l),p(u,c),r=i/2;var h,d,f,m=6.283185307179586/i;for(n=i-1;n!==-1;--n)--r,r===-1&&(r=i/2-1),h=m*n,d=o(h),f=s(h),e[n]=a[r]+d*u[r]-f*c[r],t[n]=l[r]+d*c[r]+f*u[r]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,i,n){numeric.fftpow2(e,t),numeric.fftpow2(i,n);var r,o,s,a,l,u=e.length;for(r=u-1;r!==-1;--r)o=e[r],a=t[r],s=i[r],l=n[r],e[r]=o*s-a*l,t[r]=o*l+a*s;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,i=this.x,n=this.y,r=i.length,o=Math.log,s=o(2),a=Math.ceil(o(2*r-1)/s),l=Math.pow(2,a),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,p=-3.141592653589793/r,f=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(r/2);for(e=0;e<r;e++)f[e]=i[e];if("undefined"!=typeof n)for(e=0;e<r;e++)m[e]=n[e];for(u[0]=1,e=1;e<=l/2;e++)t=p*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(f,m),y=new numeric.T(u,c);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),g=g.mul(y),g.x.length=r,g.y.length=r,g},numeric.T.prototype.ifft=function(){var e,t,i=this.x,n=this.y,r=i.length,o=Math.log,s=o(2),a=Math.ceil(o(2*r-1)/s),l=Math.pow(2,a),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,p=3.141592653589793/r,f=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(r/2);for(e=0;e<r;e++)f[e]=i[e];if("undefined"!=typeof n)for(e=0;e<r;e++)m[e]=n[e];for(u[0]=1,e=1;e<=l/2;e++)t=p*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(f,m),y=new numeric.T(u,c);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),g=g.mul(y),g.x.length=r,g.y.length=r,g.div(r)},numeric.gradient=function(e,t){var i=t.length,n=e(t);if(isNaN(n))throw new Error("gradient: f(x) is a NaN!");var r,o,s,a,l,u,c,h,d,p,f=Math.max,m=numeric.clone(t),g=Array(i),f=(numeric.div,numeric.sub,Math.max),y=.001,v=Math.abs,E=Math.min,T=0;for(r=0;r<i;r++)for(var b=f(1e-6*n,1e-8);;){if(++T,T>20)throw new Error("Numerical gradient fails");if(m[r]=t[r]+b,o=e(m),m[r]=t[r]-b,s=e(m),m[r]=t[r],isNaN(o)||isNaN(s))b/=16;else{if(g[r]=(o-s)/(2*b),l=t[r]-b,u=t[r],c=t[r]+b,h=(o-n)/b,d=(n-s)/b,p=f(v(g[r]),v(n),v(o),v(s),v(l),v(u),v(c),1e-8),a=E(f(v(h-g[r]),v(d-g[r]),v(h-d))/p,b/p),!(a>y))break;b/=16}}return g},numeric.uncmin=function(e,t,i,n,r,o,s){var a=numeric.gradient;"undefined"==typeof s&&(s={}),"undefined"==typeof i&&(i=1e-8),"undefined"==typeof n&&(n=function(t){return a(e,t)}),"undefined"==typeof r&&(r=1e3),t=numeric.clone(t);var l,u,c=t.length,h=e(t);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var d=Math.max,p=numeric.norm2;i=d(i,numeric.epsilon);var f,m,g,y,v,E,T,b,C,O,x=s.Hinv||numeric.identity(c),w=numeric.dot,R=(numeric.inv,numeric.sub),L=numeric.add,S=numeric.tensor,_=numeric.div,I=numeric.mul,D=numeric.all,M=numeric.isFinite,A=numeric.neg,N=0,P="";for(m=n(t);N<r;){if("function"==typeof o&&o(N,t,h,m,x)){P="Callback returned true";break}if(!D(M(m))){P="Gradient has Infinity or NaN";break}if(f=A(w(x,m)),!D(M(f))){P="Search direction has Infinity or NaN";break}if(O=p(f),O<i){P="Newton step smaller than tol";break}for(C=1,u=w(m,f),v=t;N<r&&!(C*O<i)&&(y=I(f,C),v=L(t,y),l=e(v),l-h>=.1*C*u||isNaN(l));)C*=.5,++N;if(C*O<i){P="Line search step size smaller than tol";break}if(N===r){P="maxit reached during line search";break}g=n(v),E=R(g,m),b=w(E,y),T=w(x,E),x=R(L(x,I((b+w(E,T))/(b*b),S(y,y))),_(L(S(T,y),S(y,T)),b)),t=v,h=l,m=g,++N}return{solution:t,f:h,gradient:m,invHessian:x,iterations:N,message:P}},numeric.Dopri=function(e,t,i,n,r,o,s){this.x=e,this.y=t,this.f=i,this.ymid=n,this.iterations=r,this.events=s,this.message=o},numeric.Dopri.prototype._at=function(e,t){function i(e){return e*e}var n,r,o,s,a,l,e,u,c,h,d,p=this,f=p.x,m=p.y,g=p.f,y=p.ymid,v=(f.length,Math.floor,.5),E=numeric.add,T=numeric.mul,b=numeric.sub;return n=f[t],r=f[t+1],s=m[t],a=m[t+1],u=r-n,o=n+v*u,l=y[t],c=b(g[t],T(s,1/(n-o)+2/(n-r))),h=b(g[t+1],T(a,1/(r-o)+2/(r-n))),d=[i(e-r)*(e-o)/i(n-r)/(n-o),i(e-n)*i(e-r)/i(n-o)/i(r-o),i(e-n)*(e-o)/i(r-n)/(r-o),(e-n)*i(e-r)*(e-o)/i(n-r)/(n-o),(e-r)*i(e-n)*(e-o)/i(n-r)/(r-o)],E(E(E(E(T(s,d[0]),T(l,d[1])),T(a,d[2])),T(c,d[3])),T(h,d[4]))},numeric.Dopri.prototype.at=function(e){var t,i,n,r=Math.floor;if("number"!=typeof e){var o=e.length,s=Array(o);for(t=o-1;t!==-1;--t)s[t]=this.at(e[t]);return s}var a=this.x;for(t=0,i=a.length-1;i-t>1;)n=r(.5*(t+i)),a[n]<=e?t=n:i=n;return this._at(e,t)},numeric.dopri=function(e,t,i,n,r,o,s){"undefined"==typeof r&&(r=1e-6),"undefined"==typeof o&&(o=1e3);var a,l,u,c,h,d,p,f,m,g,y,v,E,T=[e],b=[i],C=[n(e,i)],O=[],x=.2,w=[.075,.225],R=[44/45,-56/15,32/9],L=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],_=[35/384,0,500/1113,125/192,-2187/6784,11/84],I=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],D=[.2,.3,.8,8/9,1,1],M=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],A=0,N=(t-e)/10,P=0,k=numeric.add,H=numeric.mul,F=(Math.max,Math.min),B=Math.abs,K=numeric.norminf,z=Math.pow,U=numeric.any,V=numeric.lt,G=numeric.and,$=(numeric.sub,new numeric.Dopri(T,b,C,O,(-1),""));for("function"==typeof s&&(y=s(e,i));e<t&&P<o;)if(++P,e+N>t&&(N=t-e),a=n(e+D[0]*N,k(i,H(x*N,C[A]))),l=n(e+D[1]*N,k(k(i,H(w[0]*N,C[A])),H(w[1]*N,a))),u=n(e+D[2]*N,k(k(k(i,H(R[0]*N,C[A])),H(R[1]*N,a)),H(R[2]*N,l))),c=n(e+D[3]*N,k(k(k(k(i,H(L[0]*N,C[A])),H(L[1]*N,a)),H(L[2]*N,l)),H(L[3]*N,u))),h=n(e+D[4]*N,k(k(k(k(k(i,H(S[0]*N,C[A])),H(S[1]*N,a)),H(S[2]*N,l)),H(S[3]*N,u)),H(S[4]*N,c))),m=k(k(k(k(k(i,H(C[A],N*_[0])),H(l,N*_[2])),H(u,N*_[3])),H(c,N*_[4])),H(h,N*_[5])),d=n(e+N,m),p=k(k(k(k(k(H(C[A],N*M[0]),H(l,N*M[2])),H(u,N*M[3])),H(c,N*M[4])),H(h,N*M[5])),H(d,N*M[6])),g="number"==typeof p?B(p):K(p),g>r){if(N=.2*N*z(r/g,.25),e+N===e){$.msg="Step size became too small";break}}else{if(O[A]=k(k(k(k(k(k(i,H(C[A],N*I[0])),H(l,N*I[2])),H(u,N*I[3])),H(c,N*I[4])),H(h,N*I[5])),H(d,N*I[6])),++A,T[A]=e+N,b[A]=m,C[A]=d,"function"==typeof s){var W,j,X=e,q=e+.5*N;if(v=s(q,O[A-1]),E=G(V(y,0),V(0,v)),U(E)||(X=q,q=e+N,y=v,v=s(q,m),E=G(V(y,0),V(0,v))),U(E)){for(var Z,Y,J=0,Q=1,ee=1;;){if("number"==typeof y)j=(ee*v*X-Q*y*q)/(ee*v-Q*y);else for(j=q,f=y.length-1;f!==-1;--f)y[f]<0&&v[f]>0&&(j=F(j,(ee*v[f]*X-Q*y[f]*q)/(ee*v[f]-Q*y[f])));if(j<=X||j>=q)break;W=$._at(j,A-1),Y=s(j,W),Z=G(V(y,0),V(0,Y)),U(Z)?(q=j,v=Y,E=Z,ee=1,J===-1?Q*=.5:Q=1,J=-1):(X=j,y=Y,Q=1,1===J?ee*=.5:ee=1,J=1)}return m=$._at(.5*(e+j),A-1),$.f[A]=n(j,W),$.x[A]=j,$.y[A]=W,$.ymid[A-1]=m,$.events=E,$.iterations=P,$}}e+=N,i=m,y=v,N=F(.8*N*z(r/g,.25),4*N)}return $.iterations=P,$},numeric.LU=function(e,t){t=t||!1;var i,n,r,o,s,a,l,u,c,h=Math.abs,d=e.length,p=d-1,f=new Array(d);for(t||(e=numeric.clone(e)),r=0;r<d;++r){for(l=r,a=e[r],c=h(a[r]),n=r+1;n<d;++n)o=h(e[n][r]),c<o&&(c=o,l=n);for(f[r]=l,l!=r&&(e[r]=e[l],e[l]=a,a=e[r]),s=a[r],i=r+1;i<d;++i)e[i][r]/=s;for(i=r+1;i<d;++i){for(u=e[i],n=r+1;n<p;++n)u[n]-=u[r]*a[n],++n,u[n]-=u[r]*a[n];n===p&&(u[n]-=u[r]*a[n])}}return{LU:e,P:f}},numeric.LUsolve=function(e,t){var i,n,r,o,s,a=e.LU,l=a.length,u=numeric.clone(t),c=e.P;for(i=l-1;i!==-1;--i)u[i]=t[i];for(i=0;i<l;++i)for(r=c[i],c[i]!==i&&(s=u[i],u[i]=u[r],u[r]=s),o=a[i],n=0;n<i;++n)u[i]-=u[n]*o[n];for(i=l-1;i>=0;--i){for(o=a[i],n=i+1;n<l;++n)u[i]-=u[n]*o[n];u[i]/=o[i]}return u},numeric.solve=function(e,t,i){return numeric.LUsolve(numeric.LU(e,i),t)},numeric.echelonize=function(e){var t,i,n,r,o,s,a,l,u=numeric.dim(e),c=u[0],h=u[1],d=numeric.identity(c),p=Array(c),f=Math.abs,m=numeric.diveq;for(e=numeric.clone(e),t=0;t<c;++t){for(n=0,o=e[t],s=d[t],i=1;i<h;++i)f(o[n])<f(o[i])&&(n=i);for(p[t]=n,m(s,o[n]),m(o,o[n]),i=0;i<c;++i)if(i!==t){for(a=e[i],l=a[n],r=h-1;r!==-1;--r)a[r]-=o[r]*l;for(a=d[i],r=c-1;r!==-1;--r)a[r]-=s[r]*l}}return{I:d,A:e,P:p}},numeric.__solveLP=function(e,t,i,n,r,o,s){var a,l,u,c,h=numeric.sum,d=(numeric.log,numeric.mul),p=numeric.sub,f=numeric.dot,m=numeric.div,g=numeric.add,y=e.length,v=i.length,E=!1,T=0,b=1,C=(numeric.transpose(t),numeric.svd,numeric.transpose),O=(numeric.leq,Math.sqrt),x=Math.abs,w=(numeric.muleq,numeric.norminf,numeric.any,Math.min),R=numeric.all,L=numeric.gt,S=Array(y),_=Array(v),I=(numeric.rep([v],1),numeric.solve),D=p(i,f(t,o)),M=f(e,e);for(u=T;u<r;++u){var A,N;for(A=v-1;A!==-1;--A)_[A]=m(t[A],D[A]);var P=C(_);for(A=y-1;A!==-1;--A)S[A]=h(P[A]);b=.25*x(M/f(e,S));var k=100*O(M/f(S,S));for((!isFinite(b)||b>k)&&(b=k),c=g(e,d(b,S)),l=f(P,_),A=y-1;A!==-1;--A)l[A][A]+=1;N=I(l,m(c,b),!0);var H=m(D,f(t,N)),F=1;for(A=v-1;A!==-1;--A)H[A]<0&&(F=w(F,-.999*H[A]));if(a=p(o,d(N,F)),D=p(i,f(t,a)),!R(L(D,0)))return{solution:o,message:"",iterations:u};if(o=a,b<n)return{solution:a,message:"",iterations:u};if(s){var B=f(e,c),K=f(t,c);for(E=!0,A=v-1;A!==-1;--A)if(B*K[A]<0){E=!1;break}}else E=!(o[y-1]>=0);if(E)return{solution:a,message:"Unbounded",iterations:u}}return{solution:o,message:"maximum iteration count exceeded",iterations:u}},numeric._solveLP=function(e,t,i,n,r){var o,s=e.length,a=i.length,l=(numeric.sum,numeric.log,numeric.mul,numeric.sub),u=numeric.dot,c=(numeric.div,numeric.add,numeric.rep([s],0).concat([1])),h=numeric.rep([a,1],-1),d=numeric.blockMatrix([[t,h]]),p=i,o=numeric.rep([s],0).concat(Math.max(0,numeric.sup(numeric.neg(i)))+1),f=numeric.__solveLP(c,d,p,n,r,o,!1),m=numeric.clone(f.solution);m.length=s;var g=numeric.inf(l(i,u(t,m)));if(g<0)return{solution:NaN,message:"Infeasible",iterations:f.iterations};var y=numeric.__solveLP(e,t,i,n,r-f.iterations,m,!0);return y.iterations+=f.iterations,y},numeric.solveLP=function(e,t,i,n,r,o,s){if("undefined"==typeof s&&(s=1e3),"undefined"==typeof o&&(o=numeric.epsilon),"undefined"==typeof n)return numeric._solveLP(e,t,i,o,s);var a,l=n.length,u=n[0].length,c=t.length,h=numeric.echelonize(n),d=numeric.rep([u],0),p=h.P,f=[];for(a=p.length-1;a!==-1;--a)d[p[a]]=1;for(a=u-1;a!==-1;--a)0===d[a]&&f.push(a);var m=numeric.getRange,g=numeric.linspace(0,l-1),y=numeric.linspace(0,c-1),v=m(n,g,f),E=m(t,y,p),T=m(t,y,f),b=numeric.dot,C=numeric.sub,O=b(E,h.I),x=C(T,b(O,v)),w=C(i,b(O,r)),R=Array(p.length),L=Array(f.length);for(a=p.length-1;a!==-1;--a)R[a]=e[p[a]];for(a=f.length-1;a!==-1;--a)L[a]=e[f[a]];var S=C(L,b(R,b(h.I,v))),_=numeric._solveLP(S,x,w,o,s),I=_.solution;if(I!==I)return _;var D=b(h.I,C(r,b(v,I))),M=Array(e.length);for(a=p.length-1;a!==-1;--a)M[p[a]]=D[a];for(a=f.length-1;a!==-1;--a)M[f[a]]=I[a];return{solution:M,message:_.message,iterations:_.iterations}},numeric.MPStoLP=function(e){function t(t){throw new Error("MPStoLP: "+t+"\nLine "+i+": "+e[i]+"\nCurrent state: "+a[s]+"\n")}e instanceof String&&e.split("\n");var i,n,r,o,s=0,a=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],l=e.length,u=0,c={},h=[],d=0,p={},f=0,m=[],g=[],y=[];for(i=0;i<l;++i){r=e[i];var v=r.match(/\S*/g),E=[];for(n=0;n<v.length;++n)""!==v[n]&&E.push(v[n]);if(0!==E.length){for(n=0;n<a.length&&r.substr(0,a[n].length)!==a[n];++n);if(n<a.length){if(s=n,1===n&&(o=E[1]),6===n)return{name:o,c:m,A:numeric.transpose(g),b:y,rows:c,vars:p}}else switch(s){case 0:case 1:t("Unexpected line");case 2:switch(E[0]){case"N":0===u?u=E[1]:t("Two or more N rows");break;case"L":c[E[1]]=d,h[d]=1,y[d]=0,++d;break;case"G":c[E[1]]=d,h[d]=-1,y[d]=0,++d;break;case"E":c[E[1]]=d,h[d]=0,y[d]=0,++d;break;default:t("Parse error "+numeric.prettyPrint(E))}break;case 3:p.hasOwnProperty(E[0])||(p[E[0]]=f,m[f]=0,g[f]=numeric.rep([d],0),++f);var T=p[E[0]];for(n=1;n<E.length;n+=2)if(E[n]!==u){var b=c[E[n]];g[T][b]=(h[b]<0?-1:1)*parseFloat(E[n+1])}else m[T]=parseFloat(E[n+1]);break;case 4:for(n=1;n<E.length;n+=2)y[c[E[n]]]=(h[c[E[n]]]<0?-1:1)*parseFloat(E[n+1]);break;case 5:break;case 6:t("Internal error")}}}t("Reached end of file without ENDATA")},numeric.svd=function(e){function t(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var i,n=numeric.epsilon,r=1e-64/n,o=50,s=0,a=0,l=0,u=0,c=0,h=numeric.clone(e),d=h.length,p=h[0].length;if(d<p)throw"Need more rows than columns";var f=new Array(p),m=new Array(p);for(a=0;a<p;a++)f[a]=m[a]=0;var g=numeric.rep([p,p],0),y=0,v=0,E=0,T=0,b=0,C=0,O=0;for(a=0;a<p;a++){for(f[a]=v,O=0,c=a+1,l=a;l<d;l++)O+=h[l][a]*h[l][a];if(O<=r)v=0;else for(y=h[a][a],v=Math.sqrt(O),y>=0&&(v=-v),E=y*v-O,h[a][a]=y-v,l=c;l<p;l++){for(O=0,u=a;u<d;u++)O+=h[u][a]*h[u][l];for(y=O/E,u=a;u<d;u++)h[u][l]+=y*h[u][a]}for(m[a]=v,O=0,l=c;l<p;l++)O+=h[a][l]*h[a][l];if(O<=r)v=0;else{for(y=h[a][a+1],v=Math.sqrt(O),y>=0&&(v=-v),E=y*v-O,h[a][a+1]=y-v,l=c;l<p;l++)f[l]=h[a][l]/E;for(l=c;l<d;l++){for(O=0,u=c;u<p;u++)O+=h[l][u]*h[a][u];for(u=c;u<p;u++)h[l][u]+=O*f[u]}}b=Math.abs(m[a])+Math.abs(f[a]),b>T&&(T=b)}for(a=p-1;a!=-1;a+=-1){if(0!=v){for(E=v*h[a][a+1],l=c;l<p;l++)g[l][a]=h[a][l]/E;for(l=c;l<p;l++){for(O=0,u=c;u<p;u++)O+=h[a][u]*g[u][l];for(u=c;u<p;u++)g[u][l]+=O*g[u][a]}}for(l=c;l<p;l++)g[a][l]=0,g[l][a]=0;g[a][a]=1,v=f[a],c=a}for(a=p-1;a!=-1;a+=-1){for(c=a+1,v=m[a],l=c;l<p;l++)h[a][l]=0;if(0!=v){for(E=h[a][a]*v,l=c;l<p;l++){for(O=0,u=c;u<d;u++)O+=h[u][a]*h[u][l];for(y=O/E,u=a;u<d;u++)h[u][l]+=y*h[u][a]}for(l=a;l<d;l++)h[l][a]=h[l][a]/v}else for(l=a;l<d;l++)h[l][a]=0;h[a][a]+=1}for(n*=T,u=p-1;u!=-1;u+=-1)for(var x=0;x<o;x++){var w=!1;for(c=u;c!=-1;c+=-1){if(Math.abs(f[c])<=n){w=!0;break}if(Math.abs(m[c-1])<=n)break}if(!w){s=0,O=1;var R=c-1;for(a=c;a<u+1&&(y=O*f[a],f[a]=s*f[a],!(Math.abs(y)<=n));a++)for(v=m[a],E=t(y,v),m[a]=E,s=v/E,O=-y/E,l=0;l<d;l++)b=h[l][R],C=h[l][a],h[l][R]=b*s+C*O,h[l][a]=-b*O+C*s}if(C=m[u],c==u){if(C<0)for(m[u]=-C,l=0;l<p;l++)g[l][u]=-g[l][u];break}if(x>=o-1)throw"Error: no convergence.";for(T=m[c],b=m[u-1],v=f[u-1],E=f[u],y=((b-C)*(b+C)+(v-E)*(v+E))/(2*E*b),v=t(y,1),y=y<0?((T-C)*(T+C)+E*(b/(y-v)-E))/T:((T-C)*(T+C)+E*(b/(y+v)-E))/T,s=1,O=1,a=c+1;a<u+1;a++){for(v=f[a],b=m[a],E=O*v,v=s*v,C=t(y,E),f[a-1]=C,s=y/C,O=E/C,y=T*s+v*O,v=-T*O+v*s,E=b*O,b*=s,l=0;l<p;l++)T=g[l][a-1],C=g[l][a],g[l][a-1]=T*s+C*O,g[l][a]=-T*O+C*s;for(C=t(y,E),m[a-1]=C,s=y/C,O=E/C,y=s*v+O*b,T=-O*v+s*b,l=0;l<d;l++)b=h[l][a-1],C=h[l][a],h[l][a-1]=b*s+C*O,h[l][a]=-b*O+C*s}f[c]=0,f[u]=y,m[u]=T}for(a=0;a<m.length;a++)m[a]<n&&(m[a]=0);for(a=0;a<p;a++)for(l=a-1;l>=0;l--)if(m[l]<m[a]){for(s=m[l],m[l]=m[a],m[a]=s,u=0;u<h.length;u++)i=h[u][a],h[u][a]=h[u][l],h[u][l]=i;for(u=0;u<g.length;u++)i=g[u][a],g[u][a]=g[u][l],g[u][l]=i;a=l}return{U:h,S:m,V:g}},function(){function e(t){for(var i=t.c.length;i--;)"object"==typeof t.c[i]&&e(t.c[i]);t.n=t.a=t.c=null}function t(e,i,n,r){var o,s,a=i+"<"+e.n,l=e.c.length,u=0;for(o in e.a)a+=" "+o+'="'+e.a[o]+'"';if(a+=l?">":" />",r.push(a),l){do if(s=e.c[u++],"string"==typeof s){if(1==l)return r.push(r.pop()+s+"</"+e.n+">");r.push(i+n+s)}else"object"==typeof s&&t(s,i+n,n,r);while(u<l);r.push(i+"</"+e.n+">")}}var i=XMLWriter.prototype={encoding:"UTF-8",version:"1.0",formatting:"indented",indentChar:"\t",indentation:1,newLine:"\n",writeStartDocument:function(e){this.close(),this.stack=[],this.standalone=e},writeEndDocument:function(){this.active=this.root,this.stack=[]},writeDocType:function(e){this.doctype=e},writeStartElement:function(e,t){t&&(e=t+":"+e);var i={n:e,a:{},c:[]};this.active?(this.active.c.push(i),this.stack.push(this.active)):this.root=i,this.active=i},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(e,t){this.active&&(this.active.a[e]=t)},writeString:function(e){this.active&&this.active.c.push(e)},writeXML:function(e){this.active&&this.active.c.push(e)},writeElementString:function(e,t,i){this.writeStartElement(e,i).writeString(t).writeEndElement()},writeCDATA:function(e){e=e.replace(/>>]/g,"]]><![CDATA[>"),this.writeString("<![CDATA["+e+"]]>")},writeComment:function(e){this.writeString("<!-- "+e+" -->")},flush:function(){this.writeEndDocument();var e="",i=this.indentation,n="indented"==this.formatting.toLowerCase(),r=['<?xml version="'+this.version+'" encoding="'+this.encoding+'"'];if(void 0!==this.standalone&&(r[0]+=' standalone="'+!!this.standalone+'"'),r[0]+=" ?>",this.doctype&&this.root&&r.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">"),n)for(;i--;)e+=this.indentChar;return this.root&&t(this.root,"",e,r),r.join(n?this.newLine:"")},close:function(){this.root&&e(this.root),this.active=this.root=this.stack=null},getDocument:window.ActiveXObject?function(){var e=new ActiveXObject("Microsoft.XMLDOM");return e.async=!1,e.loadXML(this.flush()),e}:function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")}};for(var n in i)if("function"==typeof i[n]&&!/flush|getDocument/.test(n)){var r=i[n];i[n]=function(){return arguments.callee._o_.apply(this,arguments),this},i[n]._o_=r}}();var TWEEN=TWEEN||function(){var e,t,i=60,n=!1,r=[];return{setFPS:function(e){i=e||60},start:function(e){0!=arguments.length&&this.setFPS(e),t=setInterval(this.update,1e3/i)},stop:function(){clearInterval(t)},setAutostart:function(e){n=e,n&&!t&&this.start()},add:function(e){r.push(e),n&&!t&&this.start()},getAll:function(){return r},removeAll:function(){r=[]},remove:function(t){e=r.indexOf(t),e!==-1&&r.splice(e,1)},update:function(t){e=0,num_tweens=r.length;for(var i=t||Date.now();e<num_tweens;)r[e].update(i)?e++:(r.splice(e,1),num_tweens--);0==num_tweens&&1==n&&this.stop()}}}();TWEEN.Tween=function(e){var t=e,i={},n={},r={},o=1e3,s=0,a=null,l=TWEEN.Easing.Linear.EaseNone,u=null,c=null,h=null;
this.to=function(e,i){null!==i&&(o=i);for(var n in e)null!==t[n]&&(r[n]=e[n]);return this},this.start=function(e){TWEEN.add(this),a=e?e+s:Date.now()+s;for(var o in r)null!==t[o]&&(i[o]=t[o],n[o]=r[o]-t[o]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(e){return s=e,this},this.easing=function(e){return l=e,this},this.chain=function(e){u=e},this.onUpdate=function(e){return c=e,this},this.onComplete=function(e){return h=e,this},this.update=function(e){var r,s,d;if(e<a)return!0;s=(e-a)/o,s=s>1?1:s,d=l(s);for(r in n)t[r]=i[r]+n[r]*d;return null!==c&&c.call(t,d),1!=s||(null!==h&&h.call(t),null!==u&&u.start(),!1)}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(e){return e},TWEEN.Easing.Quadratic.EaseIn=function(e){return e*e},TWEEN.Easing.Quadratic.EaseOut=function(e){return-e*(e-2)},TWEEN.Easing.Quadratic.EaseInOut=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(e){return e*e*e},TWEEN.Easing.Cubic.EaseOut=function(e){return--e*e*e+1},TWEEN.Easing.Cubic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},TWEEN.Easing.Quartic.EaseIn=function(e){return e*e*e*e},TWEEN.Easing.Quartic.EaseOut=function(e){return-(--e*e*e*e-1)},TWEEN.Easing.Quartic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},TWEEN.Easing.Quintic.EaseIn=function(e){return e*e*e*e*e},TWEEN.Easing.Quintic.EaseOut=function(e){return(e-=1)*e*e*e*e+1},TWEEN.Easing.Quintic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(e){return-Math.cos(e*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(e){return Math.sin(e*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(e){return-.5*(Math.cos(Math.PI*e)-1)},TWEEN.Easing.Exponential.EaseIn=function(e){return 0==e?0:Math.pow(2,10*(e-1))},TWEEN.Easing.Exponential.EaseOut=function(e){return 1==e?1:-Math.pow(2,-10*e)+1},TWEEN.Easing.Exponential.EaseInOut=function(e){return 0==e?0:1==e?1:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*(e-1))+2)},TWEEN.Easing.Circular.EaseIn=function(e){return-(Math.sqrt(1-e*e)-1)},TWEEN.Easing.Circular.EaseOut=function(e){return Math.sqrt(1- --e*e)},TWEEN.Easing.Circular.EaseInOut=function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},TWEEN.Easing.Elastic.EaseIn=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||i<1?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)))},TWEEN.Easing.Elastic.EaseOut=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||i<1?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/n)+1)},TWEEN.Easing.Elastic.EaseInOut=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||i<1?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),(e*=2)<1?-.5*(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)):i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)*.5+1)},TWEEN.Easing.Back.EaseIn=function(e){var t=1.70158;return e*e*((t+1)*e-t)},TWEEN.Easing.Back.EaseOut=function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},TWEEN.Easing.Back.EaseInOut=function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)},TWEEN.Easing.Bounce.EaseIn=function(e){return 1-TWEEN.Easing.Bounce.EaseOut(1-e)},TWEEN.Easing.Bounce.EaseOut=function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},TWEEN.Easing.Bounce.EaseInOut=function(e){return e<.5?.5*TWEEN.Easing.Bounce.EaseIn(2*e):.5*TWEEN.Easing.Bounce.EaseOut(2*e-1)+.5};var Stats=function(){var e,t,i,n,r,o,s,a,l=0,u=0,c=Date.now(),h=c,d=c,p=0,f=1e3,m=0,g=[[16,16,48],[0,255,255]],y=0,v=1e3,E=0,T=[[16,48,16],[0,255,0]];for(e=document.createElement("div"),e.style.cursor="pointer",e.style.width="80px",e.style.opacity="0.9",e.style.zIndex="10001",e.addEventListener("mousedown",function(e){e.preventDefault(),l=(l+1)%2,0==l?(i.style.display="block",o.style.display="none"):(i.style.display="none",o.style.display="block")},!1),i=document.createElement("div"),i.style.textAlign="left",i.style.lineHeight="1.2em",i.style.backgroundColor="rgb("+Math.floor(g[0][0]/2)+","+Math.floor(g[0][1]/2)+","+Math.floor(g[0][2]/2)+")",i.style.padding="0 0 3px 3px",e.appendChild(i),n=document.createElement("div"),n.style.fontFamily="Helvetica, Arial, sans-serif",n.style.fontSize="9px",n.style.color="rgb("+g[1][0]+","+g[1][1]+","+g[1][2]+")",n.style.fontWeight="bold",n.innerHTML="FPS",i.appendChild(n),r=document.createElement("div"),r.style.position="relative",r.style.width="74px",r.style.height="30px",r.style.backgroundColor="rgb("+g[1][0]+","+g[1][1]+","+g[1][2]+")",i.appendChild(r);74>r.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height="30px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+g[0][0]+","+g[0][1]+","+g[0][2]+")",r.appendChild(t);for(o=document.createElement("div"),o.style.textAlign="left",o.style.lineHeight="1.2em",o.style.backgroundColor="rgb("+Math.floor(T[0][0]/2)+","+Math.floor(T[0][1]/2)+","+Math.floor(T[0][2]/2)+")",o.style.padding="0 0 3px 3px",o.style.display="none",e.appendChild(o),s=document.createElement("div"),s.style.fontFamily="Helvetica, Arial, sans-serif",s.style.fontSize="9px",s.style.color="rgb("+T[1][0]+","+T[1][1]+","+T[1][2]+")",s.style.fontWeight="bold",s.innerHTML="MS",o.appendChild(s),a=document.createElement("div"),a.style.position="relative",a.style.width="74px",a.style.height="30px",a.style.backgroundColor="rgb("+T[1][0]+","+T[1][1]+","+T[1][2]+")",o.appendChild(a);74>a.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height=30*Math.random()+"px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+T[0][0]+","+T[0][1]+","+T[0][2]+")",a.appendChild(t);return{getDomElement:function(){return e},getFps:function(){return p},getFpsMin:function(){return f},getFpsMax:function(){return m},getMs:function(){return y},getMsMin:function(){return v},getMsMax:function(){return E},update:function(){c=Date.now(),y=c-h,v=Math.min(v,y),E=Math.max(E,y),s.textContent=y+" MS ("+v+"-"+E+")";var e=Math.min(30,30-30*(y/200));a.appendChild(a.firstChild).style.height=e+"px",h=c,u++,c>d+1e3&&(p=Math.round(1e3*u/(c-d)),f=Math.min(f,p),m=Math.max(m,p),n.textContent=p+" FPS ("+f+"-"+m+")",e=Math.min(30,30-30*(p/100)),r.appendChild(r.firstChild).style.height=e+"px",d=c,u=0)}}};if(function(e,t){function i(t,i){var r,o,s,a=t.nodeName.toLowerCase();return"area"===a?(r=t.parentNode,o=r.name,!(!t.href||!o||"map"!==r.nodeName.toLowerCase())&&(s=e("img[usemap=#"+o+"]")[0],!!s&&n(s))):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,r,o=e(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function r(t,i,n,r){return e.each(o,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),r&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(s,r(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(s,r(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var r,o=e.ui[t].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(e,t,i){var n,r=e.plugins[t];if(r&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<r.length;n++)e.options[r[n][0]]&&r[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[n]>0||(t[n]=1,r=t[n]>0,t[n]=0,r)}})}(jQuery),function(e,t){var i=0,n=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(o){}r(t)},e.widget=function(t,i,n){var r,o,s,a,l={},u=t.split(".")[0];t=t.split(".")[1],r=u+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[u]=e[u]||{},o=e[u][t],s=e[u][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,o,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),a=new i,a.options=e.widget.extend({},a.options),e.each(n,function(t,n){return e.isFunction(n)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},r=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=o,t}}()):void(l[t]=n)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||t:t},l,{constructor:s,namespace:u,widgetName:t,widgetFullName:r}),o?(e.each(o._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var r,o,s=n.call(arguments,1),a=0,l=s.length;a<l;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==t&&(e.isPlainObject(o)?i[r]=e.isPlainObject(i[r])?e.widget.extend({},i[r],o):e.widget.extend({},o):i[r]=o);return i},e.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;e.fn[i]=function(s){var a="string"==typeof s,l=n.call(arguments,1),u=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var n,r=e.data(this,o);return r?e.isFunction(r[s])&&"_"!==s.charAt(0)?(n=r[s].apply(r,l),n!==r&&n!==t?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(s||{})._init():e.data(this,o,new r(s,this))}),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var r,o,s,a=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(a={},r=i.split("."),i=r.shift(),r.length){for(o=a[i]=e.widget.extend({},this.options[i]),s=0;s<r.length-1;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(i=r.pop(),1===arguments.length)return o[i]===t?null:o[i];o[i]=n}else{if(1===arguments.length)return this.options[i]===t?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var r,o=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,function(n,s){function a(){if(t||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof s?o[s]:s).apply(o,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),u=l[1]+o.eventNamespace,c=l[2];c?r.delegate(c,u,a):i.bind(u,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var r,o,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:t;r=r||{},"number"==typeof r&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&e.effects&&e.effects.effect[a]?n[t](r):a!==t&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}})}(jQuery),function(e,t){var i=!1;e(document).mouseup(function(){i=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!i){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var n=this,r=1===t.which,o=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(r&&!o&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),i=!0,!0))}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function i(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function n(t,i){return parseInt(e.css(t,i),10)||0}function r(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var o,s=Math.max,a=Math.abs,l=Math.round,u=/left|center|right/,c=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(o!==t)return o;var i,n,r=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return e("body").append(r),i=s.offsetWidth,r.css("overflow","scroll"),n=s.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),o=i-n},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),n=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:r,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return f.apply(this,arguments);t=e.extend({},t);var o,p,m,g,y,v,E=e(t.of),T=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(T),C=(t.collision||"flip").split(" "),O={};return v=r(E),E[0].preventDefault&&(t.at="left top"),p=v.width,m=v.height,g=v.offset,y=e.extend({},g),e.each(["my","at"],function(){var e,i,n=(t[this]||"").split(" ");1===n.length&&(n=u.test(n[0])?n.concat(["center"]):c.test(n[0])?["center"].concat(n):["center","center"]),n[0]=u.test(n[0])?n[0]:"center",n[1]=c.test(n[1])?n[1]:"center",e=h.exec(n[0]),i=h.exec(n[1]),O[this]=[e?e[0]:0,i?i[0]:0],t[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===C.length&&(C[1]=C[0]),"right"===t.at[0]?y.left+=p:"center"===t.at[0]&&(y.left+=p/2),"bottom"===t.at[1]?y.top+=m:"center"===t.at[1]&&(y.top+=m/2),o=i(O.at,p,m),y.left+=o[0],y.top+=o[1],this.each(function(){var r,u,c=e(this),h=c.outerWidth(),d=c.outerHeight(),f=n(this,"marginLeft"),v=n(this,"marginTop"),x=h+f+n(this,"marginRight")+b.width,w=d+v+n(this,"marginBottom")+b.height,R=e.extend({},y),L=i(O.my,c.outerWidth(),c.outerHeight());"right"===t.my[0]?R.left-=h:"center"===t.my[0]&&(R.left-=h/2),"bottom"===t.my[1]?R.top-=d:"center"===t.my[1]&&(R.top-=d/2),R.left+=L[0],R.top+=L[1],e.support.offsetFractions||(R.left=l(R.left),R.top=l(R.top)),r={marginLeft:f,marginTop:v},e.each(["left","top"],function(i,n){e.ui.position[C[i]]&&e.ui.position[C[i]][n](R,{targetWidth:p,targetHeight:m,elemWidth:h,elemHeight:d,collisionPosition:r,collisionWidth:x,collisionHeight:w,offset:[o[0]+L[0],o[1]+L[1]],my:t.my,at:t.at,within:T,elem:c})}),t.using&&(u=function(e){var i=g.left-R.left,n=i+p-h,r=g.top-R.top,o=r+m-d,l={target:{element:E,left:g.left,top:g.top,width:p,height:m},element:{element:c,left:R.left,top:R.top,width:h,height:d},horizontal:n<0?"left":i>0?"right":"center",vertical:o<0?"top":r>0?"bottom":"middle"};p<h&&a(i+n)<p&&(l.horizontal="center"),m<d&&a(r+o)<m&&(l.vertical="middle"),s(a(i),a(n))>s(a(r),a(o))?l.important="horizontal":l.important="vertical",t.using.call(this,e,l)}),c.offset(e.extend(R,{using:u}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=e.left-t.collisionPosition.marginLeft,l=r-a,u=a+t.collisionWidth-o-r;t.collisionWidth>o?l>0&&u<=0?(i=e.left+l+t.collisionWidth-o-r,e.left+=l-i):u>0&&l<=0?e.left=r:l>u?e.left=r+o-t.collisionWidth:e.left=r:l>0?e.left+=l:u>0?e.left-=u:e.left=s(e.left-a,e.left)},top:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,o=t.within.height,a=e.top-t.collisionPosition.marginTop,l=r-a,u=a+t.collisionHeight-o-r;t.collisionHeight>o?l>0&&u<=0?(i=e.top+l+t.collisionHeight-o-r,e.top+=l-i):u>0&&l<=0?e.top=r:l>u?e.top=r+o-t.collisionHeight:e.top=r:l>0?e.top+=l:u>0?e.top-=u:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,h=u+t.collisionWidth-s-l,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];c<0?(i=e.left+d+p+f+t.collisionWidth-s-o,(i<0||i<a(c))&&(e.left+=d+p+f)):h>0&&(n=e.left-t.collisionPosition.marginLeft+d+p+f-l,(n>0||a(n)<h)&&(e.left+=d+p+f))},top:function(e,t){var i,n,r=t.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,h=u+t.collisionHeight-s-l,d="top"===t.my[1],p=d?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];c<0?(n=e.top+p+f+m+t.collisionHeight-s-o,e.top+p+f+m>c&&(n<0||n<a(c))&&(e.top+=p+f+m)):h>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-l,e.top+p+f+m>h&&(i>0||a(i)<h)&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,n,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in n)t.style[o]=n[o];t.appendChild(a),i=s||document.documentElement,i.insertBefore(t,i.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",r=e(a).offset().left,e.support.offsetFractions=r>10&&r<11,t.innerHTML="",i.removeChild(t)}()}(jQuery),function(e,t){var i=0,n={},r={};n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="hide",r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&dependencies/ckeditor/e.css("height","")},_setOption:function(e,t){return"active"===e?void this._activate(t):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),void("disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)))},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,n=this.headers.length,r=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:o=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[n-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var t,n=this.options,r=n.heightStyle,o=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++i);this.active=this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(t){var i=e(this),n=i.attr("id"),r=i.next(),o=r.attr("id");n||(n=s+"-header-"+t,i.attr("id",n)),o||(o=s+"-panel-"+t,r.attr("id",o)),i.attr("aria-controls",o),r.attr("aria-labelledby",n)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(n.event),"fill"===r?(t=o.height(),this.element.siblings(":visible").each(function(){var i=e(this),n=i.css("position");"absolute"!==n&&"fixed"!==n&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===r&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"
}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,n=this.active,r=e(t.currentTarget),o=r[0]===n[0],s=o&&i.collapsible,a=s?e():r.next(),l=n.next(),u={oldHeader:n,oldPanel:l,newHeader:s?e():r,newPanel:a};t.preventDefault(),o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=!s&&this.headers.index(r),this.active=o?e():r,this._toggle(u),n.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,n=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,t):(n.hide(),i.show(),this._toggleComplete(t)),n.attr({"aria-hidden":"true"}),n.prev().attr("aria-selected","false"),i.length&&n.length?n.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(e,t,i){var o,s,a,l=this,u=0,c=e.length&&(!t.length||e.index()<t.index()),h=this.options.animate||{},d=c&&h.down||h,p=function(){l._toggleComplete(i)};return"number"==typeof d&&(a=d),"string"==typeof d&&(s=d),s=s||d.easing||h.easing,a=a||d.duration||h.duration,t.length?e.length?(o=e.show().outerHeight(),t.animate(n,{duration:a,easing:s,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(r,{duration:a,easing:s,complete:p,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?u+=i.now:"content"!==l.options.heightStyle&&(i.now=Math.round(o-t.outerHeight()-u),u=0)}})):t.animate(n,a,s,p):e.animate(r,a,s,p)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e,t){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,n,r=this.element[0].nodeName.toLowerCase(),o="textarea"===r,s="input"===r;this.isMultiLine=!!o||!s&&this.element.prop("isContentEditable"),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return t=!0,n=!0,void(i=!0);t=!1,n=!1,i=!1;var o=e.ui.keyCode;switch(r.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",r);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",r);break;case o.UP:t=!0,this._keyEvent("previous",r);break;case o.DOWN:t=!0,this._keyEvent("next",r);break;case o.ENTER:case o.NUMPAD_ENTER:this.menu.active&&(t=!0,r.preventDefault(),this.menu.select(r));break;case o.TAB:this.menu.active&&this.menu.select(r);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(r),r.preventDefault());break;default:i=!0,this._searchTimeout(r)}},keypress:function(n){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||n.preventDefault());if(!i){var r=e.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:this._move("previousPage",n);break;case r.PAGE_DOWN:this._move("nextPage",n);break;case r.UP:this._keyEvent("previous",n);break;case r.DOWN:this._keyEvent("next",n)}}},input:function(e){return n?(n=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(n){n.target===t.element[0]||n.target===i||e.contains(i,n.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});var n=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:n})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value):this.liveRegion.text(n.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,r){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){r(e)},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e,t){var i,n="ui-button ui-widget ui-state-default ui-corner-all",r="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",o=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},s=function(t){var i=t.name,n=t.form,r=e([]);return i&&(i=i.replace(/'/g,"\\'"),r=n?e(n).find("[name='"+i+"']"):e("[name='"+i+"']",t.ownerDocument).filter(function(){return!this.form})),r};e.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,o),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,r=this.options,a="checkbox"===this.type||"radio"===this.type,l=a?"":"ui-state-active";null===r.label&&(r.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(n).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){r.disabled||this===i&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){r.disabled||e(this).removeClass(l)}).bind("click"+this.eventNamespace,function(e){r.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),a&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(r.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(r.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var i=t.element[0];s(i).not(i).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return!r.disabled&&(e(this).addClass("ui-state-active"),i=this,void t.document.one("mouseup",function(){i=null}))}).bind("mouseup"+this.eventNamespace,function(){return!r.disabled&&void e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){return!r.disabled&&void(t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||e(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",r.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(n+" ui-state-active "+r).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.element.prop("disabled",!!t),void(t&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?s(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var t=this.buttonElement.removeClass(r),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),n=this.options.icons,o=n.primary&&n.secondary,s=[];n.primary||n.secondary?(this.options.text&&s.push("ui-button-text-icon"+(o?"s":n.primary?"-primary":"-secondary")),n.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+n.primary+"'></span>"),n.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+n.secondary+"'></span>"),this.options.text||(s.push(o?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=n(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){e.datepicker._isDisabledDatepicker(o.inline?t.parent()[0]:o.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).addClass("ui-datepicker-next-hover"))})}function r(t,i){e.extend(t,i);for(var n in i)null==i[n]&&(t[n]=i[n]);return t}e.extend(e.ui,{datepicker:{version:"1.10.4"}});var o,s="datepicker";e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var n,r,o;n=t.nodeName.toLowerCase(),r="div"===n||"span"===n,t.id||(this.uuid+=1,t.id="dp"+this.uuid),o=this._newInst(e(t),r),o.settings=e.extend({},i||{}),"input"===n?this._connectDatepicker(t,o):r&&this._inlineDatepicker(t,o)},_newInst:function(t,i){var r=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var n=e(t);i.append=e([]),i.trigger=e([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,s,i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var n,r,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[a?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),n=this._get(i,"showOn"),"focus"!==n&&"both"!==n||t.focus(this._showDatepicker),"button"!==n&&"both"!==n||(r=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:r,title:r}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:r,title:r}):r)),t[a?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,n,r,o=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(t=function(e){for(i=0,n=0,r=0;r<e.length;r++)e[r].length>i&&(i=e[r].length,n=r);return n},o.setMonth(t(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var n=e(t);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),e.data(t,s,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,n,o,a){var l,u,c,h,d,p=this._dialogInst;return p||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},e.data(this._dialogInput[0],s,p)),r(p.settings,o||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(u=document.documentElement.clientWidth,c=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[u/2-100+h,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],s,p),this},_destroyDatepicker:function(t){var i,n=e(t),r=e.data(t,s);n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,s),"input"===i?(r.append.remove(),r.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||n.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,s);r.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||(n=r.children("."+this._inlineClass),n.children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,s);r.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||(n=r.children("."+this._inlineClass),n.children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,s)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,n,o){var s,a,l,u,c=this._getInst(i);return 2===arguments.length&&"string"==typeof n?"defaults"===n?e.extend({},e.datepicker._defaults):c?"all"===n?e.extend({},c.settings):this._get(c,n):null:(s=n||{},"string"==typeof n&&(s={},s[n]=o),void(c&&(this._curInst===c&&this._hideDatepicker(),a=this._getDateDatepicker(i,!0),l=this._getMinMaxDate(c,"min"),u=this._getMinMaxDate(c,"max"),r(c.settings,s),null!==l&&s.dateFormat!==t&&s.minDate===t&&(c.settings.minDate=this._formatDate(c,l)),null!==u&&s.dateFormat!==t&&s.maxDate===t&&(c.settings.maxDate=this._formatDate(c,u)),"disabled"in s&&(s.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(e(i),c),this._autoSize(c),this._setDate(c,a),this._updateAlternate(c),this._updateDatepicker(c))))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,n,r,o=e.datepicker._getInst(t.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return r=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv),r[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,r[0]),i=e.datepicker._get(o,"onSelect"),i?(n=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[n,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,n,r=e.datepicker._getInst(t.target);if(e.datepicker._get(r,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(r,"dateFormat")),n=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||n<" "||!i||i.indexOf(n)>-1},_doKeyUp:function(t){var i,n=e.datepicker._getInst(t.target);if(n.input.val()!==n.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(n,"dateFormat"),n.input?n.input.val():null,e.datepicker._getFormatConfig(n)),i&&(e.datepicker._setDateFromField(n),e.datepicker._updateAlternate(n),e.datepicker._updateDatepicker(n))}catch(r){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,o,s,a,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),o=n?n.apply(t,[t,i]):{},o!==!1&&(r(i.settings,o),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return s|="fixed"===e(this).css("position"),!s}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),a=e.datepicker._checkOffset(i,a,s),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,o=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,n=this._getNumberOfMonths(t),r=n[1],s=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&t.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",s*r+"em"),t.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,n){var r=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(n?0:e(document).scrollLeft()),u=document.documentElement.clientHeight+(n?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?r-s:0,i.left-=n&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=n&&i.top===t.input.offset().top+a?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+r>l&&l>r?Math.abs(i.left+r-l):0),i.top-=Math.min(i.top,i.top+o>u&&u>o?Math.abs(o+a):0),
i},_findPos:function(t){for(var i,n=this._getInst(t),r=this._get(n,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[r?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,n,r,o,a=this._curInst;!a||t&&a!==e.data(t,s)||this._datepickerShowing&&(i=this._get(a,"showAnim"),n=this._get(a,"duration"),r=function(){e.datepicker._tidyDialog(a)},e.effects&&(e.effects.effect[i]||e.effects[i])?a.dpDiv.hide(i,e.datepicker._get(a,"showOptions"),n,r):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),n=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===n)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,n){var r=e(t),o=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(o,i+("M"===n?this._get(o,"showCurrentAtPos"):0),n),this._updateDatepicker(o))},_gotoToday:function(t){var i,n=e(t),r=this._getInst(n[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(i=new Date,r.selectedDay=i.getDate(),r.drawMonth=r.selectedMonth=i.getMonth(),r.drawYear=r.selectedYear=i.getFullYear()),this._notifyChange(r),this._adjustDate(n)},_selectMonthYear:function(t,i,n){var r=e(t),o=this._getInst(r[0]);o["selected"+("M"===n?"Month":"Year")]=o["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(r)},_selectDay:function(t,i,n,r){var o,s=e(t);e(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(o=this._getInst(s[0]),o.selectedDay=o.currentDay=e("a",r).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=n,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var n,r=e(t),o=this._getInst(r[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),n=this._get(o,"onSelect"),n?n.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,n,r,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),n=this._getDate(t),r=this.formatDate(i,n,this._getFormatConfig(t)),e(o).each(function(){e(this).val(r)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,n){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?i.toString():i+"",""===i)return null;var r,o,s,a,l=0,u=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof u?u:(new Date).getFullYear()%100+parseInt(u,10),h=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,d=(n?n.dayNames:null)||this._defaults.dayNames,p=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,f=(n?n.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,y=-1,v=-1,E=!1,T=function(e){var i=r+1<t.length&&t.charAt(r+1)===e;return i&&r++,i},b=function(e){var t=T(e),n="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,r=new RegExp("^\\d{1,"+n+"}"),o=i.substring(l).match(r);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},C=function(t,n,r){var o=-1,s=e.map(T(t)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(s,function(e,t){var n=t[1];if(i.substr(l,n.length).toLowerCase()===n.toLowerCase())return o=t[0],l+=n.length,!1}),o!==-1)return o+1;throw"Unknown name at position "+l},O=function(){if(i.charAt(l)!==t.charAt(r))throw"Unexpected literal at position "+l;l++};for(r=0;r<t.length;r++)if(E)"'"!==t.charAt(r)||T("'")?O():E=!1;else switch(t.charAt(r)){case"d":y=b("d");break;case"D":C("D",h,d);break;case"o":v=b("o");break;case"m":g=b("m");break;case"M":g=C("M",p,f);break;case"y":m=b("y");break;case"@":a=new Date(b("@")),m=a.getFullYear(),g=a.getMonth()+1,y=a.getDate();break;case"!":a=new Date((b("!")-this._ticksTo1970)/1e4),m=a.getFullYear(),g=a.getMonth()+1,y=a.getDate();break;case"'":T("'")?O():E=!0;break;default:O()}if(l<i.length&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(m===-1?m=(new Date).getFullYear():m<100&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(m<=c?0:-100)),v>-1)for(g=1,y=v;;){if(o=this._getDaysInMonth(m,g-1),y<=o)break;g++,y-=o}if(a=this._daylightSavingAdjust(new Date(m,g-1,y)),a.getFullYear()!==m||a.getMonth()+1!==g||a.getDate()!==y)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var n,r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=n+1<e.length&&e.charAt(n+1)===t;return i&&n++,i},u=function(e,t,i){var n=""+t;if(l(e))for(;n.length<i;)n="0"+n;return n},c=function(e,t,i,n){return l(e)?n[t]:i[t]},h="",d=!1;if(t)for(n=0;n<e.length;n++)if(d)"'"!==e.charAt(n)||l("'")?h+=e.charAt(n):d=!1;else switch(e.charAt(n)){case"d":h+=u("d",t.getDate(),2);break;case"D":h+=c("D",t.getDay(),r,o);break;case"o":h+=u("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=u("m",t.getMonth()+1,2);break;case"M":h+=c("M",t.getMonth(),s,a);break;case"y":h+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":h+=t.getTime();break;case"!":h+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":d=!0;break;default:h+=e.charAt(n)}return h},_possibleChars:function(e){var t,i="",n=!1,r=function(i){var n=t+1<e.length&&e.charAt(t+1)===i;return n&&t++,n};for(t=0;t<e.length;t++)if(n)"'"!==e.charAt(t)||r("'")?i+=e.charAt(t):n=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":r("'")?i+="'":n=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,i){return e.settings[i]!==t?e.settings[i]:this._defaults[i]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),n=e.lastVal=e.input?e.input.val():null,r=this._getDefaultDate(e),o=r,s=this._getFormatConfig(e);try{o=this.parseDate(i,n,s)||r}catch(a){n=t?"":n}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=n?o.getDate():0,e.currentMonth=n?o.getMonth():0,e.currentYear=n?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},o=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(n){}for(var r=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,o=r.getFullYear(),s=r.getMonth(),a=r.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=l.exec(i);u;){switch(u[2]||"d"){case"d":case"D":a+=parseInt(u[1],10);break;case"w":case"W":a+=7*parseInt(u[1],10);break;case"m":case"M":s+=parseInt(u[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s));break;case"y":case"Y":o+=parseInt(u[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s))}u=l.exec(i)}return new Date(o,s,a)},s=null==i||""===i?n:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?n:r(i):new Date(i.getTime());return s=s&&"Invalid Date"===s.toString()?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,r=e.selectedMonth,o=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),r===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),n="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(n,-i,"M")},next:function(){e.datepicker._adjustDate(n,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(n)},selectDay:function(){return e.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(n,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,n,r,o,s,a,l,u,c,h,d,p,f,m,g,y,v,E,T,b,C,O,x,w,R,L,S,_,I,D,M,A,N,P,k,H,F,B,K=new Date,z=this._daylightSavingAdjust(new Date(K.getFullYear(),K.getMonth(),K.getDate())),U=this._get(e,"isRTL"),V=this._get(e,"showButtonPanel"),G=this._get(e,"hideIfNoPrevNext"),$=this._get(e,"navigationAsDateFormat"),W=this._getNumberOfMonths(e),j=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),q=1!==W[0]||1!==W[1],Z=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),Y=this._getMinMaxDate(e,"min"),J=this._getMinMaxDate(e,"max"),Q=e.drawMonth-j,ee=e.drawYear;if(Q<0&&(Q+=12,ee--),J)for(t=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-W[0]*W[1]+1,J.getDate())),t=Y&&t<Y?Y:t;this._daylightSavingAdjust(new Date(ee,Q,1))>t;)Q--,Q<0&&(Q=11,ee--);for(e.drawMonth=Q,e.drawYear=ee,i=this._get(e,"prevText"),i=$?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Q-X,1)),this._getFormatConfig(e)):i,n=this._canAdjustMonth(e,-1,ee,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>":G?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>",r=this._get(e,"nextText"),r=$?this.formatDate(r,this._daylightSavingAdjust(new Date(ee,Q+X,1)),this._getFormatConfig(e)):r,o=this._canAdjustMonth(e,1,ee,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+r+"</span></a>":G?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+r+"</span></a>",s=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?Z:z,s=$?this.formatDate(s,a,this._getFormatConfig(e)):s,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",u=V?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(U?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,h=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),y=this._get(e,"showOtherMonths"),v=this._get(e,"selectOtherMonths"),E=this._getDefaultDate(e),T="",C=0;C<W[0];C++){for(O="",this.maxRows=4,x=0;x<W[1];x++){if(w=this._daylightSavingAdjust(new Date(ee,Q,e.selectedDay)),R=" ui-corner-all",L="",q){if(L+="<div class='ui-datepicker-group",W[1]>1)switch(x){case 0:L+=" ui-datepicker-group-first",R=" ui-corner-"+(U?"right":"left");break;case W[1]-1:L+=" ui-datepicker-group-last",R=" ui-corner-"+(U?"left":"right");break;default:L+=" ui-datepicker-group-middle",R=""}L+="'>"}for(L+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+R+"'>"+(/all|left/.test(R)&&0===C?U?o:n:"")+(/all|right/.test(R)&&0===C?U?n:o:"")+this._generateMonthYearHeader(e,Q,ee,Y,J,C>0||x>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",S=h?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",b=0;b<7;b++)_=(b+c)%7,S+="<th"+((b+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[_]+"'>"+p[_]+"</span></th>";for(L+=S+"</tr></thead><tbody>",I=this._getDaysInMonth(ee,Q),ee===e.selectedYear&&Q===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,I)),D=(this._getFirstDayOfMonth(ee,Q)-c+7)%7,M=Math.ceil((D+I)/7),A=q&&this.maxRows>M?this.maxRows:M,this.maxRows=A,N=this._daylightSavingAdjust(new Date(ee,Q,1-D)),P=0;P<A;P++){for(L+="<tr>",k=h?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(N)+"</td>":"",b=0;b<7;b++)H=g?g.apply(e.input?e.input[0]:null,[N]):[!0,""],F=N.getMonth()!==Q,B=F&&!v||!H[0]||Y&&N<Y||J&&N>J,k+="<td class='"+((b+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(N.getTime()===w.getTime()&&Q===e.selectedMonth&&e._keyEvent||E.getTime()===N.getTime()&&E.getTime()===w.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!y?"":" "+H[1]+(N.getTime()===Z.getTime()?" "+this._currentClass:"")+(N.getTime()===z.getTime()?" ui-datepicker-today":""))+"'"+(F&&!y||!H[2]?"":" title='"+H[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+N.getMonth()+"' data-year='"+N.getFullYear()+"'")+">"+(F&&!y?"&#xa0;":B?"<span class='ui-state-default'>"+N.getDate()+"</span>":"<a class='ui-state-default"+(N.getTime()===z.getTime()?" ui-state-highlight":"")+(N.getTime()===Z.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+N.getDate()+"</a>")+"</td>",N.setDate(N.getDate()+1),N=this._daylightSavingAdjust(N);L+=k+"</tr>"}Q++,Q>11&&(Q=0,ee++),L+="</tbody></table>"+(q?"</div>"+(W[0]>0&&x===W[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),O+=L}T+=O}return T+=u,e._keyEvent=!1,T},_generateMonthYearHeader:function(e,t,i,n,r,o,s,a){var l,u,c,h,d,p,f,m,g=this._get(e,"changeMonth"),y=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),E="<div class='ui-datepicker-title'>",T="";if(o||!g)T+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(l=n&&n.getFullYear()===i,u=r&&r.getFullYear()===i,T+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!l||c>=n.getMonth())&&(!u||c<=r.getMonth())&&(T+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+a[c]+"</option>");T+="</select>"}if(v||(E+=T+(!o&&g&&y?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!y)E+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(h=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t},f=p(h[0]),m=Math.max(f,p(h[1]||"")),f=n?Math.max(f,n.getFullYear()):f,m=r?Math.min(m,r.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f<=m;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",E+=e.yearshtml,e.yearshtml=null}return E+=this._get(e,"yearSuffix"),v&&(E+=(!o&&g&&y?"":"&#xa0;")+T),E+="</div>"},_adjustInstDate:function(e,t,i){var n=e.drawYear+("Y"===i?t:0),r=e.drawMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(n,r))+("D"===i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,r,o)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=i&&t<i?i:t;return n&&r>n?n:r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var r=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,n+(t<0?t:r[0]*r[1]),1));return t<0&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,n,r=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),s=null,a=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),n=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=n),i[1].match(/[+\-].*/)&&(a+=n)),(!r||t.getTime()>=r.getTime())&&(!o||t.getTime()<=o.getTime())&&(!s||t.getFullYear()>=s)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.4"}(jQuery),function(e,t){var i={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},n={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;i<0&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,n=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(r){}this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!t&&this._trigger("focus",e),i},open:function(){var t=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),r=i.filter(":last");t.target!==r[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==n[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(r.focus(1),t.preventDefault()):(n.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,function(i,n){var r,o;n=e.isFunction(n)?{click:n,text:i}:n,n=e.extend({type:"button"},n),r=n.click,n.click=function(){r.apply(t.element[0],arguments)},o={icons:n.icons,text:n.showText},delete n.icons,delete n.showText,e("<button></button>",n).button(o).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,t(r))},drag:function(e,n){i._trigger("drag",e,t(n))},stop:function(r,o){n.position=[o.position.left-i.document.scrollLeft(),o.position.top-i.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",r,t(o))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,n=this.options,r=n.resizable,o=this.uiDialog.css("position"),s="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,t(r))},resize:function(e,n){i._trigger("resize",e,t(n))},stop:function(r,o){n.height=e(this).height(),n.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",r,t(o))}}).css("position",o)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var r=this,o=!1,s={};e.each(t,function(e,t){r._setOption(e,t),e in i&&(o=!0),e in n&&(s[e]=t)}),o&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(e,t){var i,n,r=this.uiDialog;"dialogClass"===e&&r.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=r.is(":data(ui-draggable)"),i&&!t&&r.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=r.is(":data(ui-resizable)"),n&&!t&&r.resizable("destroy"),n&&"string"==typeof t&&r.resizable("option","handles",t),n||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),e=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),t=Math.max(0,n.minHeight-e),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-e):"none","auto"===n.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,i=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(n){t._allowInteraction(n)||(n.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,i=this.options.position,n=[],r=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(n=i.split?i.split(" "):[i[0],i[1]],1===n.length&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),i={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")}),i=e.extend({},e.ui.dialog.prototype.options.position,i)):i=e.ui.dialog.prototype.options.position,t=this.uiDialog.is(":visible"),t||this.uiDialog.show(),this.uiDialog.position(i),t||this.uiDialog.hide()}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),
this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0))},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),!("original"===this.options.helper&&!e.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;return r.containment?"window"===r.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=e(r.containment),n=i[0],void(n&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i))):void(this.containment=null)},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(t){var i,n,r,o,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,u=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(u=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(u=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,u=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("ui-draggable"),r=n.options,o=e.extend({},i,{item:n.element});n.sortables=[],e(r.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,o))})},stop:function(t,i){var n=e(this).data("ui-draggable"),r=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,r))})},drag:function(t,i){var n=e(this).data("ui-draggable"),r=this;e.each(n.sortables,function(){var o=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),n=i.options,r=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){var n,r,o,s,a,l,u,c,h,d,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,y=g+p.helperProportions.width,v=i.offset.top,E=v+p.helperProportions.height;for(h=p.snapElements.length-1;h>=0;h--)a=p.snapElements[h].left,l=a+p.snapElements[h].width,u=p.snapElements[h].top,c=u+p.snapElements[h].height,y<a-m||g>l+m||E<u-m||v>c+m||!e.contains(p.snapElements[h].item.ownerDocument,p.snapElements[h].item)?(p.snapElements[h].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[h].item})),p.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(n=Math.abs(u-E)<=m,r=Math.abs(c-v)<=m,o=Math.abs(a-y)<=m,s=Math.abs(l-g)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=n||r||o||s,"outer"!==f.snapMode&&(n=Math.abs(u-v)<=m,r=Math.abs(c-E)<=m,o=Math.abs(a-g)<=m,s=Math.abs(l-y)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[h].snapping&&(n||r||o||s||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[h].item})),p.snapElements[h].snapping=n||r||o||s||d)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,n=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(t=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}e.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,n=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},e.ui.ddmanager.droppables[i.scope]=e.ui.ddmanager.droppables[i.scope]||[],e.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];t<i.length;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current,r=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope===n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return r=!0,!1}),!r&&(!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,n){if(!t.offset)return!1;var r,o,s=(e.positionAbs||e.position.absolute).left,a=(e.positionAbs||e.position.absolute).top,l=s+e.helperProportions.width,u=a+e.helperProportions.height,c=t.offset.left,h=t.offset.top,d=c+t.proportions().width,p=h+t.proportions().height;switch(n){case"fit":return c<=s&&l<=d&&h<=a&&u<=p;case"intersect":return c<s+e.helperProportions.width/2&&l-e.helperProportions.width/2<d&&h<a+e.helperProportions.height/2&&u-e.helperProportions.height/2<p;case"pointer":return r=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,o=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,i(o,h,t.proportions().height)&&i(r,c,t.proportions().width);case"touch":return(a>=h&&a<=p||u>=h&&u<=p||a<h&&u>p)&&(s>=c&&s<=d||l>=c&&l<=d||s<c&&l>d);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n,r,o=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(n=0;n<o.length;n++)if(!(o[n].options.disabled||t&&!o[n].accept.call(o[n].element[0],t.currentItem||t.element))){for(r=0;r<a.length;r++)if(a[r]===o[n].element[0]){o[n].proportions().height=0;continue e}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions({width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight}))}},drop:function(t,i){var n=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=e.ui.intersect(t,this,this.options.tolerance),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===r}),o.length&&(n=e.data(o[0],"ui-droppable"),n.greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e,t){var i="ui-effects-";e.effects={effect:{}},function(e,t){function i(e,t,i){var n=h[t.type]||{};return null==e?i||!t.def?null:t.def:(e=n.floor?~~e:parseFloat(e),isNaN(e)?t.def:n.mod?(e+n.mod)%n.mod:0>e?0:n.max<e?n.max:e)}function n(t){var i=u(),n=i._rgba=[];return t=t.toLowerCase(),f(l,function(e,r){var o,s=r.re.exec(t),a=s&&r.parse(s),l=r.space||"rgba";if(a)return o=i[l](a),i[c[l].cache]=o[c[l].cache],n=i._rgba=o._rgba,!1}),n.length?("0,0,0,0"===n.join()&&e.extend(n,o.transparent),i):o[t]}function r(e,t,i){return i=(i+1)%1,6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}var o,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],u=e.Color=function(t,i,n,r){return new e.Color.fn.parse(t,i,n,r)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=u.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),u.fn=e.extend(u.prototype,{parse:function(r,s,a,l){if(r===t)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=e(r).css(s),s=t);var h=this,d=e.type(r),p=this._rgba=[];return s!==t&&(r=[r,s,a,l],d="array"),"string"===d?this.parse(n(r)||o._default):"array"===d?(f(c.rgba.props,function(e,t){p[t.idx]=i(r[t.idx],t)}),this):"object"===d?(r instanceof u?f(c,function(e,t){r[t.cache]&&(h[t.cache]=r[t.cache].slice())}):f(c,function(t,n){var o=n.cache;f(n.props,function(e,t){if(!h[o]&&n.to){if("alpha"===e||null==r[e])return;h[o]=n.to(h._rgba)}h[o][t.idx]=i(r[e],t,!0)}),h[o]&&e.inArray(null,h[o].slice(0,3))<0&&(h[o][3]=1,n.from&&(h._rgba=n.from(h[o])))}),this):void 0},is:function(e){var t=u(e),i=!0,n=this;return f(c,function(e,r){var o,s=t[r.cache];return s&&(o=n[r.cache]||r.to&&r.to(n._rgba)||[],f(r.props,function(e,t){if(null!=s[t.idx])return i=s[t.idx]===o[t.idx]})),i}),i},_space:function(){var e=[],t=this;return f(c,function(i,n){t[n.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var n=u(e),r=n._space(),o=c[r],s=0===this.alpha()?u("transparent"):this,a=s[o.cache]||o.to(s._rgba),l=a.slice();return n=n[o.cache],f(o.props,function(e,r){var o=r.idx,s=a[o],u=n[o],c=h[r.type]||{};null!==u&&(null===s?l[o]=u:(c.mod&&(u-s>c.mod/2?s+=c.mod:s-u>c.mod/2&&(s-=c.mod)),l[o]=i((u-s)*t+s,r)))}),this[r](l)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),r=u(t)._rgba;return u(e.map(i,function(e,t){return(1-n)*r[t]+n*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),n=i.pop();return t&&i.push(~~(255*n)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),u.fn.parse.prototype=u.fn,c.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,n=e[0]/255,r=e[1]/255,o=e[2]/255,s=e[3],a=Math.max(n,r,o),l=Math.min(n,r,o),u=a-l,c=a+l,h=.5*c;return t=l===a?0:n===a?60*(r-o)/u+360:r===a?60*(o-n)/u+120:60*(n-r)/u+240,i=0===u?0:h<=.5?u/c:u/(2-c),[Math.round(t)%360,i,h,null==s?1:s]},c.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],n=e[2],o=e[3],s=n<=.5?n*(1+i):n+i-n*i,a=2*n-s;return[Math.round(255*r(a,s,t+1/3)),Math.round(255*r(a,s,t)),Math.round(255*r(a,s,t-1/3)),o]},f(c,function(n,r){var o=r.props,s=r.cache,l=r.to,c=r.from;u.fn[n]=function(n){if(l&&!this[s]&&(this[s]=l(this._rgba)),n===t)return this[s].slice();var r,a=e.type(n),h="array"===a||"object"===a?n:arguments,d=this[s].slice();return f(o,function(e,t){var n=h["object"===a?e:t.idx];null==n&&(n=d[t.idx]),d[t.idx]=i(n,t)}),c?(r=u(c(d)),r[s]=d,r):u(d)},f(o,function(t,i){u.fn[t]||(u.fn[t]=function(r){var o,s=e.type(r),l="alpha"===t?this._hsla?"hsla":"rgba":n,u=this[l](),c=u[i.idx];return"undefined"===s?c:("function"===s&&(r=r.call(this,c),s=e.type(r)),null==r&&i.empty?this:("string"===s&&(o=a.exec(r),o&&(r=c+parseFloat(o[2])*("+"===o[1]?1:-1))),u[i.idx]=r,this[l](u)))})})}),u.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,r){var o,s,a="";if("transparent"!==r&&("string"!==e.type(r)||(o=n(r)))){if(r=u(o||r),!d.rgba&&1!==r._rgba[3]){for(s="backgroundColor"===i?t.parentNode:t;(""===a||"transparent"===a)&&s&&s.style;)try{a=e.css(s,"backgroundColor"),s=s.parentNode}catch(l){}r=r.blend(a&&"transparent"!==a?a:"_default")}r=r.toRgbaString()}try{t.style[i]=r}catch(l){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=u(t.elem,i),t.end=u(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},u.hook(s),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,n){t["border"+n+"Color"]=e}),t}},o=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(t){var i,n,r=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(r&&r.length&&r[0]&&r[r[0]])for(n=r.length;n--;)i=r[n],"string"==typeof r[i]&&(o[e.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(o[i]=r[i]);return o}function n(t,i){var n,r,s={};for(n in i)r=i[n],t[n]!==r&&(o[n]||!e.fx.step[n]&&isNaN(parseFloat(r))||(s[n]=r));return s}var r=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,o,s,a){var l=e.speed(o,s,a);return this.queue(function(){var o,s=e(this),a=s.attr("class")||"",u=l.children?s.find("*").addBack():s;u=u.map(function(){var t=e(this);return{el:t,start:i(this)}}),o=function(){e.each(r,function(e,i){t[i]&&s[i+"Class"](t[i])})},o(),u=u.map(function(){return this.end=i(this.el[0]),this.diff=n(this.start,this.end),this}),s.attr("class",a),u=u.map(function(){var t=this,i=e.Deferred(),n=e.extend({},l,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,n),i.promise()}),e.when.apply(e,u.get()).done(function(){o(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(s[0])})})},e.fn.extend({addClass:function(t){return function(i,n,r,o){return n?e.effects.animateClass.call(this,{add:i},n,r,o):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,n,r,o){return arguments.length>1?e.effects.animateClass.call(this,{
remove:i},n,r,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(i){return function(n,r,o,s,a){return"boolean"==typeof r||r===t?o?e.effects.animateClass.call(this,r?{add:n}:{remove:n},o,s,a):i.apply(this,arguments):e.effects.animateClass.call(this,{toggle:n},r,o,s)}}(e.fn.toggleClass),switchClass:function(t,i,n,r,o){return e.effects.animateClass.call(this,{add:i,remove:t},n,r,o)}})}(),function(){function n(t,i,n,r){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(r=n,n=i,i={}),e.isFunction(n)&&(r=n,n=null),i&&e.extend(t,i),n=n||i.duration,t.duration=e.fx.off?0:"number"==typeof n?n:n in e.fx.speeds?e.fx.speeds[n]:e.fx.speeds._default,t.complete=r||i.complete,t}function r(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||("string"==typeof t&&!e.effects.effect[t]||(!!e.isFunction(t)||"object"==typeof t&&!t.effect))}e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var n=0;n<t.length;n++)null!==t[n]&&e.data(i+t[n],e[0].style[t[n]])},restore:function(e,n){var r,o;for(o=0;o<n.length;o++)null!==n[o]&&(r=e.data(i+n[o]),r===t&&(r=""),e.css(n[o],r))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},n=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:t.width(),height:t.height()},o=document.activeElement;try{o.id}catch(s){o=document.body}return t.wrap(n),(t[0]===o||e.contains(t[0],o))&&e(o).focus(),n=t.parent(),"static"===t.css("position")?(n.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,n){i[n]=t.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(r),n.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,n,r){return r=r||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(r[i]=o[0]*n+o[1])}),r}}),e.fn.extend({effect:function(){function t(t){function n(){e.isFunction(o)&&o.call(r[0]),e.isFunction(t)&&t()}var r=e(this),o=i.complete,a=i.mode;(r.is(":hidden")?"hide"===a:"show"===a)?(r[a](),n()):s.call(r[0],i,n)}var i=n.apply(this,arguments),r=i.mode,o=i.queue,s=e.effects.effect[i.effect];return e.fx.off||!s?r?this[r](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):o===!1?this.each(t):this.queue(o||"fx",t)},show:function(e){return function(t){if(r(t))return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(e.fn.show),hide:function(e){return function(t){if(r(t))return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(r(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),n=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(n=[parseFloat(i),t])}),n}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?i(2*e)/2:1-i(e*-2+2)/2}})}()}(jQuery),function(e,t){var i=/up|down|vertical/,n=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,r){var o,s,a,l=e(this),u=["position","top","bottom","left","right","height","width"],c=e.effects.setMode(l,t.mode||"hide"),h=t.direction||"up",d=i.test(h),p=d?"height":"width",f=d?"top":"left",m=n.test(h),g={},y="show"===c;l.parent().is(".ui-effects-wrapper")?e.effects.save(l.parent(),u):e.effects.save(l,u),l.show(),o=e.effects.createWrapper(l).css({overflow:"hidden"}),s=o[p](),a=parseFloat(o.css(f))||0,g[p]=y?s:0,m||(l.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),g[f]=y?a:s+a),y&&(o.css(p,0),m||o.css(f,a+s)),o.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===c&&l.hide(),e.effects.restore(l,u),e.effects.removeWrapper(l),r()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"effect"),u="hide"===l,c="show"===l,h=t.direction||"up",d=t.distance,p=t.times||5,f=2*p+(c||u?1:0),m=t.duration/f,g=t.easing,y="up"===h||"down"===h?"top":"left",v="up"===h||"left"===h,E=s.queue(),T=E.length;for((c||u)&&a.push("opacity"),e.effects.save(s,a),s.show(),e.effects.createWrapper(s),d||(d=s["top"===y?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[y]=0,s.css("opacity",0).css(y,v?2*-d:2*d).animate(o,m,g)),u&&(d/=Math.pow(2,p-1)),o={},o[y]=0,n=0;n<p;n++)r={},r[y]=(v?"-=":"+=")+d,s.animate(r,m,g).animate(o,m,g),d=u?2*d:d/2;u&&(r={opacity:0},r[y]=(v?"-=":"+=")+d,s.animate(r,m,g)),s.queue(function(){u&&s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}),T>1&&E.splice.apply(E,[1,0].concat(E.splice(T,f+1))),s.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"hide"),u="show"===l,c=t.direction||"vertical",h="vertical"===c,d=h?"height":"width",p=h?"top":"left",f={};e.effects.save(s,a),s.show(),n=e.effects.createWrapper(s).css({overflow:"hidden"}),r="IMG"===s[0].tagName?n:s,o=r[d](),u&&(r.css(d,0),r.css(p,o/2)),f[d]=u?o:0,f[p]=u?0:o/2,r.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){u||s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),a="show"===s,l=t.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",h={opacity:a?1:0};e.effects.save(r,o),r.show(),e.effects.createWrapper(r),n=t.distance||r["top"===u?"outerHeight":"outerWidth"](!0)/2,a&&r.css("opacity",0).css(u,"pos"===c?-n:n),h[u]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+n,r.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,i){function n(){E.push(this),E.length===h*d&&r()}function r(){p.css({visibility:"visible"}),e(E).remove(),m||p.hide(),i()}var o,s,a,l,u,c,h=t.pieces?Math.round(Math.sqrt(t.pieces)):3,d=h,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),y=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/h),E=[];for(o=0;o<h;o++)for(l=g.top+o*v,c=o-(h-1)/2,s=0;s<d;s++)a=g.left+s*y,u=s-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*y,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:y,height:v,left:a+(m?u*y:0),top:l+(m?c*v:0),opacity:m?0:1}).animate({left:a+(m?0:u*y),top:l+(m?0:c*v),opacity:m?1:0},t.duration||500,t.easing,n)}}(jQuery),function(e,t){e.effects.effect.fade=function(t,i){var n=e(this),r=e.effects.setMode(n,t.mode||"toggle");n.animate({opacity:r},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,i){var n,r,o=e(this),s=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(o,t.mode||"hide"),l="show"===a,u="hide"===a,c=t.size||15,h=/([0-9]+)%/.exec(c),d=!!t.horizFirst,p=l!==d,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},y={};e.effects.save(o,s),o.show(),n=e.effects.createWrapper(o).css({overflow:"hidden"}),r=p?[n.width(),n.height()]:[n.height(),n.width()],h&&(c=parseInt(h[1],10)/100*r[u?0:1]),l&&n.css(d?{height:0,width:c}:{height:c,width:0}),g[f[0]]=l?r[0]:c,y[f[1]]=l?r[1]:0,n.animate(g,m,t.easing).animate(y,m,t.easing,function(){u&&o.hide(),e.effects.restore(o,s),e.effects.removeWrapper(o),i()})}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,i){var n=e(this),r=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(n,t.mode||"show"),s={backgroundColor:n.css("backgroundColor")};"hide"===o&&(s.opacity=0),e.effects.save(n,r),n.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,r),i()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,i){var n,r=e(this),o=e.effects.setMode(r,t.mode||"show"),s="show"===o,a="hide"===o,l=s||"hide"===o,u=2*(t.times||5)+(l?1:0),c=t.duration/u,h=0,d=r.queue(),p=d.length;for(!s&&r.is(":visible")||(r.css("opacity",0).show(),h=1),n=1;n<u;n++)r.animate({opacity:h},c,t.easing),h=1-h;r.animate({opacity:h},c,t.easing),r.queue(function(){a&&r.hide(),i()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,u+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,i){var n=e(this),r=e.effects.setMode(n,t.mode||"hide"),o="hide"===r,s=parseInt(t.percent,10)||150,a=s/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:r,complete:i,percent:o?s:100,from:o?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),n.effect(t)},e.effects.effect.scale=function(t,i){var n=e(this),r=e.extend(!0,{},t),o=e.effects.setMode(n,t.mode||"effect"),s=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===o?0:100),a=t.direction||"both",l=t.origin,u={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},c={y:"horizontal"!==a?s/100:1,x:"vertical"!==a?s/100:1};r.effect="size",r.queue=!1,r.complete=i,"effect"!==o&&(r.origin=l||["middle","center"],r.restore=!0),r.from=t.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:u),r.to={height:u.height*c.y,width:u.width*c.x,outerHeight:u.outerHeight*c.y,outerWidth:u.outerWidth*c.x},r.fade&&("show"===o&&(r.from.opacity=0,r.to.opacity=1),"hide"===o&&(r.from.opacity=1,r.to.opacity=0)),n.effect(r)},e.effects.effect.size=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],u=["width","height","overflow"],c=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(s,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],y=s.css("position"),v=f?a:l,E={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&s.show(),n={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===t.mode&&"show"===p?(s.from=t.to||E,s.to=t.from||n):(s.from=t.from||("show"===p?E:n),s.to=t.to||("hide"===p?E:n)),o={from:{y:s.from.height/n.height,x:s.from.width/n.width},to:{y:s.to.height/n.height,x:s.to.width/n.width}},"box"!==m&&"both"!==m||(o.from.y!==o.to.y&&(v=v.concat(h),s.from=e.effects.setTransition(s,h,o.from.y,s.from),s.to=e.effects.setTransition(s,h,o.to.y,s.to)),o.from.x!==o.to.x&&(v=v.concat(d),s.from=e.effects.setTransition(s,d,o.from.x,s.from),s.to=e.effects.setTransition(s,d,o.to.x,s.to))),"content"!==m&&"both"!==m||o.from.y!==o.to.y&&(v=v.concat(c).concat(u),s.from=e.effects.setTransition(s,c,o.from.y,s.from),s.to=e.effects.setTransition(s,c,o.to.y,s.to)),e.effects.save(s,v),s.show(),e.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),g&&(r=e.effects.getBaseline(g,n),s.from.top=(n.outerHeight-s.outerHeight())*r.y,s.from.left=(n.outerWidth-s.outerWidth())*r.x,s.to.top=(n.outerHeight-s.to.outerHeight)*r.y,s.to.left=(n.outerWidth-s.to.outerWidth)*r.x),s.css(s.from),"content"!==m&&"both"!==m||(h=h.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),u=a.concat(h).concat(d),s.find("*[width]").each(function(){var i=e(this),n={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,u),i.from={height:n.height*o.from.y,width:n.width*o.from.x,outerHeight:n.outerHeight*o.from.y,outerWidth:n.outerWidth*o.from.x},i.to={height:n.height*o.to.y,width:n.width*o.to.x,outerHeight:n.height*o.to.y,outerWidth:n.width*o.to.x},o.from.y!==o.to.y&&(i.from=e.effects.setTransition(i,h,o.from.y,i.from),i.to=e.effects.setTransition(i,h,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=e.effects.setTransition(i,d,o.from.x,i.from),i.to=e.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,u)})})),s.animate(s.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===p&&s.hide(),e.effects.restore(s,v),f||("static"===y?s.css({position:"relative",top:s.to.top,left:s.to.left}):e.each(["top","left"],function(e,t){s.css(t,function(t,i){var n=parseInt(i,10),r=e?s.to.left:s.to.top;return"auto"===i?r+"px":n+r+"px"})})),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),a=t.direction||"left",l=t.distance||20,u=t.times||3,c=2*u+1,h=Math.round(t.duration/c),d="up"===a||"down"===a?"top":"left",p="up"===a||"left"===a,f={},m={},g={},y=r.queue(),v=y.length;for(e.effects.save(r,o),r.show(),e.effects.createWrapper(r),f[d]=(p?"-=":"+=")+l,m[d]=(p?"+=":"-=")+2*l,g[d]=(p?"-=":"+=")+2*l,r.animate(f,h,t.easing),n=1;n<u;n++)r.animate(m,h,t.easing).animate(g,h,t.easing);r.animate(m,h,t.easing).animate(f,h/2,t.easing).queue(function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}),v>1&&y.splice.apply(y,[1,0].concat(y.splice(v,c+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),a="show"===s,l=t.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,h={};e.effects.save(r,o),r.show(),n=t.distance||r["top"===u?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(r).css({overflow:"hidden"}),a&&r.css(u,c?isNaN(n)?"-"+n:-n:n),h[u]=(a?c?"+=":"-=":c?"-=":"+=")+n,r.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,i){var n=e(this),r=e(t.to),o="fixed"===r.css("position"),s=e("body"),a=o?s.scrollTop():0,l=o?s.scrollLeft():0,u=r.offset(),c={top:u.top-a,left:u.left-l,height:r.innerHeight(),width:r.innerWidth()},h=n.offset(),d=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:h.top-a,left:h.left-l,height:n.innerHeight(),width:n.innerWidth(),position:o?"fixed":"absolute"}).animate(c,t.duration,t.easing,function(){d.remove(),i()})}}(jQuery),function(e,t){e.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var i=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,o,s,a,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,r=this.previousFilter||"",o=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),o===r?s=!0:o=r+o,a=new RegExp("^"+i(o),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())}),n=s&&n.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):n,n.length||(o=String.fromCharCode(t.keyCode),a=new RegExp("^"+i(o),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,n=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),n=t.prev("a"),r=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);n.attr("aria-haspopup","true").prepend(r),t.attr("aria-labelledby",n.attr("id"))}),t=n.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var i,n;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,n,r,o,s,a;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,r=t.offset().top-this.activeMenu.offset().top-i-n,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.height(),r<0?this.activeMenu.scrollTop(o+r):r+a>s&&this.activeMenu.scrollTop(o+r-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(t),this.activeMenu=n},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(n="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,n)},nextPage:function(t){var i,n,r;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n-r<0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,n,r;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n+r>0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return e===t?this.options.value:(this.options.value=this._constrainedValue(e),void this._refreshValue())},_constrainedValue:function(e){return e===t&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e,t){function i(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,n,r,o,s=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)n=e.trim(t[i]),o="ui-resizable-"+n,r=e("<div class='ui-resizable-handle "+o+"'></div>"),r.css({zIndex:a.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(t){var i,n,r,o;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=e(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(r,o),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=r&&r[1]?r[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,n,r=!1;for(i in this.handles)n=e(this.handles[i])[0],(n===t.target||e.contains(n,t.target))&&(r=!0);
return!this.options.disabled&&r},_mouseStart:function(t){var n,r,o,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),n=i(this.helper.css("left")),r=i(this.helper.css("top")),s.containment&&(n+=e(s.containment).scrollLeft()||0,r+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===o?this.axis+"-resize":o),l.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,n=this.helper,r={},o=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,u=this.size.width,c=this.size.height,h=t.pageX-o.left||0,d=t.pageY-o.top||0,p=this._change[s];return!!p&&(i=p.apply(this,[t,h,d]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==a&&(r.top=this.position.top+"px"),this.position.left!==l&&(r.left=this.position.left+"px"),this.size.width!==u&&(r.width=this.size.width+"px"),this.size.height!==c&&(r.height=this.size.height+"px"),n.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(r)||this._trigger("resize",t,this.ui()),!1)},_mouseStop:function(t){this.resizing=!1;var i,n,r,o,s,a,l,u=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&e.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,o=n?0:c.sizeDiff.width,s={width:c.helper.width()-o,height:c.helper.height()-r},a=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,u.animate||this.element.css(e.extend(s,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!u.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,r,o,s,a=this.options;s={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,o=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),r>s.minHeight&&(s.minHeight=r),i<s.maxWidth&&(s.maxWidth=i),o<s.maxHeight&&(s.maxHeight=o)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,r=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,r=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,u=this.position.top+this.size.height,c=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),s&&c&&(e.left=l-t.minWidth),r&&c&&(e.left=l-t.maxWidth),a&&h&&(e.top=u-t.minHeight),o&&h&&(e.top=u-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,n,r,o=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(r=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],n=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(n[t],10)||0);r.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&e.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},u=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&u?{top:c,left:u}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&e(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,n,r,o,s,a,l,u=e(this).data("ui-resizable"),c=u.options,h=u.element,d=c.containment,p=d instanceof e?d.get(0):/parent/.test(d)?h.parent().get(0):d;p&&(u.containerElement=e(p),/document/.test(d)||d===document?(u.containerOffset={left:0,top:0},u.containerPosition={left:0,top:0},u.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,r){n[e]=i(t.css("padding"+r))}),u.containerOffset=t.offset(),u.containerPosition=t.position(),u.containerSize={height:t.innerHeight()-n[3],width:t.innerWidth()-n[1]},r=u.containerOffset,o=u.containerSize.height,s=u.containerSize.width,a=e.ui.hasScroll(p,"left")?p.scrollWidth:s,l=e.ui.hasScroll(p)?p.scrollHeight:o,u.parentData={element:p,left:r.left,top:r.top,width:a,height:l}))},resize:function(t){var i,n,r,o,s=e(this).data("ui-resizable"),a=s.options,l=s.containerOffset,u=s.position,c=s._aspectRatio||t.shiftKey,h={top:0,left:0},d=s.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(h=l),u.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-h.left),c&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),u.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),c&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-h.left:s.offset.left-h.left)+s.sizeDiff.width),n=Math.abs((s._helper?s.offset.top-h.top:s.offset.top-l.top)+s.sizeDiff.height),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o&&(i-=Math.abs(s.parentData.left)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,c&&(s.size.height=s.size.width/s.aspectRatio)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,c&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.containerOffset,r=t.containerPosition,o=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,u=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:u}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:u})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("ui-resizable"),r=n.options,o=n.originalSize,s=n.originalPosition,a={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),r=e(this).data("ui-resizable-alsoresize"),o={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(r[t]||0)+(a[t]||0);i&&i>=0&&(o[t]=i||null)}),t.css(o)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):e.each(r.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size,r=t.originalSize,o=t.originalPosition,s=t.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=a[0]||1,u=a[1]||1,c=Math.round((n.width-r.width)/l)*l,h=Math.round((n.height-r.height)/u)*u,d=r.width+c,p=r.height+h,f=i.maxWidth&&i.maxWidth<d,m=i.maxHeight&&i.maxHeight<p,g=i.minWidth&&i.minWidth>d,y=i.minHeight&&i.minHeight>p;i.grid=a,g&&(d+=l),y&&(p+=u),f&&(d-=l),m&&(p-=u),/^(se|s|e)$/.test(s)?(t.size.width=d,t.size.height=p):/^(ne)$/.test(s)?(t.size.width=d,t.size.height=p,t.position.top=o.top-h):/^(sw)$/.test(s)?(t.size.width=d,t.size.height=p,t.position.left=o.left-c):(p-u>0?(t.size.height=p,t.position.top=o.top-h):(t.size.height=u,t.position.top=o.top+r.height-u),d-l>0?(t.size.width=d,t.position.left=o.left-c):(t.size.width=l,t.position.left=o.left+r.width-l))}})}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,n=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().addBack().each(function(){var n,r=e.data(this,"selectable-item");if(r)return n=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",t,{selecting:r.element}):i._trigger("unselecting",t,{unselecting:r.element}),!1}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=t.pageX,l=t.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),u=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?u=!(i.left>a||i.right<o||i.top>l||i.bottom<s):"fit"===r.tolerance&&(u=i.left>o&&i.right<a&&i.top>s&&i.bottom<l),u?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){var i=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(i=n.values&&n.values.length||1,r.length>i&&(r.slice(i).remove(),r=r.slice(0,i)),t=r.length;t<i;t++)s.push(o);this.handles=r.add(e(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,r,o,s,a,l,u,c=this,h=this.options;return!h.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-c.values(t));(r>i||r===i&&(t===c._lastChangedValue||c.values(t)===h.min))&&(r=i,o=e(this),s=t)}),a=this._start(t,s),a!==!1&&(this._mouseSliding=!0,this._handleIndex=s,o.addClass("ui-state-active").focus(),l=o.offset(),u=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:t.pageX-l.left-o.width()/2,top:t.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,r,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),n<0&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),o=this._valueMin()+n*r,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,r,o;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&i<n)&&(i=n),i!==this.values(t)&&(r=this.values(),r[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:r}),n=this.values(t?0:1),o!==!1&&this.values(t,i))):i!==this.value()&&(o=this._trigger("slide",e,{handle:this.handles[t],value:i}),o!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var n,r,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,r=arguments[0],o=0;o<n.length;o+=1)n[o]=this._trimAlignValue(r[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var n,r=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(r=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;n<r;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,r,o,s=this.options.range,a=this.options,l=this,u=!this._animateOff&&a.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[u?"animate":"css"](c,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[u?"animate":"css"]({left:i+"%"},a.animate),1===n&&l.range[u?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===n&&l.range.stop(1,1)[u?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&l.range[u?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(n=this.value(),r=this._valueMin(),o=this._valueMax(),i=o!==r?(n-r)/(o-r)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[u?"animate":"css"](c,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(t){var n,r,o,s,a=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),n=this._start(t,a),n===!1))return}switch(s=this.options.step,r=o=this.options.values&&this.options.values.length?this.values(a):this.value(),t.keyCode){case e.ui.keyCode.HOME:o=this._valueMin();break;case e.ui.keyCode.END:o=this._valueMax();break;case e.ui.keyCode.PAGE_UP:o=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/i);break;case e.ui.keyCode.PAGE_DOWN:o=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/i);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(r===this._valueMax())return;o=this._trimAlignValue(r+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(r===this._valueMin())return;o=this._trimAlignValue(r-s)}this._slide(t,a,o)},click:function(e){e.preventDefault()},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||n(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=null,r=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,o.widgetName+"-item")===o)return n=e(this),!1}),e.data(t.target,o.widgetName+"-item")===o&&(n=e(t.target)),!!n&&(!(this.options.handle&&!i&&(e(this.options.handle,n).find("*").addBack().each(function(){this===t.target&&(r=!0)}),!r))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),
a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],o=this._intersectsWithPointer(n),o&&n.instance===this.currentContainer&&!(r===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===r||e.contains(this.placeholder[0],r)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],r))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(t,n),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,u=this.offset.click.top,c=this.offset.click.left,h="x"===this.options.axis||n+u>a&&n+u<l,d="y"===this.options.axis||t+c>o&&t+c<s,p=h&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||i(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||i(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=t&&n,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return!!r&&(this.floating?s&&"right"===s||"down"===o?2:1:o&&("down"===o?2:1))},_intersectsWithSides:function(e){var t=i(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=i(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:r&&("down"===r&&t||"up"===r&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){a.push(this)}var n,r,o,s,a=[],l=[],u=this._connectWith();if(u&&t)for(n=u.length-1;n>=0;n--)for(o=e(u[n]),r=o.length-1;r>=0;r--)s=e.data(o[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,u,c=this.items,h=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(r=e(d[i]),n=r.length-1;n>=0;n--)o=e.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(h.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],a=h[i][0],n=0,u=a.length;n<u;n++)l=e(a[n]),l.data(this.widgetName+"-item",s),c.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item,t||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,n=t.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=t.currentItem[0].nodeName.toLowerCase(),r=e("<"+n+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",t.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(e,r){i&&!n.forcePlaceholderSize||(r.height()||r.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var r,o,s,a,l,u,c,h,d,p,f=null,m=null;for(r=this.containers.length-1;r>=0;r--)if(!e.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(f&&e.contains(this.containers[r].element[0],f.element[0]))continue;f=this.containers[r],m=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",t,this._uiHash(this)),this.containers[r].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",t,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(s=1e4,a=null,p=f.floating||n(this.currentItem),l=p?"left":"top",u=p?"width":"height",c=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(p&&!i(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height)||(h=this.items[o].item.offset()[l],d=!1,Math.abs(h-c)>Math.abs(h+this.items[o][u]-c)&&(d=!0,h+=this.items[o][u]),Math.abs(h-c)<s&&(s=Math.abs(h-c),a=this.items[o],this.direction=d?"up":"down")));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[m].element,!0),this._trigger("change",t,this._uiHash()),this.containers[m]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",t,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),n[0].style.width&&!i.forceHelperSize||n.width(this.currentItem.width()),n[0].style.height&&!i.forceHelperSize||n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),"document"!==r.containment&&"window"!==r.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(t=e(r.containment)[0],i=e(r.containment).offset(),n="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(t){var i,n,r=this.options,o=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){function i(e,t,i){return function(n){i._trigger(e,n,t._uiHash(t))}}this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)"auto"!==this._storedCSS[n]&&"static"!==this._storedCSS[n]||(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)t||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),n=0;n<r.length;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(n=0;n<r.length;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,n){var r=i.attr(n);void 0!==r&&r.length&&(t[n]=r)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",e)))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return this._start(t)!==!1&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,n=e.ui.keyCode;switch(t.keyCode){case n.UP:return this._repeat(null,1,t),!0;case n.DOWN:return this._repeat(null,-1,t),!0;case n.PAGE_UP:return this._repeat(null,i.page,t),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&this._trigger("start",e)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return i===-1?0:t.length-i-1},_adjustValue:function(e){var t,i,n=this.options;return t=null!==n.min?n.min:0,i=e-t,i=Math.round(i/n.step)*n.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==n.max&&e>n.max?n.max:null!==n.min&&e<n.min?n.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?void t(this._value).call(this,e):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){function i(){return++r}function n(e){return e=e.cloneNode(!1),e.hash.length>1&&decodeURIComponent(e.href.replace(o,""))===decodeURIComponent(location.href.replace(o,""))}var r=0,o=/#.*$/;e.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(i.active):this.active=e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,n=location.hash.substring(1);return null===t&&(n&&this.tabs.each(function(i,r){if(e(r).attr("aria-controls")===n)return t=i,!1}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&t!==-1||(t=!!this.tabs.length&&0)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),t===-1&&(t=!i&&0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),n=this.tabs.index(i),r=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:n++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:r=!1,n--;break;case e.ui.keyCode.END:n=this.anchors.length-1;break;case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n!==this.options.active&&n);default:return}t.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,r),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function n(){return t>r&&(t=0),t<0&&(t=r),t}for(var r=this.tabs.length-1;e.inArray(n(),this.options.disabled)!==-1;)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,r){var o,s,a,l=e(r).uniqueId().attr("id"),u=e(r).closest("li"),c=u.attr("aria-controls");n(r)?(o=r.hash,s=t.element.find(t._sanitizeSelector(o))):(a=t._tabId(u),o="#"+a,s=t.element.find(o),s.length||(s=t._createPanel(a),s.insertAfter(t.panels[i-1]||t.tablist)),s.attr("aria-live","polite")),s.length&&(t.panels=t.panels.add(s)),c&&u.data("ui-tabs-aria-controls",c),u.attr({"aria-controls":o.substring(1),"aria-labelledby":l}),s.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,n=0;i=this.tabs[n];n++)t===!0||e.inArray(n,t)!==-1?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),
this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,n=this.element.parent();"fill"===t?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");"absolute"!==n&&"fixed"!==n&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,n=this.active,r=e(t.currentTarget),o=r.closest("li"),s=o[0]===n[0],a=s&&i.collapsible,l=a?e():this._getPanelForTab(o),u=n.length?this._getPanelForTab(n):e(),c={oldTab:n,oldPanel:u,newTab:a?e():o,newPanel:l};t.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||this._trigger("beforeActivate",t,c)===!1||(i.active=!a&&this.tabs.index(o),this.active=s?e():o,this.xhr&&this.xhr.abort(),u.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),t),this._toggle(t,c))},_toggle:function(t,i){function n(){o.running=!1,o._trigger("activate",t,i)}function r(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,n):(s.show(),n())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),r()),a.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var i,n=this._findActive(t);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var n=this.options.disabled;n!==!1&&(i===t?n=!1:(i=this._getIndex(i),n=e.isArray(n)?e.map(n,function(e){return e!==i?e:null}):e.map(this.tabs,function(e,t){return t!==i?t:null})),this._setupDisabled(n))},disable:function(i){var n=this.options.disabled;if(n!==!0){if(i===t)n=!0;else{if(i=this._getIndex(i),e.inArray(i,n)!==-1)return;n=e.isArray(n)?e.merge([i],n).sort():[i]}this._setupDisabled(n)}},load:function(t,i){t=this._getIndex(t);var r=this,o=this.tabs.eq(t),s=o.find(".ui-tabs-anchor"),a=this._getPanelForTab(o),l={tab:o,panel:a};n(s[0])||(this.xhr=e.ajax(this._ajaxSettings(s,i,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(o.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){a.html(e),r._trigger("load",i,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&r.panels.stop(!1,!0),o.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr},1)})))},_ajaxSettings:function(t,i,n){var r=this;return{url:t.attr("href"),beforeSend:function(t,o){return r._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},n))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(e){function t(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),r=e.inArray(i,n);r!==-1&&n.splice(r,1),t.removeData("ui-tooltip-id"),n=e.trim(n.join(" ")),n?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")}var n=0;e.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var n=this;return"disabled"===t?(this[i?"_disable":"_enable"](),void(this.options[t]=i)):(this._super(t,i),void("content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t)})))},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur");r.target=r.currentTarget=n[0],t.close(r,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t,n=e(this);n.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._updateContent(n,t))},_updateContent:function(e,t){var i,n=this.options.content,r=this,o=t?t.type:null;return"string"==typeof n?this._open(t,e,n):(i=n.call(e[0],function(i){e.data("ui-tooltip-open")&&r._delay(function(){t&&(t.type=o),this._open(t,e,i)})}),void(i&&this._open(t,e,i)))},_open:function(i,n,r){function o(e){u.of=e,s.is(":hidden")||s.position(u)}var s,a,l,u=e.extend({},this.options.position);if(r){if(s=this._find(n),s.length)return void s.find(".ui-tooltip-content").html(r);n.is("[title]")&&(i&&"mouseover"===i.type?n.attr("title",""):n.removeAttr("title")),s=this._tooltip(n),t(n,s.attr("id")),s.find(".ui-tooltip-content").html(r),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:o}),o(i)):s.position(e.extend({of:n},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){s.is(":visible")&&(o(u.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:s}),a={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}},remove:function(){this._removeTooltip(s)}},i&&"mouseover"!==i.type||(a.mouseleave="close"),i&&"focusin"!==i.type||(a.focusout="close"),this._on(!0,n,a)}},close:function(t){var n=this,r=e(t?t.currentTarget:this.element),o=this._find(r);this.closing||(clearInterval(this.delayedShow),r.data("ui-tooltip-title")&&r.attr("title",r.data("ui-tooltip-title")),i(r),o.stop(!0),this._hide(o,this.options.hide,function(){n._removeTooltip(e(this))}),r.removeData("ui-tooltip-open"),this._off(r,"mouseleave focusout keyup"),r[0]!==this.element[0]&&this._off(r,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete n.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:o}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,r=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(r),r.appendTo(this.document[0].body),this.tooltips[i]=t,r},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur");r.target=r.currentTarget=n[0],t.close(r,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){for(var t,i=e.split(/\s+/),n=[],r=0;t=i[r];r++)t=t.charAt(0).toUpperCase(),n.push(t);return n}function i(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function n(t,r,o){return o||(o=0),r.each(function(){var r,s,a=e(this),l=this,u=this.nodeName.toLowerCase();switch("label"===u&&a.find("input, textarea, select").length&&(r=a.text(),a=a.children().first(),l=a.get(0),u=l.nodeName.toLowerCase()),u){case"menu":s={name:a.attr("label"),items:{}},o=n(s.items,a.children(),o);break;case"a":case"button":s={name:a.text(),disabled:!!a.attr("disabled"),callback:function(){return function(){a.click()}}()};break;case"menuitem":case"command":switch(a.attr("type")){case void 0:case"command":case"menuitem":s={name:a.attr("label"),disabled:!!a.attr("disabled"),icon:a.attr("icon"),callback:function(){return function(){a.click()}}()};break;case"checkbox":s={type:"checkbox",disabled:!!a.attr("disabled"),name:a.attr("label"),selected:!!a.attr("checked")};break;case"radio":s={type:"radio",disabled:!!a.attr("disabled"),name:a.attr("label"),radio:a.attr("radiogroup"),value:a.attr("id"),selected:!!a.attr("checked")};break;default:s=void 0}break;case"hr":s="-------";break;case"input":switch(a.attr("type")){case"text":s={type:"text",name:r||i(l),disabled:!!a.attr("disabled"),value:a.val()};break;case"checkbox":s={type:"checkbox",name:r||i(l),disabled:!!a.attr("disabled"),selected:!!a.attr("checked")};break;case"radio":s={type:"radio",name:r||i(l),disabled:!!a.attr("disabled"),radio:!!a.attr("name"),value:a.val(),selected:!!a.attr("checked")};break;default:s=void 0}break;case"select":s={type:"select",name:r||i(l),disabled:!!a.attr("disabled"),selected:a.val(),options:{}},a.children().each(function(){s.options[this.value]=e(this).text()});break;case"textarea":s={type:"textarea",name:r||i(l),disabled:!!a.attr("disabled"),value:a.val()};break;case"label":break;default:s={type:"html",html:a.clone(!0)}}s&&(o++,t["key"+o]=s)}),o}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=function(t){return function(i){var n,r,o;for(o=0;null!=i[o];o++){r=i[o];try{n=e._data(r,"events"),n&&n.remove&&e(r).triggerHandler("remove")}catch(s){}}t(i)}}(e.cleanData));var r=null,o=!1,s=e(window),a=0,l={},u={},c={},h={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit"},determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var i=this.offset();i.top+=this.outerHeight(),i.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(i)}},position:function(e,t,i){var n;if(!t&&!i)return void e.determinePosition.call(this,e.$menu);n="maintain"===t&&"maintain"===i?e.$menu.position():{top:i,left:t};var r=s.scrollTop()+s.height(),o=s.scrollLeft()+s.width(),a=e.$menu.outerHeight(),l=e.$menu.outerWidth();n.top+a>r&&(n.top-=a),n.top<0&&(n.top=0),n.left+l>o&&(n.left-=l),n.left<0&&(n.left=0),e.$menu.css(n)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var i={top:0,left:this.outerWidth()};t.css(i)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},d={timer:null,pageX:null,pageY:null},p=function(e){for(var t=0,i=e;;)if(t=Math.max(t,parseInt(i.css("z-index"),10)||0),i=i.parent(),!i||!i.length||"html body".indexOf(i.prop("nodeName").toLowerCase())>-1)break;return t},f={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var i=e(this);if("right"===t.data.trigger&&(t.preventDefault(),t.stopImmediatePropagation()),!("right"!==t.data.trigger&&"demand"!==t.data.trigger&&t.originalEvent||!(void 0===t.mouseButton||!t.data||"left"===t.data.trigger&&0===t.mouseButton||"right"===t.data.trigger&&2===t.mouseButton)||i.hasClass("context-menu-active")||i.hasClass("context-menu-disabled"))){if(r=i,t.data.build){var n=t.data.build(r,t);if(n===!1)return;if(t.data=e.extend(!0,{},h,t.data,n||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");t.data.$trigger=r,m.create(t.data)}var o=!1;for(var s in t.data.items)if(t.data.items.hasOwnProperty(s)){var a;a=e.isFunction(t.data.items[s].visible)?t.data.items[s].visible.call(e(t.currentTarget),s,t.data):"undefined"==typeof s.visible||t.data.items[s].visible===!0,a&&(o=!0)}o&&m.show.call(i,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var i=e(this);r&&r.length&&!r.is(i)&&r.data("contextMenu").$menu.trigger("contextmenu:hide"),2===t.button&&(r=i.data("contextMenuActive",!0))},mouseup:function(t){var i=e(this);i.data("contextMenuActive")&&r&&r.length&&r.is(i)&&!i.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),r=i,i.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),i.removeData("contextMenuActive")},mouseenter:function(t){var i=e(this),n=e(t.relatedTarget),o=e(document);n.is(".context-menu-list")||n.closest(".context-menu-list").length||r&&r.length||(d.pageX=t.pageX,d.pageY=t.pageY,d.data=t.data,o.on("mousemove.contextMenuShow",f.mousemove),d.timer=setTimeout(function(){d.timer=null,o.off("mousemove.contextMenuShow"),r=i,i.trigger(e.Event("contextmenu",{data:d.data,pageX:d.pageX,pageY:d.pageY}))},t.data.delay))},mousemove:function(e){d.pageX=e.pageX,d.pageY=e.pageY},mouseleave:function(t){var i=e(t.relatedTarget);if(!i.is(".context-menu-list")&&!i.closest(".context-menu-list").length){try{clearTimeout(d.timer)}catch(t){}d.timer=null}},layerClick:function(t){var i,n,r=e(this),o=r.data("contextMenuRoot"),a=t.button,l=t.pageX,u=t.pageY;t.preventDefault(),t.stopImmediatePropagation(),setTimeout(function(){var r,c="left"===o.trigger&&0===a||"right"===o.trigger&&2===a;if(document.elementFromPoint&&o.$layer&&(o.$layer.hide(),i=document.elementFromPoint(l-s.scrollLeft(),u-s.scrollTop()),o.$layer.show()),o.reposition&&c)if(document.elementFromPoint){if(o.$trigger.is(i)||o.$trigger.has(i).length)return void o.position.call(o.$trigger,o,l,u)}else if(n=o.$trigger.offset(),r=e(window),n.top+=r.scrollTop(),n.top<=t.pageY&&(n.left+=r.scrollLeft(),n.left<=t.pageX&&(n.bottom=n.top+o.$trigger.outerHeight(),n.bottom>=t.pageY&&(n.right=n.left+o.$trigger.outerWidth(),n.right>=t.pageX))))return void o.position.call(o.$trigger,o,l,u);i&&c&&o.$trigger.one("contextmenu:hidden",function(){e(i).contextMenu({x:l,y:u,button:a})}),null!=o&&null!=o.$menu&&o.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};r&&(t=r.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var i=0,n=function(e){""!==e.style.zIndex?i=e.style.zIndex:null!==e.offsetParent&&void 0!==e.offsetParent?n(e.offsetParent):null!==e.parentElement&&void 0!==e.parentElement&&n(e.parentElement)};if(n(e.target),!(i>t.zIndex)){switch(e.keyCode){case 9:case 38:if(f.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void t.$menu.trigger("prevcommand");if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void t.$menu.trigger("prevcommand");break;case 40:if(f.keyStop(e,t),!t.isInput)return void t.$menu.trigger("nextcommand");if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void t.$menu.trigger("nextcommand");if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(f.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var o=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void(t.$selected=o)}break;case 39:if(f.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var s=t.$selected.data("contextMenu")||{};if(s.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,s.$selected=null,void s.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(f.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void("undefined"!=typeof t.$selected&&null!==t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void f.keyStop(e,t);case 27:return f.keyStop(e,t),void t.$menu.trigger("contextmenu:hide");default:var a=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys&&t.accesskeys[a])return void t.accesskeys[a].$node.trigger(t.accesskeys[a].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),"undefined"!=typeof t.$selected&&null!==t.$selected&&t.$selected.trigger(e)}},prevItem:function(t){t.stopPropagation();var i=e(this).data("contextMenu")||{},n=e(this).data("contextMenuRoot")||{};if(i.$selected){var r=i.$selected;i=i.$selected.parent().data("contextMenu")||{},i.$selected=r}for(var o=i.$menu.children(),s=i.$selected&&i.$selected.prev().length?i.$selected.prev():o.last(),a=s;s.hasClass(n.classNames.disabled)||s.hasClass(n.classNames.notSelectable)||s.is(":hidden");)if(s=s.prev().length?s.prev():o.last(),s.is(a))return;i.$selected&&f.itemMouseleave.call(i.$selected.get(0),t),f.itemMouseenter.call(s.get(0),t);var l=s.find("input, textarea, select");l.length&&l.focus()},nextItem:function(t){t.stopPropagation();var i=e(this).data("contextMenu")||{},n=e(this).data("contextMenuRoot")||{};if(i.$selected){var r=i.$selected;i=i.$selected.parent().data("contextMenu")||{},i.$selected=r}for(var o=i.$menu.children(),s=i.$selected&&i.$selected.next().length?i.$selected.next():o.first(),a=s;s.hasClass(n.classNames.disabled)||s.hasClass(n.classNames.notSelectable)||s.is(":hidden");)if(s=s.next().length?s.next():o.first(),s.is(a))return;i.$selected&&f.itemMouseleave.call(i.$selected.get(0),t),f.itemMouseenter.call(s.get(0),t);var l=s.find("input, textarea, select");l.length&&l.focus()},focusInput:function(){var t=e(this).closest(".context-menu-item"),i=t.data(),n=i.contextMenu,r=i.contextMenuRoot;r.$selected=n.$selected=t,r.isInput=n.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item"),i=t.data(),n=i.contextMenu,r=i.contextMenuRoot;r.isInput=n.isInput=!1},menuMouseenter:function(){var t=e(this).data().contextMenuRoot;t.hovering=!0},menuMouseleave:function(t){var i=e(this).data().contextMenuRoot;i.$layer&&i.$layer.is(t.relatedTarget)&&(i.hovering=!1)},itemMouseenter:function(t){var i=e(this),n=i.data(),r=n.contextMenu,o=n.contextMenuRoot;return o.hovering=!0,t&&o.$layer&&o.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(r.$menu?r:o).$menu.children("."+o.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),i.hasClass(o.classNames.disabled)||i.hasClass(o.classNames.notSelectable)?void(r.$selected=null):void i.trigger("contextmenu:focus")},itemMouseleave:function(t){var i=e(this),n=i.data(),r=n.contextMenu,o=n.contextMenuRoot;return o!==r&&o.$layer&&o.$layer.is(t.relatedTarget)?("undefined"!=typeof o.$selected&&null!==o.$selected&&o.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),void(o.$selected=r.$selected=r.$node)):void i.trigger("contextmenu:blur")},itemClick:function(t){var i,n=e(this),r=n.data(),o=r.contextMenu,s=r.contextMenuRoot,a=r.contextMenuKey;if(o.items[a]&&!n.is("."+s.classNames.disabled+", .context-menu-submenu, .context-menu-separator, ."+s.classNames.notSelectable)){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(o.callbacks[a])&&Object.prototype.hasOwnProperty.call(o.callbacks,a))i=o.callbacks[a];else{if(!e.isFunction(s.callback))return;i=s.callback}i.call(s.$trigger,a,s)!==!1?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&m.update.call(s.$trigger,s)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,i){var n=e(this).data("contextMenuRoot");m.hide.call(n.$trigger,n,i&&i.force)},focusItem:function(t){t.stopPropagation();var i=e(this),n=i.data(),r=n.contextMenu,o=n.contextMenuRoot;i.hasClass(o.classNames.disabled)||i.hasClass(o.classNames.notSelectable)||(i.addClass([o.classNames.hover,o.classNames.visible].join(" ")).parent().find(".context-menu-item").not(i).removeClass(o.classNames.visible).filter("."+o.classNames.hover).trigger("contextmenu:blur"),r.$selected=o.$selected=i,r.$node&&o.positionSubmenu.call(r.$node,r.$menu))},blurItem:function(t){t.stopPropagation();var i=e(this),n=i.data(),r=n.contextMenu,o=n.contextMenuRoot;r.autoHide&&i.removeClass(o.classNames.visible),i.removeClass(o.classNames.hover),r.$selected=null}},m={show:function(t,i,n){var o=e(this),s={};if(e("#context-menu-layer").trigger("mousedown"),t.$trigger=o,t.events.show.call(o,t)===!1)return void(r=null);if(m.update.call(o,t),t.position.call(o,t,i,n),t.zIndex){var a=t.zIndex;"function"==typeof t.zIndex&&(a=t.zIndex.call(o,t)),s.zIndex=p(o)+a}m.layer.call(t.$menu,t,s.zIndex),t.$menu.find("ul").css("zIndex",s.zIndex+1),t.$menu.css(s)[t.animation.show](t.animation.duration,function(){o.trigger("contextmenu:visible")}),o.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",f.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var i=o.offset();i.right=i.left+o.outerWidth(),i.bottom=i.top+o.outerHeight(),!t.$layer||t.hovering||e.pageX>=i.left&&e.pageX<=i.right&&e.pageY>=i.top&&e.pageY<=i.bottom||setTimeout(function(){t.hovering||null==t.$menu||t.$menu.trigger("contextmenu:hide")},50)})},hide:function(t,i){var n=e(this);if(t||(t=n.data("contextMenu")||{}),i||!t.events||t.events.hide.call(n,t)!==!1){if(n.removeData("contextMenu").removeClass("context-menu-active"),t.$layer){setTimeout(function(e){return function(){e.remove()}}(t.$layer),10);try{delete t.$layer}catch(o){t.$layer=null}}r=null,t.$menu.find("."+t.classNames.hover).trigger("contextmenu:blur"),t.$selected=null,t.$menu.find("."+t.classNames.visible).removeClass(t.classNames.visible),e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),t.$menu&&t.$menu[t.animation.hide](t.animation.duration,function(){t.build&&(t.$menu.remove(),e.each(t,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:t[e]=void 0;try{delete t[e]}catch(i){}return!0}})),setTimeout(function(){n.trigger("contextmenu:hidden")},10)})}},create:function(i,n){function r(t){var i=e("<span></span>");if(t._accesskey)t._beforeAccesskey&&i.append(document.createTextNode(t._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(t._accesskey).appendTo(i),t._afterAccesskey&&i.append(document.createTextNode(t._afterAccesskey));else if(t.isHtmlName){if("undefined"!=typeof t.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");i.html(t.name)}else i.text(t.name);return i}void 0===n&&(n=i),i.$menu=e('<ul class="context-menu-list"></ul>').addClass(i.className||"").data({contextMenu:i,contextMenuRoot:n}),e.each(["callbacks","commands","inputs"],function(e,t){i[t]={},n[t]||(n[t]={})}),n.accesskeys||(n.accesskeys={}),e.each(i.items,function(o,s){var a=e('<li class="context-menu-item"></li>').addClass(s.className||""),l=null,u=null;if(a.on("click",e.noop),"string"!=typeof s&&"cm_separator"!==s.type||(s={type:"cm_seperator"}),s.$node=a.data({contextMenu:i,contextMenuRoot:n,contextMenuKey:o}),"undefined"!=typeof s.accesskey)for(var h,d=t(s.accesskey),p=0;h=d[p];p++)if(!n.accesskeys[h]){n.accesskeys[h]=s;var g=s.name.match(new RegExp("^(.*?)("+h+")(.*)$","i"));g&&(s._beforeAccesskey=g[1],s._accesskey=g[2],s._afterAccesskey=g[3]);break}if(s.type&&c[s.type])c[s.type].call(a,s,i,n),e.each([i,n],function(t,n){n.commands[o]=s,!e.isFunction(s.callback)||void 0!==n.callbacks[o]&&void 0!==i.type||(n.callbacks[o]=s.callback)});else{switch("cm_seperator"===s.type?a.addClass("context-menu-separator "+n.classNames.notSelectable):"html"===s.type?a.addClass("context-menu-html "+n.classNames.notSelectable):s.type?(l=e("<label></label>").appendTo(a),r(s).appendTo(l),a.addClass("context-menu-input"),i.hasTypes=!0,e.each([i,n],function(e,t){t.commands[o]=s,t.inputs[o]=s})):s.items&&(s.type="sub"),s.type){case"cm_seperator":break;case"text":u=e('<input type="text" value="1" name="" value="">').attr("name","context-menu-input-"+o).val(s.value||"").appendTo(l);break;case"textarea":u=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+o).val(s.value||"").appendTo(l),s.height&&u.height(s.height);break;case"checkbox":u=e('<input type="checkbox" value="1" name="" value="">').attr("name","context-menu-input-"+o).val(s.value||"").prop("checked",!!s.selected).prependTo(l);break;case"radio":u=e('<input type="radio" value="1" name="" value="">').attr("name","context-menu-input-"+s.radio).val(s.value||"").prop("checked",!!s.selected).prependTo(l);break;case"select":u=e('<select name="">').attr("name","context-menu-input-"+o).appendTo(l),s.options&&(e.each(s.options,function(t,i){e("<option></option>").val(t).text(i).appendTo(u)}),u.val(s.selected));break;case"sub":r(s).appendTo(a),s.appendTo=s.$node,m.create(s,n),a.data("contextMenu",s).addClass("context-menu-submenu"),s.callback=null;break;case"html":e(s.html).appendTo(a);break;default:e.each([i,n],function(t,n){n.commands[o]=s,!e.isFunction(s.callback)||void 0!==n.callbacks[o]&&void 0!==i.type||(n.callbacks[o]=s.callback)}),r(s).appendTo(a)}s.type&&"sub"!==s.type&&"html"!==s.type&&"cm_seperator"!==s.type&&(u.on("focus",f.focusInput).on("blur",f.blurInput),s.events&&u.on(s.events,i)),s.icon&&(e.isFunction(s.icon)?s._icon=s.icon.call(this,this,a,o,s):"string"==typeof s.icon&&"fa-"==s.icon.substring(0,3)?s._icon=n.classNames.icon+" "+n.classNames.icon+"--fa fa "+s.icon:s._icon=n.classNames.icon+" "+n.classNames.icon+"-"+s.icon,a.addClass(s._icon))}s.$input=u,s.$label=l,a.appendTo(i.$menu),!i.hasTypes&&e.support.eventSelectstart&&a.on("selectstart.disableTextSelect",f.abortevent)}),i.$node||i.$menu.css("display","none").addClass("context-menu-root"),i.$menu.appendTo(i.appendTo||document.body)},resize:function(t,i){var n;t.css({position:"absolute",display:"block"}),t.data("width",(n=t.get(0)).getBoundingClientRect?Math.ceil(n.getBoundingClientRect().width):t.outerWidth()+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){m.resize(e(this),!0)}),i||t.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(t,i){var n=this;void 0===i&&(i=t,m.resize(t.$menu)),t.$menu.children().each(function(){var r,o=e(this),s=o.data("contextMenuKey"),a=t.items[s],l=e.isFunction(a.disabled)&&a.disabled.call(n,s,i)||a.disabled===!0;if(r=e.isFunction(a.visible)?a.visible.call(n,s,i):"undefined"==typeof a.visible||a.visible===!0,o[r?"show":"hide"](),o[l?"addClass":"removeClass"](i.classNames.disabled),e.isFunction(a.icon)&&(o.removeClass(a._icon),a._icon=a.icon.call(this,n,o,s,a),o.addClass(a._icon)),a.type)switch(o.find("input, select, textarea").prop("disabled",l),a.type){case"text":case"textarea":a.$input.val(a.value||"");break;case"checkbox":case"radio":a.$input.val(a.value||"").prop("checked",!!a.selected);break;case"select":a.$input.val(a.selected||"")}a.$menu&&m.update.call(n,a,i)})},layer:function(t,i){var n=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+i+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:s.height(),width:s.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",f.abortevent).on("mousedown",f.layerClick);return void 0===document.body.style.maxWidth&&n.css({position:"absolute",height:e(document).height()}),n}};e.fn.contextMenu=function(t){var i=this,n=t;if(this.length>0)if(void 0===t)this.first().trigger("contextmenu");else if(void 0!==t.x&&void 0!==t.y)this.first().trigger(e.Event("contextmenu",{pageX:t.x,pageY:t.y,mouseButton:t.button}));else if("hide"===t){var r=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;r&&r.trigger("contextmenu:hide")}else"destroy"===t?e.contextMenu("destroy",{context:this}):e.isPlainObject(t)?(t.context=this,e.contextMenu("create",t)):t?this.removeClass("context-menu-disabled"):t||this.addClass("context-menu-disabled");else e.each(u,function(){this.selector===i.selector&&(n.data=this,e.extend(n.data,{trigger:"demand"}))}),f.contextmenu.call(n.target,n);return this},e.contextMenu=function(t,i){"string"!=typeof t&&(i=t,t="create"),"string"==typeof i?i={selector:i}:void 0===i&&(i={});var n=e.extend(!0,{},h,i||{}),r=e(document),s=r,c=!1;switch(n.context&&n.context.length?(s=e(n.context).first(),n.context=s.get(0),c=!e(n.context).is(document)):n.context=document,t){case"create":if(!n.selector)throw new Error("No selector specified");if(n.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+n.selector+'" as it contains a reserved className');
if(!n.build&&(!n.items||e.isEmptyObject(n.items)))throw new Error("No Items specified");if(a++,n.ns=".contextMenu"+a,c||(l[n.selector]=n.ns),u[n.ns]=n,n.trigger||(n.trigger="right"),!o){var d="click"===n.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",p={"contextmenu:focus.contextMenu":f.focusItem,"contextmenu:blur.contextMenu":f.blurItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.itemMouseenter,"mouseleave.contextMenu":f.itemMouseleave};p[d]=f.itemClick,r.on({"contextmenu:hide.contextMenu":f.hideMenu,"prevcommand.contextMenu":f.prevItem,"nextcommand.contextMenu":f.nextItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.menuMouseenter,"mouseleave.contextMenu":f.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",f.inputClick).on(p,".context-menu-item"),o=!0}switch(s.on("contextmenu"+n.ns,n.selector,n,f.contextmenu),c&&s.on("remove"+n.ns,function(){e(this).contextMenu("destroy")}),n.trigger){case"hover":s.on("mouseenter"+n.ns,n.selector,n,f.mouseenter).on("mouseleave"+n.ns,n.selector,n,f.mouseleave);break;case"left":s.on("click"+n.ns,n.selector,n,f.click)}n.build||m.create(n);break;case"destroy":var g;if(c){var y=n.context;e.each(u,function(t,i){if(!e(y).is(i.selector))return!0;g=e(".context-menu-list").filter(":visible"),g.length&&g.data().contextMenuRoot.$trigger.is(e(i.context).find(i.selector))&&g.trigger("contextmenu:hide",{force:!0});try{u[i.ns].$menu&&u[i.ns].$menu.remove(),delete u[i.ns]}catch(n){u[i.ns]=null}return e(i.context).off(i.ns),!0})}else if(n.selector){if(l[n.selector]){g=e(".context-menu-list").filter(":visible"),g.length&&g.data().contextMenuRoot.$trigger.is(n.selector)&&g.trigger("contextmenu:hide",{force:!0});try{u[l[n.selector]].$menu&&u[l[n.selector]].$menu.remove(),delete u[l[n.selector]]}catch(v){u[l[n.selector]]=null}r.off(l[n.selector])}}else r.off(".contextMenu .contextMenuAutoHide"),e.each(u,function(t,i){e(i.context).off(i.ns)}),l={},u={},a=0,o=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof i&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+t+'"')}return this},e.contextMenu.setInputValues=function(t,i){void 0===i&&(i={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=i[e]||"";break;case"checkbox":t.selected=!!i[e];break;case"radio":t.selected=(i[t.radio]||"")===t.value;break;case"select":t.selected=i[e]||""}})},e.contextMenu.getInputValues=function(t,i){return void 0===i&&(i={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":i[e]=t.$input.val();break;case"checkbox":i[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(i[t.radio]=t.value)}}),i},e.contextMenu.fromMenu=function(t){var i=e(t),r={};return n(r,i.children()),r},e.contextMenu.defaults=h,e.contextMenu.types=c,e.contextMenu.handle=f,e.contextMenu.op=m,e.contextMenu.menus=u}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.ui=e.ui||{};e.ui.version="1.12.0";!function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function n(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}var r,o,s=Math.max,a=Math.abs,l=Math.round,u=/left|center|right/,c=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=e.fn.position;o=function(){var t=e("<div>").css("position","absolute").appendTo("body").offset({top:1.5,left:1.5}),i=1.5===t.offset().top;return t.remove(),o=function(){return i},i},e.position={scrollbarWidth:function(){if(void 0!==r)return r;var t,i,n=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return e("body").append(n),t=o.offsetWidth,n.css("overflow","scroll"),i=o.offsetWidth,t===i&&(i=n[0].clientWidth),n.remove(),r=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),n=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType,o=!n&&!r;return{element:i,isWindow:n,isDocument:r,offset:o?e(t).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},e.fn.position=function(r){if(!r||!r.of)return f.apply(this,arguments);r=e.extend({},r);var p,m,g,y,v,E,T=e(r.of),b=e.position.getWithinInfo(r.within),C=e.position.getScrollInfo(b),O=(r.collision||"flip").split(" "),x={};return E=n(T),T[0].preventDefault&&(r.at="left top"),m=E.width,g=E.height,y=E.offset,v=e.extend({},y),e.each(["my","at"],function(){var e,t,i=(r[this]||"").split(" ");1===i.length&&(i=u.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=u.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",e=h.exec(i[0]),t=h.exec(i[1]),x[this]=[e?e[0]:0,t?t[0]:0],r[this]=[d.exec(i[0])[0],d.exec(i[1])[0]]}),1===O.length&&(O[1]=O[0]),"right"===r.at[0]?v.left+=m:"center"===r.at[0]&&(v.left+=m/2),"bottom"===r.at[1]?v.top+=g:"center"===r.at[1]&&(v.top+=g/2),p=t(x.at,m,g),v.left+=p[0],v.top+=p[1],this.each(function(){var n,u,c=e(this),h=c.outerWidth(),d=c.outerHeight(),f=i(this,"marginLeft"),E=i(this,"marginTop"),w=h+f+i(this,"marginRight")+C.width,R=d+E+i(this,"marginBottom")+C.height,L=e.extend({},v),S=t(x.my,c.outerWidth(),c.outerHeight());"right"===r.my[0]?L.left-=h:"center"===r.my[0]&&(L.left-=h/2),"bottom"===r.my[1]?L.top-=d:"center"===r.my[1]&&(L.top-=d/2),L.left+=S[0],L.top+=S[1],o()||(L.left=l(L.left),L.top=l(L.top)),n={marginLeft:f,marginTop:E},e.each(["left","top"],function(t,i){e.ui.position[O[t]]&&e.ui.position[O[t]][i](L,{targetWidth:m,targetHeight:g,elemWidth:h,elemHeight:d,collisionPosition:n,collisionWidth:w,collisionHeight:R,offset:[p[0]+S[0],p[1]+S[1]],my:r.my,at:r.at,within:b,elem:c})}),r.using&&(u=function(e){var t=y.left-L.left,i=t+m-h,n=y.top-L.top,o=n+g-d,l={target:{element:T,left:y.left,top:y.top,width:m,height:g},element:{element:c,left:L.left,top:L.top,width:h,height:d},horizontal:i<0?"left":t>0?"right":"center",vertical:o<0?"top":n>0?"bottom":"middle"};m<h&&a(t+i)<m&&(l.horizontal="center"),g<d&&a(n+o)<g&&(l.vertical="middle"),s(a(t),a(i))>s(a(n),a(o))?l.important="horizontal":l.important="vertical",r.using.call(this,e,l)}),c.offset(e.extend(L,{using:u}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=e.left-t.collisionPosition.marginLeft,l=r-a,u=a+t.collisionWidth-o-r;t.collisionWidth>o?l>0&&u<=0?(i=e.left+l+t.collisionWidth-o-r,e.left+=l-i):u>0&&l<=0?e.left=r:l>u?e.left=r+o-t.collisionWidth:e.left=r:l>0?e.left+=l:u>0?e.left-=u:e.left=s(e.left-a,e.left)},top:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,o=t.within.height,a=e.top-t.collisionPosition.marginTop,l=r-a,u=a+t.collisionHeight-o-r;t.collisionHeight>o?l>0&&u<=0?(i=e.top+l+t.collisionHeight-o-r,e.top+=l-i):u>0&&l<=0?e.top=r:l>u?e.top=r+o-t.collisionHeight:e.top=r:l>0?e.top+=l:u>0?e.top-=u:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,h=u+t.collisionWidth-s-l,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];c<0?(i=e.left+d+p+f+t.collisionWidth-s-o,(i<0||i<a(c))&&(e.left+=d+p+f)):h>0&&(n=e.left-t.collisionPosition.marginLeft+d+p+f-l,(n>0||a(n)<h)&&(e.left+=d+p+f))},top:function(e,t){var i,n,r=t.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,h=u+t.collisionHeight-s-l,d="top"===t.my[1],p=d?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];c<0?(n=e.top+p+f+m+t.collisionHeight-s-o,(n<0||n<a(c))&&(e.top+=p+f+m)):h>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-l,(i>0||a(i)<h)&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}();e.ui.position}),function(e,t,i){"use strict";function n(e){return null!=e&&""!==e&&"hasOwnProperty"!==e&&a.test("."+e)}function r(e,t){if(!n(t))throw s("badmember",'Dotted member path "@{0}" is invalid.',t);for(var r=t.split("."),o=0,a=r.length;o<a&&e!==i;o++){var l=r[o];e=null!==e?e[l]:i}return e}function o(e,i){i=i||{},t.forEach(i,function(e,t){delete i[t]});for(var n in e)!e.hasOwnProperty(n)||"$"===n.charAt(0)&&"$"===n.charAt(1)||(i[n]=e[n]);return i}var s=t.$$minErr("$resource"),a=/^(\.[a-zA-Z_$][0-9a-zA-Z_$]*)+$/;t.module("ngResource",["ng"]).factory("$resource",["$http","$q",function(e,n){function a(e){return l(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function l(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function u(e,t){this.template=e,this.defaults=t||{},this.urlParams={}}function c(a,l,y){function v(e,t){var i={};return t=f({},l,t),p(t,function(t,n){g(t)&&(t=t()),i[n]=t&&t.charAt&&"@"==t.charAt(0)?r(e,t.substr(1)):t}),i}function E(e){return e.resource}function T(e){o(e||{},this)}var b=new u(a);return y=f({},h,y),p(y,function(r,a){var l=/^(POST|PUT|PATCH)$/i.test(r.method);T[a]=function(a,u,c,h){var y,C,O,x={};switch(arguments.length){case 4:O=h,C=c;case 3:case 2:if(!g(u)){x=a,y=u,C=c;break}if(g(a)){C=a,O=u;break}C=u,O=c;case 1:g(a)?C=a:l?y=a:x=a;break;case 0:break;default:throw s("badargs","Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length)}var w=this instanceof T,R=w?y:r.isArray?[]:new T(y),L={},S=r.interceptor&&r.interceptor.response||E,_=r.interceptor&&r.interceptor.responseError||i;p(r,function(e,t){"params"!=t&&"isArray"!=t&&"interceptor"!=t&&(L[t]=m(e))}),l&&(L.data=y),b.setUrlParams(L,f({},v(y,r.params||{}),x),r.url);var I=e(L).then(function(e){var i=e.data,n=R.$promise;if(i){if(t.isArray(i)!==!!r.isArray)throw s("badcfg","Error in resource configuration. Expected response to contain an {0} but got an {1}",r.isArray?"array":"object",t.isArray(i)?"array":"object");r.isArray?(R.length=0,p(i,function(e){"object"==typeof e?R.push(new T(e)):R.push(e)})):(o(i,R),R.$promise=n)}return R.$resolved=!0,e.resource=R,e},function(e){return R.$resolved=!0,(O||d)(e),n.reject(e)});return I=I.then(function(e){var t=S(e);return(C||d)(t,e.headers),t},_),w?I:(R.$promise=I,R.$resolved=!1,R)},T.prototype["$"+a]=function(e,t,i){g(e)&&(i=t,t=e,e={});var n=T[a].call(this,e,this,t,i);return n.$promise||n}}),T.bind=function(e){return c(a,f({},l,e),y)},T}var h={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},d=t.noop,p=t.forEach,f=t.extend,m=t.copy,g=t.isFunction;return u.prototype={setUrlParams:function(e,i,n){var r,o,l=this,u=n||l.template,c=l.urlParams={};p(u.split(/\W/),function(e){if("hasOwnProperty"===e)throw s("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(e)&&e&&new RegExp("(^|[^\\\\]):"+e+"(\\W|$)").test(u)&&(c[e]=!0)}),u=u.replace(/\\:/g,":"),i=i||{},p(l.urlParams,function(e,n){r=i.hasOwnProperty(n)?i[n]:l.defaults[n],t.isDefined(r)&&null!==r?(o=a(r),u=u.replace(new RegExp(":"+n+"(\\W|$)","g"),function(e,t){return o+t})):u=u.replace(new RegExp("(/?):"+n+"(\\W|$)","g"),function(e,t,i){return"/"==i.charAt(0)?i:t+i})}),u=u.replace(/\/+$/,"")||"/",u=u.replace(/\/\.(?=\w+($|\?))/,"."),e.url=u.replace(/\/\\\./,"/."),p(i,function(t,i){l.urlParams[i]||(e.params=e.params||{},e.params[i]=t)})}},c}])}(window,window.angular),angular.module("ui.slider",[]).value("uiSliderConfig",{}).directive("uiSlider",["uiSliderConfig","$timeout",function(e,t){return e=e||{},{require:"ngModel",compile:function(){var i=function(i,n,r,o){function s(e,t){return t?parseFloat(e):parseInt(e,10)}function a(){n.hasClass("ui-slider")&&n.slider("destroy")}var l=angular.extend(i.$eval(r.uiSlider)||{},e),u={min:null,max:null},c=["min","max","step","lowerBound","upperBound"],h=!angular.isUndefined(r.useDecimals),d=function(){angular.isArray(o.$viewValue)&&l.range!==!0&&(console.warn("Change your range option of ui-slider. When assigning ngModel an array of values then the range option should be set to true."),l.range=!0),angular.forEach(c,function(e){angular.isDefined(r[e])&&(l[e]=s(r[e],h))}),n.slider(l),d=angular.noop};angular.forEach(c,function(e){r.$observe(e,function(t){t&&(d(),l[e]=s(t,h),n.slider("option",e,s(t,h)),o.$render())})}),r.$observe("disabled",function(e){d(),n.slider("option","disabled",!!e)}),i.$watch(r.uiSlider,function(e){d(),void 0!==e&&n.slider("option",e)},!0),t(d,0,!0),n.bind("slide",function(e,t){var r;if(t.values){var s=t.values.slice();l.lowerBound&&s[0]<l.lowerBound&&(s[0]=Math.max(s[0],l.lowerBound)),l.upperBound&&s[1]>l.upperBound&&(s[1]=Math.min(s[1],l.upperBound)),s[0]===t.values[0]&&s[1]===t.values[1]||(r=!0,t.values=s)}else{var a=t.value;l.lowerBound&&a<l.lowerBound&&(a=Math.max(a,l.lowerBound)),l.upperBound&&a>l.upperBound&&(a=Math.min(a,l.upperBound)),a!==t.value&&(r=!0,t.value=a)}if(o.$setViewValue(t.values||t.value),i.$apply(),r)return setTimeout(function(){n.slider("value",t.values||t.value)},0),!1}),o.$render=function(){d();var e=l.range===!0?"values":"value";l.range===!0||!isNaN(o.$viewValue)||o.$viewValue instanceof Array?l.range&&!angular.isDefined(o.$viewValue)&&(o.$viewValue=[0,0]):o.$viewValue=0,l.range===!0&&(angular.isDefined(l.min)&&l.min>o.$viewValue[0]&&(o.$viewValue[0]=l.min),angular.isDefined(l.max)&&l.max<o.$viewValue[1]&&(o.$viewValue[1]=l.max),o.$viewValue[0]>o.$viewValue[1]&&(u.min>=o.$viewValue[1]&&(o.$viewValue[0]=u.min),u.max<=o.$viewValue[0]&&(o.$viewValue[1]=u.max)),u.min=o.$viewValue[0],u.max=o.$viewValue[1]),n.slider(e,o.$viewValue)},i.$watch(r.ngModel,function(){l.range===!0&&o.$render()},!0),i.$on("$destroy",a),n.one("$destroy",a)},n=function(e,t,i,n){var r=angular.extend({},e.$eval(i.uiSlider)),o=["max","step","tick"];if(angular.forEach(o,function(e){angular.isDefined(i[e])&&(r[e]=i[e])}),angular.isDefined(r.tick)&&angular.isDefined(r.step))for(var s=parseInt(parseInt(r.max)/parseInt(r.step)),a=s;a>=0;a--){var l=a/s*100+"%";$("<div/>").addClass("ui-slider-tick").appendTo(t).css({left:l})}};return{pre:i,post:n}}}}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdownToggle","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/popup.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset-titles.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(e,t,i){function n(e){for(var t in e)if(void 0!==o.style[t])return e[t]}var r=function(n,o,s){s=s||{};var a=e.defer(),l=r[s.animation?"animationEndEventName":"transitionEndEventName"],u=function(e){i.$apply(function(){n.unbind(l,u),a.resolve(n)})};return l&&n.bind(l,u),t(function(){angular.isString(o)?n.addClass(o):angular.isFunction(o)?o(n):angular.isObject(o)&&n.css(o),l||a.resolve(n)}),a.promise.cancel=function(){l&&n.unbind(l,u),a.reject("Transition cancelled")},a.promise},o=document.createElement("trans"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},a={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return r.transitionEndEventName=n(s),r.animationEndEventName=n(a),r}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(e){var t=function(e,t,i){t.removeClass("collapse"),t.css({height:i});t[0].offsetWidth;t.addClass("collapse")};return{link:function(i,n,r){var o,s=!0;i.$watch(function(){return n[0].scrollHeight},function(e){0!==n[0].scrollHeight&&(o||(s?t(i,n,n[0].scrollHeight+"px"):t(i,n,"auto")))}),i.$watch(r.collapse,function(e){e?c():u()});var a,l=function(t){return a&&a.cancel(),a=e(n,t),a.then(function(){a=void 0},function(){a=void 0}),a},u=function(){s?(s=!1,o||t(i,n,"auto")):l({height:n[0].scrollHeight+"px"}).then(function(){o||t(i,n,"auto")}),o=!1},c=function(){o=!0,s?(s=!1,t(i,n,0)):(t(i,n,n[0].scrollHeight+"px"),l({height:"0"}))}}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(e,t,i){this.groups=[],this.closeOthers=function(n){var r=angular.isDefined(t.closeOthers)?e.$eval(t.closeOthers):i.closeOthers;r&&angular.forEach(this.groups,function(e){e!==n&&(e.isOpen=!1)})},this.addGroup=function(e){var t=this;this.groups.push(e),e.$on("$destroy",function(i){t.removeGroup(e)})},this.removeGroup=function(e){var t=this.groups.indexOf(e);t!==-1&&this.groups.splice(this.groups.indexOf(e),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse","$transition","$timeout",function(e,t,i){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:["$scope",function(e){this.setHeading=function(e){this.heading=e}}],link:function(t,i,n,r){var o,s;r.addGroup(t),t.isOpen=!1,n.isOpen&&(o=e(n.isOpen),s=o.assign,t.$watch(function(){return o(t.$parent)},function(e){t.isOpen=e}),t.isOpen=!!o&&o(t.$parent)),t.$watch("isOpen",function(e){e&&r.closeOthers(t),s&&s(t.$parent,e)})}}}]).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(e,t,i){return function(e,t,n,r){r.setHeading(i(e,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(e,t,i,n){e.$watch(function(){return n[i.accordionTransclude]},function(e){e&&(t.html(""),t.append(e))})}}}),angular.module("ui.bootstrap.alert",[]).directive("alert",function(){return{restrict:"EA",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"},link:function(e,t,i,n){e.closeable="close"in i}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(e,t,i){t.addClass("ng-binding").data("$binding",i.bindHtmlUnsafe),e.$watch(i.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(e){var t=e.activeClass||"active",i=e.toggleEvent||"click";return{require:"ngModel",link:function(e,n,r,o){o.$render=function(){n.toggleClass(t,angular.equals(o.$modelValue,e.$eval(r.btnRadio)))},n.bind(i,function(){n.hasClass(t)||e.$apply(function(){o.$setViewValue(e.$eval(r.btnRadio)),o.$render()})})}}}]).directive("btnCheckbox",["buttonConfig",function(e){var t=e.activeClass||"active",i=e.toggleEvent||"click";return{require:"ngModel",link:function(e,n,r,o){function s(){var t=e.$eval(r.btnCheckboxTrue);return!angular.isDefined(t)||t}function a(){var t=e.$eval(r.btnCheckboxFalse);return!!angular.isDefined(t)&&t}o.$render=function(){n.toggleClass(t,angular.equals(o.$modelValue,s()))},n.bind(i,function(){e.$apply(function(){o.$setViewValue(n.hasClass(t)?a():s()),o.$render()})})}}}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(e,t,i,n){function r(){function i(){s?(e.next(),r()):e.pause()}o&&t.cancel(o);var n=+e.interval;!isNaN(n)&&n>=0&&(o=t(i,n))}var o,s,a=this,l=a.slides=[],u=-1;a.currentSlide=null,a.select=function(n,o){function s(){if(a.currentSlide&&angular.isString(o)&&!e.noTransition&&n.$element){n.$element.addClass(o);n.$element[0].offsetWidth;angular.forEach(l,function(e){angular.extend(e,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(n,{direction:o,active:!0,entering:!0}),angular.extend(a.currentSlide||{},{direction:o,leaving:!0}),e.$currentTransition=i(n.$element,{}),function(t,i){e.$currentTransition.then(function(){c(t,i)},function(){c(t,i)})}(n,a.currentSlide)}else c(n,a.currentSlide);a.currentSlide=n,u=h,r()}function c(t,i){angular.extend(t,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(i||{},{direction:"",active:!1,leaving:!1,entering:!1}),e.$currentTransition=null}var h=l.indexOf(n);void 0===o&&(o=h>u?"next":"prev"),n&&n!==a.currentSlide&&(e.$currentTransition?(e.$currentTransition.cancel(),t(s)):s())},a.indexOfSlide=function(e){return l.indexOf(e)},e.next=function(){var t=(u+1)%l.length;if(!e.$currentTransition)return a.select(l[t],"next")},e.prev=function(){var t=u-1<0?l.length-1:u-1;if(!e.$currentTransition)return a.select(l[t],"prev")},e.select=function(e){a.select(e)},e.isActive=function(e){return a.currentSlide===e},e.slides=function(){return l},e.$watch("interval",r),e.play=function(){s||(s=!0,r())},e.pause=function(){e.noPause||(s=!1,o&&t.cancel(o))},a.addSlide=function(t,i){t.$element=i,l.push(t),1===l.length||t.active?(a.select(l[l.length-1]),1==l.length&&e.play()):t.active=!1},a.removeSlide=function(e){var t=l.indexOf(e);l.splice(t,1),l.length>0&&e.active?t>=l.length?a.select(l[t-1]):a.select(l[t]):u>t&&u--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",["$parse",function(e){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{},link:function(t,i,n,r){if(n.active){var o=e(n.active),s=o.assign,a=t.active=o(t.$parent);t.$watch(function(){var e=o(t.$parent);return e!==t.active&&(e!==a?a=t.active=e:s(t.$parent,e=a=t.active)),e})}r.addSlide(t,i),t.$on("$destroy",function(){r.removeSlide(t)}),t.$watch("active",function(e){e&&r.select(t)})}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function i(e,i){return e.currentStyle?e.currentStyle[i]:t.getComputedStyle?t.getComputedStyle(e)[i]:e.style[i]}function n(e){return"static"===(i(e,"position")||"static")}var r=function(t){for(var i=e[0],r=t.offsetParent||i;r&&r!==i&&n(r);)r=r.offsetParent;return r||i};return{position:function(t){var i=this.offset(t),n={top:0,left:0},o=r(t[0]);return o!=e[0]&&(n=this.offset(angular.element(o)),n.top+=o.clientTop-o.scrollTop,n.left+=o.clientLeft-o.scrollLeft),{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:i.top-n.top,left:i.left-n.left}},offset:function(i){var n=i[0].getBoundingClientRect();return{width:i.prop("offsetWidth"),height:i.prop("offsetHeight"),top:n.top+(t.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:n.left+(t.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.position"]).constant("datepickerConfig",{dayFormat:"dd",monthFormat:"MMMM",yearFormat:"yyyy",dayHeaderFormat:"EEE",dayTitleFormat:"MMMM yyyy",monthTitleFormat:"yyyy",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","dateFilter","datepickerConfig",function(e,t,i,n){function r(t,i){return angular.isDefined(t)?e.$parent.$eval(t):i}function o(e,t){return new Date(e,t,0).getDate()}function s(e,t){for(var i=new Array(t),n=e,r=0;r<t;)i[r++]=new Date(n),n.setDate(n.getDate()+1);return i}function a(e,t,n,r){return{date:e,label:i(e,t),selected:!!n,secondary:!!r}}var l={day:r(t.dayFormat,n.dayFormat),month:r(t.monthFormat,n.monthFormat),year:r(t.yearFormat,n.yearFormat),dayHeader:r(t.dayHeaderFormat,n.dayHeaderFormat),dayTitle:r(t.dayTitleFormat,n.dayTitleFormat),monthTitle:r(t.monthTitleFormat,n.monthTitleFormat)},u=r(t.startingDay,n.startingDay),c=r(t.yearRange,n.yearRange);this.minDate=n.minDate?new Date(n.minDate):null,this.maxDate=n.maxDate?new Date(n.maxDate):null,this.modes=[{name:"day",getVisibleDates:function(e,t){var n=e.getFullYear(),r=e.getMonth(),c=new Date(n,r,1),h=u-c.getDay(),d=h>0?7-h:-h,p=new Date(c),f=0;d>0&&(p.setDate(-d+1),f+=d),f+=o(n,r+1),f+=(7-f%7)%7;for(var m=s(p,f),g=new Array(7),y=0;y<f;y++){var v=new Date(m[y]);m[y]=a(v,l.day,t&&t.getDate()===v.getDate()&&t.getMonth()===v.getMonth()&&t.getFullYear()===v.getFullYear(),v.getMonth()!==r)}for(var E=0;E<7;E++)g[E]=i(m[E].date,l.dayHeader);return{objects:m,title:i(e,l.dayTitle),labels:g}},compare:function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},split:7,step:{months:1}},{name:"month",getVisibleDates:function(e,t){for(var n=new Array(12),r=e.getFullYear(),o=0;o<12;o++){var s=new Date(r,o,1);n[o]=a(s,l.month,t&&t.getMonth()===o&&t.getFullYear()===r)}return{objects:n,title:i(e,l.monthTitle)}},compare:function(e,t){return new Date(e.getFullYear(),e.getMonth())-new Date(t.getFullYear(),t.getMonth())},split:3,step:{years:1}},{name:"year",getVisibleDates:function(e,t){for(var i=new Array(c),n=e.getFullYear(),r=parseInt((n-1)/c,10)*c+1,o=0;o<c;o++){var s=new Date(r+o,0,1);i[o]=a(s,l.year,t&&t.getFullYear()===s.getFullYear())}return{objects:i,title:[i[0].label,i[c-1].label].join(" - ")}},compare:function(e,t){return e.getFullYear()-t.getFullYear()},split:5,step:{years:c}}],this.isDisabled=function(t,i){var n=this.modes[i||0];return this.minDate&&n.compare(t,this.minDate)<0||this.maxDate&&n.compare(t,this.maxDate)>0||e.dateDisabled&&e.dateDisabled({date:t,mode:n.name})}}]).directive("datepicker",["dateFilter","$parse","datepickerConfig","$log",function(e,t,i,n){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(e,r,o,s){function a(){e.showWeekNumbers=0===f&&g}function l(e,t){for(var i=[];e.length>0;)i.push(e.splice(0,t));return i}function u(t){var i=null,r=!0;p.$modelValue&&(i=new Date(p.$modelValue),isNaN(i)?(r=!1,n.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):t&&(m=i)),p.$setValidity("date",r);var o=d.modes[f],s=o.getVisibleDates(m,i);angular.forEach(s.objects,function(e){e.disabled=d.isDisabled(e.date,f)}),p.$setValidity("date-disabled",!i||!d.isDisabled(i)),e.rows=l(s.objects,o.split),e.labels=s.labels||[],e.title=s.title}function c(e){f=e,a(),u()}function h(e){var t=new Date(e);t.setDate(t.getDate()+4-(t.getDay()||7));var i=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((i-t)/864e5)/7)+1}var d=s[0],p=s[1];if(p){var f=0,m=new Date,g=i.showWeeks;o.showWeeks?e.$parent.$watch(t(o.showWeeks),function(e){g=!!e,a()}):a(),o.min&&e.$parent.$watch(t(o.min),function(e){d.minDate=e?new Date(e):null,u()}),o.max&&e.$parent.$watch(t(o.max),function(e){d.maxDate=e?new Date(e):null,u()}),p.$render=function(){u(!0)},e.select=function(e){if(0===f){var t=new Date(p.$modelValue);t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),p.$setViewValue(t),u(!0)}else m=e,c(f-1)},e.move=function(e){var t=d.modes[f].step;m.setMonth(m.getMonth()+e*(t.months||0)),m.setFullYear(m.getFullYear()+e*(t.years||0)),u()},e.toggleMode=function(){c((f+1)%d.modes.length)},e.getWeekNumber=function(t){return 0===f&&e.showWeekNumbers&&7===t.length?h(t[0].date):null}}}}}]).constant("datepickerPopupConfig",{dateFormat:"yyyy-MM-dd",closeOnDateSelection:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","datepickerPopupConfig",function(e,t,i,n,r,o){return{restrict:"EA",require:"ngModel",link:function(s,a,l,u){function c(e){E?E(s,!!e):y.isOpen=!!e}function h(e){if(e){if(angular.isDate(e))return u.$setValidity("date",!0),e;if(angular.isString(e)){var t=new Date(e);return isNaN(t)?void u.$setValidity("date",!1):(u.$setValidity("date",!0),t)}return void u.$setValidity("date",!1)}return u.$setValidity("date",!0),null}function d(){y.date=u.$modelValue,f()}function p(e,i,n){e&&(s.$watch(t(e),function(e){y[i]=e}),O.attr(n||i,i))}function f(){y.position=n.position(a),y.position.top=y.position.top+a.prop("offsetHeight")}var m=angular.isDefined(l.closeOnDateSelection)?y.$eval(l.closeOnDateSelection):o.closeOnDateSelection,g=l.datepickerPopup||o.dateFormat,y=s.$new();s.$on("$destroy",function(){y.$destroy()});var v,E;l.isOpen&&(v=t(l.isOpen),E=v.assign,s.$watch(v,function(e){y.isOpen=!!e})),y.isOpen=!!v&&v(s);var T=function(e){y.isOpen&&e.target!==a[0]&&y.$apply(function(){c(!1)})},b=function(){y.$apply(function(){c(!0)})},C=angular.element("<datepicker-popup-wrap><datepicker></datepicker></datepicker-popup-wrap>");C.attr({"ng-model":"date","ng-change":"dateSelection()"});var O=C.find("datepicker");l.datepickerOptions&&O.attr(angular.extend({},s.$eval(l.datepickerOptions))),u.$parsers.unshift(h),y.dateSelection=function(){u.$setViewValue(y.date),u.$render(),m&&c(!1)},a.bind("input change keyup",function(){y.$apply(function(){d()})}),u.$render=function(){var e=u.$viewValue?r(u.$viewValue,g):"";a.val(e),d()},p(l.min,"min"),p(l.max,"max"),l.showWeeks?p(l.showWeeks,"showWeeks","show-weeks"):(y.showWeeks=!0,O.attr("show-weeks","showWeeks")),l.dateDisabled&&O.attr("date-disabled",l.dateDisabled);var x=!1,w=!1;y.$watch("isOpen",function(e){e?(f(),i.bind("click",T),w&&a.unbind("focus",b),a[0].focus(),x=!0):(x&&i.unbind("click",T),a.bind("focus",b),w=!0),E&&E(s,e)});var R=t(l.ngModel).assign;y.today=function(){R(s,new Date)},y.clear=function(){R(s,null)},a.after(e(C)(y))}}}]).directive("datepickerPopupWrap",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(e,t,i){t.bind("click",function(e){e.preventDefault(),
e.stopPropagation()})}}}]),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(e,t){var i=null,n=angular.noop;return{restrict:"CA",link:function(t,r,o){t.$watch("$location.path",function(){n()}),r.parent().bind("click",function(){n()}),r.bind("click",function(t){var o=r===i;t.preventDefault(),t.stopPropagation(),i&&n(),o||(r.parent().addClass("open"),i=r,n=function(t){t&&(t.preventDefault(),t.stopPropagation()),e.unbind("click",n),r.parent().removeClass("open"),n=angular.noop,i=null},e.bind("click",n))})}}}]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,i){e.push({key:t,value:i})},get:function(t){for(var i=0;i<e.length;i++)if(t==e[i].key)return e[i]},keys:function(){for(var t=[],i=0;i<e.length;i++)t.push(e[i].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var i=-1,n=0;n<e.length;n++)if(t==e[n].key){i=n;break}return e.splice(i,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(e,t){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(i,n,r){t(function(){i.animate=!0}),i.close=function(t){var i=e.getTop();i&&i.value.backdrop&&"static"!=i.value.backdrop&&(t.preventDefault(),t.stopPropagation(),e.dismiss(i.key,"backdrop click"))}}}}]).directive("modalWindow",["$timeout",function(e){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(t,i,n){t.windowClass=n.windowClass||"",e(function(){t.animate=!0})}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(e,t,i,n){function r(){for(var e=-1,t=c.keys(),i=0;i<t.length;i++)c.get(t[i]).value.backdrop&&(e=i);return e}function o(e){var t=c.get(e).value;c.remove(e),t.modalDomEl.remove(),r()==-1&&(a.remove(),a=void 0),t.modalScope.$destroy()}var s,a,l=i.$new(!0),u=e.find("body").eq(0),c=n.createNew(),h={};return i.$watch(r,function(e){l.index=e}),e.bind("keydown",function(e){var t;27===e.which&&(t=c.top(),t&&t.value.keyboard&&i.$apply(function(){h.dismiss(t.key)}))}),h.open=function(e,i){c.add(e,{deferred:i.deferred,modalScope:i.scope,backdrop:i.backdrop,keyboard:i.keyboard});var n=angular.element("<div modal-window></div>");n.attr("window-class",i.windowClass),n.attr("index",c.length()-1),n.html(i.content);var o=t(n)(i.scope);c.top().value.modalDomEl=o,u.append(o),r()>=0&&!a&&(s=angular.element("<div modal-backdrop></div>"),a=t(s)(l),u.append(a))},h.close=function(e,t){var i=c.get(e);i&&(i.value.deferred.resolve(t),o(e))},h.dismiss=function(e,t){var i=c.get(e).value;i&&(i.deferred.reject(t),o(e))},h.getTop=function(){return c.top()},h}]).provider("$modal",function(){var e={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,i,n,r,o,s,a){function l(e){return e.template?n.when(e.template):r.get(e.templateUrl,{cache:o}).then(function(e){return e.data})}function u(e){var i=[];return angular.forEach(e,function(e,r){(angular.isFunction(e)||angular.isArray(e))&&i.push(n.when(t.invoke(e)))}),i}var c={};return c.open=function(t){var r=n.defer(),o=n.defer(),c={result:r.promise,opened:o.promise,close:function(e){a.close(c,e)},dismiss:function(e){a.dismiss(c,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var h=n.all([l(t)].concat(u(t.resolve)));return h.then(function(e){var n=(t.scope||i).$new();n.$close=c.close,n.$dismiss=c.dismiss;var o,l={},u=1;t.controller&&(l.$scope=n,l.$modalInstance=c,angular.forEach(t.resolve,function(t,i){l[i]=e[u++]}),o=s(t.controller,l)),a.open(c,{scope:n,deferred:r,content:e[0],backdrop:t.backdrop,keyboard:t.keyboard,windowClass:t.windowClass})},function(e){r.reject(e)}),h.then(function(){o.resolve(!0)},function(){o.reject(!1)}),c},c}]};return e}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function(e,t,i,n){var r=this;this.init=function(n){t.itemsPerPage?e.$parent.$watch(i(t.itemsPerPage),function(t){r.itemsPerPage=parseInt(t,10),e.totalPages=r.calculateTotalPages()}):this.itemsPerPage=n},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===e.totalPages},this.isActive=function(e){return this.page===e},this.calculateTotalPages=function(){return this.itemsPerPage<1?1:Math.ceil(e.totalItems/this.itemsPerPage)},this.getAttributeValue=function(t,i,r){return angular.isDefined(t)?r?n(t)(e.$parent):e.$parent.$eval(t):i},this.render=function(){this.page=parseInt(e.page,10)||1,e.pages=this.getPages(this.page,e.totalPages)},e.selectPage=function(t){!r.isActive(t)&&t>0&&t<=e.totalPages&&(e.page=t,e.onSelectPage({page:t}))},e.$watch("totalItems",function(){e.totalPages=r.calculateTotalPages()}),e.$watch("totalPages",function(i){t.numPages&&(e.numPages=i),r.page>i?e.selectPage(i):r.render()}),e.$watch("page",function(){r.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(e,t){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",numPages:"="},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(i,n,r,o){function s(e,t,i,n){return{number:e,text:t,active:i,disabled:n}}var a,l=o.getAttributeValue(r.boundaryLinks,t.boundaryLinks),u=o.getAttributeValue(r.directionLinks,t.directionLinks),c=o.getAttributeValue(r.firstText,t.firstText,!0),h=o.getAttributeValue(r.previousText,t.previousText,!0),d=o.getAttributeValue(r.nextText,t.nextText,!0),p=o.getAttributeValue(r.lastText,t.lastText,!0),f=o.getAttributeValue(r.rotate,t.rotate);o.init(t.itemsPerPage),r.maxSize&&i.$parent.$watch(e(r.maxSize),function(e){a=parseInt(e,10),o.render()}),o.getPages=function(e,t){var i=[],n=1,r=t,m=angular.isDefined(a)&&a<t;m&&(f?(n=Math.max(e-Math.floor(a/2),1),r=n+a-1,r>t&&(r=t,n=r-a+1)):(n=(Math.ceil(e/a)-1)*a+1,r=Math.min(n+a-1,t)));for(var g=n;g<=r;g++){var y=s(g,g,o.isActive(g),!1);i.push(y)}if(m&&!f){if(n>1){var v=s(n-1,"...",!1,!1);i.unshift(v)}if(r<t){var E=s(r+1,"...",!1,!1);i.push(E)}}if(u){var T=s(e-1,h,!1,o.noPrevious());i.unshift(T);var b=s(e+1,d,!1,o.noNext());i.push(b)}if(l){var C=s(1,c,!1,o.noPrevious());i.unshift(C);var O=s(t,p,!1,o.noNext());i.push(O)}return i}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(e){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",numPages:"="},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(t,i,n,r){function o(e,t,i,n,r){return{number:e,text:t,disabled:i,previous:l&&n,next:l&&r}}var s=r.getAttributeValue(n.previousText,e.previousText,!0),a=r.getAttributeValue(n.nextText,e.nextText,!0),l=r.getAttributeValue(n.align,e.align);r.init(e.itemsPerPage),r.getPages=function(e){return[o(e-1,s,r.noPrevious(),!0,!1),o(e+1,a,r.noNext(),!1,!0)]}}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function e(e){var t=/[A-Z]/g,i="-";return e.replace(t,function(e,t){return(t?i:"")+e.toLowerCase()})}var t={placement:"top",animation:!0,popupDelay:0},i={mouseenter:"mouseleave",click:"click",focus:"blur"},n={};this.options=function(e){angular.extend(n,e)},this.setTriggers=function(e){angular.extend(i,e)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(r,o,s,a,l,u,c){return function(r,h,d){function p(e){var t=e||f.trigger||d,n=i[t]||t;return{show:t,hide:n}}var f=angular.extend({},t,n),m=e(r),g=c.startSymbol(),y=c.endSymbol(),v="<"+m+'-popup title="'+g+"tt_title"+y+'" content="'+g+"tt_content"+y+'" placement="'+g+"tt_placement"+y+'" animation="tt_animation()" is-open="tt_isOpen"></'+m+"-popup>";return{restrict:"EA",scope:!0,link:function(e,t,i){function n(){e.tt_isOpen?d():c()}function c(){e.tt_popupDelay?E=s(m,e.tt_popupDelay):e.$apply(m)}function d(){e.$apply(function(){g()})}function m(){var i,n,r,o;if(e.tt_content){switch(y&&s.cancel(y),b.css({top:0,left:0,display:"block"}),C?(T=T||l.find("body"),T.append(b)):t.after(b),i=C?u.offset(t):u.position(t),n=b.prop("offsetWidth"),r=b.prop("offsetHeight"),e.tt_placement){case"right":o={top:i.top+i.height/2-r/2,left:i.left+i.width};break;case"bottom":o={top:i.top+i.height,left:i.left+i.width/2-n/2};break;case"left":o={top:i.top+i.height/2-r/2,left:i.left-n};break;default:o={top:i.top-r,left:i.left+i.width/2-n/2}}o.top+="px",o.left+="px",b.css(o),e.tt_isOpen=!0}}function g(){e.tt_isOpen=!1,s.cancel(E),angular.isDefined(e.tt_animation)&&e.tt_animation()?y=s(function(){b.remove()},500):b.remove()}var y,E,T,b=o(v)(e),C=!!angular.isDefined(f.appendToBody)&&f.appendToBody,O=p(void 0),x=!1;e.tt_isOpen=!1,i.$observe(r,function(t){e.tt_content=t}),i.$observe(h+"Title",function(t){e.tt_title=t}),i.$observe(h+"Placement",function(t){e.tt_placement=angular.isDefined(t)?t:f.placement}),i.$observe(h+"Animation",function(t){e.tt_animation=angular.isDefined(t)?a(t):function(){return f.animation}}),i.$observe(h+"PopupDelay",function(t){var i=parseInt(t,10);e.tt_popupDelay=isNaN(i)?f.popupDelay:i}),i.$observe(h+"Trigger",function(e){x&&(t.unbind(O.show,c),t.unbind(O.hide,d)),O=p(e),O.show===O.hide?t.bind(O.show,n):(t.bind(O.show,c),t.bind(O.hide,d)),x=!0}),i.$observe(h+"AppendToBody",function(t){C=angular.isDefined(t)?a(t)(e):C}),C&&e.$on("$locationChangeSuccess",function(){e.tt_isOpen&&g()}),e.$on("$destroy",function(){e.tt_isOpen?g():b.remove()})}}}}]}).directive("tooltipPopup",function(){return{restrict:"E",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(e){return e("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"E",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(e){return e("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$compile","$timeout","$parse","$window","$tooltip",function(e,t,i,n,r){return r("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",["ui.bootstrap.transition"]).constant("progressConfig",{animate:!0,autoType:!1,stackedTypes:["success","info","warning","danger"]}).controller("ProgressBarController",["$scope","$attrs","progressConfig",function(e,t,i){function n(e){return s[e]}var r=angular.isDefined(t.animate)?e.$eval(t.animate):i.animate,o=angular.isDefined(t.autoType)?e.$eval(t.autoType):i.autoType,s=angular.isDefined(t.stackedTypes)?e.$eval("["+t.stackedTypes+"]"):i.stackedTypes;this.makeBar=function(e,t,i){var s=angular.isObject(e)?e.value:e||0,a=angular.isObject(t)?t.value:t||0,l=angular.isObject(e)&&angular.isDefined(e.type)?e.type:o?n(i||0):null;return{from:a,to:s,type:l,animate:r}},this.addBar=function(t){e.bars.push(t),e.totalPercent+=t.to},this.clearBars=function(){e.bars=[],e.totalPercent=0},this.clearBars()}]).directive("progress",function(){return{restrict:"EA",replace:!0,controller:"ProgressBarController",scope:{value:"=percent",onFull:"&",onEmpty:"&"},templateUrl:"template/progressbar/progress.html",link:function(e,t,i,n){e.$watch("value",function(e,t){if(n.clearBars(),angular.isArray(e))for(var i=0,r=e.length;i<r;i++)n.addBar(n.makeBar(e[i],t[i],i));else n.addBar(n.makeBar(e,t))},!0),e.$watch("totalPercent",function(t){t>=100?e.onFull():t<=0&&e.onEmpty()},!0)}}}).directive("progressbar",["$transition",function(e){return{restrict:"EA",replace:!0,scope:{width:"=",old:"=",type:"=",animate:"="},templateUrl:"template/progressbar/bar.html",link:function(t,i){t.$watch("width",function(n){t.animate?(i.css("width",t.old+"%"),e(i,{width:n+"%"})):i.css("width",n+"%")})}}}]),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","$parse","ratingConfig",function(e,t,i,n){this.maxRange=angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max,this.stateOn=angular.isDefined(t.stateOn)?e.$parent.$eval(t.stateOn):n.stateOn,this.stateOff=angular.isDefined(t.stateOff)?e.$parent.$eval(t.stateOff):n.stateOff,this.createDefaultRange=function(e){for(var t={stateOn:this.stateOn,stateOff:this.stateOff},i=new Array(e),n=0;n<e;n++)i[n]=t;return i},this.normalizeRange=function(e){for(var t=0,i=e.length;t<i;t++)e[t].stateOn=e[t].stateOn||this.stateOn,e[t].stateOff=e[t].stateOff||this.stateOff;return e},e.range=angular.isDefined(t.ratingStates)?this.normalizeRange(angular.copy(e.$parent.$eval(t.ratingStates))):this.createDefaultRange(this.maxRange),e.rate=function(t){e.readonly||e.value===t||(e.value=t)},e.enter=function(t){e.readonly||(e.val=t),e.onHover({value:t})},e.reset=function(){e.val=angular.copy(e.value),e.onLeave()},e.$watch("value",function(t){e.val=t}),e.readonly=!1,t.readonly&&e.$parent.$watch(i(t.readonly),function(t){e.readonly=!!t})}]).directive("rating",function(){return{restrict:"EA",scope:{value:"=",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0}}),angular.module("ui.bootstrap.tabs",[]).directive("tabs",function(){return function(){throw new Error("The `tabs` directive is deprecated, please migrate to `tabset`. Instructions can be found at http://github.com/angular-ui/bootstrap/tree/master/CHANGELOG.md")}}).controller("TabsetController",["$scope","$element",function(e,t){var i=this,n=i.tabs=e.tabs=[];i.select=function(e){angular.forEach(n,function(e){e.active=!1}),e.active=!0},i.addTab=function(e){n.push(e),(1===n.length||e.active)&&i.select(e)},i.removeTab=function(e){var t=n.indexOf(e);if(e.active&&n.length>1){var r=t==n.length-1?t-1:t+1;i.select(n[r])}n.splice(t,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,require:"^tabset",scope:{},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",compile:function(e,t,i){return function(e,t,n,r){e.vertical=!!angular.isDefined(n.vertical)&&e.$parent.$eval(n.vertical),e.type=angular.isDefined(n.type)?e.$parent.$eval(n.type):"tabs",e.direction=angular.isDefined(n.direction)?e.$parent.$eval(n.direction):"top",e.tabsAbove="below"!=e.direction,r.$scope=e,r.$transcludeFn=i}}}}).directive("tab",["$parse","$http","$templateCache","$compile",function(e,t,i,n){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(t,i,n){return function(t,i,r,o){var s,a;r.active?(s=e(r.active),a=s.assign,t.$parent.$watch(s,function(e){t.active=!!e}),t.active=s(t.$parent)):a=s=angular.noop,t.$watch("active",function(e){a(t.$parent,e),e?(o.select(t),t.onSelect()):t.onDeselect()}),t.disabled=!1,r.disabled&&t.$parent.$watch(e(r.disabled),function(e){t.disabled=!!e}),t.select=function(){t.disabled||(t.active=!0)},o.addTab(t),t.$on("$destroy",function(){o.removeTab(t)}),t.active&&a(t.$parent,!0),t.$transcludeFn=n}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(e,t,i,n){e.$watch("headingElement",function(e){e&&(t.html(""),t.append(e))})}}}]).directive("tabContentTransclude",["$compile","$parse",function(e,t){function i(e){return e.tagName&&(e.hasAttribute("tab-heading")||e.hasAttribute("data-tab-heading")||"tab-heading"===e.tagName.toLowerCase()||"data-tab-heading"===e.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(e,t,n){var r=e.$eval(n.tabContentTransclude);r.$transcludeFn(r.$parent,function(e){angular.forEach(e,function(e){i(e)?r.headingElement=e:t.append(e)})})}}}]).directive("tabsetTitles",["$http",function(e){return{restrict:"A",require:"^tabset",templateUrl:"template/tabs/tabset-titles.html",replace:!0,link:function(e,t,i,n){e.$eval(i.tabsetTitles)?n.$transcludeFn(n.$scope.$parent,function(e){t.append(e)}):t.remove()}}}]),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:["AM","PM"],readonlyInput:!1,mousewheel:!0}).directive("timepicker",["$parse","$log","timepickerConfig",function(e,t,i){return{restrict:"EA",require:"?^ngModel",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(n,r,o,s){function a(){var e=parseInt(n.hours,10),t=n.showMeridian?e>0&&e<13:e>=0&&e<24;if(t)return n.showMeridian&&(12===e&&(e=0),n.meridian===m[1]&&(e+=12)),e}function l(){var e=parseInt(n.minutes,10);return e>=0&&e<60?e:void 0}function u(e){return angular.isDefined(e)&&e.toString().length<2?"0"+e:e}function c(e){h(),s.$setViewValue(new Date(f)),d(e)}function h(){s.$setValidity("time",!0),n.invalidHours=!1,n.invalidMinutes=!1}function d(e){var t=f.getHours(),i=f.getMinutes();n.showMeridian&&(t=0===t||12===t?12:t%12),n.hours="h"===e?t:u(t),n.minutes="m"===e?i:u(i),n.meridian=f.getHours()<12?m[0]:m[1]}function p(e){var t=new Date(f.getTime()+6e4*e);f.setHours(t.getHours(),t.getMinutes()),c()}if(s){var f=new Date,m=i.meridians,g=i.hourStep;o.hourStep&&n.$parent.$watch(e(o.hourStep),function(e){g=parseInt(e,10)});var y=i.minuteStep;o.minuteStep&&n.$parent.$watch(e(o.minuteStep),function(e){y=parseInt(e,10)}),n.showMeridian=i.showMeridian,o.showMeridian&&n.$parent.$watch(e(o.showMeridian),function(e){if(n.showMeridian=!!e,s.$error.time){var t=a(),i=l();angular.isDefined(t)&&angular.isDefined(i)&&(f.setHours(t),c())}else d()});var v=r.find("input"),E=v.eq(0),T=v.eq(1),b=angular.isDefined(o.mousewheel)?n.$eval(o.mousewheel):i.mousewheel;if(b){var C=function(e){e.originalEvent&&(e=e.originalEvent);var t=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||t>0};E.bind("mousewheel wheel",function(e){n.$apply(C(e)?n.incrementHours():n.decrementHours()),e.preventDefault()}),T.bind("mousewheel wheel",function(e){n.$apply(C(e)?n.incrementMinutes():n.decrementMinutes()),e.preventDefault()})}if(n.readonlyInput=angular.isDefined(o.readonlyInput)?n.$eval(o.readonlyInput):i.readonlyInput,n.readonlyInput)n.updateHours=angular.noop,n.updateMinutes=angular.noop;else{var O=function(e,t){s.$setViewValue(null),s.$setValidity("time",!1),angular.isDefined(e)&&(n.invalidHours=e),angular.isDefined(t)&&(n.invalidMinutes=t)};n.updateHours=function(){var e=a();angular.isDefined(e)?(f.setHours(e),c("h")):O(!0)},E.bind("blur",function(e){!n.validHours&&n.hours<10&&n.$apply(function(){n.hours=u(n.hours)})}),n.updateMinutes=function(){var e=l();angular.isDefined(e)?(f.setMinutes(e),c("m")):O(void 0,!0)},T.bind("blur",function(e){!n.invalidMinutes&&n.minutes<10&&n.$apply(function(){n.minutes=u(n.minutes)})})}s.$render=function(){var e=s.$modelValue?new Date(s.$modelValue):null;isNaN(e)?(s.$setValidity("time",!1),t.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(e&&(f=e),h(),d())},n.incrementHours=function(){p(60*g)},n.decrementHours=function(){p(60*-g)},n.incrementMinutes=function(){p(y)},n.decrementMinutes=function(){p(-y)},n.toggleMeridian=function(){p(720*(f.getHours()<12?1:-1))}}}}}]),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(i){var n=i.match(t);if(!n)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+i+"'.");return{itemName:n[3],source:e(n[4]),viewMapper:e(n[2]||n[1]),modelMapper:e(n[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,t,i,n,r,o,s){var a=[9,13,27,38,40];return{require:"ngModel",link:function(l,u,c,h){var d=l.$eval(c.typeaheadMinLength)||1,p=l.$eval(c.typeaheadWaitMs)||0,f=l.$eval(c.typeaheadEditable)!==!1,m=t(c.typeaheadLoading).assign||angular.noop,g=t(c.typeaheadOnSelect),y=c.typeaheadInputFormatter?t(c.typeaheadInputFormatter):void 0,v=t(c.ngModel).assign,E=s.parse(c.typeahead),T=angular.element("<typeahead-popup></typeahead-popup>");T.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(c.typeaheadTemplateUrl)&&T.attr("template-url",c.typeaheadTemplateUrl);var b=l.$new();l.$on("$destroy",function(){b.$destroy()});var C=function(){b.matches=[],b.activeIdx=-1},O=function(e){var t={$viewValue:e};m(l,!0),i.when(E.source(b,t)).then(function(i){if(e===h.$viewValue){if(i.length>0){b.activeIdx=0,b.matches.length=0;for(var n=0;n<i.length;n++)t[E.itemName]=i[n],b.matches.push({label:E.viewMapper(b,t),model:i[n]});b.query=e,b.position=o.position(u),b.position.top=b.position.top+u.prop("offsetHeight")}else C();m(l,!1)}},function(){C(),m(l,!1)})};C(),b.query=void 0;var x;h.$parsers.unshift(function(e){return C(),e&&e.length>=d&&(p>0?(x&&n.cancel(x),x=n(function(){O(e)},p)):O(e)),f?e:void h.$setValidity("editable",!1)}),h.$formatters.push(function(e){var t,i,n={};return y?(n.$model=e,y(l,n)):(n[E.itemName]=e,t=E.viewMapper(l,n),n[E.itemName]=void 0,i=E.viewMapper(l,n),t!==i?t:e)}),b.select=function(e){var t,i,n={};n[E.itemName]=i=b.matches[e].model,t=E.modelMapper(l,n),v(l,t),h.$setValidity("editable",!0),g(l,{$item:i,$model:t,$label:E.viewMapper(l,n)}),C(),u[0].focus()},u.bind("keydown",function(e){0!==b.matches.length&&a.indexOf(e.which)!==-1&&(e.preventDefault(),40===e.which?(b.activeIdx=(b.activeIdx+1)%b.matches.length,b.$digest()):38===e.which?(b.activeIdx=(b.activeIdx?b.activeIdx:b.matches.length)-1,b.$digest()):13===e.which||9===e.which?b.$apply(function(){b.select(b.activeIdx)}):27===e.which&&(e.stopPropagation(),C(),b.$digest()))});var w=function(e){u[0]!==e.target&&(C(),b.$digest())};r.bind("click",w),l.$on("$destroy",function(){r.unbind("click",w)}),u.after(e(T)(b))}}}]).directive("typeaheadPopup",function(){return{restrict:"E",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(e,t,i){e.templateUrl=i.templateUrl,e.isOpen=function(){return e.matches.length>0},e.isActive=function(t){return e.active==t},e.selectActive=function(t){e.active=t},e.selectMatch=function(t){e.select({activeIdx:t})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(e,t,i,n){return{restrict:"E",scope:{index:"=",match:"=",query:"="},link:function(r,o,s){var a=n(s.templateUrl)(r.$parent)||"template/typeahead/typeahead-match.html";e.get(a,{cache:t}).success(function(e){o.replaceWith(i(e.trim())(r))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,i){return i?t.replace(new RegExp(e(i),"gi"),"<strong>$&</strong>"):t}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function(e){e.put("template/accordion/accordion-group.html",'<div class="accordion-group">\n  <div class="accordion-heading" ><a class="accordion-toggle" ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a></div>\n  <div class="accordion-body" collapse="!isOpen">\n    <div class="accordion-inner" ng-transclude></div>  </div>\n</div>')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function(e){e.put("template/accordion/accordion.html",'<div class="accordion" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(e){e.put("template/alert/alert.html","<div class='alert' ng-class='type && \"alert-\" + type'>\n    <button ng-show='closeable' type='button' class='close' ng-click='close()'>&times;</button>\n    <div ng-transclude></div>\n</div>\n")}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function(e){e.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel">\n    <ol class="carousel-indicators" ng-show="slides().length > 1">\n        <li ng-repeat="slide in slides()" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a ng-click="prev()" class="carousel-control left" ng-show="slides().length > 1">&lsaquo;</a>\n    <a ng-click="next()" class="carousel-control right" ng-show="slides().length > 1">&rsaquo;</a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function(e){e.put("template/carousel/slide.html","<div ng-class=\"{\n    'active': leaving || (active && !entering),\n    'prev': (next || active) && direction=='prev',\n    'next': (next || active) && direction=='next',\n    'right': direction=='prev',\n    'left': direction=='next'\n  }\" class=\"item\" ng-transclude></div>\n")}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/datepicker.html",'<table>\n  <thead>\n    <tr class="text-center">\n      <th><button type="button" class="btn pull-left" ng-click="move(-1)"><i class="icon-chevron-left"></i></button></th>\n      <th colspan="{{rows[0].length - 2 + showWeekNumbers}}"><button type="button" class="btn btn-block" ng-click="toggleMode()"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn pull-right" ng-click="move(1)"><i class="icon-chevron-right"></i></button></th>\n    </tr>\n    <tr class="text-center" ng-show="labels.length > 0">\n      <th ng-show="showWeekNumbers">#</th>\n      <th ng-repeat="label in labels">{{label}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows">\n      <td ng-show="showWeekNumbers" class="text-center"><em>{{ getWeekNumber(row) }}</em></td>\n      <td ng-repeat="dt in row" class="text-center">\n        <button type="button" style="width:100%;" class="btn" ng-class="{\'btn-info\': dt.selected}" ng-click="select(dt.date)" ng-disabled="dt.disabled"><span ng-class="{muted: dt.secondary}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', left: position.left+\'px\'}" class="dropdown-menu">\n\t<li ng-transclude></li>\n\t<li class="divider"></li>\n\t<li style="padding: 9px;">\n\t\t<span class="btn-group">\n\t\t\t<button class="btn btn-small btn-inverse" ng-click="today()">Today</button>\n\t\t\t<button class="btn btn-small btn-info" ng-click="showWeeks = ! showWeeks" ng-class="{active: showWeeks}">Weeks</button>\n\t\t\t<button class="btn btn-small btn-danger" ng-click="clear()">Clear</button>\n\t\t</span>\n\t\t<button class="btn btn-small btn-success pull-right" ng-click="isOpen = false">Close</button>\n\t</li>\n</ul>')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(e){e.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}" ng-click="close($event)"></div>')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(e){e.put("template/modal/window.html",'<div class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10}" ng-transclude></div>')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function(e){e.put("template/pagination/pager.html",'<div class="pager">\n  <ul>\n    <li ng-repeat="page in pages" ng-class="{disabled: page.disabled, previous: page.previous, next: page.next}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  </ul>\n</div>\n')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function(e){e.put("template/pagination/pagination.html",'<div class="pagination"><ul>\n  <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  </ul>\n</div>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function(e){e.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function(e){e.put("template/progressbar/bar.html",'<div class="bar" ng-class=\'type && "bar-" + type\'></div>')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function(e){e.put("template/progressbar/progress.html",'<div class="progress"><progressbar ng-repeat="bar in bars" width="bar.to" old="bar.from" animate="bar.animate" type="bar.type"></progressbar></div>')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function(e){e.put("template/rating/rating.html",'<span ng-mouseleave="reset()">\n\t<i ng-repeat="r in range" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" ng-class="$index < val && (r.stateOn || \'icon-star\') || (r.stateOff || \'icon-star-empty\')"></i>\n</span>')}]),angular.module("template/tabs/pane.html",[]).run(["$templateCache",function(e){e.put("template/tabs/pane.html",'<div class="tab-pane" ng-class="{active: selected}" ng-show="selected" ng-transclude></div>\n')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function(e){e.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabs.html",[]).run(["$templateCache",function(e){e.put("template/tabs/tabs.html",'<div class="tabbable">\n  <ul class="nav nav-tabs">\n    <li ng-repeat="pane in panes" ng-class="{active:pane.selected}">\n      <a ng-click="select(pane)">{{pane.heading}}</a>\n    </li>\n  </ul>\n  <div class="tab-content" ng-transclude></div>\n</div>\n')}]),angular.module("template/tabs/tabset-titles.html",[]).run(["$templateCache",function(e){e.put("template/tabs/tabset-titles.html","<ul class=\"nav {{type && 'nav-' + type}}\" ng-class=\"{'nav-stacked': vertical}\">\n</ul>\n")}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function(e){
e.put("template/tabs/tabset.html",'\n<div class="tabbable" ng-class="{\'tabs-right\': direction == \'right\', \'tabs-left\': direction == \'left\', \'tabs-below\': direction == \'below\'}">\n  <div tabset-titles="tabsAbove"></div>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n  <div tabset-titles="!tabsAbove"></div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function(e){e.put("template/timepicker/timepicker.html",'<table class="form-inline">\n\t<tr class="text-center">\n\t\t<td><a ng-click="incrementHours()" class="btn btn-link"><i class="icon-chevron-up"></i></a></td>\n\t\t<td>&nbsp;</td>\n\t\t<td><a ng-click="incrementMinutes()" class="btn btn-link"><i class="icon-chevron-up"></i></a></td>\n\t\t<td ng-show="showMeridian"></td>\n\t</tr>\n\t<tr>\n\t\t<td class="control-group" ng-class="{\'error\': invalidHours}"><input type="text" ng-model="hours" ng-change="updateHours()" class="span1 text-center" ng-mousewheel="incrementHours()" ng-readonly="readonlyInput" maxlength="2" /></td>\n\t\t<td>:</td>\n\t\t<td class="control-group" ng-class="{\'error\': invalidMinutes}"><input type="text" ng-model="minutes" ng-change="updateMinutes()" class="span1 text-center" ng-readonly="readonlyInput" maxlength="2"></td>\n\t\t<td ng-show="showMeridian"><button type="button" ng-click="toggleMeridian()" class="btn text-center">{{meridian}}</button></td>\n\t</tr>\n\t<tr class="text-center">\n\t\t<td><a ng-click="decrementHours()" class="btn btn-link"><i class="icon-chevron-down"></i></a></td>\n\t\t<td>&nbsp;</td>\n\t\t<td><a ng-click="decrementMinutes()" class="btn btn-link"><i class="icon-chevron-down"></i></a></td>\n\t\t<td ng-show="showMeridian"></td>\n\t</tr>\n</table>')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-popup.html","<ul class=\"typeahead dropdown-menu\" ng-style=\"{display: isOpen()&&'block' || 'none', top: position.top+'px', left: position.left+'px'}\">\n"+'    <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)">\n        <typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></typeahead-match>\n    </li>\n</ul>')}]),angular.module("template/typeahead/typeahead.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead.html","<ul class=\"typeahead dropdown-menu\" ng-style=\"{display: isOpen()&&'block' || 'none', top: position.top+'px', left: position.left+'px'}\">\n"+'    <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)">\n        <a tabindex="-1" ng-click="selectMatch($index)" ng-bind-html-unsafe="match.label | typeaheadHighlight:query"></a>\n    </li>\n</ul>')}]),function(){window.CKEDITOR&&window.CKEDITOR.dom||(window.CKEDITOR||(window.CKEDITOR=function(){var e=/(^|.*[\\\/])ckeditor\.js(?:\?.*|;.*)?$/i,t={timestamp:"F61C",version:"4.4.8 (Standard)",revision:"ccd0038",rnd:Math.floor(900*Math.random())+100,_:{pending:[],basePathSrcPattern:e},status:"unloaded",basePath:function(){var t=window.CKEDITOR_BASEPATH||"";if(!t)for(var i=document.getElementsByTagName("script"),n=0;n<i.length;n++){var r=i[n].src.match(e);if(r){t=r[1];break}}if(-1==t.indexOf(":/")&&"//"!=t.slice(0,2)&&(t=0===t.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+t:location.href.match(/^[^\?]*\/(?:)/)[0]+t),!t)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return t}(),getUrl:function(e){return-1==e.indexOf(":/")&&0!==e.indexOf("/")&&(e=this.basePath+e),this.timestamp&&"/"!=e.charAt(e.length-1)&&!/[&?]t=/.test(e)&&(e+=(0<=e.indexOf("?")?"&":"?")+"t="+this.timestamp),e},domReady:function(){function e(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",e,!1),t()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",e),t())}catch(i){}}function t(){for(var e;e=i.shift();)e()}var i=[];return function(t){function n(){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(n,1)}e()}if(i.push(t),"complete"===document.readyState&&setTimeout(e,1),1==i.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e),t=!1;try{t=!window.frameElement}catch(r){}document.documentElement.doScroll&&t&&n()}}}()},i=window.CKEDITOR_GETURL;if(i){var n=t.getUrl;t.getUrl=function(e){return i.call(t,e)||n.call(t,e)}}return t}()),CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(e){var t,i=CKEDITOR.event.prototype;for(t in i)null==e[t]&&(e[t]=i[t])},CKEDITOR.event.prototype=function(){function e(e){var n=t(this);return n[e]||(n[e]=new i(e))}var t=function(e){return e=e.getPrivate&&e.getPrivate()||e._||(e._={}),e.events||(e.events={})},i=function(e){this.name=e,this.listeners=[]};return i.prototype={getListenerIndex:function(e){for(var t=0,i=this.listeners;t<i.length;t++)if(i[t].fn==e)return t;return-1}},{define:function(t,i){var n=e.call(this,t);CKEDITOR.tools.extend(n,i,!0)},on:function(t,i,n,r,o){function s(e,o,s,l){return e={name:t,sender:this,editor:e,data:o,listenerData:r,stop:s,cancel:l,removeListener:a},i.call(n,e)!==!1&&e.data}function a(){u.removeListener(t,i)}var l=e.call(this,t);if(l.getListenerIndex(i)<0){l=l.listeners,n||(n=this),isNaN(o)&&(o=10);var u=this;s.fn=i,s.priority=o;for(var c=l.length-1;c>=0;c--)if(l[c].priority<=o)return l.splice(c+1,0,s),{removeListener:a};l.unshift(s)}return{removeListener:a}},once:function(){var e=Array.prototype.slice.call(arguments),t=e[1];return e[1]=function(e){return e.removeListener(),t.apply(this,arguments)},this.on.apply(this,e)},capture:function(){CKEDITOR.event.useCapture=1;var e=this.on.apply(this,arguments);return CKEDITOR.event.useCapture=0,e},fire:function(){var e=0,i=function(){e=1},n=0,r=function(){n=1};return function(o,s,a){var l=t(this)[o],o=e,u=n;if(e=n=0,l){var c=l.listeners;if(c.length)for(var h,c=c.slice(0),d=0;d<c.length;d++){if(l.errorProof)try{h=c[d].call(this,a,s,i,r)}catch(p){}else h=c[d].call(this,a,s,i,r);if(h===!1?n=1:"undefined"!=typeof h&&(s=h),e||n)break}}return s=!n&&("undefined"==typeof s||s),e=o,n=u,s}}(),fireOnce:function(e,i,n){return i=this.fire(e,i,n),delete t(this)[e],i},removeListener:function(e,i){var n=t(this)[e];if(n){var r=n.getListenerIndex(i);r>=0&&n.listeners.splice(r,1)}},removeAllListeners:function(){var e,i=t(this);for(e in i)delete i[e]},hasListeners:function(e){return(e=t(this)[e])&&e.listeners.length>0}}}()),CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]),CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fire.call(this,e,t,this)},CKEDITOR.editor.prototype.fireOnce=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fireOnce.call(this,e,t,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype)),CKEDITOR.env||(CKEDITOR.env=function(){var e=navigator.userAgent.toLowerCase(),t={ie:e.indexOf("trident/")>-1,webkit:e.indexOf(" applewebkit/")>-1,air:e.indexOf(" adobeair/")>-1,mac:e.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode&&(!document.documentMode||document.documentMode<10),mobile:e.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(e),isCustomDomain:function(){if(!this.ie)return!1;var e=document.domain,t=window.location.hostname;return e!=t&&e!="["+t+"]"},secure:"https:"==location.protocol};t.gecko="Gecko"==navigator.product&&!t.webkit&&!t.ie,t.webkit&&(e.indexOf("chrome")>-1?t.chrome=!0:t.safari=!0);var i=0;if(t.ie&&(i=t.quirks||!document.documentMode?parseFloat(e.match(/msie (\d+)/)[1]):document.documentMode,t.ie9Compat=9==i,t.ie8Compat=8==i,t.ie7Compat=7==i,t.ie6Compat=i<7||t.quirks),t.gecko){var n=e.match(/rv:([\d\.]+)/);n&&(n=n[1].split("."),i=1e4*n[0]+100*(n[1]||0)+1*(n[2]||0))}return t.air&&(i=parseFloat(e.match(/ adobeair\/(\d+)/)[1])),t.webkit&&(i=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),t.version=i,t.isCompatible=t.iOS&&i>=534||!t.mobile&&(t.ie&&i>6||t.gecko&&i>=2e4||t.air&&i>=1||t.webkit&&i>=522||!1),t.hidpi=window.devicePixelRatio>=2,t.needsBrFiller=t.gecko||t.webkit||t.ie&&i>10,t.needsNbspFiller=t.ie&&i<11,t.cssClass="cke_browser_"+(t.ie?"ie":t.gecko?"gecko":t.webkit?"webkit":"unknown"),t.quirks&&(t.cssClass=t.cssClass+" cke_browser_quirks"),t.ie&&(t.cssClass=t.cssClass+(" cke_browser_ie"+(t.quirks?"6 cke_browser_iequirks":t.version))),t.air&&(t.cssClass=t.cssClass+" cke_browser_air"),t.iOS&&(t.cssClass=t.cssClass+" cke_browser_ios"),t.hidpi&&(t.cssClass=t.cssClass+" cke_hidpi"),t}()),"unloaded"==CKEDITOR.status&&function(){CKEDITOR.event.implementOn(CKEDITOR),CKEDITOR.loadFullCore=function(){if("basic_ready"!=CKEDITOR.status)CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var e=document.createElement("script");e.type="text/javascript",e.src=CKEDITOR.basePath+"ckeditor.js",document.getElementsByTagName("head")[0].appendChild(e)}},CKEDITOR.loadFullCoreTimeout=0,CKEDITOR.add=function(e){(this._.pending||(this._.pending=[])).push(e)},function(){CKEDITOR.domReady(function(){var e=CKEDITOR.loadFullCore,t=CKEDITOR.loadFullCoreTimeout;e&&(CKEDITOR.status="basic_ready",e&&e._load?e():t&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},1e3*t))})}(),CKEDITOR.status="basic_loaded"}(),CKEDITOR.dom={},function(){var e=[],t=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",i=/&/g,n=/>/g,r=/</g,o=/"/g,s=/&amp;/g,a=/&gt;/g,l=/&lt;/g,u=/&quot;/g;CKEDITOR.on("reset",function(){e=[]}),CKEDITOR.tools={arrayCompare:function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0},clone:function(e){var t;if(e&&e instanceof Array){t=[];for(var i=0;i<e.length;i++)t[i]=CKEDITOR.tools.clone(e[i]);return t}if(null===e||"object"!=typeof e||e instanceof String||e instanceof Number||e instanceof Boolean||e instanceof Date||e instanceof RegExp||e.nodeType||e.window===e)return e;t=new e.constructor;for(i in e)t[i]=CKEDITOR.tools.clone(e[i]);return t},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},extend:function(e){var t,i,n=arguments.length;"boolean"==typeof(t=arguments[n-1])?n--:"boolean"==typeof(t=arguments[n-2])&&(i=arguments[n-1],n-=2);for(var r=1;r<n;r++){var o,s=arguments[r];for(o in s)t!==!0&&null!=e[o]||(!i||o in i)&&(e[o]=s[o])}return e},prototypedCopy:function(e){var t=function(){};return t.prototype=e,new t},copy:function(e){var t,i={};for(t in e)i[t]=e[t];return i},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},cssVendorPrefix:function(e,i,n){return n?t+e+":"+i+";"+e+":"+i:(n={},n[e]=i,n[t+e]=i,n)},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t="undefined"!=typeof e.cssFloat?"cssFloat":"undefined"!=typeof e.styleFloat?"styleFloat":"float";return function(e){return"float"==e?t:e.replace(/-./g,function(e){return e.substr(1).toUpperCase()})}}(),buildStyleHtml:function(e){for(var t,e=[].concat(e),i=[],n=0;n<e.length;n++)(t=e[n])&&(/@import|[{}]/.test(t)?i.push("<style>"+t+"</style>"):i.push('<link type="text/css" rel=stylesheet href="'+t+'">'));return i.join("")},htmlEncode:function(e){return(""+e).replace(i,"&amp;").replace(n,"&gt;").replace(r,"&lt;")},htmlDecode:function(e){return e.replace(s,"&").replace(a,">").replace(l,"<")},htmlEncodeAttr:function(e){return e.replace(o,"&quot;").replace(r,"&lt;").replace(n,"&gt;")},htmlDecodeAttr:function(e){return e.replace(u,'"').replace(l,"<").replace(a,">")},getNextNumber:function(){var e=0;return function(){return++e}}(),getNextId:function(){return"cke_"+this.getNextNumber()},override:function(e,t){var i=t(e);return i.prototype=e.prototype,i},setTimeout:function(e,t,i,n,r){return r||(r=window),i||(i=r),r.setTimeout(function(){n?e.apply(i,[].concat(n)):e.apply(i)},t||0)},trim:function(){var e=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(t){return t.replace(e,"")}}(),ltrim:function(){var e=/^[ \t\n\r]+/g;return function(t){return t.replace(e,"")}}(),rtrim:function(){var e=/[ \t\n\r]+$/g;return function(t){return t.replace(e,"")}}(),indexOf:function(e,t){if("function"==typeof t){for(var i=0,n=e.length;i<n;i++)if(t(e[i]))return i}else{if(e.indexOf)return e.indexOf(t);for(i=0,n=e.length;i<n;i++)if(e[i]===t)return i}return-1},search:function(e,t){var i=CKEDITOR.tools.indexOf(e,t);return i>=0?e[i]:null},bind:function(e,t){return function(){return e.apply(t,arguments)}},createClass:function(e){var t=e.$,i=e.base,n=e.privates||e._,r=e.proto,e=e.statics;if(!t&&(t=function(){i&&this.base.apply(this,arguments)}),n)var o=t,t=function(){var e,t=this._||(this._={});for(e in n){var i=n[e];t[e]="function"==typeof i?CKEDITOR.tools.bind(i,this):i}o.apply(this,arguments)};return i&&(t.prototype=this.prototypedCopy(i.prototype),t.prototype.constructor=t,t.base=i,t.baseProto=i.prototype,t.prototype.base=function(){this.base=i.prototype.base,i.apply(this,arguments),this.base=arguments.callee}),r&&this.extend(t.prototype,r,!0),e&&this.extend(t,e,!0),t},addFunction:function(t,i){return e.push(function(){return t.apply(i||this,arguments)})-1},removeFunction:function(t){e[t]=null},callFunction:function(t){var i=e[t];return i&&i.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var e,t=/^-?\d+\.?\d*px$/;return function(i){return e=CKEDITOR.tools.trim(i+"")+"px",t.test(e)?e:i||""}}(),convertToPx:function(){var e;return function(t){return e||(e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document),CKEDITOR.document.getBody().append(e)),/%$/.test(t)?t:(e.setStyle("width",t),e.$.clientWidth)}}(),repeat:function(e,t){return Array(t+1).join(e)},tryThese:function(){for(var e,t=0,i=arguments.length;t<i;t++){var n=arguments[t];try{e=n();break}catch(r){}}return e},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(e){return function(){var t=arguments,i=this;window.setTimeout(function(){e.apply(i,t)},0)}},normalizeCssText:function(e,t){var i,n=[],r=CKEDITOR.tools.parseCssText(e,!0,t);for(i in r)n.push(i+":"+r[i]);return n.sort(),n.length?n.join(";")+";":""},convertRgbToHex:function(e){return e.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(e,t,i,n){for(e=[t,i,n],t=0;t<3;t++)e[t]=("0"+parseInt(e[t],10).toString(16)).slice(-2);return"#"+e.join("")})},parseCssText:function(e,t,i){var n={};return i&&(i=new CKEDITOR.dom.element("span"),i.setAttribute("style",e),e=CKEDITOR.tools.convertRgbToHex(i.getAttribute("style")||"")),e&&";"!=e?(e.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,i,r){t&&(i=i.toLowerCase(),"font-family"==i&&(r=r.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,",")),r=CKEDITOR.tools.trim(r)),n[i]=r}),n):n},writeCssText:function(e,t){var i,n=[];for(i in e)n.push(i+":"+e[i]);return t&&n.sort(),n.join("; ")},objectCompare:function(e,t,i){var n;if(!e&&!t)return!0;if(!e||!t)return!1;for(n in e)if(e[n]!=t[n])return!1;if(!i)for(n in t)if(e[n]!=t[n])return!1;return!0},objectKeys:function(e){var t,i=[];for(t in e)i.push(t);return i},convertArrayToObject:function(e,t){var i={};1==arguments.length&&(t=!0);for(var n=0,r=e.length;n<r;++n)i[e[n]]=t;return i},fixDomain:function(){for(var e;;)try{e=window.parent.document.domain;break}catch(t){if(e=e?e.replace(/.+?(?:\.|$)/,""):document.domain,!e)break;document.domain=e}return!!e},eventsBuffer:function(e,t){function i(){r=(new Date).getTime(),n=!1,t()}var n,r=0;return{input:function(){if(!n){var t=(new Date).getTime()-r;t<e?n=setTimeout(i,e-t):i()}},reset:function(){n&&clearTimeout(n),n=r=0}}},enableHtml5Elements:function(e,t){for(var i,n=["abbr","article","aside","audio","bdi","canvas","data","datalist","details","figcaption","figure","footer","header","hgroup","mark","meter","nav","output","progress","section","summary","time","video"],r=n.length;r--;)i=e.createElement(n[r]),t&&e.appendChild(i)},checkIfAnyArrayItemMatches:function(e,t){for(var i=0,n=e.length;i<n;++i)if(e[i].match(t))return!0;return!1},checkIfAnyObjectPropertyMatches:function(e,t){for(var i in e)if(i.match(t))return!0;return!1},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="}}(),CKEDITOR.dtd=function(){var e=CKEDITOR.tools.extend,t=function(e,t){for(var i=CKEDITOR.tools.clone(e),n=1;n<arguments.length;n++){var r,t=arguments[n];for(r in t)delete i[r]}return i},i={},n={},r={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},o={command:1,link:1,meta:1,noscript:1,script:1,style:1},s={},a={"#":1},l={center:1,dir:1,noframes:1};return e(i,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},a,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),e(n,r,i,l),t={a:t(i,{a:1,button:1}),abbr:i,address:n,area:s,article:n,aside:n,audio:e({source:1,track:1},n),b:i,base:s,bdi:i,bdo:i,blockquote:n,body:n,br:s,button:t(i,{a:1,button:1}),canvas:i,caption:n,cite:i,code:i,col:s,colgroup:{col:1},command:s,datalist:e({option:1},i),dd:n,del:i,details:e({summary:1},n),dfn:i,div:n,dl:{dt:1,dd:1},dt:n,em:i,embed:s,fieldset:e({legend:1},n),figcaption:n,figure:e({figcaption:1},n),footer:n,form:n,h1:i,h2:i,h3:i,h4:i,h5:i,h6:i,head:e({title:1,base:1},o),header:n,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:s,html:e({head:1,body:1},n,o),i:i,iframe:a,img:s,input:s,ins:i,kbd:i,keygen:s,label:i,legend:i,li:n,link:s,main:n,map:n,mark:i,menu:e({li:1},n),meta:s,meter:t(i,{meter:1}),nav:n,noscript:e({link:1,meta:1,style:1},i),object:e({param:1},i),ol:{li:1},optgroup:{option:1},option:a,output:i,p:i,param:s,pre:i,progress:t(i,{progress:1}),q:i,rp:i,rt:i,ruby:e({rp:1,rt:1},i),s:i,samp:i,script:a,section:n,select:{optgroup:1,option:1},small:i,source:s,span:i,strong:i,style:a,sub:i,summary:i,sup:i,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:n,textarea:a,tfoot:{tr:1},th:n,thead:{tr:1},time:t(i,{time:1}),title:a,tr:{th:1,td:1},track:s,u:i,ul:{li:1},"var":i,video:e({source:1,track:1},n),wbr:s,acronym:i,applet:e({param:1},n),basefont:s,big:i,center:n,dialog:s,dir:{li:1},font:i,isindex:s,noframes:n,strike:i,tt:i},e(t,{$block:e({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},r,l),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,main:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:i,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:e({body:1,head:1,html:1},t.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),t}(),CKEDITOR.dom.event=function(e){this.$=e},CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var e=this.getKey();return(this.$.ctrlKey||this.$.metaKey)&&(e+=CKEDITOR.CTRL),this.$.shiftKey&&(e+=CKEDITOR.SHIFT),this.$.altKey&&(e+=CKEDITOR.ALT),e},preventDefault:function(e){var t=this.$;t.preventDefault?t.preventDefault():t.returnValue=!1,e&&this.stopPropagation()},stopPropagation:function(){var e=this.$;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getTarget:function(){var e=this.$.target||this.$.srcElement;return e?new CKEDITOR.dom.node(e):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var e=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(e.documentElement.scrollLeft||e.body.scrollLeft),y:this.$.pageY||this.$.clientY+(e.documentElement.scrollTop||e.body.scrollTop)}}},CKEDITOR.CTRL=1114112,CKEDITOR.SHIFT=2228224,CKEDITOR.ALT=4456448,CKEDITOR.EVENT_PHASE_CAPTURING=1,CKEDITOR.EVENT_PHASE_AT_TARGET=2,CKEDITOR.EVENT_PHASE_BUBBLING=3,CKEDITOR.dom.domObject=function(e){e&&(this.$=e)},CKEDITOR.dom.domObject.prototype=function(){var e=function(e,t){return function(i){"undefined"!=typeof CKEDITOR&&e.fire(t,new CKEDITOR.dom.event(i))}};return{getPrivate:function(){var e;return(e=this.getCustomData("_"))||this.setCustomData("_",e={}),e},on:function(t){var i=this.getCustomData("_cke_nativeListeners");return i||(i={},this.setCustomData("_cke_nativeListeners",i)),i[t]||(i=i[t]=e(this,t),this.$.addEventListener?this.$.addEventListener(t,i,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+t,i)),CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(e){if(CKEDITOR.event.prototype.removeListener.apply(this,arguments),!this.hasListeners(e)){var t=this.getCustomData("_cke_nativeListeners"),i=t&&t[e];i&&(this.$.removeEventListener?this.$.removeEventListener(e,i,!1):this.$.detachEvent&&this.$.detachEvent("on"+e,i),delete t[e])}},removeAllListeners:function(){var e,t=this.getCustomData("_cke_nativeListeners");for(e in t){var i=t[e];this.$.detachEvent?this.$.detachEvent("on"+e,i):this.$.removeEventListener&&this.$.removeEventListener(e,i,!1),delete t[e]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}(),function(e){var t={};CKEDITOR.on("reset",function(){t={}}),e.equals=function(e){try{return e&&e.$===this.$}catch(t){return!1}},e.setCustomData=function(e,i){var n=this.getUniqueId();return(t[n]||(t[n]={}))[e]=i,this},e.getCustomData=function(e){var i=this.$["data-cke-expando"];return(i=i&&t[i])&&e in i?i[e]:null},e.removeCustomData=function(e){var i,n,r=this.$["data-cke-expando"],r=r&&t[r];return r&&(i=r[e],n=e in r,delete r[e]),n?i:null},e.clearCustomData=function(){this.removeAllListeners();var e=this.$["data-cke-expando"];e&&delete t[e]},e.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())},CKEDITOR.event.implementOn(e)}(CKEDITOR.dom.domObject.prototype),CKEDITOR.dom.node=function(e){return e?new CKEDITOR.dom[e.nodeType==CKEDITOR.NODE_DOCUMENT?"document":e.nodeType==CKEDITOR.NODE_ELEMENT?"element":e.nodeType==CKEDITOR.NODE_TEXT?"text":e.nodeType==CKEDITOR.NODE_COMMENT?"comment":e.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](e):this},CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject,CKEDITOR.NODE_ELEMENT=1,CKEDITOR.NODE_DOCUMENT=9,CKEDITOR.NODE_TEXT=3,CKEDITOR.NODE_COMMENT=8,CKEDITOR.NODE_DOCUMENT_FRAGMENT=11,CKEDITOR.POSITION_IDENTICAL=0,CKEDITOR.POSITION_DISCONNECTED=1,CKEDITOR.POSITION_FOLLOWING=2,CKEDITOR.POSITION_PRECEDING=4,CKEDITOR.POSITION_IS_CONTAINED=8,CKEDITOR.POSITION_CONTAINS=16,CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(e,t){return e.append(this,t),e},clone:function(e,t){var i=this.$.cloneNode(e),n=function(i){if(i["data-cke-expando"]&&(i["data-cke-expando"]=!1),i.nodeType==CKEDITOR.NODE_ELEMENT&&(t||i.removeAttribute("id",!1),e))for(var i=i.childNodes,r=0;r<i.length;r++)n(i[r])};return n(i),new CKEDITOR.dom.node(i)},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(e){return e.$.parentNode.insertBefore(this.$,e.$.nextSibling),e},insertBefore:function(e){return e.$.parentNode.insertBefore(this.$,e.$),e},insertBeforeMe:function(e){return this.$.parentNode.insertBefore(e.$,this.$),e},getAddress:function(e){for(var t=[],i=this.getDocument().$.documentElement,n=this.$;n&&n!=i;){var r=n.parentNode;r&&t.unshift(this.getIndex.call({$:n},e)),n=r}return t},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(e){function t(e,i){var n=i?e.nextSibling:e.previousSibling;return n&&n.nodeType==CKEDITOR.NODE_TEXT?n.nodeValue?n:t(n,i):null}var i,n=this.$,r=-1;if(!this.$.parentNode||e&&n.nodeType==CKEDITOR.NODE_TEXT&&!n.nodeValue&&!t(n)&&!t(n,!0))return-1;do(!e||n==this.$||n.nodeType!=CKEDITOR.NODE_TEXT||!i&&n.nodeValue)&&(r++,i=n.nodeType==CKEDITOR.NODE_TEXT);while(n=n.previousSibling);return r},getNextSourceNode:function(e,t,i){if(i&&!i.call)var n=i,i=function(e){return!e.equals(n)};var r,e=!e&&this.getFirst&&this.getFirst();if(!e){if(this.type==CKEDITOR.NODE_ELEMENT&&i&&i(this,!0)===!1)return null;e=this.getNext()}for(;!e&&(r=(r||this).getParent());){if(i&&i(r,!0)===!1)return null;e=r.getNext()}return!e||i&&i(e)===!1?null:t&&t!=e.type?e.getNextSourceNode(!1,t,i):e},getPreviousSourceNode:function(e,t,i){if(i&&!i.call)var n=i,i=function(e){return!e.equals(n)};var r,e=!e&&this.getLast&&this.getLast();if(!e){if(this.type==CKEDITOR.NODE_ELEMENT&&i&&i(this,!0)===!1)return null;e=this.getPrevious()}for(;!e&&(r=(r||this).getParent());){if(i&&i(r,!0)===!1)return null;e=r.getPrevious()}return!e||i&&i(e)===!1?null:t&&e.type!=t?e.getPreviousSourceNode(!1,t,i):e},getPrevious:function(e){var t,i=this.$;do t=(i=i.previousSibling)&&10!=i.nodeType&&new CKEDITOR.dom.node(i);while(t&&e&&!e(t));return t},getNext:function(e){var t,i=this.$;do t=(i=i.nextSibling)&&new CKEDITOR.dom.node(i);while(t&&e&&!e(t));return t},getParent:function(e){var t=this.$.parentNode;return t&&(t.nodeType==CKEDITOR.NODE_ELEMENT||e&&t.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(t):null},getParents:function(e){var t=this,i=[];do i[e?"push":"unshift"](t);while(t=t.getParent());return i},getCommonAncestor:function(e){if(e.equals(this))return this;if(e.contains&&e.contains(this))return e;var t=this.contains?this:this.getParent();do if(t.contains(e))return t;while(t=t.getParent());return null},getPosition:function(e){var t=this.$,i=e.$;if(t.compareDocumentPosition)return t.compareDocumentPosition(i);if(t==i)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&e.type==CKEDITOR.NODE_ELEMENT){if(t.contains){if(t.contains(i))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(i.contains(t))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in t)return t.sourceIndex<0||i.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:t.sourceIndex<i.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var t=this.getAddress(),e=e.getAddress(),i=Math.min(t.length,e.length),n=0;n<=i-1;n++)if(t[n]!=e[n]){if(n<i)return t[n]<e[n]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;break}return t.length<e.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(e,t){var i,n,r=this.$;t||(r=r.parentNode),"function"==typeof e?(n=!0,i=e):(n=!1,i=function(t){return t="string"==typeof t.nodeName?t.nodeName.toLowerCase():"","string"==typeof e?t==e:t in e});for(;r;){if(i(n?new CKEDITOR.dom.node(r):r))return new CKEDITOR.dom.node(r);try{r=r.parentNode}catch(o){r=null}}return null},hasAscendant:function(e,t){var i=this.$;for(t||(i=i.parentNode);i;){if(i.nodeName&&i.nodeName.toLowerCase()==e)return!0;i=i.parentNode}return!1},move:function(e,t){e.append(this.remove(),t)},remove:function(e){var t=this.$,i=t.parentNode;if(i){if(e)for(;e=t.firstChild;)i.insertBefore(t.removeChild(e),t);i.removeChild(t)}return this},replace:function(e){this.insertBefore(e),e.remove()},trim:function(){this.ltrim(),this.rtrim()},ltrim:function(){for(var e;this.getFirst&&(e=this.getFirst());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.ltrim(e.getText()),i=e.getLength();if(!t){e.remove();continue}t.length<i&&(e.split(i-t.length),this.$.removeChild(this.$.firstChild))}break}},rtrim:function(){for(var e;this.getLast&&(e=this.getLast());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.rtrim(e.getText()),i=e.getLength();if(!t){e.remove();continue}t.length<i&&(e.split(t.length),this.$.lastChild.parentNode.removeChild(this.$.lastChild))}break}CKEDITOR.env.needsBrFiller&&(e=this.$.lastChild)&&1==e.type&&"br"==e.nodeName.toLowerCase()&&e.parentNode.removeChild(e)},isReadOnly:function(){var e=this;if(this.type!=CKEDITOR.NODE_ELEMENT&&(e=this.getParent()),e&&"undefined"!=typeof e.$.isContentEditable)return!(e.$.isContentEditable||e.data("cke-editable"));for(;e&&!e.data("cke-editable");){if("false"==e.getAttribute("contentEditable"))return!0;if("true"==e.getAttribute("contentEditable"))break;e=e.getParent()}return!e}}),CKEDITOR.dom.window=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var e=this.$.document,t="CSS1Compat"==e.compatMode;return{width:(t?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(t?e.documentElement.clientHeight:e.body.clientHeight)||0}},getScrollPosition:function(){var e=this.$;return"pageXOffset"in e?{x:e.pageXOffset||0,y:e.pageYOffset||0}:(e=e.document,{x:e.documentElement.scrollLeft||e.body.scrollLeft||0,y:e.documentElement.scrollTop||e.body.scrollTop||0})},getFrame:function(){var e=this.$.frameElement;return e?new CKEDITOR.dom.element.get(e):null}}),CKEDITOR.dom.document=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(e){if(this.$.createStyleSheet)this.$.createStyleSheet(e);else{var t=new CKEDITOR.dom.element("link");t.setAttributes({rel:"stylesheet",type:"text/css",href:e}),this.getHead().append(t)}},appendStyleText:function(e){if(this.$.createStyleSheet){var t=this.$.createStyleSheet("");t.cssText=e}else{var i=new CKEDITOR.dom.element("style",this);i.append(new CKEDITOR.dom.text(e,this)),this.getHead().append(i)}return t||i.$.sheet},createElement:function(e,t){var i=new CKEDITOR.dom.element(e,this);return t&&(t.attributes&&i.setAttributes(t.attributes),t.styles&&i.setStyles(t.styles)),i;
},createText:function(e){return new CKEDITOR.dom.text(e,this)},focus:function(){this.getWindow().focus()},getActive:function(){var e;try{e=this.$.activeElement}catch(t){return null}return new CKEDITOR.dom.element(e)},getById:function(e){return(e=this.$.getElementById(e))?new CKEDITOR.dom.element(e):null},getByAddress:function(e,t){for(var i=this.$.documentElement,n=0;i&&n<e.length;n++){var r=e[n];if(t)for(var o=-1,s=0;s<i.childNodes.length;s++){var a=i.childNodes[s];if((t!==!0||3!=a.nodeType||!a.previousSibling||3!=a.previousSibling.nodeType)&&(o++,o==r)){i=a;break}}else i=i.childNodes[r]}return i?new CKEDITOR.dom.node(i):null},getElementsByTag:function(e,t){return!(CKEDITOR.env.ie&&document.documentMode<=8)&&t&&(e=t+":"+e),new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(e))},getHead:function(){var e=this.$.getElementsByTagName("head")[0];return e=e?new CKEDITOR.dom.element(e):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),!0)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(e){this.$.open("text/html","replace"),CKEDITOR.env.ie&&(e=e.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+")();</script>")),this.$.write(e),this.$.close()},find:function(e){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(e))},findOne:function(e){return(e=this.$.querySelector(e))?new CKEDITOR.dom.element(e):null},_getHtml5ShivFrag:function(){var e=this.getCustomData("html5ShivFrag");return e||(e=this.$.createDocumentFragment(),CKEDITOR.tools.enableHtml5Elements(e,!0),this.setCustomData("html5ShivFrag",e)),e}}),CKEDITOR.dom.nodeList=function(e){this.$=e},CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(e){return e<0||e>=this.$.length?null:(e=this.$[e])?new CKEDITOR.dom.node(e):null}},CKEDITOR.dom.element=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createElement(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.element.get=function(e){return(e="string"==typeof e?document.getElementById(e)||document.getElementsByName(e)[0]:e)&&(e.$?e:new CKEDITOR.dom.element(e))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(e,t){var i=new CKEDITOR.dom.element("div",t);return i.setHtml(e),i.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(e,t,i,n){var r=t.getCustomData("list_marker_id")||t.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),o=t.getCustomData("list_marker_names")||t.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return e[r]=t,o[i]=1,t.setCustomData(i,n)},CKEDITOR.dom.element.clearAllMarkers=function(e){for(var t in e)CKEDITOR.dom.element.clearMarkers(e,e[t],1)},CKEDITOR.dom.element.clearMarkers=function(e,t,i){var n,r=t.getCustomData("list_marker_names"),o=t.getCustomData("list_marker_id");for(n in r)t.removeCustomData(n);t.removeCustomData("list_marker_names"),i&&(t.removeCustomData("list_marker_id"),delete e[o])},function(){function e(e){var t=!0;return e.$.id||(e.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber(),t=!1),function(){t||e.removeAttribute("id")}}function t(e,t){return"#"+e.$.id+" "+t.split(/,\s*/).join(", #"+e.$.id+" ")}function i(e){for(var t=0,i=0,r=n[e].length;i<r;i++)t+=parseInt(this.getComputedStyle(n[e][i])||0,10)||0;return t}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(e){var t=this.$.className;return t&&(RegExp("(?:^|\\s)"+e+"(?:\\s|$)","").test(t)||(t+=" "+e)),this.$.className=t||e,this},removeClass:function(e){var t=this.getAttribute("class");return t&&(e=RegExp("(?:^|\\s+)"+e+"(?=\\s|$)","i"),e.test(t)&&((t=t.replace(e,"").replace(/^\s+/,""))?this.setAttribute("class",t):this.removeAttribute("class"))),this},hasClass:function(e){return RegExp("(?:^|\\s+)"+e+"(?=\\s|$)","").test(this.getAttribute("class"))},append:function(e,t){return"string"==typeof e&&(e=this.getDocument().createElement(e)),t?this.$.insertBefore(e.$,this.$.firstChild):this.$.appendChild(e.$),e},appendHtml:function(e){if(this.$.childNodes.length){var t=new CKEDITOR.dom.element("div",this.getDocument());t.setHtml(e),t.moveChildren(this)}else this.setHtml(e)},appendText:function(e){null!=this.$.text&&CKEDITOR.env.ie&&CKEDITOR.env.version<9?this.$.text=this.$.text+e:this.append(new CKEDITOR.dom.text(e))},appendBogus:function(e){if(e||CKEDITOR.env.needsBrFiller){for(e=this.getLast();e&&e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(e.getText());)e=e.getPrevious();e&&e.is&&e.is("br")||(e=this.getDocument().createElement("br"),CKEDITOR.env.gecko&&e.setAttribute("type","_moz"),this.append(e))}},breakParent:function(e){var t=new CKEDITOR.dom.range(this.getDocument());t.setStartAfter(this),t.setEndAfter(e),e=t.extractContents(),t.insertNode(this.remove()),e.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(e){var t=this.$;return e.type!=CKEDITOR.NODE_ELEMENT?t.contains(e.getParent().$):t!=e.$&&t.contains(e.$)}:function(e){return!!(16&this.$.compareDocumentPosition(e.$))},focus:function(){function e(){try{this.$.focus()}catch(e){}}return function(t){t?CKEDITOR.tools.setTimeout(e,100,this):e.call(this)}}(),getHtml:function(){var e=this.$.innerHTML;return CKEDITOR.env.ie?e.replace(/<\?[^>]*>/g,""):e},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var e=this.$.ownerDocument.createElement("div");return e.appendChild(this.$.cloneNode(!0)),e.innerHTML},getClientRect:function(){var e=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());return!e.width&&(e.width=e.right-e.left),!e.height&&(e.height=e.bottom-e.top),e},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(e){try{var t=this.$;if(this.getParent())return t.innerHTML=e;var i=this.getDocument()._getHtml5ShivFrag();return i.appendChild(t),t.innerHTML=e,i.removeChild(t),e}catch(n){for(this.$.innerHTML="",t=new CKEDITOR.dom.element("body",this.getDocument()),t.$.innerHTML=e,t=t.getChildren();t.count();)this.append(t.getItem(0));return e}}:function(e){return this.$.innerHTML=e},setText:function(){var e=document.createElement("p");return e.innerHTML="x",e=e.textContent,function(t){this.$[e?"textContent":"innerText"]=t}}(),getAttribute:function(){var e=function(e){return this.$.getAttribute(e,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){switch(e){case"class":e="className";break;case"http-equiv":e="httpEquiv";break;case"name":return this.$.name;case"tabindex":return e=this.$.getAttribute(e,2),0!==e&&0===this.$.tabIndex&&(e=null),e;case"checked":return e=this.$.attributes.getNamedItem(e),(e.specified?e.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[e];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(e,2)}:e}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(e){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(e)]}:function(e){var t=this.getWindow().$.getComputedStyle(this.$,null);return t?t.getPropertyValue(e):""},getDtd:function(){var e=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return e},e},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var e=this.$.tabIndex;return 0===e&&!CKEDITOR.dtd.$tabIndex[this.getName()]&&0!==parseInt(this.getAttribute("tabindex"),10)&&(e=-1),e}:CKEDITOR.env.webkit?function(){var e=this.$.tabIndex;return void 0===e&&(e=parseInt(this.getAttribute("tabindex"),10),isNaN(e)&&(e=-1)),e}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var e=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&document.documentMode<=8){var t=this.$.scopeName;"HTML"!=t&&(e=t.toLowerCase()+":"+e)}return this.getName=function(){return e},this.getName()},getValue:function(){return this.$.value},getFirst:function(e){var t=this.$.firstChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getNext(e)),t},getLast:function(e){var t=this.$.lastChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getPrevious(e)),t},getStyle:function(e){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]},is:function(){var e=this.getName();if("object"==typeof arguments[0])return!!arguments[0][e];for(var t=0;t<arguments.length;t++)if(arguments[t]==e)return!0;return!1},isEditable:function(e){var t=this.getName();return!(this.isReadOnly()||"none"==this.getComputedStyle("display")||"hidden"==this.getComputedStyle("visibility")||CKEDITOR.dtd.$nonEditable[t]||CKEDITOR.dtd.$empty[t]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount())&&(e===!1||(e=CKEDITOR.dtd[t]||CKEDITOR.dtd.span,!(!e||!e["#"])))},isIdentical:function(e){var t=this.clone(0,1),e=e.clone(0,1);if(t.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),e.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),t.$.isEqualNode)return t.$.style.cssText=CKEDITOR.tools.normalizeCssText(t.$.style.cssText),e.$.style.cssText=CKEDITOR.tools.normalizeCssText(e.$.style.cssText),t.$.isEqualNode(e.$);if(t=t.getOuterHtml(),e=e.getOuterHtml(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var i=this.getParent();i.type==CKEDITOR.NODE_ELEMENT&&(i=i.clone(),i.setHtml(t),t=i.getHtml(),i.setHtml(e),e=i.getHtml())}return t==e},isVisible:function(){var e,t,i=(this.$.offsetHeight||this.$.offsetWidth)&&"hidden"!=this.getComputedStyle("visibility");return i&&CKEDITOR.env.webkit&&(e=this.getWindow(),!e.equals(CKEDITOR.document.getWindow())&&(t=e.$.frameElement)&&(i=new CKEDITOR.dom.element(t).isVisible())),!!i},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;for(var e=this.getChildren(),t=0,i=e.count();t<i;t++){var n=e.getItem(t);if((n.type!=CKEDITOR.NODE_ELEMENT||!n.data("cke-bookmark"))&&(n.type==CKEDITOR.NODE_ELEMENT&&!n.isEmptyInlineRemoveable()||n.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(n.getText())))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var e=this.$.attributes,t=0;t<e.length;t++){var i=e[t];switch(i.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(i.specified)return!0}}return!1}:function(){var e=this.$.attributes,t=e.length,i={"data-cke-expando":1,_moz_dirty:1};return t>0&&(t>2||!i[e[0].nodeName]||2==t&&!i[e[1].nodeName])},hasAttribute:function(){function e(e){var t=this.$.attributes.getNamedItem(e);if("input"==this.getName())switch(e){case"class":return this.$.className.length>0;case"checked":return!!this.$.checked;case"value":return e=this.getAttribute("type"),"checkbox"==e||"radio"==e?"on"!=this.$.value:!!this.$.value}return!!t&&t.specified}return CKEDITOR.env.ie?CKEDITOR.env.version<8?function(t){return"name"==t?!!this.$.name:e.call(this,t)}:e:function(e){return!!this.$.attributes.getNamedItem(e)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(e,t){var i=this.$,e=e.$;if(i!=e){var n;if(t)for(;n=i.lastChild;)e.insertBefore(i.removeChild(n),e.firstChild);else for(;n=i.firstChild;)e.appendChild(i.removeChild(n))}},mergeSiblings:function(){function e(e,t,i){if(t&&t.type==CKEDITOR.NODE_ELEMENT){for(var n=[];t.data("cke-bookmark")||t.isEmptyInlineRemoveable();)if(n.push(t),t=i?t.getNext():t.getPrevious(),!t||t.type!=CKEDITOR.NODE_ELEMENT)return;if(e.isIdentical(t)){for(var r=i?e.getLast():e.getFirst();n.length;)n.shift().move(e,!i);t.moveChildren(e,!i),t.remove(),r&&r.type==CKEDITOR.NODE_ELEMENT&&r.mergeSiblings()}}}return function(t){(t===!1||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a"))&&(e(this,this.getNext(),!0),e(this,this.getPrevious()))}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var e=function(e,t){return this.$.setAttribute(e,t),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(t,i){return"class"==t?this.$.className=i:"style"==t?this.$.style.cssText=i:"tabindex"==t?this.$.tabIndex=i:"checked"==t?this.$.checked=i:"contenteditable"==t?e.call(this,"contentEditable",i):e.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(t,i){if("src"==t&&i.match(/^http:\/\//))try{e.apply(this,arguments)}catch(n){}else e.apply(this,arguments);return this}:e}(),setAttributes:function(e){for(var t in e)this.setAttribute(t,e[t]);return this},setValue:function(e){return this.$.value=e,this},removeAttribute:function(){var e=function(e){this.$.removeAttribute(e)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){"class"==e?e="className":"tabindex"==e?e="tabIndex":"contenteditable"==e&&(e="contentEditable"),this.$.removeAttribute(e)}:e}(),removeAttributes:function(e){if(CKEDITOR.tools.isArray(e))for(var t=0;t<e.length;t++)this.removeAttribute(e[t]);else for(t in e)e.hasOwnProperty(t)&&this.removeAttribute(t)},removeStyle:function(e){var t=this.$.style;if(t.removeProperty||"border"!=e&&"margin"!=e&&"padding"!=e)t.removeProperty?t.removeProperty(e):t.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(e)),this.$.style.cssText||this.removeAttribute("style");else{var i,n=["top","left","right","bottom"];"border"==e&&(i=["color","style","width"]);for(var t=[],r=0;r<n.length;r++)if(i)for(var o=0;o<i.length;o++)t.push([e,n[r],i[o]].join("-"));else t.push([e,n[r]].join("-"));for(e=0;e<t.length;e++)this.removeStyle(t[e])}},setStyle:function(e,t){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]=t,this},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},setOpacity:function(e){CKEDITOR.env.ie&&CKEDITOR.env.version<9?(e=Math.round(100*e),this.setStyle("filter",e>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")")):this.setStyle("opacity",e)},unselectable:function(){if(this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none")),CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var e,t=this.getElementsByTag("*"),i=0,n=t.count();i<n;i++)e=t.getItem(i),e.setAttribute("unselectable","on")}},getPositionedAncestor:function(){for(var e=this;"html"!=e.getName();){if("static"!=e.getComputedStyle("position"))return e;e=e.getParent()}return null},getDocumentPosition:function(e){var t=0,i=0,n=this.getDocument(),r=n.getBody(),o="BackCompat"==n.$.compatMode;if(document.documentElement.getBoundingClientRect){var s=this.$.getBoundingClientRect(),a=n.$.documentElement,l=a.clientTop||r.$.clientTop||0,u=a.clientLeft||r.$.clientLeft||0,c=!0;CKEDITOR.env.ie&&(c=n.getDocumentElement().contains(this),n=n.getBody().contains(this),c=o&&n||!o&&c),c&&(CKEDITOR.env.webkit?(t=r.$.scrollLeft||a.scrollLeft,i=r.$.scrollTop||a.scrollTop):(i=o?r.$:a,t=i.scrollLeft,i=i.scrollTop),t=s.left+t-u,i=s.top+i-l)}else for(l=this,u=null;l&&"body"!=l.getName()&&"html"!=l.getName();){for(t+=l.$.offsetLeft-l.$.scrollLeft,i+=l.$.offsetTop-l.$.scrollTop,l.equals(this)||(t+=l.$.clientLeft||0,i+=l.$.clientTop||0);u&&!u.equals(l);)t-=u.$.scrollLeft,i-=u.$.scrollTop,u=u.getParent();u=l,l=(s=l.$.offsetParent)?new CKEDITOR.dom.element(s):null}return e&&(s=this.getWindow(),l=e.getWindow(),!s.equals(l)&&s.$.frameElement&&(e=new CKEDITOR.dom.element(s.$.frameElement).getDocumentPosition(e),t+=e.x,i+=e.y)),document.documentElement.getBoundingClientRect||!CKEDITOR.env.gecko||o||(t+=this.$.clientLeft?1:0,i+=this.$.clientTop?1:0),{x:t,y:i}},scrollIntoView:function(e){var t=this.getParent();if(t)do if((t.$.clientWidth&&t.$.clientWidth<t.$.scrollWidth||t.$.clientHeight&&t.$.clientHeight<t.$.scrollHeight)&&!t.is("body")&&this.scrollIntoParent(t,e,1),t.is("html")){var i=t.getWindow();try{var n=i.$.frameElement;n&&(t=new CKEDITOR.dom.element(n))}catch(r){}}while(t=t.getParent())},scrollIntoParent:function(e,t,i){function n(t,i){/body|html/.test(e.getName())?e.getWindow().$.scrollBy(t,i):(e.$.scrollLeft=e.$.scrollLeft+t,e.$.scrollTop=e.$.scrollTop+i)}function r(e,t){var i={x:0,y:0};if(!e.is(c?"body":"html")){var n=e.$.getBoundingClientRect();i.x=n.left,i.y=n.top}return n=e.getWindow(),n.equals(t)||(n=r(CKEDITOR.dom.element.get(n.$.frameElement),t),i.x=i.x+n.x,i.y=i.y+n.y),i}function o(e,t){return parseInt(e.getComputedStyle("margin-"+t)||0,10)||0}var s,a,l,u;!e&&(e=this.getWindow()),l=e.getDocument();var c="BackCompat"==l.$.compatMode;e instanceof CKEDITOR.dom.window&&(e=c?l.getBody():l.getDocumentElement()),l=e.getWindow(),a=r(this,l);var h=r(e,l),d=this.$.offsetHeight;s=this.$.offsetWidth;var p=e.$.clientHeight,f=e.$.clientWidth;l=a.x-o(this,"left")-h.x||0,u=a.y-o(this,"top")-h.y||0,s=a.x+s+o(this,"right")-(h.x+f)||0,a=a.y+d+o(this,"bottom")-(h.y+p)||0,(u<0||a>0)&&n(0,t===!0?u:t===!1?a:u<0?u:a),i&&(l<0||s>0)&&n(l<0?l:s,0)},setState:function(e,t,i){switch(t=t||"cke",e){case CKEDITOR.TRISTATE_ON:this.addClass(t+"_on"),this.removeClass(t+"_off"),this.removeClass(t+"_disabled"),i&&this.setAttribute("aria-pressed",!0),i&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(t+"_disabled"),this.removeClass(t+"_off"),this.removeClass(t+"_on"),i&&this.setAttribute("aria-disabled",!0),i&&this.removeAttribute("aria-pressed");break;default:this.addClass(t+"_off"),this.removeClass(t+"_on"),this.removeClass(t+"_disabled"),i&&this.removeAttribute("aria-pressed"),i&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var e=this.$;try{e.contentWindow.document}catch(t){e.src=e.src}return e&&new CKEDITOR.dom.document(e.contentWindow.document)},copyAttributes:function(e,t){for(var i=this.$.attributes,t=t||{},n=0;n<i.length;n++){var r,o=i[n],s=o.nodeName.toLowerCase();s in t||("checked"==s&&(r=this.getAttribute(s))?e.setAttribute(s,r):CKEDITOR.env.ie&&!this.hasAttribute(s)||(r=this.getAttribute(s),null===r&&(r=o.nodeValue),e.setAttribute(s,r)))}""!==this.$.style.cssText&&(e.$.style.cssText=this.$.style.cssText)},renameNode:function(e){if(this.getName()!=e){var t=this.getDocument(),e=new CKEDITOR.dom.element(e,t);this.copyAttributes(e),this.moveChildren(e),this.getParent()&&this.$.parentNode.replaceChild(e.$,this.$),e.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=e.$,delete this.getName}},getChild:function(){function e(e,t){var i=e.childNodes;if(t>=0&&t<i.length)return i[t]}return function(t){var i=this.$;if(t.slice)for(;t.length>0&&i;)i=e(i,t.shift());else i=e(i,t);return i?new CKEDITOR.dom.node(i):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(e){e.data.getTarget().hasClass("cke_enable_context_menu")||e.data.preventDefault()})},getDirection:function(e){return e?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(e,t){return e="data-"+e,void 0===t?this.getAttribute(e):(t===!1?this.removeAttribute(e):this.setAttribute(e,t),null)},getEditor:function(){var e,t,i=CKEDITOR.instances;for(e in i)if(t=i[e],t.element.equals(this)&&t.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO)return t;return null},find:function(i){var n=e(this),i=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(t(this,i)));return n(),i},findOne:function(i){var n=e(this),i=this.$.querySelector(t(this,i));return n(),i?new CKEDITOR.dom.element(i):null},forEach:function(e,t,i){if(!(i||t&&this.type!=t))var n=e(this);if(n!==!1)for(var i=this.getChildren(),r=0;r<i.count();r++)n=i.getItem(r),n.type==CKEDITOR.NODE_ELEMENT?n.forEach(e,t):(!t||n.type==t)&&e(n)}});var n={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(e,t,n){"number"==typeof t&&(!n||CKEDITOR.env.ie&&CKEDITOR.env.quirks||(t-=i.call(this,e)),this.setStyle(e,t+"px"))},CKEDITOR.dom.element.prototype.getSize=function(e,t){var n=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(e)],this.$["client"+CKEDITOR.tools.capitalize(e)])||0;return t&&(n-=i.call(this,e)),n}}(),CKEDITOR.dom.documentFragment=function(e){e=e||CKEDITOR.document,this.$=e.type==CKEDITOR.NODE_DOCUMENT?e.$.createDocumentFragment():e},CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(e){e=e.$,e.parentNode.insertBefore(this.$,e.nextSibling)}},!0,{append:1,appendBogus:1,getFirst:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1}),function(){function e(e,t){var i=this.range;if(this._.end)return null;if(!this._.start){if(this._.start=1,i.collapsed)return this.end(),null;i.optimize()}var n,r=i.startContainer;n=i.endContainer;var o,s=i.startOffset,a=i.endOffset,l=this.guard,u=this.type,c=e?"getPreviousSourceNode":"getNextSourceNode";if(!e&&!this._.guardLTR){var h=n.type==CKEDITOR.NODE_ELEMENT?n:n.getParent(),d=n.type==CKEDITOR.NODE_ELEMENT?n.getChild(a):n.getNext();this._.guardLTR=function(e,t){return!(t&&h.equals(e)||d&&e.equals(d)||e.type==CKEDITOR.NODE_ELEMENT&&t&&e.equals(i.root))}}if(e&&!this._.guardRTL){var p=r.type==CKEDITOR.NODE_ELEMENT?r:r.getParent(),f=r.type==CKEDITOR.NODE_ELEMENT?s?r.getChild(s-1):null:r.getPrevious();this._.guardRTL=function(e,t){return!(t&&p.equals(e)||f&&e.equals(f)||e.type==CKEDITOR.NODE_ELEMENT&&t&&e.equals(i.root))}}var m=e?this._.guardRTL:this._.guardLTR;for(o=l?function(e,t){return m(e,t)!==!1&&l(e,t)}:m,this.current?n=this.current[c](!1,u,o):(e?n.type==CKEDITOR.NODE_ELEMENT&&(n=a>0?n.getChild(a-1):o(n,!0)===!1?null:n.getPreviousSourceNode(!0,u,o)):(n=r,n.type!=CKEDITOR.NODE_ELEMENT||(n=n.getChild(s))||(n=o(r,!0)===!1?null:r.getNextSourceNode(!0,u,o))),n&&o(n)===!1&&(n=null));n&&!this._.end;){if(this.current=n,this.evaluator&&this.evaluator(n)===!1){if(t&&this.evaluator)return!1}else if(!t)return n;n=n[c](!1,u,o)}return this.end(),this.current=null}function t(t){for(var i,n=null;i=e.call(this,t);)n=i;return n}function i(e){if(u(e))return!1;if(e.type==CKEDITOR.NODE_TEXT)return!0;if(e.type==CKEDITOR.NODE_ELEMENT){if(e.is(CKEDITOR.dtd.$inline)||e.is("hr")||"false"==e.getAttribute("contenteditable"))return!0;var t;if((t=!CKEDITOR.env.needsBrFiller)&&(t=e.is(c)))e:{t=0;for(var i=e.getChildCount();t<i;++t)if(!u(e.getChild(t))){t=!1;break e}t=!0}if(t)return!0}return!1}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(e){this.range=e,this._={}},proto:{end:function(){this._.end=1},next:function(){return e.call(this)},previous:function(){return e.call(this,1)},checkForward:function(){return e.call(this,0,1)!==!1},checkBackward:function(){return e.call(this,1,1)!==!1},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,1)},reset:function(){delete this.current,this._={}}}});var n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},r={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(e){return!("none"!=this.getComputedStyle("float")||this.getComputedStyle("position")in r||!n[this.getComputedStyle("display")])||!!(this.is(CKEDITOR.dtd.$block)||e&&this.is(e))},CKEDITOR.dom.walker.blockBoundary=function(e){return function(t){return!(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary(e))}},CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})},CKEDITOR.dom.walker.bookmark=function(e,t){function i(e){return e&&e.getName&&"span"==e.getName()&&e.data("cke-bookmark")}return function(n){var r,o;return r=n&&n.type!=CKEDITOR.NODE_ELEMENT&&(o=n.getParent())&&i(o),r=e?r:r||i(n),!!(t^r)}},CKEDITOR.dom.walker.whitespaces=function(e){return function(t){var i;return t&&t.type==CKEDITOR.NODE_TEXT&&(i=!CKEDITOR.tools.trim(t.getText())||CKEDITOR.env.webkit&&"​"==t.getText()),!!(e^i)}},CKEDITOR.dom.walker.invisible=function(e){var t=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.env.webkit?1:0;return function(n){return t(n)?n=1:(n.type==CKEDITOR.NODE_TEXT&&(n=n.getParent()),n=n.$.offsetWidth<=i),!!(e^n)}},CKEDITOR.dom.walker.nodeType=function(e,t){return function(i){return!!(t^i.type==e)}},CKEDITOR.dom.walker.bogus=function(e){function t(e){return!s(e)&&!a(e)}return function(i){var n=CKEDITOR.env.needsBrFiller?i.is&&i.is("br"):i.getText&&o.test(i.getText());return n&&(n=i.getParent(),i=i.getNext(t),n=n.isBlockBoundary()&&(!i||i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary())),!!(e^n)}},CKEDITOR.dom.walker.temp=function(e){return function(t){return t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),t=t&&t.hasAttribute("data-cke-temp"),!!(e^t)}};var o=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,s=CKEDITOR.dom.walker.whitespaces(),a=CKEDITOR.dom.walker.bookmark(),l=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(e){return function(t){return t=s(t)||a(t)||l(t),!!(e^t)}};var u=CKEDITOR.dom.walker.ignored(),c=function(e){var t,i={};for(t in e)CKEDITOR.dtd[t]["#"]&&(i[t]=1);return i}(CKEDITOR.dtd.$block);CKEDITOR.dom.walker.editable=function(e){return function(t){return!!(e^i(t))}},CKEDITOR.dom.element.prototype.getBogus=function(){var e=this;do e=e.getPreviousSourceNode();while(a(e)||s(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$inline)&&!e.is(CKEDITOR.dtd.$empty));return!(!e||!(CKEDITOR.env.needsBrFiller?e.is&&e.is("br"):e.getText&&o.test(e.getText())))&&e}}(),CKEDITOR.dom.range=function(e){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null,this.collapsed=!0;var t=e instanceof CKEDITOR.dom.document;this.document=t?e:e.getDocument(),this.root=t?e.getBody():e},function(){function e(){var e=!1,t=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(!0),n=CKEDITOR.dom.walker.bogus();return function(r){return!(!i(r)&&!t(r))||(n(r)&&!e?e=!0:!(r.type==CKEDITOR.NODE_TEXT&&(r.hasAscendant("pre")||CKEDITOR.tools.trim(r.getText()).length)||r.type==CKEDITOR.NODE_ELEMENT&&!r.is(o)))}}function t(e){var t=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(1);return function(n){return!(!i(n)&&!t(n))||(!e&&s(n)||n.type==CKEDITOR.NODE_ELEMENT&&n.is(CKEDITOR.dtd.$removeEmpty))}}function i(e){return function(){var t;return this[e?"getPreviousNode":"getNextNode"](function(e){return!t&&u(e)&&(t=e),l(e)&&!(s(e)&&e.equals(t))})}}var n=function(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer.equals(e.endContainer)&&e.startOffset==e.endOffset},r=function(e,t,i,n){e.optimizeBookmark();var r,o,s=e.startContainer,a=e.endContainer,l=e.startOffset,u=e.endOffset;a.type==CKEDITOR.NODE_TEXT?a=a.split(u):a.getChildCount()>0&&(u>=a.getChildCount()?(a=a.append(e.document.createText("")),o=!0):a=a.getChild(u)),s.type==CKEDITOR.NODE_TEXT?(s.split(l),s.equals(a)&&(a=s.getNext())):l?l>=s.getChildCount()?(s=s.append(e.document.createText("")),r=!0):s=s.getChild(l).getPrevious():(s=s.append(e.document.createText(""),1),r=!0);var c,h,d,l=s.getParents(),u=a.getParents();for(c=0;c<l.length&&(h=l[c],d=u[c],h.equals(d));c++);for(var p,f,m,g=i,y=c;y<l.length;y++){for(p=l[y],g&&!p.equals(s)&&(f=g.append(p.clone())),p=p.getNext();p&&(!p.equals(u[y])&&!p.equals(a));)m=p.getNext(),2==t?g.append(p.clone(!0)):(p.remove(),1==t&&g.append(p)),p=m;g&&(g=f)}for(g=i,i=c;i<u.length;i++){if(p=u[i],t>0&&!p.equals(a)&&(f=g.append(p.clone())),!l[i]||p.$.parentNode!=l[i].$.parentNode)for(p=p.getPrevious();p&&(!p.equals(l[i])&&!p.equals(s));)m=p.getPrevious(),2==t?g.$.insertBefore(p.$.cloneNode(!0),g.$.firstChild):(p.remove(),1==t&&g.$.insertBefore(p.$,g.$.firstChild)),p=m;g&&(g=f)}2==t?(h=e.startContainer,h.type==CKEDITOR.NODE_TEXT&&(h.$.data=h.$.data+h.$.nextSibling.data,h.$.parentNode.removeChild(h.$.nextSibling)),e=e.endContainer,e.type==CKEDITOR.NODE_TEXT&&e.$.nextSibling&&(e.$.data=e.$.data+e.$.nextSibling.data,e.$.parentNode.removeChild(e.$.nextSibling))):(h&&d&&(s.$.parentNode!=h.$.parentNode||a.$.parentNode!=d.$.parentNode)&&(t=d.getIndex(),r&&d.$.parentNode==s.$.parentNode&&t--,n&&h.type==CKEDITOR.NODE_ELEMENT?(n=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',e.document),n.insertAfter(h),h.mergeSiblings(!1),e.moveToBookmark({startNode:n})):e.setStart(d.getParent(),t)),e.collapse(!0)),r&&s.remove(),o&&a.$.parentNode&&a.remove()},o={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},s=CKEDITOR.dom.walker.bogus(),a=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,l=CKEDITOR.dom.walker.editable(),u=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var e=new CKEDITOR.dom.range(this.root);return e._setStartContainer(this.startContainer),e.startOffset=this.startOffset,e._setEndContainer(this.endContainer),e.endOffset=this.endOffset,e.collapsed=this.collapsed,e},collapse:function(e){e?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(){var e=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||r(this,2,e),e},deleteContents:function(e){this.collapsed||r(this,0,null,e)},extractContents:function(e){var t=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||r(this,1,t,e),t},createBookmark:function(e){var t,i,n,r,o=this.collapsed;return t=this.document.createElement("span"),t.data("cke-bookmark",1),t.setStyle("display","none"),t.setHtml("&nbsp;"),e&&(n="cke_bm_"+CKEDITOR.tools.getNextNumber(),t.setAttribute("id",n+(o?"C":"S"))),o||(i=t.clone(),i.setHtml("&nbsp;"),e&&i.setAttribute("id",n+"E"),r=this.clone(),r.collapse(),r.insertNode(i)),r=this.clone(),r.collapse(!0),r.insertNode(t),i?(this.setStartAfter(t),this.setEndBefore(i)):this.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),{startNode:e?n+(o?"C":"S"):t,endNode:e?n+"E":i,serializable:e,collapsed:o}},createBookmark2:function(){function e(e){var i,n=e.container,r=e.offset;i=n;var o=r;if(i=i.type!=CKEDITOR.NODE_ELEMENT||0===o||o==i.getChildCount()?0:i.getChild(o-1).type==CKEDITOR.NODE_TEXT&&i.getChild(o).type==CKEDITOR.NODE_TEXT,i&&(n=n.getChild(r-1),r=n.getLength()),n.type==CKEDITOR.NODE_ELEMENT&&r>1&&(r=n.getChild(r-1).getIndex(!0)+1),n.type==CKEDITOR.NODE_TEXT){for(i=n,o=0;(i=i.getPrevious())&&i.type==CKEDITOR.NODE_TEXT;)o+=i.getLength();i=o,n.getText()?r+=i:(o=n.getPrevious(t),i?(r=i,n=o?o.getNext():n.getParent().getFirst()):(n=n.getParent(),r=o?o.getIndex(!0)+1:0))}e.container=n,e.offset=r}var t=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(t){var i=this.collapsed,n={container:this.startContainer,offset:this.startOffset},r={container:this.endContainer,offset:this.endOffset};return t&&(e(n),i||e(r)),{start:n.container.getAddress(t),end:i?null:r.container.getAddress(t),startOffset:n.offset,endOffset:r.offset,normalized:t,collapsed:i,is2:!0}}}(),moveToBookmark:function(e){if(e.is2){var t=this.document.getByAddress(e.start,e.normalized),i=e.startOffset,n=e.end&&this.document.getByAddress(e.end,e.normalized),e=e.endOffset;this.setStart(t,i),n?this.setEnd(n,e):this.collapse(!0)}else t=(i=e.serializable)?this.document.getById(e.startNode):e.startNode,e=i?this.document.getById(e.endNode):e.endNode,
this.setStartBefore(t),t.remove(),e?(this.setEndBefore(e),e.remove()):this.collapse(!0)},getBoundaryNodes:function(){var e,t=this.startContainer,i=this.endContainer,n=this.startOffset,r=this.endOffset;if(t.type==CKEDITOR.NODE_ELEMENT)if(e=t.getChildCount(),e>n)t=t.getChild(n);else if(e<1)t=t.getPreviousSourceNode();else{for(t=t.$;t.lastChild;)t=t.lastChild;t=new CKEDITOR.dom.node(t),t=t.getNextSourceNode()||t}if(i.type==CKEDITOR.NODE_ELEMENT)if(e=i.getChildCount(),e>r)i=i.getChild(r).getPreviousSourceNode(!0);else if(e<1)i=i.getPreviousSourceNode();else{for(i=i.$;i.lastChild;)i=i.lastChild;i=new CKEDITOR.dom.node(i)}return t.getPosition(i)&CKEDITOR.POSITION_FOLLOWING&&(t=i),{startNode:t,endNode:i}},getCommonAncestor:function(e,t){var i=this.startContainer,n=this.endContainer,i=i.equals(n)?e&&i.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?i.getChild(this.startOffset):i:i.getCommonAncestor(n);return t&&!i.is?i.getParent():i},optimize:function(){var e=this.startContainer,t=this.startOffset;e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setStartAfter(e):this.setStartBefore(e)),e=this.endContainer,t=this.endOffset,e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setEndAfter(e):this.setEndBefore(e))},optimizeBookmark:function(){var e=this.startContainer,t=this.endContainer;e.is&&e.is("span")&&e.data("cke-bookmark")&&this.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),t&&t.is&&t.is("span")&&t.data("cke-bookmark")&&this.setEndAt(t,CKEDITOR.POSITION_AFTER_END)},trim:function(e,t){var i=this.startContainer,n=this.startOffset,r=this.collapsed;if((!e||r)&&i&&i.type==CKEDITOR.NODE_TEXT){if(n)if(n>=i.getLength())n=i.getIndex()+1,i=i.getParent();else{var o=i.split(n),n=i.getIndex()+1,i=i.getParent();this.startContainer.equals(this.endContainer)?this.setEnd(o,this.endOffset-this.startOffset):i.equals(this.endContainer)&&(this.endOffset=this.endOffset+1)}else n=i.getIndex(),i=i.getParent();if(this.setStart(i,n),r)return void this.collapse(!0)}i=this.endContainer,n=this.endOffset,t||r||!i||i.type!=CKEDITOR.NODE_TEXT||(n?(n>=i.getLength()||i.split(n),n=i.getIndex()+1):n=i.getIndex(),i=i.getParent(),this.setEnd(i,n))},enlarge:function(e,t){function i(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("contenteditable")?null:e}var n=RegExp(/[^\s\ufeff]/);switch(e){case CKEDITOR.ENLARGE_INLINE:var r=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var o,s,a,l,u,c,h,d=this.getCommonAncestor(),p=this.root,f=!1;c=this.startContainer;var m=this.startOffset;for(c.type==CKEDITOR.NODE_TEXT?(m&&(c=!CKEDITOR.tools.trim(c.substring(0,m)).length&&c,f=!!c),c&&!(l=c.getPrevious())&&(a=c.getParent())):(m&&(l=c.getChild(m-1)||c.getLast()),l||(a=c)),a=i(a);a||l;){if(a&&!l){if(!u&&a.equals(d)&&(u=!0),r?a.isBlockBoundary():!p.contains(a))break;f&&"inline"==a.getComputedStyle("display")||(f=!1,u?o=a:this.setStartBefore(a)),l=a.getPrevious()}for(;l;)if(c=!1,l.type==CKEDITOR.NODE_COMMENT)l=l.getPrevious();else{if(l.type==CKEDITOR.NODE_TEXT)h=l.getText(),n.test(h)&&(l=null),c=/[\s\ufeff]$/.test(h);else if((l.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||t&&l.is("br"))&&!l.data("cke-bookmark"))if(f&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(h=l.getText(),n.test(h))l=null;else for(var g,m=l.$.getElementsByTagName("*"),y=0;g=m[y++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}l&&(c=!!h.length)}else l=null;if(c&&(f?u?o=a:a&&this.setStartBefore(a):f=!0),l){if(c=l.getPrevious(),!a&&!c){a=l,l=null;break}l=c}else a=null}a&&(a=i(a.getParent()))}c=this.endContainer,m=this.endOffset,a=l=null,u=f=!1;var v=function(e,t){var i=new CKEDITOR.dom.range(p);i.setStart(e,t),i.setEndAt(p,CKEDITOR.POSITION_BEFORE_END);var r,i=new CKEDITOR.dom.walker(i);for(i.guard=function(e){return!(e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary())};r=i.next();){if(r.type!=CKEDITOR.NODE_TEXT)return!1;if(h=r!=e?r.getText():r.substring(t),n.test(h))return!1}return!0};for(c.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(c.substring(m)).length?f=!0:(f=!c.getLength(),m==c.getLength()?(l=c.getNext())||(a=c.getParent()):v(c,m)&&(a=c.getParent())):(l=c.getChild(m))||(a=c);a||l;){if(a&&!l){if(!u&&a.equals(d)&&(u=!0),r?a.isBlockBoundary():!p.contains(a))break;f&&"inline"==a.getComputedStyle("display")||(f=!1,u?s=a:a&&this.setEndAfter(a)),l=a.getNext()}for(;l;){if(c=!1,l.type==CKEDITOR.NODE_TEXT)h=l.getText(),v(l,0)||(l=null),c=/^[\s\ufeff]/.test(h);else if(l.type==CKEDITOR.NODE_ELEMENT){if((l.$.offsetWidth>0||t&&l.is("br"))&&!l.data("cke-bookmark"))if(f&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(h=l.getText(),n.test(h))l=null;else for(m=l.$.getElementsByTagName("*"),y=0;g=m[y++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}l&&(c=!!h.length)}else l=null}else c=1;if(c&&f&&(u?s=a:this.setEndAfter(a)),l){if(c=l.getNext(),!a&&!c){a=l,l=null;break}l=c}else a=null}a&&(a=i(a.getParent()))}o&&s&&(d=o.contains(s)?s:o,this.setStartBefore(d),this.setEndAfter(d));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:a=new CKEDITOR.dom.range(this.root),p=this.root,a.setStartAt(p,CKEDITOR.POSITION_AFTER_START),a.setEnd(this.startContainer,this.startOffset),a=new CKEDITOR.dom.walker(a);var E,T,b=CKEDITOR.dom.walker.blockBoundary(e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),C=null,O=function(e){if(e.type==CKEDITOR.NODE_ELEMENT&&"false"==e.getAttribute("contenteditable"))if(C){if(C.equals(e))return void(C=null)}else C=e;else if(C)return;var t=b(e);return t||(E=e),t},r=function(e){var t=O(e);return!t&&e.is&&e.is("br")&&(T=e),t};if(a.guard=O,a=a.lastBackward(),E=E||p,this.setStartAt(E,!E.is("br")&&(!a&&this.checkStartOfBlock()||a&&E.contains(a))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){a=this.clone(),a=new CKEDITOR.dom.walker(a);var x=CKEDITOR.dom.walker.whitespaces(),w=CKEDITOR.dom.walker.bookmark();if(a.evaluator=function(e){return!x(e)&&!w(e)},(a=a.previous())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("br"))break}a=this.clone(),a.collapse(),a.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),a=new CKEDITOR.dom.walker(a),a.guard=e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?r:O,E=C=T=null,a=a.lastForward(),E=E||p,this.setEndAt(E,!a&&this.checkEndOfBlock()||a&&E.contains(a)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),T&&this.setEndAfter(T)}},shrink:function(e,t,i){if(!this.collapsed){var e=e||CKEDITOR.SHRINK_TEXT,n=this.clone(),r=this.startContainer,o=this.endContainer,s=this.startOffset,a=this.endOffset,l=1,u=1;r&&r.type==CKEDITOR.NODE_TEXT&&(s?s>=r.getLength()?n.setStartAfter(r):(n.setStartBefore(r),l=0):n.setStartBefore(r)),o&&o.type==CKEDITOR.NODE_TEXT&&(a?a>=o.getLength()?n.setEndAfter(o):(n.setEndAfter(o),u=0):n.setEndBefore(o));var n=new CKEDITOR.dom.walker(n),c=CKEDITOR.dom.walker.bookmark();n.evaluator=function(t){return t.type==(e==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var h;return n.guard=function(t,n){return!!c(t)||!(e==CKEDITOR.SHRINK_ELEMENT&&t.type==CKEDITOR.NODE_TEXT||n&&t.equals(h)||i===!1&&t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary()||t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("contenteditable"))&&(!n&&t.type==CKEDITOR.NODE_ELEMENT&&(h=t),!0)},l&&(r=n[e==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(r,t?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START),u&&(n.reset(),(n=n[e==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(n,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)),!(!l&&!u)}},insertNode:function(e){this.optimizeBookmark(),this.trim(!1,!0);var t=this.startContainer,i=t.getChild(this.startOffset);i?e.insertBefore(i):t.append(e),e.getParent()&&e.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(e)},moveToPosition:function(e,t){this.setStartAt(e,t),this.collapse(!0)},moveToRange:function(e){this.setStart(e.startContainer,e.startOffset),this.setEnd(e.endContainer,e.endOffset)},selectNodeContents:function(e){this.setStart(e,0),this.setEnd(e,e.type==CKEDITOR.NODE_TEXT?e.getLength():e.getChildCount())},setStart:function(e,t){e.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[e.getName()]&&(t=e.getIndex(),e=e.getParent()),this._setStartContainer(e),this.startOffset=t,this.endContainer||(this._setEndContainer(e),this.endOffset=t),n(this)},setEnd:function(e,t){e.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[e.getName()]&&(t=e.getIndex()+1,e=e.getParent()),this._setEndContainer(e),this.endOffset=t,this.startContainer||(this._setStartContainer(e),this.startOffset=t),n(this)},setStartAfter:function(e){this.setStart(e.getParent(),e.getIndex()+1)},setStartBefore:function(e){this.setStart(e.getParent(),e.getIndex())},setEndAfter:function(e){this.setEnd(e.getParent(),e.getIndex()+1)},setEndBefore:function(e){this.setEnd(e.getParent(),e.getIndex())},setStartAt:function(e,t){switch(t){case CKEDITOR.POSITION_AFTER_START:this.setStart(e,0);break;case CKEDITOR.POSITION_BEFORE_END:e.type==CKEDITOR.NODE_TEXT?this.setStart(e,e.getLength()):this.setStart(e,e.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(e);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(e)}n(this)},setEndAt:function(e,t){switch(t){case CKEDITOR.POSITION_AFTER_START:this.setEnd(e,0);break;case CKEDITOR.POSITION_BEFORE_END:e.type==CKEDITOR.NODE_TEXT?this.setEnd(e,e.getLength()):this.setEnd(e,e.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(e);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(e)}n(this)},fixBlock:function(e,t){var i=this.createBookmark(),n=this.document.createElement(t);return this.collapse(e),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(n),n.trim(),n.appendBogus(),this.insertNode(n),this.moveToBookmark(i),n},splitBlock:function(e){var t=new CKEDITOR.dom.elementPath(this.startContainer,this.root),i=new CKEDITOR.dom.elementPath(this.endContainer,this.root),n=t.block,r=i.block,o=null;return t.blockLimit.equals(i.blockLimit)?("br"!=e&&(n||(n=this.fixBlock(!0,e),r=new CKEDITOR.dom.elementPath(this.endContainer,this.root).block),r||(r=this.fixBlock(!1,e))),e=n&&this.checkStartOfBlock(),t=r&&this.checkEndOfBlock(),this.deleteContents(),n&&n.equals(r)&&(t?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(r,CKEDITOR.POSITION_AFTER_END),r=null):e?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(n,CKEDITOR.POSITION_BEFORE_START),n=null):(r=this.splitElement(n),n.is("ul","ol")||n.appendBogus())),{previousBlock:n,nextBlock:r,wasStartOfBlock:e,wasEndOfBlock:t,elementPath:o}):null},splitElement:function(e){if(!this.collapsed)return null;this.setEndAt(e,CKEDITOR.POSITION_BEFORE_END);var t=this.extractContents(),i=e.clone(!1);return t.appendTo(i),i.insertAfter(e),this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),i},removeEmptyBlocksAtEnd:function(){function e(e){return function(n){return!(t(n)||i(n)||n.type==CKEDITOR.NODE_ELEMENT&&n.isEmptyInlineRemoveable()||e.is("table")&&n.is("caption"))}}var t=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark(!1);return function(t){for(var i,n=this.createBookmark(),r=this[t?"endPath":"startPath"](),o=r.block||r.blockLimit;o&&!o.equals(r.root)&&!o.getFirst(e(o));)i=o.getParent(),this[t?"setEndAt":"setStartAt"](o,CKEDITOR.POSITION_AFTER_END),o.remove(1),o=i;this.moveToBookmark(n)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(e,i){var n=i==CKEDITOR.START,r=this.clone();return r.collapse(n),r[n?"setStartAt":"setEndAt"](e,n?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),r=new CKEDITOR.dom.walker(r),r.evaluator=t(n),r[n?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var t=this.startContainer,i=this.startOffset;return CKEDITOR.env.ie&&i&&t.type==CKEDITOR.NODE_TEXT&&(t=CKEDITOR.tools.ltrim(t.substring(0,i)),a.test(t)&&this.trim(0,1)),this.trim(),t=new CKEDITOR.dom.elementPath(this.startContainer,this.root),i=this.clone(),i.collapse(!0),i.setStartAt(t.block||t.blockLimit,CKEDITOR.POSITION_AFTER_START),t=new CKEDITOR.dom.walker(i),t.evaluator=e(),t.checkBackward()},checkEndOfBlock:function(){var t=this.endContainer,i=this.endOffset;return CKEDITOR.env.ie&&t.type==CKEDITOR.NODE_TEXT&&(t=CKEDITOR.tools.rtrim(t.substring(i)),a.test(t)&&this.trim(1,0)),this.trim(),t=new CKEDITOR.dom.elementPath(this.endContainer,this.root),i=this.clone(),i.collapse(!1),i.setEndAt(t.block||t.blockLimit,CKEDITOR.POSITION_BEFORE_END),t=new CKEDITOR.dom.walker(i),t.evaluator=e(),t.checkForward()},getPreviousNode:function(e,t,i){var n=this.clone();return n.collapse(1),n.setStartAt(i||this.root,CKEDITOR.POSITION_AFTER_START),i=new CKEDITOR.dom.walker(n),i.evaluator=e,i.guard=t,i.previous()},getNextNode:function(e,t,i){var n=this.clone();return n.collapse(),n.setEndAt(i||this.root,CKEDITOR.POSITION_BEFORE_END),i=new CKEDITOR.dom.walker(n),i.evaluator=e,i.guard=t,i.next()},checkReadOnly:function(){function e(e,t){for(;e;){if(e.type==CKEDITOR.NODE_ELEMENT){if("false"==e.getAttribute("contentEditable")&&!e.data("cke-editable"))return 0;if(e.is("html")||"true"==e.getAttribute("contentEditable")&&(e.contains(t)||e.equals(t)))break}e=e.getParent()}return 1}return function(){var t=this.startContainer,i=this.endContainer;return!(e(t,i)&&e(i,t))}}(),moveToElementEditablePosition:function(e,t){if(e.type==CKEDITOR.NODE_ELEMENT&&!e.isEditable(!1))return this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var i=0;e;){if(e.type==CKEDITOR.NODE_TEXT){t&&this.endContainer&&this.checkEndOfBlock()&&a.test(e.getText())?this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),i=1;break}if(e.type==CKEDITOR.NODE_ELEMENT)if(e.isEditable())this.moveToPosition(e,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),i=1;else if(t&&e.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START);else if("false"==e.getAttribute("contenteditable")&&e.is(CKEDITOR.dtd.$block))return this.setStartBefore(e),this.setEndAfter(e),!0;var n=e,r=i,o=void 0;n.type==CKEDITOR.NODE_ELEMENT&&n.isEditable(!1)&&(o=n[t?"getLast":"getFirst"](u)),!r&&!o&&(o=n[t?"getPrevious":"getNext"](u)),e=o}return!!i},moveToClosestEditablePosition:function(e,t){var i,n=new CKEDITOR.dom.range(this.root),r=0,o=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];return n.moveToPosition(e,o[t?0:1]),e.is(CKEDITOR.dtd.$block)?(i=n[t?"getNextEditableNode":"getPreviousEditableNode"]())&&(r=1,i.type==CKEDITOR.NODE_ELEMENT&&i.is(CKEDITOR.dtd.$block)&&"false"==i.getAttribute("contenteditable")?(n.setStartAt(i,CKEDITOR.POSITION_BEFORE_START),n.setEndAt(i,CKEDITOR.POSITION_AFTER_END)):n.moveToPosition(i,o[t?1:0])):r=1,r&&this.moveToRange(n),!!r},moveToElementEditStart:function(e){return this.moveToElementEditablePosition(e)},moveToElementEditEnd:function(e){return this.moveToElementEditablePosition(e,!0)},getEnclosedNode:function(){var e=this.clone();if(e.optimize(),e.startContainer.type!=CKEDITOR.NODE_ELEMENT||e.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var e=new CKEDITOR.dom.walker(e),t=CKEDITOR.dom.walker.bookmark(!1,!0),i=CKEDITOR.dom.walker.whitespaces(!0);e.evaluator=function(e){return i(e)&&t(e)};var n=e.next();return e.reset(),n&&n.equals(e.previous())?n:null},getTouchedStartNode:function(){var e=this.startContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.startOffset)||e},getTouchedEndNode:function(){var e=this.endContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.endOffset-1)||e},getNextEditableNode:i(),getPreviousEditableNode:i(1),scrollIntoView:function(){var e,t,i,n=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),r=this.clone();r.optimize(),(i=r.startContainer.type==CKEDITOR.NODE_TEXT)?(t=r.startContainer.getText(),e=r.startContainer.split(r.startOffset),n.insertAfter(r.startContainer)):r.insertNode(n),n.scrollIntoView(),i&&(r.startContainer.setText(t),e.remove()),n.remove()},_setStartContainer:function(e){this.startContainer=e},_setEndContainer:function(e){this.endContainer=e}}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2,function(){function e(e){arguments.length<1||(this.range=e,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0,this._||(this._={}))}function t(e){var t=[];return e.forEach(function(e){if("true"==e.getAttribute("contenteditable"))return t.push(e),!1},CKEDITOR.NODE_ELEMENT,!0),t}function i(e,n,r,o){e:{null==o&&(o=t(r));for(var s;s=o.shift();)if(s.getDtd().p){o={element:s,remaining:o};break e}o=null}return o?(s=CKEDITOR.filter.instances[o.element.data("cke-filter")])&&!s.check(n)?i(e,n,r,o.remaining):(n=new CKEDITOR.dom.range(o.element),n.selectNodeContents(o.element),n=n.createIterator(),n.enlargeBr=e.enlargeBr,n.enforceRealBlocks=e.enforceRealBlocks,n.activeFilter=n.filter=s,e._.nestedEditable={element:o.element,container:r,remaining:o.remaining,iterator:n},1):0}function n(e,t,i){return!!t&&(e=e.clone(),e.collapse(!i),e.checkBoundaryOfElement(t,i?CKEDITOR.START:CKEDITOR.END))}var r=/^[\r\n\t ]+$/,o=CKEDITOR.dom.walker.bookmark(!1,!0),s=CKEDITOR.dom.walker.whitespaces(!0),a=function(e){return o(e)&&s(e)},l={dd:1,dt:1,li:1};e.prototype={getNextParagraph:function(e){var t,s,u,c,h,e=e||"p";if(this._.nestedEditable){if(t=this._.nestedEditable.iterator.getNextParagraph(e))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,t;if(this.activeFilter=this.filter,i(this,e,this._.nestedEditable.container,this._.nestedEditable.remaining))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,this._.nestedEditable.iterator.getNextParagraph(e);this._.nestedEditable=null}if(!this.range.root.getDtd()[e])return null;if(!this._.started){var d=this.range.clone();s=d.startPath();var p=d.endPath(),f=!d.collapsed&&n(d,s.block),m=!d.collapsed&&n(d,p.block,1);d.shrink(CKEDITOR.SHRINK_ELEMENT,!0),f&&d.setStartAt(s.block,CKEDITOR.POSITION_BEFORE_END),m&&d.setEndAt(p.block,CKEDITOR.POSITION_AFTER_START),s=d.endContainer.hasAscendant("pre",!0)||d.startContainer.hasAscendant("pre",!0),d.enlarge(this.forceBrBreak&&!s||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),d.collapsed||(s=new CKEDITOR.dom.walker(d.clone()),p=CKEDITOR.dom.walker.bookmark(!0,!0),s.evaluator=p,this._.nextNode=s.next(),s=new CKEDITOR.dom.walker(d.clone()),s.evaluator=p,s=s.previous(),this._.lastNode=s.getNextSourceNode(!0,null,d.root),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&(p=this.range.clone(),p.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),p.checkEndOfBlock()&&(p=new CKEDITOR.dom.elementPath(p.endContainer,p.root),this._.lastNode=(p.block||p.blockLimit).getNextSourceNode(!0))),this._.lastNode&&d.root.contains(this._.lastNode)||(this._.lastNode=this._.docEndMarker=d.document.createText(""),this._.lastNode.insertAfter(s)),d=null),this._.started=1,s=d}for(p=this._.nextNode,d=this._.lastNode,this._.nextNode=null;p;){var f=0,m=p.hasAscendant("pre"),g=p.type!=CKEDITOR.NODE_ELEMENT,y=0;if(g)p.type==CKEDITOR.NODE_TEXT&&r.test(p.getText())&&(g=0);else{var v=p.getName();if(CKEDITOR.dtd.$block[v]&&"false"==p.getAttribute("contenteditable")){t=p,i(this,e,t);break}if(p.isBlockBoundary(this.forceBrBreak&&!m&&{br:1})){if("br"==v)g=1;else if(!s&&!p.getChildCount()&&"hr"!=v){t=p,u=p.equals(d);break}s&&(s.setEndAt(p,CKEDITOR.POSITION_BEFORE_START),"br"!=v&&(this._.nextNode=p)),f=1}else{if(p.getFirst()){s||(s=this.range.clone(),s.setStartAt(p,CKEDITOR.POSITION_BEFORE_START)),p=p.getFirst();continue}g=1}}if(g&&!s&&(s=this.range.clone(),s.setStartAt(p,CKEDITOR.POSITION_BEFORE_START)),u=(!f||g)&&p.equals(d),s&&!f)for(;!p.getNext(a)&&!u;){if(v=p.getParent(),v.isBlockBoundary(this.forceBrBreak&&!m&&{br:1})){f=1,g=0,u||v.equals(d),s.setEndAt(v,CKEDITOR.POSITION_BEFORE_END);break}p=v,g=1,u=p.equals(d),y=1}if(g&&s.setEndAt(p,CKEDITOR.POSITION_AFTER_END),p=this._getNextSourceNode(p,y,d),(u=!p)||f&&s)break}if(!t){if(!s)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null;t=new CKEDITOR.dom.elementPath(s.startContainer,s.root),p=t.blockLimit,f={div:1,th:1,td:1},t=t.block,!t&&p&&!this.enforceRealBlocks&&f[p.getName()]&&s.checkStartOfBlock()&&s.checkEndOfBlock()&&!p.equals(s.root)?t=p:!t||this.enforceRealBlocks&&t.is(l)?(t=this.range.document.createElement(e),s.extractContents().appendTo(t),t.trim(),s.insertNode(t),c=h=!0):"li"!=t.getName()?s.checkStartOfBlock()&&s.checkEndOfBlock()||(t=t.clone(!1),s.extractContents().appendTo(t),t.trim(),h=s.splitBlock(),c=!h.wasStartOfBlock,h=!h.wasEndOfBlock,s.insertNode(t)):u||(this._.nextNode=t.equals(d)?null:this._getNextSourceNode(s.getBoundaryNodes().endNode,1,d))}return c&&(c=t.getPrevious())&&c.type==CKEDITOR.NODE_ELEMENT&&("br"==c.getName()?c.remove():c.getLast()&&"br"==c.getLast().$.nodeName.toLowerCase()&&c.getLast().remove()),h&&(c=t.getLast())&&c.type==CKEDITOR.NODE_ELEMENT&&"br"==c.getName()&&(!CKEDITOR.env.needsBrFiller||c.getPrevious(o)||c.getNext(o))&&c.remove(),this._.nextNode||(this._.nextNode=u||t.equals(d)||!d?null:this._getNextSourceNode(t,1,d)),t},_getNextSourceNode:function(e,t,i){function n(e){return!(e.equals(i)||e.equals(r))}for(var r=this.range.root,e=e.getNextSourceNode(t,null,n);!o(e);)e=e.getNextSourceNode(t,null,n);return e}},CKEDITOR.dom.range.prototype.createIterator=function(){return new e(this)}}(),CKEDITOR.command=function(e,t){this.uiItems=[],this.exec=function(i){return!(this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed())&&(this.editorFocus&&e.focus(),this.fire("exec")===!1||t.exec.call(this,e,i)!==!1)},this.refresh=function(e,i){return!(this.readOnly||!e.readOnly)||(this.context&&!i.isContextFor(this.context)?(this.disable(),!0):this.checkAllowed(!0)?(this.startDisabled||this.enable(),this.modes&&!this.modes[e.mode]&&this.disable(),this.fire("refresh",{editor:e,path:i})===!1||t.refresh&&t.refresh.apply(this,arguments)!==!1):(this.disable(),!0))};var i;this.checkAllowed=function(t){return t||"boolean"!=typeof i?i=e.activeFilter.checkFeature(this):i},CKEDITOR.tools.extend(this,t,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!t.context,state:CKEDITOR.TRISTATE_DISABLED}),CKEDITOR.event.call(this)},CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(this.preserveState&&"undefined"!=typeof this.previousState?this.previousState:CKEDITOR.TRISTATE_OFF)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(e){return!(this.state==e||e!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed())&&(this.previousState=this.state,this.state=e,this.fire("state"),!0)},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.event.implementOn(CKEDITOR.command.prototype),CKEDITOR.ENTER_P=1,CKEDITOR.ENTER_BR=2,CKEDITOR.ENTER_DIV=3,CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1e4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]},function(){function e(e,t,i,n,r){var o,a,e=[];for(o in t){a=t[o],a="boolean"==typeof a?{}:"function"==typeof a?{match:a}:S(a),"$"!=o.charAt(0)&&(a.elements=o),i&&(a.featureName=i.toLowerCase());var l=a;l.elements=s(l.elements,/\s+/)||null,l.propertiesOnly=l.propertiesOnly||l.elements===!0;var u=/\s*,\s*/,c=void 0;for(c in M){l[c]=s(l[c],u)||null;var h=l,d=A[c],p=s(l[A[c]],u),f=l[c],m=[],g=!0,v=void 0;p?g=!1:p={};for(v in f)"!"==v.charAt(0)&&(v=v.slice(1),m.push(v),p[v]=!0,g=!1);for(;v=m.pop();)f[v]=f["!"+v],delete f["!"+v];h[d]=!g&&p||null}l.match=l.match||null,n.push(a),e.push(a)}for(var E,t=r.elements,r=r.generic,i=0,n=e.length;i<n;++i){o=S(e[i]),a=o.classes===!0||o.styles===!0||o.attributes===!0,l=o,c=d=u=void 0;for(u in M)l[u]=y(l[u]);h=!0;for(c in A){u=A[c],d=l[u],p=[],f=void 0;for(f in d)f.indexOf("*")>-1?p.push(RegExp("^"+f.replace(/\*/g,".*")+"$")):p.push(f);d=p,d.length&&(l[u]=d,h=!1)}if(l.nothingRequired=h,l.noProperties=!(l.attributes||l.classes||l.styles),o.elements===!0||null===o.elements)r[a?"unshift":"push"](o);else{l=o.elements,delete o.elements;for(E in l)t[E]?t[E][a?"unshift":"push"](o):t[E]=[o]}}}function t(e,t,n,r){if((!e.match||e.match(t))&&(r||a(e,t))&&(e.propertiesOnly||(n.valid=!0),n.allAttributes||(n.allAttributes=i(e.attributes,t.attributes,n.validAttributes)),n.allStyles||(n.allStyles=i(e.styles,t.styles,n.validStyles)),!n.allClasses)){if(e=e.classes,t=t.classes,r=n.validClasses,e)if(e===!0)e=!0;else{for(var o,s=0,l=t.length;s<l;++s)o=t[s],r[o]||(r[o]=e(o));e=!1}else e=!1;n.allClasses=e}}function i(e,t,i){if(!e)return!1;if(e===!0)return!0;for(var n in t)i[n]||(i[n]=e(n));return!1}function n(e,t,i){if(!e.match||e.match(t)){if(e.noProperties)return!1;if(i.hadInvalidAttribute=r(e.attributes,t.attributes)||i.hadInvalidAttribute,i.hadInvalidStyle=r(e.styles,t.styles)||i.hadInvalidStyle,e=e.classes,t=t.classes,e){for(var n=!1,o=e===!0,s=t.length;s--;)(o||e(t[s]))&&(t.splice(s,1),n=!0);e=n}else e=!1;i.hadInvalidClass=e||i.hadInvalidClass}}function r(e,t){if(!e)return!1;var i,n=!1,r=e===!0;for(i in t)(r||e(i))&&(delete t[i],n=!0);return n}function o(e,t,i){return!(e.disabled||e.customConfig&&!i||!t)&&(e._.cachedChecks={},!0)}function s(e,t){if(!e)return!1;if(e===!0)return e;if("string"==typeof e)return e=_(e),"*"==e||CKEDITOR.tools.convertArrayToObject(e.split(t));if(CKEDITOR.tools.isArray(e))return!!e.length&&CKEDITOR.tools.convertArrayToObject(e);var i,n={},r=0;for(i in e)n[i]=e[i],r++;return!!r&&n}function a(e,t){if(e.nothingRequired)return!0;var i,n,r,o;if(r=e.requiredClasses)for(o=t.classes,i=0;i<r.length;++i)if(n=r[i],"string"==typeof n){if(CKEDITOR.tools.indexOf(o,n)==-1)return!1}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(o,n))return!1;return l(t.styles,e.requiredStyles)&&l(t.attributes,e.requiredAttributes)}function l(e,t){if(!t)return!0;for(var i,n=0;n<t.length;++n)if(i=t[n],"string"==typeof i){if(!(i in e))return!1}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(e,i))return!1;return!0}function u(e){if(!e)return{};for(var e=e.split(/\s*,\s*/).sort(),t={};e.length;)t[e.shift()]=I;return t}function c(e){for(var t,i,n,r,o={},s=1,e=_(e);t=e.match(N);)(i=t[2])?(n=h(i,"styles"),r=h(i,"attrs"),i=h(i,"classes")):n=r=i=null,o["$"+s++]={elements:t[1],classes:i,styles:n,attributes:r},e=e.slice(t[0].length);return o}function h(e,t){var i=e.match(P[t]);return i?_(i[1]):null}function d(e){var t=e.styleBackup=e.attributes.style,i=e.classBackup=e.attributes["class"];e.styles||(e.styles=CKEDITOR.tools.parseCssText(t||"",1)),e.classes||(e.classes=i?i.split(/\s+/):[])}function p(e,i,r,o){var s,a=0;if(o.toHtml&&(i.name=i.name.replace(k,"$1")),o.doCallbacks&&e.elementCallbacks){e:for(var l,u=e.elementCallbacks,c=0,h=u.length;c<h;++c)if(l=u[c](i)){s=l;break e}if(s)return s}if(o.doTransform&&(s=e._.transformations[i.name])){for(d(i),u=0;u<s.length;++u)b(e,i,s[u]);m(i)}if(o.doFilter){e:{u=i.name,c=e._,e=c.allowedRules.elements[u],s=c.allowedRules.generic,u=c.disallowedRules.elements[u],c=c.disallowedRules.generic,h=o.skipRequired,l={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1,hadInvalidAttribute:!1,hadInvalidClass:!1,hadInvalidStyle:!1};var p,f;if(e||s){if(d(i),u)for(p=0,f=u.length;p<f;++p)if(n(u[p],i,l)===!1){e=null;break e}if(c)for(p=0,f=c.length;p<f;++p)n(c[p],i,l);if(e)for(p=0,f=e.length;p<f;++p)t(e[p],i,l,h);if(s)for(p=0,f=s.length;p<f;++p)t(s[p],i,l,h);e=l}else e=null}if(!e)return r.push(i),L;if(!e.valid)return r.push(i),L;f=e.validAttributes;var y=e.validStyles;s=e.validClasses;var v,E,u=i.attributes,T=i.styles,c=i.classes,h=i.classBackup,C=i.styleBackup,O=[];l=[];var x=/^data-cke-/;if(p=!1,delete u.style,delete u["class"],delete i.classBackup,delete i.styleBackup,!e.allAttributes)for(v in u)f[v]||(x.test(v)?v==(E=v.replace(/^data-cke-saved-/,""))||f[E]||(delete u[v],p=!0):(delete u[v],p=!0));if(!e.allStyles||e.hadInvalidStyle){for(v in T)e.allStyles||y[v]?O.push(v+":"+T[v]):p=!0;O.length&&(u.style=O.sort().join("; "))}else C&&(u.style=C);if(!e.allClasses||e.hadInvalidClass){for(v=0;v<c.length;++v)(e.allClasses||s[c[v]])&&l.push(c[v]);l.length&&(u["class"]=l.sort().join(" ")),h&&l.length<h.split(/\s+/).length&&(p=!0)}else h&&(u["class"]=h);if(p&&(a=L),!o.skipFinalValidation&&!g(i))return r.push(i),L}return o.toHtml&&(i.name=i.name.replace(H,"cke:$1")),a}function f(e){var t,i=[];for(t in e)t.indexOf("*")>-1&&i.push(t.replace(/\*/g,".*"));return i.length?RegExp("^(?:"+i.join("|")+")$"):null}function m(e){var t,i=e.attributes;delete i.style,delete i["class"],(t=CKEDITOR.tools.writeCssText(e.styles,!0))&&(i.style=t),e.classes.length&&(i["class"]=e.classes.sort().join(" "))}function g(e){switch(e.name){case"a":if(!e.children.length&&!e.attributes.name)return!1;break;case"img":if(!e.attributes.src)return!1}return!0}function y(e){if(!e)return!1;if(e===!0)return!0;var t=f(e);return function(i){return i in e||t&&i.match(t)}}function v(){return new CKEDITOR.htmlParser.element("br")}function E(e){return e.type==CKEDITOR.NODE_ELEMENT&&("br"==e.name||R.$block[e.name])}function T(e,t,i){var n=e.name;if(R.$empty[n]||!e.children.length)"hr"==n&&"br"==t?e.replaceWith(v()):(e.parent&&i.push({check:"it",el:e.parent}),e.remove());else if(R.$block[n]||"tr"==n)if("br"==t)e.previous&&!E(e.previous)&&(t=v(),t.insertBefore(e)),e.next&&!E(e.next)&&(t=v(),t.insertAfter(e)),e.replaceWithChildren();else{var r,n=e.children;e:{r=R[t];for(var o,s=0,a=n.length;s<a;++s)if(o=n[s],o.type==CKEDITOR.NODE_ELEMENT&&!r[o.name]){r=!1;break e}r=!0}if(r)e.name=t,e.attributes={},i.push({check:"parent-down",el:e});else{r=e.parent;for(var l,u,s=r.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||"body"==r.name,a=n.length;a>0;)o=n[--a],s&&(o.type==CKEDITOR.NODE_TEXT||o.type==CKEDITOR.NODE_ELEMENT&&R.$inline[o.name])?(l||(l=new CKEDITOR.htmlParser.element(t),l.insertAfter(e),i.push({check:"parent-down",el:l})),l.add(o,0)):(l=null,u=R[r.name]||R.span,o.insertAfter(e),r.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&o.type==CKEDITOR.NODE_ELEMENT&&!u[o.name]&&i.push({check:"el-up",el:o}));e.remove()}}else n in{style:1,script:1}?e.remove():(e.parent&&i.push({check:"it",el:e.parent}),e.replaceWithChildren())}function b(e,t,i){var n,r;for(n=0;n<i.length;++n)if(r=i[n],(!r.check||e.check(r.check,!1))&&(!r.left||r.left(t))){r.right(t,F);break}}function C(e,t){var i,n,r,o,s=t.getDefinition(),a=s.attributes,l=s.styles;if(e.name!=s.element)return!1;for(i in a)if("class"==i){for(s=a[i].split(/\s+/),r=e.classes.join("|");o=s.pop();)if(r.indexOf(o)==-1)return!1}else if(e.attributes[i]!=a[i])return!1;for(n in l)if(e.styles[n]!=l[n])return!1;return!0}function O(e,t){var i,n;return"string"==typeof e?i=e:e instanceof CKEDITOR.style?n=e:(i=e[0],n=e[1]),[{element:i,left:n,right:function(e,i){i.transform(e,t)}}]}function x(e){return function(t){return C(t,e)}}function w(e){return function(t,i){i[e](t)}}var R=CKEDITOR.dtd,L=1,S=CKEDITOR.tools.copy,_=CKEDITOR.tools.trim,I="cke-test",D=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2,CKEDITOR.filter=function(e){
if(this.allowedContent=[],this.disallowedContent=[],this.elementCallbacks=null,this.disabled=!1,this.editor=null,this.id=CKEDITOR.tools.getNextNumber(),this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{}},CKEDITOR.filter.instances[this.id]=this,e instanceof CKEDITOR.editor){e=this.editor=e,this.customConfig=!0;var t=e.config.allowedContent;t===!0?this.disabled=!0:(t||(this.customConfig=!1),this.allow(t,"config",1),this.allow(e.config.extraAllowedContent,"extra",1),this.allow(D[e.enterMode]+" "+D[e.shiftEnterMode],"default",1),this.disallow(e.config.disallowedContent))}else this.customConfig=!1,this.allow(e,"default",1)},CKEDITOR.filter.instances={},CKEDITOR.filter.prototype={allow:function(t,i,n){if(!o(this,t,n))return!1;var r,s;if("string"==typeof t)t=c(t);else if(t instanceof CKEDITOR.style){if(t.toAllowedContentRules)return this.allow(t.toAllowedContentRules(this.editor),i,n);r=t.getDefinition(),t={},n=r.attributes,t[r.element]=r={styles:r.styles,requiredStyles:r.styles&&CKEDITOR.tools.objectKeys(r.styles)},n&&(n=S(n),r.classes=n["class"]?n["class"].split(/\s+/):null,r.requiredClasses=r.classes,delete n["class"],r.attributes=n,r.requiredAttributes=n&&CKEDITOR.tools.objectKeys(n))}else if(CKEDITOR.tools.isArray(t)){for(r=0;r<t.length;++r)s=this.allow(t[r],i,n);return s}return e(this,t,i,this.allowedContent,this._.allowedRules),!0},applyTo:function(e,t,i,n){if(this.disabled)return!1;var r,o=this,s=[],a=this.editor&&this.editor.config.protectedSource,l=!1,u={doFilter:!i,doTransform:!0,doCallbacks:!0,toHtml:t};e.forEach(function(e){if(e.type==CKEDITOR.NODE_ELEMENT){if("off"==e.attributes["data-cke-filter"])return!1;if(!t||"span"!=e.name||!~CKEDITOR.tools.objectKeys(e.attributes).join("|").indexOf("data-cke-"))if(r=p(o,e,s,u),r&L)l=!0;else if(2&r)return!1}else if(e.type==CKEDITOR.NODE_COMMENT&&e.value.match(/^\{cke_protected\}(?!\{C\})/)){var i;e:{var n=decodeURIComponent(e.value.replace(/^\{cke_protected\}/,""));i=[];var c,h,d;if(a)for(h=0;h<a.length;++h)if((d=n.match(a[h]))&&d[0].length==n.length){i=!0;break e}n=CKEDITOR.htmlParser.fragment.fromHtml(n),1==n.children.length&&(c=n.children[0]).type==CKEDITOR.NODE_ELEMENT&&p(o,c,i,u),i=!i.length}i||s.push(e)}},null,!0),s.length&&(l=!0);for(var c,h,e=[],n=D[n||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)];i=s.pop();)i.type==CKEDITOR.NODE_ELEMENT?T(i,n,e):i.remove();for(;c=e.pop();)if(i=c.el,i.parent)switch(h=R[i.parent.name]||R.span,c.check){case"it":R.$removeEmpty[i.name]&&!i.children.length?T(i,n,e):g(i)||T(i,n,e);break;case"el-up":i.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!h[i.name]&&T(i,n,e);break;case"parent-down":i.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!h[i.name]&&T(i.parent,n,e)}return l},checkFeature:function(e){return!(!this.disabled&&e)||(e.toFeature&&(e=e.toFeature(this.editor)),!e.requiredContent||this.check(e.requiredContent))},disable:function(){this.disabled=!0},disallow:function(t){return!!o(this,t,!0)&&("string"==typeof t&&(t=c(t)),e(this,t,null,this.disallowedContent,this._.disallowedRules),!0)},addContentForms:function(e){if(!this.disabled&&e){var t,i,n,r=[];for(t=0;t<e.length&&!n;++t)i=e[t],("string"==typeof i||i instanceof CKEDITOR.style)&&this.check(i)&&(n=i);if(n){for(t=0;t<e.length;++t)r.push(O(e[t],n));this.addTransformations(r)}}},addElementCallback:function(e){this.elementCallbacks||(this.elementCallbacks=[]),this.elementCallbacks.push(e)},addFeature:function(e){return!(!this.disabled&&e)||(e.toFeature&&(e=e.toFeature(this.editor)),this.allow(e.allowedContent,e.name),this.addTransformations(e.contentTransformations),this.addContentForms(e.contentForms),!e.requiredContent||!this.customConfig&&!this.disallowedContent.length||this.check(e.requiredContent))},addTransformations:function(e){var t,i;if(!this.disabled&&e){var n,r=this._.transformations;for(n=0;n<e.length;++n){t=e[n];var o=void 0,s=void 0,a=void 0,l=void 0,u=void 0,c=void 0;for(i=[],s=0;s<t.length;++s)a=t[s],"string"==typeof a?(a=a.split(/\s*:\s*/),l=a[0],u=null,c=a[1]):(l=a.check,u=a.left,c=a.right),o||(o=a,o=o.element?o.element:l?l.match(/^([a-z0-9]+)/i)[0]:o.left.getDefinition().element),u instanceof CKEDITOR.style&&(u=x(u)),i.push({check:l==o?null:l,left:u,right:"string"==typeof c?w(c):c});t=o,r[t]||(r[t]=[]),r[t].push(i)}}},check:function(e,t,i){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(e)){for(var n=e.length;n--;)if(this.check(e[n],t,i))return!0;return!1}var r,o;if("string"==typeof e){if(o=e+"<"+(t===!1?"0":"1")+(i?"1":"0")+">",o in this._.cachedChecks)return this._.cachedChecks[o];n=c(e).$1,r=n.styles;var s=n.classes;n.name=n.elements,n.classes=s=s?s.split(/\s*,\s*/):[],n.styles=u(r),n.attributes=u(n.attributes),n.children=[],s.length&&(n.attributes["class"]=s.join(" ")),r&&(n.attributes.style=CKEDITOR.tools.writeCssText(n.styles)),r=n}else n=e.getDefinition(),r=n.styles,s=n.attributes||{},r?(r=S(r),s.style=CKEDITOR.tools.writeCssText(r,!0)):r={},r={name:n.element,attributes:s,classes:s["class"]?s["class"].split(/\s+/):[],styles:r,children:[]};var a,s=CKEDITOR.tools.clone(r),l=[];if(t!==!1&&(a=this._.transformations[r.name])){for(n=0;n<a.length;++n)b(this,r,a[n]);m(r)}return p(this,s,l,{doFilter:!0,doTransform:t!==!1,skipRequired:!i,skipFinalValidation:!i}),t=!(l.length>0)&&!!CKEDITOR.tools.objectCompare(r.attributes,s.attributes,!0),"string"==typeof e&&(this._.cachedChecks[o]=t),t},getAllowedEnterMode:function(){var e=["p","div","br"],t={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(i,n){var r,o=e.slice();if(this.check(D[i]))return i;for(n||(o=o.reverse());r=o.pop();)if(this.check(r))return t[r];return CKEDITOR.ENTER_BR}}(),destroy:function(){delete CKEDITOR.filter.instances[this.id],delete this._,delete this.allowedContent,delete this.disallowedContent}};var M={styles:1,attributes:1,classes:1},A={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},N=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,P={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},k=/^cke:(object|embed|param)$/,H=/^(object|embed|param)$/,F=CKEDITOR.filter.transformationsTools={sizeToStyle:function(e){this.lengthToStyle(e,"width"),this.lengthToStyle(e,"height")},sizeToAttribute:function(e){this.lengthToAttribute(e,"width"),this.lengthToAttribute(e,"height")},lengthToStyle:function(e,t,i){if(i=i||t,!(i in e.styles)){var n=e.attributes[t];n&&(/^\d+$/.test(n)&&(n+="px"),e.styles[i]=n)}delete e.attributes[t]},lengthToAttribute:function(e,t,i){if(i=i||t,!(i in e.attributes)){var n=e.styles[t],r=n&&n.match(/^(\d+)(?:\.\d*)?px$/);r?e.attributes[i]=r[1]:n==I&&(e.attributes[i]=I)}delete e.styles[t]},alignmentToStyle:function(e){if(!("float"in e.styles)){var t=e.attributes.align;"left"!=t&&"right"!=t||(e.styles["float"]=t)}delete e.attributes.align},alignmentToAttribute:function(e){if(!("align"in e.attributes)){var t=e.styles["float"];"left"!=t&&"right"!=t||(e.attributes.align=t)}delete e.styles["float"]},matchesStyle:C,transform:function(e,t){if("string"==typeof t)e.name=t;else{var i,n,r,o,s=t.getDefinition(),a=s.styles,l=s.attributes;e.name=s.element;for(i in l)if("class"==i)for(s=e.classes.join("|"),r=l[i].split(/\s+/);o=r.pop();)s.indexOf(o)==-1&&e.classes.push(o);else e.attributes[i]=l[i];for(n in a)e.styles[n]=a[n]}}}}(),function(){CKEDITOR.focusManager=function(e){return e.focusManager?e.focusManager:(this.hasFocus=!1,this.currentActive=null,this._={editor:e},this)},CKEDITOR.focusManager._={blurDelay:200},CKEDITOR.focusManager.prototype={focus:function(e){this._.timer&&clearTimeout(this._.timer),e&&(this.currentActive=e),this.hasFocus||this._.locked||((e=CKEDITOR.currentInstance)&&e.focusManager.blur(1),this.hasFocus=!0,(e=this._.editor.container)&&e.addClass("cke_focus"),this._.editor.fire("focus"))},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(e){function t(){if(this.hasFocus){this.hasFocus=!1;var e=this._.editor.container;e&&e.removeClass("cke_focus"),this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var i=CKEDITOR.focusManager._.blurDelay;e||!i?t.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer,t.call(this)},i,this)}},add:function(e,t){var i=e.getCustomData("focusmanager");if(!i||i!=this){i&&i.remove(e);var i="focus",n="blur";t&&(CKEDITOR.env.ie?(i="focusin",n="focusout"):CKEDITOR.event.useCapture=1);var r={blur:function(){e.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(e)}};e.on(i,r.focus,this),e.on(n,r.blur,this),t&&(CKEDITOR.event.useCapture=0),e.setCustomData("focusmanager",this),e.setCustomData("focusmanager_handlers",r)}},remove:function(e){e.removeCustomData("focusmanager");var t=e.removeCustomData("focusmanager_handlers");e.removeListener("blur",t.blur),e.removeListener("focus",t.focus)}}}(),CKEDITOR.keystrokeHandler=function(e){return e.keystrokeHandler?e.keystrokeHandler:(this.keystrokes={},this.blockedKeystrokes={},this._={editor:e},this)},function(){var e,t=function(t){var t=t.data,i=t.getKeystroke(),n=this.keystrokes[i],r=this._.editor;return e=r.fire("key",{keyCode:i,domEvent:t})===!1,e||(n&&(e=r.execCommand(n,{from:"keystrokeHandler"})!==!1),e||(e=!!this.blockedKeystrokes[i])),e&&t.preventDefault(!0),!e},i=function(t){e&&(e=!1,t.data.preventDefault(!0))};CKEDITOR.keystrokeHandler.prototype={attach:function(e){e.on("keydown",t,this),CKEDITOR.env.gecko&&CKEDITOR.env.mac&&e.on("keypress",i,this)}}}(),function(){CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(e,t,i){e&&CKEDITOR.lang.languages[e]||(e=this.detect(t,e));var n=this,t=function(){n[e].dir=n.rtl[e]?"rtl":"ltr",i(e,n[e])};this[e]?t():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+e+".js"),t,this)},detect:function(e,t){var i=this.languages,t=t||navigator.userLanguage||navigator.language||e,n=t.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),r=n[1],n=n[2];return i[r+"-"+n]?r=r+"-"+n:i[r]||(r=null),CKEDITOR.lang.detect=r?function(){return r}:function(e){return e},r||e}}}(),CKEDITOR.scriptLoader=function(){var e={},t={};return{load:function(i,n,r,o){var s="string"==typeof i;s&&(i=[i]),r||(r=CKEDITOR);var a=i.length,l=[],u=[],c=function(e){n&&(s?n.call(r,e):n.call(r,l,u))};if(0===a)c(!0);else{var h=function(e,t){(t?l:u).push(e),--a<=0&&(o&&CKEDITOR.document.getDocumentElement().removeStyle("cursor"),c(t))},d=function(i,n){e[i]=1;var r=t[i];delete t[i];for(var o=0;o<r.length;o++)r[o](i,n)},p=function(i){if(e[i])h(i,!0);else{var r=t[i]||(t[i]=[]);if(r.push(h),!(r.length>1)){var o=new CKEDITOR.dom.element("script");o.setAttributes({type:"text/javascript",src:i}),n&&(CKEDITOR.env.ie&&CKEDITOR.env.version<11?o.$.onreadystatechange=function(){"loaded"!=o.$.readyState&&"complete"!=o.$.readyState||(o.$.onreadystatechange=null,d(i,!0))}:(o.$.onload=function(){setTimeout(function(){d(i,!0)},0)},o.$.onerror=function(){d(i,!1)})),o.appendTo(CKEDITOR.document.getHead())}}};o&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var f=0;f<a;f++)p(i[f])}},queue:function(){function e(){var e;(e=t[0])&&this.load(e.scriptUrl,e.callback,CKEDITOR,0)}var t=[];return function(i,n){var r=this;t.push({scriptUrl:i,callback:function(){n&&n.apply(this,arguments),t.shift(),e.call(r)}}),1==t.length&&e.call(this)}}()}}(),CKEDITOR.resourceManager=function(e,t){this.basePath=e,this.fileName=t,this.registered={},this.loaded={},this.externals={},this._={waitingList:{}}},CKEDITOR.resourceManager.prototype={add:function(e,t){if(this.registered[e])throw'[CKEDITOR.resourceManager.add] The resource name "'+e+'" is already registered.';var i=this.registered[e]=t||{};return i.name=e,i.path=this.getPath(e),CKEDITOR.fire(e+CKEDITOR.tools.capitalize(this.fileName)+"Ready",i),this.get(e)},get:function(e){return this.registered[e]||null},getPath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(t&&t.dir||this.basePath+e+"/")},getFilePath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(this.getPath(e)+(t?t.file:this.fileName+".js"))},addExternal:function(e,t,i){for(var e=e.split(","),n=0;n<e.length;n++){var r=e[n];i||(t=t.replace(/[^\/]+$/,function(e){return i=e,""})),this.externals[r]={dir:t,file:i||this.fileName+".js"}}},load:function(e,t,i){CKEDITOR.tools.isArray(e)||(e=e?[e]:[]);for(var n=this.loaded,r=this.registered,o=[],s={},a={},l=0;l<e.length;l++){var u=e[l];if(u)if(n[u]||r[u])a[u]=this.get(u);else{var c=this.getFilePath(u);o.push(c),c in s||(s[c]=[]),s[c].push(u)}}CKEDITOR.scriptLoader.load(o,function(e,r){if(r.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+s[r[0]].join(",")+'" was not found at "'+r[0]+'".';for(var o=0;o<e.length;o++)for(var l=s[e[o]],u=0;u<l.length;u++){var c=l[u];a[c]=this.get(c),n[c]=1}t.call(i,a)},this)}},CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin"),CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(e){var t={};return function(i,n,r){var o={},s=function(i){e.call(this,i,function(e){CKEDITOR.tools.extend(o,e);var i,a=[];for(i in e){var l=e[i],u=l&&l.requires;if(!t[i]){if(l.icons)for(var c=l.icons.split(","),h=c.length;h--;)CKEDITOR.skin.addIcon(c[h],l.path+"icons/"+(CKEDITOR.env.hidpi&&l.hidpi?"hidpi/":"")+c[h]+".png");t[i]=1}if(u)for(u.split&&(u=u.split(",")),l=0;l<u.length;l++)o[u[l]]||a.push(u[l])}if(a.length)s.call(this,a);else{for(i in o)l=o[i],l.onLoad&&!l.onLoad._called&&(l.onLoad()===!1&&delete o[i],l.onLoad._called=1);n&&n.call(r||window,o)}},this)};s.call(this,i)}}),CKEDITOR.plugins.setLang=function(e,t,i){var n=this.get(e),e=n.langEntries||(n.langEntries={}),n=n.lang||(n.lang=[]);n.split&&(n=n.split(",")),CKEDITOR.tools.indexOf(n,t)==-1&&n.push(t),e[t]=i},CKEDITOR.ui=function(e){return e.ui?e.ui:(this.items={},this.instances={},this.editor=e,this._={handlers:{}},this)},CKEDITOR.ui.prototype={add:function(e,t,i){i.name=e.toLowerCase();var n=this.items[e]={type:t,command:i.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(n,i)},get:function(e){return this.instances[e]},create:function(e){var t=this.items[e],i=t&&this._.handlers[t.type],n=t&&t.command&&this.editor.getCommand(t.command),i=i&&i.create.apply(this,t.args);return this.instances[e]=i,n&&n.uiItems.push(i),i&&!i.type&&(i.type=t.type),i},addHandler:function(e,t){this._.handlers[e]=t},space:function(e){return CKEDITOR.document.getById(this.spaceId(e))},spaceId:function(e){return this.editor.id+"_"+e}},CKEDITOR.event.implementOn(CKEDITOR.ui),function(){function e(e,n,o){if(CKEDITOR.event.call(this),e=e&&CKEDITOR.tools.clone(e),void 0!==n){if(!(n instanceof CKEDITOR.dom.element))throw Error("Expect element of type CKEDITOR.dom.element.");if(!o)throw Error("One of the element modes must be specified.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&o==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(o==CKEDITOR.ELEMENT_MODE_INLINE?n.is(CKEDITOR.dtd.$editable)||n.is("textarea"):o==CKEDITOR.ELEMENT_MODE_REPLACE?!n.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+n.getName()+'".');this.element=n,this.elementMode=o,this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(n.getId()||n.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={},this.commands={},this.templates={},this.name=this.name||t(),this.id=CKEDITOR.tools.getNextId(),this.status="unloaded",this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config),this.ui=new CKEDITOR.ui(this),this.focusManager=new CKEDITOR.focusManager(this),this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this),this.on("readOnly",i),this.on("selectionChange",function(e){r(this,e.data.path)}),this.on("activeFilterChange",function(){r(this,this.elementPath(),!0)}),this.on("mode",i),this.on("instanceReady",function(){this.config.startupFocus&&this.focus()}),CKEDITOR.fire("instanceCreated",null,this),CKEDITOR.add(this),CKEDITOR.tools.setTimeout(function(){s(this,e)},0,this)}function t(){do var e="editor"+ ++d;while(CKEDITOR.instances[e]);return e}function i(){var e,t=this.commands;for(e in t)n(this,t[e])}function n(e,t){t[t.startDisabled?"disable":e.readOnly&&!t.readOnly?"disable":t.modes[e.mode]?"enable":"disable"]()}function r(e,t,i){if(t){var n,r,o=e.commands;for(r in o)n=o[r],(i||n.contextSensitive)&&n.refresh(e,t)}}function o(e){var t=e.config.customConfig;if(!t)return!1;var t=CKEDITOR.getUrl(t),i=p[t]||(p[t]={});return i.fn?(i.fn.call(e,e.config),(CKEDITOR.getUrl(e.config.customConfig)==t||!o(e))&&e.fireOnce("customConfigLoaded")):CKEDITOR.scriptLoader.queue(t,function(){i.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){},o(e)}),!0}function s(e,t){e.on("customConfigLoaded",function(){if(t){if(t.on)for(var i in t.on)e.on(i,t.on[i]);CKEDITOR.tools.extend(e.config,t,!0),delete e.config.on}i=e.config,e.readOnly=!(!i.readOnly&&!(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.is("textarea")?e.element.hasAttribute("disabled"):e.element.isReadOnly():e.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&e.element.hasAttribute("disabled"))),e.blockless=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&!(e.element.is("textarea")||CKEDITOR.dtd[e.element.getName()].p),e.tabIndex=i.tabIndex||e.element&&e.element.getAttribute("tabindex")||0,e.activeEnterMode=e.enterMode=e.blockless?CKEDITOR.ENTER_BR:i.enterMode,e.activeShiftEnterMode=e.shiftEnterMode=e.blockless?CKEDITOR.ENTER_BR:i.shiftEnterMode,i.skin&&(CKEDITOR.skinName=i.skin),e.fireOnce("configLoaded"),e.dataProcessor=new CKEDITOR.htmlDataProcessor(e),e.filter=e.activeFilter=new CKEDITOR.filter(e),a(e)}),t&&null!=t.customConfig&&(e.config.customConfig=t.customConfig),o(e)||e.fireOnce("customConfigLoaded")}function a(e){CKEDITOR.skin.loadPart("editor",function(){l(e)})}function l(e){CKEDITOR.lang.load(e.config.language,e.config.defaultLanguage,function(t,i){var n=e.config.title;e.langCode=t,e.lang=CKEDITOR.tools.prototypedCopy(i),e.title="string"==typeof n||n===!1?n:[e.lang.editor,e.name].join(", "),e.config.contentsLangDirection||(e.config.contentsLangDirection=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.getDirection(1):e.lang.dir),e.fire("langLoaded"),u(e)})}function u(e){e.getStylesSet(function(t){e.once("loaded",function(){e.fire("stylesSet",{styles:t})},null,null,1),c(e)})}function c(e){var t=e.config,i=t.plugins,n=t.extraPlugins,r=t.removePlugins;if(n)var o=RegExp("(?:^|,)(?:"+n.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),i=i.replace(o,""),i=i+(","+n);if(r)var s=RegExp("(?:^|,)(?:"+r.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),i=i.replace(s,"");CKEDITOR.env.air&&(i+=",adobeair"),CKEDITOR.plugins.load(i.split(","),function(i){var n=[],r=[],o=[];e.plugins=i;for(var a in i){var l,u=i[a],c=u.lang,h=null,d=u.requires;if(CKEDITOR.tools.isArray(d)&&(d=d.join(",")),d&&(l=d.match(s)))for(;d=l.pop();)CKEDITOR.tools.setTimeout(function(e,t){throw Error('Plugin "'+e.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+t+'" plugin.')},0,null,[d,a]);c&&!e.lang[a]&&(c.split&&(c=c.split(",")),CKEDITOR.tools.indexOf(c,e.langCode)>=0?h=e.langCode:(h=e.langCode.replace(/-.*/,""),h=h!=e.langCode&&CKEDITOR.tools.indexOf(c,h)>=0?h:CKEDITOR.tools.indexOf(c,"en")>=0?"en":c[0]),u.langEntries&&u.langEntries[h]?(e.lang[a]=u.langEntries[h],h=null):o.push(CKEDITOR.getUrl(u.path+"lang/"+h+".js"))),r.push(h),n.push(u)}CKEDITOR.scriptLoader.load(o,function(){for(var i=["beforeInit","init","afterInit"],o=0;o<i.length;o++)for(var s=0;s<n.length;s++){var a=n[s];0===o&&r[s]&&a.lang&&a.langEntries&&(e.lang[a.name]=a.langEntries[r[s]]),a[i[o]]&&a[i[o]](e)}for(e.fireOnce("pluginsLoaded"),t.keystrokes&&e.setKeystroke(e.config.keystrokes),s=0;s<e.config.blockedKeystrokes.length;s++)e.keystrokeHandler.blockedKeystrokes[e.config.blockedKeystrokes[s]]=1;e.status="loaded",e.fireOnce("loaded"),CKEDITOR.fire("instanceLoaded",null,e)})})}function h(){var e=this.element;if(e&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var t=this.getData();return this.config.htmlEncodeOutput&&(t=CKEDITOR.tools.htmlEncode(t)),e.is("textarea")?e.setValue(t):e.setHtml(t),!0}return!1}e.prototype=CKEDITOR.editor.prototype,CKEDITOR.editor=e;var d=0,p={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(e,t){t.name=e.toLowerCase();var i=new CKEDITOR.command(this,t);return this.mode&&n(this,i),this.commands[e]=i},_attachToForm:function(){function e(e){t.updateElement(),t._.required&&!i.getValue()&&t.fire("required")===!1&&e.data.preventDefault()}var t=this,i=t.element,n=new CKEDITOR.dom.element(i.$.form);i.is("textarea")&&n&&(n.on("submit",e),n.$.submit&&n.$.submit.call&&n.$.submit.apply&&(n.$.submit=CKEDITOR.tools.override(n.$.submit,function(t){return function(){e(),t.apply?t.apply(this):t()}})),t.on("destroy",function(){n.removeListener("submit",e)}))},destroy:function(e){this.fire("beforeDestroy"),!e&&h.call(this),this.editable(null),this.filter.destroy(),delete this.filter,delete this.activeFilter,this.status="destroyed",this.fire("destroy"),this.removeAllListeners(),CKEDITOR.remove(this),CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(e){if(!e){if(e=this.getSelection(),!e)return null;e=e.getStartElement()}return e?new CKEDITOR.dom.elementPath(e,this.editable()):null},createRange:function(){var e=this.editable();return e?new CKEDITOR.dom.range(e):null},execCommand:function(e,t){var i=this.getCommand(e),n={name:e,commandData:t,command:i};return!(!i||i.state==CKEDITOR.TRISTATE_DISABLED||this.fire("beforeCommandExec",n)===!1||(n.returnValue=i.exec(n.commandData),i.async||this.fire("afterCommandExec",n)===!1))&&n.returnValue},getCommand:function(e){return this.commands[e]},getData:function(e){!e&&this.fire("beforeGetData");var t=this._.data;return"string"!=typeof t&&(t=(t=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?t.is("textarea")?t.getValue():t.getHtml():""),t={dataValue:t},!e&&this.fire("getData",t),t.dataValue},getSnapshot:function(){var e=this.fire("getSnapshot");if("string"!=typeof e){var t=this.element;t&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(e=t.is("textarea")?t.getValue():t.getHtml())}return e},loadSnapshot:function(e){this.fire("loadSnapshot",e)},setData:function(e,t,i){var n=!0,r=t;t&&"object"==typeof t&&(i=t.internal,r=t.callback,n=!t.noSnapshot),!i&&n&&this.fire("saveSnapshot"),!r&&i||this.once("dataReady",function(e){!i&&n&&this.fire("saveSnapshot"),r&&r.call(e.editor)}),e={dataValue:e},!i&&this.fire("setData",e),this._.data=e.dataValue,!i&&this.fire("afterSetData",e)},setReadOnly:function(e){e=null==e||e,this.readOnly!=e&&(this.readOnly=e,this.keystrokeHandler.blockedKeystrokes[8]=+e,this.editable().setReadOnly(e),this.fire("readOnly"))},insertHtml:function(e,t){this.fire("insertHtml",{dataValue:e,mode:t})},insertText:function(e){this.fire("insertText",e)},insertElement:function(e){this.fire("insertElement",e)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return"ready"==this.status&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return h.call(this)},setKeystroke:function(){for(var e,t,i=this.keystrokeHandler.keystrokes,n=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],r=n.length;r--;)e=n[r],t=0,CKEDITOR.tools.isArray(e)&&(t=e[1],e=e[0]),t?i[e]=t:delete i[e]},addFeature:function(e){return this.filter.addFeature(e)},setActiveFilter:function(e){e||(e=this.filter),this.activeFilter!==e&&(this.activeFilter=e,this.fire("activeFilterChange"),e===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(e.getAllowedEnterMode(this.enterMode),e.getAllowedEnterMode(this.shiftEnterMode,!0)))},setActiveEnterMode:function(e,t){e=e?this.blockless?CKEDITOR.ENTER_BR:e:this.enterMode,t=t?this.blockless?CKEDITOR.ENTER_BR:t:this.shiftEnterMode,this.activeEnterMode==e&&this.activeShiftEnterMode==t||(this.activeEnterMode=e,this.activeShiftEnterMode=t,this.fire("activeEnterModeChange"))}})}(),CKEDITOR.ELEMENT_MODE_NONE=0,CKEDITOR.ELEMENT_MODE_REPLACE=1,CKEDITOR.ELEMENT_MODE_APPENDTO=2,CKEDITOR.ELEMENT_MODE_INLINE=3,CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\>)|(?:([^\/\s>]+)((?:\s+[\w\-:.]+(?:\s*=\s*?(?:(?:"[^"]*")|(?:'[^']*')|[^\s"'\/>]+))?)*)[\S\s]*?(\/?)>))/g}},function(){var e=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,t={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(i){for(var n,r,o,s=0;n=this._.htmlPartsRegex.exec(i);)if(r=n.index,r>s&&(s=i.substring(s,r),o?o.push(s):this.onText(s)),s=this._.htmlPartsRegex.lastIndex,!(r=n[1])||(r=r.toLowerCase(),o&&CKEDITOR.dtd.$cdata[r]&&(this.onCDATA(o.join("")),o=null),o))if(o)o.push(n[0]);else if(r=n[3]){if(r=r.toLowerCase(),!/="/.test(r)){var a,l={},u=n[4];if(n=!!n[5],u)for(;a=e.exec(u);){var c=a[1].toLowerCase();a=a[2]||a[3]||a[4]||"",l[c]=!a&&t[c]?c:CKEDITOR.tools.htmlDecodeAttr(a)}this.onTagOpen(r,l,n),!o&&CKEDITOR.dtd.$cdata[r]&&(o=[])}}else(r=n[2])&&this.onComment(r);else this.onTagClose(r);i.length>s&&this.onText(i.substring(s,i.length))}}}(),CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(e){this._.output.push("<",e)},openTagClose:function(e,t){t?this._.output.push(" />"):this._.output.push(">")},attribute:function(e,t){"string"==typeof t&&(t=CKEDITOR.tools.htmlEncodeAttr(t)),this._.output.push(" ",e,'="',t,'"')},closeTag:function(e){this._.output.push("</",e,">")},text:function(e){this._.output.push(e)},comment:function(e){this._.output.push("<!--",e,"-->")},write:function(e){this._.output.push(e)},reset:function(){this._.output=[],this._.indent=!1},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),t}}}),function(){CKEDITOR.htmlParser.node=function(){},CKEDITOR.htmlParser.node.prototype={remove:function(){var e=this.parent.children,t=CKEDITOR.tools.indexOf(e,this),i=this.previous,n=this.next;i&&(i.next=n),n&&(n.previous=i),e.splice(t,1),this.parent=null},replaceWith:function(e){var t=this.parent.children,i=CKEDITOR.tools.indexOf(t,this),n=e.previous=this.previous,r=e.next=this.next;n&&(n.next=e),r&&(r.previous=e),t[i]=e,e.parent=this.parent,this.parent=null},insertAfter:function(e){var t=e.parent.children,i=CKEDITOR.tools.indexOf(t,e),n=e.next;t.splice(i+1,0,this),this.next=e.next,this.previous=e,e.next=this,n&&(n.previous=this),this.parent=e.parent},insertBefore:function(e){var t=e.parent.children,i=CKEDITOR.tools.indexOf(t,e);t.splice(i,0,this),this.next=e,(this.previous=e.previous)&&(e.previous.next=this),e.previous=this,this.parent=e.parent},getAscendant:function(e){for(var t=("function"==typeof e?e:"string"==typeof e?function(t){return t.name==e}:function(t){return t.name in e}),i=this.parent;i&&i.type==CKEDITOR.NODE_ELEMENT;){if(t(i))return i;i=i.parent}return null},wrapWith:function(e){return this.replaceWith(e),e.add(this),e},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(e){return e||{}}}}(),CKEDITOR.htmlParser.comment=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(e,t){var i=this.value;return(i=e.onComment(t,i,this))?"string"!=typeof i?(this.replaceWith(i),!1):(this.value=i,!0):(this.remove(),!1)},writeHtml:function(e,t){t&&this.filter(t),e.comment(this.value)}}),function(){CKEDITOR.htmlParser.text=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(e,t){if(!(this.value=e.onText(t,this.value,this)))return this.remove(),!1},writeHtml:function(e,t){t&&this.filter(t),e.text(this.value)}})}(),function(){CKEDITOR.htmlParser.cdata=function(e){this.value=e},CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(e){e.write(this.value)}})}(),CKEDITOR.htmlParser.fragment=function(){this.children=[],this.parent=null,this._={isBlockLike:!0,hasInlineStarted:!1}},function(){function e(e){return!e.attributes["data-cke-survive"]&&("a"==e.name&&e.attributes.href||CKEDITOR.dtd.$removeEmpty[e.name])}var t=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),i={ol:1,ul:1},n=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),r={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(o,s,a){function l(e){var t;if(g.length>0)for(var i=0;i<g.length;i++){var n=g[i],r=n.name,o=CKEDITOR.dtd[r],s=v.name&&CKEDITOR.dtd[v.name];s&&!s[r]||e&&o&&!o[e]&&CKEDITOR.dtd[e]?r==v.name&&(h(v,v.parent,1),i--):(t||(u(),t=1),n=n.clone(),n.parent=v,v=n,g.splice(i,1),i--)}}function u(){for(;y.length;)h(y.shift(),v)}function c(e){if(e._.isBlockLike&&"pre"!=e.name&&"textarea"!=e.name){var t,i=e.children.length,n=e.children[i-1];n&&n.type==CKEDITOR.NODE_TEXT&&((t=CKEDITOR.tools.rtrim(n.value))?n.value=t:e.children.length=i-1)}}function h(t,i,n){var i=i||v||m,r=v;void 0===t.previous&&(d(i,t)&&(v=i,f.onTagOpen(a,{}),t.returnPoint=i=v),c(t),(!e(t)||t.children.length)&&i.add(t),"pre"==t.name&&(T=!1),"textarea"==t.name&&(E=!1)),t.returnPoint?(v=t.returnPoint,delete t.returnPoint):v=n?i:r}function d(e,t){if((e==m||"body"==e.name)&&a&&(!e.name||CKEDITOR.dtd[e.name][a])){var i,n;return(i=t.attributes&&(n=t.attributes["data-cke-real-element-type"])?n:t.name)&&i in CKEDITOR.dtd.$inline&&!(i in CKEDITOR.dtd.head)&&!t.isOrphan||t.type==CKEDITOR.NODE_TEXT}}function p(e,t){return(e in CKEDITOR.dtd.$listItem||e in CKEDITOR.dtd.$tableContent)&&(e==t||"dt"==e&&"dd"==t||"dd"==e&&"dt"==t)}var f=new CKEDITOR.htmlParser,m=s instanceof CKEDITOR.htmlParser.element?s:"string"==typeof s?new CKEDITOR.htmlParser.element(s):new CKEDITOR.htmlParser.fragment,g=[],y=[],v=m,E="textarea"==m.name,T="pre"==m.name;f.onTagOpen=function(r,o,s,a){if(o=new CKEDITOR.htmlParser.element(r,o),o.isUnknown&&s&&(o.isEmpty=!0),o.isOptionalClose=a,e(o))g.push(o);else{if("pre"==r)T=!0;else{if("br"==r&&T)return void v.add(new CKEDITOR.htmlParser.text("\n"));"textarea"==r&&(E=!0)}if("br"==r)y.push(o);else{for(;a=(s=v.name)?CKEDITOR.dtd[s]||(v._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):n,!(o.isUnknown||v.isUnknown||a[r]);)if(v.isOptionalClose)f.onTagClose(s);else if(r in i&&s in i)s=v.children,(s=s[s.length-1])&&"li"==s.name||h(s=new CKEDITOR.htmlParser.element("li"),v),!o.returnPoint&&(o.returnPoint=v),v=s;else if(r in CKEDITOR.dtd.$listItem&&!p(r,s))f.onTagOpen("li"==r?"ul":"dl",{},0,1);else if(s in t&&!p(r,s))!o.returnPoint&&(o.returnPoint=v),v=v.parent;else{if(s in CKEDITOR.dtd.$inline&&g.unshift(v),!v.parent){o.isOrphan=1;break}h(v,v.parent,1)}l(r),u(),o.parent=v,o.isEmpty?h(o):v=o}}},f.onTagClose=function(e){for(var t=g.length-1;t>=0;t--)if(e==g[t].name)return void g.splice(t,1);for(var i=[],n=[],r=v;r!=m&&r.name!=e;)r._.isBlockLike||n.unshift(r),i.push(r),r=r.returnPoint||r.parent;if(r!=m){for(t=0;t<i.length;t++){var o=i[t];h(o,o.parent)}v=r,r._.isBlockLike&&u(),h(r,r.parent),r==v&&(v=v.parent),g=g.concat(n)}"body"==e&&(a=!1);
},f.onText=function(e){if(v._.hasInlineStarted&&!y.length||T||E||(e=CKEDITOR.tools.ltrim(e),0!==e.length)){var i=v.name,o=i?CKEDITOR.dtd[i]||(v._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):n;!E&&!o["#"]&&i in t?(f.onTagOpen(r[i]||""),f.onText(e)):(u(),l(),!T&&!E&&(e=e.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")),e=new CKEDITOR.htmlParser.text(e),d(v,e)&&this.onTagOpen(a,{},0,1),v.add(e))}},f.onCDATA=function(e){v.add(new CKEDITOR.htmlParser.cdata(e))},f.onComment=function(e){u(),l(),v.add(new CKEDITOR.htmlParser.comment(e))},f.parse(o);for(u();v!=m;)h(v,v.parent,1);return c(m),m},CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(e,t){isNaN(t)&&(t=this.children.length);var i=t>0?this.children[t-1]:null;if(i){if(e._.isBlockLike&&i.type==CKEDITOR.NODE_TEXT&&(i.value=CKEDITOR.tools.rtrim(i.value),0===i.value.length))return this.children.pop(),void this.add(e);i.next=e}e.previous=i,e.parent=this,this.children.splice(t,0,e),this._.hasInlineStarted||(this._.hasInlineStarted=e.type==CKEDITOR.NODE_TEXT||e.type==CKEDITOR.NODE_ELEMENT&&!e._.isBlockLike)},filter:function(e,t){t=this.getFilterContext(t),e.onRoot(t,this),this.filterChildren(e,!1,t)},filterChildren:function(e,t,i){if(this.childrenFilteredBy!=e.id)for(i=this.getFilterContext(i),t&&!this.parent&&e.onRoot(i,this),this.childrenFilteredBy=e.id,t=0;t<this.children.length;t++)this.children[t].filter(e,i)===!1&&t--},writeHtml:function(e,t){t&&this.filter(t),this.writeChildrenHtml(e)},writeChildrenHtml:function(e,t,i){var n=this.getFilterContext();for(i&&!this.parent&&t&&t.onRoot(n,this),t&&this.filterChildren(t,!1,n),t=0,i=this.children,n=i.length;t<n;t++)i[t].writeHtml(e)},forEach:function(e,t,i){if(!(i||t&&this.type!=t))var n=e(this);if(n!==!1)for(var i=this.children,r=0;r<i.length;r++)n=i[r],n.type==CKEDITOR.NODE_ELEMENT?n.forEach(e,t):(!t||n.type==t)&&e(n)},getFilterContext:function(e){return e||{}}}}(),function(){function e(){this.rules=[]}function t(t,i,n,r){var o,s;for(o in i)(s=t[o])||(s=t[o]=new e),s.add(i[o],n,r)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(t){this.id=CKEDITOR.tools.getNextNumber(),this.elementNameRules=new e,this.attributeNameRules=new e,this.elementsRules={},this.attributesRules={},this.textRules=new e,this.commentRules=new e,this.rootRules=new e,t&&this.addRules(t,10)},proto:{addRules:function(e,i){var n;"number"==typeof i?n=i:i&&"priority"in i&&(n=i.priority),"number"!=typeof n&&(n=10),"object"!=typeof i&&(i={}),e.elementNames&&this.elementNameRules.addMany(e.elementNames,n,i),e.attributeNames&&this.attributeNameRules.addMany(e.attributeNames,n,i),e.elements&&t(this.elementsRules,e.elements,n,i),e.attributes&&t(this.attributesRules,e.attributes,n,i),e.text&&this.textRules.add(e.text,n,i),e.comment&&this.commentRules.add(e.comment,n,i),e.root&&this.rootRules.add(e.root,n,i)},applyTo:function(e){e.filter(this)},onElementName:function(e,t){return this.elementNameRules.execOnName(e,t)},onAttributeName:function(e,t){return this.attributeNameRules.execOnName(e,t)},onText:function(e,t,i){return this.textRules.exec(e,t,i)},onComment:function(e,t,i){return this.commentRules.exec(e,t,i)},onRoot:function(e,t){return this.rootRules.exec(e,t)},onElement:function(e,t){for(var i,n=[this.elementsRules["^"],this.elementsRules[t.name],this.elementsRules.$],r=0;r<3;r++)if(i=n[r]){if(i=i.exec(e,t,this),i===!1)return null;if(i&&i!=t)return this.onNode(e,i);if(t.parent&&!t.name)break}return t},onNode:function(e,t){var i=t.type;return i==CKEDITOR.NODE_ELEMENT?this.onElement(e,t):i==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(e,t.value)):i==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(e,t.value)):null},onAttribute:function(e,t,i,n){return(i=this.attributesRules[i])?i.exec(e,n,t,this):n}}}),CKEDITOR.htmlParser.filterRulesGroup=e,e.prototype={add:function(e,t,i){this.rules.splice(this.findIndex(t),0,{value:e,priority:t,options:i})},addMany:function(e,t,i){for(var n=[this.findIndex(t),0],r=0,o=e.length;r<o;r++)n.push({value:e[r],priority:t,options:i});this.rules.splice.apply(this.rules,n)},findIndex:function(e){for(var t=this.rules,i=t.length-1;i>=0&&e<t[i].priority;)i--;return i+1},exec:function(e,t){var i,n,r,o,s=t instanceof CKEDITOR.htmlParser.node||t instanceof CKEDITOR.htmlParser.fragment,a=Array.prototype.slice.call(arguments,1),l=this.rules,u=l.length;for(o=0;o<u;o++)if(s&&(i=t.type,n=t.name),r=l[o],!(e.nonEditable&&!r.options.applyToAll||e.nestedEditable&&r.options.excludeNestedEditable)){if(r=r.value.apply(null,a),r===!1||s&&r&&(r.name!=n||r.type!=i))return r;null!=r&&(a[0]=t=r)}return t},execOnName:function(e,t){for(var i,n=0,r=this.rules,o=r.length;t&&n<o;n++)i=r[n],!(e.nonEditable&&!i.options.applyToAll||e.nestedEditable&&i.options.excludeNestedEditable)&&(t=t.replace(i.value[0],i.value[1]));return t}}}(),function(){function e(e,t){function a(e){return e||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function l(e,t){return function(r){if(r.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var s,l,c=[],h=i(r);if(h)for(u(h,1)&&c.push(h);h;)o(h)&&(s=n(h))&&u(s)&&((l=n(s))&&!o(l)?c.push(s):(a(d).insertAfter(s),s.remove())),h=h.previous;for(h=0;h<c.length;h++)c[h].remove();(c=!e||("function"==typeof t?t(r):t)!==!1)&&((d||CKEDITOR.env.needsBrFiller||r.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT)&&(d||CKEDITOR.env.needsBrFiller||!(document.documentMode>7||r.name in CKEDITOR.dtd.tr||r.name in CKEDITOR.dtd.$listItem))?(c=i(r),c=!c||"form"==r.name&&"input"==c.name):c=!1),c&&r.add(a(e))}}}function u(e,t){if((!d||CKEDITOR.env.needsBrFiller)&&e.type==CKEDITOR.NODE_ELEMENT&&"br"==e.name&&!e.attributes["data-cke-eol"])return!0;var i;if(e.type==CKEDITOR.NODE_TEXT&&(i=e.value.match(g))){if(i.index&&(new CKEDITOR.htmlParser.text(e.value.substring(0,i.index)).insertBefore(e),e.value=i[0]),!CKEDITOR.env.needsBrFiller&&d&&(!t||e.parent.name in p))return!0;if(!d&&((i=e.previous)&&"br"==i.name||!i||o(i)))return!0}return!1}var c,h={elements:{}},d="html"==t,p=CKEDITOR.tools.extend({},T);for(c in p)"#"in v[c]||delete p[c];for(c in p)h.elements[c]=l(d,e.config.fillEmptyBlocks);return h.root=l(d,!1),h.elements.br=function(e){return function(t){if(t.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var i=t.attributes;if("data-cke-bogus"in i||"data-cke-eol"in i)delete i["data-cke-bogus"];else{for(i=t.next;i&&r(i);)i=i.next;var l=n(t);!i&&o(t.parent)?s(t.parent,a(e)):o(i)&&l&&!o(l)&&a(e).insertBefore(i)}}}}(d),h}function t(e,t){return e!=CKEDITOR.ENTER_BR&&t!==!1&&(e==CKEDITOR.ENTER_DIV?"div":"p")}function i(e){for(e=e.children[e.children.length-1];e&&r(e);)e=e.previous;return e}function n(e){for(e=e.previous;e&&r(e);)e=e.previous;return e}function r(e){return e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(e.value)||e.type==CKEDITOR.NODE_ELEMENT&&e.attributes["data-cke-bookmark"]}function o(e){return e&&(e.type==CKEDITOR.NODE_ELEMENT&&e.name in T||e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function s(e,t){var i=e.children[e.children.length-1];e.children.push(t),t.parent=e,i&&(i.next=t,t.previous=i)}function a(e){e=e.attributes,"false"!=e.contenteditable&&(e["data-cke-editable"]=e.contenteditable?"true":1),e.contenteditable="false"}function l(e){switch(e=e.attributes,e["data-cke-editable"]){case"true":e.contenteditable="true";break;case"1":delete e.contenteditable}}function u(e){return e.replace(w,function(e,t,i){return"<"+t+i.replace(R,function(e,t){return L.test(t)&&i.indexOf("data-cke-saved-"+t)==-1?" data-cke-saved-"+e+" data-cke-"+CKEDITOR.rnd+"-"+e:e})+">"})}function c(e,t){return e.replace(t,function(e,t,i){return 0===e.indexOf("<textarea")&&(e=t+p(i).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>"),"<cke:encoded>"+encodeURIComponent(e)+"</cke:encoded>"})}function h(e){return e.replace(I,function(e,t){return decodeURIComponent(t)})}function d(e){return e.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(e){return"<!--"+y+"{C}"+encodeURIComponent(e).replace(/--/g,"%2D%2D")+"-->"})}function p(e){return e.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(e,t){return decodeURIComponent(t)})}function f(e,t){var i=t._.dataStore;return e.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(e,t){return decodeURIComponent(t)}).replace(/\{cke_protected_(\d+)\}/g,function(e,t){return i&&i[t]||""})}function m(e,t){for(var i=[],n=t.config.protectedSource,r=t._.dataStore||(t._.dataStore={id:1}),o=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,n=[/<script[\s\S]*?(<\/script>|$)/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(n),e=e.replace(/<\!--[\s\S]*?--\>/g,function(e){return"<!--{cke_tempcomment}"+(i.push(e)-1)+"-->"}),s=0;s<n.length;s++)e=e.replace(n[s],function(e){return e=e.replace(o,function(e,t,n){return i[n]}),/cke_temp(comment)?/.test(e)?e:"<!--{cke_temp}"+(i.push(e)-1)+"-->"});return e=e.replace(o,function(e,t,n){return"<!--"+y+(t?"{C}":"")+encodeURIComponent(i[n]).replace(/--/g,"%2D%2D")+"-->"}),e=e.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=\/>]+))+\s*\/?>/g,function(e){return e.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(e,t){return r[r.id]=decodeURIComponent(t),"{cke_protected_"+r.id++ +"}"})}),e=e.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(e,i,n,r){return"<"+i+n+">"+f(p(r),t)+"</"+i+">"})}CKEDITOR.htmlDataProcessor=function(i){var n,r,o=this;this.editor=i,this.dataFilter=n=new CKEDITOR.htmlParser.filter,this.htmlFilter=r=new CKEDITOR.htmlParser.filter,this.writer=new CKEDITOR.htmlParser.basicWriter,n.addRules(b),n.addRules(C,{applyToAll:!0}),n.addRules(e(i,"data"),{applyToAll:!0}),r.addRules(O),r.addRules(x,{applyToAll:!0}),r.addRules(e(i,"html"),{applyToAll:!0}),i.on("toHtml",function(e){var n,e=e.data,r=e.dataValue,r=m(r,i),r=c(r,_),r=u(r),r=c(r,S),r=r.replace(D,"$1cke:$2"),r=r.replace(A,"<cke:$1$2></cke:$1>"),r=r.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),r=r.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2");n=e.context||i.editable().getName();var o;CKEDITOR.env.ie&&CKEDITOR.env.version<9&&"pre"==n&&(n="div",r="<pre>"+r+"</pre>",o=1),n=i.document.createElement(n),n.setHtml("a"+r),r=n.getHtml().substr(1),r=r.replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),""),o&&(r=r.replace(/^<pre>|<\/pre>$/gi,"")),r=r.replace(M,"$1$2"),r=h(r),r=p(r),n=e.fixForBody!==!1&&t(e.enterMode,i.config.autoParagraph),r=CKEDITOR.htmlParser.fragment.fromHtml(r,e.context,n),n&&(o=r,!o.children.length&&CKEDITOR.dtd[o.name][n]&&(n=new CKEDITOR.htmlParser.element(n),o.add(n))),e.dataValue=r},null,null,5),i.on("toHtml",function(e){e.data.filter.applyTo(e.data.dataValue,!0,e.data.dontFilter,e.data.enterMode)&&i.fire("dataFiltered")},null,null,6),i.on("toHtml",function(e){e.data.dataValue.filterChildren(o.dataFilter,!0)},null,null,10),i.on("toHtml",function(e){var e=e.data,t=e.dataValue,i=new CKEDITOR.htmlParser.basicWriter;t.writeChildrenHtml(i),t=i.getHtml(!0),e.dataValue=d(t)},null,null,15),i.on("toDataFormat",function(e){var n=e.data.dataValue;e.data.enterMode!=CKEDITOR.ENTER_BR&&(n=n.replace(/^<br *\/?>/i,"")),e.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(n,e.data.context,t(e.data.enterMode,i.config.autoParagraph))},null,null,5),i.on("toDataFormat",function(e){e.data.dataValue.filterChildren(o.htmlFilter,!0)},null,null,10),i.on("toDataFormat",function(e){e.data.filter.applyTo(e.data.dataValue,!1,!0)},null,null,11),i.on("toDataFormat",function(e){var t=e.data.dataValue,n=o.writer;n.reset(),t.writeChildrenHtml(n),t=n.getHtml(!0),t=p(t),t=f(t,i),e.data.dataValue=t},null,null,15)},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(e,t,i,n){var r,o,s,a=this.editor;return t&&"object"==typeof t?(r=t.context,i=t.fixForBody,n=t.dontFilter,o=t.filter,s=t.enterMode):r=t,!r&&null!==r&&(r=a.editable().getName()),a.fire("toHtml",{dataValue:e,context:r,fixForBody:i,dontFilter:n,filter:o||a.filter,enterMode:s||a.enterMode}).dataValue},toDataFormat:function(e,t){var i,n,r;return t&&(i=t.context,n=t.filter,r=t.enterMode),!i&&null!==i&&(i=this.editor.editable().getName()),this.editor.fire("toDataFormat",{dataValue:e,filter:n||this.editor.filter,context:i,enterMode:r||this.editor.enterMode}).dataValue}};var g=/(?:&nbsp;|\xa0)$/,y="{cke_protected}",v=CKEDITOR.dtd,E=["caption","colgroup","col","thead","tfoot","tbody"],T=CKEDITOR.tools.extend({},v.$blockLimit,v.$block),b={elements:{input:a,textarea:a}},C={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},O={elements:{embed:function(e){var t=e.parent;if(t&&"object"==t.name){var i=t.attributes.width,t=t.attributes.height;i&&(e.attributes.width=i),t&&(e.attributes.height=t)}},a:function(e){if(!e.children.length&&!e.attributes.name&&!e.attributes["data-cke-saved-name"])return!1}}},x={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(e){var t=e.attributes;if(t){if(t["data-cke-temp"])return!1;for(var i,n=["name","href","src"],r=0;r<n.length;r++)i="data-cke-saved-"+n[r],i in t&&delete t[n[r]]}return e},table:function(e){e.children.slice(0).sort(function(e,t){var i,n;return e.type==CKEDITOR.NODE_ELEMENT&&t.type==e.type&&(i=CKEDITOR.tools.indexOf(E,e.name),n=CKEDITOR.tools.indexOf(E,t.name)),i>-1&&n>-1&&i!=n||(i=e.parent?e.getIndex():-1,n=t.parent?t.getIndex():-1),i>n?1:-1})},param:function(e){return e.children=[],e.isEmpty=!0,e},span:function(e){"Apple-style-span"==e.attributes["class"]&&delete e.name},html:function(e){delete e.attributes.contenteditable,delete e.attributes["class"]},body:function(e){delete e.attributes.spellcheck,delete e.attributes.contenteditable},style:function(e){var t=e.children[0];t&&t.value&&(t.value=CKEDITOR.tools.trim(t.value)),e.attributes.type||(e.attributes.type="text/css")},title:function(e){var t=e.children[0];!t&&s(e,t=new CKEDITOR.htmlParser.text),t.value=e.attributes["data-cke-title"]||""},input:l,textarea:l},attributes:{"class":function(e){return CKEDITOR.tools.ltrim(e.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(x.attributes.style=function(e){return e.replace(/(^|;)([^\:]+)/g,function(e){return e.toLowerCase()})});var w=/<(a|area|img|input|source)\b([^>]*)>/gi,R=/([\w-:]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,L=/^(href|src|name)$/i,S=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,_=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,I=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,D=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,M=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,A=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi}(),CKEDITOR.htmlParser.element=function(e,t){this.name=e,this.attributes=t||{},this.children=[];var i=e||"",n=i.match(/^cke:(.*)/);n&&(i=n[1]),i=!!(CKEDITOR.dtd.$nonBodyContent[i]||CKEDITOR.dtd.$block[i]||CKEDITOR.dtd.$listItem[i]||CKEDITOR.dtd.$tableContent[i]||CKEDITOR.dtd.$nonEditable[i]||"br"==i),this.isEmpty=!!CKEDITOR.dtd.$empty[e],this.isUnknown=!CKEDITOR.dtd[e],this._={isBlockLike:i,hasInlineStarted:this.isEmpty||!i}},CKEDITOR.htmlParser.cssStyle=function(e){var t={};return((e instanceof CKEDITOR.htmlParser.element?e.attributes.style:e)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,i,n){"font-family"==i&&(n=n.replace(/["']/g,"")),t[i.toLowerCase()]=n}),{rules:t,populate:function(e){var t=this.toString();t&&(e instanceof CKEDITOR.dom.element?e.setAttribute("style",t):e instanceof CKEDITOR.htmlParser.element?e.attributes.style=t:e.style=t)},toString:function(){var e,i=[];for(e in t)t[e]&&i.push(e,":",t[e],";");return i.join("")}}},function(){function e(e){return function(t){return t.type==CKEDITOR.NODE_ELEMENT&&("string"==typeof e?t.name==e:t.name in e)}}var t=function(e,t){return e=e[0],t=t[0],e<t?-1:e>t?1:0},i=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:i.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(e,t){var i,n,r=this,t=r.getFilterContext(t);if(t.off)return!0;for(r.parent||e.onRoot(t,r);;){if(i=r.name,!(n=e.onElementName(t,i)))return this.remove(),!1;if(r.name=n,!(r=e.onElement(t,r)))return this.remove(),!1;if(r!==this)return this.replaceWith(r),!1;if(r.name==i)break;if(r.type!=CKEDITOR.NODE_ELEMENT)return this.replaceWith(r),!1;if(!r.name)return this.replaceWithChildren(),!1}i=r.attributes;var o,s;for(o in i){for(s=o,n=i[o];;){if(!(s=e.onAttributeName(t,o))){delete i[o];break}if(s==o)break;delete i[o],o=s}s&&((n=e.onAttribute(t,r,s,n))===!1?delete i[s]:i[s]=n)}return r.isEmpty||this.filterChildren(e,!1,t),!0},filterChildren:i.filterChildren,writeHtml:function(e,i){i&&this.filter(i);var n,r,o=this.name,s=[],a=this.attributes;e.openTag(o,a);for(n in a)s.push([n,a[n]]);for(e.sortAttributes&&s.sort(t),n=0,r=s.length;n<r;n++)a=s[n],e.attribute(a[0],a[1]);e.openTagClose(o,this.isEmpty),this.writeChildrenHtml(e),this.isEmpty||e.closeTag(o)},writeChildrenHtml:i.writeChildrenHtml,replaceWithChildren:function(){for(var e=this.children,t=e.length;t;)e[--t].insertAfter(this);this.remove()},forEach:i.forEach,getFirst:function(t){if(!t)return this.children.length?this.children[0]:null;"function"!=typeof t&&(t=e(t));for(var i=0,n=this.children.length;i<n;++i)if(t(this.children[i]))return this.children[i];return null},getHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeChildrenHtml(e),e.getHtml()},setHtml:function(e){for(var e=this.children=CKEDITOR.htmlParser.fragment.fromHtml(e).children,t=0,i=e.length;t<i;++t)e[t].parent=this},getOuterHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeHtml(e),e.getHtml()},split:function(e){for(var t=this.children.splice(e,this.children.length-e),i=this.clone(),n=0;n<t.length;++n)t[n].parent=i;return i.children=t,t[0]&&(t[0].previous=null),e>0&&(this.children[e-1].next=null),this.parent.add(i,this.getIndex()+1),i},addClass:function(e){if(!this.hasClass(e)){var t=this.attributes["class"]||"";this.attributes["class"]=t+(t?" ":"")+e}},removeClass:function(e){var t=this.attributes["class"];t&&((t=CKEDITOR.tools.trim(t.replace(RegExp("(?:\\s+|^)"+e+"(?:\\s+|$)")," ")))?this.attributes["class"]=t:delete this.attributes["class"])},hasClass:function(e){var t=this.attributes["class"];return!!t&&RegExp("(?:^|\\s)"+e+"(?=\\s|$)").test(t)},getFilterContext:function(e){var t=[];if(e||(e={off:!1,nonEditable:!1,nestedEditable:!1}),!e.off&&"off"==this.attributes["data-cke-processor"]&&t.push("off",!0),e.nonEditable||"false"!=this.attributes.contenteditable?e.nonEditable&&!e.nestedEditable&&"true"==this.attributes.contenteditable&&t.push("nestedEditable",!0):t.push("nonEditable",!0),t.length)for(var e=CKEDITOR.tools.copy(e),i=0;i<t.length;i+=2)e[t[i]]=t[i+1];return e}},!0)}(),function(){var e={},t=/{([^}]+)}/g,i=/([\\'])/g,n=/\n/g,r=/\r/g;CKEDITOR.template=function(o){if(e[o])this.output=e[o];else{var s=o.replace(i,"\\$1").replace(n,"\\n").replace(r,"\\r").replace(t,function(e,t){return"',data['"+t+"']==undefined?'{"+t+"}':data['"+t+"'],'"});this.output=e[o]=Function("data","buffer","return buffer?buffer.push('"+s+"'):['"+s+"'].join('');")}}}(),delete CKEDITOR.loadFullCore,CKEDITOR.instances={},CKEDITOR.document=new CKEDITOR.dom.document(document),CKEDITOR.add=function(e){CKEDITOR.instances[e.name]=e,e.on("focus",function(){CKEDITOR.currentInstance!=e&&(CKEDITOR.currentInstance=e,CKEDITOR.fire("currentInstance"))}),e.on("blur",function(){CKEDITOR.currentInstance==e&&(CKEDITOR.currentInstance=null,CKEDITOR.fire("currentInstance"))}),CKEDITOR.fire("instance",null,e)},CKEDITOR.remove=function(e){delete CKEDITOR.instances[e.name]},function(){var e={};CKEDITOR.addTemplate=function(t,i){var n=e[t];return n?n:(n={name:t,source:i},CKEDITOR.fire("template",n),e[t]=new CKEDITOR.template(n.source))},CKEDITOR.getTemplate=function(t){return e[t]}}(),function(){var e=[];CKEDITOR.addCss=function(t){e.push(t)},CKEDITOR.getCss=function(){return e.join("\n")}}(),CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")}),CKEDITOR.TRISTATE_ON=1,CKEDITOR.TRISTATE_OFF=2,CKEDITOR.TRISTATE_DISABLED=0,function(){CKEDITOR.inline=function(e,t){if(!CKEDITOR.env.isCompatible)return null;if(e=CKEDITOR.dom.element.get(e),e.getEditor())throw'The editor instance "'+e.getEditor().name+'" is already attached to the provided element.';var i=new CKEDITOR.editor(t,e,CKEDITOR.ELEMENT_MODE_INLINE),n=e.is("textarea")?e:null;return n?(i.setData(n.getValue(),null,!0),e=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!i.readOnly+'" class="cke_textarea_inline">'+n.getValue()+"</div>",CKEDITOR.document),e.insertAfter(n),n.hide(),n.$.form&&i._attachToForm()):i.setData(e.getHtml(),null,!0),i.on("loaded",function(){i.fire("uiReady"),i.editable(e),i.container=e,i.setData(i.getData(1)),i.resetDirty(),i.fire("contentDom"),i.mode="wysiwyg",i.fire("mode"),i.status="ready",i.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,i)},null,null,1e4),i.on("destroy",function(){n&&(i.container.clearCustomData(),i.container.remove(),n.show()),i.element.clearCustomData(),delete i.element}),i},CKEDITOR.inlineAll=function(){var e,t,i;for(i in CKEDITOR.dtd.$editable)for(var n=CKEDITOR.document.getElementsByTag(i),r=0,o=n.count();r<o;r++)e=n.getItem(r),"true"==e.getAttribute("contenteditable")&&(t={element:e,config:{}},CKEDITOR.fire("inline",t)!==!1&&CKEDITOR.inline(e,t.config))},CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})}(),CKEDITOR.replaceClass="ckeditor",function(){function e(e,n,r,o){if(!CKEDITOR.env.isCompatible)return null;if(e=CKEDITOR.dom.element.get(e),e.getEditor())throw'The editor instance "'+e.getEditor().name+'" is already attached to the provided element.';var s=new CKEDITOR.editor(n,e,o);return o==CKEDITOR.ELEMENT_MODE_REPLACE&&(e.setStyle("visibility","hidden"),s._.required=e.hasAttribute("required"),e.removeAttribute("required")),r&&s.setData(r,null,!0),s.on("loaded",function(){i(s),o==CKEDITOR.ELEMENT_MODE_REPLACE&&s.config.autoUpdateElement&&e.$.form&&s._attachToForm(),s.setMode(s.config.startupMode,function(){s.resetDirty(),s.status="ready",s.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,s)})}),s.on("destroy",t),s}function t(){var e=this.container,t=this.element;e&&(e.clearCustomData(),e.remove()),t&&(t.clearCustomData(),this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(t.show(),this._.required&&t.setAttribute("required","required")),delete this.element)}function i(e){var t=e.name,i=e.element,n=e.elementMode,r=e.fire("uiSpace",{space:"top",html:""}).html,o=e.fire("uiSpace",{space:"bottom",html:""}).html,s=new CKEDITOR.template('<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application"'+(e.title?' aria-labelledby="cke_{name}_arialbl"':"")+">"+(e.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':"")+'<{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>'),t=CKEDITOR.dom.element.createFromHtml(s.output({id:e.id,name:t,langDir:e.lang.dir,langCode:e.langCode,voiceLabel:e.title,topHtml:r?'<span id="'+e.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+r+"</span>":"",contentId:e.ui.spaceId("contents"),bottomHtml:o?'<span id="'+e.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+o+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"}));n==CKEDITOR.ELEMENT_MODE_REPLACE?(i.hide(),t.insertAfter(i)):i.append(t),e.container=t,r&&e.ui.space("top").unselectable(),o&&e.ui.space("bottom").unselectable(),i=e.config.width,n=e.config.height,i&&t.setStyle("width",CKEDITOR.tools.cssLength(i)),n&&e.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(n)),t.disableContextMenu(),CKEDITOR.env.webkit&&t.on("focus",function(){e.focus()}),e.fireOnce("uiReady")}CKEDITOR.replace=function(t,i){return e(t,i,null,CKEDITOR.ELEMENT_MODE_REPLACE)},CKEDITOR.appendTo=function(t,i,n){return e(t,i,n,CKEDITOR.ELEMENT_MODE_APPENDTO)},CKEDITOR.replaceAll=function(){for(var e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var i=null,n=e[t];if(n.name||n.id){if("string"==typeof arguments[0]){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(n.className))continue}else if("function"==typeof arguments[0]&&(i={},arguments[0](n,i)===!1))continue;this.replace(n,i)}}},CKEDITOR.editor.prototype.addMode=function(e,t){(this._.modes||(this._.modes={}))[e]=t},CKEDITOR.editor.prototype.setMode=function(e,t){var i=this,n=this._.modes;if(e!=i.mode&&n&&n[e]){if(i.fire("beforeSetMode",e),i.mode){var r,o=i.checkDirty(),n=i._.previousModeData,s=0;i.fire("beforeModeUnload"),i.editable(0),i._.previousMode=i.mode,i._.previousModeData=r=i.getData(1),"source"==i.mode&&n==r&&(i.fire("lockSnapshot",{forceUpdate:!0}),s=1),i.ui.space("contents").setHtml(""),i.mode=""}else i._.previousModeData=i.getData(1);this._.modes[e](function(){i.mode=e,void 0!==o&&!o&&i.resetDirty(),s?i.fire("unlockSnapshot"):"wysiwyg"==e&&i.fire("saveSnapshot"),setTimeout(function(){i.fire("mode"),t&&t.call(i)},0)})}},CKEDITOR.editor.prototype.resize=function(e,t,i,n){var r=this.container,o=this.ui.space("contents"),s=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement,n=n?this.container.getFirst(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_inner")}):r;n.setSize("width",e,!0),s&&(s.style.width="1%"),o.setStyle("height",Math.max(t-(i?0:(n.$.offsetHeight||0)-(o.$.clientHeight||0)),0)+"px"),s&&(s.style.width="100%"),this.fire("resize")},CKEDITOR.editor.prototype.getResizable=function(e){return e?this.ui.space("contents"):this.container},CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})}(),CKEDITOR.config.startupMode="wysiwyg",function(){function e(e){var i,r=e.editor,o=e.data.path,a=o.blockLimit,l=e.data.selection,u=l.getRanges()[0];(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&(l=t(l,o))&&(l.appendBogus(),i=CKEDITOR.env.ie),s(r,o.block,a)&&u.collapsed&&!u.getCommonAncestor().isReadOnly()&&(o=u.clone(),o.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),a=new CKEDITOR.dom.walker(o),a.guard=function(e){return!n(e)||e.type==CKEDITOR.NODE_COMMENT||e.isReadOnly()},(!a.checkForward()||o.checkStartOfBlock()&&o.checkEndOfBlock())&&(r=u.fixBlock(!0,r.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(r=r.getFirst(n))&&r.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(r.getText()).match(/^(?:&nbsp;|\xa0)$/)&&r.remove(),i=1,e.cancel())),i&&u.select()}function t(e,t){if(e.isFake)return 0;var i=t.block||t.blockLimit,r=i&&i.getLast(n);return!i||!i.isBlockBoundary()||r&&r.type==CKEDITOR.NODE_ELEMENT&&r.isBlockBoundary()||i.is("pre")||i.getBogus()?void 0:i}function i(e){var t=e.data.getTarget();t.is("input")&&(t=t.getAttribute("type"),("submit"==t||"reset"==t)&&e.data.preventDefault())}function n(e){return d(e)&&p(e)}function r(e,t){return function(i){var n=CKEDITOR.dom.element.get(i.data.$.toElement||i.data.$.fromElement||i.data.$.relatedTarget);(!n||!t.equals(n)&&!t.contains(n))&&e.call(this,i)}}function o(e){function t(e){return function(t,r){if(r&&t.type==CKEDITOR.NODE_ELEMENT&&t.is(o)&&(i=t),!r&&n(t)&&(!e||!c(t)))return!1}}var i,r=e.getRanges()[0],e=e.root,o={table:1,ul:1,ol:1,dl:1};if(r.startPath().contains(o)){var s=r.clone();if(s.collapse(1),s.setStartAt(e,CKEDITOR.POSITION_AFTER_START),e=new CKEDITOR.dom.walker(s),e.guard=t(),e.checkBackward(),i)return s=r.clone(),s.collapse(),s.setEndAt(i,CKEDITOR.POSITION_AFTER_END),e=new CKEDITOR.dom.walker(s),e.guard=t(!0),i=!1,e.checkForward(),i}return null}function s(e,t,i){return e.config.autoParagraph!==!1&&e.activeEnterMode!=CKEDITOR.ENTER_BR&&e.editable().equals(i)&&!t||t&&"true"==t.getAttribute("contenteditable")}function a(e){e.editor.focus(),e.editor.fire("saveSnapshot")}function l(e){var t=e.editor;t.getSelection().scrollIntoView(),setTimeout(function(){t.fire("saveSnapshot")},0)}function u(e,t,i){for(var n=e.getCommonAncestor(t),t=e=i?t:e;(e=e.getParent())&&!n.equals(e)&&1==e.getChildCount();)t=e;t.remove()}CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(e,t){this.base(t.$||t),this.editor=e,this.status="unloaded",this.hasFocus=!1,this.setup()},proto:{focus:function(){var e;if(CKEDITOR.env.webkit&&!this.hasFocus&&(e=this.editor._.previousActive||this.getDocument().getActive(),this.contains(e)))return void e.focus();try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(t){if(!CKEDITOR.env.ie)throw t}CKEDITOR.env.safari&&!this.isInline()&&(e=CKEDITOR.document.getActive(),e.equals(this.getWindow().getFrame())||this.getWindow().focus())},on:function(e,t){var i=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(e)&&(e="focus"==e?"focusin":"focusout",t=r(t,this),i[0]=e,i[1]=t),CKEDITOR.dom.element.prototype.on.apply(this,i)},attachListener:function(e){!this._.listeners&&(this._.listeners=[]);var t=Array.prototype.slice.call(arguments,1),t=e.on.apply(e,t);return this._.listeners.push(t),t},clearListeners:function(){var e=this._.listeners;try{for(;e.length;)e.pop().removeListener()}catch(t){}},restoreAttrs:function(){var e,t,i=this._.attrChanges;for(t in i)i.hasOwnProperty(t)&&(e=i[t],null!==e?this.setAttribute(t,e):this.removeAttribute(t))},attachClass:function(e){var t=this.getCustomData("classes");this.hasClass(e)||(!t&&(t=[]),t.push(e),this.setCustomData("classes",t),this.addClass(e))},changeAttr:function(e,t){var i=this.getAttribute(e);t!==i&&(!this._.attrChanges&&(this._.attrChanges={}),e in this._.attrChanges||(this._.attrChanges[e]=i),this.setAttribute(e,t))},insertHtml:function(e,t){a(this),f(this,t||"html",e)},insertText:function(e){a(this);var t=this.editor,i=t.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:t.activeEnterMode,t=i==CKEDITOR.ENTER_BR,n=CKEDITOR.tools,e=n.htmlEncode(e.replace(/\r\n/g,"\n")),e=e.replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),i=i==CKEDITOR.ENTER_P?"p":"div";if(!t){var r=/\n{2}/g;if(r.test(e))var o="<"+i+">",s="</"+i+">",e=o+e.replace(r,function(){return s+o})+s}e=e.replace(/\n/g,"<br>"),t||(e=e.replace(RegExp("<br>(?=</"+i+">)"),function(e){return n.repeat(e,2)})),e=e.replace(/^ | $/g,"&nbsp;"),e=e.replace(/(>|\s) /g,function(e,t){return t+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;"),f(this,"text",e)},insertElement:function(e,t){t?this.insertElementIntoRange(e,t):this.insertElementIntoSelection(e)},insertElementIntoRange:function(e,t){var i=this.editor,n=i.config.enterMode,r=e.getName(),o=CKEDITOR.dtd.$block[r];if(t.checkReadOnly())return!1;t.deleteContents(1),t.startContainer.type==CKEDITOR.NODE_ELEMENT&&t.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&m(t);var s,a;if(o)for(;(s=t.getCommonAncestor(0,1))&&(a=CKEDITOR.dtd[s.getName()])&&(!a||!a[r]);)s.getName()in CKEDITOR.dtd.span?t.splitElement(s):t.checkStartOfBlock()&&t.checkEndOfBlock()?(t.setStartBefore(s),t.collapse(!0),s.remove()):t.splitBlock(n==CKEDITOR.ENTER_DIV?"div":"p",i.editable());return t.insertNode(e),!0},insertElementIntoSelection:function(e){a(this);var t=this.editor,i=t.activeEnterMode,t=t.getSelection(),r=t.getRanges()[0],o=e.getName(),o=CKEDITOR.dtd.$block[o];this.insertElementIntoRange(e,r)&&(r.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),o&&((o=e.getNext(function(e){return n(e)&&!c(e)}))&&o.type==CKEDITOR.NODE_ELEMENT&&o.is(CKEDITOR.dtd.$block)?o.getDtd()["#"]?r.moveToElementEditStart(o):r.moveToElementEditEnd(e):o||i==CKEDITOR.ENTER_BR||(o=r.fixBlock(!0,i==CKEDITOR.ENTER_DIV?"div":"p"),r.moveToElementEditStart(o)))),t.selectRanges([r]),l(this)},setData:function(e,t){
t||(e=this.editor.dataProcessor.toHtml(e)),this.setHtml(e),this.fixInitialSelection(),"unloaded"==this.status&&(this.status="ready"),this.editor.fire("dataReady")},getData:function(e){var t=this.getHtml();return e||(t=this.editor.dataProcessor.toDataFormat(t)),t},setReadOnly:function(e){this.setAttribute("contenteditable",!e)},detach:function(){this.removeClass("cke_editable"),this.status="detached";var e=this.editor;this._.detach(),delete e.document,delete e.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function e(){var e,t=i.getDocument().$,n=t.getSelection();if(n.anchorNode&&n.anchorNode==i.$)e=!0;else if(CKEDITOR.env.webkit){var r=i.getDocument().getActive();r&&r.equals(i)&&!n.anchorNode&&(e=!0)}e&&(e=new CKEDITOR.dom.range(i),e.moveToElementEditStart(i),t=t.createRange(),t.setStart(e.startContainer.$,e.startOffset),t.collapse(!0),n.removeAllRanges(),n.addRange(t))}function t(){var e=i.getDocument().$,t=e.selection,n=i.getDocument().getActive();"None"==t.type&&n.equals(i)&&(t=new CKEDITOR.dom.range(i),e=e.body.createTextRange(),t.moveToElementEditStart(i),t=t.startContainer,t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),e.moveToElementText(t.$),e.collapse(!0),e.select())}var i=this;CKEDITOR.env.ie&&(CKEDITOR.env.version<9||CKEDITOR.env.quirks)?this.hasFocus&&(this.focus(),t()):this.hasFocus?(this.focus(),e()):this.once("focus",function(){e()},null,null,-999)},setup:function(){var e=this.editor;if(this.attachListener(e,"beforeGetData",function(){var t=this.getData();this.is("textarea")||e.config.ignoreEmptyParagraph!==!1&&(t=t.replace(h,function(e,t){return t})),e.setData(t,null,1)},this),this.attachListener(e,"getSnapshot",function(e){e.data=this.getData(1)},this),this.attachListener(e,"afterSetData",function(){this.setData(e.getData(1))},this),this.attachListener(e,"loadSnapshot",function(e){this.setData(e.data,1)},this),this.attachListener(e,"beforeFocus",function(){var t=e.getSelection();(t=t&&t.getNative())&&"Control"==t.type||this.focus()},this),this.attachListener(e,"insertHtml",function(e){this.insertHtml(e.data.dataValue,e.data.mode)},this),this.attachListener(e,"insertElement",function(e){this.insertElement(e.data)},this),this.attachListener(e,"insertText",function(e){this.insertText(e.data)},this),this.setReadOnly(e.readOnly),this.attachClass("cke_editable"),this.attachClass(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"cke_editable_inline":e.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||e.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO?"cke_editable_themed":""),this.attachClass("cke_contents_"+e.config.contentsLangDirection),e.keystrokeHandler.blockedKeystrokes[8]=+e.readOnly,e.keystrokeHandler.attach(this),this.on("blur",function(){this.hasFocus=!1},null,null,-1),this.on("focus",function(){this.hasFocus=!0},null,null,-1),e.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,e.once("contentDom",function(){e.focusManager.focus(this)},this)),this.isInline()&&this.changeAttr("tabindex",e.tabIndex),!this.is("textarea")){e.document=this.getDocument(),e.window=this.getWindow();var t=e.document;this.changeAttr("spellcheck",!e.config.disableNativeSpellChecker);var r=e.config.contentsLangDirection;this.getDirection(1)!=r&&this.changeAttr("dir",r);var s=CKEDITOR.getCss();s&&(r=t.getHead(),r.getCustomData("stylesheet")||(s=t.appendStyleText(s),s=new CKEDITOR.dom.element(s.ownerNode||s.owningElement),r.setCustomData("stylesheet",s),s.data("cke-temp",1))),r=t.getCustomData("stylesheet_ref")||0,t.setCustomData("stylesheet_ref",r+1),this.setCustomData("cke_includeReadonly",!e.config.disableReadonlyStyling),this.attachListener(this,"click",function(e){var e=e.data,t=new CKEDITOR.dom.elementPath(e.getTarget(),this).contains("a");t&&2!=e.$.button&&t.isReadOnly()&&e.preventDefault()});var a={8:1,46:1};this.attachListener(e,"key",function(t){if(e.readOnly)return!0;var i,n=t.data.domEvent.getKey();if(n in a){var r,s,l,u,t=e.getSelection(),c=t.getRanges()[0],h=c.startPath(),n=8==n;CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(r=t.getSelectedElement())||(r=o(t))?(e.fire("saveSnapshot"),c.moveToPosition(r,CKEDITOR.POSITION_BEFORE_START),r.remove(),c.select(),e.fire("saveSnapshot"),i=1):c.collapsed&&((s=h.block)&&(u=s[n?"getPrevious":"getNext"](d))&&u.type==CKEDITOR.NODE_ELEMENT&&u.is("table")&&c[n?"checkStartOfBlock":"checkEndOfBlock"]()?(e.fire("saveSnapshot"),c[n?"checkEndOfBlock":"checkStartOfBlock"]()&&s.remove(),c["moveToElementEdit"+(n?"End":"Start")](u),c.select(),e.fire("saveSnapshot"),i=1):h.blockLimit&&h.blockLimit.is("td")&&(l=h.blockLimit.getAscendant("table"))&&c.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(u=l[n?"getPrevious":"getNext"](d))?(e.fire("saveSnapshot"),c["moveToElementEdit"+(n?"End":"Start")](u),c.checkStartOfBlock()&&c.checkEndOfBlock()?u.remove():c.select(),e.fire("saveSnapshot"),i=1):(l=h.contains(["td","th","caption"]))&&c.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(i=1))}return!i}),e.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(t){t.data.getKeystroke()in a&&!this.getFirst(n)&&(this.appendBogus(),t=e.createRange(),t.moveToPosition(this,CKEDITOR.POSITION_AFTER_START),t.select())}),this.attachListener(this,"dblclick",function(t){return!e.readOnly&&(t={element:t.data.getTarget()},void e.fire("doubleclick",t))}),CKEDITOR.env.ie&&this.attachListener(this,"click",i),CKEDITOR.env.ie||this.attachListener(this,"mousedown",function(t){var i=t.data.getTarget();i.is("img","hr","input","textarea","select")&&!i.isReadOnly()&&(e.getSelection().selectElement(i),i.is("input","textarea","select")&&t.data.preventDefault())}),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(t){if(2==t.data.$.button&&(t=t.data.getTarget(),!t.getOuterHtml().replace(h,""))){var i=e.createRange();i.moveToElementEditStart(t),i.select(!0)}}),CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(e){e.data.getTarget().is("input","select")&&e.data.preventDefault()}),this.attachListener(this,"mouseup",function(e){e.data.getTarget().is("input","textarea")&&e.data.preventDefault()})),CKEDITOR.env.webkit&&this.attachListener(e,"key",function(t){if(e.readOnly)return!0;if(t=t.data.domEvent.getKey(),t in a){var i=8==t,n=e.getSelection().getRanges()[0],t=n.startPath();if(n.collapsed){var r;e:{var o=t.block;if(o)if(n[i?"checkStartOfBlock":"checkEndOfBlock"]())if(n.moveToClosestEditablePosition(o,!i)&&n.collapsed){if(n.startContainer.type==CKEDITOR.NODE_ELEMENT){var s=n.startContainer.getChild(n.startOffset-(i?1:0));if(s&&s.type==CKEDITOR.NODE_ELEMENT&&s.is("hr")){e.fire("saveSnapshot"),s.remove(),r=!0;break e}}if((n=n.startPath().block)&&(!n||!n.contains(o))){e.fire("saveSnapshot");var l;(l=(i?n:o).getBogus())&&l.remove(),r=e.getSelection(),l=r.createBookmarks(),(i?o:n).moveChildren(i?n:o,!1),t.lastElement.mergeSiblings(),u(o,n,!i),r.selectBookmarks(l),r=!0}}else r=!1;else r=!1;else r=!1}if(!r)return}else if(i=n,r=t.block,l=i.endPath().block,r&&l&&!r.equals(l)?(e.fire("saveSnapshot"),(o=r.getBogus())&&o.remove(),i.deleteContents(),l.getParent()&&(l.moveChildren(r,!1),t.lastElement.mergeSiblings(),u(r,l,!0)),i=e.getSelection().getRanges()[0],i.collapse(1),i.select(),t=!0):t=!1,!t)return;return e.getSelection().scrollIntoView(),e.fire("saveSnapshot"),!1}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1),this.clearListeners(),this.restoreAttrs();var e;if(e=this.removeCustomData("classes"))for(;e.length;)this.removeClass(e.pop());if(!this.is("textarea")){e=this.getDocument();var t=e.getHead();if(t.getCustomData("stylesheet")){var i=e.getCustomData("stylesheet_ref");--i?e.setCustomData("stylesheet_ref",i):(e.removeCustomData("stylesheet_ref"),t.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload"),delete this.editor}}}),CKEDITOR.editor.prototype.editable=function(e){var t=this._.editable;return t&&e?0:(arguments.length&&(t=this._.editable=e?e instanceof CKEDITOR.editable?e:new CKEDITOR.editable(this,e):(t&&t.detach(),null)),t)};var c=CKEDITOR.dom.walker.bogus(),h=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,d=CKEDITOR.dom.walker.whitespaces(!0),p=CKEDITOR.dom.walker.bookmark(!1,!0);CKEDITOR.on("instanceLoaded",function(t){var i=t.editor;i.on("insertElement",function(e){e=e.data,e.type==CKEDITOR.NODE_ELEMENT&&(e.is("input")||e.is("textarea"))&&("false"!=e.getAttribute("contentEditable")&&e.data("cke-editable",e.hasAttribute("contenteditable")?"true":"1"),e.setAttribute("contentEditable",!1))}),i.on("selectionChange",function(t){if(!i.readOnly){var n=i.getSelection();n&&!n.isLocked&&(n=i.checkDirty(),i.fire("lockSnapshot"),e(t),i.fire("unlockSnapshot"),!n&&i.resetDirty())}})}),CKEDITOR.on("instanceCreated",function(e){var t=e.editor;t.on("mode",function(){var e=t.editable();if(e&&e.isInline()){var i=t.title;e.changeAttr("role","textbox"),e.changeAttr("aria-label",i),i&&e.changeAttr("title",i);var n=t.fire("ariaEditorHelpLabel",{}).label;if(n&&(i=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents"))){var r=CKEDITOR.tools.getNextId(),n=CKEDITOR.dom.element.createFromHtml('<span id="'+r+'" class="cke_voice_label">'+n+"</span>");i.append(n),e.changeAttr("aria-describedby",r)}}})}),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var f=function(){function e(e){return e.type==CKEDITOR.NODE_ELEMENT}function t(i,n){var r,o,s,a,l=[],c=n.range.startContainer;r=n.range.startPath();for(var c=u[c.getName()],h=0,d=i.getChildren(),p=d.count(),f=-1,m=-1,g=0,y=r.contains(u.$list);h<p;++h)r=d.getItem(h),e(r)?(s=r.getName(),y&&s in CKEDITOR.dtd.$list?l=l.concat(t(r,n)):(a=!!c[s],"br"!=s||!r.data("cke-eol")||h&&h!=p-1||(g=(o=h?l[h-1].node:d.getItem(h+1))&&(!e(o)||!o.is("br")),o=o&&e(o)&&u.$block[o.getName()]),f==-1&&!a&&(f=h),a||(m=h),l.push({isElement:1,isLineBreak:g,isBlock:r.isBlockBoundary(),hasBlockSibling:o,node:r,name:s,allowed:a}),o=g=0)):l.push({isElement:0,node:r,allowed:1});return f>-1&&(l[f].firstNotAllowed=1),m>-1&&(l[m].lastNotAllowed=1),l}function i(t,n){var r,o=[],s=t.getChildren(),a=s.count(),l=0,c=u[n],h=!t.is(u.$inline)||t.is("br");for(h&&o.push(" ");l<a;l++)r=s.getItem(l),e(r)&&!r.is(c)?o=o.concat(i(r,n)):o.push(r);return h&&o.push(" "),o}function r(t){return t&&e(t)&&(t.is(u.$removeEmpty)||t.is("a")&&!t.isBlockBoundary())}function o(t,i,n,r){var s,a,l=t.clone();l.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),(s=new CKEDITOR.dom.walker(l).next())&&e(s)&&c[s.getName()]&&(a=s.getPrevious())&&e(a)&&!a.getParent().equals(t.startContainer)&&n.contains(a)&&r.contains(s)&&s.isIdentical(a)&&(s.moveChildren(a),s.remove(),o(t,i,n,r))}function a(t,i){function n(t,i){if(i.isBlock&&i.isElement&&!i.node.is("br")&&e(t)&&t.is("br"))return t.remove(),1}var r=i.endContainer.getChild(i.endOffset),o=i.endContainer.getChild(i.endOffset-1);r&&n(r,t[t.length-1]),o&&n(o,t[0])&&(i.setEnd(i.endContainer,i.endOffset-1),i.collapse())}var u=CKEDITOR.dtd,c={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},h={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},d=CKEDITOR.tools.extend({},u.$inline);return delete d.br,function(c,p,f){var m=c.editor,g=m.getSelection().getRanges()[0],y=!1;if("unfiltered_html"==p&&(p="html",y=!0),!g.checkReadOnly()){var v,E,T,b,C=new CKEDITOR.dom.elementPath(g.startContainer,g.root).blockLimit||g.root,p={type:p,dontFilter:y,editable:c,editor:m,range:g,blockLimit:C,mergeCandidates:[],zombies:[]},m=p.range,y=p.mergeCandidates;if("text"==p.type&&m.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(v=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",m.document),m.insertNode(v),m.setStartAfter(v)),E=new CKEDITOR.dom.elementPath(m.startContainer),p.endPath=T=new CKEDITOR.dom.elementPath(m.endContainer),!m.collapsed){var C=T.block||T.blockLimit,O=m.getCommonAncestor();C&&!C.equals(O)&&!C.contains(O)&&m.checkEndOfBlock()&&p.zombies.push(C),m.deleteContents()}for(;(b=e(m.startContainer)&&m.startContainer.getChild(m.startOffset-1))&&e(b)&&b.isBlockBoundary()&&E.contains(b);)m.moveToPosition(b,CKEDITOR.POSITION_BEFORE_END);for(o(m,p.blockLimit,E,T),v&&(m.setEndBefore(v),m.collapse(),v.remove()),v=m.startPath(),(C=v.contains(r,!1,1))&&(m.splitElement(C),p.inlineStylesRoot=C,p.inlineStylesPeak=v.lastElement),v=m.createBookmark(),(C=v.startNode.getPrevious(n))&&e(C)&&r(C)&&y.push(C),(C=v.startNode.getNext(n))&&e(C)&&r(C)&&y.push(C),C=v.startNode;(C=C.getParent())&&r(C);)y.push(C);if(m.moveToBookmark(v),v=f){if(v=p.range,"text"==p.type&&p.inlineStylesRoot){for(b=p.inlineStylesPeak,m=b.getDocument().createText("{cke-peak}"),y=p.inlineStylesRoot.getParent();!b.equals(y);)m=m.appendTo(b.clone()),b=b.getParent();f=m.getOuterHtml().split("{cke-peak}").join(f)}if(b=p.blockLimit.getName(),/^\s+|\s+$/.test(f)&&"span"in CKEDITOR.dtd[b])var x='<span data-cke-marker="1">&nbsp;</span>',f=x+f+x;if(f=p.editor.dataProcessor.toHtml(f,{context:null,fixForBody:!1,dontFilter:p.dontFilter,filter:p.editor.activeFilter,enterMode:p.editor.activeEnterMode}),b=v.document.createElement("body"),b.setHtml(f),x&&(b.getFirst().remove(),b.getLast().remove()),(x=v.startPath().block)&&(1!=x.getChildCount()||!x.getBogus()))e:{var w;if(1==b.getChildCount()&&e(w=b.getFirst())&&w.is(h)){for(x=w.getElementsByTag("*"),v=0,y=x.count();v<y;v++)if(m=x.getItem(v),!m.is(d))break e;w.moveChildren(w.getParent(1)),w.remove()}}p.dataWrapper=b,v=f}if(v){w=p.range;var R,x=w.document,f=p.blockLimit;v=0;var L;b=[];var S,_,I,D,y=m=0;E=w.startContainer;var M,C=p.endPath.elements[0];for(T=C.getPosition(E),O=!(!C.getCommonAncestor(E)||T==CKEDITOR.POSITION_IDENTICAL||T&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED),E=t(p.dataWrapper,p),a(E,w);v<E.length;v++){if(T=E[v],R=T.isLineBreak){R=w,I=f;var A=void 0,N=void 0;T.hasBlockSibling?R=1:(A=R.startContainer.getAscendant(u.$block,1),A&&A.is({div:1,p:1})?(N=A.getPosition(I),N==CKEDITOR.POSITION_IDENTICAL||N==CKEDITOR.POSITION_CONTAINS?R=0:(I=R.splitElement(A),R.moveToPosition(I,CKEDITOR.POSITION_AFTER_START),R=1)):R=0)}if(R)y=v>0;else{if(R=w.startPath(),!T.isBlock&&s(p.editor,R.block,R.blockLimit)&&(_=p.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&p.editor.config.autoParagraph!==!1&&(p.editor.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"))&&(_=x.createElement(_),_.appendBogus(),w.insertNode(_),CKEDITOR.env.needsBrFiller&&(L=_.getBogus())&&L.remove(),w.moveToPosition(_,CKEDITOR.POSITION_BEFORE_END)),(R=w.startPath().block)&&!R.equals(S)&&((L=R.getBogus())&&(L.remove(),b.push(R)),S=R),T.firstNotAllowed&&(m=1),m&&T.isElement){for(R=w.startContainer,I=null;R&&!u[R.getName()][T.name];){if(R.equals(f)){R=null;break}I=R,R=R.getParent()}if(R)I&&(D=w.splitElement(I),p.zombies.push(D),p.zombies.push(I));else{I=f.getName(),M=!v,R=v==E.length-1,I=i(T.node,I);for(var A=[],N=I.length,P=0,k=void 0,H=0,F=-1;P<N;P++)k=I[P]," "==k?(H||M&&!P||(A.push(new CKEDITOR.dom.text(" ")),F=A.length),H=1):(A.push(k),H=0);R&&F==A.length&&A.pop(),M=A}}if(M){for(;R=M.pop();)w.insertNode(R);M=0}else w.insertNode(T.node);T.lastNotAllowed&&v<E.length-1&&((D=O?C:D)&&w.setEndAt(D,CKEDITOR.POSITION_AFTER_START),m=0),w.collapse()}}p.dontMoveCaret=y,p.bogusNeededBlocks=b}L=p.range;var B;for(D=p.bogusNeededBlocks,M=L.createBookmark();S=p.zombies.pop();)S.getParent()&&(_=L.clone(),_.moveToElementEditStart(S),_.removeEmptyBlocksAtEnd());if(D)for(;S=D.pop();)CKEDITOR.env.needsBrFiller?S.appendBogus():S.append(L.document.createText(" "));for(;S=p.mergeCandidates.pop();)S.mergeSiblings();if(L.moveToBookmark(M),!p.dontMoveCaret){for(S=e(L.startContainer)&&L.startContainer.getChild(L.startOffset-1);S&&e(S)&&!S.is(u.$empty);){if(S.isBlockBoundary())L.moveToPosition(S,CKEDITOR.POSITION_BEFORE_END);else{if(r(S)&&S.getHtml().match(/(\s|&nbsp;)$/g)){B=null;break}B=L.clone(),B.moveToPosition(S,CKEDITOR.POSITION_BEFORE_END)}S=S.getLast(n)}B&&L.moveToRange(B)}g.select(),l(c)}}}(),m=function(){function e(e){return e=new CKEDITOR.dom.walker(e),e.guard=function(e,t){return!t&&(e.type==CKEDITOR.NODE_ELEMENT?e.is(CKEDITOR.dtd.$tableContent):void 0)},e.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT},e}function t(e,t,i){return t=e.getDocument().createElement(t),e.append(t,i),t}function i(e){var t,i=e.count();for(i;i-- >0;)t=e.getItem(i),CKEDITOR.tools.trim(t.getHtml())||(t.appendBogus(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&t.getChildCount()&&t.getFirst().remove())}return function(n){var r=n.startContainer,o=r.getAscendant("table",1),s=!1;i(o.getElementsByTag("td")),i(o.getElementsByTag("th")),o=n.clone(),o.setStart(r,0),o=e(o).lastBackward(),o||(o=n.clone(),o.setEndAt(r,CKEDITOR.POSITION_BEFORE_END),o=e(o).lastForward(),s=!0),o||(o=r),o.is("table")?(n.setStartAt(o,CKEDITOR.POSITION_BEFORE_START),n.collapse(!0),o.remove()):(o.is({tbody:1,thead:1,tfoot:1})&&(o=t(o,"tr",s)),o.is("tr")&&(o=t(o,o.getParent().is("thead")?"th":"td",s)),(r=o.getBogus())&&r.remove(),n.moveToPosition(o,s?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}()}(),function(){function e(){var e,t=this._.fakeSelection;t&&(e=this.getSelection(1),e&&e.isHidden()||(t.reset(),t=0)),(t||(t=e||this.getSelection(1),t&&t.getType()!=CKEDITOR.SELECTION_NONE))&&(this.fire("selectionCheck",t),e=this.elementPath(),e.compare(this._.selectionPreviousPath)||(CKEDITOR.env.webkit&&(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=e,this.fire("selectionChange",{selection:t,path:e})))}function t(){f=!0,p||(i.call(this),p=CKEDITOR.tools.setTimeout(i,200,this))}function i(){p=null,f&&(CKEDITOR.tools.setTimeout(e,0,this),f=!1)}function n(e){return!(!m(e)&&(e.type!=CKEDITOR.NODE_ELEMENT||e.is(CKEDITOR.dtd.$empty)))}function r(e){function t(t,i){return!(!t||t.type==CKEDITOR.NODE_TEXT)&&e.clone()["moveToElementEdit"+(i?"End":"Start")](t)}if(!(e.root instanceof CKEDITOR.editable))return!1;var i=e.startContainer,r=e.getPreviousNode(n,null,i),o=e.getNextNode(n,null,i);return!(!t(r)&&!t(o,1)&&(r||o||i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary()&&i.getBogus()))}function o(e){return e.getCustomData("cke-fillingChar")}function s(e,t){var i=e&&e.removeCustomData("cke-fillingChar");if(i){if(t!==!1){var n,r=e.getDocument().getSelection().getNative(),o=r&&"None"!=r.type&&r.getRangeAt(0);i.getLength()>1&&o&&o.intersectsNode(i.$)&&(n=l(r),o=r.focusNode==i.$&&r.focusOffset>0,r.anchorNode==i.$&&r.anchorOffset>0&&n[0].offset--,o&&n[1].offset--)}i.setText(a(i.getText())),n&&u(e.getDocument().$,n)}}function a(e){return e.replace(/\u200B( )?/g,function(e){return e[1]?" ":""})}function l(e){return[{node:e.anchorNode,offset:e.anchorOffset},{node:e.focusNode,offset:e.focusOffset}]}function u(e,t){var i=e.getSelection(),n=e.createRange();n.setStart(t[0].node,t[0].offset),n.collapse(!0),i.removeAllRanges(),i.addRange(n),i.extend(t[1].node,t[1].offset)}function c(e){var t=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',e.document);e.fire("lockSnapshot"),e.editable().append(t);var i=e.getSelection(1),n=e.createRange(),r=i.root.on("selectionchange",function(e){e.cancel()},null,null,0);n.setStartAt(t,CKEDITOR.POSITION_AFTER_START),n.setEndAt(t,CKEDITOR.POSITION_BEFORE_END),i.selectRanges([n]),r.removeListener(),e.fire("unlockSnapshot"),e._.hiddenSelectionContainer=t}function h(e){var t={37:1,39:1,8:1,46:1};return function(i){var n=i.data.getKeystroke();if(t[n]){var r=e.getSelection().getRanges(),o=r[0];1==r.length&&o.collapsed&&(n=o[n<38?"getPreviousEditableNode":"getNextEditableNode"]())&&n.type==CKEDITOR.NODE_ELEMENT&&"false"==n.getAttribute("contenteditable")&&(e.getSelection().fake(n),i.data.preventDefault(),i.cancel())}}}function d(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.getCommonAncestor().isReadOnly()&&e.splice(t,1),!i.collapsed){if(i.startContainer.isReadOnly())for(var n,r=i.startContainer;r&&!((n=r.type==CKEDITOR.NODE_ELEMENT)&&r.is("body")||!r.isReadOnly());)n&&"false"==r.getAttribute("contentEditable")&&i.setStartAfter(r),r=r.getParent();r=i.startContainer,n=i.endContainer;var o=i.startOffset,s=i.endOffset,a=i.clone();r&&r.type==CKEDITOR.NODE_TEXT&&(o>=r.getLength()?a.setStartAfter(r):a.setStartBefore(r)),n&&n.type==CKEDITOR.NODE_TEXT&&(s?a.setEndAfter(n):a.setEndBefore(n)),r=new CKEDITOR.dom.walker(a),r.evaluator=function(n){if(n.type==CKEDITOR.NODE_ELEMENT&&n.isReadOnly()){var r=i.clone();return i.setEndBefore(n),i.collapsed&&e.splice(t--,1),n.getPosition(a.endContainer)&CKEDITOR.POSITION_CONTAINS||(r.setStartAfter(n),r.collapsed||e.splice(t+1,0,r)),!0}return!1},r.next()}}return e}var p,f,m=CKEDITOR.dom.walker.invisible(1),g=function(){function e(e){return function(t){var i=t.editor.createRange();return i.moveToClosestEditablePosition(t.selected,e)&&t.editor.getSelection().selectRanges([i]),!1}}function t(e){return function(t){var i,n=t.editor,r=n.createRange();return(i=r.moveToClosestEditablePosition(t.selected,e))||(i=r.moveToClosestEditablePosition(t.selected,!e)),i&&n.getSelection().selectRanges([r]),n.fire("saveSnapshot"),t.selected.remove(),i||(r.moveToElementEditablePosition(n.editable()),n.getSelection().selectRanges([r])),n.fire("saveSnapshot"),!1}}var i=e(),n=e(1);return{37:i,38:i,39:n,40:n,8:t(),46:t(1)}}();CKEDITOR.on("instanceCreated",function(i){function n(){var e=r.getSelection();e&&e.removeAllRanges()}var r=i.editor;r.on("contentDom",function(){function i(){a=new CKEDITOR.dom.selection(r.getSelection()),a.lock()}function n(){u.removeListener("mouseup",n),p.removeListener("mouseup",n);var e=CKEDITOR.document.$.selection,t=e.createRange();"None"!=e.type&&t.parentElement().ownerDocument==l.$&&t.select()}var o,a,l=r.document,u=CKEDITOR.document,c=r.editable(),d=l.getBody(),p=l.getDocumentElement(),f=c.isInline();if(CKEDITOR.env.gecko&&c.attachListener(c,"focus",function(e){e.removeListener(),0!==o&&(e=r.getSelection().getNative())&&e.isCollapsed&&e.anchorNode==c.$&&(e=r.createRange(),e.moveToElementEditStart(c),e.select())},null,null,-2),c.attachListener(c,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){o&&CKEDITOR.env.webkit&&(o=r._.previousActive&&r._.previousActive.equals(l.getActive())),r.unlockSelection(o),o=0},null,null,-1),c.attachListener(c,"mousedown",function(){o=0}),(CKEDITOR.env.ie||f)&&(y?c.attachListener(c,"beforedeactivate",i,null,null,-1):c.attachListener(r,"selectionCheck",i,null,null,-1),c.attachListener(c,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){r.lockSelection(a),o=1},null,null,-1),c.attachListener(c,"mousedown",function(){o=0})),CKEDITOR.env.ie&&!f){var m;c.attachListener(c,"mousedown",function(e){2==e.data.$.button&&(e=r.document.getSelection(),e&&e.getType()!=CKEDITOR.SELECTION_NONE||(m=r.window.getScrollPosition()))}),c.attachListener(c,"mouseup",function(e){2==e.data.$.button&&m&&(r.document.$.documentElement.scrollLeft=m.x,r.document.$.documentElement.scrollTop=m.y),m=null}),"BackCompat"!=l.$.compatMode&&((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&p.on("mousedown",function(e){function t(e){if(e=e.data.$,n){var t=d.$.createTextRange();try{t.moveToPoint(e.clientX,e.clientY)}catch(i){}n.setEndPoint(o.compareEndPoints("StartToStart",t)<0?"EndToEnd":"StartToStart",t),n.select()}}function i(){p.removeListener("mousemove",t),u.removeListener("mouseup",i),p.removeListener("mouseup",i),n.select()}if(e=e.data,e.getTarget().is("html")&&e.$.y<p.$.clientHeight&&e.$.x<p.$.clientWidth){var n=d.$.createTextRange();try{n.moveToPoint(e.$.clientX,e.$.clientY)}catch(r){}var o=n.duplicate();p.on("mousemove",t),u.on("mouseup",i),p.on("mouseup",i)}}),CKEDITOR.env.version>7&&CKEDITOR.env.version<11&&p.on("mousedown",function(e){e.data.getTarget().is("html")&&(u.on("mouseup",n),p.on("mouseup",n))}))}if(c.attachListener(c,"selectionchange",e,r),c.attachListener(c,"keyup",t,r),c.attachListener(c,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){r.forceNextSelectionCheck(),r.selectionChange(1)}),f&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var g;c.attachListener(c,"mousedown",function(){g=1}),c.attachListener(l.getDocumentElement(),"mouseup",function(){g&&t.call(r),g=0})}else c.attachListener(CKEDITOR.env.ie?c:l.getDocumentElement(),"mouseup",t,r);CKEDITOR.env.webkit&&c.attachListener(l,"keydown",function(e){switch(e.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:s(c)}},null,null,-1),c.attachListener(c,"keydown",h(r),null,null,-1)}),r.on("setData",function(){r.unlockSelection(),CKEDITOR.env.webkit&&n()}),r.on("contentDomUnload",function(){r.unlockSelection()}),CKEDITOR.env.ie9Compat&&r.on("beforeDestroy",n,null,null,9),r.on("dataReady",function(){delete r._.fakeSelection,delete r._.hiddenSelectionContainer,r.selectionChange(1)}),r.on("loadSnapshot",function(){var e=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),t=r.editable().getLast(e);t&&t.hasAttribute("data-cke-hidden-sel")&&(t.remove(),CKEDITOR.env.gecko&&(e=r.editable().getFirst(e))&&e.is("br")&&e.getAttribute("_moz_editor_bogus_node")&&e.remove())},null,null,100),r.on("key",function(e){if("wysiwyg"==r.mode){var t=r.getSelection();if(t.isFake){var i=g[e.data.keyCode];if(i)return i({editor:r,selected:t.getSelectedElement(),selection:t,keyEvent:e})}}})}),CKEDITOR.on("instanceReady",function(e){function t(){var e=c.editable();if(e&&(e=o(e))){var t=c.document.$.getSelection();"None"==t.type||t.anchorNode!=e.$&&t.focusNode!=e.$||(r=l(t)),n=e.getText(),e.setText(a(n))}}function i(){var e=c.editable();e&&(e=o(e))&&(e.setText(n),r&&(u(c.document.$,r),r=null))}var n,r,c=e.editor;CKEDITOR.env.webkit&&(c.on("selectionChange",function(){var e=c.editable(),t=o(e);t&&(t.getCustomData("ready")?s(e):t.setCustomData("ready",1))},null,null,-1),c.on("beforeSetMode",function(){s(c.editable())},null,null,-1),c.on("beforeUndoImage",t),c.on("afterUndoImage",i),c.on("beforeGetData",t,null,null,0),c.on("getData",i))}),CKEDITOR.editor.prototype.selectionChange=function(i){(i?e:t).call(this)},CKEDITOR.editor.prototype.getSelection=function(e){return!this._.savedSelection&&!this._.fakeSelection||e?(e=this.editable())&&"wysiwyg"==this.mode?new CKEDITOR.dom.selection(e):null:this._.savedSelection||this._.fakeSelection},CKEDITOR.editor.prototype.lockSelection=function(e){return e=e||this.getSelection(1),e.getType()!=CKEDITOR.SELECTION_NONE&&(!e.isLocked&&e.lock(),this._.savedSelection=e,!0)},CKEDITOR.editor.prototype.unlockSelection=function(e){var t=this._.savedSelection;return!!t&&(t.unlock(e),delete this._.savedSelection,!0)},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var e=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return e.selectRanges([this]),e},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3;var y="function"!=typeof window.getSelection,v=1;CKEDITOR.dom.selection=function(e){if(e instanceof CKEDITOR.dom.selection)var t=e,e=e.root;var i=e instanceof CKEDITOR.dom.element;if(this.rev=t?t.rev:v++,this.document=e instanceof CKEDITOR.dom.document?e:e.getDocument(),this.root=i?e:this.document.getBody(),this.isLocked=0,this._={cache:{}},t)return CKEDITOR.tools.extend(this._.cache,t._.cache),this.isFake=t.isFake,this.isLocked=t.isLocked,this;var n,r,e=this.getNative();if(e)if(e.getRangeAt)n=(r=e.rangeCount&&e.getRangeAt(0))&&new CKEDITOR.dom.node(r.commonAncestorContainer);else{try{r=e.createRange()}catch(o){}n=r&&CKEDITOR.dom.element.get(r.item&&r.item(0)||r.parentElement())}return(!n||n.type!=CKEDITOR.NODE_ELEMENT&&n.type!=CKEDITOR.NODE_TEXT||!this.root.equals(n)&&!this.root.contains(n))&&(this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList),this};var E={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return void 0!==this._.cache.nativeSel?this._.cache.nativeSel:this._.cache.nativeSel=y?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:y?function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_NONE;try{var i=this.getNative(),n=i.type;"Text"==n&&(t=CKEDITOR.SELECTION_TEXT),"Control"==n&&(t=CKEDITOR.SELECTION_ELEMENT),i.createRange().parentElement()&&(t=CKEDITOR.SELECTION_TEXT)}catch(r){}return e.type=t}:function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_TEXT,i=this.getNative();if(i&&i.rangeCount){if(1==i.rangeCount){var i=i.getRangeAt(0),n=i.startContainer;n==i.endContainer&&1==n.nodeType&&i.endOffset-i.startOffset==1&&E[n.childNodes[i.startOffset].nodeName.toLowerCase()]&&(t=CKEDITOR.SELECTION_ELEMENT)}}else t=CKEDITOR.SELECTION_NONE;return e.type=t},getRanges:function(){var e=y?function(){function e(e){return new CKEDITOR.dom.node(e).getIndex()}var t=function(t,i){t=t.duplicate(),t.collapse(i);var n=t.parentElement();if(!n.hasChildNodes())return{container:n,offset:0};for(var r,o,s,a,l=n.children,u=t.duplicate(),c=0,h=l.length-1,d=-1;c<=h;)if(d=Math.floor((c+h)/2),r=l[d],u.moveToElementText(r),s=u.compareEndPoints("StartToStart",t),s>0)h=d-1;else{if(!(s<0))return{container:n,offset:e(r)};c=d+1}if(d==-1||d==l.length-1&&s<0){if(u.moveToElementText(n),u.setEndPoint("StartToStart",t),u=u.text.replace(/(\r\n|\r)/g,"\n").length,l=n.childNodes,!u)return r=l[l.length-1],r.nodeType!=CKEDITOR.NODE_TEXT?{container:n,offset:l.length}:{container:r,offset:r.nodeValue.length};for(n=l.length;u>0&&n>0;)o=l[--n],o.nodeType==CKEDITOR.NODE_TEXT&&(a=o,u-=o.nodeValue.length);return{container:a,offset:-u}}if(u.collapse(s>0),u.setEndPoint(s>0?"StartToStart":"EndToStart",t),u=u.text.replace(/(\r\n|\r)/g,"\n").length,!u)return{container:n,offset:e(r)+(s>0?0:1)};for(;u>0;)try{o=r[s>0?"previousSibling":"nextSibling"],o.nodeType==CKEDITOR.NODE_TEXT&&(u-=o.nodeValue.length,a=o),r=o}catch(p){return{container:n,offset:e(r)}}return{container:a,offset:s>0?-u:a.nodeValue.length+u}};return function(){var e=this.getNative(),i=e&&e.createRange(),n=this.getType();if(!e)return[];if(n==CKEDITOR.SELECTION_TEXT)return e=new CKEDITOR.dom.range(this.root),n=t(i,!0),e.setStart(new CKEDITOR.dom.node(n.container),n.offset),n=t(i),e.setEnd(new CKEDITOR.dom.node(n.container),n.offset),e.endContainer.getPosition(e.startContainer)&CKEDITOR.POSITION_PRECEDING&&e.endOffset<=e.startContainer.getIndex()&&e.collapse(),[e];if(n==CKEDITOR.SELECTION_ELEMENT){for(var n=[],r=0;r<i.length;r++){for(var o=i.item(r),s=o.parentNode,a=0,e=new CKEDITOR.dom.range(this.root);a<s.childNodes.length&&s.childNodes[a]!=o;a++);e.setStart(new CKEDITOR.dom.node(s),a),e.setEnd(new CKEDITOR.dom.node(s),a+1),n.push(e)}return n}return[]}}():function(){var e,t=[],i=this.getNative();if(!i)return t;for(var n=0;n<i.rangeCount;n++){var r=i.getRangeAt(n);e=new CKEDITOR.dom.range(this.root),e.setStart(new CKEDITOR.dom.node(r.startContainer),r.startOffset),e.setEnd(new CKEDITOR.dom.node(r.endContainer),r.endOffset),t.push(e)}return t};return function(t){var i=this._.cache,n=i.ranges;return n||(i.ranges=n=new CKEDITOR.dom.rangeList(e.call(this))),t?d(new CKEDITOR.dom.rangeList(n.slice())):n}}(),getStartElement:function(){var e=this._.cache;if(void 0!==e.startElement)return e.startElement;var t;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var i=this.getRanges()[0];if(i){if(i.collapsed)t=i.startContainer,t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent());else{for(i.optimize();t=i.startContainer,i.startOffset==(t.getChildCount?t.getChildCount():t.getLength())&&!t.isBlockBoundary();)i.setStartAfter(t);if(t=i.startContainer,
t.type!=CKEDITOR.NODE_ELEMENT)return t.getParent();if(t=t.getChild(i.startOffset),t&&t.type==CKEDITOR.NODE_ELEMENT)for(i=t.getFirst();i&&i.type==CKEDITOR.NODE_ELEMENT;)t=i,i=i.getFirst();else t=i.startContainer}t=t.$}}return e.startElement=t?new CKEDITOR.dom.element(t):null},getSelectedElement:function(){var e=this._.cache;if(void 0!==e.selectedElement)return e.selectedElement;var t=this,i=CKEDITOR.tools.tryThese(function(){return t.getNative().createRange().item(0)},function(){for(var e,i,n=t.getRanges()[0].clone(),r=2;r&&(!(e=n.getEnclosedNode())||e.type!=CKEDITOR.NODE_ELEMENT||!E[e.getName()]||!(i=e));r--)n.shrink(CKEDITOR.SHRINK_ELEMENT);return i&&i.$});return e.selectedElement=i?new CKEDITOR.dom.element(i):null},getSelectedText:function(){var e=this._.cache;if(void 0!==e.selectedText)return e.selectedText;var t=this.getNative(),t=y?"Control"==t.type?"":t.createRange().text:t.toString();return e.selectedText=t},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(e){if(this.isLocked){if(e)var t=this.getSelectedElement(),i=!t&&this.getRanges(),n=this.isFake;this.isLocked=0,this.reset(),e&&(e=t||i[0]&&i[0].getCommonAncestor())&&e.getAscendant("body",1)&&(n?this.fake(t):t?this.selectElement(t):this.selectRanges(i))}},reset:function(){this._.cache={},this.isFake=0;var e=this.root.editor;if(e&&e._.fakeSelection&&this.rev==e._.fakeSelection.rev){delete e._.fakeSelection;var t=e._.hiddenSelectionContainer;if(t){var i=e.checkDirty();e.fire("lockSnapshot"),t.remove(),e.fire("unlockSnapshot"),!i&&e.resetDirty()}delete e._.hiddenSelectionContainer}this.rev=v++},selectElement:function(e){var t=new CKEDITOR.dom.range(this.root);t.setStartBefore(e),t.setEndAfter(e),this.selectRanges([t])},selectRanges:function(e){var t=this.root.editor,t=t&&t._.hiddenSelectionContainer;if(this.reset(),t)for(var i,t=this.root,n=0;n<e.length;++n)i=e[n],i.endContainer.equals(t)&&(i.endOffset=Math.min(i.endOffset,t.getChildCount()));if(e.length)if(this.isLocked){var o=CKEDITOR.document.getActive();this.unlock(),this.selectRanges(e),this.lock(),o&&!o.equals(this.root)&&o.focus()}else{var a,l,u;if(1==e.length&&!(u=e[0]).collapsed&&(a=u.getEnclosedNode())&&a.type==CKEDITOR.NODE_ELEMENT&&(u=u.clone(),u.shrink(CKEDITOR.SHRINK_ELEMENT,!0),(l=u.getEnclosedNode())&&l.type==CKEDITOR.NODE_ELEMENT&&(a=l),"false"==a.getAttribute("contenteditable"))||(a=void 0),a)this.fake(a);else{if(y){u=CKEDITOR.dom.walker.whitespaces(!0),l=/\ufeff|\u00a0/,t={table:1,tbody:1,tr:1},e.length>1&&(a=e[e.length-1],e[0].setEnd(a.endContainer,a.endOffset)),a=e[0];var c,h,d,e=a.collapsed;if((i=a.getEnclosedNode())&&i.type==CKEDITOR.NODE_ELEMENT&&i.getName()in E&&(!i.is("a")||!i.getText()))try{return d=i.$.createControlRange(),d.addElement(i.$),void d.select()}catch(p){}(a.startContainer.type==CKEDITOR.NODE_ELEMENT&&a.startContainer.getName()in t||a.endContainer.type==CKEDITOR.NODE_ELEMENT&&a.endContainer.getName()in t)&&(a.shrink(CKEDITOR.NODE_ELEMENT,!0),e=a.collapsed),d=a.createBookmark(),t=d.startNode,e||(o=d.endNode),d=a.document.$.body.createTextRange(),d.moveToElementText(t.$),d.moveStart("character",1),o?(l=a.document.$.body.createTextRange(),l.moveToElementText(o.$),d.setEndPoint("EndToEnd",l),d.moveEnd("character",-1)):(c=t.getNext(u),h=t.hasAscendant("pre"),c=!(c&&c.getText&&c.getText().match(l))&&(h||!t.hasPrevious()||t.getPrevious().is&&t.getPrevious().is("br")),h=a.document.createElement("span"),h.setHtml("&#65279;"),h.insertBefore(t),c&&a.document.createText("\ufeff").insertBefore(t)),a.setStartBefore(t),t.remove(),e?(c?(d.moveStart("character",-1),d.select(),a.document.$.selection.clear()):d.select(),a.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START),h.remove()):(a.setEndBefore(o),o.remove(),d.select())}else{if(o=this.getNative(),!o)return;for(this.removeAllRanges(),d=0;d<e.length;d++)if(d<e.length-1&&(c=e[d],h=e[d+1],l=c.clone(),l.setStart(c.endContainer,c.endOffset),l.setEnd(h.startContainer,h.startOffset),!l.collapsed&&(l.shrink(CKEDITOR.NODE_ELEMENT,!0),a=l.getCommonAncestor(),l=l.getEnclosedNode(),a.isReadOnly()||l&&l.isReadOnly())))h.setStart(c.startContainer,c.startOffset),e.splice(d--,1);else{a=e[d],h=this.document.$.createRange(),a.collapsed&&CKEDITOR.env.webkit&&r(a)&&(c=this.root,s(c,!1),l=c.getDocument().createText("​"),c.setCustomData("cke-fillingChar",l),a.insertNode(l),(c=l.getNext())&&!l.getPrevious()&&c.type==CKEDITOR.NODE_ELEMENT&&"br"==c.getName()?(s(this.root),a.moveToPosition(c,CKEDITOR.POSITION_BEFORE_START)):a.moveToPosition(l,CKEDITOR.POSITION_AFTER_END)),h.setStart(a.startContainer.$,a.startOffset);try{h.setEnd(a.endContainer.$,a.endOffset)}catch(f){if(!(f.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw f;a.collapse(1),h.setEnd(a.endContainer.$,a.endOffset)}o.addRange(h)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(e){var t=this.root.editor;this.reset(),c(t);var i=this._.cache,n=new CKEDITOR.dom.range(this.root);n.setStartBefore(e),n.setEndAfter(e),i.ranges=new CKEDITOR.dom.rangeList(n),i.selectedElement=i.startElement=e,i.type=CKEDITOR.SELECTION_ELEMENT,i.selectedText=i.nativeSel=null,this.isFake=1,this.rev=v++,t._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var e=this.getCommonAncestor();return e&&e.type==CKEDITOR.NODE_TEXT&&(e=e.getParent()),!(!e||!e.data("cke-hidden-sel"))},createBookmarks:function(e){return e=this.getRanges().createBookmarks(e),this.isFake&&(e.isFake=1),e},createBookmarks2:function(e){return e=this.getRanges().createBookmarks2(e),this.isFake&&(e.isFake=1),e},selectBookmarks:function(e){for(var t=[],i=0;i<e.length;i++){var n=new CKEDITOR.dom.range(this.root);n.moveToBookmark(e[i]),t.push(n)}return e.isFake?this.fake(t[0].getEnclosedNode()):this.selectRanges(t),this},getCommonAncestor:function(){var e=this.getRanges();return e.length?e[0].startContainer.getCommonAncestor(e[e.length-1].endContainer):null},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var e=this.getNative();try{e&&e[y?"empty":"removeAllRanges"]()}catch(t){}this.reset()}}}}(),CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function e(e,t){for(var i,n;(e=e.getParent())&&!e.equals(t);)if(e.getAttribute("data-nostyle"))i=e;else if(!n){var r=e.getAttribute("contentEditable");"false"==r?i=e:"true"==r&&(n=1)}return i}function t(i){var r=i.document;if(i.collapsed)r=g(this,r),i.insertNode(r),i.moveToPosition(r,CKEDITOR.POSITION_BEFORE_END);else{var o,s=this.element,a=this._.definition,l=a.ignoreReadonly,u=l||a.includeReadonly;null==u&&(u=i.root.getCustomData("cke_includeReadonly"));var c=CKEDITOR.dtd[s];c||(o=!0,c=CKEDITOR.dtd.span),i.enlarge(CKEDITOR.ENLARGE_INLINE,1),i.trim();var h,d=i.createBookmark(),f=d.startNode,m=d.endNode,y=f;if(!l){var v=i.getCommonAncestor(),l=e(f,v),v=e(m,v);l&&(y=l.getNextSourceNode(!0)),v&&(m=v)}for(y.getPosition(m)==CKEDITOR.POSITION_FOLLOWING&&(y=0);y;){if(l=!1,y.equals(m))y=null,l=!0;else{var E=y.type==CKEDITOR.NODE_ELEMENT?y.getName():null,v=E&&"false"==y.getAttribute("contentEditable"),T=E&&y.getAttribute("data-nostyle");if(E&&y.data("cke-bookmark")){y=y.getNextSourceNode(!0);continue}if(v&&u&&CKEDITOR.dtd.$block[E])for(var b=y,C=n(b),O=void 0,x=C.length,w=0,b=x&&new CKEDITOR.dom.range(b.getDocument());w<x;++w){var O=C[w],L=CKEDITOR.filter.instances[O.data("cke-filter")];(L?L.check(this):1)&&(b.selectNodeContents(O),t.call(this,b))}if(C=E?!c[E]||T?0:v&&!u?0:(y.getPosition(m)|S)==S&&(!a.childRule||a.childRule(y)):1){if(!(C=y.getParent())||!(C.getDtd()||CKEDITOR.dtd.span)[s]&&!o||a.parentRule&&!a.parentRule(C))l=!0;else if(h||E&&CKEDITOR.dtd.$removeEmpty[E]&&(y.getPosition(m)|S)!=S||(h=i.clone(),h.setStartBefore(y)),E=y.type,E==CKEDITOR.NODE_TEXT||v||E==CKEDITOR.NODE_ELEMENT&&!y.getChildCount()){for(var I,E=y;(l=!E.getNext(R))&&(I=E.getParent(),c[I.getName()])&&(I.getPosition(f)|_)==_&&(!a.childRule||a.childRule(I));)E=I;h.setEndAfter(E)}}else l=!0;y=y.getNextSourceNode(T||v)}if(l&&h&&!h.collapsed){for(var D,M,A,l=g(this,r),v=l.hasAttributes(),T=h.getCommonAncestor(),E={},C={},O={},x={};l&&T;){if(T.getName()==s){for(D in a.attributes)!x[D]&&(A=T.getAttribute(M))&&(l.getAttribute(D)==A?C[D]=1:x[D]=1);for(M in a.styles)!O[M]&&(A=T.getStyle(M))&&(l.getStyle(M)==A?E[M]=1:O[M]=1)}T=T.getParent()}for(D in C)l.removeAttribute(D);for(M in E)l.removeStyle(M);v&&!l.hasAttributes()&&(l=null),l?(h.extractContents().appendTo(l),h.insertNode(l),p.call(this,l),l.mergeSiblings(),CKEDITOR.env.ie||l.$.normalize()):(l=new CKEDITOR.dom.element("span"),h.extractContents().appendTo(l),h.insertNode(l),p.call(this,l),l.remove(!0)),h=null}}i.moveToBookmark(d),i.shrink(CKEDITOR.SHRINK_TEXT),i.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function i(e){function t(){for(var e=new CKEDITOR.dom.elementPath(n.getParent()),t=new CKEDITOR.dom.elementPath(u.getParent()),i=null,r=null,o=0;o<e.elements.length;o++){var s=e.elements[o];if(s==e.block||s==e.blockLimit)break;c.checkElementRemovable(s,!0)&&(i=s)}for(o=0;o<t.elements.length&&(s=t.elements[o],s!=t.block&&s!=t.blockLimit);o++)c.checkElementRemovable(s,!0)&&(r=s);r&&u.breakParent(r),i&&n.breakParent(i)}e.enlarge(CKEDITOR.ENLARGE_INLINE,1);var i=e.createBookmark(),n=i.startNode;if(e.collapsed){for(var r,o,s=new CKEDITOR.dom.elementPath(n.getParent(),e.root),a=0;a<s.elements.length&&(o=s.elements[a])&&(o!=s.block&&o!=s.blockLimit);a++)if(this.checkElementRemovable(o)){var l;e.collapsed&&(e.checkBoundaryOfElement(o,CKEDITOR.END)||(l=e.checkBoundaryOfElement(o,CKEDITOR.START)))?(r=o,r.match=l?"start":"end"):(o.mergeSiblings(),o.is(this.element)?d.call(this,o):f(o,E(this)[o.getName()]))}if(r){for(o=n,a=0;l=s.elements[a],!l.equals(r);a++)l.match||(l=l.clone(),l.append(o),o=l);o["start"==r.match?"insertBefore":"insertAfter"](r)}}else{var u=i.endNode,c=this;for(t(),s=n;!s.equals(u);)r=s.getNextSourceNode(),s.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(s)&&(s.getName()==this.element?d.call(this,s):f(s,E(this)[s.getName()]),r.type==CKEDITOR.NODE_ELEMENT&&r.contains(n)&&(t(),r=n.getNext())),s=r}e.moveToBookmark(i),e.shrink(CKEDITOR.NODE_ELEMENT,!0)}function n(e){var t=[];return e.forEach(function(e){if("true"==e.getAttribute("contenteditable"))return t.push(e),!1},CKEDITOR.NODE_ELEMENT,!0),t}function r(e){var t=e.getEnclosedNode()||e.getCommonAncestor(!1,!0);(e=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1))&&!e.isReadOnly()&&y(e,this)}function o(e){var t=e.getCommonAncestor(!0,!0);if(e=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1)){var t=this._.definition,i=t.attributes;if(i)for(var n in i)e.removeAttribute(n,i[n]);if(t.styles)for(var r in t.styles)t.styles.hasOwnProperty(r)&&e.removeStyle(r)}}function s(e){var t=e.createBookmark(!0),i=e.createIterator();i.enforceRealBlocks=!0,this._.enterMode&&(i.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var n,r,o=e.document;n=i.getNextParagraph();)!n.isReadOnly()&&(i.activeFilter?i.activeFilter.check(this):1)&&(r=g(this,o,n),l(n,r));e.moveToBookmark(t)}function a(e){var t=e.createBookmark(1),i=e.createIterator();i.enforceRealBlocks=!0,i.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var n,r;n=i.getNextParagraph();)this.checkElementRemovable(n)&&(n.is("pre")?((r=this._.enterMode==CKEDITOR.ENTER_BR?null:e.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&n.copyAttributes(r),l(n,r)):d.call(this,n));e.moveToBookmark(t)}function l(e,t){var i=!t;i&&(t=e.getDocument().createElement("div"),e.copyAttributes(t));var n=t&&t.is("pre"),r=e.is("pre"),o=!n&&r;if(n&&!r){if(r=t,(o=e.getBogus())&&o.remove(),o=e.getHtml(),o=c(o,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),o=o.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),o=o.replace(/([ \t\n\r]+|&nbsp;)/g," "),o=o.replace(/<br\b[^>]*>/gi,"\n"),CKEDITOR.env.ie){var s=e.getDocument().createElement("div");s.append(r),r.$.outerHTML="<pre>"+o+"</pre>",r.copyAttributes(s.getFirst()),r=s.getFirst().remove()}else r.setHtml(o);t=r}else o?t=h(i?[e.getHtml()]:u(e),t):e.moveChildren(t);if(t.replace(e),n){var a,i=t;(a=i.getPrevious(L))&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("pre")&&(n=c(a.getHtml(),/\n$/,"")+"\n\n"+c(i.getHtml(),/^\n/,""),CKEDITOR.env.ie?i.$.outerHTML="<pre>"+n+"</pre>":i.setHtml(n),a.remove())}else i&&m(t)}function u(e){var t=[];return c(e.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(e,t,i){return t+"</pre>"+i+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(e,i){t.push(i)}),t}function c(e,t,i){var n="",r="",e=e.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(e,t,i){return t&&(n=t),i&&(r=i),""});return n+e.replace(t,i)+r}function h(e,t){var i;e.length>1&&(i=new CKEDITOR.dom.documentFragment(t.getDocument()));for(var n=0;n<e.length;n++){var r=e[n],r=r.replace(/(\r\n|\r)/g,"\n"),r=c(r,/^[ \t]*\n/,""),r=c(r,/\n$/,""),r=c(r,/^[ \t]+|[ \t]+$/g,function(e,t){return 1==e.length?"&nbsp;":t?" "+CKEDITOR.tools.repeat("&nbsp;",e.length-1):CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "}),r=r.replace(/\n/g,"<br>"),r=r.replace(/[ \t]{2,}/g,function(e){return CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "});if(i){var o=t.clone();o.setHtml(r),i.append(o)}else t.setHtml(r)}return i||t}function d(e,t){var i,n=this._.definition,r=n.attributes,n=n.styles,o=E(this)[e.getName()],s=CKEDITOR.tools.isEmpty(r)&&CKEDITOR.tools.isEmpty(n);for(i in r)("class"==i||this._.definition.fullMatch)&&e.getAttribute(i)!=T(i,r[i])||t&&"data-"==i.slice(0,5)||(s=e.hasAttribute(i),e.removeAttribute(i));for(var a in n)this._.definition.fullMatch&&e.getStyle(a)!=T(a,n[a],!0)||(s=s||!!e.getStyle(a),e.removeStyle(a));f(e,o,C[e.getName()]),s&&(this._.definition.alwaysRemoveElement?m(e,1):!CKEDITOR.dtd.$block[e.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!e.hasAttributes()?m(e):e.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function p(e){for(var t,i=E(this),n=e.getElementsByTag(this.element),r=n.count();--r>=0;)t=n.getItem(r),t.isReadOnly()||d.call(this,t,!0);for(var o in i)if(o!=this.element)for(n=e.getElementsByTag(o),r=n.count()-1;r>=0;r--)t=n.getItem(r),t.isReadOnly()||f(t,i[o])}function f(e,t,i){if(t=t&&t.attributes)for(var n=0;n<t.length;n++){var r,o=t[n][0];if(r=e.getAttribute(o)){var s=t[n][1];(null===s||s.test&&s.test(r)||"string"==typeof s&&r==s)&&e.removeAttribute(o)}}i||m(e)}function m(e,t){if(!e.hasAttributes()||t)if(CKEDITOR.dtd.$block[e.getName()]){var i=e.getPrevious(L),n=e.getNext(L);i&&(i.type==CKEDITOR.NODE_TEXT||!i.isBlockBoundary({br:1}))&&e.append("br",1),n&&(n.type==CKEDITOR.NODE_TEXT||!n.isBlockBoundary({br:1}))&&e.append("br"),e.remove(!0)}else i=e.getFirst(),n=e.getLast(),e.remove(!0),i&&(i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings(),n&&!i.equals(n)&&n.type==CKEDITOR.NODE_ELEMENT&&n.mergeSiblings())}function g(e,t,i){var n;return n=e.element,"*"==n&&(n="span"),n=new CKEDITOR.dom.element(n,t),i&&i.copyAttributes(n),n=y(n,e),t.getCustomData("doc_processing_style")&&n.hasAttribute("id")?n.removeAttribute("id"):t.setCustomData("doc_processing_style",1),n}function y(e,t){var i=t._.definition,n=i.attributes,i=CKEDITOR.style.getStyleText(i);if(n)for(var r in n)e.setAttribute(r,n[r]);return i&&e.setAttribute("style",i),e}function v(e,t){for(var i in e)e[i]=e[i].replace(w,function(e,i){return t[i]})}function E(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},i=e._.definition.overrides;if(i){CKEDITOR.tools.isArray(i)||(i=[i]);for(var n=0;n<i.length;n++){var r,o,s=i[n];if("string"==typeof s?r=s.toLowerCase():(r=s.element?s.element.toLowerCase():e.element,o=s.attributes),s=t[r]||(t[r]={}),o){var a,s=s.attributes=s.attributes||[];for(a in o)s.push([a.toLowerCase(),o[a]])}}}return t}function T(e,t,i){var n=new CKEDITOR.dom.element("span");return n[i?"setStyle":"setAttribute"](e,t),n[i?"getStyle":"getAttribute"](e)}function b(e,t,i){for(var n,r=e.document,o=e.getRanges(),t=t?this.removeFromRange:this.applyToRange,s=o.createIterator();n=s.getNextRange();)t.call(this,n,i);e.selectRanges(o),r.removeCustomData("doc_processing_style")}var C={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},O={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},x=/\s*(?:;\s*|$)/,w=/#\((.+?)\)/g,R=CKEDITOR.dom.walker.bookmark(0,1),L=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(e,t){if("string"==typeof e.type)return new CKEDITOR.style.customHandlers[e.type](e);var i=e.attributes;i&&i.style&&(e.styles=CKEDITOR.tools.extend({},e.styles,CKEDITOR.tools.parseCssText(i.style)),delete i.style),t&&(e=CKEDITOR.tools.clone(e),v(e.attributes,t),v(e.styles,t)),i=this.element=e.element?"string"==typeof e.element?e.element.toLowerCase():e.element:"*",this.type=e.type||(C[i]?CKEDITOR.STYLE_BLOCK:O[i]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE),"object"==typeof this.element&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:e}},CKEDITOR.style.prototype={apply:function(e){if(e instanceof CKEDITOR.dom.document)return b.call(this,e.getSelection());if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),b.call(this,e.getSelection(),0,e),this._.enterMode=t}},remove:function(e){if(e instanceof CKEDITOR.dom.document)return b.call(this,e.getSelection(),1);if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),b.call(this,e.getSelection(),1,e),this._.enterMode=t}},applyToRange:function(e){return this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?t:this.type==CKEDITOR.STYLE_BLOCK?s:this.type==CKEDITOR.STYLE_OBJECT?r:null,this.applyToRange(e)},removeFromRange:function(e){return this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?i:this.type==CKEDITOR.STYLE_BLOCK?a:this.type==CKEDITOR.STYLE_OBJECT?o:null,this.removeFromRange(e)},applyToObject:function(e){y(e,this)},checkActive:function(e,t){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(e.block||e.blockLimit,!0,t);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var i,n=e.elements,r=0;r<n.length;r++)if(i=n[r],this.type!=CKEDITOR.STYLE_INLINE||i!=e.block&&i!=e.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var o=i.getName();if(!("string"==typeof this.element?o==this.element:o in this.element))continue}if(this.checkElementRemovable(i,!0,t))return!0}}return!1},checkApplicable:function(e,t,i){if(t&&t instanceof CKEDITOR.filter&&(i=t),i&&!i.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!e.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!e.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(e,t){var i=this._.definition;if(!e||!i.ignoreReadonly&&e.isReadOnly())return!1;var n=e.getName();if("string"==typeof this.element?n==this.element:n in this.element){if(!t&&!e.hasAttributes())return!0;if(n=i._AC)i=n;else{var n={},r=0,o=i.attributes;if(o)for(var s in o)r++,n[s]=o[s];(s=CKEDITOR.style.getStyleText(i))&&(n.style||r++,n.style=s),n._length=r,i=i._AC=n}if(!i._length)return!0;for(var a in i)if("_length"!=a){if(r=e.getAttribute(a)||"","style"==a)e:{n=i[a],"string"==typeof n&&(n=CKEDITOR.tools.parseCssText(n)),"string"==typeof r&&(r=CKEDITOR.tools.parseCssText(r,!0)),s=void 0;for(s in n)if(!(s in r)||r[s]!=n[s]&&"inherit"!=n[s]&&"inherit"!=r[s]){n=!1;break e}n=!0}else n=i[a]==r;if(n){if(!t)return!0}else if(t)return!1}if(t)return!0}return!1},checkElementRemovable:function(e,t,i){if(this.checkElementMatch(e,t,i))return!0;if(t=E(this)[e.getName()]){var n;if(!(t=t.attributes))return!0;for(i=0;i<t.length;i++)if(n=t[i][0],n=e.getAttribute(n)){var r=t[i][1];if(null===r)return!0;if("string"==typeof r){if(n==r)return!0}else if(r.test(n))return!0}}return!1},buildPreview:function(e){var t=this._.definition,i=[],n=t.element;"bdo"==n&&(n="span");var i=["<",n],r=t.attributes;if(r)for(var o in r)i.push(" ",o,'="',r[o],'"');return(r=CKEDITOR.style.getStyleText(t))&&i.push(' style="',r,'"'),i.push(">",e||t.name,"</",n,">"),i.join("")},getDefinition:function(){return this._.definition}},CKEDITOR.style.getStyleText=function(e){var t=e._ST;if(t)return t;var t=e.styles,i=e.attributes&&e.attributes.style||"",n="";i.length&&(i=i.replace(x,";"));for(var r in t){var o=t[r],s=(r+":"+o).replace(x,";");"inherit"==o?n+=s:i+=s}return i.length&&(i=CKEDITOR.tools.normalizeCssText(i,!0)),e._ST=i+n},CKEDITOR.style.customHandlers={},CKEDITOR.style.addCustomHandler=function(e){var t=function(e){this._={definition:e},this.setup&&this.setup(e)};return t.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},e,!0),this.customHandlers[e.type]=t};var S=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,_=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED}(),CKEDITOR.styleCommand=function(e,t){this.requiredContent=this.allowedContent=this.style=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.styleCommand.prototype.exec=function(e){e.focus(),this.state==CKEDITOR.TRISTATE_OFF?e.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&e.removeStyle(this.style)},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(e,t,i){CKEDITOR.stylesSet.addExternal(e,t,""),CKEDITOR.stylesSet.load(e,i)},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(e,t){var i=this._.styleStateChangeCallbacks;i||(i=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(e){for(var t=0;t<i.length;t++){var n=i[t],r=n.style.checkActive(e.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;n.fn.call(this,r)}})),i.push({style:e,fn:t})},applyStyle:function(e){e.apply(this)},removeStyle:function(e){e.remove(this)},getStylesSet:function(e){if(this._.stylesDefinitions)e(this._.stylesDefinitions);else{var t=this,i=t.config.stylesCombo_stylesSet||t.config.stylesSet;if(i===!1)e(null);else if(i instanceof Array)t._.stylesDefinitions=i,e(i);else{i||(i="default");var i=i.split(":"),n=i[0];CKEDITOR.stylesSet.addExternal(n,i[1]?i.slice(1).join(":"):CKEDITOR.getUrl("dependencies/ckeditor/styles.js"),""),CKEDITOR.stylesSet.load(n,function(i){t._.stylesDefinitions=i[n],e(t._.stylesDefinitions)})}}}}),CKEDITOR.dom.comment=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createComment(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"<!--"+this.$.nodeValue+"-->"}}),function(){var e,t={},i={};for(e in CKEDITOR.dtd.$blockLimit)e in CKEDITOR.dtd.$list||(t[e]=1);for(e in CKEDITOR.dtd.$block)e in CKEDITOR.dtd.$blockLimit||e in CKEDITOR.dtd.$empty||(i[e]=1);CKEDITOR.dom.elementPath=function(e,n){var r,o=null,s=null,a=[],l=e,n=n||e.getDocument().getBody();do if(l.type==CKEDITOR.NODE_ELEMENT){if(a.push(l),!this.lastElement&&(this.lastElement=l,l.is(CKEDITOR.dtd.$object)||"false"==l.getAttribute("contenteditable")))continue;if(l.equals(n))break;if(!s&&(r=l.getName(),"true"==l.getAttribute("contenteditable")?s=l:!o&&i[r]&&(o=l),t[r])){var u;if(u=!o){if(r="div"==r){e:{r=l.getChildren(),u=0;for(var c=r.count();u<c;u++){var h=r.getItem(u);if(h.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[h.getName()]){r=!0;break e}}r=!1}r=!r}u=r}u?o=l:s=l}}while(l=l.getParent());s||(s=n),this.block=o,this.blockLimit=s,this.root=n,this.elements=a}}(),CKEDITOR.dom.elementPath.prototype={compare:function(e){var t=this.elements,e=e&&e.elements;if(!e||t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0},contains:function(e,t,i){var n;"string"==typeof e&&(n=function(t){return t.getName()==e}),e instanceof CKEDITOR.dom.element?n=function(t){return t.equals(e)}:CKEDITOR.tools.isArray(e)?n=function(t){return CKEDITOR.tools.indexOf(e,t.getName())>-1}:"function"==typeof e?n=e:"object"==typeof e&&(n=function(t){return t.getName()in e});var r=this.elements,o=r.length;for(t&&o--,i&&(r=Array.prototype.slice.call(r,0),r.reverse()),t=0;t<o;t++)if(n(r[t]))return r[t];return null},isContextFor:function(e){var t;return!(e in CKEDITOR.dtd.$block)||(t=this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit,!!t.getDtd()[e])},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}},CKEDITOR.dom.text=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createTextNode(e)),this.$=e},CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(e){this.$.nodeValue=e},split:function(e){var t=this.$.parentNode,i=t.childNodes.length,n=this.getLength(),r=this.getDocument(),o=new CKEDITOR.dom.text(this.$.splitText(e),r);return t.childNodes.length==i&&(e>=n?(o=r.createText(""),o.insertAfter(this)):(e=r.createText(""),e.insertAfter(o),e.remove())),o},substring:function(e,t){return"number"!=typeof t?this.$.nodeValue.substr(e):this.$.nodeValue.substring(e,t)}}),function(){function e(e,t,i){var n=e.serializable,r=t[i?"endContainer":"startContainer"],o=i?"endOffset":"startOffset",s=n?t.document.getById(e.startNode):e.startNode,e=n?t.document.getById(e.endNode):e.endNode;return r.equals(s.getPrevious())?(t.startOffset=t.startOffset-r.getLength()-e.getPrevious().getLength(),r=e.getNext()):r.equals(e.getPrevious())&&(t.startOffset=t.startOffset-r.getLength(),r=e.getNext()),r.equals(s.getParent())&&t[o]++,r.equals(e.getParent())&&t[o]++,t[i?"endContainer":"startContainer"]=r,t}CKEDITOR.dom.rangeList=function(e){return e instanceof CKEDITOR.dom.rangeList?e:(e?e instanceof CKEDITOR.dom.range&&(e=[e]):e=[],CKEDITOR.tools.extend(e,t))};var t={createIterator:function(){var e,t=this,i=CKEDITOR.dom.walker.bookmark(),n=[];return{getNextRange:function(r){e=void 0===e?0:e+1;var o=t[e];if(o&&t.length>1){if(!e)for(var s=t.length-1;s>=0;s--)n.unshift(t[s].createBookmark(!0));if(r)for(var a=0;t[e+a+1];){for(var l=o.document,r=0,s=l.getById(n[a].endNode),l=l.getById(n[a+1].startNode);;){if(s=s.getNextSourceNode(!1),l.equals(s))r=1;else if(i(s)||s.type==CKEDITOR.NODE_ELEMENT&&s.isBlockBoundary())continue;break}if(!r)break;a++}for(o.moveToBookmark(n.shift());a--;)s=t[++e],s.moveToBookmark(n.shift()),o.setEnd(s.endContainer,s.endOffset)}return o}}},createBookmarks:function(t){for(var i,n=[],r=0;r<this.length;r++){n.push(i=this[r].createBookmark(t,!0));for(var o=r+1;o<this.length;o++)this[o]=e(i,this[o]),this[o]=e(i,this[o],!0)}return n},createBookmarks2:function(e){for(var t=[],i=0;i<this.length;i++)t.push(this[i].createBookmark2(e));return t},moveToBookmarks:function(e){for(var t=0;t<this.length;t++)this[t].moveToBookmark(e[t])}}}(),function(){function e(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function t(t){var i=CKEDITOR.skin["ua_"+t],n=CKEDITOR.env;if(i)for(var r,i=i.split(",").sort(function(e,t){return e>t?-1:1}),o=0;o<i.length;o++)if(r=i[o],n.ie&&(r.replace(/^ie/,"")==n.version||n.quirks&&"iequirks"==r)&&(r="ie"),n[r]){t+="_"+i[o];break}return CKEDITOR.getUrl(e()+t+".css")}function i(e,i){o[e]||(CKEDITOR.document.appendStyleSheet(t(e)),o[e]=1),i&&i()}function n(e){var t=e.getById(s);return t||(t=e.getHead().append("style"),t.setAttribute("id",s),t.setAttribute("type","text/css")),t}function r(e,t,i){var n,r,o;if(CKEDITOR.env.webkit)for(t=t.split("}").slice(0,-1),r=0;r<t.length;r++)t[r]=t[r].split("{");for(var s=0;s<e.length;s++)if(CKEDITOR.env.webkit)for(r=0;r<t.length;r++){for(o=t[r][1],n=0;n<i.length;n++)o=o.replace(i[n][0],i[n][1]);e[s].$.sheet.addRule(t[r][0],o)}else{for(o=t,n=0;n<i.length;n++)o=o.replace(i[n][0],i[n][1]);CKEDITOR.env.ie&&CKEDITOR.env.version<11?e[s].$.styleSheet.cssText=e[s].$.styleSheet.cssText+o:e[s].$.innerHTML=e[s].$.innerHTML+o}}var o={};CKEDITOR.skin={path:e,loadPart:function(t,n){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e()+"skin.js"),function(){i(t,n)}):i(t,n)},getPath:function(e){return CKEDITOR.getUrl(t(e))},icons:{},addIcon:function(e,t,i,n){e=e.toLowerCase(),this.icons[e]||(this.icons[e]={path:t,offset:i||0,bgsize:n||"16px"})},getIconStyle:function(e,t,i,n,r){var o;return e&&(e=e.toLowerCase(),t&&(o=this.icons[e+"-rtl"]),o||(o=this.icons[e])),e=i||o&&o.path||"",n=n||o&&o.offset,r=r||o&&o.bgsize||"16px",e&&"background-image:url("+CKEDITOR.getUrl(e)+");background-position:0 "+n+"px;background-size:"+r+";"}},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(e){var t=n(CKEDITOR.document);return(this.setUiColor=function(e){this.uiColor=e;var i=CKEDITOR.skin.chameleon,n="",o="";"function"==typeof i&&(n=i(this,"editor"),o=i(this,"panel")),e=[[l,e]],r([t],n,e),r(a,o,e)}).call(this,e)}});var s="cke_ui_color",a=[],l=/\$color/g;CKEDITOR.on("instanceLoaded",function(e){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var t=e.editor,e=function(e){if(e=(e.data[0]||e.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument(),!e.getById("cke_ui_color")){e=n(e),a.push(e);var i=t.getUiColor();i&&r([e],CKEDITOR.skin.chameleon(t,"panel"),[[l,i]])}};t.on("panelShow",e),t.on("menuShow",e),t.config.uiColor&&t.setUiColor(t.config.uiColor)}})}(),function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=!1;else{var e=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);e.appendTo(CKEDITOR.document.getHead());try{var t=e.getComputedStyle("border-top-color"),i=e.getComputedStyle("border-right-color");CKEDITOR.env.hc=!(!t||t!=i)}catch(n){CKEDITOR.env.hc=!1}e.remove()}if(CKEDITOR.env.hc&&(CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc"),CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}"),CKEDITOR.status="loaded",CKEDITOR.fireOnce("loaded"),e=CKEDITOR._.pending)for(delete CKEDITOR._.pending,t=0;t<e.length;t++)CKEDITOR.editor.prototype.constructor.apply(e[t][0],e[t][1]),CKEDITOR.add(e[t][0])}(),CKEDITOR.skin.name="moono",CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko",CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8",CKEDITOR.skin.chameleon=function(){var e=function(){return function(e,t){for(var i=e.match(/[^#]./g),n=0;n<3;n++){var r,o=i,s=n;r=parseInt(i[n],16),r=("0"+(t<0?0|r*(1+t):0|r+(255-r)*t).toString(16)).slice(-2),o[s]=r}return"#"+i.join("")}}(),t=function(){var e=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(t,i){return e.output({from:t,to:i})}}(),i={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),
panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(n,r){var o=n.uiColor,o={id:"."+n.id,defaultBorder:e(o,-.1),defaultGradient:t(e(o,.9),o),lightGradient:t(e(o,1),e(o,.7)),mediumGradient:t(e(o,.8),e(o,.5)),ckeButtonOn:t(e(o,.6),e(o,.7)),ckeResizer:e(o,-.4),ckeToolbarSeparator:e(o,.5),ckeColorauto:e(o,.8),dialogBody:e(o,.7),dialogTabSelected:t("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:e(o,-.6),elementsPathBg:o,menubuttonIcon:e(o,.5),menubuttonIconHover:e(o,.3)};return i[r].output(o).replace(/\[/g,"{").replace(/\]/g,"}")}}(),CKEDITOR.plugins.add("dialogui",{onLoad:function(){var e=function(e){this._||(this._={}),this._["default"]=this._.initValue=e["default"]||"",this._.required=e.required||!1;for(var t=[this._],i=1;i<arguments.length;i++)t.push(arguments[i]);return t.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,t),this._},t={build:function(e,t,i){return new CKEDITOR.ui.dialog.textInput(e,t,i)}},i={build:function(e,t,i){return new CKEDITOR.ui.dialog[t.type](e,t,i)}},n={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(e){this.setValue(this.getInitValue(),e)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},r=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(e,t){this._.domOnChangeRegistered||(e.on("load",function(){this.getInputElement().on("change",function(){e.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},!0),o=/^on([A-Z]\w+)/,s=function(e){for(var t in e)(o.test(t)||"title"==t||"type"==t)&&delete e[t];return e};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(t,i,n,r){if(!(arguments.length<4)){var o=e.call(this,i);o.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[];var s={role:i.role||"presentation"};i.includeLabel&&(s["aria-labelledby"]=o.labelId),CKEDITOR.ui.dialog.uiElement.call(this,t,i,n,"div",null,s,function(){var e=[],n=i.required?" cke_required":"";return"horizontal"!=i.labelLayout?e.push('<label class="cke_dialog_ui_labeled_label'+n+'" ',' id="'+o.labelId+'"',o.inputId?' for="'+o.inputId+'"':"",(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",i.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',i.controlStyle?' style="'+i.controlStyle+'"':"",' role="presentation">',r.call(this,t,i),"</div>"):(n={type:"hbox",widths:i.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+n+'" id="'+o.labelId+'" for="'+o.inputId+'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(i.label)+"</label>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(i.controlStyle?' style="'+i.controlStyle+'"':"")+">"+r.call(this,t,i)+"</span>"}]},CKEDITOR.dialog._.uiElementBuilders.hbox.build(t,n,e)),e.join("")})}},textInput:function(t,i,n){if(!(arguments.length<3)){e.call(this,i);var r=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",o={"class":"cke_dialog_ui_input_"+i.type,id:r,type:i.type};i.validate&&(this.validate=i.validate),i.maxLength&&(o.maxlength=i.maxLength),i.size&&(o.size=i.size),i.inputStyle&&(o.style=i.inputStyle);var s=this,a=!1;t.on("load",function(){s.getInputElement().on("keydown",function(e){13==e.data.getKeystroke()&&(a=!0)}),s.getInputElement().on("keyup",function(e){13==e.data.getKeystroke()&&a&&(t.getButton("ok")&&setTimeout(function(){t.getButton("ok").click()},0),a=!1)},null,null,1e3)}),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,n,function(){var e=['<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'];i.width&&e.push('style="width:'+i.width+'" '),e.push("><input "),o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);for(var t in o)e.push(t+'="'+o[t]+'" ');return e.push(" /></div>"),e.join("")})}},textarea:function(t,i,n){if(!(arguments.length<3)){e.call(this,i);var r=this,o=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",s={};i.validate&&(this.validate=i.validate),s.rows=i.rows||5,s.cols=i.cols||20,s["class"]="cke_dialog_ui_input_textarea "+(i["class"]||""),"undefined"!=typeof i.inputStyle&&(s.style=i.inputStyle),i.dir&&(s.dir=i.dir),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,n,function(){s["aria-labelledby"]=this._.labelId,this._.required&&(s["aria-required"]=this._.required);var e,t=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',o,'" '];for(e in s)t.push(e+'="'+CKEDITOR.tools.htmlEncode(s[e])+'" ');return t.push(">",CKEDITOR.tools.htmlEncode(r._["default"]),"</textarea></div>"),t.join("")})}},checkbox:function(t,i,n){if(!(arguments.length<3)){var r=e.call(this,i,{"default":!!i["default"]});i.validate&&(this.validate=i.validate),CKEDITOR.ui.dialog.uiElement.call(this,t,i,n,"span",null,null,function(){var e=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),n=[],o=CKEDITOR.tools.getNextId()+"_label",a={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":o};return s(e),i["default"]&&(a.checked="checked"),"undefined"!=typeof e.inputStyle&&(e.style=e.inputStyle),r.checkbox=new CKEDITOR.ui.dialog.uiElement(t,e,n,"input",null,a),n.push(' <label id="',o,'" for="',a.id,'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(i.label),"</label>"),n.join("")})}},radio:function(t,i,n){if(!(arguments.length<3)){e.call(this,i),this._["default"]||(this._["default"]=this._.initValue=i.items[0][1]),i.validate&&(this.validate=i.validate);var r=[],o=this;i.role="radiogroup",i.includeLabel=!0,CKEDITOR.ui.dialog.labeledElement.call(this,t,i,n,function(){for(var e=[],n=[],a=(i.id?i.id:CKEDITOR.tools.getNextId())+"_radio",l=0;l<i.items.length;l++){var u=i.items[l],c=void 0!==u[2]?u[2]:u[0],h=void 0!==u[1]?u[1]:u[0],d=CKEDITOR.tools.getNextId()+"_radio_input",p=d+"_label",d=CKEDITOR.tools.extend({},i,{id:d,title:null,type:null},!0),c=CKEDITOR.tools.extend({},d,{title:c},!0),f={type:"radio","class":"cke_dialog_ui_radio_input",name:a,value:h,"aria-labelledby":p},m=[];o._["default"]==h&&(f.checked="checked"),s(d),s(c),"undefined"!=typeof d.inputStyle&&(d.style=d.inputStyle),d.keyboardFocusable=!0,r.push(new CKEDITOR.ui.dialog.uiElement(t,d,m,"input",null,f)),m.push(" "),new CKEDITOR.ui.dialog.uiElement(t,c,m,"label",null,{id:p,"for":f.id},u[0]),e.push(m.join(""))}return new CKEDITOR.ui.dialog.hbox(t,r,e,n),n.join("")}),this._.children=r}},button:function(t,i,n){if(arguments.length){"function"==typeof i&&(i=i(t.getParentEditor())),e.call(this,i,{disabled:i.disabled||!1}),CKEDITOR.event.implementOn(this);var r=this;t.on("load",function(){var e=this.getElement();!function(){e.on("click",function(e){r.click(),e.data.preventDefault()}),e.on("keydown",function(e){e.data.getKeystroke()in{32:1}&&(r.click(),e.data.preventDefault())})}(),e.unselectable()},this);var o=CKEDITOR.tools.extend({},i);delete o.style;var s=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,t,o,n,"a",null,{style:i.style,href:"javascript:void(0)",title:i.label,hidefocus:"true","class":i["class"],role:"button","aria-labelledby":s},'<span id="'+s+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(i.label)+"</span>")}},select:function(t,i,n){if(!(arguments.length<3)){var r=e.call(this,i);i.validate&&(this.validate=i.validate),r.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,t,i,n,function(){var e=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),n=[],o=[],a={id:r.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};n.push('<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'),i.width&&n.push('style="width:'+i.width+'" '),n.push(">"),void 0!==i.size&&(a.size=i.size),void 0!==i.multiple&&(a.multiple=i.multiple),s(e);for(var l,u=0;u<i.items.length&&(l=i.items[u]);u++)o.push('<option value="',CKEDITOR.tools.htmlEncode(void 0!==l[1]?l[1]:l[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(l[0]));return"undefined"!=typeof e.inputStyle&&(e.style=e.inputStyle),r.select=new CKEDITOR.ui.dialog.uiElement(t,e,n,"select",null,a,o.join("")),n.push("</div>"),n.join("")})}},file:function(t,i,n){if(!(arguments.length<3)){void 0===i["default"]&&(i["default"]="");var r=CKEDITOR.tools.extend(e.call(this,i),{definition:i,buttons:[]});i.validate&&(this.validate=i.validate),t.on("load",function(){CKEDITOR.document.getById(r.frameId).getParent().addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,n,function(){r.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var e=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',r.frameId,'" title="',i.label,'" src="javascript:void('];return e.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),e.push(')"></iframe>'),e.join("")})}},fileButton:function(t,i,n){var r=this;if(!(arguments.length<3)){e.call(this,i),i.validate&&(this.validate=i.validate);var o=CKEDITOR.tools.extend({},i),s=o.onClick;o.className=(o.className?o.className+" ":"")+"cke_dialog_ui_button",o.onClick=function(e){var n=i["for"];s&&s.call(this,e)===!1||(t.getContentElement(n[0],n[1]).submit(),this.disable())},t.on("load",function(){t.getContentElement(i["for"][0],i["for"][1])._.buttons.push(r)}),CKEDITOR.ui.dialog.button.call(this,t,o,n)}},html:function(){var e=/^\s*<[\w:]+\s+([^>]*)?>/,t=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,i=/\/$/;return function(n,r,o){if(!(arguments.length<3)){var s=[],a=r.html;"<"!=a.charAt(0)&&(a="<span>"+a+"</span>");var l=r.focus;if(l){var u=this.focus;this.focus=function(){("function"==typeof l?l:u).call(this),this.fire("focus")},r.isFocusable&&(this.isFocusable=this.isFocusable),this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,n,r,s,"span",null,null,""),s=s.join("").match(e),a=a.match(t)||["","",""],i.test(a[1])&&(a[1]=a[1].slice(0,-1),a[2]="/"+a[2]),o.push([a[1]," ",s[1]||"",a[2]].join(""))}}}(),fieldset:function(e,t,i,n,r){var o=r.label;this._={children:t},CKEDITOR.ui.dialog.uiElement.call(this,e,r,n,"fieldset",null,null,function(){var e=[];o&&e.push("<legend"+(r.labelStyle?' style="'+r.labelStyle+'"':"")+">"+o+"</legend>");for(var t=0;t<i.length;t++)e.push(i[t]);return e.join("")})}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(e){var t=CKEDITOR.document.getById(this._.labelId);return t.getChildCount()<1?new CKEDITOR.dom.text(e,CKEDITOR.document).appendTo(t):t.getChild(0).$.nodeValue=e,this},getLabel:function(){var e=CKEDITOR.document.getById(this._.labelId);return!e||e.getChildCount()<1?"":e.getChild(0).getText()},eventProcessors:r},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled&&this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var e=this.getElement();e&&e.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(e,t){this.on("click",function(){t.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&t.$.focus()},0)},select:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&(t.$.focus(),t.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(e){return!e&&(e=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(e,t,i){var n=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),r=this.getInputElement().$;return n.$.text=e,n.$.value=void 0===t||null===t?e:t,void 0===i||null===i?CKEDITOR.env.ie?r.add(n.$):r.add(n.$,null):r.add(n.$,i),this},remove:function(e){return this.getInputElement().$.remove(e),this},clear:function(){for(var e=this.getInputElement().$;e.length>0;)e.remove(0);return this},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(e,t){this.getInputElement().$.checked=e,!t&&this.fire("change",{value:e})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||CKEDITOR.env.version>8?r.onChange.apply(this,arguments):(e.on("load",function(){var e=this._.checkbox.getElement();e.on("propertychange",function(t){t=t.data.$,"checked"==t.propertyName&&this.fire("change",{value:e.$.checked})},this)},this),this.on("change",t),null)}},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(e,t){for(var i,n=this._.children,r=0;r<n.length&&(i=n[r]);r++)i.getElement().$.checked=i.getValue()==e;!t&&this.fire("change",{value:e})},getValue:function(){for(var e=this._.children,t=0;t<e.length;t++)if(e[t].getElement().$.checked)return e[t].getValue();return null},accessKeyUp:function(){var e,t=this._.children;for(e=0;e<t.length;e++)if(t[e].getElement().$.checked)return void t[e].getElement().focus();t[0].getElement().focus()},eventProcessors:{onChange:function(e,t){return CKEDITOR.env.ie?(e.on("load",function(){for(var e=this._.children,t=this,i=0;i<e.length;i++)e[i].getElement().on("propertychange",function(e){e=e.data.$,"checked"==e.propertyName&&this.$.checked&&t.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",t),null):r.onChange.apply(this,arguments)}}},n,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var e=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return e.$.forms.length>0?new CKEDITOR.dom.element(e.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(e){var t,i,n=/^on([A-Z]\w+)/,r=function(e,t,i,n){e.on("formLoaded",function(){e.getInputElement().on(i,n,e)})};for(i in e)(t=i.match(n))&&(this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,e[i]):r(this,this._.dialog,t[1].toLowerCase(),e[i]));return this},reset:function(){function e(){i.$.open();var e="";n.size&&(e=n.size-(CKEDITOR.env.ie?7:0));var u=t.frameId+"_input";for(i.$.write(['<html dir="'+a+'" lang="'+l+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+a+'" lang="'+l+'" action="',CKEDITOR.tools.htmlEncode(n.action),'"><label id="',t.labelId,'" for="',u,'" style="display:none">',CKEDITOR.tools.htmlEncode(n.label),'</label><input style="width:100%" id="',u,'" aria-labelledby="',t.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(n.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(e>0?e:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+o+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+s+")}","</script>"].join("")),i.$.close(),e=0;e<r.length;e++)r[e].enable()}var t=this._,i=CKEDITOR.document.getById(t.frameId).getFrameDocument(),n=t.definition,r=t.buttons,o=this.formLoadedNumber,s=this.formUnloadNumber,a=t.dialog._.editor.lang.dir,l=t.dialog._.editor.langCode;o||(o=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),s=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(o),CKEDITOR.tools.removeFunction(s)})),CKEDITOR.env.gecko?setTimeout(e,500):e()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(e,t){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",t),CKEDITOR.dialog.addUIElement("password",t),CKEDITOR.dialog.addUIElement("textarea",i),CKEDITOR.dialog.addUIElement("checkbox",i),CKEDITOR.dialog.addUIElement("radio",i),CKEDITOR.dialog.addUIElement("button",i),CKEDITOR.dialog.addUIElement("select",i),CKEDITOR.dialog.addUIElement("file",i),CKEDITOR.dialog.addUIElement("fileButton",i),CKEDITOR.dialog.addUIElement("html",i),CKEDITOR.dialog.addUIElement("fieldset",{build:function(e,t,i){for(var n,r=t.children,o=[],s=[],a=0;a<r.length&&(n=r[a]);a++){var l=[];o.push(l),s.push(CKEDITOR.dialog._.uiElementBuilders[n.type].build(e,n,l))}return new CKEDITOR.ui.dialog[t.type](e,s,o,i,t)}})}}),CKEDITOR.DIALOG_RESIZE_NONE=0,CKEDITOR.DIALOG_RESIZE_WIDTH=1,CKEDITOR.DIALOG_RESIZE_HEIGHT=2,CKEDITOR.DIALOG_RESIZE_BOTH=3,function(){function e(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+e,i=t-1;i>t-e;i--)if(this._.tabs[this._.tabIdList[i%e]][0].$.offsetHeight)return this._.tabIdList[i%e];return null}function t(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),i=t+1;i<t+e;i++)if(this._.tabs[this._.tabIdList[i%e]][0].$.offsetHeight)return this._.tabIdList[i%e];return null}function i(e,t){for(var i=e.$.getElementsByTagName("input"),n=0,r=i.length;n<r;n++){var o=new CKEDITOR.dom.element(i[n]);"text"==o.getAttribute("type").toLowerCase()&&(t?(o.setAttribute("value",o.getCustomData("fake_value")||""),o.removeCustomData("fake_value")):(o.setCustomData("fake_value",o.getAttribute("value")),o.setAttribute("value","")))}}function n(e,t){var i=this.getInputElement();i&&(e?i.removeAttribute("aria-invalid"):i.setAttribute("aria-invalid",!0)),e||(this.select?this.select():this.focus()),t&&alert(t),this.fire("validated",{valid:e,msg:t})}function r(){var e=this.getInputElement();e&&e.removeAttribute("aria-invalid")}function o(e){var e=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",m).output({id:CKEDITOR.tools.getNextNumber(),editorId:e.id,langDir:e.lang.dir,langCode:e.langCode,editorDialogClass:"cke_editor_"+e.name.replace(/\./g,"\\.")+"_dialog",closeTitle:e.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),t=e.getChild([0,0,0,0,0]),i=t.getChild(0),n=t.getChild(1);if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var r="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())";CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+r+'" tabIndex="-1"></iframe>').appendTo(t.getParent())}return i.unselectable(),n.unselectable(),{element:e,parts:{dialog:e.getChild(0),title:i,close:n,tabs:t.getChild(2),contents:t.getChild([3,0,0,0]),footer:t.getChild([3,0,1,0])}}}function s(e,t,i){this.element=t,this.focusIndex=i,this.tabIndex=0,this.isFocusable=function(){return!t.getAttribute("disabled")&&t.isVisible()},this.focus=function(){e._.currentFocusIndex=this.focusIndex,this.element.focus()},t.on("keydown",function(e){e.data.getKeystroke()in{32:1,13:1}&&this.fire("click")}),t.on("focus",function(){this.fire("mouseover")}),t.on("blur",function(){this.fire("mouseout")})}function a(e){function t(){e.layout()}var i=CKEDITOR.document.getWindow();i.on("resize",t),e.on("hide",function(){i.removeListener("resize",t)})}function l(e,t){this._={dialog:e},CKEDITOR.tools.extend(this,t)}function u(e){function t(t){var i=e.getSize(),l=CKEDITOR.document.getWindow().getViewPaneSize(),u=t.data.$.screenX,c=t.data.$.screenY,h=u-n.x,d=c-n.y;n={x:u,y:c},r.x=r.x+h,r.y=r.y+d,e.move(r.x+a[3]<s?-a[3]:r.x-a[1]>l.width-i.width-s?l.width-i.width+("rtl"==o.lang.dir?0:a[1]):r.x,r.y+a[0]<s?-a[0]:r.y-a[2]>l.height-i.height-s?l.height-i.height+a[2]:r.y,1),t.data.preventDefault()}function i(){if(CKEDITOR.document.removeListener("mousemove",t),CKEDITOR.document.removeListener("mouseup",i),CKEDITOR.env.ie6Compat){var e=C.getChild(0).getFrameDocument();e.removeListener("mousemove",t),e.removeListener("mouseup",i)}}var n=null,r=null,o=e.getParentEditor(),s=o.config.dialog_magnetDistance,a=CKEDITOR.skin.margins||[0,0,0,0];"undefined"==typeof s&&(s=20),e.parts.title.on("mousedown",function(o){if(n={x:o.data.$.screenX,y:o.data.$.screenY},CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",i),r=e.getPosition(),CKEDITOR.env.ie6Compat){var s=C.getChild(0).getFrameDocument();s.on("mousemove",t),s.on("mouseup",i)}o.data.preventDefault()},e)}function c(e){function t(t){var i="rtl"==d.lang.dir,h=c.width,p=c.height,f=h+(t.data.$.screenX-n)*(i?-1:1)*(e._.moved?1:2),m=p+(t.data.$.screenY-r)*(e._.moved?1:2),g=e._.element.getFirst(),g=i&&g.getComputedStyle("right"),y=e.getPosition();y.y+m>u.height&&(m=u.height-y.y),(i?g:y.x)+f>u.width&&(f=u.width-(i?g:y.x)),s!=CKEDITOR.DIALOG_RESIZE_WIDTH&&s!=CKEDITOR.DIALOG_RESIZE_BOTH||(h=Math.max(o.minWidth||0,f-a)),s!=CKEDITOR.DIALOG_RESIZE_HEIGHT&&s!=CKEDITOR.DIALOG_RESIZE_BOTH||(p=Math.max(o.minHeight||0,m-l)),e.resize(h,p),e._.moved||e.layout(),t.data.preventDefault()}function i(){if(CKEDITOR.document.removeListener("mouseup",i),CKEDITOR.document.removeListener("mousemove",t),h&&(h.remove(),h=null),CKEDITOR.env.ie6Compat){var e=C.getChild(0).getFrameDocument();e.removeListener("mouseup",i),e.removeListener("mousemove",t)}}var n,r,o=e.definition,s=o.resizable;if(s!=CKEDITOR.DIALOG_RESIZE_NONE){var a,l,u,c,h,d=e.getParentEditor(),p=CKEDITOR.tools.addFunction(function(o){c=e.getSize();var s=e.parts.contents;s.$.getElementsByTagName("iframe").length&&(h=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),s.append(h)),l=c.height-e.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks)),a=c.width-e.parts.contents.getSize("width",1),n=o.screenX,r=o.screenY,u=CKEDITOR.document.getWindow().getViewPaneSize(),CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",i),CKEDITOR.env.ie6Compat&&(s=C.getChild(0).getFrameDocument(),s.on("mousemove",t),s.on("mouseup",i)),o.preventDefault&&o.preventDefault()});e.on("load",function(){var t="";s==CKEDITOR.DIALOG_RESIZE_WIDTH?t=" cke_resizer_horizontal":s==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(t=" cke_resizer_vertical"),t=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+t+" cke_resizer_"+d.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(d.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event )">'+("ltr"==d.lang.dir?"◢":"◣")+"</div>"),e.parts.footer.append(t,1)}),d.on("destroy",function(){CKEDITOR.tools.removeFunction(p)})}}function h(e){e.data.preventDefault(1)}function d(e){var t=CKEDITOR.document.getWindow(),i=e.config,n=i.dialog_backgroundCoverColor||"white",r=i.dialog_backgroundCoverOpacity,o=i.baseFloatZIndex,i=CKEDITOR.tools.genKey(n,r,o),s=O[i];s?s.show():(o=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",o,"; top: 0px; left: 0px; ",CKEDITOR.env.ie6Compat?"":"background-color: "+n,'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(n="<html><body style=\\'background-color:"+n+";\\'></body></html>",o.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),o.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+n+"' );document.close();")+"})())"),o.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),o.push("</div>"),s=CKEDITOR.dom.element.createFromHtml(o.join("")),s.setOpacity(void 0!==r?r:.5),s.on("keydown",h),s.on("keypress",h),s.on("keyup",h),s.appendTo(CKEDITOR.document.getBody()),O[i]=s),e.focusManager.add(s),C=s;var e=function(){var e=t.getViewPaneSize();s.setStyles({width:e.width+"px",height:e.height+"px"})},a=function(){var e=t.getScrollPosition(),i=CKEDITOR.dialog._.currentTop;if(s.setStyles({left:e.x+"px",top:e.y+"px"}),i)do e=i.getPosition(),i.move(e.x,e.y);while(i=i._.parentDialog)};if(b=e,t.on("resize",e),e(),(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&s.focus(),CKEDITOR.env.ie6Compat){var l=function(){a(),arguments.callee.prevScrollHandler.apply(this,arguments)};t.$.setTimeout(function(){l.prevScrollHandler=window.onscroll||function(){},window.onscroll=l},0),a()}}function p(e){C&&(e.focusManager.remove(C),e=CKEDITOR.document.getWindow(),C.hide(),e.removeListener("resize",b),CKEDITOR.env.ie6Compat&&e.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||null},0),b=null)}var f=CKEDITOR.tools.cssLength,m='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(i,s){function a(){var e=O._.focusList;e.sort(function(e,t){return e.tabIndex!=t.tabIndex?t.tabIndex-e.tabIndex:e.focusIndex-t.focusIndex});for(var t=e.length,i=0;i<t;i++)e[i].focusIndex=i}function l(e){var t=O._.focusList,e=e||0;if(!(t.length<1)){var i=O._.currentFocusIndex;O._.tabBarMode&&e<0&&(i=0);try{t[i].getInputElement().$.blur()}catch(n){}var r=i,o=O._.pageCount>1;do{if(r+=e,o&&!O._.tabBarMode&&(r==t.length||r==-1))return O._.tabBarMode=!0,O._.tabs[O._.currentTabId][0].focus(),void(O._.currentFocusIndex=-1);if(r=(r+t.length)%t.length,r==i)break}while(e&&!t[r].isFocusable());t[r].focus(),"text"==t[r].type&&t[r].select()}}function h(n){if(O==CKEDITOR.dialog._.currentTop){var r=n.data.getKeystroke(),o="rtl"==i.lang.dir,s=[37,38,39,40];if(p=f=0,9==r||r==CKEDITOR.SHIFT+9)l(r==CKEDITOR.SHIFT+9?-1:1),p=1;else if(r==CKEDITOR.ALT+121&&!O._.tabBarMode&&O.getPageCount()>1)O._.tabBarMode=!0,O._.tabs[O._.currentTabId][0].focus(),O._.currentFocusIndex=-1,p=1;else if(CKEDITOR.tools.indexOf(s,r)!=-1&&O._.tabBarMode)r=CKEDITOR.tools.indexOf([o?39:37,38],r)!=-1?e.call(O):t.call(O),O.selectPage(r),O._.tabs[r][0].focus(),p=1;else if(13!=r&&32!=r||!O._.tabBarMode)if(13==r)r=n.data.getTarget(),r.is("a","button","select","textarea")||r.is("input")&&"button"==r.$.type||((r=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(r.click,0,r),p=1),f=1;else{if(27!=r)return;(r=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(r.click,0,r):this.fire("cancel",{hide:!0}).hide!==!1&&this.hide(),f=1}else this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,l(1),p=1;d(n)}}function d(e){p?e.data.preventDefault(1):f&&e.data.stopPropagation()}var p,f,m=CKEDITOR.dialog._.dialogDefinitions[s],y=CKEDITOR.tools.clone(g),v=i.config.dialog_buttonsOrder||"OS",E=i.lang.dir,b={};if(("OS"==v&&CKEDITOR.env.mac||"rtl"==v&&"ltr"==E||"ltr"==v&&"rtl"==E)&&y.buttons.reverse(),m=CKEDITOR.tools.extend(m(i),y),m=CKEDITOR.tools.clone(m),m=new T(this,m),y=o(i),this._={editor:i,element:y.element,name:s,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1},this.parts=y.parts,CKEDITOR.tools.setTimeout(function(){i.fire("ariaWidget",this.parts.contents)},0,this),y={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"},y["rtl"==E?"right":"left"]=0,this.parts.dialog.setStyles(y),CKEDITOR.event.call(this),this.definition=m=CKEDITOR.fire("dialogDefinition",{name:s,definition:m},i).definition,!("removeDialogTabs"in i._)&&i.config.removeDialogTabs){for(y=i.config.removeDialogTabs.split(";"),E=0;E<y.length;E++)if(v=y[E].split(":"),2==v.length){var C=v[0];b[C]||(b[C]=[]),b[C].push(v[1])}i._.removeDialogTabs=b}if(i._.removeDialogTabs&&(b=i._.removeDialogTabs[s]))for(E=0;E<b.length;E++)m.removeContents(b[E]);m.onLoad&&this.on("load",m.onLoad),m.onShow&&this.on("show",m.onShow),m.onHide&&this.on("hide",m.onHide),m.onOk&&this.on("ok",function(e){i.fire("saveSnapshot"),setTimeout(function(){i.fire("saveSnapshot")},0),m.onOk.call(this,e)===!1&&(e.data.hide=!1)}),m.onCancel&&this.on("cancel",function(e){m.onCancel.call(this,e)===!1&&(e.data.hide=!1)});var O=this,x=function(e){var t,i=O._.contents,n=!1;for(t in i)for(var r in i[t])if(n=e.call(this,i[t][r]))return};this.on("ok",function(e){x(function(t){if(t.validate){var i=t.validate(this),r="string"==typeof i||i===!1;return r&&(e.data.hide=!1,e.stop()),n.call(t,!r,"string"==typeof i?i:void 0),r}})},this,null,0),this.on("cancel",function(e){x(function(t){if(t.isChanged())return i.config.dialog_noConfirmCancel||confirm(i.lang.common.confirmCancel)||(e.data.hide=!1),!0})},this,null,0),this.parts.close.on("click",function(e){this.fire("cancel",{hide:!0}).hide!==!1&&this.hide(),e.data.preventDefault()},this),this.changeFocus=l;var w=this._.element;for(i.focusManager.add(w,1),this.on("show",function(){w.on("keydown",h,this),CKEDITOR.env.gecko&&w.on("keypress",d,this)}),this.on("hide",function(){w.removeListener("keydown",h),CKEDITOR.env.gecko&&w.removeListener("keypress",d),x(function(e){r.apply(e)})}),this.on("iframeAdded",function(e){
new CKEDITOR.dom.document(e.data.iframe.$.contentWindow.document).on("keydown",h,this,null,0)}),this.on("show",function(){a();var e=O._.pageCount>1;i.config.dialog_startupFocusTab&&e?(O._.tabBarMode=!0,O._.tabs[O._.currentTabId][0].focus(),O._.currentFocusIndex=-1):this._.hasFocus||(this._.currentFocusIndex=e?-1:this._.focusList.length-1,m.onFocus?(e=m.onFocus.call(this))&&e.focus():l(1))},this,null,4294967295),CKEDITOR.env.ie6Compat&&this.on("load",function(){var e=this.getElement(),t=e.getFirst();t.remove(),t.appendTo(e)},this),u(this),c(this),new CKEDITOR.dom.text(m.title,CKEDITOR.document).appendTo(this.parts.title),E=0;E<m.contents.length;E++)(b=m.contents[E])&&this.addPage(b);for(this.parts.tabs.on("click",function(e){var t=e.data.getTarget();t.hasClass("cke_dialog_tab")&&(t=t.$.id,this.selectPage(t.substring(4,t.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,l(1)),e.data.preventDefault())},this),E=[],b=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:m.buttons},E).getChild(),this.parts.footer.setHtml(E.join("")),E=0;E<b.length;E++)this._.buttons[b[E].id]=b[E]},CKEDITOR.dialog.prototype={destroy:function(){this.hide(),this._.element.remove()},resize:function(){return function(e,t){this._.contentSize&&this._.contentSize.width==e&&this._.contentSize.height==t||(CKEDITOR.dialog.fire("resize",{dialog:this,width:e,height:t},this._.editor),this.fire("resize",{width:e,height:t},this._.editor),this.parts.contents.setStyles({width:e+"px",height:t+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:e,height:t})}}(),getSize:function(){var e=this._.element.getFirst();return{width:e.$.offsetWidth||0,height:e.$.offsetHeight||0}},move:function(e,t,i){var n=this._.element.getFirst(),r="rtl"==this._.editor.lang.dir,o="fixed"==n.getComputedStyle("position");CKEDITOR.env.ie&&n.setStyle("zoom","100%"),o&&this._.position&&this._.position.x==e&&this._.position.y==t||(this._.position={x:e,y:t},o||(o=CKEDITOR.document.getWindow().getScrollPosition(),e+=o.x,t+=o.y),r&&(o=this.getSize(),e=CKEDITOR.document.getWindow().getViewPaneSize().width-o.width-e),t={top:(t>0?t:0)+"px"},t[r?"right":"left"]=(e>0?e:0)+"px",n.setStyles(t),i&&(this._.moved=1))},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var e=this._.element,t=this.definition;e.getParent()&&e.getParent().equals(CKEDITOR.document.getBody())?e.setStyle("display","block"):e.appendTo(CKEDITOR.document.getBody()),this.resize(this._.contentSize&&this._.contentSize.width||t.width||t.minWidth,this._.contentSize&&this._.contentSize.height||t.height||t.minHeight),this.reset(),this.selectPage(this.definition.contents[0].id),null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex),this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex=CKEDITOR.dialog._.currentZIndex+10),null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,d(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this),e.on("keydown",w),e.on("keyup",R),this._.hasFocus=!1;for(var i in t.contents)if(t.contents[i]){var e=t.contents[i],n=this._.tabs[e.id],r=e.requiredContent,o=0;if(n){for(var s in this._.contents[e.id]){var l=this._.contents[e.id][s];"hbox"!=l.type&&"vbox"!=l.type&&l.getInputElement()&&(l.requiredContent&&!this._.editor.activeFilter.check(l.requiredContent)?l.disable():(l.enable(),o++))}!o||r&&!this._.editor.activeFilter.check(r)?n[0].addClass("cke_dialog_tab_disabled"):n[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout(),a(this),this.parts.dialog.setStyle("visibility",""),this.fireOnce("load",{}),CKEDITOR.ui.fire("ready",this),this.fire("show",{}),this._.editor.fire("dialogShow",this),this._.parentDialog||this._.editor.focusManager.lock(),this.foreach(function(e){e.setInitValue&&e.setInitValue()})},100,this)},layout:function(){var e=this.parts.dialog,t=this.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize(),n=(i.width-t.width)/2,r=(i.height-t.height)/2;CKEDITOR.env.ie6Compat||(t.height+(r>0?r:0)>i.height||t.width+(n>0?n:0)>i.width?e.setStyle("position","absolute"):e.setStyle("position","fixed")),this.move(this._.moved?this._.position.x:n,this._.moved?this._.position.y:r)},foreach:function(e){for(var t in this._.contents)for(var i in this._.contents[t])e.call(this,this._.contents[t][i]);return this},reset:function(){var e=function(e){e.reset&&e.reset(1)};return function(){return this.foreach(e),this}}(),setupContent:function(){var e=arguments;this.foreach(function(t){t.setup&&t.setup.apply(t,e)})},commitContent:function(){var e=arguments;this.foreach(function(t){CKEDITOR.env.ie&&this._.currentFocusIndex==t.focusIndex&&t.getInputElement().$.blur(),t.commit&&t.commit.apply(t,e)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{}),this._.editor.fire("dialogHide",this),this.selectPage(this._.tabIdList[0]);var e=this._.element;for(e.setStyle("display","none"),this.parts.dialog.setStyle("visibility","hidden"),S(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var t=this._.parentDialog.getElement().getFirst();t.setStyle("z-index",parseInt(t.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else p(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex=CKEDITOR.dialog._.currentZIndex-10;else{CKEDITOR.dialog._.currentZIndex=null,e.removeListener("keydown",w),e.removeListener("keyup",R);var i=this._.editor;i.focus(),setTimeout(function(){i.focusManager.unlock(),CKEDITOR.env.iOS&&i.window.focus()},0)}delete this._.parentDialog,this.foreach(function(e){e.resetInitValue&&e.resetInitValue()})}},addPage:function(e){if(!e.requiredContent||this._.editor.filter.check(e.requiredContent)){for(var t=[],i=e.label?' title="'+CKEDITOR.tools.htmlEncode(e.label)+'"':"",n=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:e.elements,expand:!!e.expand,padding:e.padding,style:e.style||"width: 100%;"},t),r=this._.contents[e.id]={},o=n.getChild(),s=0;n=o.shift();)!n.notAllowed&&"hbox"!=n.type&&"vbox"!=n.type&&s++,r[n.id]=n,"function"==typeof n.getChild&&o.push.apply(o,n.getChild());s||(e.hidden=!0),t=CKEDITOR.dom.element.createFromHtml(t.join("")),t.setAttribute("role","tabpanel"),n=CKEDITOR.env,r="cke_"+e.id+"_"+CKEDITOR.tools.getNextNumber(),i=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',this._.pageCount>0?" cke_last":"cke_first",i,e.hidden?' style="display:none"':"",' id="',r,'"',n.gecko&&!n.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',e.label,"</a>"].join("")),t.setAttribute("aria-labelledby",r),this._.tabs[e.id]=[i,t],this._.tabIdList.push(e.id),!e.hidden&&this._.pageCount++,this._.lastTab=i,this.updateStyle(),t.setAttribute("name",e.id),t.appendTo(this.parts.contents),i.unselectable(),this.parts.tabs.append(i),e.accessKey&&(L(this,this,"CTRL+"+e.accessKey,I,_),this._.accessKeyMap["CTRL+"+e.accessKey]=e.id)}},selectPage:function(e){if(this._.currentTabId!=e&&!this._.tabs[e][0].hasClass("cke_dialog_tab_disabled")&&this.fire("selectPage",{page:e,currentPage:this._.currentTabId})!==!1){for(var t in this._.tabs){var n=this._.tabs[t][0],r=this._.tabs[t][1];t!=e&&(n.removeClass("cke_dialog_tab_selected"),r.hide()),r.setAttribute("aria-hidden",t!=e)}var o=this._.tabs[e];o[0].addClass("cke_dialog_tab_selected"),CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(i(o[1]),o[1].show(),setTimeout(function(){i(o[1],1)},0)):o[1].show(),this._.currentTabId=e,this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,e)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(t){var i=this._.tabs[t]&&this._.tabs[t][0];i&&1!=this._.pageCount&&i.isVisible()&&(t==this._.currentTabId&&this.selectPage(e.call(this)),i.hide(),this._.pageCount--,this.updateStyle())},showPage:function(e){(e=this._.tabs[e]&&this._.tabs[e][0])&&(e.show(),this._.pageCount++,this.updateStyle())},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(e,t){var i=this._.contents[e];return i&&i[t]},getValueOf:function(e,t){return this.getContentElement(e,t).getValue()},setValueOf:function(e,t,i){return this.getContentElement(e,t).setValue(i)},getButton:function(e){return this._.buttons[e]},click:function(e){return this._.buttons[e].click()},disableButton:function(e){return this._.buttons[e].disable()},enableButton:function(e){return this._.buttons[e].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(e,t){if("undefined"==typeof t)t=this._.focusList.length,this._.focusList.push(new s(this,e,t));else{this._.focusList.splice(t,0,new s(this,e,t));for(var i=t+1;i<this._.focusList.length;i++)this._.focusList[i].focusIndex++}}},CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(e,t){this._.dialogDefinitions[e]&&"function"!=typeof t||(this._.dialogDefinitions[e]=t)},exists:function(e){return!!this._.dialogDefinitions[e]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(e,t,i){return e=e.config.removeDialogTabs,!(e&&e.match(RegExp("(?:^|;)"+t+":"+i+"(?:$|;)","i")))},okButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"ok",type:"button",label:e.lang.common.ok,"class":"cke_dialog_ui_button_ok",onClick:function(e){e=e.data.dialog,e.fire("ok",{hide:!0}).hide!==!1&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend(function(i){return e(i,t)},{type:"button"},!0)},e}(),cancelButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"cancel",type:"button",label:e.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(e){e=e.data.dialog,e.fire("cancel",{hide:!0}).hide!==!1&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend(function(i){return e(i,t)},{type:"button"},!0)},e}(),addUIElement:function(e,t){this._.uiElementBuilders[e]=t}}),CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null},CKEDITOR.event.implementOn(CKEDITOR.dialog),CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var g={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},y=function(e,t,i){for(var n,r=0;n=e[r];r++){if(n.id==t)return n;if(i&&n[i]&&(n=y(n[i],t,i)))return n}return null},v=function(e,t,i,n,r){if(i){for(var o,s=0;o=e[s];s++){if(o.id==i)return e.splice(s,0,t),t;if(n&&o[n]&&(o=v(o[n],t,i,n,!0)))return o}if(r)return null}return e.push(t),t},E=function(e,t,i){for(var n,r=0;n=e[r];r++){if(n.id==t)return e.splice(r,1);if(i&&n[i]&&(n=E(n[i],t,i)))return n}return null},T=function(e,t){this.dialog=e;for(var i,n=t.contents,r=0;i=n[r];r++)n[r]=i&&new l(e,i);CKEDITOR.tools.extend(this,t)};T.prototype={getContents:function(e){return y(this.contents,e)},getButton:function(e){return y(this.buttons,e)},addContents:function(e,t){return v(this.contents,e,t)},addButton:function(e,t){return v(this.buttons,e,t)},removeContents:function(e){E(this.contents,e)},removeButton:function(e){E(this.buttons,e)}},l.prototype={get:function(e){return y(this.elements,e,"children")},add:function(e,t){return v(this.elements,e,t,"children")},remove:function(e){E(this.elements,e,"children")}};var b,C,O={},x={},w=function(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,i=e.data.$.altKey,n=e.data.$.shiftKey,r=String.fromCharCode(e.data.$.keyCode);(t=x[(t?"CTRL+":"")+(i?"ALT+":"")+(n?"SHIFT+":"")+r])&&t.length&&(t=t[t.length-1],t.keydown&&t.keydown.call(t.uiElement,t.dialog,t.key),e.data.preventDefault())},R=function(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,i=e.data.$.altKey,n=e.data.$.shiftKey,r=String.fromCharCode(e.data.$.keyCode);(t=x[(t?"CTRL+":"")+(i?"ALT+":"")+(n?"SHIFT+":"")+r])&&t.length&&(t=t[t.length-1],t.keyup&&(t.keyup.call(t.uiElement,t.dialog,t.key),e.data.preventDefault()))},L=function(e,t,i,n,r){(x[i]||(x[i]=[])).push({uiElement:e,dialog:t,key:i,keyup:r||e.accessKeyUp,keydown:n||e.accessKeyDown})},S=function(e){for(var t in x){for(var i=x[t],n=i.length-1;n>=0;n--)(i[n].dialog==e||i[n].uiElement==e)&&i.splice(n,1);0===i.length&&delete x[t]}},_=function(e,t){e._.accessKeyMap[t]&&e.selectPage(e._.accessKeyMap[t])},I=function(){};!function(){CKEDITOR.ui.dialog={uiElement:function(e,t,i,n,r,o,s){if(!(arguments.length<4)){var a=(n.call?n(t):n)||"div",l=["<",a," "],u=(r&&r.call?r(t):r)||{},c=(o&&o.call?o(t):o)||{},h=(s&&s.call?s.call(this,e,t):s)||"",d=this.domId=c.id||CKEDITOR.tools.getNextId()+"_uiElement";t.requiredContent&&!e.getParentEditor().filter.check(t.requiredContent)&&(u.display="none",this.notAllowed=!0),c.id=d;var p={};t.type&&(p["cke_dialog_ui_"+t.type]=1),t.className&&(p[t.className]=1),t.disabled&&(p.cke_disabled=1);for(var f=c["class"]&&c["class"].split?c["class"].split(" "):[],d=0;d<f.length;d++)f[d]&&(p[f[d]]=1);f=[];for(d in p)f.push(d);c["class"]=f.join(" "),t.title&&(c.title=t.title),p=(t.style||"").split(";"),t.align&&(f=t.align,u["margin-left"]="left"==f?0:"auto",u["margin-right"]="right"==f?0:"auto");for(d in u)p.push(d+":"+u[d]);for(t.hidden&&p.push("display:none"),d=p.length-1;d>=0;d--)""===p[d]&&p.splice(d,1);p.length>0&&(c.style=(c.style?c.style+"; ":"")+p.join("; "));for(d in c)l.push(d+'="'+CKEDITOR.tools.htmlEncode(c[d])+'" ');l.push(">",h,"</",a,">"),i.push(l.join("")),(this._||(this._={})).dialog=e,"boolean"==typeof t.isChanged&&(this.isChanged=function(){return t.isChanged}),"function"==typeof t.isChanged&&(this.isChanged=t.isChanged),"function"==typeof t.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(e){return function(i){e.call(this,t.setValue.call(this,i))}})),"function"==typeof t.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(e){return function(){return t.getValue.call(this,e.call(this))}})),CKEDITOR.event.implementOn(this),this.registerEvents(t),this.accessKeyUp&&this.accessKeyDown&&t.accessKey&&L(this,e,"CTRL+"+t.accessKey);var m=this;e.on("load",function(){var t=m.getInputElement();if(t){var i=m.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";t.on("focus",function(){e._.tabBarMode=!1,e._.hasFocus=!0,m.fire("focus"),i&&this.addClass(i)}),t.on("blur",function(){m.fire("blur"),i&&this.removeClass(i)})}}),CKEDITOR.tools.extend(this,t),this.keyboardFocusable&&(this.tabIndex=t.tabIndex||0,this.focusIndex=e._.focusList.push(this)-1,this.on("focus",function(){e._.currentFocusIndex=m.focusIndex}))}},hbox:function(e,t,i,n,r){if(!(arguments.length<4)){this._||(this._={});var o,s=this._.children=t,a=r&&r.widths||null,l=r&&r.height||null,u={role:"presentation"};r&&r.align&&(u.align=r.align),CKEDITOR.ui.dialog.uiElement.call(this,e,r||{type:"hbox"},n,"table",{},u,function(){var e=['<tbody><tr class="cke_dialog_ui_hbox">'];for(o=0;o<i.length;o++){var t="cke_dialog_ui_hbox_child",n=[];0===o&&(t="cke_dialog_ui_hbox_first"),o==i.length-1&&(t="cke_dialog_ui_hbox_last"),e.push('<td class="',t,'" role="presentation" '),a?a[o]&&n.push("width:"+f(a[o])):n.push("width:"+Math.floor(100/i.length)+"%"),l&&n.push("height:"+f(l)),r&&void 0!==r.padding&&n.push("padding:"+f(r.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&s[o].align&&n.push("text-align:"+s[o].align),n.length>0&&e.push('style="'+n.join("; ")+'" '),e.push(">",i[o],"</td>")}return e.push("</tr></tbody>"),e.join("")})}},vbox:function(e,t,i,n,r){if(!(arguments.length<3)){this._||(this._={});var o=this._.children=t,s=r&&r.width||null,a=r&&r.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,e,r||{type:"vbox"},n,"div",null,{role:"presentation"},function(){var t=['<table role="presentation" cellspacing="0" border="0" '];t.push('style="'),r&&r.expand&&t.push("height:100%;"),t.push("width:"+f(s||"100%"),";"),CKEDITOR.env.webkit&&t.push("float:none;"),t.push('"'),t.push('align="',CKEDITOR.tools.htmlEncode(r&&r.align||("ltr"==e.getParentEditor().lang.dir?"left":"right")),'" '),t.push("><tbody>");for(var n=0;n<i.length;n++){var l=[];t.push('<tr><td role="presentation" '),s&&l.push("width:"+f(s||"100%")),a?l.push("height:"+f(a[n])):r&&r.expand&&l.push("height:"+Math.floor(100/i.length)+"%"),r&&void 0!==r.padding&&l.push("padding:"+f(r.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&o[n].align&&l.push("text-align:"+o[n].align),l.length>0&&t.push('style="',l.join("; "),'" '),t.push(' class="cke_dialog_ui_vbox_child">',i[n],"</td></tr>")}return t.push("</tbody></table>"),t.join("")})}}}}(),CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(e,t){return this.getInputElement().setValue(e),!t&&this.fire("change",{value:e}),this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var e=this.getInputElement();(e=e.getParent())&&e.$.className.search("cke_dialog_page_contents")==-1;);return e?(e=e.getAttribute("name"),this._.dialog._.currentTabId!=e&&this._.dialog.selectPage(e),this):this},focus:function(){return this.selectParentTab().getInputElement().focus(),this},registerEvents:function(e){var t,i,n=/^on([A-Z]\w+)/,r=function(e,t,i,n){t.on("load",function(){e.getInputElement().on(i,n,e)})};for(i in e)(t=i.match(n))&&(this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,e[i]):r(this,this._.dialog,t[1].toLowerCase(),e[i]));return this},eventProcessors:{onLoad:function(e,t){e.on("load",t,this)},onShow:function(e,t){e.on("show",t,this)},onHide:function(e,t){e.on("hide",t,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var e=this.getElement();this.getInputElement().setAttribute("disabled","true"),e.addClass("cke_disabled")},enable:function(){var e=this.getElement();this.getInputElement().removeAttribute("disabled"),e.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!(!this.isEnabled()||!this.isVisible())}},CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(e){return arguments.length<1?this._.children.concat():(e.splice||(e=[e]),e.length<2?this._.children[e[0]]:this._.children[e[0]]&&this._.children[e[0]].getChild?this._.children[e[0]].getChild(e.slice(1,e.length)):null)}},!0),CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox,function(){var e={build:function(e,t,i){for(var n,r=t.children,o=[],s=[],a=0;a<r.length&&(n=r[a]);a++){var l=[];o.push(l),s.push(CKEDITOR.dialog._.uiElementBuilders[n.type].build(e,n,l))}return new CKEDITOR.ui.dialog[t.type](e,s,o,i,t)}};CKEDITOR.dialog.addUIElement("hbox",e),CKEDITOR.dialog.addUIElement("vbox",e)}(),CKEDITOR.dialogCommand=function(e,t){this.dialogName=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.dialogCommand.prototype={exec:function(e){e.openDialog(this.dialogName)},canUndo:!1,editorFocus:1},function(){var e=/^([a]|[^a])+$/,t=/^\d*$/,i=/^\d*(?:\.\d+)?$/,n=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,r=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,o=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1,CKEDITOR.VALIDATE_AND=2,CKEDITOR.dialog.validate={functions:function(){var e=arguments;return function(){var t,i,n=this&&this.getValue?this.getValue():e[0],r=CKEDITOR.VALIDATE_AND,o=[];for(i=0;i<e.length&&"function"==typeof e[i];i++)o.push(e[i]);i<e.length&&"string"==typeof e[i]&&(t=e[i],i++),i<e.length&&"number"==typeof e[i]&&(r=e[i]);var s=r==CKEDITOR.VALIDATE_AND;for(i=0;i<o.length;i++)s=r==CKEDITOR.VALIDATE_AND?s&&o[i](n):s||o[i](n);return!!s||t}},regex:function(e,t){return function(i){return i=this&&this.getValue?this.getValue():i,!!e.test(i)||t}},notEmpty:function(t){return this.regex(e,t)},integer:function(e){return this.regex(t,e)},number:function(e){return this.regex(i,e)},cssLength:function(e){return this.functions(function(e){return r.test(CKEDITOR.tools.trim(e))},e)},htmlLength:function(e){return this.functions(function(e){return n.test(CKEDITOR.tools.trim(e))},e)},inlineStyle:function(e){return this.functions(function(e){return o.test(CKEDITOR.tools.trim(e))},e)},equals:function(e,t){return this.functions(function(t){return t==e},t)},notEqual:function(e,t){return this.functions(function(t){return t!=e},t)}},CKEDITOR.on("instanceDestroyed",function(e){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var t;t=CKEDITOR.dialog._.currentTop;)t.hide();for(var i in O)O[i].remove();O={}}var n,e=e.editor._.storedDialogs;for(n in e)e[n].destroy()})}(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(e,t){var i=null,n=CKEDITOR.dialog._.dialogDefinitions[e];if(null===CKEDITOR.dialog._.currentTop&&d(this),"function"==typeof n)i=this._.storedDialogs||(this._.storedDialogs={}),i=i[e]||(i[e]=new CKEDITOR.dialog(this,e)),t&&t.call(i,i),i.show();else{if("failed"==n)throw p(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+e+'" failed when loading definition.');"string"==typeof n&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(n),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[e]&&(CKEDITOR.dialog._.dialogDefinitions[e]="failed"),this.openDialog(e,t)},this,0,1)}return CKEDITOR.skin.loadPart("dialog"),i}})}(),CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(e){e.on("doubleclick",function(t){t.data.dialog&&e.openDialog(t.data.dialog)},null,null,999)}}),function(){CKEDITOR.plugins.add("a11yhelp",{requires:"dialog",availableLangs:{af:1,ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,sr:1,"sr-latn":1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},init:function(e){var t=this;e.addCommand("a11yHelp",{exec:function(){var i=e.langCode,i=t.availableLangs[i]?i:t.availableLangs[i.replace(/-.*/,"")]?i.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(t.path+"dialogs/lang/"+i+".js"),function(){e.lang.a11yhelp=t.langEntries[i],e.openDialog("a11yHelp")})},modes:{wysiwyg:1,source:1},readOnly:1,canUndo:!1}),e.setKeystroke(CKEDITOR.ALT+48,"a11yHelp"),CKEDITOR.dialog.add("a11yHelp",this.path+"dialogs/a11yhelp.js"),e.on("ariaEditorHelpLabel",function(t){t.data.label=e.lang.common.editorHelp})}})}(),CKEDITOR.plugins.add("about",{requires:"dialog",init:function(e){var t=e.addCommand("about",new CKEDITOR.dialogCommand("about"));t.modes={wysiwyg:1,source:1},t.canUndo=!1,t.readOnly=1,e.ui.addButton&&e.ui.addButton("About",{label:e.lang.about.title,command:"about",toolbar:"about"}),CKEDITOR.dialog.add("about",this.path+"dialogs/about.js")}}),CKEDITOR.plugins.add("basicstyles",{init:function(e){var t=0,i=function(i,r,o,s){if(s){var s=new CKEDITOR.style(s),a=n[o];a.unshift(s),e.attachStyleStateChange(s,function(t){!e.readOnly&&e.getCommand(o).setState(t)}),e.addCommand(o,new CKEDITOR.styleCommand(s,{contentForms:a})),e.ui.addButton&&e.ui.addButton(i,{label:r,command:o,toolbar:"basicstyles,"+(t+=10)})}},n={bold:["strong","b",["span",function(e){return e=e.styles["font-weight"],"bold"==e||+e>=700}]],italic:["em","i",["span",function(e){return"italic"==e.styles["font-style"]}]],underline:["u",["span",function(e){return"underline"==e.styles["text-decoration"]}]],strike:["s","strike",["span",function(e){return"line-through"==e.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},r=e.config,o=e.lang.basicstyles;i("Bold",o.bold,"bold",r.coreStyles_bold),i("Italic",o.italic,"italic",r.coreStyles_italic),i("Underline",o.underline,"underline",r.coreStyles_underline),i("Strike",o.strike,"strike",r.coreStyles_strike),i("Subscript",o.subscript,"subscript",r.coreStyles_subscript),i("Superscript",o.superscript,"superscript",r.coreStyles_superscript),e.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}}),CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"},CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"},CKEDITOR.config.coreStyles_underline={element:"u"},CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"},CKEDITOR.config.coreStyles_subscript={element:"sub"},CKEDITOR.config.coreStyles_superscript={element:"sup"},function(){var e={exec:function(e){var t=e.getCommand("blockquote").state,i=e.getSelection(),n=i&&i.getRanges()[0];if(n){var r=i.createBookmarks();if(CKEDITOR.env.ie){var o,s=r[0].startNode,a=r[0].endNode;if(s&&"blockquote"==s.getParent().getName())for(o=s;o=o.getNext();)if(o.type==CKEDITOR.NODE_ELEMENT&&o.isBlockBoundary()){s.move(o,!0);break}if(a&&"blockquote"==a.getParent().getName())for(o=a;o=o.getPrevious();)if(o.type==CKEDITOR.NODE_ELEMENT&&o.isBlockBoundary()){a.move(o);break}}var l=n.createIterator();if(l.enlargeBr=e.config.enterMode!=CKEDITOR.ENTER_BR,t==CKEDITOR.TRISTATE_OFF){for(s=[];t=l.getNextParagraph();)s.push(t);for(s.length<1&&(t=e.document.createElement(e.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),a=r.shift(),n.insertNode(t),t.append(new CKEDITOR.dom.text("\ufeff",e.document)),n.moveToBookmark(a),n.selectNodeContents(t),n.collapse(!0),a=n.createBookmark(),s.push(t),r.unshift(a)),o=s[0].getParent(),n=[],a=0;a<s.length;a++)t=s[a],o=o.getCommonAncestor(t.getParent());for(t={table:1,tbody:1,tr:1,ol:1,ul:1};t[o.getName()];)o=o.getParent();for(a=null;s.length>0;){for(t=s.shift();!t.getParent().equals(o);)t=t.getParent();t.equals(a)||n.push(t),a=t}for(;n.length>0;)if(t=n.shift(),"blockquote"==t.getName()){for(a=new CKEDITOR.dom.documentFragment(e.document);t.getFirst();)a.append(t.getFirst().remove()),s.push(a.getLast());a.replace(t)}else s.push(t);for(n=e.document.createElement("blockquote"),n.insertBefore(s[0]);s.length>0;)t=s.shift(),n.append(t)}else if(t==CKEDITOR.TRISTATE_ON){for(a=[],o={};t=l.getNextParagraph();){for(s=n=null;t.getParent();){if("blockquote"==t.getParent().getName()){n=t.getParent(),s=t;break}t=t.getParent()}n&&s&&!s.getCustomData("blockquote_moveout")&&(a.push(s),CKEDITOR.dom.element.setMarker(o,s,"blockquote_moveout",!0))}for(CKEDITOR.dom.element.clearAllMarkers(o),t=[],s=[],o={};a.length>0;)l=a.shift(),n=l.getParent(),l.getPrevious()?l.getNext()?(l.breakParent(l.getParent()),s.push(l.getNext())):l.remove().insertAfter(n):l.remove().insertBefore(n),n.getCustomData("blockquote_processed")||(s.push(n),CKEDITOR.dom.element.setMarker(o,n,"blockquote_processed",!0)),t.push(l);for(CKEDITOR.dom.element.clearAllMarkers(o),a=s.length-1;a>=0;a--){n=s[a];e:{o=n;for(var l=0,u=o.getChildCount(),c=void 0;l<u&&(c=o.getChild(l));l++)if(c.type==CKEDITOR.NODE_ELEMENT&&c.isBlockBoundary()){o=!1;break e}o=!0}o&&n.remove()}if(e.config.enterMode==CKEDITOR.ENTER_BR)for(n=!0;t.length;)if(l=t.shift(),"div"==l.getName()){for(a=new CKEDITOR.dom.documentFragment(e.document),n&&l.getPrevious()&&!(l.getPrevious().type==CKEDITOR.NODE_ELEMENT&&l.getPrevious().isBlockBoundary())&&a.append(e.document.createElement("br")),n=l.getNext()&&!(l.getNext().type==CKEDITOR.NODE_ELEMENT&&l.getNext().isBlockBoundary());l.getFirst();)l.getFirst().remove().appendTo(a);n&&a.append(e.document.createElement("br")),a.replace(l),n=!1}}i.selectBookmarks(r),e.focus()}},refresh:function(e,t){this.setState(e.elementPath(t.block||t.blockLimit).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{init:function(t){t.blockless||(t.addCommand("blockquote",e),t.ui.addButton&&t.ui.addButton("Blockquote",{label:t.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"}))}})}(),function(){function e(e){function t(){var t=e.editable();t.on(v,function(e){(!CKEDITOR.env.ie||!m)&&d(e)}),CKEDITOR.env.ie&&t.on("paste",function(t){g||(r(),t.data.preventDefault(),d(t),s("paste")||e.openDialog("paste"))}),CKEDITOR.env.ie&&(t.on("contextmenu",o,null,null,0),t.on("beforepaste",function(e){e.data&&!e.data.$.ctrlKey&&!e.data.$.shiftKey&&o()},null,null,0)),t.on("beforecut",function(){!m&&l(e)});var i;t.attachListener(CKEDITOR.env.ie?t:e.document.getDocumentElement(),"mouseup",function(){i=setTimeout(function(){p()},0)}),e.on("destroy",function(){clearTimeout(i)}),t.on("keyup",p)}function i(t){return{type:t,canUndo:"cut"==t,startDisabled:!0,exec:function(){"cut"==this.type&&l();var t,i=this.type;if(CKEDITOR.env.ie)t=s(i);else try{t=e.document.$.execCommand(i,!1,null)}catch(n){t=!1}return t||alert(e.lang.clipboard[this.type+"Error"]),t}}}function n(){return{canUndo:!1,async:!0,exec:function(e,t){var i=function(t,i){t&&a(t.type,t.dataValue,!!i),e.fire("afterCommandExec",{name:"paste",command:n,returnValue:!!t})},n=this;"string"==typeof t?i({type:"auto",dataValue:t},1):e.getClipboardData(i)}}}function r(){g=1,setTimeout(function(){g=0},100)}function o(){m=1,setTimeout(function(){m=0},10)}function s(t){var i=e.document,n=i.getBody(),r=!1,o=function(){r=!0};return n.on(t,o),(CKEDITOR.env.version>7?i.$:i.$.selection.createRange()).execCommand(t),n.removeListener(t,o),r}function a(t,i,n){return t={type:t},!(n&&e.fire("beforePaste",t)===!1||!i)&&(t.dataValue=i,e.fire("paste",t))}function l(){if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var t,i,n,r=e.getSelection();r.getType()==CKEDITOR.SELECTION_ELEMENT&&(t=r.getSelectedElement())&&(i=r.getRanges()[0],n=e.document.createText(""),n.insertBefore(t),i.setStartBefore(n),i.setEndAfter(t),r.selectRanges([i]),setTimeout(function(){t.getParent()&&(n.remove(),r.selectElement(t))},0))}}function u(t,i){var n,r=e.document,o=e.editable(),s=function(e){e.cancel()};if(!r.getById("cke_pastebin")){var a=e.getSelection(),l=a.createBookmarks();CKEDITOR.env.ie&&a.root.fire("selectionchange");var u=new CKEDITOR.dom.element(!CKEDITOR.env.webkit&&!o.is("body")||CKEDITOR.env.ie?"div":"body",r);u.setAttributes({id:"cke_pastebin","data-cke-temp":"1"});var c=0,r=r.getWindow();CKEDITOR.env.webkit?(o.append(u),u.addClass("cke_editable"),o.is("body")||(c="static"!=o.getComputedStyle("position")?o:CKEDITOR.dom.element.get(o.$.offsetParent),c=c.getDocumentPosition().y)):o.getAscendant(CKEDITOR.env.ie?"body":"html",1).append(u),u.setStyles({position:"absolute",top:r.getScrollPosition().y-c+10+"px",width:"1px",height:Math.max(1,r.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0}),CKEDITOR.env.safari&&u.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","text")),(c=u.getParent().isReadOnly())?(u.setOpacity(0),u.setAttribute("contenteditable",!0)):u.setStyle("ltr"==e.config.contentsLangDirection?"left":"right","-1000px"),e.on("selectionChange",s,null,null,0),(CKEDITOR.env.webkit||CKEDITOR.env.gecko)&&(n=o.once("blur",s,null,null,-100)),c&&u.focus(),c=new CKEDITOR.dom.range(u),c.selectNodeContents(u);var h=c.select();CKEDITOR.env.ie&&(n=o.once("blur",function(){e.lockSelection(h)}));var d=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout(function(){CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=d),n&&n.removeListener(),CKEDITOR.env.ie&&o.focus(),a.selectBookmarks(l),u.remove();var t;CKEDITOR.env.webkit&&(t=u.getFirst())&&t.is&&t.hasClass("Apple-style-span")&&(u=t),
e.removeListener("selectionChange",s),i(u.getHtml())},0)}}function c(){if(CKEDITOR.env.ie){e.focus(),r();var t=e.focusManager;if(t.lock(),e.editable().fire(v)&&!s("paste"))return t.unlock(),!1;t.unlock()}else try{if(e.editable().fire(v)&&!e.document.$.execCommand("Paste",!1,null))throw 0}catch(i){return!1}return!0}function h(t){if("wysiwyg"==e.mode)switch(t.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:t=e.editable(),r(),!CKEDITOR.env.ie&&t.fire("beforepaste");break;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:e.fire("saveSnapshot"),setTimeout(function(){e.fire("saveSnapshot")},50)}}function d(t){var i={type:"auto"},n=e.fire("beforePaste",i);u(t,function(e){e=e.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/gi,""),n&&a(i.type,e,0,1)})}function p(){if("wysiwyg"==e.mode){var t=f("paste");e.getCommand("cut").setState(f("cut")),e.getCommand("copy").setState(f("copy")),e.getCommand("paste").setState(t),e.fire("pasteState",t)}}function f(t){if(y&&t in{paste:1,cut:1})return CKEDITOR.TRISTATE_DISABLED;if("paste"==t)return CKEDITOR.TRISTATE_OFF;var t=e.getSelection(),i=t.getRanges();return t.getType()==CKEDITOR.SELECTION_NONE||1==i.length&&i[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}var m=0,g=0,y=0,v=CKEDITOR.env.ie?"beforepaste":"paste";!function(){e.on("key",h),e.on("contentDom",t),e.on("selectionChange",function(e){y=e.data.selection.getRanges()[0].checkReadOnly(),p()}),e.contextMenu&&e.contextMenu.addListener(function(e,t){return y=t.getRanges()[0].checkReadOnly(),{cut:f("cut"),copy:f("copy"),paste:f("paste")}})}(),function(){function t(t,i,n,r,o){var s=e.lang.clipboard[i];e.addCommand(i,n),e.ui.addButton&&e.ui.addButton(t,{label:s,command:i,toolbar:"clipboard,"+r}),e.addMenuItems&&e.addMenuItem(i,{label:s,command:i,group:"clipboard",order:o})}t("Cut","cut",i("cut"),10,1),t("Copy","copy",i("copy"),20,4),t("Paste","paste",n(),30,8)}(),e.getClipboardData=function(t,i){function n(e){e.removeListener(),e.cancel(),i(e.data)}function r(e){e.removeListener(),e.cancel(),l=!0,i({type:a,dataValue:e.data})}function o(){this.customTitle=t&&t.title}var s=!1,a="auto",l=!1;i||(i=t,t=null),e.on("paste",n,null,null,0),e.on("beforePaste",function(e){e.removeListener(),s=!0,a=e.data.type},null,null,1e3),c()===!1&&(e.removeListener("paste",n),s&&e.fire("pasteDialog",o)?(e.on("pasteDialogCommit",r),e.on("dialogHide",function(e){e.removeListener(),e.data.removeListener("pasteDialogCommit",r),setTimeout(function(){l||i(null)},10)})):i(null))}}function t(e){if(CKEDITOR.env.webkit){if(!e.match(/^[^<]*$/g)&&!e.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return"html"}else if(CKEDITOR.env.ie){if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!e.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return"html"}else{if(!CKEDITOR.env.gecko)return"html";if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi))return"html"}return"htmlifiedtext"}function i(e,t){function i(e){return CKEDITOR.tools.repeat("</p><p>",~~(e/2))+(e%2==1?"<br>":"")}return t=t.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>"),t=t.replace(/<\/?[A-Z]+>/g,function(e){return e.toLowerCase()}),t.match(/^[^<]$/)?t:(CKEDITOR.env.webkit&&t.indexOf("<div>")>-1&&(t=t.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>"),t.match(/<div>(<br>|)<\/div>/)&&(t="<p>"+t.replace(/(<div>(<br>|)<\/div>)+/g,function(e){return i(e.split("</div><div>").length+1)})+"</p>"),t=t.replace(/<\/div><div>/g,"<br>"),t=t.replace(/<\/?div>/g,"")),CKEDITOR.env.gecko&&e.enterMode!=CKEDITOR.ENTER_BR&&(CKEDITOR.env.gecko&&(t=t.replace(/^<br><br>$/,"<br>")),t.indexOf("<br><br>")>-1&&(t="<p>"+t.replace(/(<br>){2,}/g,function(e){return i(e.length/4)})+"</p>")),o(e,t))}function n(){var e=new CKEDITOR.htmlParser.filter,t={blockquote:1,dl:1,fieldset:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ol:1,p:1,table:1,ul:1},i=CKEDITOR.tools.extend({br:0},CKEDITOR.dtd.$inline),n={p:1,br:1,"cke:br":1},r=CKEDITOR.dtd,o=CKEDITOR.tools.extend({area:1,basefont:1,embed:1,iframe:1,map:1,object:1,param:1},CKEDITOR.dtd.$nonBodyContent,CKEDITOR.dtd.$cdata),s=function(e){delete e.name,e.add(new CKEDITOR.htmlParser.text(" "))},a=function(e){for(var t,i=e;(i=i.next)&&i.name&&i.name.match(/^h\d$/);)for(t=new CKEDITOR.htmlParser.element("cke:br"),t.isEmpty=!0,e.add(t);t=i.children.shift();)e.add(t)};return e.addRules({elements:{h1:a,h2:a,h3:a,h4:a,h5:a,h6:a,img:function(e){var e=CKEDITOR.tools.trim(e.attributes.alt||""),t=" ";return e&&!e.match(/(^http|\.(jpe?g|gif|png))/i)&&(t=" ["+e+"] "),new CKEDITOR.htmlParser.text(t)},td:s,th:s,$:function(e){var s,a=e.name;if(o[a])return!1;if(e.attributes={},"br"==a)return e;if(t[a])e.name="p";else if(i[a])delete e.name;else if(r[a]){if(s=new CKEDITOR.htmlParser.element("cke:br"),s.isEmpty=!0,CKEDITOR.dtd.$empty[a])return s;e.add(s,0),s=s.clone(),s.isEmpty=!0,e.add(s),delete e.name}return n[e.name]||delete e.name,e}}},{applyToAll:!0}),e}function r(e,t,i){var t=new CKEDITOR.htmlParser.fragment.fromHtml(t),n=new CKEDITOR.htmlParser.basicWriter;t.writeHtml(n,i);var t=n.getHtml(),t=t.replace(/\s*(<\/?[a-z:]+ ?\/?>)\s*/g,"$1").replace(/(<cke:br \/>){2,}/g,"<cke:br />").replace(/(<cke:br \/>)(<\/?p>|<br \/>)/g,"$2").replace(/(<\/?p>|<br \/>)(<cke:br \/>)/g,"$1").replace(/<(cke:)?br( \/)?>/g,"<br>").replace(/<p><\/p>/g,""),r=0,t=t.replace(/<\/?p>/g,function(e){if("<p>"==e){if(++r>1)return"</p><p>"}else if(--r>0)return"</p><p>";return e}).replace(/<p><\/p>/g,"");return o(e,t)}function o(e,t){return e.enterMode==CKEDITOR.ENTER_BR?t=t.replace(/(<\/p><p>)+/g,function(e){return CKEDITOR.tools.repeat("<br>",e.length/7*2)}).replace(/<\/?p>/g,""):e.enterMode==CKEDITOR.ENTER_DIV&&(t=t.replace(/<(\/)?p>/g,"<$1div>")),t}CKEDITOR.plugins.add("clipboard",{requires:"dialog",init:function(o){var s;e(o),CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js")),o.on("paste",function(e){var t=e.data.dataValue,i=CKEDITOR.dtd.$block;if(t.indexOf("Apple-")>-1&&(t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),"html"!=e.data.type&&(t=t.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(e,t){return t.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")})),t.indexOf('<br class="Apple-interchange-newline">')>-1&&(e.data.startsWithEOL=1,e.data.preSniffing="html",t=t.replace(/<br class="Apple-interchange-newline">/,"")),t=t.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1")),t.match(/^<[^<]+cke_(editable|contents)/i)){var n,r,o=new CKEDITOR.dom.element("div");for(o.setHtml(t);1==o.getChildCount()&&(n=o.getFirst())&&n.type==CKEDITOR.NODE_ELEMENT&&(n.hasClass("cke_editable")||n.hasClass("cke_contents"));)o=r=n;r&&(t=r.getHtml().replace(/<br>$/i,""))}CKEDITOR.env.ie?t=t.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,function(t,n){return n.toLowerCase()in i?(e.data.preSniffing="html","<"+n):t}):CKEDITOR.env.webkit?t=t.replace(/<\/(\w+)><div><br><\/div>$/,function(t,n){return n in i?(e.data.endsWithEOL=1,"</"+n+">"):t}):CKEDITOR.env.gecko&&(t=t.replace(/(\s)<br>$/,"$1")),e.data.dataValue=t},null,null,3),o.on("paste",function(e){var a,e=e.data,l=e.type,u=e.dataValue,c=o.config.clipboard_defaultContentType||"html";a="html"==l||"html"==e.preSniffing?"html":t(u),"htmlifiedtext"==a?u=i(o.config,u):"text"==l&&"html"==a&&(u=r(o.config,u,s||(s=n(o)))),e.startsWithEOL&&(u='<br data-cke-eol="1">'+u),e.endsWithEOL&&(u+='<br data-cke-eol="1">'),"auto"==l&&(l="html"==a||"html"==c?"html":"text"),e.type=l,e.dataValue=u,delete e.preSniffing,delete e.startsWithEOL,delete e.endsWithEOL},null,null,6),o.on("paste",function(e){e=e.data,o.insertHtml(e.dataValue,e.type),setTimeout(function(){o.fire("afterPaste")},0)},null,null,1e3),o.on("pasteDialog",function(e){setTimeout(function(){o.openDialog("paste",e.data)},0)})}})}(),function(){CKEDITOR.plugins.add("panel",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL="panel",CKEDITOR.ui.panel=function(e,t){t&&CKEDITOR.tools.extend(this,t),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextId(),this.document=e,this.isFramed=this.forceIFrame||this.css.length,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(e){return new CKEDITOR.ui.panel(e)}};var e=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),t=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),i=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(n,r){this.getHolderElement=function(){var e=this._.holder;if(!e){if(this.isFramed){var e=this.document.getById(this.id+"_frame"),t=e.getParent(),e=e.getFrameDocument();CKEDITOR.env.iOS&&t.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),t=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),e.write(i.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+t+");"},o))),e.getWindow().$.CKEDITOR=CKEDITOR,e.on("keydown",function(e){var t=e.data.getKeystroke(),i=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&this._.onKeyDown(t)===!1?e.data.preventDefault():(27==t||t==("rtl"==i?39:37))&&this.onEscape&&this.onEscape(t)===!1&&e.data.preventDefault()},this),e=e.getBody(),e.unselectable(),CKEDITOR.env.air&&CKEDITOR.tools.callFunction(t)}else e=this.document.getById(this.id);this._.holder=e}return e};var o={editorId:n.id,id:this.id,langCode:n.langCode,dir:n.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":n.config.baseFloatZIndex+1};if(this.isFramed){var s=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";o.frame=t.output({id:this.id+"_frame",src:s})}return s=e.output(o),r&&r.push(s),s},addBlock:function(e,t){return t=this._.blocks[e]=t instanceof CKEDITOR.ui.panel.block?t:new CKEDITOR.ui.panel.block(this.getHolderElement(),t),this._.currentBlock||this.showBlock(e),t},getBlock:function(e){return this._.blocks[e]},showBlock:function(e){var e=this._.blocks[e],t=this._.currentBlock,i=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");return t&&t.hide(),this._.currentBlock=e,CKEDITOR.fire("ariaWidget",i),e._.focusIndex=-1,this._.onKeyDown=e.onKeyDown&&CKEDITOR.tools.bind(e.onKeyDown,e),e.show(),e},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(e,t){this.element=e.append(e.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}})),t&&CKEDITOR.tools.extend(this,t),this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]}),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{markItem:function(e){e!=-1&&(e=this.element.getElementsByTag("a").getItem(this._.focusIndex=e),CKEDITOR.env.webkit&&e.getDocument().getWindow().focus(),e.focus(),this.onMark&&this.onMark(e))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||this.onHide.call(this)!==!0)&&this.element.setStyle("display","none")},onKeyDown:function(e,t){var i=this.keys[e];switch(i){case"next":for(var n,r=this._.focusIndex,i=this.element.getElementsByTag("a");n=i.getItem(++r);)if(n.getAttribute("_cke_focus")&&n.$.offsetWidth){this._.focusIndex=r,n.focus();break}return!n&&!t&&(this._.focusIndex=-1,this.onKeyDown(e,1));case"prev":for(r=this._.focusIndex,i=this.element.getElementsByTag("a");r>0&&(n=i.getItem(--r));){if(n.getAttribute("_cke_focus")&&n.$.offsetWidth){this._.focusIndex=r,n.focus();break}n=null}return!n&&!t&&(this._.focusIndex=i.count(),this.onKeyDown(e,1));case"click":case"mouseup":return r=this._.focusIndex,(n=r>=0&&this.element.getElementsByTag("a").getItem(r))&&(n.$[i]?n.$[i]():n.$["on"+i]()),!1}return!0}}})}(),CKEDITOR.plugins.add("floatpanel",{requires:"panel"}),function(){function e(e,i,n,r,o){var o=CKEDITOR.tools.genKey(i.getUniqueId(),n.getUniqueId(),e.lang.dir,e.uiColor||"",r.css||"",o||""),s=t[o];return s||(s=t[o]=new CKEDITOR.ui.panel(i,r),s.element=n.append(CKEDITOR.dom.element.createFromHtml(s.render(e),i)),s.element.setStyles({display:"none",position:"absolute"})),s}var t={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(t,i,n,r){function o(){u.hide()}n.forceIFrame=1,n.toolbarRelated&&t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(i=CKEDITOR.document.getById("cke_"+t.name));var s=i.getDocument(),r=e(t,s,i,n,r||0),a=r.element,l=a.getFirst(),u=this;a.disableContextMenu(),this.element=a,this._={editor:t,panel:r,parentElement:i,definition:n,document:s,iframe:l,children:[],dir:t.lang.dir},t.on("mode",o),t.on("resize",o),CKEDITOR.env.iOS||s.getWindow().on("resize",o)},proto:{addBlock:function(e,t){return this._.panel.addBlock(e,t)},addListBlock:function(e,t){return this._.panel.addListBlock(e,t)},getBlock:function(e){return this._.panel.getBlock(e)},showBlock:function(e,t,i,n,r,o){var s=this._.panel,a=s.showBlock(e);this.allowBlur(!1),e=this._.editor.editable(),this._.returnFocus=e.hasFocus?e:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement),this._.hideTimeout=0;var l=this.element,e=this._.iframe,e=CKEDITOR.env.ie?e:new CKEDITOR.dom.window(e.$.contentWindow),u=l.getDocument(),c=this._.parentElement.getPositionedAncestor(),h=t.getDocumentPosition(u),u=c?c.getDocumentPosition(u):{x:0,y:0},d="rtl"==this._.dir,p=h.x+(n||0)-u.x,f=h.y+(r||0)-u.y;!d||1!=i&&4!=i?d||2!=i&&3!=i||(p+=t.$.offsetWidth-1):p+=t.$.offsetWidth,3!=i&&4!=i||(f+=t.$.offsetHeight-1),this._.panel._.offsetParentId=t.getId(),l.setStyles({top:f+"px",left:0,display:""}),l.setOpacity(0),l.getFirst().removeStyle("width"),this._.editor.focusManager.add(e),this._.blurSet||(CKEDITOR.event.useCapture=!0,e.on("blur",function(e){function t(){delete this._.returnFocus,this.hide()}this.allowBlur()&&e.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&this.visible&&!this._.activeChild&&(CKEDITOR.env.iOS?this._.hideTimeout||(this._.hideTimeout=CKEDITOR.tools.setTimeout(t,0,this)):t.call(this))},this),e.on("focus",function(){this._.focused=!0,this.hideChild(),this.allowBlur(!0)},this),CKEDITOR.env.iOS&&(e.on("touchstart",function(){clearTimeout(this._.hideTimeout)},this),e.on("touchend",function(){this._.hideTimeout=0,this.focus()},this)),CKEDITOR.event.useCapture=!1,this._.blurSet=1),s.onEscape=CKEDITOR.tools.bind(function(e){if(this.onEscape&&this.onEscape(e)===!1)return!1},this),CKEDITOR.tools.setTimeout(function(){var e=CKEDITOR.tools.bind(function(){if(l.removeStyle("width"),a.autoSize){var e=a.element.getDocument(),e=(CKEDITOR.env.webkit?a.element:e.getBody()).$.scrollWidth;CKEDITOR.env.ie&&CKEDITOR.env.quirks&&e>0&&(e+=(l.$.offsetWidth||0)-(l.$.clientWidth||0)+3),l.setStyle("width",e+10+"px"),e=a.element.$.scrollHeight,CKEDITOR.env.ie&&CKEDITOR.env.quirks&&e>0&&(e+=(l.$.offsetHeight||0)-(l.$.clientHeight||0)+3),l.setStyle("height",e+"px"),s._.currentBlock.element.setStyle("display","none").removeStyle("display")}else l.removeStyle("height");d&&(p-=l.$.offsetWidth),l.setStyle("left",p+"px");var t=s.element.getWindow(),e=l.$.getBoundingClientRect(),t=t.getViewPaneSize(),i=e.width||e.right-e.left,n=e.height||e.bottom-e.top,r=d?e.right:t.width-e.left,u=d?t.width-e.right:e.left;d?r<i&&(p=u>i?p+i:t.width>i?p-e.left:p-e.right+t.width):r<i&&(p=u>i?p-i:t.width>i?p-e.right+t.width:p-e.left),i=e.top,t.height-e.top<n&&(f=i>n?f-n:t.height>n?f-e.bottom+t.height:f-e.top),CKEDITOR.env.ie&&(t=e=new CKEDITOR.dom.element(l.$.offsetParent),"html"==t.getName()&&(t=t.getDocument().getBody()),"rtl"==t.getComputedStyle("direction")&&(p=CKEDITOR.env.ie8Compat?p-2*l.getDocument().getDocumentElement().$.scrollLeft:p-(e.$.scrollWidth-e.$.clientWidth)));var c,e=l.getFirst();(c=e.getCustomData("activePanel"))&&c.onHide&&c.onHide.call(this,1),e.setCustomData("activePanel",this),l.setStyles({top:f+"px",left:p+"px"}),l.setOpacity(1),o&&o()},this);s.isLoaded?e():s.onLoad=e,CKEDITOR.tools.setTimeout(function(){var e=CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus(),a.element.focus(),CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=e),this.allowBlur(!0),this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this),this.visible=1,this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var e=CKEDITOR.document.getActive();e&&!e.equals(this._.iframe)&&e.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},blur:function(){var e=this._.iframe.getFrameDocument().getActive();e&&e.is("a")&&(this._.lastFocused=e)},hide:function(e){!this.visible||this.onHide&&this.onHide.call(this)===!0||(this.hideChild(),CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur(),this.element.setStyle("display","none"),this.visible=0,this.element.getFirst().removeCustomData("activePanel"),(e=e&&this._.returnFocus)&&(CKEDITOR.env.webkit&&e.type&&e.getWindow().$.focus(),e.focus()),delete this._.lastFocused,this._.editor.fire("panelHide",this))},allowBlur:function(e){var t=this._.panel;return void 0!==e&&(t.allowBlur=e),t.allowBlur},showAsChild:function(e,t,i,n,r,o){this._.activeChild==e&&e._.panel._.offsetParentId==i.getId()||(this.hideChild(),e.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=e,this._.focused=!1,e.showBlock(t,i,n,r,o),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){e.element.getChild(0).$.style.cssText+=""},100))},hideChild:function(e){var t=this._.activeChild;t&&(delete t.onHide,delete this._.activeChild,t.hide(),e&&this.focus())}}}),CKEDITOR.on("instanceDestroyed",function(){var e,i=CKEDITOR.tools.isEmpty(CKEDITOR.instances);for(e in t){var n=t[e];i?n.destroy():n.element.hide()}i&&(t={})})}(),CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(e){for(var t=e.config.menu_groups.split(","),i=e._.menuGroups={},n=e._.menuItems={},r=0;r<t.length;r++)i[t[r]]=r+1;e.addMenuGroup=function(e,t){i[e]=t||100},e.addMenuItem=function(e,t){i[t.group]&&(n[e]=new CKEDITOR.menuItem(this,e,t))},e.addMenuItems=function(e){for(var t in e)this.addMenuItem(t,e[t])},e.getMenuItem=function(e){return n[e]},e.removeMenuItem=function(e){delete n[e]}}}),function(){function e(e){e.sort(function(e,t){return e.group<t.group?-1:e.group>t.group?1:e.order<t.order?-1:e.order>t.order?1:0})}var t='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(t+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(t+=' onblur="this.style.cssText = this.style.cssText;"');var t=t+(' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">'),i=CKEDITOR.addTemplate("menuItem",t+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),n=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(e,t){t=this._.definition=t||{},this.id=CKEDITOR.tools.getNextId(),this.editor=e,this.items=[],this._.listeners=[],this._.level=t.level||1;var i=CKEDITOR.tools.extend({},t.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),n=i.block.attributes=i.attributes||{};!n.role&&(n.role="menu"),this._.panelDefinition=i},_:{onShow:function(){var e=this.editor.getSelection(),t=e&&e.getStartElement(),i=this.editor.elementPath(),n=this._.listeners;this.removeAll();for(var r=0;r<n.length;r++){var o=n[r](t,e,i);if(o)for(var s in o){var a=this.editor.getMenuItem(s);!a||a.command&&!this.editor.getCommand(a.command).state||(a.state=o[s],this.add(a))}}},onClick:function(e){this.hide(),e.onClick?e.onClick():e.command&&this.editor.execCommand(e.command)},onEscape:function(e){var t=this.parent;return t?t._.panel.hideChild(1):27==e&&this.hide(1),!1},onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(e){var t=this._.subMenu,i=this.items[e];if(i=i.getItems&&i.getItems()){t?t.removeAll():(t=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),t.parent=this,t._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var n in i){var r=this.editor.getMenuItem(n);r&&(r.state=i[n],t.add(r))}var o=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+(""+e));setTimeout(function(){t.show(o,2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(e){e.order||(e.order=this.items.length),this.items.push(e)},removeAll:function(){this.items=[]},show:function(t,i,n,r){if(this.parent||(this._.onShow(),this.items.length)){var i=i||("rtl"==this.editor.lang.dir?2:1),o=this.items,s=this.editor,a=this._.panel,l=this._.element;if(!a){a=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level),a.onEscape=CKEDITOR.tools.bind(function(e){if(this._.onEscape(e)===!1)return!1},this),a.onShow=function(){a._.panel.getHolderElement().getParent().addClass("cke cke_reset_all")},a.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this),l=a.addBlock(this.id,this._.panelDefinition.block),l.autoSize=!0;var u=l.keys;u[40]="next",u[9]="next",u[38]="prev",u[CKEDITOR.SHIFT+9]="prev",u["rtl"==s.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click",u[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(u[13]="mouseup"),l=this._.element=l.element,u=l.getDocument(),u.getBody().setStyle("overflow","hidden"),u.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(e){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,s.config.menu_subMenuDelay||400,this,[e])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(e){var t=this.items[e];t.state==CKEDITOR.TRISTATE_DISABLED?this.hide(1):t.getItems?this._.showSubMenu(e):this._.onClick(t)},this)}e(o);for(var u=s.elementPath(),u=['<div class="cke_menu'+(u&&u.direction()!=s.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],c=o.length,h=c&&o[0].group,d=0;d<c;d++){var p=o[d];h!=p.group&&(u.push('<div class="cke_menuseparator" role="separator"></div>'),h=p.group),p.render(this,d,u)}u.push("</div>"),l.setHtml(u.join("")),CKEDITOR.ui.fire("ready",this),this.parent?this.parent._.panel.showAsChild(a,this.id,t,i,n,r):a.showBlock(this.id,t,i,n,r),s.fire("menuShow",[a])}},addListener:function(e){this._.listeners.push(e)},hide:function(e){this._.onHide&&this._.onHide(),this._.panel&&this._.panel.hide(e)}}}),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(e,t,i){CKEDITOR.tools.extend(this,i,{order:0,className:"cke_menubutton__"+t}),this.group=e._.menuGroups[this.group],this.editor=e,this.name=t},proto:{render:function(e,t,r){var o=e.id+(""+t),s="undefined"==typeof this.state?CKEDITOR.TRISTATE_OFF:this.state,a="",l=s==CKEDITOR.TRISTATE_ON?"on":s==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(a=' aria-checked="'+(s==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var u=this.getItems,c="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",h=this.name;this.icon&&!/\./.test(this.icon)&&(h=this.icon),e={id:o,name:this.name,iconName:h,label:this.label,cls:this.className||"",state:l,hasPopup:u?"true":"false",disabled:s==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:e._.itemOverFn,moveOutFn:e._.itemOutFn,clickFn:e._.itemClickFn,index:t,iconStyle:CKEDITOR.skin.getIconStyle(h,"rtl"==this.editor.lang.dir,h==this.icon?null:this.icon,this.iconOffset),arrowHtml:u?n.output({label:c}):"",role:this.role?this.role:"menuitem",ariaChecked:a},i.output(e,r)}}})}(),CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div",CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(e){this.base.call(this,e,{panel:{className:"cke_menu_panel",attributes:{"aria-label":e.lang.contextmenu.options}}})},proto:{addTarget:function(e,t){if(e.on("contextmenu",function(e){var e=e.data,n=CKEDITOR.env.webkit?i:CKEDITOR.env.mac?e.$.metaKey:e.$.ctrlKey;if(!t||!n){if(e.preventDefault(),CKEDITOR.env.mac&&CKEDITOR.env.webkit){var n=this.editor,r=new CKEDITOR.dom.elementPath(e.getTarget(),n.editable()).contains(function(e){return e.hasAttribute("contenteditable")},!0);r&&"false"==r.getAttribute("contenteditable")&&n.getSelection().fake(r)}var r=e.getTarget().getDocument(),o=e.getTarget().getDocument().getDocumentElement(),n=!r.equals(CKEDITOR.document),r=r.getWindow().getScrollPosition(),s=n?e.$.clientX:e.$.pageX||r.x+e.$.clientX,a=n?e.$.clientY:e.$.pageY||r.y+e.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(o,null,s,a)},CKEDITOR.env.ie?200:0,this)}},this),CKEDITOR.env.webkit){var i,n=function(){i=0};e.on("keydown",function(e){i=CKEDITOR.env.mac?e.data.$.metaKey:e.data.$.ctrlKey}),e.on("keyup",n),e.on("contextmenu",n)}},open:function(e,t,i,n){this.editor.focus(),e=e||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(e,t,i,n)}}})},beforeInit:function(e){var t=e.contextMenu=new CKEDITOR.plugins.contextMenu(e);e.on("contentDom",function(){t.addTarget(e.editable(),e.config.browserContextMenuOnCtrl!==!1)}),e.addCommand("contextMenu",{exec:function(){e.contextMenu.open(e.document.getBody())}}),e.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),e.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}}),function(){function e(e,n){function o(t){if(t=u.list[t],t.equals(e.editable())||"true"==t.getAttribute("contenteditable")){var i=e.createRange();i.selectNodeContents(t),i.select()}else e.getSelection().selectElement(t);e.focus()}function s(){a&&a.setHtml(i),delete u.list}var a,l=e.ui.spaceId("path"),u=e._.elementsPath,c=u.idBase;n.html=n.html+('<span id="'+l+'_label" class="cke_voice_label">'+e.lang.elementspath.eleLabel+'</span><span id="'+l+'" class="cke_path" role="group" aria-labelledby="'+l+'_label">'+i+"</span>"),e.on("uiReady",function(){var t=e.ui.space("path");t&&e.focusManager.add(t,1)}),u.onClick=o;var h=CKEDITOR.tools.addFunction(o),d=CKEDITOR.tools.addFunction(function(t,i){var n,r=u.idBase,i=new CKEDITOR.dom.event(i);switch(n="rtl"==e.lang.dir,i.getKeystroke()){case n?39:37:case 9:return(n=CKEDITOR.document.getById(r+(t+1)))||(n=CKEDITOR.document.getById(r+"0")),n.focus(),!1;case n?37:39:case CKEDITOR.SHIFT+9:return(n=CKEDITOR.document.getById(r+(t-1)))||(n=CKEDITOR.document.getById(r+(u.list.length-1))),n.focus(),!1;case 27:return e.focus(),!1;case 13:case 32:return o(t),!1}return!0});e.on("selectionChange",function(){for(var t,n=[],o=u.list=[],s=[],p=u.filters,f=!0,m=e.elementPath().elements,g=m.length;g--;){var y=m[g],v=0;t=y.data("cke-display-name")?y.data("cke-display-name"):y.data("cke-real-element-type")?y.data("cke-real-element-type"):y.getName(),f=y.hasAttribute("contenteditable")?"true"==y.getAttribute("contenteditable"):f,!f&&!y.hasAttribute("contenteditable")&&(v=1);for(var E=0;E<p.length;E++){var T=p[E](y,t);if(T===!1){v=1;break}t=T||t}v||(o.unshift(y),s.unshift(t))}for(o=o.length,p=0;p<o;p++)t=s[p],f=e.lang.elementspath.eleTitle.replace(/%1/,t),t=r.output({id:c+p,label:f,text:t,jsTitle:"javascript:void('"+t+"')",index:p,keyDownFn:d,clickFn:h}),n.unshift(t);a||(a=CKEDITOR.document.getById(l)),s=a,s.setHtml(n.join("")+i),e.fire("elementsPathUpdate",{space:s})}),e.on("readOnly",s),e.on("contentDomUnload",s),e.addCommand("elementsPathFocus",t),e.setKeystroke(CKEDITOR.ALT+122,"elementsPathFocus")}var t;t={editorFocus:!1,readOnly:1,exec:function(e){(e=CKEDITOR.document.getById(e._.elementsPath.idBase+"0"))&&e.focus(CKEDITOR.env.ie||CKEDITOR.env.air)}};var i='<span class="cke_path_empty">&nbsp;</span>',n="";CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(n+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(n+=' onblur="this.style.cssText = this.style.cssText;"');var r=CKEDITOR.addTemplate("pathItem",'<a id="{id}" href="{jsTitle}" tabindex="-1" class="cke_path_item" title="{label}"'+n+' hidefocus="true"  onkeydown="return CKEDITOR.tools.callFunction({keyDownFn},{index}, event );" onclick="CKEDITOR.tools.callFunction({clickFn},{index}); return false;" role="button" aria-label="{label}">{text}</a>');CKEDITOR.plugins.add("elementspath",{init:function(t){t._.elementsPath={idBase:"cke_elementspath_"+CKEDITOR.tools.getNextNumber()+"_",filters:[]},t.on("uiSpace",function(i){"bottom"==i.data.space&&e(t,i.data)})}})}(),function(){function e(e,n){var r,o;n.on("refresh",function(e){var n,r=[t];for(n in e.data.states)r.push(e.data.states[n]);this.setState(CKEDITOR.tools.search(r,i)?i:t)},n,null,100),n.on("exec",function(t){r=e.getSelection(),o=r.createBookmarks(1),t.data||(t.data={}),t.data.done=!1},n,null,0),n.on("exec",function(){e.forceNextSelectionCheck(),r.selectBookmarks(o)},n,null,100)}var t=CKEDITOR.TRISTATE_DISABLED,i=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(t){var i=CKEDITOR.plugins.indent.genericDefinition;e(t,t.addCommand("indent",new i((!0)))),e(t,t.addCommand("outdent",new i)),t.ui.addButton&&(t.ui.addButton("Indent",{label:t.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),t.ui.addButton("Outdent",{label:t.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"})),t.on("dirChanged",function(e){var i=t.createRange(),n=e.data.node;i.setStartBefore(n),i.setEndAfter(n);for(var r,o=new CKEDITOR.dom.walker(i);r=o.next();)if(r.type==CKEDITOR.NODE_ELEMENT)if(!r.equals(n)&&r.getDirection())i.setStartAfter(r),o=new CKEDITOR.dom.walker(i);else{var s=t.config.indentClasses;if(s)for(var a="ltr"==e.data.dir?["_rtl",""]:["","_rtl"],l=0;l<s.length;l++)r.hasClass(s[l]+a[0])&&(r.removeClass(s[l]+a[0]),r.addClass(s[l]+a[1]));s=r.getStyle("margin-right"),a=r.getStyle("margin-left"),s?r.setStyle("margin-left",s):r.removeStyle("margin-left"),a?r.setStyle("margin-right",a):r.removeStyle("margin-right")}})}}),CKEDITOR.plugins.indent={genericDefinition:function(e){this.isIndent=!!e,this.startDisabled=!this.isIndent},specificDefinition:function(e,t,i){this.name=t,this.editor=e,this.jobs={},this.enterBr=e.config.enterMode==CKEDITOR.ENTER_BR,this.isIndent=!!i,this.relatedGlobal=i?"indent":"outdent",this.indentKey=i?9:CKEDITOR.SHIFT+9,this.database={}},registerCommands:function(e,t){e.on("pluginsLoaded",function(){for(var e in t)(function(e,t){var i,n=e.getCommand(t.relatedGlobal);for(i in t.jobs)n.on("exec",function(n){n.data.done||(e.fire("lockSnapshot"),t.execJob(e,i)&&(n.data.done=!0),e.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(t.database))},this,null,i),
n.on("refresh",function(n){n.data.states||(n.data.states={}),n.data.states[t.name+"@"+i]=t.refreshJob(e,i,n.data.path)},this,null,i);e.addFeature(t)})(this,t[e])})}},CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}},CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(e,i){var n=this.jobs[i];if(n.state!=t)return n.exec.call(this,e)},refreshJob:function(e,i,n){return i=this.jobs[i],i.state=e.activeFilter.checkFeature(this)?i.refresh.call(this,e,n):t,i.state},getContext:function(e){return e.contains(this.context)}}}(),function(){function e(e){function n(t){for(var n=r.startContainer,l=r.endContainer;n&&!n.getParent().equals(t);)n=n.getParent();for(;l&&!l.getParent().equals(t);)l=l.getParent();if(!n||!l)return!1;for(var u=n,n=[],c=!1;!c;)u.equals(l)&&(c=!0),n.push(u),u=u.getNext();if(n.length<1)return!1;for(u=t.getParents(!0),l=0;l<u.length;l++)if(u[l].getName&&a[u[l].getName()]){t=u[l];break}for(var u=o.isIndent?1:-1,l=n[0],n=n[n.length-1],c=CKEDITOR.plugins.list.listToArray(t,s),h=c[n.getCustomData("listarray_index")].indent,l=l.getCustomData("listarray_index");l<=n.getCustomData("listarray_index");l++)if(c[l].indent=c[l].indent+u,u>0){var d=c[l].parent;c[l].parent=new CKEDITOR.dom.element(d.getName(),d.getDocument())}for(l=n.getCustomData("listarray_index")+1;l<c.length&&c[l].indent>h;l++)c[l].indent=c[l].indent+u;if(n=CKEDITOR.plugins.list.arrayToList(c,s,null,e.config.enterMode,t.getDirection()),!o.isIndent){var p;if((p=t.getParent())&&p.is("li"))for(var f,u=n.listNode.getChildren(),m=[],l=u.count()-1;l>=0;l--)(f=u.getItem(l))&&f.is&&f.is("li")&&m.push(f)}if(n&&n.listNode.replace(t),m&&m.length)for(l=0;l<m.length;l++){for(f=t=m[l];(f=f.getNext())&&f.is&&f.getName()in a;)CKEDITOR.env.needsNbspFiller&&!t.getFirst(i)&&t.append(r.document.createText(" ")),t.append(f);t.insertAfter(p)}return n&&e.fire("contentDomInvalidated"),!0}for(var r,o=this,s=this.database,a=this.context,l=e.getSelection(),l=(l&&l.getRanges()).createIterator();r=l.getNextRange();){for(var u=r.getCommonAncestor();u&&(u.type!=CKEDITOR.NODE_ELEMENT||!a[u.getName()]);){if(e.editable().equals(u)){u=!1;break}u=u.getParent()}if(u||(u=r.startPath().contains(a))&&r.setEndAt(u,CKEDITOR.POSITION_BEFORE_END),!u){var c=r.getEnclosedNode();c&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in a&&(r.setStartAt(c,CKEDITOR.POSITION_AFTER_START),r.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),u=c)}if(u&&r.startContainer.type==CKEDITOR.NODE_ELEMENT&&r.startContainer.getName()in a&&(c=new CKEDITOR.dom.walker(r),c.evaluator=t,r.startContainer=c.next()),u&&r.endContainer.type==CKEDITOR.NODE_ELEMENT&&r.endContainer.getName()in a&&(c=new CKEDITOR.dom.walker(r),c.evaluator=t,r.endContainer=c.previous()),u)return n(u)}return 0}function t(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("li")}function i(e){return n(e)&&r(e)}var n=CKEDITOR.dom.walker.whitespaces(!0),r=CKEDITOR.dom.walker.bookmark(!1,!0),o=CKEDITOR.TRISTATE_DISABLED,s=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(t){function i(t){n.specificDefinition.apply(this,arguments),this.requiredContent=["ul","ol"],t.on("key",function(e){if("wysiwyg"==t.mode&&e.data.keyCode==this.indentKey){var i=this.getContext(t.elementPath());!i||this.isIndent&&CKEDITOR.plugins.indentList.firstItemInPath(this.context,t.elementPath(),i)||(t.execCommand(this.relatedGlobal),e.cancel())}},this),this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(e,t){var i=this.getContext(t),n=CKEDITOR.plugins.indentList.firstItemInPath(this.context,t,i);return i&&this.isIndent&&!n?s:o}:function(e,t){return!this.getContext(t)||this.isIndent?o:s},exec:CKEDITOR.tools.bind(e,this)}}var n=CKEDITOR.plugins.indent;n.registerCommands(t,{indentlist:new i(t,"indentlist",(!0)),outdentlist:new i(t,"outdentlist")}),CKEDITOR.tools.extend(i.prototype,n.specificDefinition.prototype,{context:{ol:1,ul:1}})}}),CKEDITOR.plugins.indentList={},CKEDITOR.plugins.indentList.firstItemInPath=function(e,i,n){var r=i.contains(t);return n||(n=i.contains(e)),n&&r&&r.equals(n.getFirst(t))}}(),function(){function e(e,t,i){function n(i){!(l=c[i?"getFirst":"getLast"]())||l.is&&l.isBlockBoundary()||!(u=t.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))||u.is&&u.isBlockBoundary({br:1})||e.document.createElement("br")[i?"insertBefore":"insertAfter"](l)}for(var r=CKEDITOR.plugins.list.listToArray(t.root,i),o=[],s=0;s<t.contents.length;s++){var a=t.contents[s];(a=a.getAscendant("li",!0))&&!a.getCustomData("list_item_processed")&&(o.push(a),CKEDITOR.dom.element.setMarker(i,a,"list_item_processed",!0))}for(a=null,s=0;s<o.length;s++)a=o[s].getCustomData("listarray_index"),r[a].indent=-1;for(s=a+1;s<r.length;s++)if(r[s].indent>r[s-1].indent+1){for(o=r[s-1].indent+1-r[s].indent,a=r[s].indent;r[s]&&r[s].indent>=a;)r[s].indent=r[s].indent+o,s++;s--}var l,u,c=CKEDITOR.plugins.list.arrayToList(r,i,null,e.config.enterMode,t.root.getAttribute("dir")).listNode;n(!0),n(),c.replace(t.root),e.fire("contentDomInvalidated")}function t(e,t){this.name=e,this.context=this.type=t,this.allowedContent=t+" li",this.requiredContent=t}function i(e,t,i,n){for(var r,o;r=e[n?"getLast":"getFirst"](p);)(o=r.getDirection(1))!==t.getDirection(1)&&r.setAttribute("dir",o),r.remove(),i?r[n?"insertBefore":"insertAfter"](i):t.append(r,n)}function n(e){function t(t){var n=e[t?"getPrevious":"getNext"](c);n&&n.type==CKEDITOR.NODE_ELEMENT&&n.is(e.getName())&&(i(e,n,null,!t),e.remove(),e=n)}t(),t(1)}function r(e){return e.type==CKEDITOR.NODE_ELEMENT&&(e.getName()in CKEDITOR.dtd.$block||e.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[e.getName()]["#"]}function o(e,t,r){e.fire("saveSnapshot"),r.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var o=r.extractContents();t.trim(!1,!0);var a=t.createBookmark(),l=new CKEDITOR.dom.elementPath(t.startContainer),u=l.block,l=l.lastElement.getAscendant("li",1)||u,d=new CKEDITOR.dom.elementPath(r.startContainer),p=d.contains(CKEDITOR.dtd.$listItem),d=d.contains(CKEDITOR.dtd.$list);for(u?(u=u.getBogus())&&u.remove():d&&(u=d.getPrevious(c))&&h(u)&&u.remove(),(u=o.getLast())&&u.type==CKEDITOR.NODE_ELEMENT&&u.is("br")&&u.remove(),(u=t.startContainer.getChild(t.startOffset))?o.insertBefore(u):t.startContainer.append(o),p&&(o=s(p))&&(l.contains(p)?(i(o,p.getParent(),p),o.remove()):l.append(o));r.checkStartOfBlock()&&r.checkEndOfBlock()&&(d=r.startPath(),o=d.block,o);)o.is("li")&&(l=o.getParent(),o.equals(l.getLast(c))&&o.equals(l.getFirst(c))&&(o=l)),r.moveToPosition(o,CKEDITOR.POSITION_BEFORE_START),o.remove();r=r.clone(),o=e.editable(),r.setEndAt(o,CKEDITOR.POSITION_BEFORE_END),r=new CKEDITOR.dom.walker(r),r.evaluator=function(e){return c(e)&&!h(e)},(r=r.next())&&r.type==CKEDITOR.NODE_ELEMENT&&r.getName()in CKEDITOR.dtd.$list&&n(r),t.moveToBookmark(a),t.select(),e.fire("saveSnapshot")}function s(e){return(e=e.getLast(c))&&e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in a?e:null}var a={ol:1,ul:1},l=CKEDITOR.dom.walker.whitespaces(),u=CKEDITOR.dom.walker.bookmark(),c=function(e){return!(l(e)||u(e))},h=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(e,t,i,n,r){if(!a[e.getName()])return[];n||(n=0),i||(i=[]);for(var o=0,s=e.getChildCount();o<s;o++){var l=e.getChild(o);if(l.type==CKEDITOR.NODE_ELEMENT&&l.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(l,t,i,n+1),"li"==l.$.nodeName.toLowerCase()){var u={parent:e,indent:n,element:l,contents:[]};r?u.grandparent=r:(u.grandparent=e.getParent(),u.grandparent&&"li"==u.grandparent.$.nodeName.toLowerCase()&&(u.grandparent=u.grandparent.getParent())),t&&CKEDITOR.dom.element.setMarker(t,l,"listarray_index",i.length),i.push(u);for(var c,h=0,d=l.getChildCount();h<d;h++)c=l.getChild(h),c.type==CKEDITOR.NODE_ELEMENT&&a[c.getName()]?CKEDITOR.plugins.list.listToArray(c,t,i,n+1,u.grandparent):u.contents.push(c)}}return i},arrayToList:function(e,t,i,n,r){if(i||(i=0),!e||e.length<i+1)return null;for(var o,s,l,h=e[i].parent.getDocument(),d=new CKEDITOR.dom.documentFragment(h),p=null,f=i,m=Math.max(e[i].indent,0),g=null,y=n==CKEDITOR.ENTER_P?"p":"div";;){var v=e[f];if(o=v.grandparent,s=v.element.getDirection(1),v.indent==m){for(p&&e[f].parent.getName()==p.getName()||(p=e[f].parent.clone(!1,1),r&&p.setAttribute("dir",r),d.append(p)),g=p.append(v.element.clone(0,1)),s!=p.getDirection(1)&&g.setAttribute("dir",s),o=0;o<v.contents.length;o++)g.append(v.contents[o].clone(1,1));f++}else if(v.indent==Math.max(m,0)+1)v=e[f-1].element.getDirection(1),f=CKEDITOR.plugins.list.arrayToList(e,null,f,n,v!=s?s:null),!g.getChildCount()&&CKEDITOR.env.needsNbspFiller&&h.$.documentMode<=7&&g.append(h.createText(" ")),g.append(f.listNode),f=f.nextIndex;else{if(v.indent!=-1||i||!o)return null;a[o.getName()]?(g=v.element.clone(!1,!0),s!=o.getDirection(1)&&g.setAttribute("dir",s)):g=new CKEDITOR.dom.documentFragment(h);var E,T,p=o.getDirection(1)!=s,b=v.element,C=b.getAttribute("class"),O=b.getAttribute("style"),x=g.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(n!=CKEDITOR.ENTER_BR||p||O||C),w=v.contents.length;for(o=0;o<w;o++)if(E=v.contents[o],u(E)&&w>1)x?T=E.clone(1,1):g.append(E.clone(1,1));else if(E.type==CKEDITOR.NODE_ELEMENT&&E.isBlockBoundary()){p&&!E.getDirection()&&E.setAttribute("dir",s),l=E;var R=b.getAttribute("style");R&&l.setAttribute("style",R.replace(/([^;])$/,"$1;")+(l.getAttribute("style")||"")),C&&E.addClass(C),l=null,T&&(g.append(T),T=null),g.append(E.clone(1,1))}else x?(l||(l=h.createElement(y),g.append(l),p&&l.setAttribute("dir",s)),O&&l.setAttribute("style",O),C&&l.setAttribute("class",C),T&&(l.append(T),T=null),l.append(E.clone(1,1))):g.append(E.clone(1,1));T&&((l||g).append(T),T=null),g.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&f!=e.length-1&&(CKEDITOR.env.needsBrFiller&&(s=g.getLast())&&s.type==CKEDITOR.NODE_ELEMENT&&s.is("br")&&s.remove(),s=g.getLast(c),(!s||!(s.type==CKEDITOR.NODE_ELEMENT&&s.is(CKEDITOR.dtd.$block)))&&g.append(h.createElement("br"))),s=g.$.nodeName.toLowerCase(),("div"==s||"p"==s)&&g.appendBogus(),d.append(g),p=null,f++}if(l=null,e.length<=f||Math.max(e[f].indent,0)<m)break}if(t)for(e=d.getFirst();e;){if(e.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(t,e),e.getName()in CKEDITOR.dtd.$listItem&&(i=e,h=r=n=void 0,n=i.getDirection()))){for(r=i.getParent();r&&!(h=r.getDirection());)r=r.getParent();n==h&&i.removeAttribute("dir")}e=e.getNextSourceNode()}return{listNode:d,nextIndex:f}}};var d=/^h[1-6]$/,p=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);t.prototype={exec:function(t){this.refresh(t,t.elementPath());var i=t.config,r=t.getSelection(),o=r&&r.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var s=t.editable();if(s.getFirst(c)){var l=1==o.length&&o[0];(i=l&&l.getEnclosedNode())&&i.is&&this.type==i.getName()&&this.setState(CKEDITOR.TRISTATE_ON)}else i.enterMode==CKEDITOR.ENTER_BR?s.appendBogus():o[0].fixBlock(1,i.enterMode==CKEDITOR.ENTER_P?"p":"div"),r.selectRanges(o)}for(var i=r.createBookmarks(!0),s=[],u={},o=o.createIterator(),h=0;(l=o.getNextRange())&&++h;){var p=l.getBoundaryNodes(),f=p.startNode,m=p.endNode;for(f.type==CKEDITOR.NODE_ELEMENT&&"td"==f.getName()&&l.setStartAt(p.startNode,CKEDITOR.POSITION_AFTER_START),m.type==CKEDITOR.NODE_ELEMENT&&"td"==m.getName()&&l.setEndAt(p.endNode,CKEDITOR.POSITION_BEFORE_END),l=l.createIterator(),l.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;p=l.getNextParagraph();)if(!p.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(u,p,"list_block",1);for(var g,y=t.elementPath(p),f=y.elements,m=0,y=y.blockLimit,v=f.length-1;v>=0&&(g=f[v]);v--)if(a[g.getName()]&&y.contains(g)){y.removeCustomData("list_group_object_"+h),(f=g.getCustomData("list_group_object"))?f.contents.push(p):(f={root:g,contents:[p]},s.push(f),CKEDITOR.dom.element.setMarker(u,g,"list_group_object",f)),m=1;break}m||(m=y,m.getCustomData("list_group_object_"+h)?m.getCustomData("list_group_object_"+h).contents.push(p):(f={root:m,contents:[p]},CKEDITOR.dom.element.setMarker(u,m,"list_group_object_"+h,f),s.push(f)))}}for(g=[];s.length>0;)if(f=s.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(a[f.root.getName()]){for(o=t,h=f,f=u,l=g,m=CKEDITOR.plugins.list.listToArray(h.root,f),y=[],p=0;p<h.contents.length;p++)v=h.contents[p],(v=v.getAscendant("li",!0))&&!v.getCustomData("list_item_processed")&&(y.push(v),CKEDITOR.dom.element.setMarker(f,v,"list_item_processed",!0));for(var v=h.root.getDocument(),E=void 0,T=void 0,p=0;p<y.length;p++){var b=y[p].getCustomData("listarray_index"),E=m[b].parent;E.is(this.type)||(T=v.createElement(this.type),E.copyAttributes(T,{start:1,type:1}),T.removeStyle("list-style-type"),m[b].parent=T)}for(f=CKEDITOR.plugins.list.arrayToList(m,f,null,o.config.enterMode),m=void 0,y=f.listNode.getChildCount(),p=0;p<y&&(m=f.listNode.getChild(p));p++)m.getName()==this.type&&l.push(m);f.listNode.replace(h.root),o.fire("contentDomInvalidated")}else{for(m=t,p=f,l=g,y=p.contents,o=p.root.getDocument(),h=[],1==y.length&&y[0].equals(p.root)&&(f=o.createElement("div"),y[0].moveChildren&&y[0].moveChildren(f),y[0].append(f),y[0]=f),p=p.contents[0].getParent(),v=0;v<y.length;v++)p=p.getCommonAncestor(y[v].getParent());for(E=m.config.useComputedState,m=f=void 0,E=void 0===E||E,v=0;v<y.length;v++)for(T=y[v];b=T.getParent();){if(b.equals(p)){h.push(T),!m&&T.getDirection()&&(m=1),T=T.getDirection(E),null!==f&&(f=f&&f!=T?null:T);break}T=b}if(!(h.length<1)){for(y=h[h.length-1].getNext(),v=o.createElement(this.type),l.push(v),E=l=void 0;h.length;)l=h.shift(),E=o.createElement("li"),l.is("pre")||d.test(l.getName())||"false"==l.getAttribute("contenteditable")?l.appendTo(E):(l.copyAttributes(E),f&&l.getDirection()&&(E.removeStyle("direction"),E.removeAttribute("dir")),l.moveChildren(E),l.remove()),E.appendTo(v);f&&m&&v.setAttribute("dir",f),y?v.insertBefore(y):v.appendTo(p)}}else this.state==CKEDITOR.TRISTATE_ON&&a[f.root.getName()]&&e.call(this,t,f,u);for(v=0;v<g.length;v++)n(g[v]);CKEDITOR.dom.element.clearAllMarkers(u),r.selectBookmarks(i),t.focus()},refresh:function(e,t){var i=t.contains(a,1),n=t.blockLimit||t.root;i&&n.contains(i)?this.setState(i.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(e){e.blockless||(e.addCommand("numberedlist",new t("numberedlist","ol")),e.addCommand("bulletedlist",new t("bulletedlist","ul")),e.ui.addButton&&(e.ui.addButton("NumberedList",{label:e.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),e.ui.addButton("BulletedList",{label:e.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),e.on("key",function(t){var i,n=t.data.domEvent.getKey();if("wysiwyg"==e.mode&&n in{8:1,46:1}){var l=e.getSelection().getRanges()[0],u=l&&l.startPath();if(l&&l.collapsed){var d=8==n,p=e.editable(),f=new CKEDITOR.dom.walker(l.clone());if(f.evaluator=function(e){return c(e)&&!h(e)},f.guard=function(e,t){return!(t&&e.type==CKEDITOR.NODE_ELEMENT&&e.is("table"))},n=l.clone(),d){var m;(m=u.contains(a))&&l.checkBoundaryOfElement(m,CKEDITOR.START)&&(m=m.getParent())&&m.is("li")&&(m=s(m))?(i=m,m=m.getPrevious(c),n.moveToPosition(m&&h(m)?m:i,CKEDITOR.POSITION_BEFORE_START)):(f.range.setStartAt(p,CKEDITOR.POSITION_AFTER_START),f.range.setEnd(l.startContainer,l.startOffset),(m=f.previous())&&m.type==CKEDITOR.NODE_ELEMENT&&(m.getName()in a||m.is("li"))&&(m.is("li")||(f.range.selectNodeContents(m),f.reset(),f.evaluator=r,m=f.previous()),i=m,n.moveToElementEditEnd(i),n.moveToPosition(n.endPath().block,CKEDITOR.POSITION_BEFORE_END))),i?(o(e,n,l),t.cancel()):(n=u.contains(a))&&l.checkBoundaryOfElement(n,CKEDITOR.START)&&(i=n.getFirst(c),l.checkBoundaryOfElement(i,CKEDITOR.START)&&(m=n.getPrevious(c),s(i)?m&&(l.moveToElementEditEnd(m),l.select()):e.execCommand("outdent"),t.cancel()))}else(i=u.contains("li"))?(f.range.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),p=(u=i.getLast(c))&&r(u)?u:i,i=0,(m=f.next())&&m.type==CKEDITOR.NODE_ELEMENT&&m.getName()in a&&m.equals(u)?(i=1,m=f.next()):l.checkBoundaryOfElement(p,CKEDITOR.END)&&(i=2),i&&m&&(l=l.clone(),l.moveToElementEditStart(m),2==i&&(n.moveToPosition(n.endPath().block,CKEDITOR.POSITION_BEFORE_END),l.endPath().block&&l.moveToPosition(l.endPath().block,CKEDITOR.POSITION_AFTER_START)),o(e,n,l),t.cancel())):(f.range.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),(m=f.next())&&m.type==CKEDITOR.NODE_ELEMENT&&m.is(a)&&(m=m.getFirst(c),u.block&&l.checkStartOfBlock()&&l.checkEndOfBlock()?(u.block.remove(),l.moveToElementEditStart(m),l.select()):s(m)?(l.moveToElementEditStart(m),l.select()):(l=l.clone(),l.moveToElementEditStart(m),o(e,n,l)),t.cancel()));setTimeout(function(){e.selectionChange(1)})}}}))}})}(),function(){function e(e,t,i){i=e.config.forceEnterMode||i,"wysiwyg"==e.mode&&(t||(t=e.activeEnterMode),e.elementPath().isContextFor("p")||(t=CKEDITOR.ENTER_BR,i=1),e.fire("saveSnapshot"),t==CKEDITOR.ENTER_BR?s(e,t,null,i):a(e,t,null,i),e.fire("saveSnapshot"))}function t(e){for(var e=e.getSelection().getRanges(!0),t=e.length-1;t>0;t--)e[t].deleteContents();return e[0]}function i(e){var t=e.startContainer.getAscendant(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&"true"==e.getAttribute("contenteditable")},!0);return e.root.equals(t)?e:(t=new CKEDITOR.dom.range(t),t.moveToRange(e),t)}CKEDITOR.plugins.add("enterkey",{init:function(t){t.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(t){e(t)}}),t.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(t){e(t,t.activeShiftEnterMode,1)}}),t.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var n=CKEDITOR.dom.walker.whitespaces(),r=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(e,o,a,u){if(a=a||t(e)){var c,a=i(a),h=a.document,d=a.checkStartOfBlock(),p=a.checkEndOfBlock(),f=e.elementPath(a.startContainer),m=f.block,g=o==CKEDITOR.ENTER_DIV?"div":"p";if(d&&p){if(m&&(m.is("li")||m.getParent().is("li"))){m.is("li")||(m=m.getParent()),a=m.getParent(),c=a.getParent();var u=!m.hasPrevious(),y=!m.hasNext(),g=e.getSelection(),v=g.createBookmarks(),d=m.getDirection(1),p=m.getAttribute("class"),E=m.getAttribute("style"),T=c.getDirection(1)!=d,e=e.enterMode!=CKEDITOR.ENTER_BR||T||E||p;if(c.is("li"))u||y?(u&&y&&a.remove(),m[y?"insertAfter":"insertBefore"](c)):m.breakParent(c);else{if(e)f.block.is("li")?(c=h.createElement(o==CKEDITOR.ENTER_P?"p":"div"),T&&c.setAttribute("dir",d),E&&c.setAttribute("style",E),p&&c.setAttribute("class",p),m.moveChildren(c)):c=f.block,u||y?c[u?"insertBefore":"insertAfter"](a):(m.breakParent(a),c.insertAfter(a));else if(m.appendBogus(!0),u||y)for(;h=m[u?"getFirst":"getLast"]();)h[u?"insertBefore":"insertAfter"](a);else for(m.breakParent(a);h=m.getLast();)h.insertAfter(a);m.remove()}return void g.selectBookmarks(v)}if(m&&m.getParent().is("blockquote"))return m.breakParent(m.getParent()),m.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||m.getPrevious().remove(),m.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||m.getNext().remove(),a.moveToElementEditStart(m),void a.select()}else if(m&&m.is("pre")&&!p)return void s(e,o,a,u);if(d=a.splitBlock(g)){if(o=d.previousBlock,m=d.nextBlock,f=d.wasStartOfBlock,e=d.wasEndOfBlock,m?(v=m.getParent(),v.is("li")&&(m.breakParent(v),m.move(m.getNext(),1))):o&&(v=o.getParent())&&v.is("li")&&(o.breakParent(v),v=o.getNext(),a.moveToElementEditStart(v),o.move(o.getPrevious())),f||e){if(o?(o.is("li")||!l.test(o.getName())&&!o.is("pre"))&&(c=o.clone()):m&&(c=m.clone()),c?u&&!c.is("li")&&c.renameNode(g):v&&v.is("li")?c=v:(c=h.createElement(g),o&&(y=o.getDirection())&&c.setAttribute("dir",y)),h=d.elementPath)for(u=0,g=h.elements.length;u<g&&(v=h.elements[u],!v.equals(h.block)&&!v.equals(h.blockLimit));u++)CKEDITOR.dtd.$removeEmpty[v.getName()]&&(v=v.clone(),c.moveChildren(v),c.append(v));c.appendBogus(),c.getParent()||a.insertNode(c),c.is("li")&&c.removeAttribute("value"),!CKEDITOR.env.ie||!f||e&&o.getChildCount()||(a.moveToElementEditStart(e?o:c),a.select()),a.moveToElementEditStart(f&&!e?m:c)}else m.is("li")&&(c=a.clone(),c.selectNodeContents(m),c=new CKEDITOR.dom.walker(c),c.evaluator=function(e){return!(r(e)||n(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$inline&&!(e.getName()in CKEDITOR.dtd.$empty))},(v=c.next())&&v.type==CKEDITOR.NODE_ELEMENT&&v.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?h.createElement("br"):h.createText(" ")).insertBefore(v)),m&&a.moveToElementEditStart(m);a.select(),a.scrollIntoView()}}},enterBr:function(e,i,n,r){if(n=n||t(e)){var o=n.document,s=n.checkEndOfBlock(),u=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),c=u.block,h=c&&u.block.getName();r||"li"!=h?(!r&&s&&l.test(h)?(s=c.getDirection())?(o=o.createElement("div"),o.setAttribute("dir",s),o.insertAfter(c),n.setStart(o,0)):(o.createElement("br").insertAfter(c),CKEDITOR.env.gecko&&o.createText("").insertAfter(c),n.setStartAt(c.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(e="pre"==h&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?o.createText("\r"):o.createElement("br"),n.deleteContents(),n.insertNode(e),CKEDITOR.env.needsBrFiller?(o.createText("\ufeff").insertAfter(e),s&&(c||u.blockLimit).appendBogus(),e.getNext().$.nodeValue="",n.setStartAt(e.getNext(),CKEDITOR.POSITION_AFTER_START)):n.setStartAt(e,CKEDITOR.POSITION_AFTER_END)),n.collapse(!0),n.select(),n.scrollIntoView()):a(e,i,n,r)}}};var o=CKEDITOR.plugins.enterkey,s=o.enterBr,a=o.enterBlock,l=/^h[1-6]$/}(),function(){function e(e,t){var i={},n=[],r={nbsp:" ",shy:"­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},e=e.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(e,o){var s=t?"&"+o+";":r[o];return i[s]=t?r[o]:"&"+o+";",n.push(s),""});if(!t&&e){var o,e=e.split(","),s=document.createElement("div");for(s.innerHTML="&"+e.join(";&")+";",o=s.innerHTML,s=null,s=0;s<o.length;s++){var a=o.charAt(s);i[a]="&"+e[s]+";",n.push(a)}}return i.regex=n.join(t?"|":""),i}CKEDITOR.plugins.add("entities",{afterInit:function(t){function i(e){return l[e]}function n(e){return"force"!=r.entities_processNumerical&&s[e]?s[e]:"&#"+e.charCodeAt(0)+";"}var r=t.config;if(t=(t=t.dataProcessor)&&t.htmlFilter){var o=[];r.basicEntities!==!1&&o.push("nbsp,gt,lt,amp"),r.entities&&(o.length&&o.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),r.entities_latin&&o.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),r.entities_greek&&o.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),r.entities_additional&&o.push(r.entities_additional));var s=e(o.join(",")),a=s.regex?"["+s.regex+"]":"a^";delete s.regex,r.entities&&r.entities_processNumerical&&(a="[^ -~]|"+a);var a=RegExp(a,"g"),l=e("nbsp,gt,lt,amp,shy",!0),u=RegExp(l.regex,"g");t.addRules({text:function(e){return e.replace(u,i).replace(a,n)}},{applyToAll:!0,excludeNestedEditable:!0})}}})}(),CKEDITOR.config.basicEntities=!0,CKEDITOR.config.entities=!0,CKEDITOR.config.entities_latin=!0,CKEDITOR.config.entities_greek=!0,CKEDITOR.config.entities_additional="#39",CKEDITOR.plugins.add("popup"),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{popup:function(e,t,i,n){t=t||"80%",i=i||"70%","string"==typeof t&&t.length>1&&"%"==t.substr(t.length-1,1)&&(t=parseInt(window.screen.width*parseInt(t,10)/100,10)),"string"==typeof i&&i.length>1&&"%"==i.substr(i.length-1,1)&&(i=parseInt(window.screen.height*parseInt(i,10)/100,10)),t<640&&(t=640),i<420&&(i=420);var r=parseInt((window.screen.height-i)/2,10),o=parseInt((window.screen.width-t)/2,10),n=(n||"location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes")+",width="+t+",height="+i+",top="+r+",left="+o,s=window.open("",null,n,!0);if(!s)return!1;try{navigator.userAgent.toLowerCase().indexOf(" chrome/")==-1&&(s.moveTo(o,r),s.resizeTo(t,i)),s.focus(),s.location.href=e}catch(a){window.open(e,null,n,!0)}return!0}}),function(){function e(e,t){var i=[];if(!t)return e;for(var n in t)i.push(n+"="+encodeURIComponent(t[n]));return e+(e.indexOf("?")!=-1?"&":"?")+i.join("&")}function t(e){return e+="",e.charAt(0).toUpperCase()+e.substr(1)}function i(){var i=this.getDialog(),n=i.getParentEditor();n._.filebrowserSe=this;var r=n.config["filebrowser"+t(i.getName())+"WindowWidth"]||n.config.filebrowserWindowWidth||"80%",i=n.config["filebrowser"+t(i.getName())+"WindowHeight"]||n.config.filebrowserWindowHeight||"70%",o=this.filebrowser.params||{};o.CKEditor=n.name,o.CKEditorFuncNum=n._.filebrowserFn,o.langCode||(o.langCode=n.langCode),o=e(this.filebrowser.url,o),n.popup(o,r,i,n.config.filebrowserWindowFeatures||n.config.fileBrowserWindowFeatures)}function n(){var e=this.getDialog();return e.getParentEditor()._.filebrowserSe=this,!(!e.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value||!e.getContentElement(this["for"][0],this["for"][1]).getAction())}function r(t,i,n){var r=n.params||{};r.CKEditor=t.name,r.CKEditorFuncNum=t._.filebrowserFn,r.langCode||(r.langCode=t.langCode),i.action=e(n.url,r),i.filebrowser=n}function o(e,s,a,l){if(l&&l.length)for(var u,c=l.length;c--;)if(u=l[c],("hbox"==u.type||"vbox"==u.type||"fieldset"==u.type)&&o(e,s,a,u.children),u.filebrowser)if("string"==typeof u.filebrowser&&(u.filebrowser={action:"fileButton"==u.type?"QuickUpload":"Browse",target:u.filebrowser}),"Browse"==u.filebrowser.action){var h=u.filebrowser.url;void 0===h&&(h=e.config["filebrowser"+t(s)+"BrowseUrl"],void 0===h&&(h=e.config.filebrowserBrowseUrl)),h&&(u.onClick=i,u.filebrowser.url=h,u.hidden=!1)}else if("QuickUpload"==u.filebrowser.action&&u["for"]&&(h=u.filebrowser.url,void 0===h&&(h=e.config["filebrowser"+t(s)+"UploadUrl"],void 0===h&&(h=e.config.filebrowserUploadUrl)),h)){var d=u.onClick;u.onClick=function(e){var t=e.sender;return(!d||d.call(t,e)!==!1)&&n.call(t,e)},u.filebrowser.url=h,u.hidden=!1,r(e,a.getContents(u["for"][0]).get(u["for"][1]),u.filebrowser)}}function s(e,t,i){if(i.indexOf(";")!==-1){for(var i=i.split(";"),n=0;n<i.length;n++)if(s(e,t,i[n]))return!0;return!1}return(e=e.getContents(t).get(i).filebrowser)&&e.url}function a(e,t){var i=this._.filebrowserSe.getDialog(),n=this._.filebrowserSe["for"],r=this._.filebrowserSe.filebrowser.onSelect;n&&i.getContentElement(n[0],n[1]).reset(),"function"==typeof t&&t.call(this._.filebrowserSe)===!1||r&&r.call(this._.filebrowserSe,e,t)===!1||("string"==typeof t&&t&&alert(t),e&&(n=this._.filebrowserSe,i=n.getDialog(),(n=n.filebrowser.target||null)&&(n=n.split(":"),(r=i.getContentElement(n[0],n[1]))&&(r.setValue(e),i.selectPage(n[0])))))}CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(e){e._.filebrowserFn=CKEDITOR.tools.addFunction(a,e),e.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}}),CKEDITOR.on("dialogDefinition",function(e){if(e.editor.plugins.filebrowser)for(var t,i=e.data.definition,n=0;n<i.contents.length;++n)(t=i.contents[n])&&(o(e.editor,e.data.name,i,t.elements),t.hidden&&t.filebrowser&&(t.hidden=!s(i,t.id,t.filebrowser)))})}(),function(){function e(e){var n=e.config,r=e.fire("uiSpace",{space:"top",html:""}).html,o=function(){function r(e,t,n){a.setStyle(t,i(n)),a.setStyle("position",e)}function s(e){var t=u.getDocumentPosition();switch(e){case"top":r("absolute","top",t.y-p-g);break;case"pin":r("fixed","top",v);break;case"bottom":r("absolute","top",t.y+(h.height||h.bottom-h.top)+g)}l=e}var l,u,c,h,d,p,f,m=n.floatSpaceDockedOffsetX||0,g=n.floatSpaceDockedOffsetY||0,y=n.floatSpacePinnedOffsetX||0,v=n.floatSpacePinnedOffsetY||0;return function(n){if(u=e.editable())if(n&&"focus"==n.name&&a.show(),a.removeStyle("left"),a.removeStyle("right"),c=a.getClientRect(),h=u.getClientRect(),d=t.getViewPaneSize(),p=c.height,f="pageXOffset"in t.$?t.$.pageXOffset:CKEDITOR.document.$.documentElement.scrollLeft,l){s(p+g<=h.top?"top":p+g>d.height-h.bottom?"pin":"bottom");var r,n=d.width/2,n=h.left>0&&h.right<d.width&&h.width>c.width?"rtl"==e.config.contentsLangDirection?"right":"left":n-h.left>h.right-n?"left":"right";c.width>d.width?(n="left",r=0):(r="left"==n?h.left>0?h.left:0:h.right<d.width?d.width-h.right:0,r+c.width>d.width&&(n="left"==n?"right":"left",r=0)),a.setStyle(n,i(("pin"==l?y:m)+r+("pin"==l?0:"left"==n?f:-f)))}else l="pin",s("pin"),o(n)}}();if(r){var s=new CKEDITOR.template('<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_float cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="application" style="{style}"'+(e.title?' aria-labelledby="cke_{name}_arialbl"':" ")+">"+(e.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':" ")+'<div class="cke_inner"><div id="{topId}" class="cke_top" role="presentation">{content}</div></div></div>'),a=CKEDITOR.document.getBody().append(CKEDITOR.dom.element.createFromHtml(s.output({content:r,id:e.id,langDir:e.lang.dir,langCode:e.langCode,name:e.name,style:"display:none;z-index:"+(n.baseFloatZIndex-1),topId:e.ui.spaceId("top"),voiceLabel:e.title}))),l=CKEDITOR.tools.eventsBuffer(500,o),u=CKEDITOR.tools.eventsBuffer(100,o);a.unselectable(),a.on("mousedown",function(e){e=e.data,e.getTarget().hasAscendant("a",1)||e.preventDefault()}),e.on("focus",function(i){o(i),e.on("change",l.input),t.on("scroll",u.input),t.on("resize",u.input)}),e.on("blur",function(){a.hide(),e.removeListener("change",l.input),t.removeListener("scroll",u.input),t.removeListener("resize",u.input)}),e.on("destroy",function(){t.removeListener("scroll",u.input),t.removeListener("resize",u.input),a.clearCustomData(),a.remove()}),e.focusManager.hasFocus&&a.show(),e.focusManager.add(a,1)}}var t=CKEDITOR.document.getWindow(),i=CKEDITOR.tools.cssLength;CKEDITOR.plugins.add("floatingspace",{init:function(t){t.on("loaded",function(){e(this)},null,null,20)}})}(),CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var e=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),t=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),i=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),n=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(e,t){return this.addBlock(e,new CKEDITOR.ui.listBlock(this.getHolderElement(),t))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(e,t){var t=t||{},i=t.attributes||(t.attributes={});(this.multiSelect=!!t.multiSelect)&&(i["aria-multiselectable"]=!0),!i.role&&(i.role="listbox"),this.base.apply(this,arguments),this.element.setAttribute("role",i.role),i=this.keys,
i[40]="next",i[9]="next",i[38]="prev",i[CKEDITOR.SHIFT+9]="prev",i[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(i[13]="mouseup"),this._.pendingHtml=[],this._.pendingList=[],this._.items={},this._.groups={}},_:{close:function(){if(this._.started){var t=e.output({items:this._.pendingList.join("")});this._.pendingList=[],this._.pendingHtml.push(t),delete this._.started}},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(e){var t=this.toggle(e);this.onClick&&this.onClick(e,t)},this)),this._.click}},proto:{add:function(e,i,r){var o=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0),this._.items[e]=o;var s;s=CKEDITOR.tools.htmlEncodeAttr(e).replace(n,"\\'"),e={id:o,val:s,onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(r||e),text:i||e},this._.pendingList.push(t.output(e))},startGroup:function(e){this._.close();var t=CKEDITOR.tools.getNextId();this._.groups[e]=t,this._.pendingHtml.push(i.output({id:t,label:e}))},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),delete this._.size,this._.pendingHtml=[]},toggle:function(e){var t=this.isMarked(e);return t?this.unmark(e):this.mark(e),!t},hideGroup:function(e){var t=(e=this.element.getDocument().getById(this._.groups[e]))&&e.getNext();e&&(e.setStyle("display","none"),t&&"ul"==t.getName()&&t.setStyle("display","none"))},hideItem:function(e){this.element.getDocument().getById(this._.items[e]).setStyle("display","none")},showAll:function(){var e,t=this._.items,i=this._.groups,n=this.element.getDocument();for(e in t)n.getById(t[e]).setStyle("display","");for(var r in i)t=n.getById(i[r]),e=t.getNext(),t.setStyle("display",""),e&&"ul"==e.getName()&&e.setStyle("display","")},mark:function(e){this.multiSelect||this.unmarkAll();var e=this._.items[e],t=this.element.getDocument().getById(e);t.addClass("cke_selected"),this.element.getDocument().getById(e+"_option").setAttribute("aria-selected",!0),this.onMark&&this.onMark(t)},unmark:function(e){var t=this.element.getDocument(),e=this._.items[e],i=t.getById(e);i.removeClass("cke_selected"),t.getById(e+"_option").removeAttribute("aria-selected"),this.onUnmark&&this.onUnmark(i)},unmarkAll:function(){var e,t=this._.items,i=this.element.getDocument();for(e in t){var n=t[e];i.getById(n).removeClass("cke_selected"),i.getById(n+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(e){return this.element.getDocument().getById(this._.items[e]).hasClass("cke_selected")},focus:function(e){this._.focusIndex=-1;var t,i=this.element.getElementsByTag("a"),n=-1;if(e){for(t=this.element.getDocument().getById(this._.items[e]).getFirst();e=i.getItem(++n);)if(e.equals(t)){this._.focusIndex=n;break}}else this.element.focus();t&&setTimeout(function(){t.focus()},0)}}})}}),function(){var e='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var e=e+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"'),e=e+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',t=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),i=CKEDITOR.addTemplate("button",e);CKEDITOR.plugins.add("button",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON="button",CKEDITOR.ui.button=function(e){CKEDITOR.tools.extend(this,e,{title:e.label,click:e.click||function(t){t.execCommand(e.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(e){return new CKEDITOR.ui.button(e)}},CKEDITOR.ui.button.prototype={render:function(e,n){function r(){var t=e.mode;t&&(t=this.modes[t]?void 0!==f[t]?f[t]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,t=e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:t,this.setState(t),this.refresh&&this.refresh())}var o,s=CKEDITOR.env,a=this._.id=CKEDITOR.tools.getNextId(),l="",u=this.command;this._.editor=e;var c={id:a,button:this,editor:e,focus:function(){CKEDITOR.document.getById(a).focus()},execute:function(){this.button.click(e)},attach:function(e){this.button.attach(e)}},h=CKEDITOR.tools.addFunction(function(e){if(c.onkey)return e=new CKEDITOR.dom.event(e),c.onkey(c,e.getKeystroke())!==!1}),d=CKEDITOR.tools.addFunction(function(e){var t;return c.onfocus&&(t=c.onfocus(c,new CKEDITOR.dom.event(e))!==!1),t}),p=0;if(c.clickFn=o=CKEDITOR.tools.addFunction(function(){p&&(e.unlockSelection(1),p=0),c.execute(),s.iOS&&e.focus()}),this.modes){var f={};e.on("beforeModeUnload",function(){e.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(f[e.mode]=this._.state)},this),e.on("activeFilterChange",r,this),e.on("mode",r,this),!this.readOnly&&e.on("readOnly",r,this)}else u&&(u=e.getCommand(u))&&(u.on("state",function(){this.setState(u.state)},this),l+=u.state==CKEDITOR.TRISTATE_ON?"on":u.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off");this.directional&&e.on("contentDirChanged",function(t){var i=CKEDITOR.document.getById(this._.id),n=i.getFirst(),t=t.data;t!=e.lang.dir?i.addClass("cke_"+t):i.removeClass("cke_ltr").removeClass("cke_rtl"),n.setAttribute("style",CKEDITOR.skin.getIconStyle(g,"rtl"==t,this.icon,this.iconOffset))},this),u||(l+="off");var m=this.name||this.command,g=m;return this.icon&&!/\./.test(this.icon)&&(g=this.icon,this.icon=null),l={id:a,name:m,iconName:g,label:this.label,cls:this.className||"",state:l,ariaDisabled:"disabled"==l?"true":"false",title:this.title,titleJs:s.gecko&&!s.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:h,focusFn:d,clickFn:o,style:CKEDITOR.skin.getIconStyle(g,"rtl"==e.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?t.output():""},i.output(l,n),this.onRender&&this.onRender(),c},setState:function(e){if(this._.state==e)return!1;this._.state=e;var t=CKEDITOR.document.getById(this._.id);return!!t&&(t.setState(e,"cke_button"),e==CKEDITOR.TRISTATE_DISABLED?t.setAttribute("aria-disabled",!0):t.removeAttribute("aria-disabled"),this.hasArrow?(e=e==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(e)):e==CKEDITOR.TRISTATE_ON?t.setAttribute("aria-pressed",!0):t.removeAttribute("aria-pressed"),!0)},getState:function(){return this._.state},toFeature:function(e){if(this._.feature)return this._.feature;var t=this;return!this.allowedContent&&!this.requiredContent&&this.command&&(t=e.getCommand(this.command)||t),this._.feature=t}},CKEDITOR.ui.prototype.addButton=function(e,t){this.add(e,CKEDITOR.UI_BUTTON,t)}}(),CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}}),function(){var e='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var e=e+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>"),t=CKEDITOR.addTemplate("combo",e);CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(e){CKEDITOR.tools.extend(this,e,{canGroup:!1,title:e.label,modes:{wysiwyg:1},editorFocus:1}),e=this.panel||{},delete this.panel,this.id=CKEDITOR.tools.getNextNumber(),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.className="cke_combopanel",e.block={multiSelect:e.multiSelect,attributes:e.attributes},e.toolbarRelated=!0,this._={panelDefinition:e,items:{}}},proto:{renderHtml:function(e){var t=[];return this.render(e,t),t.join("")},render:function(e,i){function n(){if(this.getState()!=CKEDITOR.TRISTATE_ON){var t=this.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;e.readOnly&&!this.readOnly&&(t=CKEDITOR.TRISTATE_DISABLED),this.setState(t),this.setValue(""),t!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}}var r=CKEDITOR.env,o="cke_"+this.id,s=CKEDITOR.tools.addFunction(function(t){h&&(e.unlockSelection(1),h=0),l.execute(t)},this),a=this,l={id:o,combo:this,focus:function(){CKEDITOR.document.getById(o).getChild(1).focus()},execute:function(t){var i=a._;if(i.state!=CKEDITOR.TRISTATE_DISABLED)if(a.createPanel(e),i.on)i.panel.hide();else{a.commit();var n=a.getValue();n?i.list.mark(n):i.list.unmarkAll(),i.panel.showBlock(a.id,new CKEDITOR.dom.element(t),4)}},clickFn:s};e.on("activeFilterChange",n,this),e.on("mode",n,this),e.on("selectionChange",n,this),!this.readOnly&&e.on("readOnly",n,this);var u=CKEDITOR.tools.addFunction(function(t,i){var t=new CKEDITOR.dom.event(t),n=t.getKeystroke();switch(40==n&&e.once("panelShow",function(e){e.data._.panel._.currentBlock.onKeyDown(40)}),n){case 13:case 32:case 40:CKEDITOR.tools.callFunction(s,i);break;default:l.onkey(l,n)}t.preventDefault()}),c=CKEDITOR.tools.addFunction(function(){l.onfocus&&l.onfocus()}),h=0;return l.keyDownFn=u,r={id:o,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:r.gecko&&!r.hc?"":(this.title||"").replace("'",""),keydownFn:u,focusFn:c,clickFn:s},t.output(r,i),this.onRender&&this.onRender(),l},createPanel:function(e){if(!this._.panel){var t=this._.panelDefinition,i=this._.panelDefinition.block,n=t.parent||CKEDITOR.document.getBody(),r="cke_combopanel__"+this.name,o=new CKEDITOR.ui.floatPanel(e,n,t),s=o.addListBlock(this.id,i),a=this;o.onShow=function(){this.element.addClass(r),a.setState(CKEDITOR.TRISTATE_ON),a._.on=1,a.editorFocus&&!e.focusManager.hasFocus&&e.focus(),a.onOpen&&a.onOpen(),e.once("panelShow",function(){s.focus(!s.multiSelect&&a.getValue())})},o.onHide=function(t){this.element.removeClass(r),a.setState(a.modes&&a.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),a._.on=0,!t&&a.onClose&&a.onClose()},o.onEscape=function(){o.hide(1)},s.onClick=function(e,t){a.onClick&&a.onClick.call(a,e,t),o.hide()},this._.panel=o,this._.list=s,o.getBlock(this.id).onHide=function(){a._.on=0,a.setState(CKEDITOR.TRISTATE_OFF)},this.init&&this.init()}},setValue:function(e,t){this._.value=e;var i=this.document.getById("cke_"+this.id+"_text");i&&(e||t?i.removeClass("cke_combo_inlinelabel"):(t=this.label,i.addClass("cke_combo_inlinelabel")),i.setText("undefined"!=typeof t?t:e))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(e){this._.list.mark(e)},hideItem:function(e){this._.list.hideItem(e)},hideGroup:function(e){this._.list.hideGroup(e)},showAll:function(){this._.list.showAll()},add:function(e,t,i){this._.items[e]=i||e,this._.list.add(e,t,i)},startGroup:function(e){this._.list.startGroup(e)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this)),this._.committed=1},setState:function(e){if(this._.state!=e){var t=this.document.getById("cke_"+this.id);t.setState(e,"cke_combo"),e==CKEDITOR.TRISTATE_DISABLED?t.setAttribute("aria-disabled",!0):t.removeAttribute("aria-disabled"),this._.state=e}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(e){return new CKEDITOR.ui.richCombo(e)}}}}),CKEDITOR.ui.prototype.addRichCombo=function(e,t){this.add(e,CKEDITOR.UI_RICHCOMBO,t)}}(),CKEDITOR.plugins.add("format",{requires:"richcombo",init:function(e){if(!e.blockless){for(var t=e.config,i=e.lang.format,n=t.format_tags.split(";"),r={},o=0,s=[],a=0;a<n.length;a++){var l=n[a],u=new CKEDITOR.style(t["format_"+l]);e.filter.customConfig&&!e.filter.check(u)||(o++,r[l]=u,r[l]._.enterMode=e.config.enterMode,s.push(u))}0!==o&&e.ui.addRichCombo("Format",{label:i.label,title:i.panelTitle,toolbar:"styles,20",allowedContent:s,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(t.contentsCss),multiSelect:!1,attributes:{"aria-label":i.panelTitle}},init:function(){this.startGroup(i.panelTitle);for(var e in r){var t=i["tag_"+e];this.add(e,r[e].buildPreview(t),t)}},onClick:function(t){e.focus(),e.fire("saveSnapshot");var t=r[t],i=e.elementPath();e[t.checkActive(i,e)?"removeStyle":"applyStyle"](t),setTimeout(function(){e.fire("saveSnapshot")},0)},onRender:function(){e.on("selectionChange",function(t){var i=this.getValue(),t=t.data.path;this.refresh();for(var n in r)if(r[n].checkActive(t,e))return void(n!=i&&this.setValue(n,e.lang.format["tag_"+n]));this.setValue("")},this)},onOpen:function(){this.showAll();for(var t in r)e.activeFilter.check(r[t])||this.hideItem(t)},refresh:function(){var t=e.elementPath();if(t){if(t.isContextFor("p"))for(var i in r)if(e.activeFilter.check(r[i]))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}}})}}}),CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre;address;div",CKEDITOR.config.format_p={element:"p"},CKEDITOR.config.format_div={element:"div"},CKEDITOR.config.format_pre={element:"pre"},CKEDITOR.config.format_address={element:"address"},CKEDITOR.config.format_h1={element:"h1"},CKEDITOR.config.format_h2={element:"h2"},CKEDITOR.config.format_h3={element:"h3"},CKEDITOR.config.format_h4={element:"h4"},CKEDITOR.config.format_h5={element:"h5"},CKEDITOR.config.format_h6={element:"h6"},function(){var e={canUndo:!1,exec:function(e){var t=e.document.createElement("hr");e.insertElement(t)},allowedContent:"hr",requiredContent:"hr"};CKEDITOR.plugins.add("horizontalrule",{init:function(t){t.blockless||(t.addCommand("horizontalrule",e),t.ui.addButton&&t.ui.addButton("HorizontalRule",{label:t.lang.horizontalrule.toolbar,command:"horizontalrule",toolbar:"insert,40"}))}})}(),CKEDITOR.plugins.add("htmlwriter",{init:function(e){var t=new CKEDITOR.htmlWriter;t.forceSimpleAmpersand=e.config.forceSimpleAmpersand,t.indentationChars=e.config.dataIndentationChars||"\t",e.dataProcessor.writer=t}}),CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){this.base(),this.indentationChars="\t",this.selfClosingEnd=" />",this.lineBreakChars="\n",this.sortAttributes=1,this._.indent=0,this._.indentation="",this._.inPre=0,this._.rules={};var e,t=CKEDITOR.dtd;for(e in CKEDITOR.tools.extend({},t.$nonBodyContent,t.$block,t.$listItem,t.$tableContent))this.setRules(e,{indent:!t[e]["#"],breakBeforeOpen:1,breakBeforeClose:!t[e]["#"],breakAfterClose:1,needsSpace:e in t.$block&&!(e in{li:1,dt:1,dd:1})});this.setRules("br",{breakAfterOpen:1}),this.setRules("title",{indent:0,breakAfterOpen:0}),this.setRules("style",{indent:0,breakBeforeClose:1}),this.setRules("pre",{breakAfterOpen:1,indent:0})},proto:{openTag:function(e){var t=this._.rules[e];this._.afterCloser&&t&&t.needsSpace&&this._.needsSpace&&this._.output.push("\n"),this._.indent?this.indentation():t&&t.breakBeforeOpen&&(this.lineBreak(),this.indentation()),this._.output.push("<",e),this._.afterCloser=0},openTagClose:function(e,t){var i=this._.rules[e];t?(this._.output.push(this.selfClosingEnd),i&&i.breakAfterClose&&(this._.needsSpace=i.needsSpace)):(this._.output.push(">"),i&&i.indent&&(this._.indentation=this._.indentation+this.indentationChars)),i&&i.breakAfterOpen&&this.lineBreak(),"pre"==e&&(this._.inPre=1)},attribute:function(e,t){"string"==typeof t&&(this.forceSimpleAmpersand&&(t=t.replace(/&amp;/g,"&")),t=CKEDITOR.tools.htmlEncodeAttr(t)),this._.output.push(" ",e,'="',t,'"')},closeTag:function(e){var t=this._.rules[e];t&&t.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length)),this._.indent?this.indentation():t&&t.breakBeforeClose&&(this.lineBreak(),this.indentation()),this._.output.push("</",e,">"),"pre"==e&&(this._.inPre=0),t&&t.breakAfterClose&&(this.lineBreak(),this._.needsSpace=t.needsSpace),this._.afterCloser=1},text:function(e){this._.indent&&(this.indentation(),!this._.inPre&&(e=CKEDITOR.tools.ltrim(e))),this._.output.push(e)},comment:function(e){this._.indent&&this.indentation(),this._.output.push("<!--",e,"-->")},lineBreak:function(){!this._.inPre&&this._.output.length>0&&this._.output.push(this.lineBreakChars),this._.indent=1},indentation:function(){!this._.inPre&&this._.indentation&&this._.output.push(this._.indentation),this._.indent=0},reset:function(){this._.output=[],this._.indent=0,this._.indentation="",this._.afterCloser=0,this._.inPre=0},setRules:function(e,t){var i=this._.rules[e];i?CKEDITOR.tools.extend(i,t,!0):this._.rules[e]=t}}}),function(){function e(e,t){if(t||(t=e.getSelection().getSelectedElement()),t&&t.is("img")&&!t.data("cke-realelement")&&!t.isReadOnly())return t}function t(e){var t=e.getStyle("float");return"inherit"!=t&&"none"!=t||(t=0),t||(t=e.getAttribute("align")),t}CKEDITOR.plugins.add("image",{requires:"dialog",init:function(t){if(!t.plugins.image2){CKEDITOR.dialog.add("image",this.path+"dialogs/image.js");var i="img[alt,!src]{border-style,border-width,float,height,margin,margin-bottom,margin-left,margin-right,margin-top,width}";CKEDITOR.dialog.isTabEnabled(t,"image","advanced")&&(i="img[alt,dir,id,lang,longdesc,!src,title]{*}(*)"),t.addCommand("image",new CKEDITOR.dialogCommand("image",{allowedContent:i,requiredContent:"img[alt,src]",contentTransformations:[["img{width}: sizeToStyle","img[width]: sizeToAttribute"],["img{float}: alignmentToStyle","img[align]: alignmentToAttribute"]]})),t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:"image",toolbar:"insert,10"}),t.on("doubleclick",function(e){var t=e.data.element;!t.is("img")||t.data("cke-realelement")||t.isReadOnly()||(e.data.dialog="image")}),t.addMenuItems&&t.addMenuItems({image:{label:t.lang.image.menu,command:"image",group:"image"}}),t.contextMenu&&t.contextMenu.addListener(function(i){if(e(t,i))return{image:CKEDITOR.TRISTATE_OFF}})}},afterInit:function(i){function n(n){var r=i.getCommand("justify"+n);r&&("left"!=n&&"right"!=n||r.on("exec",function(r){var o,s=e(i);s&&(o=t(s),o==n?(s.removeStyle("float"),n==t(s)&&s.removeAttribute("align")):s.setStyle("float",n),r.cancel())}),r.on("refresh",function(r){var o=e(i);o&&(o=t(o),this.setState(o==n?CKEDITOR.TRISTATE_ON:"right"==n||"left"==n?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),r.cancel())}))}i.plugins.image2||(n("left"),n("right"),n("center"),n("block"))}})}(),CKEDITOR.config.image_removeLinkByEmptyURL=!0,function(){function e(e,t){var i=n.exec(e),r=n.exec(t);if(i){if(!i[2]&&"px"==r[2])return r[1];if("px"==i[2]&&!r[2])return r[1]+"px"}return t}var t=CKEDITOR.htmlParser.cssStyle,i=CKEDITOR.tools.cssLength,n=/^((?:\d*(?:\.\d+))|(?:\d+))(.*)?$/i,r={elements:{$:function(i){var n=i.attributes;if((n=(n=(n=n&&n["data-cke-realelement"])&&new CKEDITOR.htmlParser.fragment.fromHtml(decodeURIComponent(n)))&&n.children[0])&&i.attributes["data-cke-resizable"]){var r=new t(i).rules,i=n.attributes,o=r.width,r=r.height;o&&(i.width=e(i.width,o)),r&&(i.height=e(i.height,r))}return n}}};CKEDITOR.plugins.add("fakeobjects",{init:function(e){e.filter.allow("img[!data-cke-realelement,src,alt,title](*){*}","fakeobjects")},afterInit:function(e){(e=(e=e.dataProcessor)&&e.htmlFilter)&&e.addRules(r,{applyToAll:!0})}}),CKEDITOR.editor.prototype.createFakeElement=function(e,n,r,o){var s=this.lang.fakeobjects,s=s[r]||s.unknown,n={"class":n,"data-cke-realelement":encodeURIComponent(e.getOuterHtml()),"data-cke-real-node-type":e.type,alt:s,title:s,align:e.getAttribute("align")||""};return CKEDITOR.env.hc||(n.src=CKEDITOR.tools.transparentImageData),r&&(n["data-cke-real-element-type"]=r),o&&(n["data-cke-resizable"]=o,r=new t,o=e.getAttribute("width"),e=e.getAttribute("height"),o&&(r.rules.width=i(o)),e&&(r.rules.height=i(e)),r.populate(n)),this.document.createElement("img",{attributes:n})},CKEDITOR.editor.prototype.createFakeParserElement=function(e,n,r,o){var s,a=this.lang.fakeobjects,a=a[r]||a.unknown;return s=new CKEDITOR.htmlParser.basicWriter,e.writeHtml(s),s=s.getHtml(),n={"class":n,"data-cke-realelement":encodeURIComponent(s),"data-cke-real-node-type":e.type,alt:a,title:a,align:e.attributes.align||""},CKEDITOR.env.hc||(n.src=CKEDITOR.tools.transparentImageData),r&&(n["data-cke-real-element-type"]=r),o&&(n["data-cke-resizable"]=o,o=e.attributes,e=new t,r=o.width,o=o.height,void 0!==r&&(e.rules.width=i(r)),void 0!==o&&(e.rules.height=i(o)),e.populate(n)),new CKEDITOR.htmlParser.element("img",n)},CKEDITOR.editor.prototype.restoreRealElement=function(t){if(t.data("cke-real-node-type")!=CKEDITOR.NODE_ELEMENT)return null;var i=CKEDITOR.dom.element.createFromHtml(decodeURIComponent(t.data("cke-realelement")),this.document);if(t.data("cke-resizable")){var n=t.getStyle("width"),t=t.getStyle("height");n&&i.setAttribute("width",e(i.getAttribute("width"),n)),t&&i.setAttribute("height",e(i.getAttribute("height"),t))}return i}}(),function(){function e(e){return e.replace(/'/g,"\\$&")}function t(e){for(var t,i=e.length,n=[],r=0;r<i;r++)t=e.charCodeAt(r),n.push(t);return"String.fromCharCode("+n.join(",")+")"}function i(t,i){var n,r,o=t.plugins.link,s=o.compiledProtectionFunction.params;r=[o.compiledProtectionFunction.name,"("];for(var a=0;a<s.length;a++)o=s[a].toLowerCase(),n=i[o],a>0&&r.push(","),r.push("'",n?e(encodeURIComponent(i[o])):"","'");return r.push(")"),r.join("")}function n(e){var t,e=e.config.emailProtection||"";return e&&"encode"!=e&&(t={},e.replace(/^([^(]+)\(([^)]+)\)$/,function(e,i,n){t.name=i,t.params=[],n.replace(/[^,\s]+/g,function(e){t.params.push(e)})})),t}CKEDITOR.plugins.add("link",{requires:"dialog,fakeobjects",onLoad:function(){function e(e){return i.replace(/%1/g,"rtl"==e?"right":"left").replace(/%2/g,"cke_contents_"+e)}var t="background:url("+CKEDITOR.getUrl(this.path+"images"+(CKEDITOR.env.hidpi?"/hidpi":"")+"/anchor.png")+") no-repeat %1 center;border:1px dotted #00f;background-size:16px;",i=".%2 a.cke_anchor,.%2 a.cke_anchor_empty,.cke_editable.%2 a[name],.cke_editable.%2 a[data-cke-saved-name]{"+t+"padding-%1:18px;cursor:auto;}.%2 img.cke_anchor{"+t+"width:16px;min-height:15px;height:1.15em;vertical-align:text-bottom;}";CKEDITOR.addCss(e("ltr")+e("rtl"))},init:function(e){var t="a[!href]";CKEDITOR.dialog.isTabEnabled(e,"link","advanced")&&(t=t.replace("]",",accesskey,charset,dir,id,lang,name,rel,tabindex,title,type]{*}(*)")),CKEDITOR.dialog.isTabEnabled(e,"link","target")&&(t=t.replace("]",",target,onclick]")),e.addCommand("link",new CKEDITOR.dialogCommand("link",{allowedContent:t,requiredContent:"a[href]"})),e.addCommand("anchor",new CKEDITOR.dialogCommand("anchor",{allowedContent:"a[!name,id]",requiredContent:"a[name]"})),e.addCommand("unlink",new CKEDITOR.unlinkCommand),e.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand),e.setKeystroke(CKEDITOR.CTRL+76,"link"),e.ui.addButton&&(e.ui.addButton("Link",{label:e.lang.link.toolbar,command:"link",toolbar:"links,10"}),e.ui.addButton("Unlink",{label:e.lang.link.unlink,command:"unlink",toolbar:"links,20"}),e.ui.addButton("Anchor",{label:e.lang.link.anchor.toolbar,command:"anchor",toolbar:"links,30"})),CKEDITOR.dialog.add("link",this.path+"dialogs/link.js"),CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js"),e.on("doubleclick",function(t){var i=CKEDITOR.plugins.link.getSelectedLink(e)||t.data.element;i.isReadOnly()||(i.is("a")?(t.data.dialog=!i.getAttribute("name")||i.getAttribute("href")&&i.getChildCount()?"link":"anchor",t.data.link=i):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,i)&&(t.data.dialog="anchor"))},null,null,0),e.on("doubleclick",function(t){t.data.dialog in{link:1,anchor:1}&&t.data.link&&e.getSelection().selectElement(t.data.link)},null,null,20),e.addMenuItems&&e.addMenuItems({anchor:{label:e.lang.link.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:e.lang.link.anchor.remove,command:"removeAnchor",group:"anchor",order:5},link:{label:e.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:e.lang.link.unlink,command:"unlink",group:"link",order:5}}),e.contextMenu&&e.contextMenu.addListener(function(t){if(!t||t.isReadOnly())return null;if(t=CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t),!t&&!(t=CKEDITOR.plugins.link.getSelectedLink(e)))return null;var i={};return t.getAttribute("href")&&t.getChildCount()&&(i={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}),t&&t.hasAttribute("name")&&(i.anchor=i.removeAnchor=CKEDITOR.TRISTATE_OFF),i}),this.compiledProtectionFunction=n(e)},afterInit:function(e){e.dataProcessor.dataFilter.addRules({elements:{a:function(t){return t.attributes.name?t.children.length?null:e.createFakeParserElement(t,"cke_anchor","anchor"):null}}});var t=e._.elementsPath&&e._.elementsPath.filters;t&&t.push(function(t,i){if("a"==i&&(CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t)||t.getAttribute("name")&&(!t.getAttribute("href")||!t.getChildCount())))return"anchor"})}});var r=/^javascript:/,o=/^mailto:([^?]+)(?:\?(.+))?$/,s=/subject=([^;?:@&=$,\/]*)/,a=/body=([^;?:@&=$,\/]*)/,l=/^#(.*)$/,u=/^((?:http|https|ftp|news):\/\/)?(.*)$/,c=/^(_(?:self|top|parent|blank))$/,h=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,d=/^javascript:([^(]+)\(([^)]+)\)$/,p=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,f=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,m={id:"advId",dir:"advLangDir",accessKey:"advAccessKey",name:"advName",lang:"advLangCode",tabindex:"advTabIndex",title:"advTitle",type:"advContentType","class":"advCSSClasses",charset:"advCharset",style:"advStyles",rel:"advRel"};CKEDITOR.plugins.link={getSelectedLink:function(e){var t=e.getSelection(),i=t.getSelectedElement();return i&&i.is("a")?i:(t=t.getRanges()[0])?(t.shrink(CKEDITOR.SHRINK_TEXT),e.elementPath(t.getCommonAncestor()).contains("a",1)):null},getEditorAnchors:function(e){for(var t,i=e.editable(),n=i.isInline()&&!e.plugins.divarea?e.document:i,i=n.getElementsByTag("a"),n=n.getElementsByTag("img"),r=[],o=0;t=i.getItem(o++);)(t.data("cke-saved-name")||t.hasAttribute("name"))&&r.push({name:t.data("cke-saved-name")||t.getAttribute("name"),id:t.getAttribute("id")});for(o=0;t=n.getItem(o++);)(t=this.tryRestoreFakeAnchor(e,t))&&r.push({name:t.getAttribute("name"),id:t.getAttribute("id")});return r},fakeAnchor:!0,tryRestoreFakeAnchor:function(e,t){if(t&&t.data("cke-real-element-type")&&"anchor"==t.data("cke-real-element-type")){var i=e.restoreRealElement(t);if(i.data("cke-saved-name"))return i}},parseLinkAttributes:function(e,t){var i,n=t&&(t.data("cke-saved-href")||t.getAttribute("href"))||"",g=e.plugins.link.compiledProtectionFunction,y=e.config.emailProtection,v={};if(n.match(r)&&("encode"==y?n=n.replace(h,function(e,t,i){return"mailto:"+String.fromCharCode.apply(String,t.split(","))+(i&&i.replace(/\\'/g,"'"))}):y&&n.replace(d,function(e,t,i){if(t==g.name){v.type="email";for(var n,r,e=v.email={},t=/(^')|('$)/g,i=i.match(/[^,\s]+/g),o=i.length,s=0;s<o;s++)n=decodeURIComponent,r=i[s].replace(t,"").replace(/\\'/g,"'"),r=n(r),n=g.params[s].toLowerCase(),e[n]=r;e.address=[e.name,e.domain].join("@")}})),!v.type)if(y=n.match(l))v.type="anchor",v.anchor={},v.anchor.name=v.anchor.id=y[1];else if(y=n.match(o)){i=n.match(s),n=n.match(a),v.type="email";var E=v.email={};E.address=y[1],i&&(E.subject=decodeURIComponent(i[1])),n&&(E.body=decodeURIComponent(n[1]))}else n&&(i=n.match(u))&&(v.type="url",v.url={},v.url.protocol=i[1],v.url.url=i[2]);if(t){if(n=t.getAttribute("target"))v.target={type:n.match(c)?n:"frame",name:n};else if(n=(n=t.data("cke-pa-onclick")||t.getAttribute("onclick"))&&n.match(p))for(v.target={type:"popup",name:n[1]};y=f.exec(n[2]);)"yes"!=y[2]&&"1"!=y[2]||y[1]in{height:1,width:1,top:1,left:1}?isFinite(y[2])&&(v.target[y[1]]=y[2]):v.target[y[1]]=!0;var T,n={};for(T in m)(y=t.getAttribute(T))&&(n[m[T]]=y);(T=t.data("cke-saved-name")||n.advName)&&(n.advName=T),CKEDITOR.tools.isEmpty(n)||(v.advanced=n)}return v},getLinkAttributes:function(n,r){var o=n.config.emailProtection||"",s={};switch(r.type){case"url":var o=r.url&&void 0!==r.url.protocol?r.url.protocol:"http://",a=r.url&&CKEDITOR.tools.trim(r.url.url)||"";s["data-cke-saved-href"]=0===a.indexOf("/")?a:o+a;break;case"anchor":o=r.anchor&&r.anchor.id,s["data-cke-saved-href"]="#"+(r.anchor&&r.anchor.name||o||"");break;case"email":var l=r.email,a=l.address;switch(o){case"":case"encode":var u=encodeURIComponent(l.subject||""),c=encodeURIComponent(l.body||""),l=[];u&&l.push("subject="+u),c&&l.push("body="+c),l=l.length?"?"+l.join("&"):"","encode"==o?(o=["javascript:void(location.href='mailto:'+",t(a)],l&&o.push("+'",e(l),"'"),o.push(")")):o=["mailto:",a,l];break;default:o=a.split("@",2),l.name=o[0],l.domain=o[1],o=["javascript:",i(n,l)]}s["data-cke-saved-href"]=o.join("")}if(r.target)if("popup"==r.target.type){for(var o=["window.open(this.href, '",r.target.name||"","', '"],h=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"],a=h.length,u=function(e){r.target[e]&&h.push(e+"="+r.target[e])},l=0;l<a;l++)h[l]=h[l]+(r.target[h[l]]?"=yes":"=no");u("width"),u("left"),u("height"),u("top"),o.push(h.join(","),"'); return false;"),s["data-cke-pa-onclick"]=o.join("")}else"notSet"!=r.target.type&&r.target.name&&(s.target=r.target.name);if(r.advanced){for(var d in m)(o=r.advanced[m[d]])&&(s[d]=o);s.name&&(s["data-cke-saved-name"]=s.name)}s["data-cke-saved-href"]&&(s.href=s["data-cke-saved-href"]),d={target:1,onclick:1,"data-cke-pa-onclick":1,"data-cke-saved-name":1},r.advanced&&CKEDITOR.tools.extend(d,m);for(var p in s)delete d[p];return{set:s,removed:CKEDITOR.tools.objectKeys(d)}}},CKEDITOR.unlinkCommand=function(){},CKEDITOR.unlinkCommand.prototype={exec:function(e){var t=new CKEDITOR.style({element:"a",type:CKEDITOR.STYLE_INLINE,alwaysRemoveElement:1});e.removeStyle(t)},refresh:function(e,t){var i=t.lastElement&&t.lastElement.getAscendant("a",!0);i&&"a"==i.getName()&&i.getAttribute("href")&&i.getChildCount()?this.setState(CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1,requiredContent:"a[href]"},CKEDITOR.removeAnchorCommand=function(){},CKEDITOR.removeAnchorCommand.prototype={exec:function(e){var t,i=e.getSelection(),n=i.createBookmarks();i&&(t=i.getSelectedElement())&&(t.getChildCount()?t.is("a"):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t))?t.remove(1):(t=CKEDITOR.plugins.link.getSelectedLink(e))&&(t.hasAttribute("href")?(t.removeAttributes({name:1,"data-cke-saved-name":1}),t.removeClass("cke_anchor")):t.remove(1)),i.selectBookmarks(n)},requiredContent:"a[name]"},CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0})}(),function(){function e(e,t,i){
return c(t)&&c(i)&&i.equals(t.getNext(function(e){return!(X(e)||q(e)||h(e))}))}function t(e){this.upper=e[0],this.lower=e[1],this.set.apply(this,e.slice(2))}function i(e){var t=e.element;if(t&&c(t)&&(t=t.getAscendant(e.triggers,!0))&&e.editable.contains(t)){var i=o(t);if("true"==i.getAttribute("contenteditable"))return t;if(i.is(e.triggers))return i}return null}function n(e,t,i){return E(e,t),E(e,i),e=t.size.bottom,i=i.size.top,e&&i?0|(e+i)/2:e||i}function r(e,t,i){return t=t[i?"getPrevious":"getNext"](function(t){return t&&t.type==CKEDITOR.NODE_TEXT&&!X(t)||c(t)&&!h(t)&&!u(e,t)})}function o(e,t){if(e.data("cke-editable"))return null;for(t||(e=e.getParent());e&&!e.data("cke-editable");){if(e.hasAttribute("contenteditable"))return e;e=e.getParent()}return null}function s(e){var t=e.doc,i=w('<span contenteditable="false" style="'+G+"position:absolute;border-top:1px dashed "+e.boxColor+'"></span>',t),n=CKEDITOR.getUrl(this.path+"images/"+(R.hidpi?"hidpi/":"")+"icon"+(e.rtl?"-rtl":"")+".png");for(O(i,{attach:function(){return this.wrap.getParent()||this.wrap.appendTo(e.editable,!0),this},lineChildren:[O(w('<span title="'+e.editor.lang.magicline.title+'" contenteditable="false">&#8629;</span>',t),{base:G+"height:17px;width:17px;"+(e.rtl?"left":"right")+":17px;background:url("+n+") center no-repeat "+e.boxColor+";cursor:pointer;"+(R.hc?"font-size: 15px;line-height:14px;border:1px solid #fff;text-align:center;":"")+(R.hidpi?"background-size: 9px 10px;":""),looks:["top:-8px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px",1),"top:-17px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px 2px 0px 0px",1),"top:-1px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","0px 0px 2px 2px",1)]}),O(w(W,t),{base:$+"left:0px;border-left-color:"+e.boxColor+";",looks:["border-width:8px 0 8px 8px;top:-8px","border-width:8px 0 0 8px;top:-8px","border-width:0 0 8px 8px;top:0px"]}),O(w(W,t),{base:$+"right:0px;border-right-color:"+e.boxColor+";",looks:["border-width:8px 8px 8px 0;top:-8px","border-width:8px 8px 0 0;top:-8px","border-width:0 8px 8px 0;top:0px"]})],detach:function(){return this.wrap.getParent()&&this.wrap.remove(),this},mouseNear:function(){E(e,this);var t=e.holdDistance,i=this.size;return!!(i&&e.mouse.y>i.top-t&&e.mouse.y<i.bottom+t&&e.mouse.x>i.left-t&&e.mouse.x<i.right+t)},place:function(){var t=e.view,i=e.editable,n=e.trigger,r=n.upper,o=n.lower,s=r||o,a=s.getParent(),l={};this.trigger=n,r&&E(e,r,!0),o&&E(e,o,!0),E(e,a,!0),e.inInlineMode&&T(e,!0),a.equals(i)?(l.left=t.scroll.x,l.right=-t.scroll.x,l.width=""):(l.left=s.size.left-s.size.margin.left+t.scroll.x-(e.inInlineMode?t.editable.left+t.editable.border.left:0),l.width=s.size.outerWidth+s.size.margin.left+s.size.margin.right+t.scroll.x,l.right=""),r&&o?l.top=r.size.margin.bottom===o.size.margin.top?0|r.size.bottom+r.size.margin.bottom/2:r.size.margin.bottom<o.size.margin.top?r.size.bottom+r.size.margin.bottom:r.size.bottom+r.size.margin.bottom-o.size.margin.top:r?o||(l.top=r.size.bottom+r.size.margin.bottom):l.top=o.size.top-o.size.margin.top,n.is(P)||l.top>t.scroll.y-15&&l.top<t.scroll.y+5?(l.top=e.inInlineMode?0:t.scroll.y,this.look(P)):n.is(k)||l.top>t.pane.bottom-5&&l.top<t.pane.bottom+15?(l.top=e.inInlineMode?t.editable.height+t.editable.padding.top+t.editable.padding.bottom:t.pane.bottom-1,this.look(k)):(e.inInlineMode&&(l.top=l.top-(t.editable.top+t.editable.border.top)),this.look(H)),e.inInlineMode&&(l.top--,l.top=l.top+t.editable.scroll.top,l.left=l.left+t.editable.scroll.left);for(var u in l)l[u]=CKEDITOR.tools.cssLength(l[u]);this.setStyles(l)},look:function(e){if(this.oldLook!=e){for(var t,i=this.lineChildren.length;i--;)(t=this.lineChildren[i]).setAttribute("style",t.base+t.looks[0|e/2]);this.oldLook=e}},wrap:new x("span",e.doc)}),t=i.lineChildren.length;t--;)i.lineChildren[t].appendTo(i);i.look(H),i.appendTo(i.wrap),i.unselectable(),i.lineChildren[0].on("mouseup",function(t){i.detach(),a(e,function(t){var i=e.line.trigger;t[i.is(I)?"insertBefore":"insertAfter"](i.is(I)?i.lower:i.upper)},!0),e.editor.focus(),!R.ie&&e.enterMode!=CKEDITOR.ENTER_BR&&e.hotNode.scrollIntoView(),t.data.preventDefault(!0)}),i.on("mousedown",function(e){e.data.preventDefault(!0)}),e.line=i}function a(e,t,i){var n,r=new CKEDITOR.dom.range(e.doc),s=e.editor;R.ie&&e.enterMode==CKEDITOR.ENTER_BR?n=e.doc.createText(F):(n=(n=o(e.element,!0))&&n.data("cke-enter-mode")||e.enterMode,n=new x(_[n],e.doc),n.is("br")||e.doc.createText(F).appendTo(n)),i&&s.fire("saveSnapshot"),t(n),r.moveToPosition(n,CKEDITOR.POSITION_AFTER_START),s.getSelection().selectRanges([r]),e.hotNode=n,i&&s.fire("saveSnapshot")}function l(e,t){return{canUndo:!0,modes:{wysiwyg:1},exec:function(){function n(i){var n=R.ie&&R.version<9?" ":F,r=e.hotNode&&e.hotNode.getText()==n&&e.element.equals(e.hotNode)&&e.lastCmdDirection===!!t;a(e,function(n){r&&e.hotNode&&e.hotNode.remove(),n[t?"insertAfter":"insertBefore"](i),n.setAttributes({"data-cke-magicline-hot":1,"data-cke-magicline-dir":!!t}),e.lastCmdDirection=!!t}),!R.ie&&e.enterMode!=CKEDITOR.ENTER_BR&&e.hotNode.scrollIntoView(),e.line.detach()}return function(s){var a,s=s.getSelection().getStartElement(),s=s.getAscendant(U,1);if(!f(e,s)&&s&&!s.equals(e.editable)&&!s.contains(e.editable)){(a=o(s))&&"false"==a.getAttribute("contenteditable")&&(s=a),e.element=s,a=r(e,s,!t);var l;c(a)&&a.is(e.triggers)&&a.is(z)&&(!r(e,a,!t)||(l=r(e,a,!t))&&c(l)&&l.is(e.triggers))?n(a):(l=i(e,s),c(l)&&(r(e,l,!t)?(s=r(e,l,!t))&&c(s)&&s.is(e.triggers)&&n(l):n(l)))}}}()}}function u(e,t){if(!t||t.type!=CKEDITOR.NODE_ELEMENT||!t.$)return!1;var i=e.line;return i.wrap.equals(t)||i.wrap.contains(t)}function c(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&e.$}function h(e){if(!c(e))return!1;var t;return(t=d(e))||(c(e)?(t={left:1,right:1,center:1},t=!(!t[e.getComputedStyle("float")]&&!t[e.getAttribute("align")])):t=!1),t}function d(e){return!!{absolute:1,fixed:1}[e.getComputedStyle("position")]}function p(e,t){return c(t)?t.is(e.triggers):null}function f(e,t){if(!t)return!1;for(var i=t.getParents(1),n=i.length;n--;)for(var r=e.tabuList.length;r--;)if(i[n].hasAttribute(e.tabuList[r]))return!0;return!1}function m(e,t,i){return!!(t=t[i?"getLast":"getFirst"](function(t){return e.isRelevant(t)&&!t.is(K)}))&&(E(e,t),i?t.size.top>e.mouse.y:t.size.bottom<e.mouse.y)}function g(e){var i=e.editable,n=e.mouse,r=e.view,o=e.triggerOffset;T(e);var s=n.y>(e.inInlineMode?r.editable.top+r.editable.height/2:Math.min(r.editable.height,r.pane.height)/2),i=i[s?"getLast":"getFirst"](function(e){return!(X(e)||q(e))});return i?(u(e,i)&&(i=e.line.wrap[s?"getPrevious":"getNext"](function(e){return!(X(e)||q(e))})),c(i)&&!h(i)&&p(e,i)?(E(e,i),!s&&i.size.top>=0&&n.y>0&&n.y<i.size.top+o?(e=e.inInlineMode||0===r.scroll.y?P:H,new t([null,i,I,A,e])):s&&i.size.bottom<=r.pane.height&&n.y>i.size.bottom-o&&n.y<r.pane.height?(e=e.inInlineMode||i.size.bottom>r.pane.height-o&&i.size.bottom<r.pane.height?k:H,new t([i,null,D,A,e])):null):null):null}function y(e){var n=e.mouse,o=e.view,s=e.triggerOffset,a=i(e);if(!a)return null;E(e,a);var l,u,s=Math.min(s,0|a.size.outerHeight/2),d=[];if(n.y>a.size.top-1&&n.y<a.size.top+s)u=!1;else{if(!(n.y>a.size.bottom-s&&n.y<a.size.bottom+1))return null;u=!0}if(h(a)||m(e,a,u)||a.getParent().is(B))return null;var f=r(e,a,!u);if(f){if(f&&f.type==CKEDITOR.NODE_TEXT)return null;if(c(f)){if(h(f)||!p(e,f)||f.getParent().is(B))return null;d=[f,a][u?"reverse":"concat"]().concat([M,A])}}else a.equals(e.editable[u?"getLast":"getFirst"](e.isRelevant))?(T(e),u&&n.y>a.size.bottom-s&&n.y<o.pane.height&&a.size.bottom>o.pane.height-s&&a.size.bottom<o.pane.height?l=k:n.y>0&&n.y<a.size.top+s&&(l=P)):l=H,d=[null,a][u?"reverse":"concat"]().concat([u?D:I,A,l,a.equals(e.editable[u?"getLast":"getFirst"](e.isRelevant))?u?k:P:H]);return 0 in d?new t(d):null}function v(e,t,i,n){for(var r=function(){var i=R.ie?t.$.currentStyle:e.win.$.getComputedStyle(t.$,"");return R.ie?function(e){return i[CKEDITOR.tools.cssStyleToDomStyle(e)]}:function(e){return i.getPropertyValue(e)}}(),o=t.getDocumentPosition(),s={},a={},l={},u={},c=Y.length;c--;)s[Y[c]]=parseInt(r("border-"+Y[c]+"-width"),10)||0,l[Y[c]]=parseInt(r("padding-"+Y[c]),10)||0,a[Y[c]]=parseInt(r("margin-"+Y[c]),10)||0;return(!i||n)&&b(e,n),u.top=o.y-(i?0:e.view.scroll.y),u.left=o.x-(i?0:e.view.scroll.x),u.outerWidth=t.$.offsetWidth,u.outerHeight=t.$.offsetHeight,u.height=u.outerHeight-(l.top+l.bottom+s.top+s.bottom),u.width=u.outerWidth-(l.left+l.right+s.left+s.right),u.bottom=u.top+u.outerHeight,u.right=u.left+u.outerWidth,e.inInlineMode&&(u.scroll={top:t.$.scrollTop,left:t.$.scrollLeft}),O({border:s,padding:l,margin:a,ignoreScroll:i},u,!0)}function E(e,t,i){if(!c(t))return t.size=null;if(t.size){if(t.size.ignoreScroll==i&&t.size.date>new Date-V)return null}else t.size={};return O(t.size,v(e,t,i),{date:+new Date},!0)}function T(e,t){e.view.editable=v(e,e.editable,t,!0)}function b(e,t){e.view||(e.view={});var i=e.view;if(t||!(i&&i.date>new Date-V)){var n=e.win,i=n.getScrollPosition(),n=n.getViewPaneSize();O(e.view,{scroll:{x:i.x,y:i.y,width:e.doc.$.documentElement.scrollWidth-n.width,height:e.doc.$.documentElement.scrollHeight-n.height},pane:{width:n.width,height:n.height,bottom:n.height+i.y},date:+new Date},!0)}}function C(e,i,n,r){for(var o=r,s=r,a=0,l=!1,u=!1,c=e.view.pane.height,h=e.mouse;h.y+a<c&&h.y-a>0&&(l||(l=i(o,r)),u||(u=i(s,r)),!l&&h.y-a>0&&(o=n(e,{x:h.x,y:h.y-a})),!u&&h.y+a<c&&(s=n(e,{x:h.x,y:h.y+a})),!l||!u);)a+=2;return new t([o,s,null,null])}CKEDITOR.plugins.add("magicline",{init:function(e){var n,o,p,m=e.config,E=m.magicline_triggerOffset||30,C={editor:e,enterMode:m.enterMode,triggerOffset:E,holdDistance:0|E*(m.magicline_holdDistance||.5),boxColor:m.magicline_color||"#ff0000",rtl:"rtl"==m.contentsLangDirection,tabuList:["data-cke-hidden-sel"].concat(m.magicline_tabuList||[]),triggers:m.magicline_everywhere?U:{table:1,hr:1,div:1,ul:1,ol:1,dl:1,form:1,blockquote:1}};C.isRelevant=function(e){return c(e)&&!u(C,e)&&!h(e)},e.on("contentDom",function(){var c=e.editable(),h=e.document,E=e.window;O(C,{editable:c,inInlineMode:c.isInline(),doc:h,win:E,hotNode:null},!0),C.boundary=C.inInlineMode?C.editable:C.doc.getDocumentElement(),c.is(S.$inline)||(C.inInlineMode&&!d(c)&&c.setStyles({position:"relative",top:null,left:null}),s.call(this,C),b(C),c.attachListener(e,"beforeUndoImage",function(){C.line.detach()}),c.attachListener(e,"beforeGetData",function(){C.line.wrap.getParent()&&(C.line.detach(),e.once("getData",function(){C.line.attach()},null,null,1e3))},null,null,0),c.attachListener(C.inInlineMode?h:h.getWindow().getFrame(),"mouseout",function(t){if("wysiwyg"==e.mode)if(C.inInlineMode){var i=t.data.$.clientX,t=t.data.$.clientY;b(C),T(C,!0);var n=C.view.editable,r=C.view.scroll;i>n.left-r.x&&i<n.right-r.x&&t>n.top-r.y&&t<n.bottom-r.y||(clearTimeout(p),p=null,C.line.detach())}else clearTimeout(p),p=null,C.line.detach()}),c.attachListener(c,"keyup",function(){C.hiddenMode=0}),c.attachListener(c,"keydown",function(t){if("wysiwyg"==e.mode)switch(t.data.getKeystroke()){case 2228240:case 16:C.hiddenMode=1,C.line.detach()}}),c.attachListener(C.inInlineMode?c:h,"mousemove",function(t){if(o=!0,"wysiwyg"==e.mode&&!e.readOnly&&!p){var i={x:t.data.$.clientX,y:t.data.$.clientY};p=setTimeout(function(){C.mouse=i,p=C.trigger=null,b(C),o&&!C.hiddenMode&&e.focusManager.hasFocus&&!C.line.mouseNear()&&(C.element=j(C,!0))&&((C.trigger=g(C)||y(C)||Z(C))&&!f(C,C.trigger.upper||C.trigger.lower)?C.line.attach().place():(C.trigger=null,C.line.detach()),o=!1)},30)}}),c.attachListener(E,"scroll",function(){"wysiwyg"==e.mode&&(C.line.detach(),R.webkit&&(C.hiddenMode=1,clearTimeout(n),n=setTimeout(function(){C.mouseDown||(C.hiddenMode=0)},50)))}),c.attachListener(L?h:E,"mousedown",function(){"wysiwyg"==e.mode&&(C.line.detach(),C.hiddenMode=1,C.mouseDown=1)}),c.attachListener(L?h:E,"mouseup",function(){C.hiddenMode=0,C.mouseDown=0}),e.addCommand("accessPreviousSpace",l(C)),e.addCommand("accessNextSpace",l(C,!0)),e.setKeystroke([[m.magicline_keystrokePrevious,"accessPreviousSpace"],[m.magicline_keystrokeNext,"accessNextSpace"]]),e.on("loadSnapshot",function(){var t,i,n,r;for(r in{p:1,br:1,div:1})for(t=e.document.getElementsByTag(r),n=t.count();n--;)if((i=t.getItem(n)).data("cke-magicline-hot"))return C.hotNode=i,void(C.lastCmdDirection="true"===i.data("cke-magicline-dir"))}),this.backdoor={accessFocusSpace:a,boxTrigger:t,isLine:u,getAscendantTrigger:i,getNonEmptyNeighbour:r,getSize:v,that:C,triggerEdge:y,triggerEditable:g,triggerExpand:Z})},this)}});var O=CKEDITOR.tools.extend,x=CKEDITOR.dom.element,w=x.createFromHtml,R=CKEDITOR.env,L=CKEDITOR.env.ie&&CKEDITOR.env.version<9,S=CKEDITOR.dtd,_={},I=128,D=64,M=32,A=16,N=8,P=4,k=2,H=1,F=" ",B=S.$listItem,K=S.$tableContent,z=O({},S.$nonEditable,S.$empty),U=S.$block,V=100,G="width:0px;height:0px;padding:0px;margin:0px;display:block;z-index:9999;color:#fff;position:absolute;font-size: 0px;line-height:0px;",$=G+"border-color:transparent;display:block;border-style:solid;",W="<span>"+F+"</span>";_[CKEDITOR.ENTER_BR]="br",_[CKEDITOR.ENTER_P]="p",_[CKEDITOR.ENTER_DIV]="div",t.prototype={set:function(e,t,i){return this.properties=e+t+(i||H),this},is:function(e){return(this.properties&e)==e}};var j=function(){function e(e,t){var i=e.$.elementFromPoint(t.x,t.y);return i&&i.nodeType?new CKEDITOR.dom.element(i):null}return function(t,i,n){if(!t.mouse)return null;var r=t.doc,o=t.line.wrap,n=n||t.mouse,s=e(r,n);return i&&u(t,s)&&(o.hide(),s=e(r,n),o.show()),!s||s.type!=CKEDITOR.NODE_ELEMENT||!s.$||R.ie&&R.version<9&&!t.boundary.equals(s)&&!t.boundary.contains(s)?null:s}}(),X=CKEDITOR.dom.walker.whitespaces(),q=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_COMMENT),Z=function(){function t(t){var r,o,s,a=t.element;if(!c(a)||a.contains(t.editable)||a.isReadOnly())return null;if(s=C(t,function(e,t){return!t.equals(e)},function(e,t){return j(e,!0,t)},a),r=s.upper,o=s.lower,e(t,r,o))return s.set(M,N);if(r&&a.contains(r))for(;!r.getParent().equals(a);)r=r.getParent();else r=a.getFirst(function(e){return i(t,e)});if(o&&a.contains(o))for(;!o.getParent().equals(a);)o=o.getParent();else o=a.getLast(function(e){return i(t,e)});if(!r||!o)return null;if(E(t,r),E(t,o),!(t.mouse.y>r.size.top&&t.mouse.y<o.size.bottom))return null;for(var l,u,h,d,a=Number.MAX_VALUE;o&&!o.equals(r)&&(u=r.getNext(t.isRelevant));)l=Math.abs(n(t,r,u)-t.mouse.y),l<a&&(a=l,h=r,d=u),r=u,E(t,r);return h&&d&&t.mouse.y>h.size.top&&t.mouse.y<d.size.bottom?(s.upper=h,s.lower=d,s.set(M,N)):null}function i(e,t){return!(t&&t.type==CKEDITOR.NODE_TEXT||q(t)||h(t)||u(e,t)||t.type==CKEDITOR.NODE_ELEMENT&&t.$&&t.is("br"))}return function(i){var n,r=t(i);if(n=r){n=r.upper;var o=r.lower;n=!(!n||!o||h(o)||h(n)||o.equals(n)||n.equals(o)||o.contains(n)||n.contains(o))&&!!(p(i,n)&&p(i,o)&&e(i,n,o))}return n?r:null}}(),Y=["top","left","right","bottom"]}(),CKEDITOR.config.magicline_keystrokePrevious=CKEDITOR.CTRL+CKEDITOR.SHIFT+51,CKEDITOR.config.magicline_keystrokeNext=CKEDITOR.CTRL+CKEDITOR.SHIFT+52,function(){function e(e){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||"form"!=e.getName())return[];for(var t=[],i=["style","className"],n=0;n<i.length;n++){var r=e.$.elements.namedItem(i[n]);r&&(r=new CKEDITOR.dom.element(r),t.push([r,r.nextSibling]),r.remove())}return t}function t(e,t){if(e&&e.type==CKEDITOR.NODE_ELEMENT&&"form"==e.getName()&&t.length>0)for(var i=t.length-1;i>=0;i--){var n=t[i][0],r=t[i][1];r?n.insertBefore(r):n.appendTo(e)}}function i(i,n){var r=e(i),o={},s=i.$;return n||(o["class"]=s.className||"",s.className=""),o.inline=s.style.cssText||"",n||(s.style.cssText="position: static; overflow: visible"),t(r),o}function n(i,n){var r=e(i),o=i.$;"class"in n&&(o.className=n["class"]),"inline"in n&&(o.style.cssText=n.inline),t(r)}function r(e){if(!e.editable().isInline()){var t,i=CKEDITOR.instances;for(t in i){var n=i[t];"wysiwyg"!=n.mode||n.readOnly||(n=n.document.getBody(),n.setAttribute("contentEditable",!1),n.setAttribute("contentEditable",!0))}e.editable().hasFocus&&(e.toolbox.focus(),e.focus())}}CKEDITOR.plugins.add("maximize",{init:function(e){function t(){var t=c.getViewPaneSize();e.resize(t.width,t.height,null,!0)}if(e.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var o,s,a,l=e.lang,u=CKEDITOR.document,c=u.getWindow(),h=CKEDITOR.TRISTATE_OFF;e.addCommand("maximize",{modes:{wysiwyg:!CKEDITOR.env.iOS,source:!CKEDITOR.env.iOS},readOnly:1,editorFocus:!1,exec:function(){var d=e.container.getFirst(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_inner")}),p=e.ui.space("contents");if("wysiwyg"==e.mode){var f=e.getSelection();o=f&&f.getRanges(),s=c.getScrollPosition()}else{var m=e.editable().$;o=!CKEDITOR.env.ie&&[m.selectionStart,m.selectionEnd],s=[m.scrollLeft,m.scrollTop]}if(this.state==CKEDITOR.TRISTATE_OFF){for(c.on("resize",t),a=c.getScrollPosition(),f=e.container;f=f.getParent();)f.setCustomData("maximize_saved_styles",i(f)),f.setStyle("z-index",e.config.baseFloatZIndex-5);p.setCustomData("maximize_saved_styles",i(p,!0)),d.setCustomData("maximize_saved_styles",i(d,!0)),p={overflow:CKEDITOR.env.webkit?"":"hidden",width:0,height:0},u.getDocumentElement().setStyles(p),!CKEDITOR.env.gecko&&u.getDocumentElement().setStyle("position","fixed"),(!CKEDITOR.env.gecko||!CKEDITOR.env.quirks)&&u.getBody().setStyles(p),CKEDITOR.env.ie?setTimeout(function(){c.$.scrollTo(0,0)},0):c.$.scrollTo(0,0),d.setStyle("position",CKEDITOR.env.gecko&&CKEDITOR.env.quirks?"fixed":"absolute"),d.$.offsetLeft,d.setStyles({"z-index":e.config.baseFloatZIndex-5,left:"0px",top:"0px"}),d.addClass("cke_maximized"),t(),p=d.getDocumentPosition(),d.setStyles({left:-1*p.x+"px",top:-1*p.y+"px"}),CKEDITOR.env.gecko&&r(e)}else if(this.state==CKEDITOR.TRISTATE_ON){for(c.removeListener("resize",t),p=[p,d],f=0;f<p.length;f++)n(p[f],p[f].getCustomData("maximize_saved_styles")),p[f].removeCustomData("maximize_saved_styles");for(f=e.container;f=f.getParent();)n(f,f.getCustomData("maximize_saved_styles")),f.removeCustomData("maximize_saved_styles");CKEDITOR.env.ie?setTimeout(function(){c.$.scrollTo(a.x,a.y)},0):c.$.scrollTo(a.x,a.y),d.removeClass("cke_maximized"),CKEDITOR.env.webkit&&(d.setStyle("display","inline"),setTimeout(function(){d.setStyle("display","block")},0)),e.fire("resize")}this.toggleState(),(f=this.uiItems[0])&&(p=this.state==CKEDITOR.TRISTATE_OFF?l.maximize.maximize:l.maximize.minimize,f=CKEDITOR.document.getById(f._.id),f.getChild(1).setHtml(p),f.setAttribute("title",p),f.setAttribute("href",'javascript:void("'+p+'");')),"wysiwyg"==e.mode?o?(CKEDITOR.env.gecko&&r(e),e.getSelection().selectRanges(o),(m=e.getSelection().getStartElement())&&m.scrollIntoView(!0)):c.$.scrollTo(s.x,s.y):(o&&(m.selectionStart=o[0],m.selectionEnd=o[1]),m.scrollLeft=s[0],m.scrollTop=s[1]),o=s=null,h=this.state,e.fire("maximize",this.state)},canUndo:!1}),e.ui.addButton&&e.ui.addButton("Maximize",{label:l.maximize.maximize,command:"maximize",toolbar:"tools,10"}),e.on("mode",function(){var t=e.getCommand("maximize");t.setState(t.state==CKEDITOR.TRISTATE_DISABLED?CKEDITOR.TRISTATE_DISABLED:h)},null,null,100)}}})}(),function(){function e(e,t,i){var n=CKEDITOR.cleanWord;return n?i():(e=CKEDITOR.getUrl(e.config.pasteFromWordCleanupFile||t+"filter/default.js"),CKEDITOR.scriptLoader.load(e,i,null,!0)),!n}function t(e){e.data.type="html"}CKEDITOR.plugins.add("pastefromword",{requires:"clipboard",init:function(i){var n=0,r=this.path;i.addCommand("pastefromword",{canUndo:!1,async:!0,exec:function(e){var i=this;n=1,e.once("beforePaste",t),e.getClipboardData({title:e.lang.pastefromword.title},function(t){t&&e.fire("paste",{type:"html",dataValue:t.dataValue}),e.fire("afterCommandExec",{name:"pastefromword",command:i,returnValue:!!t})})}}),i.ui.addButton&&i.ui.addButton("PasteFromWord",{label:i.lang.pastefromword.toolbar,command:"pastefromword",toolbar:"clipboard,50"}),i.on("pasteState",function(e){i.getCommand("pastefromword").setState(e.data)}),i.on("paste",function(t){var o=t.data,s=o.dataValue;if(s&&(n||/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(s))){var a=e(i,r,function(){a?i.fire("paste",o):(!i.config.pasteFromWordPromptCleanup||n||confirm(i.lang.pastefromword.confirmCleanup))&&(o.dataValue=CKEDITOR.cleanWord(s,i)),n=0});a&&t.cancel()}},null,null,3)}})}(),function(){var e={canUndo:!1,async:!0,exec:function(t){t.getClipboardData({title:t.lang.pastetext.title},function(i){i&&t.fire("paste",{type:"text",dataValue:i.dataValue}),t.fire("afterCommandExec",{name:"pastetext",command:e,returnValue:!!i})})}};CKEDITOR.plugins.add("pastetext",{requires:"clipboard",init:function(t){t.addCommand("pastetext",e),t.ui.addButton&&t.ui.addButton("PasteText",{label:t.lang.pastetext.button,command:"pastetext",toolbar:"clipboard,40"}),t.config.forcePasteAsPlainText&&t.on("beforePaste",function(e){"html"!=e.data.type&&(e.data.type="text")}),t.on("pasteState",function(e){t.getCommand("pastetext").setState(e.data)})}})}(),CKEDITOR.plugins.add("removeformat",{init:function(e){e.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),e.ui.addButton&&e.ui.addButton("RemoveFormat",{label:e.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(e){for(var t,i=e._.removeFormatRegex||(e._.removeFormatRegex=RegExp("^(?:"+e.config.removeFormatTags.replace(/,/g,"|")+")$","i")),n=e._.removeAttributes||(e._.removeAttributes=e.config.removeFormatAttributes.split(",")),r=CKEDITOR.plugins.removeformat.filter,o=e.getSelection().getRanges(),s=o.createIterator(),a=function(e){return e.type==CKEDITOR.NODE_ELEMENT};t=s.getNextRange();){t.collapsed||t.enlarge(CKEDITOR.ENLARGE_ELEMENT);var l=t.createBookmark(),u=l.startNode,c=l.endNode,h=function(t){for(var n,o=e.elementPath(t),s=o.elements,a=1;(n=s[a])&&(!n.equals(o.block)&&!n.equals(o.blockLimit));a++)i.test(n.getName())&&r(e,n)&&t.breakParent(n)};if(h(u),c)for(h(c),u=u.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);u&&!u.equals(c);)if(u.isReadOnly()){if(u.getPosition(c)&CKEDITOR.POSITION_CONTAINS)break;u=u.getNext(a)}else h=u.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),"img"==u.getName()&&u.data("cke-realelement")||!r(e,u)||(i.test(u.getName())?u.remove(1):(u.removeAttributes(n),e.fire("removeFormatCleanup",u))),u=h;t.moveToBookmark(l)}e.forceNextSelectionCheck(),e.getSelection().selectRanges(o)}}},filter:function(e,t){for(var i=e._.removeFormatFilters||[],n=0;n<i.length;n++)if(i[n](t)===!1)return!1;return!0}},CKEDITOR.editor.prototype.addRemoveFormatFilter=function(e){this._.removeFormatFilters||(this._.removeFormatFilters=[]),this._.removeFormatFilters.push(e)},CKEDITOR.config.removeFormatTags="b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign",CKEDITOR.plugins.add("resize",{init:function(e){function t(t){var i=n,l=r,c=i+(t.data.$.screenX-o)*("rtl"==u?-1:1),t=l+(t.data.$.screenY-s);h&&(i=Math.max(a.resize_minWidth,Math.min(c,a.resize_maxWidth))),d&&(l=Math.max(a.resize_minHeight,Math.min(t,a.resize_maxHeight))),e.resize(h?i:null,l)}function i(){CKEDITOR.document.removeListener("mousemove",t),CKEDITOR.document.removeListener("mouseup",i),e.document&&(e.document.removeListener("mousemove",t),e.document.removeListener("mouseup",i))}var n,r,o,s,a=e.config,l=e.ui.spaceId("resizer"),u=e.element?e.element.getDirection(1):"ltr";if(!a.resize_dir&&(a.resize_dir="vertical"),void 0===a.resize_maxWidth&&(a.resize_maxWidth=3e3),void 0===a.resize_maxHeight&&(a.resize_maxHeight=3e3),void 0===a.resize_minWidth&&(a.resize_minWidth=750),void 0===a.resize_minHeight&&(a.resize_minHeight=250),a.resize_enabled!==!1){var c=null,h=("both"==a.resize_dir||"horizontal"==a.resize_dir)&&a.resize_minWidth!=a.resize_maxWidth,d=("both"==a.resize_dir||"vertical"==a.resize_dir)&&a.resize_minHeight!=a.resize_maxHeight,p=CKEDITOR.tools.addFunction(function(l){c||(c=e.getResizable()),n=c.$.offsetWidth||0,r=c.$.offsetHeight||0,o=l.screenX,s=l.screenY,a.resize_minWidth>n&&(a.resize_minWidth=n),a.resize_minHeight>r&&(a.resize_minHeight=r),CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",i),e.document&&(e.document.on("mousemove",t),e.document.on("mouseup",i)),l.preventDefault&&l.preventDefault()});e.on("destroy",function(){CKEDITOR.tools.removeFunction(p)}),e.on("uiSpace",function(t){if("bottom"==t.data.space){var i="";h&&!d&&(i=" cke_resizer_horizontal"),!h&&d&&(i=" cke_resizer_vertical");var n='<span id="'+l+'" class="cke_resizer'+i+" cke_resizer_"+u+'" title="'+CKEDITOR.tools.htmlEncode(e.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event)">'+("ltr"==u?"◢":"◣")+"</span>";"ltr"==u&&"ltr"==i?t.data.html=t.data.html+n:t.data.html=n+t.data.html}},e,null,100),e.on("maximize",function(t){e.ui.space("resizer")[t.data==CKEDITOR.TRISTATE_ON?"hide":"show"]()})}}}),CKEDITOR.plugins.add("menubutton",{requires:"button,menu",onLoad:function(){var e=function(e){var t=this._,i=t.menu;t.state!==CKEDITOR.TRISTATE_DISABLED&&(t.on&&i?i.hide():(t.previousState=t.state,i||(i=t.menu=new CKEDITOR.menu(e,{panel:{className:"cke_menu_panel",attributes:{"aria-label":e.lang.common.options}}}),i.onHide=CKEDITOR.tools.bind(function(){var i=this.command?e.getCommand(this.command).modes:this.modes;this.setState(!i||i[e.mode]?t.previousState:CKEDITOR.TRISTATE_DISABLED),t.on=0},this),this.onMenu&&i.addListener(this.onMenu)),this.setState(CKEDITOR.TRISTATE_ON),t.on=1,setTimeout(function(){i.show(CKEDITOR.document.getById(t.id),4)},0)))};CKEDITOR.ui.menuButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){delete t.panel,this.base(t),this.hasArrow=!0,this.click=e},statics:{handler:{create:function(e){return new CKEDITOR.ui.menuButton(e)}}}})},beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_MENUBUTTON,CKEDITOR.ui.menuButton.handler)}}),CKEDITOR.UI_MENUBUTTON="menubutton",CKEDITOR.plugins.add("scayt",{requires:"menubutton,dialog",tabToOpen:null,dialogName:"scaytDialog",init:function(e){var t=this,i=CKEDITOR.plugins.scayt;this.bindEvents(e),this.parseConfig(e),this.addRule(e),CKEDITOR.dialog.add(this.dialogName,CKEDITOR.getUrl(this.path+"dialogs/options.js")),this.addMenuItems(e);var n=e.lang.scayt,r=CKEDITOR.env;e.ui.add("Scayt",CKEDITOR.UI_MENUBUTTON,{label:n.text_title,title:e.plugins.wsc?e.lang.wsc.title:n.text_title,modes:{wysiwyg:!(r.ie&&(r.version<8||r.quirks))},toolbar:"spellchecker,20",refresh:function(){var t=e.ui.instances.Scayt.getState();e.scayt&&(t=i.state[e.name]?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),e.fire("scaytButtonState",t)},onRender:function(){var t=this;e.on("scaytButtonState",function(e){void 0!==typeof e.data&&t.setState(e.data)})},onMenu:function(){var t=e.scayt;return e.getMenuItem("scaytToggle").label=e.lang.scayt[t&&i.state[e.name]?"btn_disable":"btn_enable"],t={scaytToggle:CKEDITOR.TRISTATE_OFF,scaytOptions:t?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytLangs:t?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytDict:t?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytAbout:t?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,WSC:e.plugins.wsc?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED},e.config.scayt_uiTabs[0]||delete t.scaytOptions,e.config.scayt_uiTabs[1]||delete t.scaytLangs,e.config.scayt_uiTabs[2]||delete t.scaytDict,t}}),e.contextMenu&&e.addMenuItems&&(e.contextMenu.addListener(function(){var i,n=e.scayt;if(n){var r=n.getSelectionNode();(r=r?r.getAttribute(n.getNodeAttribute()):r)&&(i=t.menuGenerator(e,r,t),n.showBanner("."+e.contextMenu._.definition.panel.className.split(" ").join(" .")))}return i}),e.contextMenu._.onHide=CKEDITOR.tools.override(e.contextMenu._.onHide,function(t){return function(){var i=e.scayt;return i&&i.hideBanner(),t.apply(this)}}))},addMenuItems:function(e){var t=this,i=CKEDITOR.plugins.scayt;e.addMenuGroup("scaytButton");var n=e.config.scayt_contextMenuItemsOrder.split("|");if(n&&n.length)for(var r=0;r<n.length;r++)e.addMenuGroup("scayt_"+n[r],r-10);e.addCommand("scaytToggle",{exec:function(e){var t=e.scayt;i.state[e.name]=!i.state[e.name],i.state[e.name]===!0?t||i.createScayt(e):t&&i.destroy(e)}}),e.addCommand("scaytAbout",{exec:function(e){e.scayt.tabToOpen="about",e.lockSelection(),e.openDialog(t.dialogName)}}),e.addCommand("scaytOptions",{exec:function(e){e.scayt.tabToOpen="options",e.lockSelection(),e.openDialog(t.dialogName)}}),e.addCommand("scaytLangs",{exec:function(e){e.scayt.tabToOpen="langs",e.lockSelection(),e.openDialog(t.dialogName)}}),e.addCommand("scaytDict",{exec:function(e){e.scayt.tabToOpen="dictionaries",e.lockSelection(),e.openDialog(t.dialogName)}}),n={scaytToggle:{label:e.lang.scayt.btn_enable,group:"scaytButton",command:"scaytToggle"},scaytAbout:{label:e.lang.scayt.btn_about,group:"scaytButton",command:"scaytAbout"},scaytOptions:{label:e.lang.scayt.btn_options,group:"scaytButton",command:"scaytOptions"},scaytLangs:{label:e.lang.scayt.btn_langs,group:"scaytButton",command:"scaytLangs"},scaytDict:{label:e.lang.scayt.btn_dictionaries,group:"scaytButton",command:"scaytDict"}},e.plugins.wsc&&(n.WSC={label:e.lang.wsc.toolbar,group:"scaytButton",onClick:function(){var t=CKEDITOR.plugins.scayt,i=e.scayt,n=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.container.getText():e.document.getBody().getText();(n=n.replace(/\s/g,""))?(i&&t.state[e.name]&&i.setMarkupPaused&&i.setMarkupPaused(!0),e.lockSelection(),e.execCommand("checkspell")):alert("Nothing to check!")}}),e.addMenuItems(n)},bindEvents:function(e){function t(){var t=e.scayt;t&&(t.removeMarkupInSelectionNode(),t.fire("startSpellCheck"))}var i=CKEDITOR.plugins.scayt,n=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE,r=function(){i.destroy(e)},o=function(){i.state[e.name]&&!e.readOnly&&!e.scayt&&i.createScayt(e)},s=function(){var t=e.editable();t.attachListener(t,"focus",function(){CKEDITOR.plugins.scayt&&!e.scayt&&setTimeout(o,0);var t,i,r=CKEDITOR.plugins.scayt&&CKEDITOR.plugins.scayt.state[e.name]&&e.scayt;if((n||r)&&e._.savedSelection)for(var r=e._.savedSelection.getSelectedElement(),r=!r&&e._.savedSelection.getRanges(),s=0;s<r.length;s++)i=r[s],"string"==typeof i.startContainer.$.nodeValue&&(t=i.startContainer.getText().length,(t<i.startOffset||t<i.endOffset)&&e.unlockSelection(!1))},this,null,-10)},a=function(){n?(e.on("blur",r),e.on("focus",o),e.focusManager.hasFocus&&o()):o(),s()};e.on("contentDom",a),e.on("beforeCommandExec",function(t){var n;t.data.name in i.options.disablingCommandExec&&"wysiwyg"==e.mode?(n=e.scayt)&&(i.destroy(e),e.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED)):"bold"!==t.data.name&&"italic"!==t.data.name&&"underline"!==t.data.name&&"strike"!==t.data.name&&"subscript"!==t.data.name&&"superscript"!==t.data.name&&"enter"!==t.data.name||(n=e.scayt)&&(n.removeMarkupInSelectionNode(),setTimeout(function(){n.fire("startSpellCheck")},0))}),e.on("beforeSetMode",function(t){"source"==t.data&&((t=e.scayt)&&(i.destroy(e),e.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED)),e.document&&e.document.getBody().removeAttribute("_jquid"))}),e.on("afterCommandExec",function(t){var i;"wysiwyg"!=e.mode||"undo"!=t.data.name&&"redo"!=t.data.name||(i=e.scayt)&&setTimeout(function(){i.fire("startSpellCheck")},250)}),e.on("readOnly",function(t){var n;t&&(n=e.scayt,t.editor.readOnly===!0?n&&n.fire("removeMarkupInDocument",{}):n?n.fire("startSpellCheck"):"wysiwyg"==t.editor.mode&&i.state[t.editor.name]===!0&&(i.createScayt(e),t.editor.fire("scaytButtonState",CKEDITOR.TRISTATE_ON)))}),e.on("beforeDestroy",r),e.on("setData",function(){r(),(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE||e.plugins.divarea)&&a()},this,null,50),e.on("insertElement",function(){CKEDITOR.env.ie?setTimeout(function(){t()},50):t()},this,null,50),e.on("insertHtml",function(){t()},this,null,50),e.on("insertText",function(){t()},this,null,50),e.on("scaytDialogShown",function(t){t.data.selectPage(e.scayt.tabToOpen)}),e.on("paste",function(){var t=e.scayt;t&&t.removeMarkupInSelectionNode()},null,null,0)},parseConfig:function(e){var t=CKEDITOR.plugins.scayt;if(t.replaceOldOptionsNames(e.config),
"boolean"!=typeof e.config.scayt_autoStartup&&(e.config.scayt_autoStartup=!1),t.state[e.name]=e.config.scayt_autoStartup,e.config.scayt_contextCommands||(e.config.scayt_contextCommands="ignore|ignoreall|add"),e.config.scayt_contextMenuItemsOrder||(e.config.scayt_contextMenuItemsOrder="suggest|moresuggest|control"),e.config.scayt_sLang||(e.config.scayt_sLang="en_US"),(void 0===e.config.scayt_maxSuggestions||"number"!=typeof e.config.scayt_maxSuggestions||e.config.scayt_maxSuggestions<0)&&(e.config.scayt_maxSuggestions=5),(void 0===e.config.scayt_minWordLength||"number"!=typeof e.config.scayt_minWordLength||e.config.scayt_minWordLength<1)&&(e.config.scayt_minWordLength=4),void 0!==e.config.scayt_customDictionaryIds&&"string"==typeof e.config.scayt_customDictionaryIds||(e.config.scayt_customDictionaryIds=""),void 0!==e.config.scayt_userDictionaryName&&"string"==typeof e.config.scayt_userDictionaryName||(e.config.scayt_userDictionaryName=null),"string"==typeof e.config.scayt_uiTabs&&3===e.config.scayt_uiTabs.split(",").length){var i=[],n=[];e.config.scayt_uiTabs=e.config.scayt_uiTabs.split(","),CKEDITOR.tools.search(e.config.scayt_uiTabs,function(e){1===Number(e)||0===Number(e)?(n.push(!0),i.push(Number(e))):n.push(!1)}),e.config.scayt_uiTabs=null===CKEDITOR.tools.search(n,!1)?i:[1,1,1]}else e.config.scayt_uiTabs=[1,1,1];if("string"!=typeof e.config.scayt_serviceProtocol&&(e.config.scayt_serviceProtocol=null),"string"!=typeof e.config.scayt_serviceHost&&(e.config.scayt_serviceHost=null),"string"!=typeof e.config.scayt_servicePort&&(e.config.scayt_servicePort=null),"string"!=typeof e.config.scayt_servicePath&&(e.config.scayt_servicePath=null),e.config.scayt_moreSuggestions||(e.config.scayt_moreSuggestions="on"),"string"!=typeof e.config.scayt_customerId&&(e.config.scayt_customerId="1:WvF0D4-UtPqN1-43nkD4-NKvUm2-daQqk3-LmNiI-z7Ysb4-mwry24-T8YrS3-Q2tpq2"),"string"!=typeof e.config.scayt_srcUrl&&(t=document.location.protocol,t=t.search(/https?:/)!=-1?t:"http:",e.config.scayt_srcUrl=t+"//svc.webspellchecker.net/spellcheck31/lf/scayt3/ckscayt/ckscayt.js"),"boolean"!=typeof CKEDITOR.config.scayt_handleCheckDirty&&(CKEDITOR.config.scayt_handleCheckDirty=!0),"boolean"!=typeof CKEDITOR.config.scayt_handleUndoRedo&&(CKEDITOR.config.scayt_handleUndoRedo=!0),e.config.scayt_disableOptionsStorage){var t=CKEDITOR.tools.isArray(e.config.scayt_disableOptionsStorage)?e.config.scayt_disableOptionsStorage:"string"==typeof e.config.scayt_disableOptionsStorage?[e.config.scayt_disableOptionsStorage]:void 0,r=["all","options","lang","ignore-all-caps-words","ignore-domain-names","ignore-words-with-mixed-cases","ignore-words-with-numbers"],o=["lang","ignore-all-caps-words","ignore-domain-names","ignore-words-with-mixed-cases","ignore-words-with-numbers"],s=CKEDITOR.tools.search,a=CKEDITOR.tools.indexOf;e.config.scayt_disableOptionsStorage=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],l=!!s(e,"options");if(!s(r,n)||l&&s(o,function(e){if("lang"===e)return!1}))return;if(s(o,n)&&o.splice(a(o,n),1),"all"===n||l&&s(e,"lang"))return[];"options"===n&&(o=["lang"])}return t=t.concat(o)}(t)}},addRule:function(e){var t=e.dataProcessor,i=t&&t.htmlFilter,n=e._.elementsPath&&e._.elementsPath.filters,t=t&&t.dataFilter,r=e.addRemoveFormatFilter,o=function(t){var i=CKEDITOR.plugins.scayt;if(e.scayt&&t.hasAttribute(i.options.data_attribute_name))return!1},s=function(t){var i=CKEDITOR.plugins.scayt,n=!0;return e.scayt&&t.hasAttribute(i.options.data_attribute_name)&&(n=!1),n};n&&n.push(o),t&&t.addRules({elements:{span:function(t){var i=CKEDITOR.plugins.scayt;return i&&i.state[e.name]&&t.classes&&CKEDITOR.tools.search(t.classes,i.options.misspelled_word_class)&&(t.classes&&t.parent.type===CKEDITOR.NODE_DOCUMENT_FRAGMENT?(delete t.attributes.style,delete t.name):delete t.classes[CKEDITOR.tools.indexOf(t.classes,i.options.misspelled_word_class)]),t}}}),i&&i.addRules({elements:{span:function(t){var i=CKEDITOR.plugins.scayt;return i&&i.state[e.name]&&t.hasClass(i.options.misspelled_word_class)&&t.attributes[i.options.data_attribute_name]&&(t.removeClass(i.options.misspelled_word_class),delete t.attributes[i.options.data_attribute_name],delete t.name),t}}}),r&&r.call(e,s)},scaytMenuDefinition:function(e){var t=this,e=e.scayt;return{scayt_ignore:{label:e.getLocal("btn_ignore"),group:"scayt_control",order:1,exec:function(e){e.scayt.ignoreWord()}},scayt_ignoreall:{label:e.getLocal("btn_ignoreAll"),group:"scayt_control",order:2,exec:function(e){e.scayt.ignoreAllWords()}},scayt_add:{label:e.getLocal("btn_addWord"),group:"scayt_control",order:3,exec:function(e){var t=e.scayt;setTimeout(function(){t.addWordToUserDictionary()},10)}},option:{label:e.getLocal("btn_options"),group:"scayt_control",order:4,exec:function(e){e.scayt.tabToOpen="options",e.lockSelection(),e.openDialog(t.dialogName)},verification:function(e){return 1==e.config.scayt_uiTabs[0]}},language:{label:e.getLocal("btn_langs"),group:"scayt_control",order:5,exec:function(e){e.scayt.tabToOpen="langs",e.lockSelection(),e.openDialog(t.dialogName)},verification:function(e){return 1==e.config.scayt_uiTabs[1]}},dictionary:{label:e.getLocal("btn_dictionaries"),group:"scayt_control",order:6,exec:function(e){e.scayt.tabToOpen="dictionaries",e.lockSelection(),e.openDialog(t.dialogName)},verification:function(e){return 1==e.config.scayt_uiTabs[2]}},about:{label:e.getLocal("btn_about"),group:"scayt_control",order:7,exec:function(e){e.scayt.tabToOpen="about",e.lockSelection(),e.openDialog(t.dialogName)}}}},buildSuggestionMenuItems:function(e,t){var i={},n={},r=e.scayt;if(t.length>0&&"no_any_suggestions"!==t[0])for(var o=0;o<t.length;o++){var s="scayt_suggest_"+CKEDITOR.plugins.scayt.suggestions[o].replace(" ","_");e.addCommand(s,this.createCommand(CKEDITOR.plugins.scayt.suggestions[o])),o<e.config.scayt_maxSuggestions?(e.addMenuItem(s,{label:t[o],command:s,group:"scayt_suggest",order:o+1}),i[s]=CKEDITOR.TRISTATE_OFF):(e.addMenuItem(s,{label:t[o],command:s,group:"scayt_moresuggest",order:o+1}),n[s]=CKEDITOR.TRISTATE_OFF,"on"===e.config.scayt_moreSuggestions&&(e.addMenuItem("scayt_moresuggest",{label:r.getLocal("btn_moreSuggestions"),group:"scayt_moresuggest",order:10,getItems:function(){return n}}),i.scayt_moresuggest=CKEDITOR.TRISTATE_OFF))}else i.no_scayt_suggest=CKEDITOR.TRISTATE_DISABLED,e.addCommand("no_scayt_suggest",{exec:function(){}}),e.addMenuItem("no_scayt_suggest",{label:r.getLocal("btn_noSuggestions")||"no_scayt_suggest",command:"no_scayt_suggest",group:"scayt_suggest",order:0});return i},menuGenerator:function(e,t){var i=e.scayt,n=this.scaytMenuDefinition(e),r={},o=e.config.scayt_contextCommands.split("|");if(i.fire("getSuggestionsList",{lang:i.getLang(),word:t}),r=this.buildSuggestionMenuItems(e,CKEDITOR.plugins.scayt.suggestions),"off"==e.config.scayt_contextCommands)return r;for(var s in n)CKEDITOR.tools.indexOf(o,s.replace("scayt_",""))==-1&&"all"!=e.config.scayt_contextCommands||(r[s]=CKEDITOR.TRISTATE_OFF,"function"==typeof n[s].verification&&!n[s].verification(e)&&delete r[s],e.addCommand(s,{exec:n[s].exec}),e.addMenuItem(s,{label:e.lang.scayt[n[s].label]||n[s].label,command:s,group:n[s].group,order:n[s].order}));return r},createCommand:function(e){return{exec:function(t){t.scayt.replaceSelectionNode({word:e})}}}}),CKEDITOR.plugins.scayt={state:{},suggestions:[],loadingHelper:{loadOrder:[]},isLoading:!1,options:{disablingCommandExec:{source:!0,newpage:!0,templates:!0},data_attribute_name:"data-scayt-word",misspelled_word_class:"scayt-misspell-word"},backCompatibilityMap:{scayt_service_protocol:"scayt_serviceProtocol",scayt_service_host:"scayt_serviceHost",scayt_service_port:"scayt_servicePort",scayt_service_path:"scayt_servicePath",scayt_customerid:"scayt_customerId"},replaceOldOptionsNames:function(e){for(var t in e)t in this.backCompatibilityMap&&(e[this.backCompatibilityMap[t]]=e[t],delete e[t])},createScayt:function(e){var t=this;this.loadScaytLibrary(e,function(e){var i={lang:e.config.scayt_sLang,container:"BODY"==e.editable().$.nodeName?e.document.getWindow().$.frameElement:e.editable().$,customDictionary:e.config.scayt_customDictionaryIds,userDictionaryName:e.config.scayt_userDictionaryName,localization:e.langCode,customer_id:e.config.scayt_customerId,debug:e.config.scayt_debug,data_attribute_name:t.options.data_attribute_name,misspelled_word_class:t.options.misspelled_word_class,"options-to-restore":e.config.scayt_disableOptionsStorage,focused:e.editable().hasFocus,ignoreElementsRegex:e.config.scayt_elementsToIgnore,minWordLength:e.config.scayt_minWordLength};e.config.scayt_serviceProtocol&&(i.service_protocol=e.config.scayt_serviceProtocol),e.config.scayt_serviceHost&&(i.service_host=e.config.scayt_serviceHost),e.config.scayt_servicePort&&(i.service_port=e.config.scayt_servicePort),e.config.scayt_servicePath&&(i.service_path=e.config.scayt_servicePath),i=new SCAYT.CKSCAYT(i,function(){},function(){}),i.subscribe("suggestionListSend",function(e){for(var t={},i=[],n=0;n<e.suggestionList.length;n++)t["word_"+e.suggestionList[n]]||(t["word_"+e.suggestionList[n]]=e.suggestionList[n],i.push(e.suggestionList[n]));CKEDITOR.plugins.scayt.suggestions=i}),i.subscribe("selectionIsChanged",function(){e.getSelection().isLocked&&e.lockSelection()}),e.scayt=i,e.fire("scaytButtonState",e.readOnly?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_ON)})},destroy:function(e){e.scayt&&e.scayt.destroy(),delete e.scayt,e.fire("scaytButtonState",CKEDITOR.TRISTATE_OFF)},loadScaytLibrary:function(e,t){var i,n=this;"undefined"==typeof window.SCAYT||"function"!=typeof window.SCAYT.CKSCAYT?this.loadingHelper[e.name]||(this.loadingHelper[e.name]=t,this.loadingHelper.loadOrder.push(e.name),i=new Date,i=i.getTime(),i=e.config.scayt_srcUrl+"?"+i,CKEDITOR.scriptLoader.load(i,function(){var e;CKEDITOR.fireOnce("scaytReady");for(var t=0;t<n.loadingHelper.loadOrder.length;t++)e=n.loadingHelper.loadOrder[t],"function"==typeof n.loadingHelper[e]&&n.loadingHelper[e](CKEDITOR.instances[e]),delete n.loadingHelper[e];n.loadingHelper.loadOrder=[]})):window.SCAYT&&"function"==typeof window.SCAYT.CKSCAYT&&(CKEDITOR.fireOnce("scaytReady"),e.scayt||"function"==typeof t&&t(e))}},CKEDITOR.on("dialogDefinition",function(e){"scaytDialog"===e.data.name&&e.data.definition.dialog.on("cancel",function(){return!1},this,null,-1)}),CKEDITOR.on("scaytReady",function(){if(CKEDITOR.config.scayt_handleCheckDirty===!0){var e=CKEDITOR.editor.prototype;e.checkDirty=CKEDITOR.tools.override(e.checkDirty,function(e){return function(){var t=null,i=this.scayt;if(CKEDITOR.plugins.scayt&&CKEDITOR.plugins.scayt.state[this.name]&&this.scayt){if(t="ready"==this.status)var n=i.removeMarkupFromString(this.getSnapshot()),i=i.removeMarkupFromString(this._.previousValue),t=t&&i!==n}else t=e.call(this);return t}}),e.resetDirty=CKEDITOR.tools.override(e.resetDirty,function(e){return function(){var t=this.scayt;CKEDITOR.plugins.scayt&&CKEDITOR.plugins.scayt.state[this.name]&&this.scayt?this._.previousValue=t.removeMarkupFromString(this.getSnapshot()):e.call(this)}})}if(CKEDITOR.config.scayt_handleUndoRedo===!0){var e=CKEDITOR.plugins.undo.Image.prototype,t="function"==typeof e.equalsContent?"equalsContent":"equals";e[t]=CKEDITOR.tools.override(e[t],function(e){return function(t){var i=t.editor.scayt,n=this.contents,r=t.contents,o=null;return CKEDITOR.plugins.scayt&&CKEDITOR.plugins.scayt.state[t.editor.name]&&t.editor.scayt&&(this.contents=i.removeMarkupFromString(n)||"",t.contents=i.removeMarkupFromString(r)||""),o=e.apply(this,arguments),this.contents=n,t.contents=r,o}})}}),function(){var e={preserveState:!0,editorFocus:!1,readOnly:1,exec:function(e){this.toggleState(),this.refresh(e)},refresh:function(e){if(e.document){var t=this.state==CKEDITOR.TRISTATE_ON?"attachClass":"removeClass";e.editable()[t]("cke_show_borders")}}};CKEDITOR.plugins.add("showborders",{modes:{wysiwyg:1},onLoad:function(){var e;e=(CKEDITOR.env.ie6Compat?[".%1 table.%2,",".%1 table.%2 td, .%1 table.%2 th","{","border : #d3d3d3 1px dotted","}"]:[".%1 table.%2,",".%1 table.%2 > tr > td, .%1 table.%2 > tr > th,",".%1 table.%2 > tbody > tr > td, .%1 table.%2 > tbody > tr > th,",".%1 table.%2 > thead > tr > td, .%1 table.%2 > thead > tr > th,",".%1 table.%2 > tfoot > tr > td, .%1 table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"cke_show_border").replace(/%1/g,"cke_show_borders "),CKEDITOR.addCss(e)},init:function(t){var i=t.addCommand("showborders",e);i.canUndo=!1,t.config.startupShowBorders!==!1&&i.setState(CKEDITOR.TRISTATE_ON),t.on("mode",function(){i.state!=CKEDITOR.TRISTATE_DISABLED&&i.refresh(t)},null,null,100),t.on("contentDom",function(){i.state!=CKEDITOR.TRISTATE_DISABLED&&i.refresh(t)}),t.on("removeFormatCleanup",function(e){e=e.data,t.getCommand("showborders").state==CKEDITOR.TRISTATE_ON&&e.is("table")&&(!e.hasAttribute("border")||parseInt(e.getAttribute("border"),10)<=0)&&e.addClass("cke_show_border")})},afterInit:function(e){var t=e.dataProcessor,e=t&&t.dataFilter,t=t&&t.htmlFilter;e&&e.addRules({elements:{table:function(e){var e=e.attributes,t=e["class"],i=parseInt(e.border,10);i&&!(i<=0)||t&&t.indexOf("cke_show_border")!=-1||(e["class"]=(t||"")+" cke_show_border")}}}),t&&t.addRules({elements:{table:function(e){var e=e.attributes,t=e["class"];t&&(e["class"]=t.replace("cke_show_border","").replace(/\s{2}/," ").replace(/^\s+|\s+$/,""))}}})}}),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name;"table"!=t&&"tableProperties"!=t||(e=e.data.definition,t=e.getContents("info").get("txtBorder"),t.commit=CKEDITOR.tools.override(t.commit,function(e){return function(t,i){e.apply(this,arguments);var n=parseInt(this.getValue(),10);i[!n||n<=0?"addClass":"removeClass"]("cke_show_border")}}),(e=(e=e.getContents("advanced"))&&e.get("advCSSClasses"))&&(e.setup=CKEDITOR.tools.override(e.setup,function(e){return function(){e.apply(this,arguments),this.setValue(this.getValue().replace(/cke_show_border/,""))}}),e.commit=CKEDITOR.tools.override(e.commit,function(e){return function(t,i){e.apply(this,arguments),parseInt(i.getAttribute("border"),10)||i.addClass("cke_show_border")}})))})}(),function(){CKEDITOR.plugins.add("sourcearea",{init:function(t){function i(){var e=r&&this.equals(CKEDITOR.document.getActive());this.hide(),this.setStyle("height",this.getParent().$.clientHeight+"px"),this.setStyle("width",this.getParent().$.clientWidth+"px"),this.show(),e&&this.focus()}if(t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var n=CKEDITOR.plugins.sourcearea;t.addMode("source",function(n){var r=t.ui.space("contents").getDocument().createElement("textarea");r.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",t.config.sourceAreaTabSize||4))),r.setAttribute("dir","ltr"),r.addClass("cke_source cke_reset cke_enable_context_menu"),t.ui.space("contents").append(r),r=t.editable(new e(t,r)),r.setData(t.getData(1)),CKEDITOR.env.ie&&(r.attachListener(t,"resize",i,r),r.attachListener(CKEDITOR.document.getWindow(),"resize",i,r),CKEDITOR.tools.setTimeout(i,0,r)),t.fire("ariaWidget",this),n()}),t.addCommand("source",n.commands.source),t.ui.addButton&&t.ui.addButton("Source",{label:t.lang.sourcearea.toolbar,command:"source",toolbar:"mode,10"}),t.on("mode",function(){t.getCommand("source").setState("source"==t.mode?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)});var r=CKEDITOR.env.ie&&9==CKEDITOR.env.version}}});var e=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(e){this.setValue(e),this.status="ready",this.editor.fire("dataReady")},getData:function(){return this.getValue()},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(e){this[(e?"set":"remove")+"Attribute"]("readOnly","readonly")},detach:function(){e.baseProto.detach.call(this),this.clearCustomData(),this.remove()}}})}(),CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(e){"wysiwyg"==e.mode&&e.fire("saveSnapshot"),e.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),e.setMode("source"==e.mode?"wysiwyg":"source")},canUndo:!1}}},CKEDITOR.plugins.add("specialchar",{availableLangs:{af:1,ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,he:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ku:1,lt:1,lv:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ru:1,si:1,sk:1,sl:1,sq:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},requires:"dialog",init:function(e){var t=this;CKEDITOR.dialog.add("specialchar",this.path+"dialogs/specialchar.js"),e.addCommand("specialchar",{exec:function(){var i=e.langCode,i=t.availableLangs[i]?i:t.availableLangs[i.replace(/-.*/,"")]?i.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(t.path+"dialogs/lang/"+i+".js"),function(){CKEDITOR.tools.extend(e.lang.specialchar,t.langEntries[i]),e.openDialog("specialchar")})},modes:{wysiwyg:1},canUndo:!1}),e.ui.addButton&&e.ui.addButton("SpecialChar",{label:e.lang.specialchar.toolbar,command:"specialchar",toolbar:"insert,50"})}}),CKEDITOR.config.specialChars="! &quot; # $ % &amp; ' ( ) * + - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~ &euro; &lsquo; &rsquo; &ldquo; &rdquo; &ndash; &mdash; &iexcl; &cent; &pound; &curren; &yen; &brvbar; &sect; &uml; &copy; &ordf; &laquo; &not; &reg; &macr; &deg; &sup2; &sup3; &acute; &micro; &para; &middot; &cedil; &sup1; &ordm; &raquo; &frac14; &frac12; &frac34; &iquest; &Agrave; &Aacute; &Acirc; &Atilde; &Auml; &Aring; &AElig; &Ccedil; &Egrave; &Eacute; &Ecirc; &Euml; &Igrave; &Iacute; &Icirc; &Iuml; &ETH; &Ntilde; &Ograve; &Oacute; &Ocirc; &Otilde; &Ouml; &times; &Oslash; &Ugrave; &Uacute; &Ucirc; &Uuml; &Yacute; &THORN; &szlig; &agrave; &aacute; &acirc; &atilde; &auml; &aring; &aelig; &ccedil; &egrave; &eacute; &ecirc; &euml; &igrave; &iacute; &icirc; &iuml; &eth; &ntilde; &ograve; &oacute; &ocirc; &otilde; &ouml; &divide; &oslash; &ugrave; &uacute; &ucirc; &uuml; &yacute; &thorn; &yuml; &OElig; &oelig; &#372; &#374 &#373 &#375; &sbquo; &#8219; &bdquo; &hellip; &trade; &#9658; &bull; &rarr; &rArr; &hArr; &diams; &asymp;".split(" "),function(){CKEDITOR.plugins.add("stylescombo",{requires:"richcombo",init:function(e){var t=e.config,i=e.lang.stylescombo,n={},r=[],o=[];e.on("stylesSet",function(i){if(i=i.data.styles){for(var s,a,l,u=0,c=i.length;u<c;u++)s=i[u],e.blockless&&s.element in CKEDITOR.dtd.$block||(a=s.name,s=new CKEDITOR.style(s),e.filter.customConfig&&!e.filter.check(s)||(s._name=a,s._.enterMode=t.enterMode,s._.type=l=s.assignedTo||s.type,s._.weight=u+1e3*(l==CKEDITOR.STYLE_OBJECT?1:l==CKEDITOR.STYLE_BLOCK?2:3),n[a]=s,r.push(s),o.push(s)));r.sort(function(e,t){return e._.weight-t._.weight})}}),e.ui.addRichCombo("Styles",{label:i.label,title:i.panelTitle,toolbar:"styles,10",allowedContent:o,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(t.contentsCss),multiSelect:!0,attributes:{"aria-label":i.panelTitle}},init:function(){var e,t,n,o,s,a;for(s=0,a=r.length;s<a;s++)e=r[s],t=e._name,o=e._.type,o!=n&&(this.startGroup(i["panelTitle"+o]),n=o),this.add(t,e.type==CKEDITOR.STYLE_OBJECT?t:e.buildPreview(),t);this.commit()},onClick:function(t){e.focus(),e.fire("saveSnapshot");var t=n[t],i=e.elementPath();e[t.checkActive(i,e)?"removeStyle":"applyStyle"](t),e.fire("saveSnapshot")},onRender:function(){e.on("selectionChange",function(t){for(var i,r=this.getValue(),t=t.data.path.elements,o=0,s=t.length;o<s;o++){i=t[o];for(var a in n)if(n[a].checkElementRemovable(i,!0,e))return void(a!=r&&this.setValue(a))}this.setValue("")},this)},onOpen:function(){var t=e.getSelection().getSelectedElement(),t=e.elementPath(t),r=[0,0,0,0];this.showAll(),this.unmarkAll();for(var o in n){var s=n[o],a=s._.type;s.checkApplicable(t,e,e.activeFilter)?r[a]++:this.hideItem(o),s.checkActive(t,e)&&this.mark(o)}r[CKEDITOR.STYLE_BLOCK]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_BLOCK]),r[CKEDITOR.STYLE_INLINE]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_INLINE]),r[CKEDITOR.STYLE_OBJECT]||this.hideGroup(i["panelTitle"+CKEDITOR.STYLE_OBJECT])},refresh:function(){var t=e.elementPath();if(t){for(var i in n)if(n[i].checkApplicable(t,e,e.activeFilter))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}},reset:function(){n={},r=[]}})}})}(),function(){function e(e){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(t){if(t.editable().hasFocus){var i,n=t.getSelection();if(i=new CKEDITOR.dom.elementPath(n.getCommonAncestor(),n.root).contains({td:1,th:1},1)){var n=t.createRange(),r=CKEDITOR.tools.tryThese(function(){var t=i.getParent().$.cells[i.$.cellIndex+(e?-1:1)];return t.parentNode.parentNode,t},function(){var t=i.getParent(),t=t.getAscendant("table").$.rows[t.$.rowIndex+(e?-1:1)];return t.cells[e?t.cells.length-1:0]});if(r||e){if(!r)return!0;r=new CKEDITOR.dom.element(r),n.moveToElementEditStart(r),(!n.checkStartOfBlock()||!n.checkEndOfBlock())&&n.selectNodeContents(r)}else{for(var o=i.getAscendant("table").$,r=i.getParent().$.cells,o=new CKEDITOR.dom.element(o.insertRow(-1),t.document),s=0,a=r.length;s<a;s++)o.append(new CKEDITOR.dom.element(r[s],t.document).clone(!1,!1)).appendBogus();n.moveToElementEditStart(o)}return n.select(!0),!0}}return!1}}}var t={editorFocus:!1,modes:{wysiwyg:1,source:1}},i={exec:function(e){e.container.focusNext(!0,e.tabIndex)}},n={exec:function(e){e.container.focusPrevious(!0,e.tabIndex)}};CKEDITOR.plugins.add("tab",{init:function(r){for(var o=r.config.enableTabKeyTools!==!1,s=r.config.tabSpaces||0,a="";s--;)a+=" ";a&&r.on("key",function(e){9==e.data.keyCode&&(r.insertText(a),e.cancel())}),o&&r.on("key",function(e){(9==e.data.keyCode&&r.execCommand("selectNextCell")||e.data.keyCode==CKEDITOR.SHIFT+9&&r.execCommand("selectPreviousCell"))&&e.cancel()}),r.addCommand("blur",CKEDITOR.tools.extend(i,t)),r.addCommand("blurBack",CKEDITOR.tools.extend(n,t)),r.addCommand("selectNextCell",e()),r.addCommand("selectPreviousCell",e(!0))}})}(),CKEDITOR.dom.element.prototype.focusNext=function(e,t){var i,n,r,o,s,a,l=void 0===t?this.getTabIndex():t;if(l<=0)for(s=this.getNextSourceNode(e,CKEDITOR.NODE_ELEMENT);s;){if(s.isVisible()&&0===s.getTabIndex()){r=s;break}s=s.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}else for(s=this.getDocument().getBody().getFirst();s=s.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!i)if(!n&&s.equals(this)){if(n=!0,e){if(!(s=s.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else n&&!this.contains(s)&&(i=1);if(s.isVisible()&&!((a=s.getTabIndex())<0)){if(i&&a==l){r=s;break}a>l&&(!r||!o||a<o)?(r=s,o=a):r||0!==a||(r=s,o=a)}}r&&r.focus()},CKEDITOR.dom.element.prototype.focusPrevious=function(e,t){for(var i,n,r,o,s=void 0===t?this.getTabIndex():t,a=0,l=this.getDocument().getBody().getLast();l=l.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!i)if(!n&&l.equals(this)){if(n=!0,e){if(!(l=l.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else n&&!this.contains(l)&&(i=1);if(l.isVisible()&&!((o=l.getTabIndex())<0))if(s<=0){if(i&&0===o){r=l;break}o>a&&(r=l,a=o)}else{if(i&&o==s){r=l;break}o<s&&(!r||o>a)&&(r=l,a=o)}}r&&r.focus()},CKEDITOR.plugins.add("table",{requires:"dialog",init:function(e){function t(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains("table",1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}if(!e.blockless){var i=e.lang.table;e.addCommand("table",new CKEDITOR.dialogCommand("table",{context:"table",allowedContent:"table{width,height}[align,border,cellpadding,cellspacing,summary];caption tbody thead tfoot;th td tr[scope];"+(e.plugins.dialogadvtab?"table"+e.plugins.dialogadvtab.allowedContent():""),requiredContent:"table",contentTransformations:[["table{width}: sizeToStyle","table[width]: sizeToAttribute"]]})),e.addCommand("tableProperties",new CKEDITOR.dialogCommand("tableProperties",t())),e.addCommand("tableDelete",t({exec:function(e){var t=e.elementPath().contains("table",1);if(t){var i=t.getParent(),n=e.editable();1==i.getChildCount()&&!i.is("td","th")&&!i.equals(n)&&(t=i),e=e.createRange(),e.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START),t.remove(),e.select()}}})),e.ui.addButton&&e.ui.addButton("Table",{label:i.toolbar,command:"table",toolbar:"insert,30"}),CKEDITOR.dialog.add("table",this.path+"dialogs/table.js"),CKEDITOR.dialog.add("tableProperties",this.path+"dialogs/table.js"),e.addMenuItems&&e.addMenuItems({table:{label:i.menu,command:"tableProperties",group:"table",order:5},tabledelete:{label:i.deleteTable,command:"tableDelete",group:"table",order:1}}),e.on("doubleclick",function(e){e.data.element.is("table")&&(e.data.dialog="tableProperties")}),e.contextMenu&&e.contextMenu.addListener(function(){return{tabledelete:CKEDITOR.TRISTATE_OFF,table:CKEDITOR.TRISTATE_OFF}})}}}),function(){function e(e){function t(e){i.length>0||e.type!=CKEDITOR.NODE_ELEMENT||!d.test(e.getName())||e.getCustomData("selected_cell")||(CKEDITOR.dom.element.setMarker(n,e,"selected_cell",!0),i.push(e))}for(var e=e.getRanges(),i=[],n={},r=0;r<e.length;r++){var o=e[r];if(o.collapsed)o=o.getCommonAncestor(),(o=o.getAscendant("td",!0)||o.getAscendant("th",!0))&&i.push(o);else{var s,o=new CKEDITOR.dom.walker(o);for(o.guard=t;s=o.next();)s.type==CKEDITOR.NODE_ELEMENT&&s.is(CKEDITOR.dtd.table)||(s=s.getAscendant("td",!0)||s.getAscendant("th",!0))&&!s.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(n,s,"selected_cell",!0),i.push(s))}}return CKEDITOR.dom.element.clearAllMarkers(n),i}function t(t,i){for(var n=e(t),r=n[0],o=r.getAscendant("table"),r=r.getDocument(),s=n[0].getParent(),a=s.$.rowIndex,n=n[n.length-1],l=n.getParent().$.rowIndex+n.$.rowSpan-1,n=new CKEDITOR.dom.element(o.$.rows[l]),a=i?a:l,s=i?s:n,n=CKEDITOR.tools.buildTableMap(o),o=n[a],a=i?n[a-1]:n[a+1],n=n[0].length,r=r.createElement("tr"),l=0;o[l]&&l<n;l++){var u;o[l].rowSpan>1&&a&&o[l]==a[l]?(u=o[l],u.rowSpan=u.rowSpan+1):(u=new CKEDITOR.dom.element(o[l]).clone(),u.removeAttribute("rowSpan"),u.appendBogus(),r.append(u),u=u.$),l+=u.colSpan-1}i?r.insertBefore(s):r.insertAfter(s)}function i(t){if(t instanceof CKEDITOR.dom.selection){for(var n=e(t),r=n[0].getAscendant("table"),o=CKEDITOR.tools.buildTableMap(r),t=n[0].getParent().$.rowIndex,n=n[n.length-1],s=n.getParent().$.rowIndex+n.$.rowSpan-1,n=[],a=t;a<=s;a++){for(var l=o[a],u=new CKEDITOR.dom.element(r.$.rows[a]),c=0;c<l.length;c++){var h=new CKEDITOR.dom.element(l[c]),d=h.getParent().$.rowIndex;1==h.$.rowSpan?h.remove():(h.$.rowSpan=h.$.rowSpan-1,d==a&&(d=o[a+1],d[c-1]?h.insertAfter(new CKEDITOR.dom.element(d[c-1])):new CKEDITOR.dom.element(r.$.rows[a+1]).append(h,1))),c+=h.$.colSpan-1}n.push(u)}for(o=r.$.rows,r=new CKEDITOR.dom.element(o[s+1]||(t>0?o[t-1]:null)||r.$.parentNode),a=n.length;a>=0;a--)i(n[a]);return r}return t instanceof CKEDITOR.dom.element&&(r=t.getAscendant("table"),1==r.$.rows.length?r.remove():t.remove()),null}function n(e,t){for(var i=t?1/0:0,n=0;n<e.length;n++){var r;r=e[n];for(var o=t,s=r.getParent().$.cells,a=0,l=0;l<s.length;l++){var u=s[l],a=a+(o?1:u.colSpan);if(u==r.$)break}r=a-1,(t?r<i:r>i)&&(i=r)}return i}function r(t,i){for(var r=e(t),o=r[0].getAscendant("table"),s=n(r,1),r=n(r),s=i?s:r,a=CKEDITOR.tools.buildTableMap(o),o=[],r=[],l=a.length,u=0;u<l;u++)o.push(a[u][s]),r.push(i?a[u][s-1]:a[u][s+1]);for(u=0;u<l;u++)o[u]&&(o[u].colSpan>1&&r[u]==o[u]?(s=o[u],s.colSpan=s.colSpan+1):(s=new CKEDITOR.dom.element(o[u]).clone(),s.removeAttribute("colSpan"),s.appendBogus(),s[i?"insertBefore":"insertAfter"].call(s,new CKEDITOR.dom.element(o[u])),s=s.$),u+=s.rowSpan-1)}function o(e,t){var i=e.getStartElement();if(i=i.getAscendant("td",1)||i.getAscendant("th",1)){var n=i.clone();n.appendBogus(),t?n.insertBefore(i):n.insertAfter(i)}}function s(t){if(t instanceof CKEDITOR.dom.selection){var i,t=e(t),n=t[0]&&t[0].getAscendant("table");e:{var r=0;i=t.length-1;for(var o,l,u={};o=t[r++];)CKEDITOR.dom.element.setMarker(u,o,"delete_cell",!0);for(r=0;o=t[r++];)if((l=o.getPrevious())&&!l.getCustomData("delete_cell")||(l=o.getNext())&&!l.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(u),i=l;break e}CKEDITOR.dom.element.clearAllMarkers(u),l=t[0].getParent(),(l=l.getPrevious())?i=l.getLast():(l=t[i].getParent(),i=(l=l.getNext())?l.getChild(0):null)}for(l=t.length-1;l>=0;l--)s(t[l]);i?a(i,!0):n&&n.remove()}else t instanceof CKEDITOR.dom.element&&(n=t.getParent(),1==n.getChildCount()?n.remove():t.remove())}function a(e,t){var i=e.getDocument(),n=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(n.focus(),i.focus()),i=new CKEDITOR.dom.range(i),i["moveToElementEdit"+(t?"End":"Start")](e)||(i.selectNodeContents(e),i.collapse(!t)),i.select(!0)}function l(e,t,i){if(e=e[t],"undefined"==typeof i)return e;for(t=0;e&&t<e.length;t++){if(i.is&&e[t]==i.$)return t;if(t==i)return new CKEDITOR.dom.element(e[t])}return i.is?-1:null}function u(t,i,n){var r,o=e(t);if((i?1!=o.length:o.length<2)||(r=t.getCommonAncestor())&&r.type==CKEDITOR.NODE_ELEMENT&&r.is("table"))return!1;var s,t=o[0];r=t.getAscendant("table");var a=CKEDITOR.tools.buildTableMap(r),u=a.length,c=a[0].length,h=t.getParent().$.rowIndex,d=l(a,h,t);if(i){var p;try{var f=parseInt(t.getAttribute("rowspan"),10)||1;s=parseInt(t.getAttribute("colspan"),10)||1,p=a["up"==i?h-f:"down"==i?h+f:h]["left"==i?d-s:"right"==i?d+s:d]}catch(m){return!1}if(!p||t.$==p)return!1;o["up"==i||"left"==i?"unshift":"push"](new CKEDITOR.dom.element(p))}for(var i=t.getDocument(),g=h,f=p=0,y=!n&&new CKEDITOR.dom.documentFragment(i),v=0,i=0;i<o.length;i++){s=o[i];var E=s.getParent(),T=s.getFirst(),b=s.$.colSpan,C=s.$.rowSpan,E=E.$.rowIndex,O=l(a,E,s),v=v+b*C,f=Math.max(f,O-d+b);p=Math.max(p,E-h+C),n||(b=s,(C=b.getBogus())&&C.remove(),b.trim(),s.getChildren().count()&&(E==g||!T||T.isBlockBoundary&&T.isBlockBoundary({br:1})||(g=y.getLast(CKEDITOR.dom.walker.whitespaces(!0)))&&(!g.is||!g.is("br"))&&y.append("br"),s.moveChildren(y)),i?s.remove():s.setHtml("")),g=E}if(n)return p*f==v;for(y.moveChildren(t),t.appendBogus(),f>=c?t.removeAttribute("rowSpan"):t.$.rowSpan=p,p>=u?t.removeAttribute("colSpan"):t.$.colSpan=f,n=new CKEDITOR.dom.nodeList(r.$.rows),o=n.count(),i=o-1;i>=0;i--)r=n.getItem(i),r.$.cells.length||(r.remove(),o++);return t}function c(t,i){var n=e(t);if(n.length>1)return!1;if(i)return!0;var r,n=n[0],o=n.getParent(),s=o.getAscendant("table"),a=CKEDITOR.tools.buildTableMap(s),u=o.$.rowIndex,c=l(a,u,n),h=n.$.rowSpan;if(h>1){r=Math.ceil(h/2);for(var d,h=Math.floor(h/2),o=u+r,s=new CKEDITOR.dom.element(s.$.rows[o]),a=l(a,o),o=n.clone(),u=0;u<a.length;u++){if(d=a[u],d.parentNode==s.$&&u>c){o.insertBefore(new CKEDITOR.dom.element(d));break}d=null}d||s.append(o)}else for(h=r=1,s=o.clone(),s.insertAfter(o),s.append(o=n.clone()),d=l(a,u),c=0;c<d.length;c++)d[c].rowSpan++;return o.appendBogus(),n.$.rowSpan=r,o.$.rowSpan=h,1==r&&n.removeAttribute("rowSpan"),1==h&&o.removeAttribute("rowSpan"),o}function h(t,i){var n=e(t);if(n.length>1)return!1;if(i)return!0;var n=n[0],r=n.getParent(),o=r.getAscendant("table"),o=CKEDITOR.tools.buildTableMap(o),s=l(o,r.$.rowIndex,n),a=n.$.colSpan;if(a>1)r=Math.ceil(a/2),a=Math.floor(a/2);else{for(var a=r=1,u=[],c=0;c<o.length;c++){var h=o[c];u.push(h[s]),h[s].rowSpan>1&&(c+=h[s].rowSpan-1)}for(o=0;o<u.length;o++)u[o].colSpan++}return o=n.clone(),o.insertAfter(n),o.appendBogus(),n.$.colSpan=r,o.$.colSpan=a,1==r&&n.removeAttribute("colSpan"),1==a&&o.removeAttribute("colSpan"),o}var d=/^(?:td|th)$/;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(n){function l(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function d(e,t){var i=n.addCommand(e,t);n.addFeature(i)}var p=n.lang.table;d("cellProperties",new CKEDITOR.dialogCommand("cellProperties",l({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",
requiredContent:"table"}))),CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js"),d("rowDelete",l({requiredContent:"table",exec:function(e){e=e.getSelection(),a(i(e))}})),d("rowInsertBefore",l({requiredContent:"table",exec:function(e){e=e.getSelection(),t(e,!0)}})),d("rowInsertAfter",l({requiredContent:"table",exec:function(e){e=e.getSelection(),t(e)}})),d("columnDelete",l({requiredContent:"table",exec:function(t){for(var i,n,t=t.getSelection(),t=e(t),r=t[0],o=t[t.length-1],t=r.getAscendant("table"),s=CKEDITOR.tools.buildTableMap(t),l=[],u=0,c=s.length;u<c;u++)for(var h=0,d=s[u].length;h<d;h++)s[u][h]==r.$&&(i=h),s[u][h]==o.$&&(n=h);for(u=i;u<=n;u++)for(h=0;h<s.length;h++)o=s[h],r=new CKEDITOR.dom.element(t.$.rows[h]),o=new CKEDITOR.dom.element(o[u]),o.$&&(1==o.$.colSpan?o.remove():o.$.colSpan=o.$.colSpan-1,h+=o.$.rowSpan-1,r.$.cells.length||l.push(r));n=t.$.rows[0]&&t.$.rows[0].cells,i=new CKEDITOR.dom.element(n[i]||(i?n[i-1]:t.$.parentNode)),l.length==c&&t.remove(),i&&a(i,!0)}})),d("columnInsertBefore",l({requiredContent:"table",exec:function(e){e=e.getSelection(),r(e,!0)}})),d("columnInsertAfter",l({requiredContent:"table",exec:function(e){e=e.getSelection(),r(e)}})),d("cellDelete",l({requiredContent:"table",exec:function(e){e=e.getSelection(),s(e)}})),d("cellMerge",l({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(e){a(u(e.getSelection()),!0)}})),d("cellMergeRight",l({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){a(u(e.getSelection(),"right"),!0)}})),d("cellMergeDown",l({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){a(u(e.getSelection(),"down"),!0)}})),d("cellVerticalSplit",l({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){a(c(e.getSelection()))}})),d("cellHorizontalSplit",l({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){a(h(e.getSelection()))}})),d("cellInsertBefore",l({requiredContent:"table",exec:function(e){e=e.getSelection(),o(e,!0)}})),d("cellInsertAfter",l({requiredContent:"table",exec:function(e){e=e.getSelection(),o(e)}})),n.addMenuItems&&n.addMenuItems({tablecell:{label:p.cell.menu,group:"tablecell",order:1,getItems:function(){var t=n.getSelection(),i=e(t);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:u(t,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:u(t,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:u(t,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:c(t,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:h(t,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:i.length>0?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:p.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:p.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:p.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:p.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:p.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:p.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:p.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:p.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:p.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:p.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:p.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:p.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:p.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:p.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:p.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:p.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:p.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}}),n.contextMenu&&n.contextMenu.addListener(function(e,t,i){return(e=i.contains({td:1,th:1},1))&&!e.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:e},CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)}(),CKEDITOR.tools.buildTableMap=function(e){for(var e=e.$.rows,t=-1,i=[],n=0;n<e.length;n++){t++,!i[t]&&(i[t]=[]);for(var r=-1,o=0;o<e[n].cells.length;o++){var s=e[n].cells[o];for(r++;i[t][r];)r++;for(var a=isNaN(s.colSpan)?1:s.colSpan,s=isNaN(s.rowSpan)?1:s.rowSpan,l=0;l<s;l++){i[t+l]||(i[t+l]=[]);for(var u=0;u<a;u++)i[t+l][r+u]=e[n].cells[o]}r+=a-1}}return i},function(){function e(e){function i(){for(var i=n(),o=CKEDITOR.tools.clone(e.config.toolbarGroups)||t(e),s=0;s<o.length;s++){var a=o[s];if("/"!=a){"string"==typeof a&&(a=o[s]={name:a});var l,u=a.groups;if(u)for(var c=0;c<u.length;c++)l=u[c],(l=i[l])&&r(a,l);(l=i[a.name])&&r(a,l)}}return o}function n(){var t,i,n,r={};for(t in e.ui.items)i=e.ui.items[t],n=i.toolbar||"others",n=n.split(","),i=n[0],n=parseInt(n[1]||-1,10),r[i]||(r[i]=[]),r[i].push({name:t,order:n});for(i in r)r[i]=r[i].sort(function(e,t){return e.order==t.order?0:t.order<0?-1:e.order<0?1:e.order<t.order?-1:1});return r}function r(t,i){if(i.length){t.items?t.items.push(e.ui.create("-")):t.items=[];for(var n;n=i.shift();)n="string"==typeof n?n:n.name,s&&CKEDITOR.tools.indexOf(s,n)!=-1||(n=e.ui.create(n))&&e.addFeature(n)&&t.items.push(n)}}function o(e){var t,i,n,o=[];for(t=0;t<e.length;++t)i=e[t],n={},"/"==i?o.push(i):CKEDITOR.tools.isArray(i)?(r(n,CKEDITOR.tools.clone(i)),o.push(n)):i.items&&(r(n,CKEDITOR.tools.clone(i.items)),n.name=i.name,o.push(n));return o}var s=e.config.removeButtons,s=s&&s.split(","),a=e.config.toolbar;return"string"==typeof a&&(a=e.config["toolbar_"+a]),e.toolbar=a?o(a):i()}function t(e){return e._.toolbarGroups||(e._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var i=function(){this.toolbars=[],this.focusCommandExecuted=!1};i.prototype.focus=function(){for(var e,t=0;e=this.toolbars[t++];)for(var i,n=0;i=e.items[n++];)if(i.focus)return void i.focus()};var n={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(e){e.toolbox&&(e.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){e.toolbox.focus()},100):e.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(t){var r,o=function(e,i){var n,s="rtl"==t.lang.dir,a=t.config.toolbarGroupCycling,l=s?37:39,s=s?39:37,a=void 0===a||a;switch(i){case 9:case CKEDITOR.SHIFT+9:for(;!n||!n.items.length;)if(n=9==i?(n?n.next:e.toolbar.next)||t.toolbox.toolbars[0]:(n?n.previous:e.toolbar.previous)||t.toolbox.toolbars[t.toolbox.toolbars.length-1],n.items.length)for(e=n.items[r?n.items.length-1:0];e&&!e.focus;)(e=r?e.previous:e.next)||(n=0);return e&&e.focus(),!1;case l:n=e;do n=n.next,!n&&a&&(n=e.toolbar.items[0]);while(n&&!n.focus);return n?n.focus():o(e,9),!1;case 40:return e.button&&e.button.hasArrow?(t.once("panelShow",function(e){e.data._.panel._.currentBlock.onKeyDown(40)}),e.execute()):o(e,40==i?l:s),!1;case s:case 38:n=e;do n=n.previous,!n&&a&&(n=e.toolbar.items[e.toolbar.items.length-1]);while(n&&!n.focus);return n?n.focus():(r=1,o(e,CKEDITOR.SHIFT+9),r=0),!1;case 27:return t.focus(),!1;case 13:case 32:return e.execute(),!1}return!0};t.on("uiSpace",function(n){if(n.data.space==t.config.toolbarLocation){n.removeListener(),t.toolbox=new i;var r,s,a=CKEDITOR.tools.getNextId(),l=['<span id="',a,'" class="cke_voice_label">',t.lang.toolbar.toolbars,"</span>",'<span id="'+t.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',a,'" onmousedown="return false;">'],a=t.config.toolbarStartupExpanded!==!1;t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&l.push('<span class="cke_toolbox_main"'+(a?">":' style="display:none">'));for(var u=t.toolbox.toolbars,c=e(t),h=0;h<c.length;h++){var d,p,f,m=0,g=c[h];if(g)if(r&&(l.push("</span>"),s=r=0),"/"===g)l.push('<span class="cke_toolbar_break"></span>');else{f=g.items||g;for(var y=0;y<f.length;y++){var v,E=f[y];if(E)if(E.type==CKEDITOR.UI_SEPARATOR)s=r&&E;else{if(v=E.canGroup!==!1,!m){d=CKEDITOR.tools.getNextId(),m={id:d,items:[]},p=g.name&&(t.lang.toolbar.toolbarGroups[g.name]||g.name),l.push('<span id="',d,'" class="cke_toolbar"',p?' aria-labelledby="'+d+'_label"':"",' role="toolbar">'),p&&l.push('<span id="',d,'_label" class="cke_voice_label">',p,"</span>"),l.push('<span class="cke_toolbar_start"></span>');var T=u.push(m)-1;T>0&&(m.previous=u[T-1],m.previous.next=m)}v?r||(l.push('<span class="cke_toolgroup" role="presentation">'),r=1):r&&(l.push("</span>"),r=0),d=function(e){e=e.render(t,l),T=m.items.push(e)-1,T>0&&(e.previous=m.items[T-1],e.previous.next=e),e.toolbar=m,e.onkey=o,e.onfocus=function(){t.toolbox.focusCommandExecuted||t.focus()}},s&&(d(s),s=0),d(E)}}r&&(l.push("</span>"),s=r=0),m&&l.push('<span class="cke_toolbar_end"></span></span>')}}if(t.config.toolbarCanCollapse&&l.push("</span>"),t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var b=CKEDITOR.tools.addFunction(function(){t.execCommand("toolbarCollapse")});t.on("destroy",function(){CKEDITOR.tools.removeFunction(b)}),t.addCommand("toolbarCollapse",{readOnly:1,exec:function(e){var t=e.ui.space("toolbar_collapser"),i=t.getPrevious(),n=e.ui.space("contents"),r=i.getParent(),o=parseInt(n.$.style.height,10),s=r.$.offsetHeight,a=t.hasClass("cke_toolbox_collapser_min");a?(i.show(),t.removeClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarCollapse)):(i.hide(),t.addClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarExpand)),t.getFirst().setText(a?"▲":"◀"),n.setStyle("height",o-(r.$.offsetHeight-s)+"px"),e.fire("resize")},modes:{wysiwyg:1,source:1}}),t.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse"),l.push('<a title="'+(a?t.lang.toolbar.toolbarCollapse:t.lang.toolbar.toolbarExpand)+'" id="'+t.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser'),a||l.push(" cke_toolbox_collapser_min"),l.push('" onclick="CKEDITOR.tools.callFunction('+b+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}l.push("</span>"),n.data.html=n.data.html+l.join("")}}),t.on("destroy",function(){if(this.toolbox){var e,t,i,n,r=0;for(e=this.toolbox.toolbars;r<e.length;r++)for(i=e[r].items,t=0;t<i.length;t++)n=i[t],n.clickFn&&CKEDITOR.tools.removeFunction(n.clickFn),n.keyDownFn&&CKEDITOR.tools.removeFunction(n.keyDownFn)}}),t.on("uiReady",function(){var e=t.ui.space("toolbox");e&&t.focusManager.add(e,1)}),t.addCommand("toolbarFocus",n),t.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus"),t.ui.add("-",CKEDITOR.UI_SEPARATOR,{}),t.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(e,t){return t.push('<span class="cke_toolbar_separator" role="separator"></span>'),{}}}}})}}),CKEDITOR.ui.prototype.addToolbarGroup=function(e,i,n){var r=t(this.editor),o=0===i,s={name:e};if(n){if(n=CKEDITOR.tools.search(r,function(e){return e.name==n}))return!n.groups&&(n.groups=[]),i&&(i=CKEDITOR.tools.indexOf(n.groups,i),i>=0)?void n.groups.splice(i+1,0,e):void(o?n.groups.splice(0,0,e):n.groups.push(e));i=null}i&&(i=CKEDITOR.tools.indexOf(r,function(e){return e.name==i})),o?r.splice(0,0,e):"number"==typeof i?r.splice(i+1,0,s):r.push(e)}}(),CKEDITOR.UI_SEPARATOR="separator",CKEDITOR.config.toolbarLocation="top",function(){var e=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90],t={8:1,46:1};CKEDITOR.plugins.add("undo",{init:function(t){function n(e){s.enabled&&e.data.command.canUndo!==!1&&s.save()}function r(){s.enabled=!t.readOnly&&"wysiwyg"==t.mode,s.onChange()}var s=t.undoManager=new i(t),a=s.editingHandler=new o(s),l=t.addCommand("undo",{exec:function(){s.undo()&&(t.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),u=t.addCommand("redo",{exec:function(){s.redo()&&(t.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});t.setKeystroke([[e[0],"undo"],[e[1],"redo"],[e[2],"redo"]]),s.onChange=function(){l.setState(s.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),u.setState(s.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},t.on("beforeCommandExec",n),t.on("afterCommandExec",n),t.on("saveSnapshot",function(e){s.save(e.data&&e.data.contentOnly)}),t.on("contentDom",a.attachListeners,a),t.on("instanceReady",function(){t.fire("saveSnapshot")}),t.on("beforeModeUnload",function(){"wysiwyg"==t.mode&&s.save(!0)}),t.on("mode",r),t.on("readOnly",r),t.ui.addButton&&(t.ui.addButton("Undo",{label:t.lang.undo.undo,command:"undo",toolbar:"undo,10"}),t.ui.addButton("Redo",{label:t.lang.undo.redo,command:"redo",toolbar:"undo,20"})),t.resetUndo=function(){s.reset(),t.fire("saveSnapshot")},t.on("updateSnapshot",function(){s.currentImage&&s.update()}),t.on("lockSnapshot",function(e){e=e.data,s.lock(e&&e.dontUpdate,e&&e.forceUpdate)}),t.on("unlockSnapshot",s.unlock,s)}}),CKEDITOR.plugins.undo={};var i=CKEDITOR.plugins.undo.UndoManager=function(e){this.strokesRecorded=[0,0],this.locked=null,this.previousKeyGroup=-1,this.limit=e.config.undoStackSize||20,this.strokesLimit=25,this.editor=e,this.reset()};i.prototype={type:function(e,t){var n=i.getKeyGroup(e),r=this.strokesRecorded[n]+1,t=t||r>=this.strokesLimit;this.typing||(this.hasUndo=this.typing=!0,this.hasRedo=!1,this.onChange()),t?(r=0,this.editor.fire("saveSnapshot")):this.editor.fire("change"),this.strokesRecorded[n]=r,this.previousKeyGroup=n},keyGroupChanged:function(e){return i.getKeyGroup(e)!=this.previousKeyGroup},reset:function(){this.snapshots=[],this.index=-1,this.currentImage=null,this.hasRedo=this.hasUndo=!1,this.locked=null,this.resetType()},resetType:function(){this.strokesRecorded=[0,0],this.typing=!1,this.previousKeyGroup=-1},refreshState:function(){this.hasUndo=!!this.getNextImage(!0),this.hasRedo=!!this.getNextImage(!1),this.resetType(),this.onChange()},save:function(e,t,i){var r=this.editor;if(this.locked||"ready"!=r.status||"wysiwyg"!=r.mode)return!1;var o=r.editable();if(!o||"ready"!=o.status)return!1;if(o=this.snapshots,t||(t=new n(r)),t.contents===!1)return!1;if(this.currentImage)if(t.equalsContent(this.currentImage)){if(e||t.equalsSelection(this.currentImage))return!1}else i!==!1&&r.fire("change");return o.splice(this.index+1,o.length-this.index-1),o.length==this.limit&&o.shift(),this.index=o.push(t)-1,this.currentImage=t,i!==!1&&this.refreshState(),!0},restoreImage:function(e){var t,i=this.editor;e.bookmarks&&(i.focus(),t=i.getSelection()),this.locked={level:999},this.editor.loadSnapshot(e.contents),e.bookmarks?t.selectBookmarks(e.bookmarks):CKEDITOR.env.ie&&(t=this.editor.document.getBody().$.createTextRange(),t.collapse(!0),t.select()),this.locked=null,this.index=e.index,this.currentImage=this.snapshots[this.index],this.update(),this.refreshState(),i.fire("change")},getNextImage:function(e){var t,i=this.snapshots,n=this.currentImage;if(n)if(e){for(t=this.index-1;t>=0;t--)if(e=i[t],!n.equalsContent(e))return e.index=t,e}else for(t=this.index+1;t<i.length;t++)if(e=i[t],!n.equalsContent(e))return e.index=t,e;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var e=this.getNextImage(!0);if(e)return this.restoreImage(e),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var e=this.getNextImage(!1);if(e)return this.restoreImage(e),!0}return!1},update:function(e){if(!this.locked){e||(e=new n(this.editor));for(var t=this.index,i=this.snapshots;t>0&&this.currentImage.equalsContent(i[t-1]);)t-=1;i.splice(t,this.index-t+1,e),this.index=t,this.currentImage=e}},updateSelection:function(e){if(!this.snapshots.length)return!1;var t=this.snapshots,i=t[t.length-1];return!(!i.equalsContent(e)||i.equalsSelection(e))&&(this.currentImage=t[t.length-1]=e,!0)},lock:function(e,t){if(this.locked)this.locked.level++;else if(e)this.locked={level:1};else{var i=null;if(t)i=!0;else{var r=new n(this.editor,(!0));this.currentImage&&this.currentImage.equalsContent(r)&&(i=r)}this.locked={update:i,level:1}}},unlock:function(){if(this.locked&&!--this.locked.level){var e=this.locked.update;if(this.locked=null,e===!0)this.update();else if(e){var t=new n(this.editor,(!0));e.equalsContent(t)||this.update()}}}},i.navigationKeyCodes={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1},i.keyGroups={PRINTABLE:0,FUNCTIONAL:1},i.isNavigationKey=function(e){return!!i.navigationKeyCodes[e]},i.getKeyGroup=function(e){var n=i.keyGroups;return t[e]?n.FUNCTIONAL:n.PRINTABLE},i.getOppositeKeyGroup=function(e){var t=i.keyGroups;return e==t.FUNCTIONAL?t.PRINTABLE:t.FUNCTIONAL},i.ieFunctionalKeysBug=function(e){return CKEDITOR.env.ie&&i.getKeyGroup(e)==i.keyGroups.FUNCTIONAL};var n=CKEDITOR.plugins.undo.Image=function(e,t){this.editor=e,e.fire("beforeUndoImage");var i=e.getSnapshot();CKEDITOR.env.ie&&i&&(i=i.replace(/\s+data-cke-expando=".*?"/g,"")),this.contents=i,t||(this.bookmarks=(i=i&&e.getSelection())&&i.createBookmarks2(!0)),e.fire("afterUndoImage")},r=/\b(?:href|src|name)="[^"]*?"/gi;n.prototype={equalsContent:function(e){var t=this.contents,e=e.contents;return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)&&(t=t.replace(r,""),e=e.replace(r,"")),t==e},equalsSelection:function(e){var t=this.bookmarks,e=e.bookmarks;if(t||e){if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;i++){var n=t[i],r=e[i];if(n.startOffset!=r.startOffset||n.endOffset!=r.endOffset||!CKEDITOR.tools.arrayCompare(n.start,r.start)||!CKEDITOR.tools.arrayCompare(n.end,r.end))return!1}}return!0}};var o=CKEDITOR.plugins.undo.NativeEditingHandler=function(e){this.undoManager=e,this.ignoreInputEvent=!1,this.keyEventsStack=new s,this.lastKeydownImage=null};o.prototype={onKeydown:function(t){var r=t.data.getKey();229!==r&&(CKEDITOR.tools.indexOf(e,t.data.getKeystroke())>-1?t.data.preventDefault():(this.keyEventsStack.cleanUp(t),t=this.undoManager,this.keyEventsStack.getLast(r)||this.keyEventsStack.push(r),this.lastKeydownImage=new n(t.editor),(i.isNavigationKey(r)||this.undoManager.keyGroupChanged(r))&&(t.strokesRecorded[0]||t.strokesRecorded[1])&&(t.save(!1,this.lastKeydownImage,!1),t.resetType())))},onInput:function(){if(this.ignoreInputEvent)this.ignoreInputEvent=!1;else{var e=this.keyEventsStack.getLast();e||(e=this.keyEventsStack.push(0)),this.keyEventsStack.increment(e.keyCode),this.keyEventsStack.getTotalInputs()>=this.undoManager.strokesLimit&&(this.undoManager.type(e.keyCode,!0),this.keyEventsStack.resetInputs())}},onKeyup:function(e){var t=this.undoManager,e=e.data.getKey(),r=this.keyEventsStack.getTotalInputs();this.keyEventsStack.remove(e),i.ieFunctionalKeysBug(e)&&this.lastKeydownImage&&this.lastKeydownImage.equalsContent(new n(t.editor,(!0)))||(r>0?t.type(e):i.isNavigationKey(e)&&this.onNavigationKey(!0))},onNavigationKey:function(e){var t=this.undoManager;(e||!t.save(!0,null,!1))&&t.updateSelection(new n(t.editor)),t.resetType()},ignoreInputEventListener:function(){this.ignoreInputEvent=!0},attachListeners:function(){var e=this.undoManager.editor,t=e.editable(),n=this;t.attachListener(t,"keydown",function(e){n.onKeydown(e),i.ieFunctionalKeysBug(e.data.getKey())&&n.onInput()},null,null,999),t.attachListener(t,CKEDITOR.env.ie?"keypress":"input",n.onInput,n,null,999),t.attachListener(t,"keyup",n.onKeyup,n,null,999),t.attachListener(t,"paste",n.ignoreInputEventListener,n,null,999),t.attachListener(t,"drop",n.ignoreInputEventListener,n,null,999),t.attachListener(t.isInline()?t:e.document.getDocumentElement(),"click",function(){n.onNavigationKey()},null,null,999),t.attachListener(this.undoManager.editor,"blur",function(){n.keyEventsStack.remove(9)},null,null,999)}};var s=CKEDITOR.plugins.undo.KeyEventsStack=function(){this.stack=[]};s.prototype={push:function(e){return this.stack[this.stack.push({keyCode:e,inputs:0})-1]},getLastIndex:function(e){if("number"!=typeof e)return this.stack.length-1;for(var t=this.stack.length;t--;)if(this.stack[t].keyCode==e)return t;return-1},getLast:function(e){return e=this.getLastIndex(e),e!=-1?this.stack[e]:null},increment:function(e){this.getLast(e).inputs++},remove:function(e){e=this.getLastIndex(e),e!=-1&&this.stack.splice(e,1)},resetInputs:function(e){if("number"==typeof e)this.getLast(e).inputs=0;else for(e=this.stack.length;e--;)this.stack[e].inputs=0},getTotalInputs:function(){for(var e=this.stack.length,t=0;e--;)t+=this.stack[e].inputs;return t},cleanUp:function(e){e=e.data.$,!e.ctrlKey&&!e.metaKey&&this.remove(17),e.shiftKey||this.remove(16),e.altKey||this.remove(18)}}}(),CKEDITOR.plugins.add("wsc",{requires:"dialog",parseApi:function(e){e.config.wsc_onFinish="function"==typeof e.config.wsc_onFinish?e.config.wsc_onFinish:function(){},e.config.wsc_onClose="function"==typeof e.config.wsc_onClose?e.config.wsc_onClose:function(){}},parseConfig:function(e){e.config.wsc_customerId=e.config.wsc_customerId||CKEDITOR.config.wsc_customerId||"1:ua3xw1-2XyGJ3-GWruD3-6OFNT1-oXcuB1-nR6Bp4-hgQHc-EcYng3-sdRXG3-NOfFk",e.config.wsc_customDictionaryIds=e.config.wsc_customDictionaryIds||CKEDITOR.config.wsc_customDictionaryIds||"",e.config.wsc_userDictionaryName=e.config.wsc_userDictionaryName||CKEDITOR.config.wsc_userDictionaryName||"",e.config.wsc_customLoaderScript=e.config.wsc_customLoaderScript||CKEDITOR.config.wsc_customLoaderScript,CKEDITOR.config.wsc_cmd=e.config.wsc_cmd||CKEDITOR.config.wsc_cmd||"spell",CKEDITOR.config.wsc_version="v4.3.0-master-aa00a1e",CKEDITOR.config.wsc_removeGlobalVariable=!0},init:function(e){var t=CKEDITOR.env;this.parseConfig(e),this.parseApi(e),e.addCommand("checkspell",new CKEDITOR.dialogCommand("checkspell")).modes={wysiwyg:!(CKEDITOR.env.opera||CKEDITOR.env.air||document.domain!=window.location.hostname||t.ie&&(t.version<8||t.quirks))},"undefined"==typeof e.plugins.scayt&&e.ui.addButton&&e.ui.addButton("SpellChecker",{label:e.lang.wsc.toolbar,click:function(e){var t=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.container.getText():e.document.getBody().getText();(t=t.replace(/\s/g,""))?e.execCommand("checkspell"):alert("Nothing to check!")},toolbar:"spellchecker,10"}),CKEDITOR.dialog.add("checkspell",this.path+(CKEDITOR.env.ie&&CKEDITOR.env.version<=7?"dialogs/wsc_ie.js":window.postMessage?"dialogs/wsc.js":"dialogs/wsc_ie.js"))}}),function(){function e(e){var i=this.editor,n=e.document,r=n.body,o=n.getElementById("cke_actscrpt");o&&o.parentNode.removeChild(o),(o=n.getElementById("cke_shimscrpt"))&&o.parentNode.removeChild(o),(o=n.getElementById("cke_basetagscrpt"))&&o.parentNode.removeChild(o),r.contentEditable=!0,CKEDITOR.env.ie&&(r.hideFocus=!0,r.disabled=!0,r.removeAttribute("disabled")),delete this._.isLoadingData,this.$=r,n=new CKEDITOR.dom.document(n),this.setup(),this.fixInitialSelection(),CKEDITOR.env.ie&&(n.getDocumentElement().addClass(n.$.compatMode),i.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(n,"selectionchange",function(){var e=n.getBody(),t=i.getSelection(),r=t&&t.getRanges()[0];r&&e.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&r.startContainer.equals(e)&&setTimeout(function(){r=i.getSelection().getRanges()[0],r.startContainer.equals("body")||(e.getFirst().remove(1),r.moveToElementEditEnd(e),r.select())},0)})),(CKEDITOR.env.webkit||CKEDITOR.env.ie&&CKEDITOR.env.version>10)&&n.getDocumentElement().on("mousedown",function(e){e.data.getTarget().is("html")&&setTimeout(function(){i.editable().focus()})}),t(i);try{i.document.$.execCommand("2D-position",!1,!0)}catch(s){}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==i.document.$.compatMode)&&this.attachListener(this,"keydown",function(e){var t=e.data.getKeystroke();if(33==t||34==t)if(CKEDITOR.env.ie)setTimeout(function(){i.getSelection().scrollIntoView()},0);else if(i.window.$.innerHeight>this.$.offsetHeight){var n=i.createRange();n[33==t?"moveToElementEditStart":"moveToElementEditEnd"](this),n.select(),e.data.preventDefault()}}),CKEDITOR.env.ie&&this.attachListener(n,"blur",function(){try{n.$.selection.empty()}catch(e){}}),CKEDITOR.env.iOS&&this.attachListener(n,"touchend",function(){e.focus()}),r=i.document.getElementsByTag("title").getItem(0),r.data("cke-title",r.getText()),CKEDITOR.env.ie&&(i.document.$.title=this._.docTitle),CKEDITOR.tools.setTimeout(function(){"unloaded"==this.status&&(this.status="ready"),i.fire("contentDom"),this._.isPendingFocus&&(i.focus(),this._.isPendingFocus=!1),setTimeout(function(){i.fire("dataReady")},0),CKEDITOR.env.ie&&setTimeout(function(){if(i.document){var e=i.document.$.body;e.runtimeStyle.marginBottom="0px",e.runtimeStyle.marginBottom=""}},1e3)},0,this)}function t(e){function t(){var t;e.editable().attachListener(e,"selectionChange",function(){var n=e.getSelection().getSelectedElement();n&&(t&&(t.detachEvent("onresizestart",i),t=null),n.$.attachEvent("onresizestart",i),t=n.$)})}function i(e){e.returnValue=!1}if(CKEDITOR.env.gecko)try{var n=e.document.$;n.execCommand("enableObjectResizing",!1,!e.config.disableObjectResizing),n.execCommand("enableInlineTableEditing",!1,!e.config.disableNativeTableHandles)}catch(r){}else CKEDITOR.env.ie&&CKEDITOR.env.version<11&&e.config.disableObjectResizing&&t(e)}function i(){var e=[];if(CKEDITOR.document.$.documentMode>=8){e.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var t,i=[];for(t in CKEDITOR.dtd.$removeEmpty)i.push("html.CSS1Compat "+t+"[contenteditable=false]");e.push(i.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(e.push("html{height:100% !important}"),e.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));return e.push("html{cursor:text;*cursor:auto}"),e.push("img,input,textarea{cursor:default}"),e.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(e){e.config.fullPage&&e.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"}),e.addMode("wysiwyg",function(t){function i(i){i&&i.removeListener(),e.editable(new n(e,o.$.contentWindow.document.body)),e.setData(e.getData(1),t)}var r="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",r=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent(r)+"}())":"",o=CKEDITOR.dom.element.createFromHtml('<iframe src="'+r+'" frameBorder="0"></iframe>');o.setStyles({width:"100%",height:"100%"}),o.addClass("cke_wysiwyg_frame cke_reset");var s=e.ui.space("contents");s.append(o),(r=CKEDITOR.env.ie||CKEDITOR.env.gecko)&&o.on("load",i);var a=e.title,l=e.fire("ariaEditorHelpLabel",{}).label;if(a&&(CKEDITOR.env.ie&&l&&(a+=", "+l),o.setAttribute("title",a)),l){var a=CKEDITOR.tools.getNextId(),u=CKEDITOR.dom.element.createFromHtml('<span id="'+a+'" class="cke_voice_label">'+l+"</span>");s.append(u,1),o.setAttribute("aria-describedby",a)}e.on("beforeModeUnload",function(e){e.removeListener(),u&&u.remove()}),o.setAttributes({tabIndex:e.tabIndex,allowTransparency:"true"}),!r&&i(),CKEDITOR.env.webkit&&(r=function(){s.setStyle("width","100%"),o.hide(),o.setSize("width",s.getSize("width")),s.removeStyle("width"),o.show()},o.setCustomData("onResize",r),CKEDITOR.document.getWindow().on("resize",r)),e.fire("ariaWidget",o)})}}),CKEDITOR.editor.prototype.addContentsCss=function(e){var t=this.config,i=t.contentsCss;CKEDITOR.tools.isArray(i)||(t.contentsCss=i?[i]:[]),t.contentsCss.push(e)};var n=CKEDITOR.tools.createClass({$:function(){this.base.apply(this,arguments),this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(t){CKEDITOR.tools.setTimeout(e,0,this,t)},this),this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(e,t){var n=this.editor;if(t)this.setHtml(e),this.fixInitialSelection(),n.fire("dataReady");else{this._.isLoadingData=!0,n._.dataStore={id:1};var r=n.config,o=r.fullPage,s=r.docType,a=CKEDITOR.tools.buildStyleHtml(i()).replace(/<style>/,'<style data-cke-temp="1">');o||(a+=CKEDITOR.tools.buildStyleHtml(n.config.contentsCss));var l=r.baseHref?'<base href="'+r.baseHref+'" data-cke-temp="1" />':"";o&&(e=e.replace(/<!DOCTYPE[^>]*>/i,function(e){return n.docType=s=e,""}).replace(/<\?xml\s[^\?]*\?>/i,function(e){return n.xmlDeclaration=e,""})),e=n.dataProcessor.toHtml(e),o?(/<body[\s|>]/.test(e)||(e="<body>"+e),/<html[\s|>]/.test(e)||(e="<html>"+e+"</html>"),/<head[\s|>]/.test(e)?/<title[\s|>]/.test(e)||(e=e.replace(/<head[^>]*>/,"$&<title></title>")):e=e.replace(/<html[^>]*>/,"$&<head><title></title></head>"),l&&(e=e.replace(/<head[^>]*?>/,"$&"+l)),e=e.replace(/<\/head\s*>/,a+"$&"),e=s+e):e=r.docType+'<html dir="'+r.contentsLangDirection+'" lang="'+(r.contentsLanguage||n.langCode)+'"><head><title>'+this._.docTitle+"</title>"+l+a+"</head><body"+(r.bodyId?' id="'+r.bodyId+'"':"")+(r.bodyClass?' class="'+r.bodyClass+'"':"")+">"+e+"</body></html>",CKEDITOR.env.gecko&&(e=e.replace(/<body/,'<body contenteditable="true" '),CKEDITOR.env.version<2e4&&(e=e.replace(/<body[^>]*>/,"$&<!-- cke-content-start -->"))),r='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"</script>",CKEDITOR.env.ie&&CKEDITOR.env.version<9&&(r+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)</script>'),l&&CKEDITOR.env.ie&&CKEDITOR.env.version<10&&(r+='<script id="cke_basetagscrpt">var baseTag = document.querySelector( "base" );baseTag.href = baseTag.href;</script>'),e=e.replace(/(?=\s*<\/(:?head)>)/,r),this.clearCustomData(),this.clearListeners(),n.fire("contentDomUnload");var u=this.getDocument();try{u.write(e)}catch(c){setTimeout(function(){u.write(e)},0)}}},getData:function(e){if(e)return this.getHtml();var e=this.editor,t=e.config,i=t.fullPage,n=i&&e.docType,r=i&&e.xmlDeclaration,o=this.getDocument(),i=i?o.getDocumentElement().getOuterHtml():o.getBody().getHtml();return CKEDITOR.env.gecko&&t.enterMode!=CKEDITOR.ENTER_BR&&(i=i.replace(/<br>(?=\s*(:?$|<\/body>))/,"")),i=e.dataProcessor.toDataFormat(i),r&&(i=r+"\n"+i),n&&(i=n+"\n"+i),i},focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:n.baseProto.focus.call(this)},detach:function(){var e=this.editor,t=e.document,e=e.window.getFrame();n.baseProto.detach.call(this),this.clearCustomData(),t.getDocumentElement().clearCustomData(),e.clearCustomData(),CKEDITOR.tools.removeFunction(this._.frameLoadedHandler),(t=e.removeCustomData("onResize"))&&t.removeListener(),e.remove()}}})}(),CKEDITOR.config.disableObjectResizing=!1,CKEDITOR.config.disableNativeTableHandles=!0,
CKEDITOR.config.disableNativeSpellChecker=!0,CKEDITOR.config.contentsCss=CKEDITOR.getUrl("dependencies/ckeditor/contents.css"),CKEDITOR.config.plugins="dialogui,dialog,a11yhelp,about,basicstyles,blockquote,clipboard,panel,floatpanel,menu,contextmenu,elementspath,indent,indentlist,list,enterkey,entities,popup,filebrowser,floatingspace,listblock,button,richcombo,format,horizontalrule,htmlwriter,image,fakeobjects,link,magicline,maximize,pastefromword,pastetext,removeformat,resize,menubutton,scayt,showborders,sourcearea,specialchar,stylescombo,tab,table,tabletools,toolbar,undo,wsc,wysiwygarea",CKEDITOR.config.skin="moono",function(){var e=function(e,t){for(var i=CKEDITOR.getUrl("plugins/"+t),e=e.split(","),n=0;n<e.length;n++)CKEDITOR.skin.icons[e[n]]={path:i,offset:-e[++n],bgsize:e[++n]}};CKEDITOR.env.hidpi?e("about,0,,bold,24,,italic,48,,strike,72,,subscript,96,,superscript,120,,underline,144,,bidiltr,168,,bidirtl,192,,blockquote,216,,copy-rtl,240,,copy,264,,cut-rtl,288,,cut,312,,paste-rtl,336,,paste,360,,codesnippet,384,,bgcolor,408,,textcolor,432,,creatediv,456,,docprops-rtl,480,,docprops,504,,find-rtl,528,,find,552,,replace,576,,flash,600,,button,624,,checkbox,648,,form,672,,hiddenfield,696,,imagebutton,720,,radio,744,,select-rtl,768,,select,792,,textarea-rtl,816,,textarea,840,,textfield-rtl,864,,textfield,888,,horizontalrule,912,,iframe,936,,image,960,,indent-rtl,984,,indent,1008,,outdent-rtl,1032,,outdent,1056,,justifyblock,1080,,justifycenter,1104,,justifyleft,1128,,justifyright,1152,,language,1176,,anchor-rtl,1200,,anchor,1224,,link,1248,,unlink,1272,,bulletedlist-rtl,1296,,bulletedlist,1320,,numberedlist-rtl,1344,,numberedlist,1368,,mathjax,1392,,maximize,1416,,newpage-rtl,1440,,newpage,1464,,pagebreak-rtl,1488,,pagebreak,1512,,pastefromword-rtl,1536,,pastefromword,1560,,pastetext-rtl,1584,,pastetext,1608,,placeholder,1632,,preview-rtl,1656,,preview,1680,,print,1704,,removeformat,1728,,save,1752,,scayt,1776,,selectall,1800,,showblocks-rtl,1824,,showblocks,1848,,smiley,1872,,source-rtl,1896,,source,1920,,sourcedialog-rtl,1944,,sourcedialog,1968,,specialchar,1992,,table,2016,,templates-rtl,2040,,templates,2064,,uicolor,2088,,redo-rtl,2112,,redo,2136,,undo-rtl,2160,,undo,2184,,simplebox,4416,auto,spellchecker,2232,","icons_hidpi.png"):e("about,0,auto,bold,24,auto,italic,48,auto,strike,72,auto,subscript,96,auto,superscript,120,auto,underline,144,auto,bidiltr,168,auto,bidirtl,192,auto,blockquote,216,auto,copy-rtl,240,auto,copy,264,auto,cut-rtl,288,auto,cut,312,auto,paste-rtl,336,auto,paste,360,auto,codesnippet,384,auto,bgcolor,408,auto,textcolor,432,auto,creatediv,456,auto,docprops-rtl,480,auto,docprops,504,auto,find-rtl,528,auto,find,552,auto,replace,576,auto,flash,600,auto,button,624,auto,checkbox,648,auto,form,672,auto,hiddenfield,696,auto,imagebutton,720,auto,radio,744,auto,select-rtl,768,auto,select,792,auto,textarea-rtl,816,auto,textarea,840,auto,textfield-rtl,864,auto,textfield,888,auto,horizontalrule,912,auto,iframe,936,auto,image,960,auto,indent-rtl,984,auto,indent,1008,auto,outdent-rtl,1032,auto,outdent,1056,auto,justifyblock,1080,auto,justifycenter,1104,auto,justifyleft,1128,auto,justifyright,1152,auto,language,1176,auto,anchor-rtl,1200,auto,anchor,1224,auto,link,1248,auto,unlink,1272,auto,bulletedlist-rtl,1296,auto,bulletedlist,1320,auto,numberedlist-rtl,1344,auto,numberedlist,1368,auto,mathjax,1392,auto,maximize,1416,auto,newpage-rtl,1440,auto,newpage,1464,auto,pagebreak-rtl,1488,auto,pagebreak,1512,auto,pastefromword-rtl,1536,auto,pastefromword,1560,auto,pastetext-rtl,1584,auto,pastetext,1608,auto,placeholder,1632,auto,preview-rtl,1656,auto,preview,1680,auto,print,1704,auto,removeformat,1728,auto,save,1752,auto,scayt,1776,auto,selectall,1800,auto,showblocks-rtl,1824,auto,showblocks,1848,auto,smiley,1872,auto,source-rtl,1896,auto,source,1920,auto,sourcedialog-rtl,1944,auto,sourcedialog,1968,auto,specialchar,1992,auto,table,2016,auto,templates-rtl,2040,auto,templates,2064,auto,uicolor,2088,auto,redo-rtl,2112,auto,redo,2136,auto,undo-rtl,2160,auto,undo,2184,auto,simplebox,2208,auto,spellchecker,2232,auto","icons.png")}())}(),function(e,t){return"function"==typeof define&&define.amd?void define(["angular","ckeditor"],function(e){return t(e)}):t(e)}(angular||null,function(e){var t,i=e.module("ngCkeditor",[]),n=!1;return i.run(["$q","$timeout",function(i,r){function o(){"loaded"==CKEDITOR.status?(n=!0,t.resolve()):o()}if(t=i.defer(),e.isUndefined(CKEDITOR))throw new Error("CKEDITOR not found");CKEDITOR.disableAutoInline=!0,CKEDITOR.on("loaded",o),r(o,100)}]),i.directive("ckeditor",["$timeout","$q",function(i,r){"use strict";return{restrict:"AC",require:["ngModel","^?form"],scope:!1,link:function(o,s,a,l){var u=l[0],c=l[1]||null,h="<p></p>",d="textarea"==s[0].tagName.toLowerCase(),p=[],f=!1;d||s.attr("contenteditable",!0);var m=function(){var t={toolbar:"full",toolbar_full:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"paragraph",items:["BulletedList","NumberedList","Blockquote"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"tools",items:["SpellChecker","Maximize"]},"/",{name:"styles",items:["Format","FontSize","TextColor","PasteText","PasteFromWord","RemoveFormat"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"forms",items:["Outdent","Indent"]},{name:"clipboard",items:["Undo","Redo"]},{name:"document",items:["PageBreak","Source"]}],disableNativeSpellChecker:!1,uiColor:"#FAFAFA",height:"400px",width:"100%"};t=e.extend(t,o[a.ckeditor]);var n=d?CKEDITOR.replace(s[0],t):CKEDITOR.inline(s[0],t),l=r.defer();s.bind("$destroy",function(){n.destroy(!1)});var m=function(e){i(function(){var t=n.getData();""==t&&(t=null),(e!==!0||t!=u.$viewValue)&&u.$setViewValue(t),e===!0&&c&&c.$setPristine()},0)},g=function(e){if(p.length){var t=p.pop()||h;f=!1,n.setData(t,function(){m(e),f=!0})}};n.on("change",m),n.on("blur",m),n.on("key",m),n.on("instanceReady",function(){o.$broadcast("ckeditor.ready"),o.$apply(function(){g(!0)}),n.document.on("keyup",m)}),n.on("customConfigLoaded",function(){l.resolve()}),u.$render=function(){p.push(u.$viewValue),f&&g()}};"loaded"==CKEDITOR.status&&(n=!0),n?m():t.promise.then(m)}}}]),i}),function(e,t){"use strict";function i(){n.READY||(v.determineEventTypes(),y.each(n.gestures,function(e){T.register(e)}),v.onTouch(n.DOCUMENT,p,T.detect),v.onTouch(n.DOCUMENT,f,T.detect),n.READY=!0)}var n=function b(e,t){return new b.Instance(e,t||{})};n.VERSION="1.1.3",n.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.DOCUMENT=document,n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&n.IS_MOBILE||n.HAS_POINTEREVENTS,n.CALCULATE_INTERVAL=25;var r={},o=n.DIRECTION_DOWN="down",s=n.DIRECTION_LEFT="left",a=n.DIRECTION_UP="up",l=n.DIRECTION_RIGHT="right",u=n.POINTER_MOUSE="mouse",c=n.POINTER_TOUCH="touch",h=n.POINTER_PEN="pen",d=n.EVENT_START="start",p=n.EVENT_MOVE="move",f=n.EVENT_END="end",m=n.EVENT_RELEASE="release",g=n.EVENT_TOUCH="touch";n.READY=!1,n.plugins=n.plugins||{},n.gestures=n.gestures||{};var y=n.utils={extend:function(e,i,n){for(var r in i)!i.hasOwnProperty(r)||e[r]!==t&&n||(e[r]=i[r]);return e},on:function(e,t,i){e.addEventListener(t,i,!1)},off:function(e,t,i){e.removeEventListener(t,i,!1)},each:function(e,i,n){var r,o;if("forEach"in e)e.forEach(i,n);else if(e.length!==t){for(r=0,o=e.length;r<o;r++)if(i.call(n,e[r],r,e)===!1)return}else for(r in e)if(e.hasOwnProperty(r)&&i.call(n,e[r],r,e)===!1)return},inStr:function(e,t){return e.indexOf(t)>-1},inArray:function(e,t){if(e.indexOf){var i=e.indexOf(t);return i!==-1&&i}for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return!1},toArray:function(e){return Array.prototype.slice.call(e,0)},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],i=[],n=[],r=[],o=Math.min,s=Math.max;return 1===e.length?{pageX:e[0].pageX,pageY:e[0].pageY,clientX:e[0].clientX,clientY:e[0].clientY}:(y.each(e,function(e){t.push(e.pageX),i.push(e.pageY),n.push(e.clientX),r.push(e.clientY)}),{pageX:(o.apply(Math,t)+s.apply(Math,t))/2,pageY:(o.apply(Math,i)+s.apply(Math,i))/2,clientX:(o.apply(Math,n)+s.apply(Math,n))/2,clientY:(o.apply(Math,r)+s.apply(Math,r))/2})},getVelocity:function(e,t,i){return{x:Math.abs(t/e)||0,y:Math.abs(i/e)||0}},getAngle:function(e,t){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(e,t){var i=Math.abs(e.clientX-t.clientX),n=Math.abs(e.clientY-t.clientY);return i>=n?e.clientX-t.clientX>0?s:l:e.clientY-t.clientY>0?a:o},getDistance:function(e,t){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==a||e==o},setPrefixedCss:function(e,t,i,n){var r=["","Webkit","Moz","O","ms"];t=y.toCamelCase(t);for(var o=0;o<r.length;o++){var s=t;if(r[o]&&(s=r[o]+s.slice(0,1).toUpperCase()+s.slice(1)),s in e.style){e.style[s]=(null==n||n)&&i||"";break}}},toggleBehavior:function(e,t,i){if(t&&e&&e.style){y.each(t,function(t,n){y.setPrefixedCss(e,n,t,i)});var n=i&&function(){return!1};"none"==t.userSelect&&(e.onselectstart=n),"none"==t.userDrag&&(e.ondragstart=n)}},toCamelCase:function(e){return e.replace(/[_-]([a-z])/g,function(e){return e[1].toUpperCase()})}},v=n.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(e,t,i,n){var r=t.split(" ");y.each(r,function(t){y.on(e,t,i),n&&n(t)})},off:function(e,t,i,n){var r=t.split(" ");y.each(r,function(t){y.off(e,t,i),n&&n(t)})},onTouch:function(e,t,i){var o=this,s=function(r){var s,a=r.type.toLowerCase(),l=n.HAS_POINTEREVENTS,u=y.inStr(a,"mouse");u&&o.preventMouseEvents||(u&&t==d&&0===r.button?(o.preventMouseEvents=!1,o.shouldDetect=!0):l&&t==d?o.shouldDetect=1===r.buttons||E.matchType(c,r):u||t!=d||(o.preventMouseEvents=!0,o.shouldDetect=!0),l&&t!=f&&E.updatePointer(t,r),o.shouldDetect&&(s=o.doDetect.call(o,r,t,e,i)),s==f&&(o.preventMouseEvents=!1,o.shouldDetect=!1,E.reset()),l&&t==f&&E.updatePointer(t,r))};return this.on(e,r[t],s),s},doDetect:function(e,t,i,n){var r=this.getTouchList(e,t),o=r.length,s=t,a=r.trigger,l=o;t==d?a=g:t==f&&(a=m,l=r.length-(e.changedTouches?e.changedTouches.length:1)),l>0&&this.started&&(s=p),this.started=!0;var u=this.collectEventData(i,s,r,e);return t!=f&&n.call(T,u),a&&(u.changedLength=l,u.eventType=a,n.call(T,u),u.eventType=s,delete u.changedLength),s==f&&(n.call(T,u),this.started=!1),s},determineEventTypes:function(){var t;return t=n.HAS_POINTEREVENTS?e.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],r[d]=t[0],r[p]=t[1],r[f]=t[2],r},getTouchList:function(e,t){if(n.HAS_POINTEREVENTS)return E.getTouchList();if(e.touches){if(t==p)return e.touches;var i=[],r=[].concat(y.toArray(e.touches),y.toArray(e.changedTouches)),o=[];return y.each(r,function(e){y.inArray(i,e.identifier)===!1&&o.push(e),i.push(e.identifier)}),o}return e.identifier=1,[e]},collectEventData:function(e,t,i,n){var r=c;return y.inStr(n.type,"mouse")||E.matchType(u,n)?r=u:E.matchType(h,n)&&(r=h),{center:y.getCenter(i),timeStamp:Date.now(),target:n.target,touches:i,eventType:t,pointerType:r,srcEvent:n,preventDefault:function(){var e=this.srcEvent;e.preventManipulation&&e.preventManipulation(),e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return T.stopDetect()}}}},E=n.PointerEvent={pointers:{},getTouchList:function(){var e=[];return y.each(this.pointers,function(t){e.push(t)}),e},updatePointer:function(e,t){e==f||e!=f&&1!==t.buttons?delete this.pointers[t.pointerId]:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t)},matchType:function(e,t){if(!t.pointerType)return!1;var i=t.pointerType,n={};return n[u]=i===(t.MSPOINTER_TYPE_MOUSE||u),n[c]=i===(t.MSPOINTER_TYPE_TOUCH||c),n[h]=i===(t.MSPOINTER_TYPE_PEN||h),n[e]},reset:function(){this.pointers={}}},T=n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:y.extend({},t),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst,i=t.options;return y.each(this.gestures,function(n){!this.stopped&&t.enabled&&i[n.name]&&n.handler.call(n,e,t)},this),this.current&&(this.current.lastEvent=e),e.eventType==f&&this.stopDetect(),e}},stopDetect:function(){this.previous=y.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(e,t,i,r,o){var s=this.current,a=!1,l=s.lastCalcEvent,u=s.lastCalcData;l&&e.timeStamp-l.timeStamp>n.CALCULATE_INTERVAL&&(t=l.center,i=e.timeStamp-l.timeStamp,r=e.center.clientX-l.center.clientX,o=e.center.clientY-l.center.clientY,a=!0),e.eventType!=g&&e.eventType!=m||(s.futureCalcEvent=e),s.lastCalcEvent&&!a||(u.velocity=y.getVelocity(i,r,o),u.angle=y.getAngle(t,e.center),u.direction=y.getDirection(t,e.center),s.lastCalcEvent=s.futureCalcEvent||e,s.futureCalcEvent=e),e.velocityX=u.velocity.x,e.velocityY=u.velocity.y,e.interimAngle=u.angle,e.interimDirection=u.direction},extendEventData:function(e){var t=this.current,i=t.startEvent,n=t.lastEvent||i;e.eventType!=g&&e.eventType!=m||(i.touches=[],y.each(e.touches,function(e){i.touches.push({clientX:e.clientX,clientY:e.clientY})}));var r=e.timeStamp-i.timeStamp,o=e.center.clientX-i.center.clientX,s=e.center.clientY-i.center.clientY;return this.getCalculatedData(e,n.center,r,o,s),y.extend(e,{startEvent:i,deltaTime:r,deltaX:o,deltaY:s,distance:y.getDistance(i.center,e.center),angle:y.getAngle(i.center,e.center),direction:y.getDirection(i.center,e.center),scale:y.getScale(i.touches,e.touches),rotation:y.getRotation(i.touches,e.touches)}),e},register:function(e){var i=e.defaults||{};return i[e.name]===t&&(i[e.name]=!0),y.extend(n.defaults,i,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}};n.Instance=function(e,t){var r=this;i(),this.element=e,this.enabled=!0,y.each(t,function(e,i){delete t[i],t[y.toCamelCase(i)]=e}),this.options=y.extend(y.extend({},n.defaults),t||{}),this.options.behavior&&y.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=v.onTouch(e,d,function(e){r.enabled&&e.eventType==d?T.startDetect(r,e):e.eventType==g&&T.detect(e)}),this.eventHandlers=[]},n.Instance.prototype={on:function(e,t){var i=this;return v.on(i.element,e,t,function(e){i.eventHandlers.push({gesture:e,handler:t})}),i},off:function(e,t){var i=this;return v.off(i.element,e,t,function(e){var n=y.inArray({gesture:e,handler:t});n!==!1&&i.eventHandlers.splice(n,1)}),i},trigger:function(e,t){t||(t={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t;var r=this.element;return y.hasParent(t.target,r)&&(r=t.target),r.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this},dispose:function(){var e,t;for(y.toggleBehavior(this.element,this.options.behavior,!1),e=-1;t=this.eventHandlers[++e];)y.off(this.element,t.gesture,t.handler);return this.eventHandlers=[],v.off(this.element,r[d],this.eventStartHandler),null}},function(e){function t(t,n){var r=T.current;if(!(n.options.dragMaxTouches>0&&t.touches.length>n.options.dragMaxTouches))switch(t.eventType){case d:i=!1;break;case p:if(t.distance<n.options.dragMinDistance&&r.name!=e)return;var u=r.startEvent.center;if(r.name!=e&&(r.name=e,n.options.dragDistanceCorrection&&t.distance>0)){var c=Math.abs(n.options.dragMinDistance/t.distance);u.pageX+=t.deltaX*c,u.pageY+=t.deltaY*c,u.clientX+=t.deltaX*c,u.clientY+=t.deltaY*c,t=T.extendEventData(t)}(r.lastEvent.dragLockToAxis||n.options.dragLockToAxis&&n.options.dragLockMinDistance<=t.distance)&&(t.dragLockToAxis=!0);var h=r.lastEvent.direction;t.dragLockToAxis&&h!==t.direction&&(y.isVertical(h)?t.direction=t.deltaY<0?a:o:t.direction=t.deltaX<0?s:l),i||(n.trigger(e+"start",t),i=!0),n.trigger(e,t),n.trigger(e+t.direction,t);var g=y.isVertical(t.direction);(n.options.dragBlockVertical&&g||n.options.dragBlockHorizontal&&!g)&&t.preventDefault();break;case m:i&&t.changedLength<=n.options.dragMaxTouches&&(n.trigger(e+"end",t),i=!1);break;case f:i=!1}}var i=!1;n.gestures.Drag={name:e,index:50,handler:t,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),n.gestures.Gesture={name:"gesture",index:1337,handler:function(e,t){t.trigger(this.name,e)}},function(e){function t(t,n){var r=n.options,o=T.current;switch(t.eventType){case d:clearTimeout(i),o.name=e,i=setTimeout(function(){o&&o.name==e&&n.trigger(e,t)},r.holdTimeout);break;case p:t.distance>r.holdThreshold&&clearTimeout(i);break;case m:clearTimeout(i)}}var i;n.gestures.Hold={name:e,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:t}}("hold"),n.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==m&&t.trigger(this.name,e)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(e,t){if(e.eventType==m){var i=e.touches.length,n=t.options;if(i<n.swipeMinTouches||i>n.swipeMaxTouches)return;(e.velocityX>n.swipeVelocityX||e.velocityY>n.swipeVelocityY)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},function(e){function t(t,n){var r,o,s=n.options,a=T.current,l=T.previous;switch(t.eventType){case d:i=!1;break;case p:i=i||t.distance>s.tapMaxDistance;break;case f:!y.inStr(t.srcEvent.type,"cancel")&&t.deltaTime<s.tapMaxTime&&!i&&(r=l&&l.lastEvent&&t.timeStamp-l.lastEvent.timeStamp,o=!1,l&&l.name==e&&r&&r<s.doubleTapInterval&&t.distance<s.doubleTapDistance&&(n.trigger("doubletap",t),o=!0),o&&!s.tapAlways||(a.name=e,n.trigger(a.name,t)))}}var i=!1;n.gestures.Tap={name:e,index:100,handler:t,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),n.gestures.Touch={name:"touch",index:-(1/0),defaults:{preventDefault:!1,preventMouse:!1},handler:function(e,t){return t.options.preventMouse&&e.pointerType==u?void e.stopDetect():(t.options.preventDefault&&e.preventDefault(),void(e.eventType==g&&t.trigger("touch",e)))}},function(e){function t(t,n){switch(t.eventType){case d:i=!1;break;case p:if(t.touches.length<2)return;var r=Math.abs(1-t.scale),o=Math.abs(t.rotation);if(r<n.options.transformMinScale&&o<n.options.transformMinRotation)return;T.current.name=e,i||(n.trigger(e+"start",t),i=!0),n.trigger(e,t),o>n.options.transformMinRotation&&n.trigger("rotate",t),r>n.options.transformMinScale&&(n.trigger("pinch",t),n.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case m:i&&t.changedLength<2&&(n.trigger(e+"end",t),i=!1)}}var i=!1;n.gestures.Transform={name:e,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:t}}("transform"),"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:e.Hammer=n}(window),"undefined"==typeof jQuery)throw new Error("Bootstrap requires jQuery");+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in t)if(void 0!==e.style[i])return{end:t[i]}}e.fn.emulateTransitionEnd=function(t){var i=!1,n=this;e(this).one(e.support.transition.end,function(){i=!0});var r=function(){i||e(n).trigger(e.support.transition.end)};return setTimeout(r,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){"use strict";var t='[data-dismiss="alert"]',i=function(i){e(i).on("click",t,this.close)};i.prototype.close=function(t){function i(){o.trigger("closed.bs.alert").remove()}var n=e(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var o=e(r);t&&t.preventDefault(),o.length||(o=n.hasClass("alert")?n:n.parent()),o.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one(e.support.transition.end,i).emulateTransitionEnd(150):i())};var n=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var n=e(this),r=n.data("bs.alert");r||n.data("bs.alert",r=new i(this)),"string"==typeof t&&r[t].call(n)})},e.fn.alert.Constructor=i,e.fn.alert.noConflict=function(){return e.fn.alert=n,this},e(document).on("click.bs.alert.data-api",t,i.prototype.close)}(jQuery),+function(e){"use strict";var t=function(i,n){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,n)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",i=this.$element,n=i.is("input")?"val":"html",r=i.data();e+="Text",r.resetText||i.data("resetText",i[n]()),i[n](r[e]||this.options[e]),setTimeout(function(){"loadingText"==e?i.addClass(t).attr(t,t):i.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons"]'),t=!0;if(e.length){var i=this.$element.find("input");"radio"===i.prop("type")&&(i.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&i.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var i=e.fn.button;e.fn.button=function(i){return this.each(function(){var n=e(this),r=n.data("bs.button"),o="object"==typeof i&&i;r||n.data("bs.button",r=new t(this,o)),"toggle"==i?r.toggle():i&&r.setState(i)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=i,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var i=e(t.target);i.hasClass("btn")||(i=i.closest(".btn")),i.button("toggle"),t.preventDefault()})}(jQuery),+function(e){"use strict";var t=function(t,i){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var i=this,n=this.getActiveIndex();if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){i.to(t)}):n==t?this.pause().cycle():this.slide(t>n?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){if(!this.sliding)return this.slide("next")},t.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},t.prototype.slide=function(t,i){var n=this.$element.find(".item.active"),r=i||n[t](),o=this.interval,s="next"==t?"left":"right",a="next"==t?"first":"last",l=this;if(!r.length){if(!this.options.wrap)return;r=this.$element.find(".item")[a]()}this.sliding=!0,o&&this.pause();var u=e.Event("slide.bs.carousel",{relatedTarget:r[0],direction:s});if(!r.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(l.$indicators.children()[l.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(u),u.isDefaultPrevented())return;r.addClass(t),r[0].offsetWidth,n.addClass(s),r.addClass(s),n.one(e.support.transition.end,function(){r.removeClass([t,s].join(" ")).addClass("active"),n.removeClass(["active",s].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(u),u.isDefaultPrevented())return;n.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")}return o&&this.cycle(),this}};var i=e.fn.carousel;e.fn.carousel=function(i){return this.each(function(){var n=e(this),r=n.data("bs.carousel"),o=e.extend({},t.DEFAULTS,n.data(),"object"==typeof i&&i),s="string"==typeof i?i:o.slide;r||n.data("bs.carousel",r=new t(this,o)),"number"==typeof i?r.to(i):s?r[s]():o.interval&&r.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=i,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var i,n=e(this),r=e(n.attr("data-target")||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")),o=e.extend({},r.data(),n.data()),s=n.attr("data-slide-to");s&&(o.interval=!1),r.carousel(o),(s=n.attr("data-slide-to"))&&r.data("bs.carousel").to(s),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){"use strict";var t=function(i,n){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,n),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t=e.Event("show.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var i=this.$parent&&this.$parent.find("> .panel > .in");if(i&&i.length){var n=i.data("bs.collapse");if(n&&n.transitioning)return;i.collapse("hide"),n||i.data("bs.collapse",null)}var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0),this.transitioning=1;var o=function(){this.$element.removeClass("collapsing").addClass("in")[r]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return o.call(this);var s=e.camelCase(["scroll",r].join("-"));this.$element.one(e.support.transition.end,e.proxy(o,this)).emulateTransitionEnd(350)[r](this.$element[0][s])}}},t.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?void this.$element[i](0).one(e.support.transition.end,e.proxy(n,this)).emulateTransitionEnd(350):n.call(this)}}},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var i=e.fn.collapse;e.fn.collapse=function(i){return this.each(function(){var n=e(this),r=n.data("bs.collapse"),o=e.extend({},t.DEFAULTS,n.data(),"object"==typeof i&&i);r||n.data("bs.collapse",r=new t(this,o)),"string"==typeof i&&r[i]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var i,n=e(this),r=n.attr("data-target")||t.preventDefault()||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""),o=e(r),s=o.data("bs.collapse"),a=s?"toggle":n.data(),l=n.attr("data-parent"),u=l&&e(l);s&&s.transitioning||(u&&u.find('[data-toggle=collapse][data-parent="'+l+'"]').not(n).addClass("collapsed"),n[o.hasClass("in")?"addClass":"removeClass"]("collapsed")),o.collapse(a)})}(jQuery),+function(e){"use strict";function t(){e(n).remove(),e(r).each(function(t){var n=i(e(this));n.hasClass("open")&&(n.trigger(t=e.Event("hide.bs.dropdown")),t.isDefaultPrevented()||n.removeClass("open").trigger("hidden.bs.dropdown"))})}function i(t){var i=t.attr("data-target");i||(i=t.attr("href"),i=i&&/#/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&e(i);return n&&n.length?n:t.parent()}var n=".dropdown-backdrop",r="[data-toggle=dropdown]",o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.prototype.toggle=function(n){var r=e(this);if(!r.is(".disabled, :disabled")){var o=i(r),s=o.hasClass("open");if(t(),!s){if("ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t),o.trigger(n=e.Event("show.bs.dropdown")),n.isDefaultPrevented())return;o.toggleClass("open").trigger("shown.bs.dropdown"),r.focus()}return!1}},o.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var n=e(this);if(t.preventDefault(),t.stopPropagation(),!n.is(".disabled, :disabled")){var o=i(n),s=o.hasClass("open");if(!s||s&&27==t.keyCode)return 27==t.which&&o.find(r).focus(),n.click();var a=e("[role=menu] li:not(.divider):visible a",o);if(a.length){var l=a.index(a.filter(":focus"));38==t.keyCode&&l>0&&l--,40==t.keyCode&&l<a.length-1&&l++,~l||(l=0),a.eq(l).focus()}}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var i=e(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new o(this)),"string"==typeof t&&n[t].call(i)})},e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",r,o.prototype.toggle).on("keydown.bs.dropdown.data-api",r+", [role=menu]",o.prototype.keydown)}(jQuery),+function(e){"use strict";var t=function(t,i){this.options=i,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var i=this,n=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var n=e.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(document.body),i.$element.show(),n&&i.$element[0].offsetWidth,i.$element.addClass("in").attr("aria-hidden",!1),i.enforceFocus();var r=e.Event("shown.bs.modal",{relatedTarget:t});n?i.$element.find(".modal-dialog").one(e.support.transition.end,function(){i.$element.focus().trigger(r)}).emulateTransitionEnd(300):i.$element.focus().trigger(r)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal());
},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=e.support.transition&&i;if(this.$backdrop=e('<div class="modal-backdrop '+i+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;n?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var i=e.fn.modal;e.fn.modal=function(i,n){return this.each(function(){var r=e(this),o=r.data("bs.modal"),s=e.extend({},t.DEFAULTS,r.data(),"object"==typeof i&&i);o||r.data("bs.modal",o=new t(this,s)),"string"==typeof i?o[i](n):s.show&&o.show(n)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var i=e(this),n=i.attr("href"),r=e(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),o=r.data("modal")?"toggle":e.extend({remote:!/#/.test(n)&&n},r.data(),i.data());t.preventDefault(),r.modal(o,this).one("hide",function(){i.is(":visible")&&i.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){"use strict";var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,i,n){this.enabled=!0,this.type=t,this.$element=e(i),this.options=this.getOptions(n);for(var r=this.options.trigger.split(" "),o=r.length;o--;){var s=r[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focus",l="hover"==s?"mouseleave":"blur";this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},i=this.getDefaults();return this._options&&e.each(this._options,function(e,n){i[e]!=n&&(t[e]=n)}),t},t.prototype.enter=function(t){var i=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show()},t.prototype.leave=function(t){var i=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide()},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(t),t.isDefaultPrevented())return;var i=this.tip();this.setContent(),this.options.animation&&i.addClass("fade");var n="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,r=/\s?auto?\s?/i,o=r.test(n);o&&(n=n.replace(r,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(n),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var s=this.getPosition(),a=i[0].offsetWidth,l=i[0].offsetHeight;if(o){var u=this.$element.parent(),c=n,h=document.documentElement.scrollTop||document.body.scrollTop,d="body"==this.options.container?window.innerWidth:u.outerWidth(),p="body"==this.options.container?window.innerHeight:u.outerHeight(),f="body"==this.options.container?0:u.offset().left;n="bottom"==n&&s.top+s.height+l-h>p?"top":"top"==n&&s.top-h-l<0?"bottom":"right"==n&&s.right+a>d?"left":"left"==n&&s.left-a<f?"right":n,i.removeClass(c).addClass(n)}var m=this.getCalculatedOffset(n,s,a,l);this.applyPlacement(m,n),this.$element.trigger("shown.bs."+this.type)}},t.prototype.applyPlacement=function(e,t){var i,n=this.tip(),r=n[0].offsetWidth,o=n[0].offsetHeight,s=parseInt(n.css("margin-top"),10),a=parseInt(n.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top=e.top+s,e.left=e.left+a,n.offset(e).addClass("in");var l=n[0].offsetWidth,u=n[0].offsetHeight;if("top"==t&&u!=o&&(i=!0,e.top=e.top+o-u),/bottom|top/.test(t)){var c=0;e.left<0&&(c=e.left*-2,e.left=0,n.offset(e),l=n[0].offsetWidth,u=n[0].offsetHeight),this.replaceArrow(c-r+l,l,"left")}else this.replaceArrow(u-o,u,"top");i&&n.offset(e)},t.prototype.replaceArrow=function(e,t,i){this.arrow().css(i,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function t(){"in"!=i.hoverState&&n.detach()}var i=this,n=this.tip(),r=e.Event("hide.bs."+this.type);if(this.$element.trigger(r),!r.isDefaultPrevented())return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?n.one(e.support.transition.end,t).emulateTransitionEnd(150):t(),this.$element.trigger("hidden.bs."+this.type),this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,i,n){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-i/2}:"top"==e?{top:t.top-n,left:t.left+t.width/2-i/2}:"left"==e?{top:t.top+t.height/2-n/2,left:t.left-i}:{top:t.top+t.height/2-n/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,i=this.options;return e=t.attr("data-original-title")||("function"==typeof i.title?i.title.call(t[0]):i.title)},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var i=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;i.tip().hasClass("in")?i.leave(i):i.enter(i)},t.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var i=e.fn.tooltip;e.fn.tooltip=function(i){return this.each(function(){var n=e(this),r=n.data("bs.tooltip"),o="object"==typeof i&&i;r||n.data("bs.tooltip",r=new t(this,o)),"string"==typeof i&&r[i]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=i,this}}(jQuery),+function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](i),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var i=e.fn.popover;e.fn.popover=function(i){return this.each(function(){var n=e(this),r=n.data("bs.popover"),o="object"==typeof i&&i;r||n.data("bs.popover",r=new t(this,o)),"string"==typeof i&&r[i]()})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=i,this}}(jQuery),+function(e){"use strict";function t(i,n){var r,o=e.proxy(this.process,this);this.$element=e(e(i).is("body")?window:i),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",o),this.options=e.extend({},t.DEFAULTS,n),this.selector=(this.options.target||(r=e(i).attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var i=this;this.$body.find(this.selector).map(function(){var n=e(this),r=n.data("target")||n.attr("href"),o=/^#\w/.test(r)&&e(r);return o&&o.length&&[[o[t]().top+(!e.isWindow(i.$scrollElement.get(0))&&i.$scrollElement.scrollTop()),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){i.offsets.push(this[0]),i.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,i=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=i-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(t>=n)return s!=(e=o.last()[0])&&this.activate(e);for(e=r.length;e--;)s!=o[e]&&t>=r[e]&&(!r[e+1]||t<=r[e+1])&&this.activate(o[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parents(".active").removeClass("active");var i=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")};var i=e.fn.scrollspy;e.fn.scrollspy=function(i){return this.each(function(){var n=e(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new t(this,o)),"string"==typeof i&&r[i]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=i,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,i=t.closest("ul:not(.dropdown-menu)"),n=t.data("target");if(n||(n=t.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var r=i.find(".active:last a")[0],o=e.Event("show.bs.tab",{relatedTarget:r});if(t.trigger(o),!o.isDefaultPrevented()){var s=e(n);this.activate(t.parent("li"),i),this.activate(s,s.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:r})})}}},t.prototype.activate=function(t,i,n){function r(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),n&&n()}var o=i.find("> .active"),s=n&&e.support.transition&&o.hasClass("fade");s?o.one(e.support.transition.end,r).emulateTransitionEnd(150):r(),o.removeClass("in")};var i=e.fn.tab;e.fn.tab=function(i){return this.each(function(){var n=e(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new t(this)),"string"==typeof i&&r[i]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=i,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){"use strict";var t=function(i,n){this.options=e.extend({},t.DEFAULTS,n),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(i),this.affixed=this.unpin=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var i=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),o=this.options.offset,s=o.top,a=o.bottom;"object"!=typeof o&&(a=s=o),"function"==typeof s&&(s=o.top()),"function"==typeof a&&(a=o.bottom());var l=!(null!=this.unpin&&n+this.unpin<=r.top)&&(null!=a&&r.top+this.$element.height()>=i-a?"bottom":null!=s&&n<=s&&"top");this.affixed!==l&&(this.unpin&&this.$element.css("top",""),this.affixed=l,this.unpin="bottom"==l?r.top-n:null,this.$element.removeClass(t.RESET).addClass("affix"+(l?"-"+l:"")),"bottom"==l&&this.$element.offset({top:document.body.offsetHeight-a-this.$element.height()}))}};var i=e.fn.affix;e.fn.affix=function(i){return this.each(function(){var n=e(this),r=n.data("bs.affix"),o="object"==typeof i&&i;r||n.data("bs.affix",r=new t(this,o)),"string"==typeof i&&r[i]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=i,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),i=t.data();i.offset=i.offset||{},i.offsetBottom&&(i.offset.bottom=i.offsetBottom),i.offsetTop&&(i.offset.top=i.offsetTop),t.affix(i)})})}(jQuery);var THREE={REVISION:"78-nvs-r1"};"function"==typeof define&&define.amd?define("three",THREE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=THREE),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&!function(){Object.assign=function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}}(),Object.assign(THREE,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,CineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:THREE.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3e3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,RGBADepthPacking:3201}),THREE.Color=function(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){this.r=e,this.g=e,this.b=e},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,n){if(t=THREE.Math.euclideanModulo(t,1),i=THREE.Math.clamp(i,0,1),n=THREE.Math.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,o=2*n-r;this.r=e(o,r,t+1/3),this.g=e(o,r,t),this.b=e(o,r,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(s,a,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=i[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(e&&e.length>0){var u=THREE.ColorKeywords[e];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,n=e||{h:0,s:0,l:0},r=this.r,o=this.g,s=this.b,a=Math.max(r,o,s),l=Math.min(r,o,s),u=(l+a)/2;if(l===a)t=0,i=0;else{var c=a-l;switch(i=u<=.5?c/(a+l):c/(2-a-l),a){case r:t=(o-s)/c+(o<s?6:0);break;case o:t=(s-r)/c+2;break;case s:t=(r-o)/c+4}t/=6}return n.h=t,n.s=i,n.l=u,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),a=Math.sin(e._z/2),l=e.order;return"XYZ"===l?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"YXZ"===l?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"ZXY"===l?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"ZYX"===l?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"YZX"===l?(this._x=o*n*r+i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r-o*s*a):"XZY"===l&&(this._x=o*n*r-i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r+o*s*a),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-r)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this._w=(o-u)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-n-a),this._w=(s-r)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,i=1e-6;return function(n,r){return void 0===e&&(e=new THREE.Vector3),t=n.dot(r)+1,t<i?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+n*l-r*a,this._y=n*u+o*a+r*s-i*l,this._z=r*u+o*l+i*a-n*s,this._w=o*u-i*s-n*a-r*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,s=o*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Object.assign(THREE.Quaternion,{slerp:function(e,t,i,n){return i.copy(e).slerp(t,n)},slerpFlat:function(e,t,i,n,r,o,s){var a=i[n+0],l=i[n+1],u=i[n+2],c=i[n+3],h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(c!==f||a!==h||l!==d||u!==p){var m=1-s,g=a*h+l*d+u*p+c*f,y=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){var E=Math.sqrt(v),T=Math.atan2(E,g*y);m=Math.sin(m*T)/E,s=Math.sin(s*T)/E}var b=s*y;if(a=a*m+h*b,l=l*m+d*b,u=u*m+p*b,c=c*m+f*b,m===1-s){var C=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=C,l*=C,u*=C,c*=C}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this);
},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(i,i),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e;return function(t,i){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*i,u=a*i+s*t-r*n,c=a*n+r*i-o*t,h=-r*t-o*i-s*n;return this.x=l*a+h*-r+u*-s-c*-o,this.y=u*a+h*-o+c*-r-l*-s,this.z=c*a+h*-s+l*-o-u*-r,this},project:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromMatrixPosition:function(e){return this.setFromMatrixColumn(e,3)},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){if("number"==typeof e){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var i=e;e=t,t=i}return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},THREE.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=.01,s=.1,a=e.elements,l=a[0],u=a[4],c=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-h)<o&&Math.abs(c-f)<o&&Math.abs(p-m)<o){if(Math.abs(u+h)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var y=(l+1)/2,v=(d+1)/2,E=(g+1)/2,T=(u+h)/4,b=(c+f)/4,C=(p+m)/4;return y>v&&y>E?y<o?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(y),n=T/i,r=b/i):v>E?v<o?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=T/n,r=C/n):E<o?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(E),i=b/r,n=C/r),this.set(i,n,r,t),this}var O=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(O)<.001&&(O=1),this.x=(m-p)/O,this.y=(c-f)/O,this.z=(h-u)/O,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},THREE.Euler=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=THREE.Math.clamp,r=e.elements,o=r[0],s=r[4],a=r[8],l=r[1],u=r[5],c=r[9],h=r[2],d=r[6],p=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,i!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,i,n){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),o=t.dot(e),s=o/r;return n&&(s=THREE.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t),r=i||new THREE.Vector3;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2((+(1/0)),(+(1/0))),this.max=void 0!==t?t:new THREE.Vector2((-(1/0)),(-(1/0)))},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=+(1/0),this.max.x=this.max.y=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){var i=t||new THREE.Vector2;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var i=t||new THREE.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3((+(1/0)),(+(1/0)),(+(1/0))),this.max=void 0!==t?t:new THREE.Vector3((-(1/0)),(-(1/0)),(-(1/0)))},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=+(1/0),i=+(1/0),n=+(1/0),r=-(1/0),o=-(1/0),s=-(1/0),a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<n&&(n=h),u>r&&(r=u),c>o&&(o=c),h>s&&(s=h)}this.min.set(t,i,n),this.max.set(r,o,s)},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var n=t.geometry;if(void 0!==n)if(n instanceof THREE.Geometry)for(var r=n.vertices,o=0,s=r.length;o<s;o++)e.copy(r[o]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(n instanceof THREE.BufferGeometry&&void 0!==n.attributes.position)for(var a=n.attributes.position.array,o=0,s=a.length;o<s;o+=3)e.fromArray(a,o),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var i=t||new THREE.Vector3;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){var i=t||new THREE.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var i=t||new THREE.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,n,r,o,s,a,l){var u=this.elements;return u[0]=e,u[1]=n,u[2]=s,u[3]=t,u[4]=r,u[5]=a,u[6]=i,u[7]=o,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToVector3Array:function(){var e;return function(t,i,n){void 0===e&&(e=new THREE.Vector3),void 0===i&&(i=0),void 0===n&&(n=t.length);for(var r=0,o=i;r<n;r+=3,o+=3)e.fromArray(t,o),e.applyMatrix3(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,i,n){void 0===e&&(e=new THREE.Vector3),void 0===i&&(i=0),void 0===n&&(n=t.length/t.itemSize);for(var r=0,o=i;r<n;r++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*o*u-t*s*l-i*r*u+i*s*a+n*r*l-n*o*a},getInverse:function(e,t){e instanceof THREE.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=e.elements,n=this.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],u=i[5],c=i[6],h=i[7],d=i[8],p=d*l-u*h,f=u*c-d*a,m=h*a-l*c,g=r*p+o*f+s*m;if(0===g){var y="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(y);return console.warn(y),this.identity()}var v=1/g;return n[0]=p*v,n[1]=(s*h-d*o)*v,n[2]=(u*o-s*l)*v,n[3]=f*v,n[4]=(d*r-s*c)*v,n[5]=(s*a-u*r)*v,n[6]=m*v,n[7]=(o*c-h*r)*v,n[8]=(l*r-o*a)*v,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(e,t)},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,n,r,o,s,a,l,u,c,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new THREE.Vector3);var i=this.elements,n=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();
return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=o*u,d=o*c,p=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,y=l*u,v=l*c;t[0]=m+v*s,t[4]=y*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-y,t[6]=v+m*s,t[10]=o*a}else if("ZXY"===e.order){var m=a*u,g=a*c,y=l*u,v=l*c;t[0]=m-v*s,t[4]=-o*c,t[8]=y+g*s,t[1]=g+y*s,t[5]=o*u,t[9]=v-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){var h=o*u,d=o*c,p=s*u,f=s*c;t[0]=a*u,t[4]=p*l-d,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var E=o*a,T=o*l,b=s*a,C=s*l;t[0]=a*u,t[4]=C-E*c,t[8]=b*c+T,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=T*c+b,t[10]=E-C*c}else if("XZY"===e.order){var E=o*a,T=o*l,b=s*a,C=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=E*c+C,t[5]=o*u,t[9]=T*c-b,t[2]=b*c-T,t[6]=s*u,t[10]=C*c+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,s=i+i,a=n+n,l=r+r,u=i*s,c=i*a,h=i*l,d=n*a,p=n*l,f=r*l,m=o*s,g=o*a,y=o*l;return t[0]=1-(d+f),t[4]=c-y,t[8]=h+g,t[1]=c+y,t[5]=1-(u+f),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(u+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,i;return function(n,r,o){void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3);var s=this.elements;return i.subVectors(n,r).normalize(),0===i.lengthSq()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.lengthSq()&&(i.z+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],y=i[3],v=i[7],E=i[11],T=i[15],b=n[0],C=n[4],O=n[8],x=n[12],w=n[1],R=n[5],L=n[9],S=n[13],_=n[2],I=n[6],D=n[10],M=n[14],A=n[3],N=n[7],P=n[11],k=n[15];return r[0]=o*b+s*w+a*_+l*A,r[4]=o*C+s*R+a*I+l*N,r[8]=o*O+s*L+a*D+l*P,r[12]=o*x+s*S+a*M+l*k,r[1]=u*b+c*w+h*_+d*A,r[5]=u*C+c*R+h*I+d*N,r[9]=u*O+c*L+h*D+d*P,r[13]=u*x+c*S+h*M+d*k,r[2]=p*b+f*w+m*_+g*A,r[6]=p*C+f*R+m*I+g*N,r[10]=p*O+f*L+m*D+g*P,r[14]=p*x+f*S+m*M+g*k,r[3]=y*b+v*w+E*_+T*A,r[7]=y*C+v*R+E*I+T*N,r[11]=y*O+v*L+E*D+T*P,r[15]=y*x+v*S+E*M+T*k,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToVector3Array:function(){var e;return function(t,i,n){void 0===e&&(e=new THREE.Vector3),void 0===i&&(i=0),void 0===n&&(n=t.length);for(var r=0,o=i;r<n;r+=3,o+=3)e.fromArray(t,o),e.applyMatrix4(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,i,n){void 0===e&&(e=new THREE.Vector3),void 0===i&&(i=0),void 0===n&&(n=t.length/t.itemSize);for(var r=0,o=i;r<n;r++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],p=e[3],f=e[7],m=e[11],g=e[15];return p*(+r*a*c-n*l*c-r*s*h+i*l*h+n*s*d-i*a*d)+f*(+t*a*d-t*l*h+r*o*h-n*o*d+n*l*u-r*a*u)+m*(+t*l*c-t*s*d-r*o*c+i*o*d+r*s*u-i*l*u)+g*(-n*s*u-t*a*c+t*s*h+n*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[1],s=n[2],a=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],g=n[12],y=n[13],v=n[14],E=n[15],T=p*v*h-y*f*h+y*c*m-u*v*m-p*c*E+u*f*E,b=g*f*h-d*v*h-g*c*m+l*v*m+d*c*E-l*f*E,C=d*y*h-g*p*h+g*u*m-l*y*m-d*u*E+l*p*E,O=g*p*c-d*y*c-g*u*f+l*y*f+d*u*v-l*p*v,x=r*T+o*b+s*C+a*O;if(0===x){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity()}var R=1/x;return i[0]=T*R,i[1]=(y*f*a-p*v*a-y*s*m+o*v*m+p*s*E-o*f*E)*R,i[2]=(u*v*a-y*c*a+y*s*h-o*v*h-u*s*E+o*c*E)*R,i[3]=(p*c*a-u*f*a-p*s*h+o*f*h+u*s*m-o*c*m)*R,i[4]=b*R,i[5]=(d*v*a-g*f*a+g*s*m-r*v*m-d*s*E+r*f*E)*R,i[6]=(g*c*a-l*v*a-g*s*h+r*v*h+l*s*E-r*c*E)*R,i[7]=(l*f*a-d*c*a+d*s*h-r*f*h-l*s*m+r*c*m)*R,i[8]=C*R,i[9]=(g*p*a-d*y*a-g*o*m+r*y*m+d*o*E-r*p*E)*R,i[10]=(l*y*a-g*u*a+g*o*h-r*y*h-l*o*E+r*u*E)*R,i[11]=(d*u*a-l*p*a-d*o*h+r*p*h+l*o*m-r*u*m)*R,i[12]=O*R,i[13]=(d*y*s-g*p*s+g*o*f-r*y*f-d*o*v+r*p*v)*R,i[14]=(g*u*s-l*y*s-g*o*c+r*y*c+l*o*v-r*u*v)*R,i[15]=(l*p*s-d*u*s+d*o*c-r*p*c-l*o*f+r*u*f)*R,this},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,s=e.y,a=e.z,l=r*o,u=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,u*s+i,u*a-n*o,0,l*a-n*s,u*a+n*o,r*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e,t;return function(i,n,r){void 0===e&&(e=new THREE.Vector3,t=new THREE.Matrix4);var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length(),u=this.determinant();u<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var c=1/s,h=1/a,d=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,n.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=l,this}}(),makeFrustum:function(e,t,i,n,r,o){var s=this.elements,a=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,i,n){var r=i*Math.tan(THREE.Math.DEG2RAD*e*.5),o=-r,s=o*t,a=r*t;return this.makeFrustum(s,a,o,r,i,n)},makeOrthographic:function(e,t,i,n,r,o){var s=this.elements,a=1/(t-e),l=1/(i-n),u=1/(o-r),c=(t+e)*a,h=(i+n)*l,d=(o+r)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new THREE.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o,s){e.copy(n).add(r).multiplyScalar(.5),t.copy(r).sub(n).normalize(),i.copy(this.origin).sub(e);var a,l,u,c,h=.5*n.distanceTo(r),d=-this.direction.dot(t),p=i.dot(this.direction),f=-i.dot(t),m=i.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(a=d*f-p,l=d*p-f,c=h*g,a>=0)if(l>=-c)if(l<=c){var y=1/g;a*=y,l*=y,u=a*(a+d*l+2*p)+l*(d*a+l+2*f)+m}else l=h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;else l=-h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;else l<=-c?(a=Math.max(0,-(-d*h+p)),l=a>0?-h:Math.min(Math.max(-h,-f),h),u=-a*a+l*(l+2*f)+m):l<=c?(a=0,l=Math.min(Math.max(-h,-f),h),u=l*(l+2*f)+m):(a=Math.max(0,-(d*h+p)),l=a>0?h:Math.min(Math.max(-h,-f),h),u=-a*a+l*(l+2*f)+m);else l=d>0?-h:h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),u}}(),intersectSphere:function(){var e=new THREE.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n,o=t.radius*t.radius;if(r>o)return null;var s=Math.sqrt(o-r),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,i):this.at(a,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var i=e.normal.dot(this.direction);return i*t<0},intersectBox:function(e,t){var i,n,r,o,s,a,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||r>n?null:((r>i||i!==i)&&(i=r),(o<n||n!==n)&&(n=o),c>=0?(s=(e.min.z-h.z)*c,a=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,a=(e.min.z-h.z)*c),i>a||s>n?null:((s>i||i!==i)&&(i=s),(a<n||n!==n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))},intersectsBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(r,o,s,a,l){t.subVectors(o,r),i.subVectors(s,r),n.crossVectors(t,i);var u,c=this.direction.dot(n);if(c>0){if(a)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}e.subVectors(this.origin,r);var h=u*this.direction.dot(i.crossVectors(e,i));if(h<0)return null;var d=u*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>c)return null;var p=-u*e.dot(n);return p<0?null:this.at(p/c,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).center(n);for(var r=0,o=0,s=t.length;o<s;o++)r=Math.max(r,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new THREE.Vector3;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},THREE.Frustum=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,n,r,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],u=i[6],c=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return t[0].setComponents(s-n,c-a,f-h,v-m).normalize(),t[1].setComponents(s+n,c+a,f+h,v+m).normalize(),t[2].setComponents(s+r,c+l,f+d,v+g).normalize(),t[3].setComponents(s-r,c-l,f-d,v-g).normalize(),t[4].setComponents(s-o,c-u,f-p,v-y).normalize(),t[5].setComponents(s+o,c+u,f+p,v+y).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new THREE.Sphere;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++){var o=t[r].distanceToPoint(i);if(o<n)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){for(var n=this.planes,r=0;r<6;r++){var o=n[r];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n,r){var o=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),n=t||new THREE.Vector3;return n.copy(this.normal).multiplyScalar(i)},intersectLine:function(){var e=new THREE.Vector3;return function(t,i){var n=i||new THREE.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0!==o){var s=-(t.start.dot(this.normal)+this.constant)/o;if(!(s<0||s>1))return n.copy(r).multiplyScalar(s).add(t.start)}else if(0===this.distanceToPoint(t.start))return n.copy(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Matrix3;return function(i,n){var r=this.coplanarPoint(e).applyMatrix4(i),o=n||t.getNormalMatrix(i),s=this.normal.applyMatrix3(o).normalize();return this.constant=-r.dot(s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},THREE.Spherical=function(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this},THREE.Spherical.prototype={constructor:THREE.Spherical,set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius.copy(e.radius),this.phi.copy(e.phi),this.theta.copy(e.theta),this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(THREE.Math.clamp(e.y/this.radius,-1,1))),this}},THREE.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19===r?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*THREE.Math.DEG2RAD},radToDeg:function(e){return e*THREE.Math.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},THREE.Spline=function(e){function t(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t}this.points=e;var i,n,r,o,s,a,l,u,c,h=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,n=Math.floor(i),r=i-n,h[0]=0===n?n:n-1,h[1]=n,h[2]=n>this.points.length-2?this.points.length-1:n+1,h[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[h[0]],l=this.points[h[1]],u=this.points[h[2]],c=this.points[h[3]],o=r*r,s=r*o,d.x=t(a.x,l.x,u.x,c.x,r,o,s),d.y=t(a.y,l.y,u.y,c.y,r,o,s),d.z=t(a.z,l.z,u.z,c.z,r,o,s),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;e<i;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r,o=0,s=0,a=0,l=new THREE.Vector3,u=new THREE.Vector3,c=[],h=0;for(c[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;t<n;t++)i=t/n,r=this.getPoint(i),u.copy(r),h+=u.distanceTo(l),l.copy(r),o=(this.points.length-1)*i,s=Math.floor(o),s!==a&&(c[s]=h,a=s);return c[c.length]=h,{chunks:c,total:h}},this.reparametrizeByArcLength=function(e){var t,i,n,r,o,s,a,l,u=[],c=new THREE.Vector3,h=this.getLength();for(u.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=h.chunks[t]-h.chunks[t-1],a=Math.ceil(e*s/h.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<a-1;i++)n=r+i*(1/a)*(o-r),l=this.getPoint(n),u.push(c.copy(l).clone());u.push(c.copy(this.points[t]).clone())}this.points=u}},THREE.Triangle=function(e,t,i){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==i?i:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,i,n,r){var o=r||new THREE.Vector3;o.subVectors(n,i),e.subVectors(t,i),o.cross(e);var s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o,s,a){e.subVectors(s,r),t.subVectors(o,r),i.subVectors(n,r);var l=e.dot(e),u=e.dot(t),c=e.dot(i),h=t.dot(t),d=t.dot(i),p=l*h-u*u,f=a||new THREE.Vector3;if(0===p)return f.set(-2,-1,-1);var m=1/p,g=(h*c-u*d)*m,y=(l*d-u*c)*m;return f.set(1-g-y,y,g)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,i,n,r){var o=THREE.Triangle.barycoordFromPoint(t,i,n,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e,t,i,n;return function(r,o){void 0===e&&(e=new THREE.Plane,t=[new THREE.Line3,new THREE.Line3,new THREE.Line3],i=new THREE.Vector3,n=new THREE.Vector3);var s=o||new THREE.Vector3,a=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(r,i),this.containsPoint(i)===!0)s.copy(i);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(i,!0,n);var u=i.distanceToSquared(n);u<a&&(a=u,s.copy(n))}}return s}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},THREE.Interpolant=function(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i},THREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{var o;i:{n:if(!(e<n)){for(var s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}{if(e>=r)break e;var a=t[1];e<a&&(i=2,r=a);for(var s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0}}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n,o=0;o!==n;++o)t[o]=i[r+o];return t},interpolate_:function(e,t,i,n){throw new Error("call to abstract method")},intervalChanged_:function(e,t,i){}},Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_}),THREE.CubicInterpolant=function(e,t,i,n){THREE.Interpolant.call(this,e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0},THREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(e,t,i){var n=this.parameterPositions,r=e-2,o=e+1,s=n[r],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:r=e,s=2*t-i;break;case THREE.WrapAroundEnding:r=n.length-2,s=t+n[r]-n[r+1];break;default:r=e,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:o=e,a=2*i-t;break;case THREE.WrapAroundEnding:o=1,a=i+n[1]-n[0];break;default:o=e-1,a=t}var l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-i),this._offsetPrev=r*u,this._offsetNext=o*u},interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,E=d*m-d*f,T=0;T!==s;++T)r[T]=g*o[u+T]+y*o[l+T]+v*o[a+T]+E*o[c+T];return r}}),THREE.DiscreteInterpolant=function(e,t,i,n){THREE.Interpolant.call(this,e,t,i,n)},THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(e,t,i,n){return this.copySampleValue_(e-1)}}),THREE.LinearInterpolant=function(e,t,i,n){THREE.Interpolant.call(this,e,t,i,n)},THREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=(i-t)/(n-t),c=1-u,h=0;h!==s;++h)r[h]=o[l+h]*c+o[a+h]*u;return r}}),THREE.QuaternionLinearInterpolant=function(e,t,i,n){THREE.Interpolant.call(this,e,t,i,n)},THREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=(i-t)/(n-t),u=a+s;a!==u;a+=4)THREE.Quaternion.slerpFlat(r,0,o,a-s,o,a,l);return r}}),THREE.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=(performance||Date).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},Object.assign(THREE.EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&i[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e];if(void 0!==n){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;var n=[],r=0,o=i.length;for(r=0;r<o;r++)n[r]=i[r];for(r=0;r<o;r++)n[r].call(this,e)}}}}),THREE.Layers=function(){this.mask=1},THREE.Layers.prototype={constructor:THREE.Layers,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return 0!==(this.mask&e.mask)}},function(e){function t(e,t){return e.distance-t.distance}function i(e,t,n,r,o){if((void 0!==o&&o!==!0||e.visible!==!1)&&e.raycastable!==!1&&(e.raycast(t,n),r===!0))for(var s=e.children,a=0,l=s.length;a<l;a++)i(s[a],t,n,!0,o)}e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){i instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize()):i instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),
this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,n,r){var o=[];return i(e,this,o,n,r),o.sort(t),o},intersectObjects:function(e,n,r){var o=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var s=0,a=e.length;s<a;s++)i(e[s],this,o,n,r);return o.sort(t),o}}}(THREE),THREE.Object3D=function(){function e(){r.setFromEuler(n,!1)}function t(){n.setFromQuaternion(r,void 0,!1)}Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var i=new THREE.Vector3,n=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Vector3(1,1,1);n.onChange(e),r.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:i},rotation:{enumerable:!0,value:n},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:o},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}}),this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new THREE.Layers,this.visible=!0,this.raycastable=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.DefaultMatrixAutoUpdate=!0,Object.assign(THREE.Object3D.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof THREE.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);i!==-1&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],o=r.getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){var t=e||new THREE.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){var n=i||new THREE.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(i){var n=i||new THREE.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}var i=void 0===e||""===e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{}},n.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var r={};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),r.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),r.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),r.material=this.material.uuid),this.children.length>0){r.children=[];for(var o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(i){var s=t(e.geometries),a=t(e.materials),l=t(e.textures),u=t(e.images);s.length>0&&(n.geometries=s),a.length>0&&(n.materials=a),l.length>0&&(n.textures=l),u.length>0&&(n.images=u)}return n.object=r,n},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var i=0;i<e.children.length;i++){var n=e.children[i];this.add(n.clone())}return this}}),THREE.Object3DIdCount=0,THREE.Face3=function(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},THREE.BufferAttribute=function(e,t,i){this.uuid=THREE.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0,this.normalized=i===!0},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new THREE.Color),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];t[i++]=o.a,t[i++]=o.b,t[i++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new THREE.Vector2),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new THREE.Vector3),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new THREE.Vector4),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},clone:function(){return(new this.constructor).copy(this)}},THREE.Int8Attribute=function(e,t){return new THREE.BufferAttribute(new Int8Array(e),t)},THREE.Uint8Attribute=function(e,t){return new THREE.BufferAttribute(new Uint8Array(e),t)},THREE.Uint8ClampedAttribute=function(e,t){return new THREE.BufferAttribute(new Uint8ClampedArray(e),t)},THREE.Int16Attribute=function(e,t){return new THREE.BufferAttribute(new Int16Array(e),t)},THREE.Uint16Attribute=function(e,t){return new THREE.BufferAttribute(new Uint16Array(e),t)},THREE.Int32Attribute=function(e,t){return new THREE.BufferAttribute(new Int32Array(e),t)},THREE.Uint32Attribute=function(e,t){return new THREE.BufferAttribute(new Uint32Array(e),t)},THREE.Float32Attribute=function(e,t){return new THREE.BufferAttribute(new Float32Array(e),t)},THREE.Float64Attribute=function(e,t){return new THREE.BufferAttribute(new Float64Array(e),t)},THREE.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new THREE.BufferAttribute(e,t).setDynamic(!0)},THREE.InstancedBufferAttribute=function(e,t,i){THREE.BufferAttribute.call(this,e,t),this.meshPerAttribute=i||1},THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute,THREE.InstancedBufferAttribute.prototype.copy=function(e){return THREE.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBuffer=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},THREE.InstancedInterleavedBuffer=function(e,t,i){THREE.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1},THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype),THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer,THREE.InstancedInterleavedBuffer.prototype.copy=function(e){return THREE.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBufferAttribute=function(e,t,i){this.uuid=THREE.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=i},THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.count},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}},THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Object.assign(THREE.Geometry.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++){var r=this.vertices[i];r.applyMatrix4(e)}for(var i=0,n=this.faces.length;i<n;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,a=o.vertexNormals.length;s<a;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,n){return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,n){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,n,r){var o=void 0!==s?[c[e].clone(),c[t].clone(),c[n].clone()]:[],p=void 0!==a?[i.colors[e].clone(),i.colors[t].clone(),i.colors[n].clone()]:[],f=new THREE.Face3(e,t,n,o,p,r);i.faces.push(f),void 0!==l&&i.faceVertexUvs[0].push([h[e].clone(),h[t].clone(),h[n].clone()]),void 0!==u&&i.faceVertexUvs[1].push([d[e].clone(),d[t].clone(),d[n].clone()])}var i=this,n=null!==e.index?e.index.array:void 0,r=e.attributes,o=r.position.array,s=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,l=void 0!==r.uv?r.uv.array:void 0,u=void 0!==r.uv2?r.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=[],h=[],d=[],p=0,f=0;p<o.length;p+=3,f+=2)i.vertices.push(new THREE.Vector3(o[p],o[p+1],o[p+2])),void 0!==s&&c.push(new THREE.Vector3(s[p],s[p+1],s[p+2])),void 0!==a&&i.colors.push(new THREE.Color(a[p],a[p+1],a[p+2])),void 0!==l&&h.push(new THREE.Vector2(l[f],l[f+1])),void 0!==u&&d.push(new THREE.Vector2(u[f],u[f+1]));if(void 0!==n){var m=e.groups;if(m.length>0)for(var p=0;p<m.length;p++)for(var g=m[p],y=g.start,v=g.count,f=y,E=y+v;f<E;f+=3)t(n[f],n[f+1],n[f+2],g.materialIndex);else for(var p=0;p<n.length;p+=3)t(n[p],n[p+1],n[p+2])}else for(var p=0;p<o.length/3;p+=3)t(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new THREE.Matrix4;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,i,n,r,o,s;for(s=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)s[t]=new THREE.Vector3;if(e){var a,l,u,c=new THREE.Vector3,h=new THREE.Vector3;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],c.subVectors(u,l),h.subVectors(a,l),c.cross(h),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(n=0,r=this.faces.length;n<r;n++){o=this.faces[n];var d=o.vertexNormals;3===d.length?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,a,l=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)s=new THREE.Vector3,a={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},l.push(s),u.push(a)}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var s,a;for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],s=c.faceNormals[i],a=c.vertexNormals[i],s.copy(r.normal),a.a.copy(r.vertexNormals[0]),a.b.copy(r.vertexNormals[1]),a.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;i<n;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof THREE.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var n,r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===i&&(i=0),void 0!==t&&(n=(new THREE.Matrix3).getNormalMatrix(t));for(var h=0,d=s.length;h<d;h++){var p=s[h],f=p.clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(h=0,d=l.length;h<d;h++){var m,g,y,v=l[h],E=v.vertexNormals,T=v.vertexColors;m=new THREE.Face3(v.a+r,v.b+r,v.c+r),m.normal.copy(v.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var b=0,C=E.length;b<C;b++)g=E[b].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),m.vertexNormals.push(g);m.color.copy(v.color);for(var b=0,C=T.length;b<C;b++)y=T[b],m.vertexColors.push(y.clone());m.materialIndex=v.materialIndex+i,a.push(m)}for(h=0,d=c.length;h<d;h++){var O=c[h],x=[];if(void 0!==O){for(var b=0,C=O.length;b<C;b++)x.push(O[b].clone());u.push(x)}}},mergeMesh:function(e){return e instanceof THREE.Mesh==!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,i,n,r,o,s,a,l={},u=[],c=[],h=4,d=Math.pow(10,h);for(i=0,n=this.vertices.length;i<n;i++)e=this.vertices[i],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===l[t]?(l[t]=i,u.push(this.vertices[i]),c[i]=u.length-1):c[i]=c[l[t]];var p=[];for(i=0,n=this.faces.length;i<n;i++){r=this.faces[i],r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var f=-1,m=0;m<3;m++)if(o[m]===o[(m+1)%3]){f=m,p.push(i);break}}for(i=p.length-1;i>=0;i--){var g=p[i];for(this.faces.splice(g,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(g,1)}var y=this.vertices.length-u.length;return this.vertices=u,y},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,i=t.length,n=0;n<i;n++)t[n]._id=n;t.sort(e);var r,o,s=this.faceVertexUvs[0],a=this.faceVertexUvs[1];s&&s.length===i&&(r=[]),a&&a.length===i&&(o=[]);for(var n=0;n<i;n++){var l=t[n]._id;r&&r.push(s[l]),o&&o.push(a[l])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/3,h.push(e.x,e.y,e.z),d[t])}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==f[t]?f[t]:(f[t]=p.length,p.push(e.getHex()),f[t])}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var r={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var s in o)void 0!==o[s]&&(r[s]=o[s]);return r}for(var a=[],l=0;l<this.vertices.length;l++){var u=this.vertices[l];a.push(u.x,u.y,u.z)}for(var c=[],h=[],d={},p=[],f={},m=[],g={},l=0;l<this.faces.length;l++){var y=this.faces[l],v=!0,E=!1,T=void 0!==this.faceVertexUvs[0][l],b=y.normal.length()>0,C=y.vertexNormals.length>0,O=1!==y.color.r||1!==y.color.g||1!==y.color.b,x=y.vertexColors.length>0,w=0;if(w=e(w,0,0),w=e(w,1,v),w=e(w,2,E),w=e(w,3,T),w=e(w,4,b),w=e(w,5,C),w=e(w,6,O),w=e(w,7,x),c.push(w),c.push(y.a,y.b,y.c),c.push(y.materialIndex),T){var R=this.faceVertexUvs[0][l];c.push(n(R[0]),n(R[1]),n(R[2]))}if(b&&c.push(t(y.normal)),C){var L=y.vertexNormals;c.push(t(L[0]),t(L[1]),t(L[2]))}if(O&&c.push(i(y.color)),x){var S=y.vertexColors;c.push(i(S[0]),i(S[1]),i(S[2]))}}return r.data={},r.data.vertices=a,r.data.normals=h,p.length>0&&(r.data.colors=p),m.length>0&&(r.data.uvs=[m]),r.data.faces=c,r},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,i=0,n=t.length;i<n;i++)this.vertices.push(t[i].clone());for(var r=e.faces,i=0,n=r.length;i<n;i++)this.faces.push(r[i].clone());for(var i=0,n=e.faceVertexUvs.length;i<n;i++){var o=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var s=0,a=o.length;s<a;s++){for(var l=o[s],u=[],c=0,h=l.length;c<h;c++){var d=l[c];u.push(d.clone())}this.faceVertexUvs[i].push(u)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),THREE.GeometryIdCount=0,THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},Object.assign(THREE.DirectGeometry.prototype,THREE.EventDispatcher.prototype,{computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,i,n=[],r=e.faces,o=0;o<r.length;o++){var s=r[o];s.materialIndex!==i&&(i=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,i=e.faces,n=e.vertices,r=e.faceVertexUvs,o=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,l=a.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]=[];this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(var u=0;u<d;u++)c[u]=[];this.morphTargets.normal=c}for(var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,g=f.length===n.length,u=0;u<i.length;u++){var y=i[u];this.vertices.push(n[y.a],n[y.b],n[y.c]);var v=y.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var E=y.normal;this.normals.push(E,E,E)}var T=y.vertexColors;if(3===T.length)this.colors.push(T[0],T[1],T[2]);else{var b=y.color;this.colors.push(b,b,b)}if(o===!0){var C=r[0][u];void 0!==C?this.uvs.push(C[0],C[1],C[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}if(s===!0){var C=r[1][u];void 0!==C?this.uvs2.push(C[0],C[1],C[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}for(var O=0;O<l;O++){var x=a[O].vertices;t[O].push(x[y.a],x[y.b],x[y.c])}for(var O=0;O<d;O++){var w=h[O].vertexNormals[u];c[O].push(w.a,w.b,w.c)}m&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),g&&this.skinWeights.push(f[y.a],f[y.b],f[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},Object.assign(THREE.BufferGeometry.prototype,THREE.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof THREE.BufferAttribute==!1&&t instanceof THREE.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new THREE.BufferAttribute(arguments[1],arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var n=(new THREE.Matrix3).getNormalMatrix(e);n.applyToVector3Array(i.array),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,n){return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,n){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){
var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Points||e instanceof THREE.Line){var i=new THREE.Float32Attribute(3*t.vertices.length,3),n=new THREE.Float32Attribute(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new THREE.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof THREE.Mesh&&t instanceof THREE.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Mesh){var i=t.__directGeometry;if(void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(t.verticesNeedUpdate===!0){var n=this.attributes.position;void 0!==n&&(n.copyVector3sArray(t.vertices),n.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var n=this.attributes.normal;void 0!==n&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var n=this.attributes.color;void 0!==n&&(n.copyColorsArray(t.colors),n.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var n=this.attributes.uv;void 0!==n&&(n.copyVector2sArray(t.uvs),n.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var n=this.attributes.lineDistance;void 0!==n&&(n.copyArray(t.lineDistances),n.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new THREE.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new THREE.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new THREE.BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new THREE.BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new THREE.BufferAttribute(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new THREE.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=e.vertices.length>65535?Uint32Array:Uint16Array,a=new s(3*e.indices.length);this.setIndex(new THREE.BufferAttribute(a,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var l in e.morphTargets){for(var u=[],c=e.morphTargets[l],h=0,d=c.length;h<d;h++){var p=c[h],f=new THREE.Float32Attribute(3*p.length,3);u.push(f.copyVector3sArray(p))}this.morphAttributes[l]=u}if(e.skinIndices.length>0){var m=new THREE.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",m.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var g=new THREE.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;void 0!==e?this.boundingBox.setFromArray(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var i=this.attributes.position;if(i){var n=i.array,r=this.boundingSphere.center;e.setFromArray(n),e.center(r);for(var o=0,s=0,a=n.length;s<a;s+=3)t.fromArray(n,s),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n.length),3));else for(var r=t.normal.array,o=0,s=r.length;o<s;o++)r[o]=0;var a,l,u,c=t.normal.array,h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3;if(e){var g=e.array;0===i.length&&this.addGroup(0,g.length);for(var y=0,v=i.length;y<v;++y)for(var E=i[y],T=E.start,b=E.count,o=T,s=T+b;o<s;o+=3)a=3*g[o+0],l=3*g[o+1],u=3*g[o+2],h.fromArray(n,a),d.fromArray(n,l),p.fromArray(n,u),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),c[a]+=f.x,c[a+1]+=f.y,c[a+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z,c[u]+=f.x,c[u+1]+=f.y,c[u+2]+=f.z}else for(var o=0,s=n.length;o<s;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),c[o]=f.x,c[o+1]=f.y,c[o+2]=f.z,c[o+3]=f.x,c[o+4]=f.y,c[o+5]=f.z,c[o+6]=f.x,c[o+7]=f.y,c[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e instanceof THREE.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var i=this.attributes;for(var n in i)if(void 0!==e.attributes[n])for(var r=i[n],o=r.array,s=e.attributes[n],a=s.array,l=s.itemSize,u=0,c=l*t;u<a.length;u++,c++)o[c]=a[u];return this},normalizeNormals:function(){for(var e,t,i,n,r=this.attributes.normal.array,o=0,s=r.length;o<s;o+=3)e=r[o],t=r[o+1],i=r[o+2],n=1/Math.sqrt(e*e+t*t+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new THREE.BufferGeometry,t=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],o=r.array,s=r.itemSize,a=new o.constructor(t.length*s),l=0,u=0,c=0,h=t.length;c<h;c++){l=t[c]*s;for(var d=0;d<s;d++)a[u++]=o[l++]}e.addAttribute(n,new THREE.BufferAttribute(a,s))}return e},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:r}}var o=this.attributes;for(var i in o){var s=o[i],r=Array.prototype.slice.call(s.array);e.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:r,normalized:s.normalized}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var o=e.groups,s=0,a=o.length;s<a;s++){var l=o[s];this.addGroup(l.start,l.count,l.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),THREE.BufferGeometry.MaxIndex=65535,THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry,THREE.InstancedBufferGeometry.prototype.addGroup=function(e,t,i){this.groups.push({start:e,count:t,instances:i})},THREE.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var o=e.groups,s=0,a=o.length;s<a;s++){var l=o[s];this.addGroup(l.start,l.count,l.instances)}return this},THREE.Uniform=function(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e,this.dynamic=!1},THREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(e){return this.dynamic=!0,this.onUpdateCallback=e,this}},THREE.AnimationAction=function(){throw new Error("THREE.AnimationAction: Use mixer.clipAction for construction.")},THREE.AnimationAction._new=function(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var n=t.tracks,r=n.length,o=new Array(r),s={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},a=0;a!==r;++a){var l=n[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=THREE.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0},THREE.AnimationAction._new.prototype={constructor:THREE.AnimationAction._new,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){this._startTime;return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){this._mixer;if(e.fadeOut(t),this.fadeIn(t),i){var n=this._clip.duration,r=e._clip.duration,o=r/n,s=n/r;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,n){var r=this._startTime;if(null!==r){var o=(e-r)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(s),u[c].accumulate(n,a)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(n===THREE.LoopOnce){r===-1&&(this.loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=n===THREE.LoopPingPong;if(r===-1&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var s=Math.floor(t/i);t-=i*s,r+=Math.abs(s);var a=this.repetitions-r;if(a<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(0===a){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1===(1&r))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var n=this._interpolantSettings;i?(n.endingStart=THREE.ZeroSlopeEnding,n.endingEnd=THREE.ZeroSlopeEnding):(e?n.endingStart=this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:n.endingStart=THREE.WrapAroundEnding,t?n.endingEnd=this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:n.endingEnd=THREE.WrapAroundEnding)},_scheduleFading:function(e,t,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=i,this}},THREE.AnimationClip=function(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=THREE.Math.generateUUID(),this.duration<0&&this.resetDuration(),this.trim(),this.optimize()},THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var e=this.tracks,t=0,i=0,n=e.length;i!==n;++i){var r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Object.assign(THREE.AnimationClip,{parse:function(e){for(var t=[],i=e.tracks,n=1/(e.fps||1),r=0,o=i.length;r!==o;++r)t.push(THREE.KeyframeTrack.parse(i[r]).scale(n));return new THREE.AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t},r=0,o=i.length;r!==o;++r)t.push(THREE.KeyframeTrack.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(e,t,i,n){for(var r=t.length,o=[],s=0;s<r;s++){var a=[],l=[];a.push((s+r-1)%r,s,(s+1)%r),l.push(0,1,0);var u=THREE.AnimationUtils.getKeyframeOrder(a);a=THREE.AnimationUtils.sortedArray(a,1,u),l=THREE.AnimationUtils.sortedArray(l,1,u),n||0!==a[0]||(a.push(r),l.push(l[0])),o.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/i))}return new THREE.AnimationClip(e,(-1),o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var n=e;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],l=a.name.match(r);if(l&&l.length>1){var u=l[1],c=n[u];c||(n[u]=c=[]),c.push(a)}}var h=[];for(var u in n)h.push(THREE.AnimationClip.CreateFromMorphTargetSequence(u,n[u],t,i));return h},parseAnimation:function(e,t,i){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var n=function(e,t,i,n,r){if(0!==i.length){var o=[],s=[];THREE.AnimationUtils.flattenJSON(i,o,s,n),0!==o.length&&r.push(new e(t,o,s))}},r=[],o=e.name||"default",s=e.length||-1,a=e.fps||30,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var h={},d=0;d<c.length;d++)if(c[d].morphTargets)for(var p=0;p<c[d].morphTargets.length;p++)h[c[d].morphTargets[p]]=-1;for(var f in h){for(var m=[],g=[],p=0;p!==c[d].morphTargets.length;++p){var y=c[d];m.push(y.time),g.push(y.morphTarget===f?1:0)}r.push(new THREE.NumberKeyframeTrack(".morphTargetInfluence["+f+"]",m,g))}s=h.length*(a||1)}else{var v=".bones["+t[u].name+"]";n(THREE.VectorKeyframeTrack,v+".position",c,"pos",r),n(THREE.QuaternionKeyframeTrack,v+".quaternion",c,"rot",r),n(THREE.VectorKeyframeTrack,v+".scale",c,"scl",r)}}if(0===r.length)return null;var E=new THREE.AnimationClip(o,s,r);return E}}),THREE.AnimationMixer=function(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1},Object.assign(THREE.AnimationMixer.prototype,THREE.EventDispatcher.prototype,{clipAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?THREE.AnimationClip.findByName(i,e):e,o=null!==r?r.uuid:e,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;a=s.knownActions[0],null===r&&(r=a._clip)}if(null===r)return null;var u=new THREE.AnimationMixer._Action(this,r,t);return this._bindAction(u,a),this._addInactiveAction(u,o,n),u},existingAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?THREE.AnimationClip.findByName(i,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s?s.actionByRoot[n]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(var r=0;r!==n;++r)i[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,s=0;s!==i;++s){var a=t[s];a.enabled&&a._update(n,e,r,o)}for(var l=this._bindings,u=this._nActiveBindings,s=0;s!==u;++s)l[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot,o=r[t];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var s=this._bindingsByRootAndName,a=s[t];if(void 0!==a)for(var l in a){var u=a[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),THREE.AnimationMixer._Action=THREE.AnimationAction._new,Object.assign(THREE.AnimationMixer.prototype,{_bindAction:function(e,t){var i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,s=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName,u=l[a];void 0===u&&(u={},l[a]=u);for(var c=0;c!==r;++c){var h=n[c],d=h.name,p=u[d];if(void 0!==p)o[c]=p;else{if(p=o[c],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;p=new THREE.PropertyMixer(THREE.PropertyBinding.create(i,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,a,d),o[c]=p}s[c].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}for(var r=e._propertyBindings,o=0,s=r.length;o!==s;++o){var a=r[o];0===a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var n=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,a[u]=l,a.pop(),e._byClipCacheIndex=null;var c=s.actionByRoot,h=(t._localRoot||this._root).uuid;delete c[h],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){var n=this._bindingsByRootAndName,r=n[t],o=this._bindings;void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,s=o[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r];e:{for(var u in s)break e;delete o[n]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1)}),THREE.AnimationObjectGroup=function(e){this.uuid=THREE.Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var i=0,n=arguments.length;i!==n;++i)t[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}},THREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(e){for(var t=this._objects,i=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,p=r[d];if(void 0===p){p=i++,r[d]=p,t.push(h);for(var f=0,m=l;f!==m;++f)a[f].push(new THREE.PropertyBinding(h,o[f],s[f]))}else if(p<n){var g=t[p],y=--n,v=t[y];r[v.uuid]=p,t[p]=v,r[d]=y,t[y]=h;for(var f=0,m=l;f!==m;++f){var E=a[f],T=E[y],b=E[p];E[p]=T,void 0===b&&(b=new THREE.PropertyBinding(h,o[f],s[f])),E[y]=b}}else t[p]!==g&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=n},remove:function(e){for(var t=this._objects,i=(t.length,this.nCachedObjects_),n=this._indicesByUUID,r=this._bindings,o=r.length,s=0,a=arguments.length;s!==a;++s){var l=arguments[s],u=l.uuid,c=n[u];if(void 0!==c&&c>=i){var h=i++,d=t[h];n[d.uuid]=c,t[c]=d,n[u]=h,t[h]=l;for(var p=0,f=o;p!==f;++p){var m=r[p],g=m[h],y=m[c];m[c]=g,m[h]=y}}}this.nCachedObjects_=i},uncache:function(e){for(var t=this._objects,i=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,s=o.length,a=0,l=arguments.length;a!==l;++a){var u=arguments[a],c=u.uuid,h=r[c];if(void 0!==h)if(delete r[c],h<n){var d=--n,p=t[d],f=--i,m=t[f];r[p.uuid]=h,t[h]=p,r[m.uuid]=d,t[d]=m,t.pop();for(var g=0,y=s;g!==y;++g){var v=o[g],E=v[d],T=v[f];v[h]=E,v[d]=T,v.pop()}}else{var f=--i,m=t[f];r[m.uuid]=h,t[h]=m,t.pop();for(var g=0,y=s;g!==y;++g){var v=o[g];v[h]=v[f],v.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,u=this.nCachedObjects_,c=new Array(l);n=r.length,i[e]=n,o.push(e),s.push(t),r.push(c);for(var h=u,d=a.length;h!==d;++h){var p=a[h];c[h]=new THREE.PropertyBinding(p,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s],l=e[s];t[l]=i,o[i]=a,o.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}},THREE.AnimationUtils={arraySlice:function(e,t,i){return THREE.AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,i)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,i){return e[t]-e[i]}for(var i=e.length,n=new Array(i),r=0;r!==i;++r)n[r]=r;return n.sort(t),n},sortedArray:function(e,t,i){for(var n=e.length,r=new e.constructor(n),o=0,s=0;s!==n;++o)for(var a=i[o]*t,l=0;l!==t;++l)r[s++]=e[a+l];return r},flattenJSON:function(e,t,i,n){for(var r=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[r++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s)){do s=o[n],void 0!==s&&(t.push(o.time),i.push.apply(i,s)),o=e[r++];while(void 0!==o)}else if(void 0!==s.toArray){do s=o[n],void 0!==s&&(t.push(o.time),s.toArray(i,i.length)),o=e[r++];while(void 0!==o)}else do s=o[n],void 0!==s&&(t.push(o.time),i.push(s)),o=e[r++];while(void 0!==o)}}},THREE.KeyframeTrack=function(e,t,i,n){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=THREE.AnimationUtils.convertArray(t,this.TimeBufferType),this.values=THREE.AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()},THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new THREE.CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case THREE.InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return void console.warn(i)}this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);var s=this.getValueSize();this.times=THREE.AnimationUtils.arraySlice(i,r,o),this.values=THREE.AnimationUtils.arraySlice(this.values,r*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("invalid value size in track",this),e=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("track is empty",this),e=!1);for(var o=null,s=0;s!==r;s++){var a=i[s];if("number"==typeof a&&isNaN(a)){console.error("time is not a valid number",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("out of order keys",this,s,a,o),e=!1;break}o=a}if(void 0!==n&&THREE.AnimationUtils.isTypedArray(n))for(var s=0,l=n.length;s!==l;++s){var u=n[s];if(isNaN(u)){console.error("value is not a valid number",this,s,u),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),n=1,r=1,o=e.length-1;r<=o;++r){var s=!1,a=e[r],l=e[r+1];if(a!==l&&(1!==r||a!==a[0]))for(var u=r*i,c=u-i,h=u+i,d=0;d!==i;++d){var p=t[u+d];if(p!==t[c+d]||p!==t[h+d]){s=!0;break}}if(s){if(r!==n){e[n]=e[r];for(var f=r*i,m=n*i,d=0;d!==i;++d)t[m+d]=t[f+d]}++n}}return n!==e.length&&(this.times=THREE.AnimationUtils.arraySlice(e,0,n),this.values=THREE.AnimationUtils.arraySlice(t,0,n*i)),this}},Object.assign(THREE.KeyframeTrack,{parse:function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=THREE.KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],n=[];THREE.AnimationUtils.flattenJSON(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation);
},toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:THREE.AnimationUtils.convertArray(e.times,Array),values:THREE.AnimationUtils.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return THREE.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return THREE.VectorKeyframeTrack;case"color":return THREE.ColorKeyframeTrack;case"quaternion":return THREE.QuaternionKeyframeTrack;case"bool":case"boolean":return THREE.BooleanKeyframeTrack;case"string":return THREE.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)}}),THREE.PropertyBinding=function(e,t,i){this.path=t,this.parsedPath=i||THREE.PropertyBinding.parseTrackName(t),this.node=THREE.PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e},THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=THREE.PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("  trying to update node for track: "+this.path+" but it wasn't found.");if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[i])return void console.error("  can not bind to objectName of node, undefined",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[o]}}var a=e[n];if(void 0===a){var l=t.nodeName;return void console.error("  trying to update property for track: "+l+"."+n+" but it wasn't found.",e)}var u=this.Versioning.None;void 0!==e.needsUpdate?(u=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var c=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!e.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===r){r=s;break}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):void 0!==a.length?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.node[this.propertyName]=e[t]},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),THREE.PropertyBinding.Composite=function(e,t,i){var n=i||THREE.PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)},THREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},THREE.PropertyBinding.create=function(e,t,i){return e instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(e,t,i):new THREE.PropertyBinding(e,t,i)},THREE.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,i=t.exec(e);if(!i)throw new Error("cannot parse trackName at all: "+e);i.index===t.lastIndex&&t.lastIndex++;var n={nodeName:i[3],objectName:i[5],objectIndex:i[7],propertyName:i[9],propertyIndex:i[11]};if(null===n.propertyName||0===n.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return n},THREE.PropertyBinding.findNode=function(e,t){if(!t||""===t||"root"===t||"."===t||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=function(e){for(var i=0;i<e.bones.length;i++){var n=e.bones[i];if(n.name===t)return n}return null},n=i(e.skeleton);if(n)return n}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},o=r(e.children);if(o)return o}return null},THREE.PropertyMixer=function(e,t,i){this.binding=e,this.valueSize=i;var n,r=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0},THREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(e,t){var i=this.buffer,n=this.valueSize,r=e*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)i[r+s]=i[s];o=t}else{o+=t;var a=t/o;this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var s=3*t;this._mixBufferRegion(i,n,s,1-r,t)}for(var a=t,l=t+t;a!==l;++a)if(i[a]!==i[a+t]){o.setValue(i,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,n=3*i;e.getValue(t,n);for(var r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,n,r){if(n>=.5)for(var o=0;o!==r;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,n,r){THREE.Quaternion.slerpFlat(e,t,e,t,e,i,n)},_lerp:function(e,t,i,n,r){for(var o=1-n,s=0;s!==r;++s){var a=t+s;e[a]=e[a]*o+e[i+s]*n}}},THREE.BooleanKeyframeTrack=function(e,t,i){THREE.KeyframeTrack.call(this,e,t,i)},THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),THREE.ColorKeyframeTrack=function(e,t,i,n){THREE.KeyframeTrack.call(this,e,t,i,n)},THREE.ColorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:"color"}),THREE.NumberKeyframeTrack=function(e,t,i,n){THREE.KeyframeTrack.call(this,e,t,i,n)},THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:"number"}),THREE.QuaternionKeyframeTrack=function(e,t,i,n){THREE.KeyframeTrack.call(this,e,t,i,n)},THREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),THREE.StringKeyframeTrack=function(e,t,i,n){THREE.KeyframeTrack.call(this,e,t,i,n)},THREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),THREE.VectorKeyframeTrack=function(e,t,i,n){THREE.KeyframeTrack.call(this,e,t,i,n)},THREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:"vector"}),THREE.Audio=function(e){THREE.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]},THREE.Audio.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.source.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");var e=this.context.createBufferSource();return e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},pause:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this)},stop:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0,this.isPlaying=!1,this)},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):void(this.source.loop=e)},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),THREE.AudioAnalyser=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)},Object.assign(THREE.AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.defineProperty(THREE,"AudioContext",{get:function(){var e;return function(){return void 0===e&&(e=new(window.AudioContext||window.webkitAudioContext)),e}}()}),THREE.PositionalAudio=function(e){THREE.Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},THREE.PositionalAudio.prototype=Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),THREE.AudioListener=function(){THREE.Object3D.call(this),this.type="AudioListener",this.context=THREE.AudioContext,this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null},THREE.AudioListener.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3,n=new THREE.Vector3;return function(r){THREE.Object3D.prototype.updateMatrixWorld.call(this,r);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,i),n.set(0,0,-1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z)}}()}),THREE.Camera=function(){THREE.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.Camera.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this),this.type="CubeCamera";var n=90,r=1,o=new THREE.PerspectiveCamera(n,r,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(1,0,0)),this.add(o);var s=new THREE.PerspectiveCamera(n,r,e,t);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3((-1),0,0)),this.add(s);var a=new THREE.PerspectiveCamera(n,r,e,t);a.up.set(0,0,1),a.lookAt(new THREE.Vector3(0,1,0)),this.add(a);var l=new THREE.PerspectiveCamera(n,r,e,t);l.up.set(0,0,-1),l.lookAt(new THREE.Vector3(0,(-1),0)),this.add(l);var u=new THREE.PerspectiveCamera(n,r,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var c=new THREE.PerspectiveCamera(n,r,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,(-1))),this.add(c);var h={format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter};this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,h),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,o,i),i.activeCubeFace=1,e.render(t,s,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,l,i),i.activeCubeFace=4,e.render(t,u,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,e.render(t,c,i),e.setRenderTarget(null)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.OrthographicCamera=function(e,t,i,n,r,o){THREE.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(e){return THREE.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,r,o){this.view={fullWidth:e,fullHeight:t,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,o=i+e,s=n+t,a=n-t;if(null!==this.view){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;r+=c*(this.view.offsetX/l),o=r+c*(this.view.width/l),s-=h*(this.view.offsetY/u),a=s-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far)},toJSON:function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),THREE.PerspectiveCamera=function(e,t,i,n){THREE.Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(e){return THREE.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*THREE.Math.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*THREE.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*THREE.Math.RAD2DEG*Math.atan(Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,o){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==o){var s=o.fullWidth,a=o.fullHeight;r+=o.offsetX*n/s,t-=o.offsetY*i/a,n*=o.width/s,i*=o.height/a}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makeFrustum(r,r+n,t-i,t,e,this.far)},toJSON:function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),THREE.StereoCamera=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new THREE.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new THREE.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},Object.assign(THREE.StereoCamera.prototype,{update:function(){var e,t,i,n,r,o=new THREE.Matrix4,s=new THREE.Matrix4;return function(a){var l=e!==a.focus||t!==a.fov||i!==a.aspect*this.aspect||n!==a.near||r!==a.far;if(l){e=a.focus,t=a.fov,i=a.aspect*this.aspect,n=a.near,r=a.far;var u,c,h=a.projectionMatrix.clone(),d=.032,p=d*n/e,f=n*Math.tan(THREE.Math.DEG2RAD*t*.5);s.elements[12]=-d,o.elements[12]=d,u=-f*i+p,c=f*i+p,h.elements[0]=2*n/(c-u),h.elements[8]=(c+u)/(c-u),this.cameraL.projectionMatrix.copy(h),u=-f*i-p,c=f*i-p,h.elements[0]=2*n/(c-u),h.elements[8]=(c+u)/(c-u),this.cameraR.projectionMatrix.copy(h)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(s),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(o)}}()}),THREE.Light=function(e,t){THREE.Object3D.call(this),this.type="Light",this.color=new THREE.Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0},THREE.Light.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(e){return THREE.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),t}}),THREE.LightShadow=function(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new THREE.Vector2(512,512),this.map=null,this.matrix=new THREE.Matrix4},Object.assign(THREE.LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),THREE.AmbientLight=function(e,t){THREE.Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0},THREE.AmbientLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight}),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e,t),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.shadow=new THREE.DirectionalLightShadow},THREE.DirectionalLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(e){return THREE.Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),THREE.DirectionalLightShadow=function(e){THREE.LightShadow.call(this,new THREE.OrthographicCamera((-5),5,5,(-5),.5,500))},THREE.DirectionalLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow}),THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new THREE.Color(t)},THREE.HemisphereLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(e){return THREE.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),THREE.PointLight=function(e,t,i,n){THREE.Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))},THREE.PointLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(e){return THREE.Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),THREE.SpotLight=function(e,t,i,n,r,o){THREE.Light.call(this,e,t),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new THREE.SpotLightShadow},THREE.SpotLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(e){return THREE.Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),THREE.SpotLightShadow=function(){THREE.LightShadow.call(this,new THREE.PerspectiveCamera(50,1,.5,500))},THREE.SpotLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(e){var t=2*THREE.Math.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,n=e.distance||500,r=this.camera;t===r.fov&&i===r.aspect&&n===r.far||(r.fov=t,r.aspect=i,r.far=n,r.updateProjectionMatrix())}}),THREE.AudioLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.AudioLoader.prototype,{load:function(e,t,i,n){var r=new THREE.XHRLoader(this.manager);r.setResponseType("arraybuffer"),r.load(e,function(e){var i=THREE.AudioContext;i.decodeAudioData(e,function(e){t(e)})},i,n)}}),THREE.Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,i){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t,i);return n},createMaterial:function(){var e,t,i;return function(n,r,o){function s(e,i,n,s,l){var u,c=r+e,h=THREE.Loader.Handlers.get(c);null!==h?u=h.load(c):(t.setCrossOrigin(o),u=t.load(c)),void 0!==i&&(u.repeat.fromArray(i),1!==i[0]&&(u.wrapS=THREE.RepeatWrapping),1!==i[1]&&(u.wrapT=THREE.RepeatWrapping)),void 0!==n&&u.offset.fromArray(n),void 0!==s&&("repeat"===s[0]&&(u.wrapS=THREE.RepeatWrapping),"mirror"===s[0]&&(u.wrapS=THREE.MirroredRepeatWrapping),"repeat"===s[1]&&(u.wrapT=THREE.RepeatWrapping),"mirror"===s[1]&&(u.wrapT=THREE.MirroredRepeatWrapping)),void 0!==l&&(u.anisotropy=l);var d=THREE.Math.generateUUID();return a[d]=u,d}void 0===e&&(e=new THREE.Color),void 0===t&&(t=new THREE.TextureLoader),void 0===i&&(i=new THREE.MaterialLoader);var a={},l={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"};for(var u in n){var c=n[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":l.name=c;break;case"blending":l.blending=THREE[c];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":l.color=e.fromArray(c).getHex();break;case"colorSpecular":l.specular=e.fromArray(c).getHex();break;case"colorEmissive":l.emissive=e.fromArray(c).getHex();break;case"specularCoef":l.shininess=c;break;case"shading":"basic"===c.toLowerCase()&&(l.type="MeshBasicMaterial"),"phong"===c.toLowerCase()&&(l.type="MeshPhongMaterial"),"standard"===c.toLowerCase()&&(l.type="MeshStandardMaterial");break;case"mapDiffuse":l.map=s(c,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":l.emissiveMap=s(c,n.mapEmissiveRepeat,n.mapEmissiveOffset,n.mapEmissiveWrap,n.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":l.lightMap=s(c,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":l.aoMap=s(c,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":l.bumpMap=s(c,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":l.bumpScale=c;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":l.normalMap=s(c,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":l.normalScale=[c,c];break;
case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":l.specularMap=s(c,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":l.metalnessMap=s(c,n.mapMetalnessRepeat,n.mapMetalnessOffset,n.mapMetalnessWrap,n.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":l.roughnessMap=s(c,n.mapRoughnessRepeat,n.mapRoughnessOffset,n.mapRoughnessWrap,n.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":l.alphaMap=s(c,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":l.side=THREE.BackSide;break;case"doubleSided":l.side=THREE.DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),l.opacity=c;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":l[u]=c;break;case"vertexColors":c===!0&&(l.vertexColors=THREE.VertexColors),"face"===c&&(l.vertexColors=THREE.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,c)}}return"MeshBasicMaterial"===l.type&&delete l.emissive,"MeshPhongMaterial"!==l.type&&delete l.specular,l.opacity<1&&(l.transparent=!0),i.setTextures(a),i.parse(l)}}()},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,n=t.length;i<n;i+=2){var r=t[i],o=t[i+1];if(r.test(e))return o}return null}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.XHRLoader.prototype,{load:function(e,t,i,n){void 0!==this.path&&(e=this.path+e);var r=this,o=THREE.Cache.get(e);if(void 0!==o)return t&&setTimeout(function(){t(o)},0),o;var s=new XMLHttpRequest;return s.overrideMimeType("text/plain"),s.open("GET",e,!0),s.addEventListener("load",function(i){var o=i.target.response;THREE.Cache.add(e,o),200===this.status?(t&&t(o),r.manager.itemEnd(e)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),t&&t(o),r.manager.itemEnd(e)):(n&&n(i),r.manager.itemError(e))},!1),void 0!==i&&s.addEventListener("progress",function(e){i(e)},!1),s.addEventListener("error",function(t){n&&n(t),r.manager.itemError(e)},!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.send(null),r.manager.itemStart(e),s},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this}}),THREE.FontLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FontLoader.prototype,{load:function(e,t,i,n){var r=this,o=new THREE.XHRLoader(this.manager);o.load(e,function(e){var i;try{i=JSON.parse(e)}catch(n){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var o=r.parse(i);t&&t(o)},i,n)},parse:function(e){return new THREE.Font(e)}}),THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,i,n){void 0!==this.path&&(e=this.path+e);var r=this,o=THREE.Cache.get(e);if(void 0!==o)return r.manager.itemStart(e),t?setTimeout(function(){t(o),r.manager.itemEnd(e)},0):r.manager.itemEnd(e),o;var s=document.createElement("img");return s.addEventListener("load",function(i){THREE.Cache.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),void 0!==i&&s.addEventListener("progress",function(e){i(e)},!1),s.addEventListener("error",function(t){n&&n(t),r.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}},THREE.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1},Object.assign(THREE.JSONLoader.prototype,{load:function(e,t,i,n){var r=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(e),s=new THREE.XHRLoader(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(i){var n=JSON.parse(i),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a){if("object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var l=r.parse(n,o);t(l.geometry,l.materials)},i,n)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function i(t){function i(e,t){return e&1<<t}var n,r,o,a,l,u,c,h,d,p,f,m,g,y,v,E,T,b,C,O,x,w,R,L,S,_,I,D=e.faces,M=e.vertices,A=e.normals,N=e.colors,P=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&P++;for(n=0;n<P;n++)s.faceVertexUvs[n]=[]}for(a=0,l=M.length;a<l;)b=new THREE.Vector3,b.x=M[a++]*t,b.y=M[a++]*t,b.z=M[a++]*t,s.vertices.push(b);for(a=0,l=D.length;a<l;)if(p=D[a++],f=i(p,0),m=i(p,1),g=i(p,3),y=i(p,4),v=i(p,5),E=i(p,6),T=i(p,7),f){if(O=new THREE.Face3,O.a=D[a],O.b=D[a+1],O.c=D[a+3],x=new THREE.Face3,x.a=D[a+1],x.b=D[a+2],x.c=D[a+3],a+=4,m&&(d=D[a++],O.materialIndex=d,x.materialIndex=d),o=s.faces.length,g)for(n=0;n<P;n++)for(L=e.uvs[n],s.faceVertexUvs[n][o]=[],s.faceVertexUvs[n][o+1]=[],r=0;r<4;r++)h=D[a++],_=L[2*h],I=L[2*h+1],S=new THREE.Vector2(_,I),2!==r&&s.faceVertexUvs[n][o].push(S),0!==r&&s.faceVertexUvs[n][o+1].push(S);if(y&&(c=3*D[a++],O.normal.set(A[c++],A[c++],A[c]),x.normal.copy(O.normal)),v)for(n=0;n<4;n++)c=3*D[a++],R=new THREE.Vector3(A[c++],A[c++],A[c]),2!==n&&O.vertexNormals.push(R),0!==n&&x.vertexNormals.push(R);if(E&&(u=D[a++],w=N[u],O.color.setHex(w),x.color.setHex(w)),T)for(n=0;n<4;n++)u=D[a++],w=N[u],2!==n&&O.vertexColors.push(new THREE.Color(w)),0!==n&&x.vertexColors.push(new THREE.Color(w));s.faces.push(O),s.faces.push(x)}else{if(C=new THREE.Face3,C.a=D[a++],C.b=D[a++],C.c=D[a++],m&&(d=D[a++],C.materialIndex=d),o=s.faces.length,g)for(n=0;n<P;n++)for(L=e.uvs[n],s.faceVertexUvs[n][o]=[],r=0;r<3;r++)h=D[a++],_=L[2*h],I=L[2*h+1],S=new THREE.Vector2(_,I),s.faceVertexUvs[n][o].push(S);if(y&&(c=3*D[a++],C.normal.set(A[c++],A[c++],A[c])),v)for(n=0;n<3;n++)c=3*D[a++],R=new THREE.Vector3(A[c++],A[c++],A[c]),C.vertexNormals.push(R);if(E&&(u=D[a++],C.color.setHex(N[u])),T)for(n=0;n<3;n++)u=D[a++],C.vertexColors.push(new THREE.Color(N[u]));s.faces.push(C)}}function n(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,n=e.skinWeights.length;i<n;i+=t){var r=e.skinWeights[i],o=t>1?e.skinWeights[i+1]:0,a=t>2?e.skinWeights[i+2]:0,l=t>3?e.skinWeights[i+3]:0;s.skinWeights.push(new THREE.Vector4(r,o,a,l))}if(e.skinIndices)for(var i=0,n=e.skinIndices.length;i<n;i+=t){var u=e.skinIndices[i],c=t>1?e.skinIndices[i+1]:0,h=t>2?e.skinIndices[i+2]:0,d=t>3?e.skinIndices[i+3]:0;s.skinIndices.push(new THREE.Vector4(u,c,h,d))}s.bones=e.bones,s.bones&&s.bones.length>0&&(s.skinWeights.length!==s.skinIndices.length||s.skinIndices.length!==s.vertices.length)&&console.warn("When skinning, number of vertices ("+s.vertices.length+"), skinIndices ("+s.skinIndices.length+"), and skinWeights ("+s.skinWeights.length+") should match.")}function r(t){if(void 0!==e.morphTargets)for(var i=0,n=e.morphTargets.length;i<n;i++){s.morphTargets[i]={},s.morphTargets[i].name=e.morphTargets[i].name,s.morphTargets[i].vertices=[];for(var r=s.morphTargets[i].vertices,o=e.morphTargets[i].vertices,a=0,l=o.length;a<l;a+=3){var u=new THREE.Vector3;u.x=o[a]*t,u.y=o[a+1]*t,u.z=o[a+2]*t,r.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var c=s.faces,h=e.morphColors[0].colors,i=0,n=c.length;i<n;i++)c[i].color.fromArray(h,3*i)}}function o(){var t=[],i=[];void 0!==e.animation&&i.push(e.animation),void 0!==e.animations&&(e.animations.length?i=i.concat(e.animations):i.push(e.animations));for(var n=0;n<i.length;n++){var r=THREE.AnimationClip.parseAnimation(i[n],s.bones);r&&t.push(r)}if(s.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(s.morphTargets,10);t=t.concat(o)}t.length>0&&(s.animations=t)}var s=new THREE.Geometry,a=void 0!==e.scale?1/e.scale:1;if(i(a),n(),r(a),o(),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:s};var l=THREE.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:s,materials:l}}}),THREE.LoadingManager=function(e,t,i){var n=this,r=!1,o=0,s=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,r===!1&&void 0!==n.onStart&&n.onStart(e,o,s),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.BufferGeometryLoader.prototype,{load:function(e,t,i,n){var r=this,o=new THREE.XHRLoader(r.manager);o.load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},parse:function(e){var t=new THREE.BufferGeometry,i=e.data.index,n={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==i){var r=new n[i.type](i.array);t.setIndex(new THREE.BufferAttribute(r,1))}var o=e.data.attributes;for(var s in o){var a=o[s],r=new n[a.type](a.array);t.addAttribute(s,new THREE.BufferAttribute(r,a.itemSize,a.normalized))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(var u=0,c=l.length;u!==c;++u){var h=l[u];t.addGroup(h.start,h.count,h.materialIndex)}var d=e.data.boundingSphere;if(void 0!==d){var p=new THREE.Vector3;void 0!==d.center&&p.fromArray(d.center),t.boundingSphere=new THREE.Sphere(p,d.radius)}return t}}),THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.textures={}},Object.assign(THREE.MaterialLoader.prototype,{load:function(e,t,i,n){var r=this,o=new THREE.XHRLoader(r.manager);o.load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new THREE[e.type];if(void 0!==e.uuid&&(t.uuid=e.uuid),void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metalness&&(t.metalness=e.metalness),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(t.colorWrite=e.colorWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),void 0!==e.normalScale){var i=e.normalScale;Array.isArray(i)===!1&&(i=[i,i]),t.normalScale=(new THREE.Vector2).fromArray(i)}if(void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(t.roughnessMap=this.getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(t.metalnessMap=this.getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(t.emissiveMap=this.getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(t.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=THREE.MultiplyOperation),void 0!==e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var n=0,r=e.materials.length;n<r;n++)t.materials.push(this.parse(e.materials[n]));return t}}),THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.texturePath=""},Object.assign(THREE.ObjectLoader.prototype,{load:function(e,t,i,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this,o=new THREE.XHRLoader(r.manager);o.load(e,function(e){r.parse(JSON.parse(e),t)},i,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),r=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,r),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new THREE.JSONLoader,n=new THREE.BufferGeometryLoader,r=0,o=e.length;r<o;r++){var s,a=e[r];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new THREE[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new THREE[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new THREE[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new THREE[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new THREE[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new THREE[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new THREE[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new THREE[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new THREE[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new THREE[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new THREE[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"BufferGeometry":s=n.parse(a);break;case"Geometry":s=i.parse(a.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseMaterials:function(e,t){var i={};if(void 0!==e){var n=new THREE.MaterialLoader;n.setTextures(t);for(var r=0,o=e.length;r<o;r++){var s=n.parse(e[r]);i[s.uuid]=s}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var n=THREE.AnimationClip.parse(e[i]);t.push(n)}return t},parseImages:function(e,t){function i(e){return n.manager.itemStart(e),s.load(e,function(){n.manager.itemEnd(e)})}var n=this,r={};if(void 0!==e&&e.length>0){var o=new THREE.LoadingManager(t),s=new THREE.ImageLoader(o);s.setCrossOrigin(this.crossOrigin);for(var a=0,l=e.length;a<l;a++){var u=e[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:n.texturePath+u.url;r[u.uuid]=i(c)}}return r},parseTextures:function(e,t){function i(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),THREE[e])}var n={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=new THREE.Texture(t[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping)),void 0!==s.offset&&(a.offset=new THREE.Vector2(s.offset[0],s.offset[1])),void 0!==s.repeat&&(a.repeat=new THREE.Vector2(s.repeat[0],s.repeat[1])),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),Array.isArray(s.wrap)&&(a.wrapS=i(s.wrap[0]),a.wrapT=i(s.wrap[1])),n[s.uuid]=a}return n},parseObject:function(){var e=new THREE.Matrix4;return function(t,i,n){function r(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function o(e){if(void 0!==e)return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}var s;switch(t.type){case"Scene":s=new THREE.Scene;break;case"PerspectiveCamera":s=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":s=new THREE.AmbientLight(t.color,t.intensity);break;case"DirectionalLight":s=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":s=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":s=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var a=r(t.geometry),l=o(t.material);s=a.bones&&a.bones.length>0?new THREE.SkinnedMesh(a,l):new THREE.Mesh(a,l);break;case"LOD":s=new THREE.LOD;break;case"Line":s=new THREE.Line(r(t.geometry),o(t.material),t.mode);break;case"PointCloud":case"Points":s=new THREE.Points(r(t.geometry),o(t.material));break;case"Sprite":s=new THREE.Sprite(o(t.material));break;case"Group":s=new THREE.Group;break;default:s=new THREE.Object3D}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.children)for(var u in t.children)s.add(this.parseObject(t.children[u],i,n));if("LOD"===t.type)for(var c=t.levels,h=0;h<c.length;h++){var d=c[h],u=s.getObjectByProperty("uuid",d.object);void 0!==u&&s.addLevel(u,d.distance)}return s}}()}),THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.TextureLoader.prototype,{load:function(e,t,i,n){var r=new THREE.Texture,o=new THREE.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),THREE.CubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.CubeTextureLoader.prototype,{load:function(e,t,i,n){function r(i){s.load(e[i],function(e){o.images[i]=e,a++,6===a&&(o.needsUpdate=!0,t&&t(o))},void 0,n)}var o=new THREE.CubeTexture,s=new THREE.ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);for(var a=0,l=0;l<e.length;++l)r(l);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},Object.assign(THREE.BinaryTextureLoader.prototype,{load:function(e,t,i,n){var r=this,o=new THREE.DataTexture,s=new THREE.XHRLoader(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){var i=r._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,o.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,o.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,o.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=THREE.LinearFilter),o.needsUpdate=!0,t&&t(o,i))},i,n),o}}),THREE.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},Object.assign(THREE.CompressedTextureLoader.prototype,{load:function(e,t,i,n){function r(r){l.load(e[r],function(e){var i=o._parser(e,!0);s[r]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},u+=1,6===u&&(1===i.mipmapCount&&(a.minFilter=THREE.LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,n)}var o=this,s=[],a=new THREE.CompressedTexture;a.image=s;var l=new THREE.XHRLoader(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)r(c);else l.load(e,function(e){var i=o._parser(e,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,r=0;r<n;r++){s[r]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)s[r].mipmaps.push(i.mipmaps[r*i.mipmapCount+l]),s[r].format=i.format,s[r].width=i.width,s[r].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=THREE.LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,n);return a},setPath:function(e){return this.path=e,this}}),THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=THREE.NormalBlending,this.side=THREE.FrontSide,this.shading=THREE.SmoothShading,this.vertexColors=THREE.NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=THREE.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){var n=this[t];void 0!==n?n instanceof THREE.Color?n.set(i):n instanceof THREE.Vector3&&i instanceof THREE.Vector3?n.copy(i):"overdraw"===t?this[t]=Number(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}var i=void 0===e;i&&(e={textures:{},images:{}});var n={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color instanceof THREE.Color&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive instanceof THREE.Color&&(n.emissive=this.emissive.getHex()),this.specular instanceof THREE.Color&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),this.map instanceof THREE.Texture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap instanceof THREE.Texture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof THREE.Texture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof THREE.Texture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap instanceof THREE.Texture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap instanceof THREE.Texture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap instanceof THREE.Texture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap instanceof THREE.Texture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap instanceof THREE.Texture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap instanceof THREE.Texture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof THREE.Texture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==THREE.NormalBlending&&(n.blending=this.blending),this.shading!==THREE.SmoothShading&&(n.shading=this.shading),this.side!==THREE.FrontSide&&(n.side=this.side),this.vertexColors!==THREE.NoColors&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),i){var r=t(e.textures),o=t(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.shading=e.shading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.clipShadows=e.clipShadows;var t=e.clippingPlanes,i=null;if(null!==t){var n=t.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(THREE.Material.prototype,THREE.EventDispatcher.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.type="LineBasicMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.LineBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.type="LineDashedMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial,THREE.LineDashedMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.type="MeshBasicMaterial",this.color=new THREE.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=THREE.BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,
this.lights=!1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshDepthMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.type="MeshLambertMaterial",this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshLambertMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshNormalMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.type="MeshPhongMaterial",this.color=new THREE.Color(16777215),this.specular=new THREE.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshPhongMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshStandardMaterial=function(e){THREE.Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new THREE.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial,THREE.MeshStandardMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshPhysicalMaterial=function(e){THREE.MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)},THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype),THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial,THREE.MeshPhysicalMaterial.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},THREE.MultiMaterial=function(e){this.uuid=THREE.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(e){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,n=0,r=i.length;n<r;n++){var o=i[n].toJSON(e);delete o.metadata,t.materials.push(o)}return t.visible=this.visible,t},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},THREE.PointsMaterial=function(e){THREE.Material.call(this),this.type="PointsMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)},THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial,THREE.PointsMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},THREE.NVPointCloudMaterial=function(e){THREE.Material.call(this),this.type="NVPointCloudMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.fixedSize=0,this.angle2pixels=0,this.hueOffset=0,this.hueScale=.5,this.alphaAttenuation=1e6,this.useRGB=0,this.RGBColor=new THREE.Vector3(1,0,0),this.lights=!1,this.setValues(e)},THREE.NVPointCloudMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.ShaderMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},THREE.ShaderMaterial.prototype.toJSON=function(e){var t=THREE.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial,THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.type="SpriteMaterial",this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial,THREE.SpriteMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},THREE.ShadowMaterial=function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}}})},THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.ShadowMaterial.prototype.constructor=THREE.ShadowMaterial,THREE.Texture=function(e,t,i,n,r,o,s,a,l,u){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:THREE.RGBAFormat,this.type=void 0!==a?a:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:THREE.LinearEncoding,this.version=0,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){function t(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=THREE.Math.generateUUID()),void 0===e.images[n.uuid]&&(e.images[n.uuid]={uuid:n.uuid,url:t(n)}),i.image=n.uuid}return e.textures[this.uuid]=i,i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===THREE.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case THREE.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case THREE.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case THREE.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case THREE.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype),THREE.TextureIdCount=0,THREE.DepthTexture=function(e,t,i,n,r,o,s,a,l){THREE.Texture.call(this,null,n,r,o,s,a,THREE.DepthFormat,i,l),this.image={width:e,height:t},this.type=void 0!==i?i:THREE.UnsignedShortType,this.magFilter=void 0!==s?s:THREE.NearestFilter,this.minFilter=void 0!==a?a:THREE.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DepthTexture.prototype.constructor=THREE.DepthTexture,THREE.CanvasTexture=function(e,t,i,n,r,o,s,a,l){THREE.Texture.call(this,e,t,i,n,r,o,s,a,l),this.needsUpdate=!0},THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture,THREE.CubeTexture=function(e,t,i,n,r,o,s,a,l,u){e=void 0!==e?e:[],t=void 0!==t?t:THREE.CubeReflectionMapping,THREE.Texture.call(this,e,t,i,n,r,o,s,a,l,u),this.flipY=!1},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.prototype.constructor=THREE.CubeTexture,Object.defineProperty(THREE.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),THREE.CompressedTexture=function(e,t,i,n,r,o,s,a,l,u,c,h){THREE.Texture.call(this,null,o,s,a,l,u,n,r,c,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture,THREE.DataTexture=function(e,t,i,n,r,o,s,a,l,u,c,h){THREE.Texture.call(this,null,o,s,a,l,u,n,r,c,h),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:THREE.NearestFilter,this.minFilter=void 0!==u?u:THREE.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.VideoTexture=function(e,t,i,n,r,o,s,a,l){function u(){requestAnimationFrame(u),e.readyState>=e.HAVE_CURRENT_DATA&&(c.needsUpdate=!0)}THREE.Texture.call(this,e,t,i,n,r,o,s,a,l),this.generateMipmaps=!1;var c=this;u()},THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),THREE.VideoTexture.prototype.constructor=THREE.VideoTexture,THREE.Group=function(){THREE.Object3D.call(this),this.type="Group"},THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group}),THREE.Points=function(e,t){THREE.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new THREE.BufferGeometry,this.material=void 0!==t?t:new THREE.PointsMaterial({color:16777215*Math.random()})},THREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var e=new THREE.Matrix4,t=new THREE.Ray,i=new THREE.Sphere;return function(n,r){function o(e,i){var o=t.distanceSqToPoint(e);if(o<h){var a=t.closestPointToPoint(e);a.applyMatrix4(l);var u=n.ray.origin.distanceTo(a);if(u<n.near||u>n.far)return;r.push({distance:u,distanceToRay:Math.sqrt(o),point:a.clone(),index:i,face:null,object:s})}}var s=this,a=this.geometry,l=this.matrixWorld,u=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(l),n.ray.intersectsSphere(i)!==!1){e.getInverse(l),t.copy(n.ray).applyMatrix4(e);var c=u/((this.scale.x+this.scale.y+this.scale.z)/3),h=c*c,d=new THREE.Vector3;if(a instanceof THREE.BufferGeometry){var p=a.index,f=a.attributes,m=f.position.array;if(null!==p)for(var g=p.array,y=0,v=g.length;y<v;y++){var E=g[y];d.fromArray(m,3*E),o(d,E)}else for(var y=0,T=m.length/3;y<T;y++)d.fromArray(m,3*y),o(d,y)}else for(var b=a.vertices,y=0,T=b.length;y<T;y++)o(b[y],y)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),THREE.Line=function(e,t,i){return 1===i?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(e,t)):(THREE.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new THREE.BufferGeometry,void(this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()})))},THREE.Line.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var e=new THREE.Matrix4,t=new THREE.Ray,i=new THREE.Sphere;return function(n,r){var o=n.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(l),n.ray.intersectsSphere(i)!==!1){e.getInverse(l),t.copy(n.ray).applyMatrix4(e);var u=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(a instanceof THREE.BufferGeometry){var f=a.index,m=a.attributes,g=m.position.array;if(null!==f)for(var y=f.array,v=0,E=y.length-1;v<E;v+=p){var T=y[v],b=y[v+1];u.fromArray(g,3*T),c.fromArray(g,3*b);var C=t.distanceSqToSegment(u,c,d,h);if(!(C>s)){d.applyMatrix4(this.matrixWorld);var O=n.ray.origin.distanceTo(d);O<n.near||O>n.far||r.push({distance:O,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var v=0,E=g.length/3-1;v<E;v+=p){u.fromArray(g,3*v),c.fromArray(g,3*v+3);var C=t.distanceSqToSegment(u,c,d,h);if(!(C>s)){d.applyMatrix4(this.matrixWorld);var O=n.ray.origin.distanceTo(d);O<n.near||O>n.far||r.push({distance:O,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(a instanceof THREE.Geometry)for(var x=a.vertices,w=x.length,v=0;v<w-1;v+=p){var C=t.distanceSqToSegment(x[v],x[v+1],d,h);if(!(C>s)){d.applyMatrix4(this.matrixWorld);var O=n.ray.origin.distanceTo(d);O<n.near||O>n.far||r.push({distance:O,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),THREE.LineSegments=function(e,t){THREE.Line.call(this,e,t),this.type="LineSegments"},THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments}),THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new THREE.BufferGeometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=THREE.TrianglesDrawMode,this.updateMorphTargets()},THREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(e){this.drawMode=e},copy:function(e){return THREE.Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},getMorphTargetIndexByName:function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},raycast:function(){function e(e,t,i,n,r,o,s){return THREE.Triangle.barycoordFromPoint(e,t,i,n,m),r.multiplyScalar(m.x),o.multiplyScalar(m.y),s.multiplyScalar(m.z),r.add(o).add(s),r.clone()}function t(e,t,i,n,r,o,s){var a,l=e.material;if(a=l.side===THREE.BackSide?i.intersectTriangle(o,r,n,!0,s):i.intersectTriangle(n,r,o,l.side!==THREE.DoubleSide,s),null===a)return null;y.copy(s),y.applyMatrix4(e.matrixWorld);var u=t.ray.origin.distanceTo(y);return u<t.near||u>t.far?null:{distance:u,point:y.clone(),object:e}}function i(i,n,r,o,u,c,h,m){s.fromArray(o,3*c),a.fromArray(o,3*h),l.fromArray(o,3*m);var y=t(i,n,r,s,a,l,g);return y&&(u&&(d.fromArray(u,2*c),p.fromArray(u,2*h),f.fromArray(u,2*m),y.uv=e(g,s,a,l,d,p,f)),y.face=new THREE.Face3(c,h,m,THREE.Triangle.normal(s,a,l)),y.faceIndex=c),y}var n=new THREE.Matrix4,r=new THREE.Ray,o=new THREE.Sphere,s=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Vector2,m=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3;return function(m,y){var v=this.geometry,E=this.material,T=this.matrixWorld;if(void 0!==E&&(null===v.boundingSphere&&v.computeBoundingSphere(),o.copy(v.boundingSphere),o.applyMatrix4(T),m.ray.intersectsSphere(o)!==!1&&(n.getInverse(T),r.copy(m.ray).applyMatrix4(n),null===v.boundingBox||r.intersectsBox(v.boundingBox)!==!1))){var b,C;if(v instanceof THREE.BufferGeometry){var O,x,w,R=v.index,L=v.attributes,S=L.position.array;if(void 0!==L.uv&&(b=L.uv.array),null!==R)for(var _=R.array,I=0,D=_.length;I<D;I+=3)O=_[I],x=_[I+1],w=_[I+2],C=i(this,m,r,S,b,O,x,w),C&&(C.faceIndex=Math.floor(I/3),y.push(C));else for(var I=0,D=S.length;I<D;I+=9)O=I/3,x=O+1,w=O+2,C=i(this,m,r,S,b,O,x,w),C&&(C.index=O,y.push(C))}else if(v instanceof THREE.Geometry){var M,A,N,P=E instanceof THREE.MultiMaterial,k=P===!0?E.materials:null,H=v.vertices,F=v.faces,B=v.faceVertexUvs[0];B.length>0&&(b=B);for(var K=0,z=F.length;K<z;K++){var U=F[K],V=P===!0?k[U.materialIndex]:E;if(void 0!==V){if(M=H[U.a],A=H[U.b],N=H[U.c],V.morphTargets===!0){var G=v.morphTargets,$=this.morphTargetInfluences;s.set(0,0,0),a.set(0,0,0),l.set(0,0,0);for(var W=0,j=G.length;W<j;W++){var X=$[W];if(0!==X){var q=G[W].vertices;s.addScaledVector(u.subVectors(q[U.a],M),X),a.addScaledVector(c.subVectors(q[U.b],A),X),l.addScaledVector(h.subVectors(q[U.c],N),X)}}s.add(M),a.add(A),l.add(N),M=s,A=a,N=l}if(C=t(this,m,r,M,A,N,g)){if(b){var Z=b[K];d.copy(Z[0]),p.copy(Z[1]),f.copy(Z[2]),C.uv=e(g,M,A,N,d,p,f)}C.face=U,C.faceIndex=K,y.push(C)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),THREE.Bone=function(e){THREE.Object3D.call(this),this.type="Bone",this.skin=e},THREE.Bone.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(e){return THREE.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this}}),THREE.Skeleton=function(e,t,i){if(this.useVertexTexture=void 0===i||i,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var n=Math.sqrt(4*this.bones.length);n=THREE.Math.nextPowerOfTwo(Math.ceil(n)),n=Math.max(n,4),this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new THREE.Matrix4)}},Object.assign(THREE.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new THREE.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var e,t=0,i=this.bones.length;t<i;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,i=this.bones.length;t<i;t++)e=this.bones[t],e&&(e.parent instanceof THREE.Bone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new THREE.Matrix4;return function(){for(var t=0,i=this.bones.length;t<i;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(n,this.boneInverses[t]),e.toArray(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}}),THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,s=0,a=this.geometry.bones.length;s<a;++s)o=this.geometry.bones[s],r=new THREE.Bone(this),n.push(r),r.name=o.name,r.position.fromArray(o.pos),r.quaternion.fromArray(o.rotq),void 0!==o.scl&&r.scale.fromArray(o.scl);for(var s=0,a=this.geometry.bones.length;s<a;++s)o=this.geometry.bones[s],o.parent!==-1&&null!==o.parent&&void 0!==n[o.parent]?n[o.parent].add(n[s]):this.add(n[s])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(n,(void 0),i),this.matrixWorld)},THREE.SkinnedMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var n=new THREE.Vector4,r=this.geometry.attributes.skinWeight,e=0;e<r.count;e++){n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e);var i=1/n.lengthManhattan();i!==1/0?n.multiplyScalar(i):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),THREE.LOD=function(){THREE.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})},THREE.LOD.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(e){THREE.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,n=t.length;i<n;i++){var r=t[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,n=0;n<i.length&&!(t<i[n].distance);n++);i.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object},raycast:function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,i)}}(),update:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&r>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),THREE.Sprite=function(e){THREE.Object3D.call(this),this.type="Sprite",this.material=void 0!==e?e:new THREE.SpriteMaterial},THREE.Sprite.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceSqToPoint(e),r=this.scale.x*this.scale.y/4;n>r||i.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),THREE.LensFlare=function(e,t,i,n,r){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},THREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(e){THREE.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);
return this},add:function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new THREE.Color(16777215)),void 0===n&&(n=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:r,blending:n})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<i;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)}}),THREE.Scene=function(){THREE.Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.copy=function(e,t){return THREE.Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},THREE.Fog=function(e,t,i){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={},THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",THREE.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",THREE.ShaderChunk.clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n",THREE.ShaderChunk.clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",THREE.ShaderChunk.clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",THREE.ShaderChunk.clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",THREE.ShaderChunk.common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",THREE.ShaderChunk.cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",THREE.ShaderChunk.encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",THREE.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",THREE.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",THREE.ShaderChunk.envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",THREE.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",THREE.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
THREE.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",THREE.ShaderChunk.lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",THREE.ShaderChunk.lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",THREE.ShaderChunk.lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",THREE.ShaderChunk.lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",THREE.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",THREE.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",THREE.ShaderChunk.normal_flip="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",THREE.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",THREE.ShaderChunk.packing="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",THREE.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",THREE.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",THREE.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",THREE.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",THREE.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",THREE.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",THREE.UniformsUtils={merge:function(e){for(var t={},i=0;i<e.length;i++){var n=this.clone(e[i]);for(var r in n)t[r]=n[r]}return t},clone:function(e){var t={};for(var i in e){t[i]={};for(var n in e[i]){var r=e[i][n];r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix3||r instanceof THREE.Matrix4||r instanceof THREE.Texture?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}},THREE.UniformsLib={common:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new THREE.Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)}},nvpointcloud:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fixedSize:{type:"f",value:0},angle2pixels:{type:"f",value:10},hueOffset:{type:"f",value:0},hueScale:{type:"f",value:.5},alphaAttenuation:{type:"f",value:1e6},useRGB:{type:"i",value:0},RGBColor:{type:"c",value:new THREE.Color(16711680)}}},THREE.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\t#include <logdepthbuf_fragment>\n}\n",THREE.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
THREE.ShaderChunk.depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",THREE.ShaderChunk.depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",THREE.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",THREE.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",THREE.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <logdepthbuf_fragment>\n}\n",THREE.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",THREE.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",THREE.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",THREE.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",THREE.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",THREE.ShaderChunk.meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",THREE.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",THREE.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",THREE.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",THREE.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",THREE.ShaderChunk.shadow_frag="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",THREE.ShaderChunk.shadow_vert="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,fragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},specular:{value:new THREE.Color(1118481)},shininess:{value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,fragmentShader:THREE.ShaderChunk.meshphong_frag},standard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.displacementmap]),vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,fragmentShader:THREE.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new THREE.Vector3}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag},nvpointcloud:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.nvpointcloud]),vertexShader:["uniform float size;","uniform float fixedSize;","uniform float scale;","uniform float angle2pixels;","uniform float opacity;","uniform float hueOffset, hueScale, alphaAttenuation;","uniform int useRGB;","uniform vec3 RGBColor;","varying vec4 vColor;","vec3 hue2rgb(float hue) {","float r = abs(hue * 6. - 3.) - 1.;","float g = 2. - abs(hue * 6. - 2.);","float b = 2. - abs(hue * 6. - 4.);","return clamp(vec3(r,g,b), 0., 1.);","}","void main() {","vec4 position4 = vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * position4;","float o = opacity * exp(- length(mvPosition.xyz) / alphaAttenuation);","if(useRGB == 0) {","vec4 mwPosition = modelMatrix * position4;","float t = mwPosition.z * hueScale - hueOffset;","float hue = mod(t, 1.);","vColor = vec4(hue2rgb(hue), o);","} else {","vColor = vec4(RGBColor, o);","}","if(fixedSize <= 0.0)","gl_PointSize = asin(size / length(mvPosition.xyz)) * angle2pixels;","else","gl_PointSize = fixedSize;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 psColor;","varying vec4 vColor;",THREE.ShaderChunk.map_particle_pars_fragment,"void main() {","gl_FragColor = vColor;",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,"}"].join("\n")}},THREE.ShaderLib.physical={uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag},THREE.WebGLRenderer=function(e){function t(){return null===te?fe:1}function i(e,t,i,n){V===!0&&(e*=n,t*=n,i*=n),Me.clearColor(e,t,i,n)}function n(){Me.init(),Me.scissor(se.copy(me).multiplyScalar(fe)),Me.viewport(le.copy(ye).multiplyScalar(fe)),i(ce.r,ce.g,ce.b,he)}function r(){ee=null,oe=null,re="",ne=-1,Me.reset()}function o(e){e.preventDefault(),r(),n(),Ae.clear()}function s(e){var t=e.target;t.removeEventListener("dispose",s),a(t)}function a(e){l(e),Ae["delete"](e)}function l(e){var t=Ae.get(e).program;e.program=void 0,void 0!==t&&ke.releaseProgram(t)}function u(e,t,i,n){var r;if(i instanceof THREE.InstancedBufferGeometry&&(r=Ie.get("ANGLE_instanced_arrays"),null===r))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0),Me.initAttributes();var o=i.attributes,s=t.getAttributes(),a=e.defaultAttributeValues;for(var l in s){var u=s[l];if(u>=0){var c=o[l];if(void 0!==c){var h=Le.FLOAT,d=c.array,p=c.normalized;d instanceof Float32Array?h=Le.FLOAT:d instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):d instanceof Uint16Array?h=Le.UNSIGNED_SHORT:d instanceof Int16Array?h=Le.SHORT:d instanceof Uint32Array?h=Le.UNSIGNED_INT:d instanceof Int32Array?h=Le.INT:d instanceof Int8Array?h=Le.BYTE:d instanceof Uint8Array&&(h=Le.UNSIGNED_BYTE);var f=c.itemSize,m=Pe.getAttributeBuffer(c);if(c instanceof THREE.InterleavedBufferAttribute){var g=c.data,y=g.stride,v=c.offset;g instanceof THREE.InstancedInterleavedBuffer?(Me.enableAttributeAndDivisor(u,g.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=g.meshPerAttribute*g.count)):Me.enableAttribute(u),Le.bindBuffer(Le.ARRAY_BUFFER,m),Le.vertexAttribPointer(u,f,h,p,y*g.array.BYTES_PER_ELEMENT,(n*y+v)*g.array.BYTES_PER_ELEMENT)}else c instanceof THREE.InstancedBufferAttribute?(Me.enableAttributeAndDivisor(u,c.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=c.meshPerAttribute*c.count)):Me.enableAttribute(u),Le.bindBuffer(Le.ARRAY_BUFFER,m),Le.vertexAttribPointer(u,f,h,p,0,n*f*c.array.BYTES_PER_ELEMENT)}else if(void 0!==a){var E=a[l];if(void 0!==E)switch(E.length){case 2:Le.vertexAttrib2fv(u,E);break;case 3:Le.vertexAttrib3fv(u,E);break;case 4:Le.vertexAttrib4fv(u,E);break;default:Le.vertexAttrib1fv(u,E)}}}}Me.disableUnusedAttributes()}function c(e,t){return Math.abs(t[0])-Math.abs(e[0])}function h(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function d(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function p(e,t,i,n,r){var o,s;i.transparent?(o=X,s=++q):(o=W,s=++j);var a=o[s];void 0!==a?(a.id=e.id,a.object=e,a.geometry=t,a.material=i,a.z=xe.z,a.group=r):(a={id:e.id,object:e,geometry:t,material:i,z:xe.z,group:r},o.push(a))}function f(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ce.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),g(Ce)}function m(e){return Ce.center.set(0,0,0),Ce.radius=.7071067811865476,Ce.applyMatrix4(e.matrixWorld),g(Ce)}function g(e){if(!ve.intersectsSphere(e))return!1;var t=Ee.numPlanes;if(0===t)return!0;var i=Q.clippingPlanes,n=e.center,r=-e.radius,o=0;do if(i[o].distanceToPoint(n)<r)return!1;while(++o!==t);return!0}function y(e,t){if(e.visible!==!1){if(e.layers.test(t.layers))if(e instanceof THREE.Light)$.push(e);else if(e instanceof THREE.Sprite)e.frustumCulled!==!1&&m(e)!==!0||Y.push(e);else if(e instanceof THREE.LensFlare)J.push(e);else if(e instanceof THREE.ImmediateRenderObject)Q.sortObjects===!0&&(xe.setFromMatrixPosition(e.matrixWorld),xe.applyProjection(Oe)),p(e,null,e.material,xe.z,null);else if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&(e instanceof THREE.SkinnedMesh&&e.skeleton.update(),e.frustumCulled===!1||f(e)===!0)){var i=e.material;if(i.visible===!0){Q.sortObjects===!0&&(xe.setFromMatrixPosition(e.matrixWorld),xe.applyProjection(Oe));var n=Pe.update(e);if(i instanceof THREE.MultiMaterial)for(var r=n.groups,o=i.materials,s=0,a=r.length;s<a;s++){var l=r[s],u=o[l.materialIndex];u.visible===!0&&p(e,n,u,xe.z,l)}else p(e,n,i,xe.z,null)}}for(var c=e.children,s=0,a=c.length;s<a;s++)y(c[s],t)}}function v(e,t,i,n){for(var r=0,o=e.length;r<o;r++){var s=e[r],a=s.object,l=s.geometry,u=void 0===n?s.material:n,c=s.group;if(a.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix),a instanceof THREE.ImmediateRenderObject){T(u);var h=b(t,i,u,a);re="",a.render(function(e){Q.renderBufferImmediate(e,h,u)})}else Q.renderBufferDirect(t,i,l,u,a,c)}}function E(e,t,i){var n=Ae.get(e),r=ke.getParameters(e,we,t,Ee.numPlanes,i),o=ke.getProgramCode(e,r),a=n.program,u=!0;if(void 0===a)e.addEventListener("dispose",s);else if(a.code!==o)l(e);else{if(void 0!==r.shaderID)return;u=!1}if(u){if(r.shaderID){var c=THREE.ShaderLib[r.shaderID];n.__webglShader={name:e.type,uniforms:THREE.UniformsUtils.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=n.__webglShader,a=ke.acquireProgram(e,r,o),n.program=a,e.program=a}var h=a.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<Q.maxMorphTargets;d++)h["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<Q.maxMorphNormals;d++)h["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var p=n.__webglShader.uniforms;(e instanceof THREE.ShaderMaterial||e instanceof THREE.RawShaderMaterial)&&e.clipping!==!0||(n.numClippingPlanes=Ee.numPlanes,p.clippingPlanes=Ee.uniform),e.lights&&(n.lightsHash=we.hash,p.ambientLightColor.value=we.ambient,p.directionalLights.value=we.directional,p.spotLights.value=we.spot,p.pointLights.value=we.point,p.hemisphereLights.value=we.hemi,p.directionalShadowMap.value=we.directionalShadowMap,p.directionalShadowMatrix.value=we.directionalShadowMatrix,p.spotShadowMap.value=we.spotShadowMap,p.spotShadowMatrix.value=we.spotShadowMatrix,p.pointShadowMap.value=we.pointShadowMap,p.pointShadowMatrix.value=we.pointShadowMatrix);var f=n.program.getUniforms(),m=THREE.WebGLUniforms.seqWithValue(f.seq,p);n.uniformsList=m,n.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,p)}function T(e){e.side!==THREE.DoubleSide?Me.enable(Le.CULL_FACE):Me.disable(Le.CULL_FACE),Me.setFlipSided(e.side===THREE.BackSide),e.transparent===!0?Me.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):Me.setBlending(THREE.NoBlending),Me.setDepthFunc(e.depthFunc),Me.setDepthTest(e.depthTest),Me.setDepthWrite(e.depthWrite),Me.setColorWrite(e.colorWrite),Me.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function b(e,t,i,n){ue=0;var r=Ae.get(i);if(Te){if(be||e!==oe){var o=e===oe&&i.id===ne;Ee.setState(i.clippingPlanes,i.clipShadows,e,r,o)}void 0!==r.numClippingPlanes&&r.numClippingPlanes!==Ee.numPlanes&&(i.needsUpdate=!0)}void 0===r.program&&(i.needsUpdate=!0),void 0!==r.lightsHash&&r.lightsHash!==we.hash&&(i.needsUpdate=!0),i.needsUpdate&&(E(i,t,n),i.needsUpdate=!1);var s=!1,a=!1,l=!1,u=r.program,c=u.getUniforms(),h=r.__webglShader.uniforms;if(u.id!==ee&&(Le.useProgram(u.program),ee=u.id,s=!0,a=!0,l=!0),i.id!==ne&&(ne=i.id,a=!0),s||e!==oe){if(c.set(Le,e,"projectionMatrix"),De.logarithmicDepthBuffer&&c.setValue(Le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),e!==oe&&(oe=e,a=!0,l=!0),i instanceof THREE.ShaderMaterial||i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshStandardMaterial||i instanceof THREE.NVPointCloudMaterial||i.envMap){var d=c.map.cameraPosition;void 0!==d&&d.setValue(Le,xe.setFromMatrixPosition(e.matrixWorld))}(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshStandardMaterial||i instanceof THREE.ShaderMaterial||i instanceof THREE.NVPointCloudMaterial||i.skinning)&&c.setValue(Le,"viewMatrix",e.matrixWorldInverse),c.set(Le,Q,"toneMappingExposure"),c.set(Le,Q,"toneMappingWhitePoint")}if(i.skinning){c.setOptional(Le,n,"bindMatrix"),c.setOptional(Le,n,"bindMatrixInverse");var p=n.skeleton;p&&(De.floatVertexTextures&&p.useVertexTexture?(c.set(Le,p,"boneTexture"),c.set(Le,p,"boneTextureWidth"),c.set(Le,p,"boneTextureHeight")):c.setOptional(Le,p,"boneMatrices"));
}a&&(i.lights&&M(h,l),t&&i.fog&&L(h,t),(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshStandardMaterial||i instanceof THREE.MeshDepthMaterial)&&C(h,i),i instanceof THREE.LineBasicMaterial?O(h,i):i instanceof THREE.LineDashedMaterial?(O(h,i),x(h,i)):i instanceof THREE.PointsMaterial?w(h,i):i instanceof THREE.MeshLambertMaterial?S(h,i):i instanceof THREE.NVPointCloudMaterial?R(h,i):i instanceof THREE.MeshPhongMaterial?_(h,i):i instanceof THREE.MeshPhysicalMaterial?D(h,i):i instanceof THREE.MeshStandardMaterial?I(h,i):i instanceof THREE.MeshDepthMaterial?i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias):i instanceof THREE.MeshNormalMaterial&&(h.opacity.value=i.opacity),THREE.WebGLUniforms.upload(Le,r.uniformsList,h,Q)),c.set(Le,n,"modelViewMatrix"),c.set(Le,n,"normalMatrix"),c.setValue(Le,"modelMatrix",n.matrixWorld);var f=r.dynamicUniforms;return null!==f&&(THREE.WebGLUniforms.evalDynamic(f,h,n,e),THREE.WebGLUniforms.upload(Le,f,h,Q)),u}function C(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i){i instanceof THREE.WebGLRenderTarget&&(i=i.texture);var n=i.offset,r=i.repeat;e.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.CubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function O(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function x(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function w(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*fe,e.scale.value=.5*H.clientHeight,e.map.value=t.map,null!==t.map){var i=t.map.offset,n=t.map.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}function R(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*fe,e.scale.value=H.clientHeight/2,e.map.value=t.map,e.fixedSize.value=t.fixedSize,e.angle2pixels.value=t.angle2pixels,e.hueOffset.value=t.hueOffset,e.hueScale.value=t.hueScale,e.alphaAttenuation.value=t.alphaAttenuation,e.useRGB.value=t.useRGB,e.RGBColor.value=t.RGBColor,null!==t.map){var i=t.map.offset,n=t.map.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}function L(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function S(e,t){t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function _(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function I(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function D(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,I(e,t)}function M(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function A(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];r.castShadow&&(we.shadows[t++]=r)}we.shadows.length=t}function N(e,t){var i,n,r,o,s,a,l,u=0,c=0,h=0,d=t.matrixWorldInverse,p=0,f=0,m=0,g=0;for(i=0,n=e.length;i<n;i++)if(r=e[i],o=r.color,s=r.intensity,a=r.distance,l=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r instanceof THREE.AmbientLight)u+=o.r*s,c+=o.g*s,h+=o.b*s;else if(r instanceof THREE.DirectionalLight){var y=He.get(r);y.color.copy(r.color).multiplyScalar(r.intensity),y.direction.setFromMatrixPosition(r.matrixWorld),xe.setFromMatrixPosition(r.target.matrixWorld),y.direction.sub(xe),y.direction.transformDirection(d),y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),we.directionalShadowMap[p]=l,we.directionalShadowMatrix[p]=r.shadow.matrix,we.directional[p++]=y}else if(r instanceof THREE.SpotLight){var y=He.get(r);y.position.setFromMatrixPosition(r.matrixWorld),y.position.applyMatrix4(d),y.color.copy(o).multiplyScalar(s),y.distance=a,y.direction.setFromMatrixPosition(r.matrixWorld),xe.setFromMatrixPosition(r.target.matrixWorld),y.direction.sub(xe),y.direction.transformDirection(d),y.coneCos=Math.cos(r.angle),y.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),y.decay=0===r.distance?0:r.decay,y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),we.spotShadowMap[m]=l,we.spotShadowMatrix[m]=r.shadow.matrix,we.spot[m++]=y}else if(r instanceof THREE.PointLight){var y=He.get(r);y.position.setFromMatrixPosition(r.matrixWorld),y.position.applyMatrix4(d),y.color.copy(r.color).multiplyScalar(r.intensity),y.distance=r.distance,y.decay=0===r.distance?0:r.decay,y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),we.pointShadowMap[f]=l,void 0===we.pointShadowMatrix[f]&&(we.pointShadowMatrix[f]=new THREE.Matrix4),xe.setFromMatrixPosition(r.matrixWorld).negate(),we.pointShadowMatrix[f].identity().setPosition(xe),we.point[f++]=y}else if(r instanceof THREE.HemisphereLight){var y=He.get(r);y.direction.setFromMatrixPosition(r.matrixWorld),y.direction.transformDirection(d),y.direction.normalize(),y.skyColor.copy(r.color).multiplyScalar(s),y.groundColor.copy(r.groundColor).multiplyScalar(s),we.hemi[g++]=y}we.ambient[0]=u,we.ambient[1]=c,we.ambient[2]=h,we.directional.length=p,we.spot.length=m,we.point.length=f,we.hemi.length=g,we.hash=p+","+f+","+m+","+g+","+we.shadows.length}function P(){var e=ue;return e>=De.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+De.maxTextures),ue+=1,e}function k(e){var t;if(e===THREE.RepeatWrapping)return Le.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Le.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Le.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Le.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Le.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Le.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Le.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Le.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Le.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Le.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Le.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Le.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Le.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Le.BYTE;if(e===THREE.ShortType)return Le.SHORT;if(e===THREE.UnsignedShortType)return Le.UNSIGNED_SHORT;if(e===THREE.IntType)return Le.INT;if(e===THREE.UnsignedIntType)return Le.UNSIGNED_INT;if(e===THREE.FloatType)return Le.FLOAT;if(t=Ie.get("OES_texture_half_float"),null!==t&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return Le.ALPHA;if(e===THREE.RGBFormat)return Le.RGB;if(e===THREE.RGBAFormat)return Le.RGBA;if(e===THREE.LuminanceFormat)return Le.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Le.LUMINANCE_ALPHA;if(e===THREE.DepthFormat)return Le.DEPTH_COMPONENT;if(e===THREE.AddEquation)return Le.FUNC_ADD;if(e===THREE.SubtractEquation)return Le.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Le.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Le.ZERO;if(e===THREE.OneFactor)return Le.ONE;if(e===THREE.SrcColorFactor)return Le.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Le.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Le.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Le.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Le.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Le.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Le.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Le.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Le.SRC_ALPHA_SATURATE;if(t=Ie.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=Ie.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=Ie.get("WEBGL_compressed_texture_etc1"),null!==t&&e===THREE.RGB_ETC1_Format)return t.COMPRESSED_RGB_ETC1_WEBGL;if(t=Ie.get("EXT_blend_minmax"),null!==t){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var H=void 0!==e.canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),F=void 0!==e.context?e.context:null,B=void 0!==e.alpha&&e.alpha,K=void 0===e.depth||e.depth,z=void 0===e.stencil||e.stencil,U=void 0!==e.antialias&&e.antialias,V=void 0===e.premultipliedAlpha||e.premultipliedAlpha,G=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,$=[],W=[],j=-1,X=[],q=-1,Z=new Float32Array(8),Y=[],J=[];this.domElement=H,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=THREE.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var Q=this,ee=null,te=null,ie=null,ne=-1,re="",oe=null,se=new THREE.Vector4,ae=null,le=new THREE.Vector4,ue=0,ce=new THREE.Color(0),he=0,de=H.width,pe=H.height,fe=1,me=new THREE.Vector4(0,0,de,pe),ge=!1,ye=new THREE.Vector4(0,0,de,pe),ve=new THREE.Frustum,Ee=new THREE.WebGLClipping,Te=!1,be=!1,Ce=new THREE.Sphere,Oe=new THREE.Matrix4,xe=new THREE.Vector3,we={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Re={calls:0,vertices:0,faces:0,points:0};this.info={render:Re,memory:{geometries:0,textures:0},programs:null};var Le;try{var Se={alpha:B,depth:K,stencil:z,antialias:U,premultipliedAlpha:V,preserveDrawingBuffer:G};if(Le=F||H.getContext("webgl",Se)||H.getContext("experimental-webgl",Se),null===Le)throw null!==H.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Le.getShaderPrecisionFormat&&(Le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),H.addEventListener("webglcontextlost",o,!1)}catch(_e){console.error("THREE.WebGLRenderer: "+_e)}var Ie=new THREE.WebGLExtensions(Le);Ie.get("WEBGL_depth_texture"),Ie.get("OES_texture_float"),Ie.get("OES_texture_float_linear"),Ie.get("OES_texture_half_float"),Ie.get("OES_texture_half_float_linear"),Ie.get("OES_standard_derivatives"),Ie.get("ANGLE_instanced_arrays"),Ie.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var De=new THREE.WebGLCapabilities(Le,Ie,e),Me=new THREE.WebGLState(Le,Ie,k),Ae=new THREE.WebGLProperties,Ne=new THREE.WebGLTextures(Le,Ie,Me,Ae,De,k,this.info),Pe=new THREE.WebGLObjects(Le,Ae,this.info),ke=new THREE.WebGLPrograms(this,De),He=new THREE.WebGLLights;this.info.programs=ke.programs;var Fe=new THREE.WebGLBufferRenderer(Le,Ie,Re),Be=new THREE.WebGLIndexedBufferRenderer(Le,Ie,Re),Ke=new THREE.OrthographicCamera((-1),1,1,(-1),0,1),ze=new THREE.PerspectiveCamera,Ue=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1})),Ve=THREE.ShaderLib.cube,Ge=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),new THREE.ShaderMaterial({uniforms:Ve.uniforms,vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader,depthTest:!1,depthWrite:!1,side:THREE.BackSide}));Pe.update(Ue),Pe.update(Ge),n(),this.context=Le,this.capabilities=De,this.extensions=Ie,this.properties=Ae,this.state=Me;var $e=new THREE.WebGLShadowMap(this,we,Pe);this.shadowMap=$e;var We=new THREE.SpritePlugin(this,Y),je=new THREE.LensFlarePlugin(this,J);this.getContext=function(){return Le},this.getContextAttributes=function(){return Le.getContextAttributes()},this.forceContextLoss=function(){Ie.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return De.getMaxAnisotropy()},this.getPrecision=function(){return De.precision},this.getPixelRatio=function(){return fe},this.setPixelRatio=function(e){void 0!==e&&(fe=e,this.setSize(ye.z,ye.w,!1))},this.getSize=function(){return{width:de,height:pe}},this.setSize=function(e,t,i){de=e,pe=t,H.width=e*fe,H.height=t*fe,i!==!1&&(H.style.width=e+"px",H.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){Me.viewport(ye.set(e,t,i,n))},this.setScissor=function(e,t,i,n){Me.scissor(me.set(e,t,i,n))},this.setScissorTest=function(e){Me.setScissorTest(ge=e)},this.getClearColor=function(){return ce},this.setClearColor=function(e,t){ce.set(e),he=void 0!==t?t:1,i(ce.r,ce.g,ce.b,he)},this.getClearAlpha=function(){return he},this.setClearAlpha=function(e){he=e,i(ce.r,ce.g,ce.b,he)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=Le.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=Le.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=Le.STENCIL_BUFFER_BIT),Le.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.resetGLState=r,this.dispose=function(){X=[],q=-1,W=[],j=-1,H.removeEventListener("webglcontextlost",o,!1)},this.renderBufferImmediate=function(e,t,i){Me.initAttributes();var n=Ae.get(e);e.hasPositions&&!n.position&&(n.position=Le.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=Le.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=Le.createBuffer()),e.hasColors&&!n.color&&(n.color=Le.createBuffer());var r=t.getAttributes();if(e.hasPositions&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.position),Le.bufferData(Le.ARRAY_BUFFER,e.positionArray,Le.DYNAMIC_DRAW),Me.enableAttribute(r.position),Le.vertexAttribPointer(r.position,3,Le.FLOAT,!1,0,0)),e.hasNormals){if(Le.bindBuffer(Le.ARRAY_BUFFER,n.normal),"MeshPhongMaterial"!==i.type&&"MeshStandardMaterial"!==i.type&&"MeshPhysicalMaterial"!==i.type&&i.shading===THREE.FlatShading)for(var o=0,s=3*e.count;o<s;o+=9){var a=e.normalArray,l=(a[o+0]+a[o+3]+a[o+6])/3,u=(a[o+1]+a[o+4]+a[o+7])/3,c=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=l,a[o+1]=u,a[o+2]=c,a[o+3]=l,a[o+4]=u,a[o+5]=c,a[o+6]=l,a[o+7]=u,a[o+8]=c}Le.bufferData(Le.ARRAY_BUFFER,e.normalArray,Le.DYNAMIC_DRAW),Me.enableAttribute(r.normal),Le.vertexAttribPointer(r.normal,3,Le.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.uv),Le.bufferData(Le.ARRAY_BUFFER,e.uvArray,Le.DYNAMIC_DRAW),Me.enableAttribute(r.uv),Le.vertexAttribPointer(r.uv,2,Le.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.color),Le.bufferData(Le.ARRAY_BUFFER,e.colorArray,Le.DYNAMIC_DRAW),Me.enableAttribute(r.color),Le.vertexAttribPointer(r.color,3,Le.FLOAT,!1,0,0)),Me.disableUnusedAttributes(),Le.drawArrays(Le.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,i,n,r,o,s){T(r);var a=b(e,i,r,o),l=!1,h=n.id+"_"+a.id+"_"+r.wireframe;h!==re&&(re=h,l=!0);var d=o.morphTargetInfluences;if(void 0!==d){for(var p=[],f=0,m=d.length;f<m;f++){var g=d[f];p.push([g,f])}p.sort(c),p.length>8&&(p.length=8);for(var y=n.morphAttributes,f=0,m=p.length;f<m;f++){var g=p[f];if(Z[f]=g[0],0!==g[0]){var v=g[1];r.morphTargets===!0&&y.position&&n.addAttribute("morphTarget"+f,y.position[v]),r.morphNormals===!0&&y.normal&&n.addAttribute("morphNormal"+f,y.normal[v])}else r.morphTargets===!0&&n.removeAttribute("morphTarget"+f),r.morphNormals===!0&&n.removeAttribute("morphNormal"+f)}a.getUniforms().setValue(Le,"morphTargetInfluences",Z),l=!0}var v=n.index,E=n.attributes.position;r.wireframe===!0&&(v=Pe.getWireframeAttribute(n));var C;null!==v?(C=Be,C.setIndex(v)):C=Fe,l&&(u(r,a,n),null!==v&&Le.bindBuffer(Le.ELEMENT_ARRAY_BUFFER,Pe.getAttributeBuffer(v)));var O=0,x=1/0;null!==v?x=v.count:void 0!==E&&(x=E.count);var w=n.drawRange.start,R=n.drawRange.count,L=null!==s?s.start:0,S=null!==s?s.count:1/0,_=Math.max(O,w,L),I=Math.min(O+x,w+R,L+S)-1,D=Math.max(0,I-_+1);if(o instanceof THREE.Mesh)if(r.wireframe===!0)Me.setLineWidth(r.wireframeLinewidth*t()),C.setMode(Le.LINES);else switch(o.drawMode){case THREE.TrianglesDrawMode:C.setMode(Le.TRIANGLES);break;case THREE.TriangleStripDrawMode:C.setMode(Le.TRIANGLE_STRIP);break;case THREE.TriangleFanDrawMode:C.setMode(Le.TRIANGLE_FAN)}else if(o instanceof THREE.Line){var M=r.linewidth;void 0===M&&(M=1),Me.setLineWidth(M*t()),o instanceof THREE.LineSegments?C.setMode(Le.LINES):C.setMode(Le.LINE_STRIP)}else o instanceof THREE.Points&&C.setMode(Le.POINTS);n instanceof THREE.InstancedBufferGeometry?n.maxInstancedCount>0&&C.renderInstances(n,_,D):C.render(_,D)},this.render=function(e,t,n,r){if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o=e.fog;re="",ne=-1,oe=null,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Oe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ve.setFromMatrix(Oe),$.length=0,j=-1,q=-1,Y.length=0,J.length=0,be=this.localClippingEnabled,Te=Ee.init(this.clippingPlanes,be,t),y(e,t),W.length=j+1,X.length=q+1,Q.sortObjects===!0&&(W.sort(h),X.sort(d)),Te&&Ee.beginShadows(),A($),$e.render(e,t),N($,t),Te&&Ee.endShadows(),Re.calls=0,Re.vertices=0,Re.faces=0,Re.points=0,void 0===n&&(n=null),this.setRenderTarget(n);var s=e.background;if(null===s?i(ce.r,ce.g,ce.b,he):s instanceof THREE.Color&&i(s.r,s.g,s.b,1),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s instanceof THREE.CubeTexture?(ze.projectionMatrix.copy(t.projectionMatrix),ze.matrixWorld.extractRotation(t.matrixWorld),ze.matrixWorldInverse.getInverse(ze.matrixWorld),Ge.material.uniforms.tCube.value=s,Ge.modelViewMatrix.multiplyMatrices(ze.matrixWorldInverse,Ge.matrixWorld),Q.renderBufferDirect(ze,null,Ge.geometry,Ge.material,Ge,null)):s instanceof THREE.Texture&&(Ue.material.map=s,Q.renderBufferDirect(Ke,null,Ue.geometry,Ue.material,Ue,null)),e.overrideMaterial){var a=e.overrideMaterial;v(W,t,o,a),v(X,t,o,a)}else Me.setBlending(THREE.NoBlending),v(W,t,o),v(X,t,o);We.render(e,t),je.render(e,t,le),n&&Ne.updateRenderTargetMipmap(n),Me.setDepthTest(!0),Me.setDepthWrite(!0),Me.setColorWrite(!0)},this.setFaceCulling=function(e,t){Me.setCullFace(e),Me.setFlipSided(t===THREE.FrontFaceDirectionCW)},this.allocTextureUnit=P,this.setTexture2D=function(){var e=!1;return function(t,i){t instanceof THREE.WebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Ne.setTexture2D(t,i)}}(),this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Ne.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t instanceof THREE.WebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t instanceof THREE.CubeTexture||Array.isArray(t.image)&&6===t.image.length?Ne.setTextureCube(t,i):Ne.setTextureCubeDynamic(t,i)}}(),this.getCurrentRenderTarget=function(){return te},this.setRenderTarget=function(e){te=e,e&&void 0===Ae.get(e).__webglFramebuffer&&Ne.setupRenderTarget(e);var t,i=e instanceof THREE.WebGLRenderTargetCube;if(e){var n=Ae.get(e);t=i?n.__webglFramebuffer[e.activeCubeFace]:n.__webglFramebuffer,se.copy(e.scissor),ae=e.scissorTest,le.copy(e.viewport)}else t=null,se.copy(me).multiplyScalar(fe),ae=ge,le.copy(ye).multiplyScalar(fe);if(ie!==t&&(Le.bindFramebuffer(Le.FRAMEBUFFER,t),ie=t),Me.scissor(se),Me.setScissorTest(ae),Me.viewport(le),i){var r=Ae.get(e.texture);Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e instanceof THREE.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var s=Ae.get(e).__webglFramebuffer;if(s){var a=!1;s!==ie&&(Le.bindFramebuffer(Le.FRAMEBUFFER,s),a=!0);try{var l=e.texture;if(l.format!==THREE.RGBAFormat&&k(l.format)!==Le.getParameter(Le.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l.type===THREE.UnsignedByteType||k(l.type)===Le.getParameter(Le.IMPLEMENTATION_COLOR_READ_TYPE)||l.type===THREE.FloatType&&Ie.get("WEBGL_color_buffer_float")||l.type===THREE.HalfFloatType&&Ie.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Le.checkFramebufferStatus(Le.FRAMEBUFFER)===Le.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&Le.readPixels(t,i,n,r,k(l.format),k(l.type),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&Le.bindFramebuffer(Le.FRAMEBUFFER,ie)}}}},THREE.WebGLRenderTarget=function(e,t,i){this.uuid=THREE.Math.generateUUID(),this.width=e,this.height=t,this.scissor=new THREE.Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new THREE.Vector4(0,0,e,t),i=i||{},void 0===i.minFilter&&(i.minFilter=THREE.LinearFilter),this.texture=new THREE.Texture((void 0),(void 0),i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=null},Object.assign(THREE.WebGLRenderTarget.prototype,THREE.EventDispatcher.prototype,{setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.WebGLBufferRenderer=function(e,t,i){function n(e){s=e}function r(t,n){e.drawArrays(s,t,n),i.calls++,i.vertices+=n,s===e.TRIANGLES&&(i.faces+=n/3)}function o(n){var r=t.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var o=n.attributes.position,a=0;o instanceof THREE.InterleavedBufferAttribute?(a=o.data.count,r.drawArraysInstancedANGLE(s,0,a,n.maxInstancedCount)):(a=o.count,r.drawArraysInstancedANGLE(s,0,a,n.maxInstancedCount)),i.calls++,i.vertices+=a*n.maxInstancedCount,s===e.TRIANGLES&&(i.faces+=n.maxInstancedCount*a/3)}var s;this.setMode=n,this.render=r,this.renderInstances=o},THREE.WebGLClipping=function(){function e(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),i.numPlanes=r}function t(e,t,n,r){var o=null!==e?e.length:0,s=null;if(0!==o){if(s=u.value,r!==!0||null===s){var c=n+4*o,h=t.matrixWorldInverse;l.getNormalMatrix(h),(null===s||s.length<c)&&(s=new Float32Array(c));for(var d=0,p=n;d!==o;++d,p+=4)a.copy(e[d]).applyMatrix4(h,l),a.normal.toArray(s,p),s[p+3]=a.constant}u.value=s,u.needsUpdate=!0}return i.numPlanes=o,s}var i=this,n=null,r=0,o=!1,s=!1,a=new THREE.Plane,l=new THREE.Matrix3,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.init=function(e,i,s){var a=0!==e.length||i||0!==r||o;return o=i,n=t(e,s,0),r=e.length,a},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(i,a,l,c,h){if(!o||null===i||0===i.length||s&&!a)s?t(null):e();else{var d=s?0:r,p=4*d,f=c.clippingState||null;u.value=f,f=t(i,l,p,h);for(var m=0;m!==p;++m)f[m]=n[m];c.clippingState=f,this.numPlanes+=d}}},THREE.WebGLIndexedBufferRenderer=function(e,t,i){function n(e){a=e}function r(i){i.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(l=e.UNSIGNED_INT,u=4):(l=e.UNSIGNED_SHORT,u=2)}function o(t,n){e.drawElements(a,n,l,t*u),i.calls++,i.vertices+=n,a===e.TRIANGLES&&(i.faces+=n/3)}function s(n,r,o){var s=t.get("ANGLE_instanced_arrays");return null===s?void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(s.drawElementsInstancedANGLE(a,o,l,r*u,n.maxInstancedCount),i.calls++,i.vertices+=o*n.maxInstancedCount,void(a===e.TRIANGLES&&(i.faces+=n.maxInstancedCount*o/3)))}var a,l,u;this.setMode=n,this.setIndex=r,this.render=o,this.renderInstances=s},THREE.WebGLExtensions=function(e){var t={};this.get=function(i){if(void 0!==t[i])return t[i];var n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n,n}},THREE.WebGLCapabilities=function(e,t,i){function n(){if(void 0!==o)return o;var i=t.get("EXT_texture_filter_anisotropic");return o=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o;this.getMaxAnisotropy=n,this.getMaxPrecision=r,this.precision=void 0!==i.precision?i.precision:"highp",this.logarithmicDepthBuffer=void 0!==i.logarithmicDepthBuffer&&i.logarithmicDepthBuffer,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var s=r(this.precision);s!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",s,"instead."),this.precision=s),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},THREE.WebGLGeometries=function(e,t,i){function n(e){var t=e.geometry;if(void 0!==u[t.id])return u[t.id];t.addEventListener("dispose",r);var n;return t instanceof THREE.BufferGeometry?n=t:t instanceof THREE.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new THREE.BufferGeometry).setFromObject(e)),n=t._bufferGeometry),u[t.id]=n,i.memory.geometries++,n}function r(e){var n=e.target,o=u[n.id];null!==o.index&&s(o.index),a(o.attributes),n.removeEventListener("dispose",r),delete u[n.id];var l=t.get(n);l.wireframe&&s(l.wireframe),t["delete"](n);var c=t.get(o);c.wireframe&&s(c.wireframe),t["delete"](o),i.memory.geometries--}function o(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function s(t){var i=o(t);void 0!==i&&(e.deleteBuffer(i),l(t))}function a(e){for(var t in e)s(e[t])}function l(e){e instanceof THREE.InterleavedBufferAttribute?t["delete"](e.data):t["delete"](e)}var u={};this.get=n},THREE.WebGLLights=function(){var e={};this.get=function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"SpotLight":i={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"PointLight":i={position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"HemisphereLight":i={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return e[t.id]=i,i}},THREE.WebGLObjects=function(e,t,i){function n(t){var i=c.get(t);t.geometry instanceof THREE.Geometry&&i.updateFromObject(t);
var n=i.index,o=i.attributes;null!==n&&r(n,e.ELEMENT_ARRAY_BUFFER);for(var s in o)r(o[s],e.ARRAY_BUFFER);var a=i.morphAttributes;for(var s in a)for(var l=a[s],u=0,h=l.length;u<h;u++)r(l[u],e.ARRAY_BUFFER);return i}function r(e,i){var n=e instanceof THREE.InterleavedBufferAttribute?e.data:e,r=t.get(n);void 0===r.__webglBuffer?o(r,n,i):r.version!==n.version&&s(r,n,i)}function o(t,i,n){t.__webglBuffer=e.createBuffer(),e.bindBuffer(n,t.__webglBuffer);var r=i.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(n,i.array,r),t.version=i.version}function s(t,i,n){e.bindBuffer(n,t.__webglBuffer),i.dynamic===!1||i.updateRange.count===-1?e.bufferSubData(n,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),t.version=i.version}function a(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function l(i){var n=t.get(i);if(void 0!==n.wireframe)return n.wireframe;var o=[],s=i.index,a=i.attributes,l=a.position;if(null!==s)for(var c={},h=s.array,d=0,p=h.length;d<p;d+=3){var f=h[d+0],m=h[d+1],g=h[d+2];u(c,f,m)&&o.push(f,m),u(c,m,g)&&o.push(m,g),u(c,g,f)&&o.push(g,f)}else for(var h=a.position.array,d=0,p=h.length/3-1;d<p;d+=3){var f=d+0,m=d+1,g=d+2;o.push(f,m,m,g,g,f)}var y=l.count>65535?Uint32Array:Uint16Array,v=new THREE.BufferAttribute(new y(o),1);return r(v,e.ELEMENT_ARRAY_BUFFER),n.wireframe=v,v}function u(e,t,i){if(t>i){var n=t;t=i,i=n}var r=e[t];return void 0===r?(e[t]=[i],!0):r.indexOf(i)===-1&&(r.push(i),!0)}var c=new THREE.WebGLGeometries(e,t,i);this.getAttributeBuffer=a,this.getWireframeAttribute=l,this.update=n},THREE.WebGLProgram=function(){function e(e){switch(e){case THREE.LinearEncoding:return["Linear","( value )"];case THREE.sRGBEncoding:return["sRGB","( value )"];case THREE.RGBEEncoding:return["RGBE","( value )"];case THREE.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case THREE.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case THREE.RGBDEncoding:return["RGBD","( value, 256.0 )"];case THREE.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function t(t,i){var n=e(i);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function i(t,i){var n=e(i);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function n(e,t){var i;switch(t){case THREE.LinearToneMapping:i="Linear";break;case THREE.ReinhardToneMapping:i="Reinhard";break;case THREE.Uncharted2ToneMapping:i="Uncharted2";break;case THREE.CineonToneMapping:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function r(e,t,i){e=e||{};var n=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return n.filter(a).join("\n")}function o(e){var t=[];for(var i in e){var n=e[i];n!==!1&&t.push("#define "+i+" "+n)}return t.join("\n")}function s(e,t,i){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var s=e.getActiveAttrib(t,o),a=s.name;n[a]=e.getAttribLocation(t,a)}return n}function a(e){return""!==e}function l(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function u(e){function t(e,t){var i=THREE.ShaderChunk[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return u(i)}var i=/#include +<([\w\d.]+)>/g;return e.replace(i,t)}function c(e){function t(e,t,i,n){for(var r="",o=parseInt(t);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]");return r}var i=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return e.replace(i,t)}var h=0;return function(e,d,p,f){var m=e.context,g=p.extensions,y=p.defines,v=p.__webglShader.vertexShader,E=p.__webglShader.fragmentShader,T="SHADOWMAP_TYPE_BASIC";f.shadowMapType===THREE.PCFShadowMap?T="SHADOWMAP_TYPE_PCF":f.shadowMapType===THREE.PCFSoftShadowMap&&(T="SHADOWMAP_TYPE_PCF_SOFT");var b="ENVMAP_TYPE_CUBE",C="ENVMAP_MODE_REFLECTION",O="ENVMAP_BLENDING_MULTIPLY";if(f.envMap){switch(p.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:b="ENVMAP_TYPE_CUBE";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:b="ENVMAP_TYPE_CUBE_UV";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:b="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:b="ENVMAP_TYPE_SPHERE"}switch(p.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:C="ENVMAP_MODE_REFRACTION"}switch(p.combine){case THREE.MultiplyOperation:O="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:O="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:O="ENVMAP_BLENDING_ADD"}}var x,w,R=e.gammaFactor>0?e.gammaFactor:1,L=r(g,f,e.extensions),S=o(y),_=m.createProgram();p instanceof THREE.RawShaderMaterial?(x=[S].filter(a).join("\n"),w=[S].filter(a).join("\n")):(x=["precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,S,f.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+R,"#define MAX_BONES "+f.maxBones,f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+C:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.displacementMap&&f.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?"#define FLAT_SHADED":"",f.skinning?"#define USE_SKINNING":"",f.useVertexTexture?"#define BONE_TEXTURE":"",f.morphTargets?"#define USE_MORPHTARGETS":"",f.morphNormals&&f.flatShading===!1?"#define USE_MORPHNORMALS":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+f.numClippingPlanes,f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+T:"",f.sizeAttenuation?"#define USE_SIZEATTENUATION":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(a).join("\n"),w=[L,"precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,S,f.alphaTest?"#define ALPHATEST "+f.alphaTest:"","#define GAMMA_FACTOR "+R,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+b:"",f.envMap?"#define "+C:"",f.envMap?"#define "+O:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?"#define FLAT_SHADED":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+f.numClippingPlanes,f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+T:"",f.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",f.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",f.envMap&&e.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",f.toneMapping!==THREE.NoToneMapping?"#define TONE_MAPPING":"",f.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:"",f.toneMapping!==THREE.NoToneMapping?n("toneMapping",f.toneMapping):"",f.outputEncoding||f.mapEncoding||f.envMapEncoding||f.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:"",f.mapEncoding?t("mapTexelToLinear",f.mapEncoding):"",f.envMapEncoding?t("envMapTexelToLinear",f.envMapEncoding):"",f.emissiveMapEncoding?t("emissiveMapTexelToLinear",f.emissiveMapEncoding):"",f.outputEncoding?i("linearToOutputTexel",f.outputEncoding):"",f.depthPacking?"#define DEPTH_PACKING "+p.depthPacking:"","\n"].filter(a).join("\n")),v=u(v,f),v=l(v,f),E=u(E,f),E=l(E,f),p instanceof THREE.ShaderMaterial==!1&&(v=c(v),E=c(E));var I=x+v,D=w+E,M=THREE.WebGLShader(m,m.VERTEX_SHADER,I),A=THREE.WebGLShader(m,m.FRAGMENT_SHADER,D);m.attachShader(_,M),m.attachShader(_,A),void 0!==p.index0AttributeName?m.bindAttribLocation(_,0,p.index0AttributeName):f.morphTargets===!0&&m.bindAttribLocation(_,0,"position"),m.linkProgram(_);var N=m.getProgramInfoLog(_),P=m.getShaderInfoLog(M),k=m.getShaderInfoLog(A),H=!0,F=!0;m.getProgramParameter(_,m.LINK_STATUS)===!1?(H=!1,console.error("THREE.WebGLProgram: shader error: ",m.getError(),"gl.VALIDATE_STATUS",m.getProgramParameter(_,m.VALIDATE_STATUS),"gl.getProgramInfoLog",N,P,k)):""!==N?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",N):""!==P&&""!==k||(F=!1),F&&(this.diagnostics={runnable:H,material:p,programLog:N,vertexShader:{log:P,prefix:x},fragmentShader:{log:k,prefix:w}}),m.deleteShader(M),m.deleteShader(A);var B;this.getUniforms=function(){return void 0===B&&(B=new THREE.WebGLUniforms(m,_,e)),B};var K;return this.getAttributes=function(){return void 0===K&&(K=s(m,_)),K},this.destroy=function(){m.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=h++,this.code=d,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=A,this}}(),THREE.WebGLPrograms=function(e,t){function i(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var i=t.maxVertexUniforms,n=Math.floor((i-20)/4),r=n;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(r=Math.min(e.skeleton.bones.length,r),r<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function n(e,t){var i;return e?e instanceof THREE.Texture?i=e.encoding:e instanceof THREE.WebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=THREE.LinearEncoding,i===THREE.LinearEncoding&&t&&(i=THREE.GammaEncoding),i}var r=[],o={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",NVPointCloudMaterial:"nvpointcloud"},s=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","depthPacking"];this.getParameters=function(r,s,a,l,u){var c=o[r.type],h=i(u),d=e.getPrecision();null!==r.precision&&(d=t.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead."));var p=e.getCurrentRenderTarget(),f={shaderID:c,precision:d,supportsVertexTextures:t.vertexTextures,outputEncoding:n(p?p.texture:null,e.gammaOutput),map:!!r.map,mapEncoding:n(r.map,e.gammaInput),envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,envMapEncoding:n(r.envMap,e.gammaInput),envMapCubeUV:!!r.envMap&&(r.envMap.mapping===THREE.CubeUVReflectionMapping||r.envMap.mapping===THREE.CubeUVRefractionMapping),lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:n(r.emissiveMap,e.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,combine:r.combine,vertexColors:r.vertexColors,fog:a,useFog:r.fog,fogExp:a instanceof THREE.FogExp2,flatShading:r.shading===THREE.FlatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:r.skinning,maxBones:h,useVertexTexture:t.floatVertexTextures&&u&&u.skeleton&&u.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numHemiLights:s.hemi.length,numClippingPlanes:l,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&s.shadows.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===THREE.DoubleSide,flipSided:r.side===THREE.BackSide,depthPacking:void 0!==r.depthPacking&&r.depthPacking};return f},this.getProgramCode=function(e,t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)i.push(n),i.push(e.defines[n]);for(var r=0;r<s.length;r++)i.push(t[s[r]]);return i.join()},this.acquireProgram=function(t,i,n){for(var o,s=0,a=r.length;s<a;s++){var l=r[s];if(l.code===n){o=l,++o.usedTimes;break}}return void 0===o&&(o=new THREE.WebGLProgram(e,n,t,i),r.push(o)),o},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r},THREE.WebGLProperties=function(){var e={};this.get=function(t){var i=t.uuid,n=e[i];return void 0===n&&(n={},e[i]=n),n},this["delete"]=function(t){delete e[t.uuid]},this.clear=function(){e={}}},THREE.WebGLShader=function(){function e(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}return function(t,i,n){var r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",i===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(r),e(n)),r}}(),THREE.WebGLShadowMap=function(e,t,i){function n(t,i,n,r){var o=t.geometry,s=null,a=y,l=t.customDepthMaterial;if(n&&(a=v,l=t.customDistanceMaterial),l)s=l;else{var u=void 0!==o.morphTargets&&o.morphTargets.length>0&&i.morphTargets,c=t instanceof THREE.SkinnedMesh&&i.skinning,h=0;u&&(h|=f),c&&(h|=m),s=a[h]}if(e.localClippingEnabled&&i.clipShadows===!0&&0!==i.clippingPlanes.length){var d=s.uuid,p=i.uuid,g=E[d];void 0===g&&(g={},E[d]=g);var T=g[p];void 0===T&&(T=s.clone(),g[p]=T),s=T}s.visible=i.visible,s.wireframe=i.wireframe;var b=i.side;return D.renderSingleSided&&b==THREE.DoubleSide&&(b=THREE.FrontSide),D.renderReverseSided&&(b===THREE.FrontSide?b=THREE.BackSide:b===THREE.BackSide&&(b=THREE.FrontSide)),s.side=b,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,n&&void 0!==s.uniforms.lightPos&&s.uniforms.lightPos.value.copy(r),s}function r(e,t,i){if(e.visible!==!1){if(e.layers.test(t.layers)&&(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&e.castShadow&&(e.frustumCulled===!1||a.intersectsObject(e)===!0)){var n=e.material;n.visible===!0&&(e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),p.push(e))}for(var o=e.children,s=0,l=o.length;s<l;s++)r(o[s],t,i)}}var o=e.context,s=e.state,a=new THREE.Frustum,l=new THREE.Matrix4,u=t.shadows,c=new THREE.Vector2,h=new THREE.Vector3,d=new THREE.Vector3,p=[],f=1,m=2,g=(f|m)+1,y=new Array(g),v=new Array(g),E={},T=[new THREE.Vector3(1,0,0),new THREE.Vector3((-1),0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,(-1)),new THREE.Vector3(0,1,0),new THREE.Vector3(0,(-1),0)],b=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,(-1))],C=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],O=new THREE.MeshDepthMaterial;O.depthPacking=THREE.RGBADepthPacking,O.clipping=!0;for(var x=THREE.ShaderLib.distanceRGBA,w=THREE.UniformsUtils.clone(x.uniforms),R=0;R!==g;++R){var L=0!==(R&f),S=0!==(R&m),_=O.clone();_.morphTargets=L,_.skinning=S,y[R]=_;var I=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:w,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,morphTargets:L,skinning:S,clipping:!0});v[R]=I}var D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=THREE.PCFShadowMap,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,f){if(D.enabled!==!1&&(D.autoUpdate!==!1||D.needsUpdate!==!1)&&0!==u.length){s.clearColor(1,1,1,1),s.disable(o.BLEND),s.setDepthTest(!0),s.setScissorTest(!1);for(var m,g,y=0,v=u.length;y<v;y++){var E=u[y],O=E.shadow;if(void 0!==O){var x=O.camera;if(c.copy(O.mapSize),E instanceof THREE.PointLight){m=6,g=!0;var w=c.x,R=c.y;C[0].set(2*w,R,w,R),C[1].set(0,R,w,R),C[2].set(3*w,R,w,R),C[3].set(w,R,w,R),C[4].set(3*w,0,w,R),C[5].set(w,0,w,R),c.x*=4,c.y*=2}else m=1,g=!1;if(null===O.map){var L={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};O.map=new THREE.WebGLRenderTarget(c.x,c.y,L),x.updateProjectionMatrix()}O instanceof THREE.SpotLightShadow&&O.update(E);var S=O.map,_=O.matrix;d.setFromMatrixPosition(E.matrixWorld),x.position.copy(d),e.setRenderTarget(S),e.clear();for(var I=0;I<m;I++){if(g){h.copy(x.position),h.add(T[I]),x.up.copy(b[I]),x.lookAt(h);var M=C[I];s.viewport(M)}else h.setFromMatrixPosition(E.target.matrixWorld),x.lookAt(h);x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),l.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),a.setFromMatrix(l),p.length=0,r(t,f,x);for(var A=0,N=p.length;A<N;A++){var P=p[A],k=i.update(P),H=P.material;if(H instanceof THREE.MultiMaterial)for(var F=k.groups,B=H.materials,K=0,z=F.length;K<z;K++){var U=F[K],V=B[U.materialIndex];if(V.visible===!0){var G=n(P,V,g,d);e.renderBufferDirect(x,null,k,G,P,U)}}else{var G=n(P,H,g,d);e.renderBufferDirect(x,null,k,G,P,null)}}}}else console.warn("THREE.WebGLShadowMap:",E,"has no shadow.")}var $=e.getClearColor(),W=e.getClearAlpha();e.setClearColor($,W),D.needsUpdate=!1}}},THREE.WebGLState=function(e,t,i){function n(t,i,n){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<n;s++)e.texImage2D(i+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return o}var r=this;this.buffers={color:new THREE.WebGLColorBuffer(e,this),depth:new THREE.WebGLDepthBuffer(e,this),stencil:new THREE.WebGLStencilBuffer(e,this)};var o=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=new Uint8Array(o),a=new Uint8Array(o),l=new Uint8Array(o),u={},c=null,h=null,d=null,p=null,f=null,m=null,g=null,y=null,v=!1,E=null,T=null,b=null,C=null,O=null,x=null,w=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),R=null,L={},S=new THREE.Vector4,_=new THREE.Vector4,I={};I[e.TEXTURE_2D]=n(e.TEXTURE_2D,e.TEXTURE_2D,1),I[e.TEXTURE_CUBE_MAP]=n(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(e.DEPTH_TEST),this.setDepthFunc(THREE.LessEqualDepth),this.setFlipSided(!1),this.setCullFace(THREE.CullFaceBack),this.enable(e.CULL_FACE),this.enable(e.BLEND),this.setBlending(THREE.NormalBlending)},this.initAttributes=function(){for(var e=0,t=s.length;e<t;e++)s[e]=0},this.enableAttribute=function(i){if(s[i]=1,0===a[i]&&(e.enableVertexAttribArray(i),a[i]=1),0!==l[i]){var n=t.get("ANGLE_instanced_arrays");n.vertexAttribDivisorANGLE(i,0),l[i]=0}},this.enableAttributeAndDivisor=function(t,i,n){s[t]=1,0===a[t]&&(e.enableVertexAttribArray(t),a[t]=1),l[t]!==i&&(n.vertexAttribDivisorANGLE(t,i),l[t]=i)},this.disableUnusedAttributes=function(){for(var t=0,i=a.length;t!==i;++t)a[t]!==s[t]&&(e.disableVertexAttribArray(t),a[t]=0)},this.enable=function(t){u[t]!==!0&&(e.enable(t),u[t]=!0)},this.disable=function(t){u[t]!==!1&&(e.disable(t),u[t]=!1)},this.getCompressedTextureFormats=function(){if(null===c&&(c=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)c.push(i[n]);return c},this.setBlending=function(t,n,r,o,s,a,l,u){return t===THREE.NoBlending?(this.disable(e.BLEND),void(h=t)):(this.enable(e.BLEND),t===h&&u===v||(t===THREE.AdditiveBlending?u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===THREE.SubtractiveBlending?u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),h=t,v=u),void(t===THREE.CustomBlending?(s=s||n,a=a||r,l=l||o,n===d&&s===m||(e.blendEquationSeparate(i(n),i(s)),d=n,m=s),r===p&&o===f&&a===g&&l===y||(e.blendFuncSeparate(i(r),i(o),i(a),i(l)),p=r,f=o,g=a,y=l)):(d=null,p=null,f=null,m=null,g=null,y=null)))},this.setColorWrite=function(e){this.buffers.color.setMask(e)},this.setDepthTest=function(e){this.buffers.depth.setTest(e)},this.setDepthWrite=function(e){this.buffers.depth.setMask(e)},this.setDepthFunc=function(e){this.buffers.depth.setFunc(e)},this.setStencilTest=function(e){this.buffers.stencil.setTest(e)},this.setStencilWrite=function(e){this.buffers.stencil.setMask(e)},this.setStencilFunc=function(e,t,i){this.buffers.stencil.setFunc(e,t,i)},this.setStencilOp=function(e,t,i){this.buffers.stencil.setOp(e,t,i)},this.setFlipSided=function(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)},this.setCullFace=function(t){t!==THREE.CullFaceNone?(this.enable(e.CULL_FACE),t!==T&&(t===THREE.CullFaceBack?e.cullFace(e.BACK):t===THREE.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),T=t},this.setLineWidth=function(t){t!==b&&(e.lineWidth(t),b=t)},this.setPolygonOffset=function(t,i,n){t?(this.enable(e.POLYGON_OFFSET_FILL),C===i&&O===n||(e.polygonOffset(i,n),C=i,O=n)):this.disable(e.POLYGON_OFFSET_FILL)},this.getScissorTest=function(){return x},this.setScissorTest=function(t){x=t,t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+w-1),R!==t&&(e.activeTexture(t),R=t)},this.bindTexture=function(t,i){null===R&&r.activeTexture();var n=L[R];void 0===n&&(n={type:void 0,texture:void 0},L[R]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||I[t]),n.type=t,n.texture=i)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.clearColor=function(e,t,i,n){this.buffers.color.setClear(e,t,i,n)},this.clearDepth=function(e){this.buffers.depth.setClear(e)},this.clearStencil=function(e){this.buffers.stencil.setClear(e)},this.scissor=function(t){S.equals(t)===!1&&(e.scissor(t.x,t.y,t.z,t.w),S.copy(t))},this.viewport=function(t){_.equals(t)===!1&&(e.viewport(t.x,t.y,t.z,t.w),_.copy(t))},this.reset=function(){for(var t=0;t<a.length;t++)1===a[t]&&(e.disableVertexAttribArray(t),a[t]=0);u={},c=null,R=null,L={},h=null,E=null,T=null,this.buffers.color.reset(),this.buffers.depth.reset(),this.buffers.stencil.reset()}},THREE.WebGLColorBuffer=function(e,t){var i=!1,n=new THREE.Vector4,r=null,o=new THREE.Vector4;this.setMask=function(t){r===t||i||(e.colorMask(t,t,t,t),r=t)},this.setLocked=function(e){i=e},this.setClear=function(t,i,r,s){n.set(t,i,r,s),o.equals(n)===!1&&(e.clearColor(t,i,r,s),o.copy(n))},this.reset=function(){i=!1,r=null,o=new THREE.Vector4}},THREE.WebGLDepthBuffer=function(e,t){var i=!1,n=null,r=null,o=null;this.setTest=function(i){i?t.enable(e.DEPTH_TEST):t.disable(e.DEPTH_TEST)},this.setMask=function(t){n===t||i||(e.depthMask(t),n=t)},this.setFunc=function(t){if(r!==t){if(t)switch(t){case THREE.NeverDepth:e.depthFunc(e.NEVER);break;case THREE.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case THREE.LessDepth:e.depthFunc(e.LESS);break;case THREE.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case THREE.EqualDepth:e.depthFunc(e.EQUAL);break;case THREE.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case THREE.GreaterDepth:e.depthFunc(e.GREATER);break;case THREE.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},this.setLocked=function(e){i=e},this.setClear=function(t){o!==t&&(e.clearDepth(t),o=t)},this.reset=function(){i=!1,n=null,r=null,o=null}},THREE.WebGLStencilBuffer=function(e,t){var i=!1,n=null,r=null,o=null,s=null,a=null,l=null,u=null,c=null;this.setTest=function(i){i?t.enable(e.STENCIL_TEST):t.disable(e.STENCIL_TEST)},this.setMask=function(t){n===t||i||(e.stencilMask(t),n=t)},this.setFunc=function(t,i,n){r===t&&o===i&&s===n||(e.stencilFunc(t,i,n),r=t,o=i,s=n)},this.setOp=function(t,i,n){a===t&&l===i&&u===n||(e.stencilOp(t,i,n),a=t,l=i,u=n)},this.setLocked=function(e){i=e},this.setClear=function(t){c!==t&&(e.clearStencil(t),c=t)},this.reset=function(){i=!1,n=null,r=null,o=null,s=null,a=null,l=null,u=null,c=null}},THREE.WebGLTextures=function(e,t,i,n,r,o,s){function a(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i);var r=n.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function l(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}function u(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=THREE.Math.nearestPowerOfTwo(e.width),t.height=THREE.Math.nearestPowerOfTwo(e.height);var i=t.getContext("2d");return i.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function c(e){return e.wrapS!==THREE.ClampToEdgeWrapping||e.wrapT!==THREE.ClampToEdgeWrapping||e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter}function h(t){return t===THREE.NearestFilter||t===THREE.NearestMipMapNearestFilter||t===THREE.NearestMipMapLinearFilter?e.NEAREST:e.LINEAR}function d(e){var t=e.target;t.removeEventListener("dispose",d),f(t),L.textures--}function p(e){var t=e.target;t.removeEventListener("dispose",p),m(t),L.textures--}function f(t){var i=n.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}n["delete"](t)}function m(t){var i=n.get(t),r=n.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t instanceof THREE.WebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);n["delete"](t.texture),n["delete"](t)}}function g(t,r){var o=n.get(t);if(t.version>0&&o.__version!==t.version){var s=t.image;if(void 0===s)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(s.complete!==!1)return void T(o,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}i.activeTexture(e.TEXTURE0+r),i.bindTexture(e.TEXTURE_2D,o.__webglTexture)}function y(t,s){var u=n.get(t);if(6===t.image.length)if(t.version>0&&u.__version!==t.version){u.__image__webglTextureCube||(t.addEventListener("dispose",d),u.__image__webglTextureCube=e.createTexture(),L.textures++),i.activeTexture(e.TEXTURE0+s),i.bindTexture(e.TEXTURE_CUBE_MAP,u.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t instanceof THREE.CompressedTexture,h=t.image[0]instanceof THREE.DataTexture,p=[],f=0;f<6;f++)c||h?p[f]=h?t.image[f].image:t.image[f]:p[f]=a(t.image[f],r.maxCubemapSize);var m=p[0],g=l(m),y=o(t.format),v=o(t.type);E(e.TEXTURE_CUBE_MAP,t,g);for(var f=0;f<6;f++)if(c)for(var T,b=p[f].mipmaps,C=0,O=b.length;C<O;C++)T=b[C],t.format!==THREE.RGBAFormat&&t.format!==THREE.RGBFormat?i.getCompressedTextureFormats().indexOf(y)>-1?i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,C,y,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,C,y,T.width,T.height,0,y,v,T.data);else h?i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,y,p[f].width,p[f].height,0,y,v,p[f].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,y,y,v,p[f]);
t.generateMipmaps&&g&&e.generateMipmap(e.TEXTURE_CUBE_MAP),u.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(e.TEXTURE0+s),i.bindTexture(e.TEXTURE_CUBE_MAP,u.__image__webglTextureCube)}function v(t,r){i.activeTexture(e.TEXTURE0+r),i.bindTexture(e.TEXTURE_CUBE_MAP,n.get(t).__webglTexture)}function E(i,s,a){var l;if(a?(e.texParameteri(i,e.TEXTURE_WRAP_S,o(s.wrapS)),e.texParameteri(i,e.TEXTURE_WRAP_T,o(s.wrapT)),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o(s.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,o(s.minFilter))):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s.wrapS===THREE.ClampToEdgeWrapping&&s.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(i,e.TEXTURE_MAG_FILTER,h(s.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,h(s.minFilter)),s.minFilter!==THREE.NearestFilter&&s.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=t.get("EXT_texture_filter_anisotropic")){if(s.type===THREE.FloatType&&null===t.get("OES_texture_float_linear"))return;if(s.type===THREE.HalfFloatType&&null===t.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function T(t,n,s){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",d),t.__webglTexture=e.createTexture(),L.textures++),i.activeTexture(e.TEXTURE0+s),i.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var h=a(n.image,r.maxTextureSize);c(n)&&l(h)===!1&&(h=u(h));var p=l(h),f=o(n.format),m=o(n.type);E(e.TEXTURE_2D,n,p);var g,y=n.mipmaps;if(n instanceof THREE.DepthTexture){var v=e.DEPTH_COMPONENT;if(n.type===THREE.FloatType){if(!S)throw new Error("Float Depth Texture only supported in WebGL2.0");v=e.DEPTH_COMPONENT32F}else S&&(v=e.DEPTH_COMPONENT16);i.texImage2D(e.TEXTURE_2D,0,v,h.width,h.height,0,f,m,null)}else if(n instanceof THREE.DataTexture)if(y.length>0&&p){for(var T=0,b=y.length;T<b;T++)g=y[T],i.texImage2D(e.TEXTURE_2D,T,f,g.width,g.height,0,f,m,g.data);n.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,f,h.width,h.height,0,f,m,h.data);else if(n instanceof THREE.CompressedTexture)for(var T=0,b=y.length;T<b;T++)g=y[T],n.format!==THREE.RGBAFormat&&n.format!==THREE.RGBFormat?i.getCompressedTextureFormats().indexOf(f)>-1?i.compressedTexImage2D(e.TEXTURE_2D,T,f,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(e.TEXTURE_2D,T,f,g.width,g.height,0,f,m,g.data);else if(y.length>0&&p){for(var T=0,b=y.length;T<b;T++)g=y[T],i.texImage2D(e.TEXTURE_2D,T,f,f,m,g);n.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,f,f,m,h);n.generateMipmaps&&p&&e.generateMipmap(e.TEXTURE_2D),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function b(t,r,s,a){var l=o(r.texture.format),u=o(r.texture.type);i.texImage2D(a,0,l,r.width,r.height,0,l,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,s,a,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function C(t,i){e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,i.width,i.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t,i){var r=i instanceof THREE.WebGLRenderTargetCube;if(r)throw new Error("Depth Texture with cube render targets is not supported!");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!(i.depthTexture instanceof THREE.DepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),g(i.depthTexture,0);var o=n.get(i.depthTexture).__webglTexture;e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0)}function x(t){var i=n.get(t),r=t instanceof THREE.WebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");O(i.__webglFramebuffer,t)}else if(r){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),C(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),C(i.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function w(t){var r=n.get(t),o=n.get(t.texture);t.addEventListener("dispose",p),o.__webglTexture=e.createTexture(),L.textures++;var s=t instanceof THREE.WebGLRenderTargetCube,a=l(t);if(s){r.__webglFramebuffer=[];for(var u=0;u<6;u++)r.__webglFramebuffer[u]=e.createFramebuffer()}else r.__webglFramebuffer=e.createFramebuffer();if(s){i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),E(e.TEXTURE_CUBE_MAP,t.texture,a);for(var u=0;u<6;u++)b(r.__webglFramebuffer[u],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+u);t.texture.generateMipmaps&&a&&e.generateMipmap(e.TEXTURE_CUBE_MAP),i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else i.bindTexture(e.TEXTURE_2D,o.__webglTexture),E(e.TEXTURE_2D,t.texture,a),b(r.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),t.texture.generateMipmaps&&a&&e.generateMipmap(e.TEXTURE_2D),i.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&x(t)}function R(t){var r=t.texture;if(r.generateMipmaps&&l(t)&&r.minFilter!==THREE.NearestFilter&&r.minFilter!==THREE.LinearFilter){var o=t instanceof THREE.WebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=n.get(r).__webglTexture;i.bindTexture(o,s),e.generateMipmap(o),i.bindTexture(o,null)}}var L=s.memory,S="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;this.setTexture2D=g,this.setTextureCube=y,this.setTextureCubeDynamic=v,this.setupRenderTarget=w,this.updateRenderTargetMipmap=R},THREE.WebGLUniforms=function(){var e=new THREE.Texture,t=new THREE.CubeTexture,i=function(){this.seq=[],this.map={}},n=[],r=[],o=function(e,t,i){var r=e[0];if(r<=0||r>0)return e;var o=t*i,s=n[o];if(void 0===s&&(s=new Float32Array(o),n[o]=s),0!==t){r.toArray(s,0);for(var a=1,l=0;a!==t;++a)l+=i,e[a].toArray(s,l)}return s},s=function(e,t){var i=r[t];void 0===i&&(i=new Int32Array(t),r[t]=i);for(var n=0;n!==t;++n)i[n]=e.allocTextureUnit();return i},a=function(e,t){e.uniform1f(this.addr,t)},l=function(e,t){e.uniform1i(this.addr,t)},u=function(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)},c=function(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)},h=function(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)},d=function(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)},p=function(e,t){e.uniformMatrix3fv(this.addr,!1,t.elements||t)},f=function(e,t){e.uniformMatrix4fv(this.addr,!1,t.elements||t)},m=function(t,i,n){var r=n.allocTextureUnit();t.uniform1i(this.addr,r),n.setTexture2D(i||e,r)},g=function(e,i,n){var r=n.allocTextureUnit();e.uniform1i(this.addr,r),n.setTextureCube(i||t,r)},y=function(e,t){e.uniform2iv(this.addr,t)},v=function(e,t){e.uniform3iv(this.addr,t)},E=function(e,t){e.uniform4iv(this.addr,t)},T=function(e){switch(e){case 5126:return a;case 35664:return u;case 35665:return c;case 35666:return h;case 35674:return d;case 35675:return p;case 35676:return f;case 35678:return m;case 35680:return g;case 5124:case 35670:return l;case 35667:case 35671:return y;case 35668:case 35672:return v;case 35669:case 35673:return E}},b=function(e,t){e.uniform1fv(this.addr,t)},C=function(e,t){e.uniform1iv(this.addr,t)},O=function(e,t){e.uniform2fv(this.addr,o(t,this.size,2))},x=function(e,t){e.uniform3fv(this.addr,o(t,this.size,3))},w=function(e,t){e.uniform4fv(this.addr,o(t,this.size,4))},R=function(e,t){e.uniformMatrix2fv(this.addr,!1,o(t,this.size,4))},L=function(e,t){e.uniformMatrix3fv(this.addr,!1,o(t,this.size,9))},S=function(e,t){e.uniformMatrix4fv(this.addr,!1,o(t,this.size,16))},_=function(t,i,n){var r=i.length,o=s(n,r);t.uniform1iv(this.addr,o);for(var a=0;a!==r;++a)n.setTexture2D(i[a]||e,o[a])},I=function(e,i,n){var r=i.length,o=s(n,r);e.uniform1iv(this.addr,o);for(var a=0;a!==r;++a)n.setTextureCube(i[a]||t,o[a])},D=function(e){switch(e){case 5126:return b;case 35664:return O;case 35665:return x;case 35666:return w;case 35674:return R;case 35675:return L;case 35676:return S;case 35678:return _;case 35680:return I;case 5124:case 35670:return C;case 35667:case 35671:return y;case 35668:case 35672:return v;case 35669:case 35673:return E}},M=function(e,t,i){this.id=e,this.addr=i,this.setValue=T(t.type)},A=function(e,t,i){this.id=e,this.addr=i,this.size=t.size,this.setValue=D(t.type)},N=function(e){this.id=e,i.call(this)};N.prototype.setValue=function(e,t){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var o=i[n];o.setValue(e,t[o.id])}};var P=/([\w\d_]+)(\])?(\[|\.)?/g,k=function(e,t){e.seq.push(t),e.map[t.id]=t},H=function(e,t,i){var n=e.name,r=n.length;for(P.lastIndex=0;;){var o=P.exec(n),s=P.lastIndex,a=o[1],l="]"===o[2],u=o[3];if(l&&(a=0|a),void 0===u||"["===u&&s+2===r){k(i,void 0===u?new M(a,e,t):new A(a,e,t));break}var c=i.map,h=c[a];void 0===h&&(h=new N(a),k(i,h)),i=h}},F=function(e,t,n){i.call(this),this.renderer=n;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o!==r;++o){var s=e.getActiveUniform(t,o),a=s.name,l=e.getUniformLocation(t,a);H(s,l,this)}};return F.prototype.setValue=function(e,t,i){var n=this.map[t];void 0!==n&&n.setValue(e,i,this.renderer)},F.prototype.set=function(e,t,i){var n=this.map[i];void 0!==n&&n.setValue(e,t[i],this.renderer)},F.prototype.setOptional=function(e,t,i){var n=t[i];void 0!==n&&this.setValue(e,i,n)},F.upload=function(e,t,i,n){for(var r=0,o=t.length;r!==o;++r){var s=t[r],a=i[s.id];a.needsUpdate!==!1&&s.setValue(e,a.value,n)}},F.seqWithValue=function(e,t){for(var i=[],n=0,r=e.length;n!==r;++n){var o=e[n];o.id in t&&i.push(o)}return i},F.splitDynamic=function(e,t){for(var i=null,n=e.length,r=0,o=0;o!==n;++o){var s=e[o],a=t[s.id];a&&a.dynamic===!0?(null===i&&(i=[]),i.push(s)):(r<o&&(e[r]=s),++r)}return r<n&&(e.length=r),i},F.evalDynamic=function(e,t,i,n){for(var r=0,o=e.length;r!==o;++r){var s=t[e[r].id],a=s.onUpdateCallback;void 0!==a&&a.call(s,i,n)}},F}(),THREE.LensFlarePlugin=function(e,t){function i(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);r=d.createBuffer(),o=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,r),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),c=d.createTexture(),h=d.createTexture(),p.bindTexture(d.TEXTURE_2D,c),d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),p.bindTexture(d.TEXTURE_2D,h),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),s={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=n(s),l={vertex:d.getAttribLocation(a,"position"),uv:d.getAttribLocation(a,"uv")},u={renderType:d.getUniformLocation(a,"renderType"),map:d.getUniformLocation(a,"map"),occlusionMap:d.getUniformLocation(a,"occlusionMap"),opacity:d.getUniformLocation(a,"opacity"),color:d.getUniformLocation(a,"color"),scale:d.getUniformLocation(a,"scale"),rotation:d.getUniformLocation(a,"rotation"),screenPosition:d.getUniformLocation(a,"screenPosition")}}function n(t){var i=d.createProgram(),n=d.createShader(d.FRAGMENT_SHADER),r=d.createShader(d.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return d.shaderSource(n,o+t.fragmentShader),d.shaderSource(r,o+t.vertexShader),d.compileShader(n),d.compileShader(r),d.attachShader(i,n),d.attachShader(i,r),d.linkProgram(i),i}var r,o,s,a,l,u,c,h,d=e.context,p=e.state;this.render=function(n,s,f){if(0!==t.length){var m=new THREE.Vector3,g=f.w/f.z,y=.5*f.z,v=.5*f.w,E=16/f.w,T=new THREE.Vector2(E*g,E),b=new THREE.Vector3(1,1,0),C=new THREE.Vector2(1,1),O=new THREE.Box2;O.min.set(0,0),O.max.set(f.z-16,f.w-16),void 0===a&&i(),d.useProgram(a),p.initAttributes(),p.enableAttribute(l.vertex),p.enableAttribute(l.uv),p.disableUnusedAttributes(),d.uniform1i(u.occlusionMap,0),d.uniform1i(u.map,1),d.bindBuffer(d.ARRAY_BUFFER,r),d.vertexAttribPointer(l.vertex,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(l.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),p.disable(d.CULL_FACE),p.setDepthWrite(!1);for(var x=0,w=t.length;x<w;x++){E=16/f.w,T.set(E*g,E);var R=t[x];if(m.set(R.matrixWorld.elements[12],R.matrixWorld.elements[13],R.matrixWorld.elements[14]),m.applyMatrix4(s.matrixWorldInverse),m.applyProjection(s.projectionMatrix),b.copy(m),C.x=f.x+b.x*y+y-8,C.y=f.y+b.y*v+v-8,O.containsPoint(C)===!0){p.activeTexture(d.TEXTURE0),p.bindTexture(d.TEXTURE_2D,null),p.activeTexture(d.TEXTURE1),p.bindTexture(d.TEXTURE_2D,c),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,C.x,C.y,16,16,0),d.uniform1i(u.renderType,0),d.uniform2f(u.scale,T.x,T.y),d.uniform3f(u.screenPosition,b.x,b.y,b.z),p.disable(d.BLEND),p.enable(d.DEPTH_TEST),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),p.activeTexture(d.TEXTURE0),p.bindTexture(d.TEXTURE_2D,h),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,C.x,C.y,16,16,0),d.uniform1i(u.renderType,1),p.disable(d.DEPTH_TEST),p.activeTexture(d.TEXTURE1),p.bindTexture(d.TEXTURE_2D,c),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),R.positionScreen.copy(b),R.customUpdateCallback?R.customUpdateCallback(R):R.updateLensFlares(),d.uniform1i(u.renderType,2),p.enable(d.BLEND);for(var L=0,S=R.lensFlares.length;L<S;L++){var _=R.lensFlares[L];_.opacity>.001&&_.scale>.001&&(b.x=_.x,b.y=_.y,b.z=_.z,E=_.size*_.scale/f.w,T.x=E*g,T.y=E,d.uniform3f(u.screenPosition,b.x,b.y,b.z),d.uniform2f(u.scale,T.x,T.y),d.uniform1f(u.rotation,_.rotation),d.uniform1f(u.opacity,_.opacity),d.uniform3f(u.color,_.color.r,_.color.g,_.color.b),p.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),e.setTexture2D(_.texture,1),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0))}}}p.enable(d.CULL_FACE),p.enable(d.DEPTH_TEST),p.setDepthWrite(!0),e.resetGLState()}}},THREE.SpritePlugin=function(e,t){function i(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);o=h.createBuffer(),s=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,o),h.bufferData(h.ARRAY_BUFFER,e,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),h.bufferData(h.ELEMENT_ARRAY_BUFFER,t,h.STATIC_DRAW),a=n(),l={position:h.getAttribLocation(a,"position"),uv:h.getAttribLocation(a,"uv")},u={uvOffset:h.getUniformLocation(a,"uvOffset"),uvScale:h.getUniformLocation(a,"uvScale"),rotation:h.getUniformLocation(a,"rotation"),scale:h.getUniformLocation(a,"scale"),color:h.getUniformLocation(a,"color"),map:h.getUniformLocation(a,"map"),opacity:h.getUniformLocation(a,"opacity"),modelViewMatrix:h.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:h.getUniformLocation(a,"projectionMatrix"),fogType:h.getUniformLocation(a,"fogType"),fogDensity:h.getUniformLocation(a,"fogDensity"),fogNear:h.getUniformLocation(a,"fogNear"),fogFar:h.getUniformLocation(a,"fogFar"),fogColor:h.getUniformLocation(a,"fogColor"),alphaTest:h.getUniformLocation(a,"alphaTest")};var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=8,i.height=8;var r=i.getContext("2d");r.fillStyle="white",r.fillRect(0,0,8,8),c=new THREE.Texture(i),c.needsUpdate=!0}function n(){var t=h.createProgram(),i=h.createShader(h.VERTEX_SHADER),n=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),h.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),h.compileShader(i),h.compileShader(n),h.attachShader(t,i),h.attachShader(t,n),h.linkProgram(t),t}function r(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var o,s,a,l,u,c,h=e.context,d=e.state,p=new THREE.Vector3,f=new THREE.Quaternion,m=new THREE.Vector3;this.render=function(n,g){if(0!==t.length){void 0===a&&i(),h.useProgram(a),d.initAttributes(),d.enableAttribute(l.position),d.enableAttribute(l.uv),d.disableUnusedAttributes(),d.disable(h.CULL_FACE),d.enable(h.BLEND),h.bindBuffer(h.ARRAY_BUFFER,o),h.vertexAttribPointer(l.position,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(l.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),h.uniformMatrix4fv(u.projectionMatrix,!1,g.projectionMatrix.elements),d.activeTexture(h.TEXTURE0),h.uniform1i(u.map,0);var y=0,v=0,E=n.fog;E?(h.uniform3f(u.fogColor,E.color.r,E.color.g,E.color.b),E instanceof THREE.Fog?(h.uniform1f(u.fogNear,E.near),h.uniform1f(u.fogFar,E.far),h.uniform1i(u.fogType,1),y=1,v=1):E instanceof THREE.FogExp2&&(h.uniform1f(u.fogDensity,E.density),h.uniform1i(u.fogType,2),y=2,v=2)):(h.uniform1i(u.fogType,0),y=0,v=0);for(var T=0,b=t.length;T<b;T++){var C=t[T];C.modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,C.matrixWorld),C.z=-C.modelViewMatrix.elements[14]}t.sort(r);for(var O=[],T=0,b=t.length;T<b;T++){var C=t[T],x=C.material;h.uniform1f(u.alphaTest,x.alphaTest),h.uniformMatrix4fv(u.modelViewMatrix,!1,C.modelViewMatrix.elements),C.matrixWorld.decompose(p,f,m),O[0]=m.x,O[1]=m.y;var w=0;n.fog&&x.fog&&(w=v),y!==w&&(h.uniform1i(u.fogType,w),y=w),null!==x.map?(h.uniform2f(u.uvOffset,x.map.offset.x,x.map.offset.y),h.uniform2f(u.uvScale,x.map.repeat.x,x.map.repeat.y)):(h.uniform2f(u.uvOffset,0,0),h.uniform2f(u.uvScale,1,1)),h.uniform1f(u.opacity,x.opacity),h.uniform3f(u.color,x.color.r,x.color.g,x.color.b),h.uniform1f(u.rotation,x.rotation),h.uniform2fv(u.scale,O),d.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),d.setDepthTest(x.depthTest),d.setDepthWrite(x.depthWrite),x.map?e.setTexture2D(x.map,0):e.setTexture2D(c,0),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)}d.enable(h.CULL_FACE),e.resetGLState()}}},Object.assign(THREE,{Face4:function(e,t,i,n,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,i,r,o,s)},LineStrip:0,LinePieces:1,MeshFaceMaterial:THREE.MultiMaterial,PointCloud:function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new THREE.Points(e,t)},Particle:THREE.Sprite,ParticleSystem:function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new THREE.Points(e,t)},PointCloudMaterial:function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},ParticleBasicMaterial:function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},ParticleSystemMaterial:function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},Vertex:function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new THREE.Vector3(e,t,i)}}),Object.assign(THREE.Box2.prototype,{empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}),Object.assign(THREE.Box3.prototype,{empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(THREE.Matrix3.prototype,{multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)}}),Object.assign(THREE.Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}),Object.assign(THREE.Plane.prototype,{isIntersectionLine:function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)}}),Object.assign(THREE.Quaternion.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)}}),Object.assign(THREE.Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(THREE.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)}}),Object.assign(THREE.Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(THREE.LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),THREE.PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(e){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length}}}),Object.assign(THREE.BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),
this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new THREE.Color}}}),Object.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(e){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),THREE.EventDispatcher.prototype=Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(e){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in."),Object.assign(e,this)}}),THREE.EventDispatcher.prototype),Object.assign(THREE.WebGLRenderer.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(THREE.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?THREE.CullFaceFront:THREE.CullFaceBack},set:function(e){var t=e!==THREE.CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.assign(THREE.Audio.prototype,{load:function(e){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var t=this,i=new THREE.AudioLoader;return i.load(e,function(e){t.setBuffer(e)}),this}}),Object.assign(THREE.AudioAnalyser.prototype,{getData:function(e){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()}}),THREE.GeometryUtils={merge:function(e,t,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new THREE.TextureLoader;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new THREE.CubeTextureLoader;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},THREE.BinaryLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.BinaryLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BinaryLoader.prototype={constructor:THREE.BinaryLoader,load:function(e,t,i,n){var r=this.texturePath||THREE.Loader.prototype.extractUrlBase(e),o=this.binaryPath||THREE.Loader.prototype.extractUrlBase(e),s=this,a=new THREE.XHRLoader(this.manager);a.load(e,function(e){var a=JSON.parse(e),l=o+a.buffers,u=new THREE.XHRLoader(s.manager);u.setResponseType("arraybuffer"),u.load(l,function(e){s.parse(e,t,r,a.materials)},i,n)},i,n)},setBinaryPath:function(e){this.binaryPath=e},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t,i,n){var r=function(t){function i(e){return e%4?4-e%4:0}function n(e,t){var i={signature:r(e,t,12),header_bytes:o(e,t+12),vertex_coordinate_bytes:o(e,t+13),normal_coordinate_bytes:o(e,t+14),uv_coordinate_bytes:o(e,t+15),vertex_index_bytes:o(e,t+16),normal_index_bytes:o(e,t+17),uv_index_bytes:o(e,t+18),material_index_bytes:o(e,t+19),nvertices:s(e,t+20),nnormals:s(e,t+20+4),nuvs:s(e,t+20+8),ntri_flat:s(e,t+20+12),ntri_smooth:s(e,t+20+16),ntri_flat_uv:s(e,t+20+20),ntri_smooth_uv:s(e,t+20+24),nquad_flat:s(e,t+20+28),nquad_smooth:s(e,t+20+32),nquad_flat_uv:s(e,t+20+36),nquad_smooth_uv:s(e,t+20+40)};return i}function r(e,t,i){for(var n=new Uint8Array(e,t,i),r="",o=0;o<i;o++)r+=String.fromCharCode(n[t+o]);return r}function o(e,t){var i=new Uint8Array(e,t,1);return i[0]}function s(e,t){var i=new Uint32Array(e,t,1);return i[0]}function a(t){var i,n,r,o,s=x.nvertices,a=new Float32Array(e,t,3*s);for(i=0;i<s;i++)n=a[3*i],r=a[3*i+1],o=a[3*i+2],V.vertices.push(new THREE.Vector3(n,r,o));return 3*s*Float32Array.BYTES_PER_ELEMENT}function l(t){var i=x.nnormals;if(i){var n,r,o,s,a=new Int8Array(e,t,3*i);for(n=0;n<i;n++)r=a[3*n],o=a[3*n+1],s=a[3*n+2],$.push(r/127,o/127,s/127)}return 3*i*Int8Array.BYTES_PER_ELEMENT}function u(t){var i=x.nuvs;if(i){var n,r,o,s=new Float32Array(e,t,2*i);for(n=0;n<i;n++)r=s[2*n],o=s[2*n+1],W.push(r,o)}return 2*i*Float32Array.BYTES_PER_ELEMENT}function c(t,i){var n,r,o,s,a,l,u,c,h,d,p=new Uint32Array(e,i,3*t);for(n=0;n<t;n++)r=p[3*n],o=p[3*n+1],s=p[3*n+2],a=W[2*r],c=W[2*r+1],l=W[2*o],h=W[2*o+1],u=W[2*s],d=W[2*s+1],V.faceVertexUvs[0].push([new THREE.Vector2(a,c),new THREE.Vector2(l,h),new THREE.Vector2(u,d)])}function h(t,i){var n,r,o,s,a,l,u,c,h,d,p,f,m,g=new Uint32Array(e,i,4*t);for(n=0;n<t;n++)r=g[4*n],o=g[4*n+1],s=g[4*n+2],a=g[4*n+3],l=W[2*r],d=W[2*r+1],u=W[2*o],p=W[2*o+1],c=W[2*s],f=W[2*s+1],h=W[2*a],m=W[2*a+1],V.faceVertexUvs[0].push([new THREE.Vector2(l,d),new THREE.Vector2(u,p),new THREE.Vector2(h,m)]),V.faceVertexUvs[0].push([new THREE.Vector2(u,p),new THREE.Vector2(c,f),new THREE.Vector2(h,m)])}function d(t,i,n){var r,o,s,a,l,u=new Uint32Array(e,i,3*t),c=new Uint16Array(e,n,t);for(r=0;r<t;r++)o=u[3*r],s=u[3*r+1],a=u[3*r+2],l=c[r],V.faces.push(new THREE.Face3(o,s,a,null,null,l))}function p(t,i,n){var r,o,s,a,l,u,c=new Uint32Array(e,i,4*t),h=new Uint16Array(e,n,t);for(r=0;r<t;r++)o=c[4*r],s=c[4*r+1],a=c[4*r+2],l=c[4*r+3],u=h[r],V.faces.push(new THREE.Face3(o,s,l,null,null,u)),V.faces.push(new THREE.Face3(s,a,l,null,null,u))}function f(t,i,n,r){var o,s,a,l,u,c,h,d,p=new Uint32Array(e,i,3*t),f=new Uint32Array(e,n,3*t),m=new Uint16Array(e,r,t);for(o=0;o<t;o++){s=p[3*o],a=p[3*o+1],l=p[3*o+2],c=f[3*o],h=f[3*o+1],d=f[3*o+2],u=m[o];var g=$[3*c],y=$[3*c+1],v=$[3*c+2],E=$[3*h],T=$[3*h+1],b=$[3*h+2],C=$[3*d],O=$[3*d+1],x=$[3*d+2];V.faces.push(new THREE.Face3(s,a,l,[new THREE.Vector3(g,y,v),new THREE.Vector3(E,T,b),new THREE.Vector3(C,O,x)],null,u))}}function m(t,i,n,r){var o,s,a,l,u,c,h,d,p,f,m=new Uint32Array(e,i,4*t),g=new Uint32Array(e,n,4*t),y=new Uint16Array(e,r,t);for(o=0;o<t;o++){s=m[4*o],a=m[4*o+1],l=m[4*o+2],u=m[4*o+3],h=g[4*o],d=g[4*o+1],p=g[4*o+2],f=g[4*o+3],c=y[o];var v=$[3*h],E=$[3*h+1],T=$[3*h+2],b=$[3*d],C=$[3*d+1],O=$[3*d+2],x=$[3*p],w=$[3*p+1],R=$[3*p+2],L=$[3*f],S=$[3*f+1],_=$[3*f+2];V.faces.push(new THREE.Face3(s,a,u,[new THREE.Vector3(v,E,T),new THREE.Vector3(b,C,O),new THREE.Vector3(L,S,_)],null,c)),V.faces.push(new THREE.Face3(a,l,u,[new THREE.Vector3(b,C,O),new THREE.Vector3(x,w,R),new THREE.Vector3(L,S,_)],null,c))}}function g(e){var t=x.ntri_flat;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*3;d(t,e,i)}}function y(e){var t=x.ntri_flat_uv;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*3,n=i+t*Uint32Array.BYTES_PER_ELEMENT*3;d(t,e,n),c(t,i)}}function v(e){var t=x.ntri_smooth;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*3,n=i+t*Uint32Array.BYTES_PER_ELEMENT*3;f(t,e,i,n)}}function E(e){var t=x.ntri_smooth_uv;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*3,n=i+t*Uint32Array.BYTES_PER_ELEMENT*3,r=n+t*Uint32Array.BYTES_PER_ELEMENT*3;f(t,e,i,r),c(t,n)}}function T(e){var t=x.nquad_flat;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*4;p(t,e,i)}}function b(e){var t=x.nquad_flat_uv;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*4,n=i+t*Uint32Array.BYTES_PER_ELEMENT*4;p(t,e,n),h(t,i)}}function C(e){var t=x.nquad_smooth;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*4,n=i+t*Uint32Array.BYTES_PER_ELEMENT*4;m(t,e,i,n)}}function O(e){var t=x.nquad_smooth_uv;if(t){var i=e+t*Uint32Array.BYTES_PER_ELEMENT*4,n=i+t*Uint32Array.BYTES_PER_ELEMENT*4,r=n+t*Uint32Array.BYTES_PER_ELEMENT*4;m(t,e,i,r),h(t,n)}}var x,w,R,L,S,_,I,D,M,A,N,P,k,H,F,B,K,z,U,V=this,G=0,$=[],W=[];THREE.Geometry.call(this),x=n(e,G),G+=x.header_bytes,A=3*x.vertex_index_bytes+x.material_index_bytes,N=4*x.vertex_index_bytes+x.material_index_bytes,P=x.ntri_flat*A,k=x.ntri_smooth*(A+3*x.normal_index_bytes),H=x.ntri_flat_uv*(A+3*x.uv_index_bytes),F=x.ntri_smooth_uv*(A+3*x.normal_index_bytes+3*x.uv_index_bytes),B=x.nquad_flat*N,K=x.nquad_smooth*(N+4*x.normal_index_bytes),z=x.nquad_flat_uv*(N+4*x.uv_index_bytes),U=x.nquad_smooth_uv*(N+4*x.normal_index_bytes+4*x.uv_index_bytes),G+=a(G),G+=l(G),G+=i(3*x.nnormals),G+=u(G),w=G,R=w+P+i(2*x.ntri_flat),L=R+k+i(2*x.ntri_smooth),S=L+H+i(2*x.ntri_flat_uv),_=S+F+i(2*x.ntri_smooth_uv),I=_+B+i(2*x.nquad_flat),D=I+K+i(2*x.nquad_smooth),M=D+z+i(2*x.nquad_flat_uv),y(L),E(S),b(D),O(M),g(w),v(R),T(_),C(I),this.computeFaceNormals()};r.prototype=Object.create(THREE.Geometry.prototype),r.prototype.constructor=r;var o=new r(i),s=THREE.Loader.prototype.initMaterials(n,i,this.crossOrigin);t(o,s)}},THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,i,n){var r=this,o=new THREE.XHRLoader(r.manager);o.setPath(this.path),o.load(e,function(e){t(r.parse(e))},i,n)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object&&"function"==typeof this.object._finalize&&this.object._finalize();var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){return{index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();return t&&t.groupEnd===-1&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e!==!1&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0]),r.push(n[e+1]),r.push(n[e+2]),r.push(n[t+0]),r.push(n[t+1]),r.push(n[t+2]),r.push(n[i+0]),r.push(n[i+1]),r.push(n[i+2])},addVertexLine:function(e){var t=this.vertices,i=this.object.geometry.vertices;i.push(t[e+0]),i.push(t[e+1]),i.push(t[e+2])},addNormal:function(e,t,i){var n=this.normals,r=this.object.geometry.normals;r.push(n[e+0]),r.push(n[e+1]),r.push(n[e+2]),r.push(n[t+0]),r.push(n[t+1]),r.push(n[t+2]),r.push(n[i+0]),r.push(n[i+1]),r.push(n[i+2])},addUV:function(e,t,i){var n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0]),r.push(n[e+1]),r.push(n[t+0]),r.push(n[t+1]),r.push(n[i+0]),r.push(n[i+1])},addUVLine:function(e){var t=this.uvs,i=this.object.geometry.uvs;i.push(t[e+0]),i.push(t[e+1])},addFace:function(e,t,i,n,r,o,s,a,l,u,c,h){var d,p=this.vertices.length,f=this.parseVertexIndex(e,p),m=this.parseVertexIndex(t,p),g=this.parseVertexIndex(i,p);if(void 0===n?this.addVertex(f,m,g):(d=this.parseVertexIndex(n,p),this.addVertex(f,m,d),this.addVertex(m,g,d)),void 0!==r){var y=this.uvs.length;f=this.parseUVIndex(r,y),m=this.parseUVIndex(o,y),g=this.parseUVIndex(s,y),void 0===n?this.addUV(f,m,g):(d=this.parseUVIndex(a,y),this.addUV(f,m,d),this.addUV(m,g,d))}if(void 0!==l){var v=this.normals.length;f=this.parseNormalIndex(l,v),m=l===u?f:this.parseNormalIndex(u,v),g=l===c?f:this.parseNormalIndex(c,v),void 0===n?this.addNormal(f,m,g):(d=this.parseNormalIndex(h,v),this.addNormal(f,m,d),this.addNormal(m,g,d))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,n=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(var s=0,o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],n))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();e.indexOf("\r\n")!==-1&&(e=e.replace("\r\n","\n"));for(var i=e.split("\n"),n="",r="",o="",s=0,a=[],l="function"==typeof"".trimLeft,u=0,c=i.length;u<c;u++)if(n=i[u],n=l?n.trimLeft():n.trim(),s=n.length,0!==s&&(r=n.charAt(0),"#"!==r))if("v"===r)if(o=n.charAt(1)," "===o&&null!==(a=this.regexp.vertex_pattern.exec(n)))t.vertices.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else if("n"===o&&null!==(a=this.regexp.normal_pattern.exec(n)))t.normals.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else{if("t"!==o||null===(a=this.regexp.uv_pattern.exec(n)))throw new Error("Unexpected vertex/normal/uv line: '"+n+"'");t.uvs.push(parseFloat(a[1]),parseFloat(a[2]))}else if("f"===r)if(null!==(a=this.regexp.face_vertex_uv_normal.exec(n)))t.addFace(a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],a[3],a[6],a[9],a[12]);else if(null!==(a=this.regexp.face_vertex_uv.exec(n)))t.addFace(a[1],a[3],a[5],a[7],a[2],a[4],a[6],a[8]);else if(null!==(a=this.regexp.face_vertex_normal.exec(n)))t.addFace(a[1],a[3],a[5],a[7],void 0,void 0,void 0,void 0,a[2],a[4],a[6],a[8]);else{if(null===(a=this.regexp.face_vertex.exec(n)))throw new Error("Unexpected face line: '"+n+"'");t.addFace(a[1],a[2],a[3],a[4])}else if("l"===r){var h=n.substring(1).trim().split(" "),d=[],p=[];if(n.indexOf("/")===-1)d=h;else for(var f=0,m=h.length;f<m;f++){var g=h[f].split("/");""!==g[0]&&d.push(g[0]),""!==g[1]&&p.push(g[1])}t.addLineGeometry(d,p)}else if(null!==(a=this.regexp.object_pattern.exec(n))){var y=a[0].substr(1).trim();t.startObject(y)}else if(this.regexp.material_use_pattern.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(n))t.materialLibraries.push(n.substring(7).trim());else{if(null===(a=this.regexp.smoothing_pattern.exec(n))){if("\0"===n)continue;throw new Error("Unexpected line: '"+n+"'")}var v=a[1].trim().toLowerCase();t.object.smooth="1"===v||"on"===v;var E=t.object.currentMaterial();E&&(E.smooth=t.object.smooth)}t.finalize();var T=new THREE.Group;T.materialLibraries=[].concat(t.materialLibraries);for(var u=0,c=t.objects.length;u<c;u++){var b=t.objects[u],C=b.geometry,O=b.materials,x="Line"===C.type;if(0!==C.vertices.length){var w=new THREE.BufferGeometry;w.addAttribute("position",new THREE.BufferAttribute(new Float32Array(C.vertices),3)),C.normals.length>0?w.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(C.normals),3)):w.computeVertexNormals(),C.uvs.length>0&&w.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(C.uvs),2));for(var R=[],L=0,S=O.length;L<S;L++){var _=O[L],E=void 0;if(null!==this.materials&&(E=this.materials.create(_.name),x&&E&&!(E instanceof THREE.LineBasicMaterial))){var I=new THREE.LineBasicMaterial;I.copy(E),E=I}E||(E=x?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,E.name=_.name),E.shading=_.smooth?THREE.SmoothShading:THREE.FlatShading,R.push(E)}var D;if(R.length>1){for(var L=0,S=O.length;L<S;L++){var _=O[L];w.addGroup(_.groupStart,_.groupCount,L)}var M=new THREE.MultiMaterial(R);D=x?new THREE.Line(w,M):new THREE.Mesh(w,M)}else D=x?new THREE.Line(w,R[0]):new THREE.Mesh(w,R[0]);D.name=b.name,T.add(D)}}return T}},THREE.CurveUtils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e,t,i,n,r){var o=6*e*e-6*e,s=3*e*e-4*e+1,a=-6*e*e+6*e,l=3*e*e-2*e;return o+s+a+l},interpolate:function(e,t,i,n,r){var o=.5*(i-e),s=.5*(n-t),a=r*r,l=r*a;return(2*t-2*i+o+s)*l+(-3*t+3*i-2*o-s)*a+o*r+t}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Group,n=0,r=t.length;n<r;n++)i.add(new THREE.Mesh(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new THREE.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},THREE.ShapeUtils={area:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},triangulate:function(){function e(e,t,i,n,r,o){var s,a,l,u,c,h,d,p,f;if(a=e[o[t]].x,l=e[o[t]].y,u=e[o[i]].x,c=e[o[i]].y,h=e[o[n]].x,d=e[o[n]].y,Number.EPSILON>(u-a)*(d-l)-(c-l)*(h-a))return!1;var m,g,y,v,E,T,b,C,O,x,w,R,L,S,_;for(m=h-u,g=d-c,y=a-h,v=l-d,E=u-a,T=c-l,s=0;s<r;s++)if(p=e[o[s]].x,f=e[o[s]].y,!(p===a&&f===l||p===u&&f===c||p===h&&f===d)&&(b=p-a,C=f-l,O=p-u,x=f-c,w=p-h,R=f-d,_=m*x-g*O,L=E*C-T*b,S=y*R-v*w,_>=-Number.EPSILON&&S>=-Number.EPSILON&&L>=-Number.EPSILON))return!1;return!0}return function(t,i){var n=t.length;if(n<3)return null;var r,o,s,a=[],l=[],u=[];if(THREE.ShapeUtils.area(t)>0)for(o=0;o<n;o++)l[o]=o;else for(o=0;o<n;o++)l[o]=n-1-o;var c=n,h=2*c;for(o=c-1;c>2;){if(h--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?u:a;if(r=o,c<=r&&(r=0),o=r+1,c<=o&&(o=0),s=o+1,c<=s&&(s=0),e(t,r,o,s,c,l)){var d,p,f,m,g;for(d=l[r],p=l[o],f=l[s],a.push([t[d],t[p],t[f]]),u.push([l[r],l[o],l[s]]),m=o,g=o+1;g<c;m++,g++)l[m]=l[g];c--,h=2*c}}return i?u:a}}(),triangulateShape:function(e,t){function i(e,t,i){return e.x!==t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function n(e,t,n,r,o){var s=t.x-e.x,a=t.y-e.y,l=r.x-n.x,u=r.y-n.y,c=e.x-n.x,h=e.y-n.y,d=a*l-s*u,p=a*c-s*h;if(Math.abs(d)>Number.EPSILON){var f;if(d>0){if(p<0||p>d)return[];if(f=u*c-l*h,f<0||f>d)return[]}else{if(p>0||p<d)return[];if(f=u*c-l*h,f>0||f<d)return[]}if(0===f)return!o||0!==p&&p!==d?[e]:[];if(f===d)return!o||0!==p&&p!==d?[t]:[];if(0===p)return[n];if(p===d)return[r];var m=f/d;return[{x:e.x+m*s,y:e.y+m*a}]}if(0!==p||u*c!==l*h)return[];var g=0===s&&0===a,y=0===l&&0===u;if(g&&y)return e.x!==n.x||e.y!==n.y?[]:[e];if(g)return i(n,r,e)?[e]:[];if(y)return i(e,t,n)?[n]:[];var v,E,T,b,C,O,x,w;return 0!==s?(e.x<t.x?(v=e,T=e.x,E=t,b=t.x):(v=t,T=t.x,E=e,b=e.x),n.x<r.x?(C=n,x=n.x,O=r,w=r.x):(C=r,x=r.x,O=n,w=n.x)):(e.y<t.y?(v=e,T=e.y,E=t,b=t.y):(v=t,T=t.y,E=e,b=e.y),n.y<r.y?(C=n,x=n.y,O=r,w=r.y):(C=r,x=r.y,O=n,w=n.y)),T<=x?b<x?[]:b===x?o?[]:[C]:b<=w?[C,E]:[C,O]:T>w?[]:T===w?o?[]:[v]:b<=w?[v,E]:[v,O]}function r(e,t,i,n){var r=t.x-e.x,o=t.y-e.y,s=i.x-e.x,a=i.y-e.y,l=n.x-e.x,u=n.y-e.y,c=r*a-o*s,h=r*u-o*l;if(Math.abs(c)>Number.EPSILON){var d=l*a-u*s;return c>0?h>=0&&d>=0:h>=0||d>=0}return h>0}function o(e,t){function i(e,t){var i=v.length-1,n=e-1;n<0&&(n=i);var o=e+1;o>i&&(o=0);var s=r(v[e],v[n],v[o],a[t]);if(!s)return!1;var l=a.length-1,u=t-1;u<0&&(u=l);var c=t+1;return c>l&&(c=0),s=r(a[t],a[u],a[c],v[e]),!!s}function o(e,t){var i,r,o;for(i=0;i<v.length;i++)if(r=i+1,r%=v.length,o=n(e,t,v[i],v[r],!0),o.length>0)return!0;return!1}function s(e,i){var r,o,s,a,l;for(r=0;r<E.length;r++)for(o=t[E[r]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,l=n(e,i,o[s],o[a],!0),l.length>0)return!0;return!1}for(var a,l,u,c,h,d,p,f,m,g,y,v=e.concat(),E=[],T=[],b=0,C=t.length;b<C;b++)E.push(b);for(var O=0,x=2*E.length;E.length>0;){if(x--,x<0){console.log("Infinite Loop! Holes left:"+E.length+", Probably Hole outside Shape!");break}for(u=O;u<v.length;u++){c=v[u],l=-1;for(var b=0;b<E.length;b++)if(d=E[b],p=c.x+":"+c.y+":"+d,void 0===T[p]){a=t[d];for(var w=0;w<a.length;w++)if(h=a[w],i(u,w)&&!o(c,h)&&!s(c,h)){l=w,E.splice(b,1),f=v.slice(0,u+1),m=v.slice(u),g=a.slice(l),y=a.slice(0,l+1),v=f.concat(g).concat(y).concat(m),O=u;break}if(l>=0)break;T[p]=!0}if(l>=0)break}}return v}for(var s,a,l,u,c,h,d={},p=e.concat(),f=0,m=t.length;f<m;f++)Array.prototype.push.apply(p,t[f]);for(s=0,a=p.length;s<a;s++)c=p[s].x+":"+p[s].y,void 0!==d[c]&&console.warn("THREE.Shape: Duplicate point",c),d[c]=s;var g=o(e,t),y=THREE.ShapeUtils.triangulate(g,!1);for(s=0,a=y.length;s<a;s++)for(u=y[s],l=0;l<3;l++)c=u[l].x+":"+u[l].y,h=d[c],void 0!==h&&(u[l]=h);return y.concat()},isClockWise:function(e){return THREE.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var i=1-e;return i*i*t}function t(e,t){return 2*(1-e)*e*t}function i(e,t){return e*e*t}return function(n,r,o,s){return e(n,r)+t(n,o)+i(n,s)}}(),b3:function(){function e(e,t){var i=1-e;return i*i*i*t}function t(e,t){var i=1-e;return 3*i*i*e*t}function i(e,t){var i=1-e;return 3*i*e*e*t}function n(e,t){return e*e*e*t}return function(r,o,s,a,l){return e(r,o)+t(r,s)+i(r,a)+n(r,l)}}()},THREE.Curve=function(){},THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},getSpacedPoints:function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=e;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var s,a=0,l=o-1;a<=l;)if(r=Math.floor(a+(l-a)/2),s=n[r]-i,s<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===i){var u=r/(o-1);return u}var c=n[r],h=n[r+1],d=h-c,p=(i-c)/d,u=(r+p)/(o-1);return u},getTangent:function(e){var t=1e-4,i=e-t,n=e+t;i<0&&(i=0),n>1&&(n=1);var r=this.getPoint(i),o=this.getPoint(n),s=o.clone().sub(r);return s.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=t){var r=i[n]-t,o=this.curves[n],s=1-r/o.getLength();return o.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
for(var e=[],t=0,i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},createPointsGeometry:function(e){var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){for(var t=new THREE.Geometry,i=0,n=e.length;i<n;i++){var r=e[i];t.vertices.push(new THREE.Vector3(r.x,r.y,r.z||0))}return t}}),THREE.Font=function(e){this.data=e},Object.assign(THREE.Font.prototype,{generateShapes:function(e,t,i){function n(e){for(var i=String(e).split(""),n=t/o.resolution,s=0,a=[],l=0;l<i.length;l++){var u=r(i[l],n,s);s+=u.offset,a.push(u.path)}return a}function r(e,t,n){var r=o.glyphs[e]||o.glyphs["?"];if(r){var s,a,l,u,c,h,d,p,f,m,g,y=new THREE.Path,v=[],E=THREE.ShapeUtils.b2,T=THREE.ShapeUtils.b3;if(r.o)for(var b=r._cachedOutline||(r._cachedOutline=r.o.split(" ")),C=0,O=b.length;C<O;){var x=b[C++];switch(x){case"m":s=b[C++]*t+n,a=b[C++]*t,y.moveTo(s,a);break;case"l":s=b[C++]*t+n,a=b[C++]*t,y.lineTo(s,a);break;case"q":if(l=b[C++]*t+n,u=b[C++]*t,d=b[C++]*t+n,p=b[C++]*t,y.quadraticCurveTo(d,p,l,u),g=v[v.length-1]){c=g.x,h=g.y;for(var w=1;w<=i;w++){var R=w/i;E(R,c,d,l),E(R,h,p,u)}}break;case"b":if(l=b[C++]*t+n,u=b[C++]*t,d=b[C++]*t+n,p=b[C++]*t,f=b[C++]*t+n,m=b[C++]*t,y.bezierCurveTo(d,p,f,m,l,u),g=v[v.length-1]){c=g.x,h=g.y;for(var w=1;w<=i;w++){var R=w/i;T(R,c,d,f,l),T(R,h,p,m,u)}}}}return{offset:r.ha*t,path:y}}}void 0===t&&(t=100),void 0===i&&(i=4);for(var o=this.data,s=n(e),a=[],l=0,u=s.length;l<u;l++)Array.prototype.push.apply(a,s[l].toShapes());return a}}),THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},lineTo:function(e,t){var i=this.actions[this.actions.length-1].args,n=i[i.length-2],r=i[i.length-1],o=new THREE.LineCurve(new THREE.Vector2(n,r),new THREE.Vector2(e,t));this.curves.push(o),this.actions.push({action:"lineTo",args:[e,t]})},quadraticCurveTo:function(e,t,i,n){var r=this.actions[this.actions.length-1].args,o=r[r.length-2],s=r[r.length-1],a=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,s),new THREE.Vector2(e,t),new THREE.Vector2(i,n));this.curves.push(a),this.actions.push({action:"quadraticCurveTo",args:[e,t,i,n]})},bezierCurveTo:function(e,t,i,n,r,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1],u=new THREE.CubicBezierCurve(new THREE.Vector2(a,l),new THREE.Vector2(e,t),new THREE.Vector2(i,n),new THREE.Vector2(r,o));this.curves.push(u),this.actions.push({action:"bezierCurveTo",args:[e,t,i,n,r,o]})},splineThru:function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],r=i[i.length-1],o=[new THREE.Vector2(n,r)];Array.prototype.push.apply(o,e);var s=new THREE.SplineCurve(o);this.curves.push(s);var a=e[e.length-1];t.push(a.x),t.push(a.y),this.actions.push({action:"splineThru",args:t})},arc:function(e,t,i,n,r,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,i,n,r,o)},absarc:function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},ellipse:function(e,t,i,n,r,o,s,a){var l=this.actions[this.actions.length-1].args,u=l[l.length-2],c=l[l.length-1];this.absellipse(e+u,t+c,i,n,r,o,s,a)},absellipse:function(e,t,i,n,r,o,s,a){var l=[e,t,i,n,r,o,s,a||0],u=new THREE.EllipseCurve(e,t,i,n,r,o,s,a);this.curves.push(u);var c=u.getPoint(1);l.push(c.x),l.push(c.y),this.actions.push({action:"ellipse",args:l})},getSpacedPoints:function(e){e||(e=40);for(var t=[],i=0;i<e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i,n,r,o,s,a,l,u,c,h,d=THREE.ShapeUtils.b2,p=THREE.ShapeUtils.b3,f=[],m=0,g=this.actions.length;m<g;m++){var y=this.actions[m],v=y.action,E=y.args;switch(v){case"moveTo":f.push(new THREE.Vector2(E[0],E[1]));break;case"lineTo":f.push(new THREE.Vector2(E[0],E[1]));break;case"quadraticCurveTo":t=E[2],i=E[3],o=E[0],s=E[1],f.length>0?(u=f[f.length-1],a=u.x,l=u.y):(u=this.actions[m-1].args,a=u[u.length-2],l=u[u.length-1]);for(var T=1;T<=e;T++){var b=T/e;c=d(b,a,o,t),h=d(b,l,s,i),f.push(new THREE.Vector2(c,h))}break;case"bezierCurveTo":t=E[4],i=E[5],o=E[0],s=E[1],n=E[2],r=E[3],f.length>0?(u=f[f.length-1],a=u.x,l=u.y):(u=this.actions[m-1].args,a=u[u.length-2],l=u[u.length-1]);for(var T=1;T<=e;T++){var b=T/e;c=p(b,a,o,n,t),h=p(b,l,s,r,i),f.push(new THREE.Vector2(c,h))}break;case"splineThru":u=this.actions[m-1].args;var C=new THREE.Vector2(u[u.length-2],u[u.length-1]),O=[C],x=e*E[0].length;O=O.concat(E[0]);for(var w=new THREE.SplineCurve(O),T=1;T<=x;T++)f.push(w.getPointAt(T/x));break;case"arc":for(var R,L=E[0],S=E[1],_=E[2],I=E[3],D=E[4],M=!!E[5],A=D-I,N=2*e,T=1;T<=N;T++){var b=T/N;M||(b=1-b),R=I+b*A,c=L+_*Math.cos(R),h=S+_*Math.sin(R),f.push(new THREE.Vector2(c,h))}break;case"ellipse":var R,P,k,L=E[0],S=E[1],H=E[2],F=E[3],I=E[4],D=E[5],M=!!E[6],B=E[7],A=D-I,N=2*e;0!==B&&(P=Math.cos(B),k=Math.sin(B));for(var T=1;T<=N;T++){var b=T/N;if(M||(b=1-b),R=I+b*A,c=L+H*Math.cos(R),h=S+F*Math.sin(R),0!==B){var K=c,z=h;c=(K-L)*P-(z-S)*k+L,h=(K-L)*k+(z-S)*P+S}f.push(new THREE.Vector2(c,h))}}}var U=f[f.length-1];return Math.abs(U.x-f[0].x)<Number.EPSILON&&Math.abs(U.y-f[0].y)<Number.EPSILON&&f.splice(f.length-1,1),this.autoClose&&f.push(f[0]),f},toShapes:function(e,t){function i(e){for(var t=[],i=new THREE.Path,n=0,r=e.length;n<r;n++){var o=e[n],s=o.args,a=o.action;"moveTo"===a&&0!==i.actions.length&&(t.push(i),i=new THREE.Path),i[a].apply(i,s)}return 0!==i.actions.length&&t.push(i),t}function n(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new THREE.Shape;o.actions=r.actions,o.curves=r.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var s=t[r],a=t[o],l=a.x-s.x,u=a.y-s.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(s=t[o],l=-l,a=t[r],u=-u),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return n}var o=THREE.ShapeUtils.isClockWise,s=i(this.actions);if(0===s.length)return[];if(t===!0)return n(s);var a,l,u,c=[];if(1===s.length)return l=s[0],u=new THREE.Shape,u.actions=l.actions,u.curves=l.curves,c.push(u),c;var h=!o(s[0].getPoints());h=e?!h:h;var d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var y=0,v=s.length;y<v;y++)l=s[y],d=l.getPoints(),a=o(d),a=e?!a:a,a?(!h&&f[g]&&g++,f[g]={s:new THREE.Shape,p:d},f[g].s.actions=l.actions,f[g].s.curves=l.curves,h&&g++,m[g]=[]):m[g].push({h:l,p:d[0]});if(!f[0])return n(s);if(f.length>1){for(var E=!1,T=[],b=0,C=f.length;b<C;b++)p[b]=[];for(var b=0,C=f.length;b<C;b++)for(var O=m[b],x=0;x<O.length;x++){for(var w=O[x],R=!0,L=0;L<f.length;L++)r(w.p,f[L].p)&&(b!==L&&T.push({froms:b,tos:L,hole:x}),R?(R=!1,p[L].push(w)):E=!0);R&&p[b].push(w)}T.length>0&&(E||(m=p))}for(var S,y=0,_=f.length;y<_;y++){u=f[y].s,c.push(u),S=m[y];for(var I=0,D=S.length;I<D;I++)u.holes.push(S[I].h)}return c}}),THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(e){return new THREE.ExtrudeGeometry(this,e)},makeGeometry:function(e){return new THREE.ShapeGeometry(this,e)},getPointsHoles:function(e){for(var t=[],i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentQuadraticBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},THREE.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentCubicBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,n=Math.floor(i),r=i-n,o=t[0===n?n:n-1],s=t[n],a=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],u=THREE.CurveUtils.interpolate;return new THREE.Vector2(u(o.x,s.x,a.x,l.x,r),u(o.y,s.y,a.y,l.y,r))},THREE.EllipseCurve=function(e,t,i,n,r,o,s,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a||0},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve,THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;t<0&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var i;i=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var n=this.aX+this.xRadius*Math.cos(i),r=this.aY+this.yRadius*Math.sin(i);if(0!==this.aRotation){var o=Math.cos(this.aRotation),s=Math.sin(this.aRotation),a=n,l=r;n=(a-this.aX)*o-(l-this.aY)*s+this.aX,r=(a-this.aX)*s+(l-this.aY)*o+this.aY}return new THREE.Vector2(n,r)},THREE.ArcCurve=function(e,t,i,n,r,o){THREE.EllipseCurve.call(this,e,t,i,i,n,r,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),THREE.SplineCurve3=THREE.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==e?[]:e},function(e){var t=this.points,i=(t.length-1)*e,n=Math.floor(i),r=i-n,o=t[0==n?n:n-1],s=t[n],a=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],u=THREE.CurveUtils.interpolate;return new THREE.Vector3(u(o.x,s.x,a.x,l.x,r),u(o.y,s.y,a.y,l.y,r),u(o.z,s.z,a.z,l.z,r))}),THREE.CatmullRomCurve3=function(){function e(){}var t=new THREE.Vector3,i=new e,n=new e,r=new e;return e.prototype.init=function(e,t,i,n){this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-n,this.c3=2*e-2*t+i+n},e.prototype.initNonuniformCatmullRom=function(e,t,i,n,r,o,s){var a=(t-e)/r-(i-e)/(r+o)+(i-t)/o,l=(i-t)/o-(n-t)/(o+s)+(n-i)/s;a*=o,l*=o,this.init(t,i,a,l)},e.prototype.initCatmullRom=function(e,t,i,n,r){this.init(t,i,r*(i-e),r*(n-t))},e.prototype.calc=function(e){var t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i},THREE.Curve.create(function(e){this.points=e||[],this.closed=!1},function(e){var o,s,a,l,u=this.points;l=u.length,l<2&&console.log("duh, you need at least 2 points"),o=(l-(this.closed?0:1))*e,s=Math.floor(o),a=o-s,this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/u.length)+1)*u.length:0===a&&s===l-1&&(s=l-2,a=1);var c,h,d,p;if(this.closed||s>0?c=u[(s-1)%l]:(t.subVectors(u[0],u[1]).add(u[0]),c=t),h=u[s%l],d=u[(s+1)%l],this.closed||s+2<l?p=u[(s+2)%l]:(t.subVectors(u[l-1],u[l-2]).add(u[l-1]),p=t),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var f="chordal"===this.type?.5:.25,m=Math.pow(c.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),y=Math.pow(d.distanceToSquared(p),f);g<1e-4&&(g=1),m<1e-4&&(m=g),y<1e-4&&(y=g),i.initNonuniformCatmullRom(c.x,h.x,d.x,p.x,m,g,y),n.initNonuniformCatmullRom(c.y,h.y,d.y,p.y,m,g,y),r.initNonuniformCatmullRom(c.z,h.z,d.z,p.z,m,g,y)}else if("catmullrom"===this.type){var v=void 0!==this.tension?this.tension:.5;i.initCatmullRom(c.x,h.x,d.x,p.x,v),n.initCatmullRom(c.y,h.y,d.y,p.y,v),r.initCatmullRom(c.z,h.z,d.z,p.z,v)}var E=new THREE.Vector3(i.calc(a),n.calc(a),r.calc(a));return E})}(),THREE.ClosedSplineCurve3=function(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3."),THREE.CatmullRomCurve3.call(this,e),this.type="catmullrom",this.closed=!0},THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype),THREE.BoxGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new THREE.BoxBufferGeometry(e,t,i,n,r,o)),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry,THREE.CubeGeometry=THREE.BoxGeometry,THREE.BoxBufferGeometry=function(e,t,i,n,r,o){function s(e,t,i){var n=0;return n+=(e+1)*(t+1)*2,n+=(e+1)*(i+1)*2,n+=(i+1)*(t+1)*2}function a(e,t,i){var n=0;return n+=e*t*2,n+=e*i*2,n+=i*t*2,6*n}function l(e,t,i,n,r,o,s,a,l,c,h){for(var b=o/l,C=s/c,O=o/2,x=s/2,w=a/2,R=l+1,L=c+1,S=0,_=0,I=new THREE.Vector3,D=0;D<L;D++)for(var M=D*C-x,A=0;A<R;A++){var N=A*b-O;I[e]=N*n,I[t]=M*r,I[i]=w,p[g]=I.x,p[g+1]=I.y,p[g+2]=I.z,I[e]=0,I[t]=0,I[i]=a>0?1:-1,f[g]=I.x,f[g+1]=I.y,f[g+2]=I.z,m[y]=A/l,m[y+1]=1-D/c,g+=3,y+=2,S+=1}for(D=0;D<c;D++)for(A=0;A<l;A++){var P=E+A+R*D,k=E+A+R*(D+1),H=E+(A+1)+R*(D+1),F=E+(A+1)+R*D;d[v]=P,d[v+1]=k,d[v+2]=F,d[v+3]=k,d[v+4]=H,d[v+5]=F,v+=6,_+=6}u.addGroup(T,_,h),T+=_,E+=S}THREE.BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};var u=this;n=Math.floor(n)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;var c=s(n,r,o),h=a(n,r,o),d=new(h>65535?Uint32Array:Uint16Array)(h),p=new Float32Array(3*c),f=new Float32Array(3*c),m=new Float32Array(2*c),g=0,y=0,v=0,E=0,T=0;l("z","y","x",-1,-1,i,t,e,o,r,0),l("z","y","x",1,-1,i,t,-e,o,r,1),l("x","z","y",1,1,e,i,t,n,o,2),l("x","z","y",1,-1,e,i,-t,n,o,3),l("x","y","z",1,-1,e,t,i,n,r,4),l("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(new THREE.BufferAttribute(d,1)),this.addAttribute("position",new THREE.BufferAttribute(p,3)),this.addAttribute("normal",new THREE.BufferAttribute(f,3)),this.addAttribute("uv",new THREE.BufferAttribute(m,2))},THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry,THREE.CircleGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new THREE.CircleBufferGeometry(e,t,i,n))},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry,THREE.CircleBufferGeometry=function(e,t,i,n){THREE.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r=t+2,o=new Float32Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r);s[2]=1,a[0]=.5,a[1]=.5;for(var l=0,u=3,c=2;l<=t;l++,u+=3,c+=2){var h=i+l/t*n;o[u]=e*Math.cos(h),o[u+1]=e*Math.sin(h),s[u+2]=1,a[c]=(o[u]/e+1)/2,a[c+1]=(o[u+1]/e+1)/2}for(var d=[],u=1;u<=t;u++)d.push(u,u+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new THREE.BufferAttribute(o,3)),this.addAttribute("normal",new THREE.BufferAttribute(s,3)),this.addAttribute("uv",new THREE.BufferAttribute(a,2)),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry,THREE.CylinderBufferGeometry=function(e,t,i,n,r,o,s,a){function l(){var e=(n+1)*(r+1);return o===!1&&(e+=(n+1)*p+n*p),e}function u(){var e=n*r*2*3;return o===!1&&(e+=n*p*3),e}function c(){var o,l,u=new THREE.Vector3,c=new THREE.Vector3,h=0,p=(t-e)/i;for(l=0;l<=r;l++){var f=[],m=l/r,w=m*(t-e)+e;for(o=0;o<=n;o++){var R=o/n;c.x=w*Math.sin(R*a+s),c.y=-m*i+O,c.z=w*Math.cos(R*a+s),y.setXYZ(T,c.x,c.y,c.z),u.copy(c),(0===e&&0===l||0===t&&l===r)&&(u.x=Math.sin(R*a+s),u.z=Math.cos(R*a+s)),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*p).normalize(),v.setXYZ(T,u.x,u.y,u.z),E.setXY(T,R,1-m),f.push(T),T++}C.push(f)}for(o=0;o<n;o++)for(l=0;l<r;l++){var L=C[l][o],S=C[l+1][o],_=C[l+1][o+1],I=C[l][o+1];g.setX(b,L),b++,g.setX(b,S),b++,g.setX(b,I),b++,g.setX(b,S),b++,g.setX(b,_),b++,g.setX(b,I),b++,h+=6}d.addGroup(x,h,0),x+=h}function h(i){var r,o,l,u=new THREE.Vector2,c=new THREE.Vector3,h=0,p=i===!0?e:t,f=i===!0?1:-1;for(o=T,r=1;r<=n;r++)y.setXYZ(T,0,O*f,0),v.setXYZ(T,0,f,0),u.x=.5,u.y=.5,E.setXY(T,u.x,u.y),T++;for(l=T,r=0;r<=n;r++){var m=r/n,C=m*a+s,w=Math.cos(C),R=Math.sin(C);c.x=p*R,c.y=O*f,c.z=p*w,y.setXYZ(T,c.x,c.y,c.z),v.setXYZ(T,0,f,0),u.x=.5*w+.5,u.y=.5*R*f+.5,E.setXY(T,u.x,u.y),T++}for(r=0;r<n;r++){var L=o+r,S=l+r;i===!0?(g.setX(b,S),b++,g.setX(b,S+1),b++,g.setX(b,L),b++):(g.setX(b,S+1),b++,g.setX(b,S),b++,g.setX(b,L),b++),h+=3}d.addGroup(x,h,i===!0?1:2),x+=h}THREE.BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};var d=this;e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,n=Math.floor(n)||8,r=Math.floor(r)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var p=0;o===!1&&(e>0&&p++,t>0&&p++);var f=l(),m=u(),g=new THREE.BufferAttribute(new(m>65535?Uint32Array:Uint16Array)(m),1),y=new THREE.BufferAttribute(new Float32Array(3*f),3),v=new THREE.BufferAttribute(new Float32Array(3*f),3),E=new THREE.BufferAttribute(new Float32Array(2*f),2),T=0,b=0,C=[],O=i/2,x=0;c(),o===!1&&(e>0&&h(!0),t>0&&h(!1)),this.setIndex(g),this.addAttribute("position",y),this.addAttribute("normal",v),this.addAttribute("uv",E)},THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry,THREE.CylinderGeometry=function(e,t,i,n,r,o,s,a){THREE.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new THREE.CylinderBufferGeometry(e,t,i,n,r,o,s,a)),this.mergeVertices()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ConeBufferGeometry=function(e,t,i,n,r,o,s){THREE.CylinderBufferGeometry.call(this,0,e,t,i,n,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,thetaStart:o,thetaLength:s}},THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry,THREE.ConeGeometry=function(e,t,i,n,r,o,s){THREE.CylinderGeometry.call(this,0,e,t,i,n,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}},THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype),THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry,THREE.EdgesGeometry=function(e,t){function i(e,t){return e-t}THREE.BufferGeometry.call(this),t=void 0!==t?t:1;var n,r=Math.cos(THREE.Math.DEG2RAD*t),o=[0,0],s={},a=["a","b","c"];e instanceof THREE.BufferGeometry?(n=new THREE.Geometry,n.fromBufferGeometry(e)):n=e.clone(),n.mergeVertices(),n.computeFaceNormals();for(var l=n.vertices,u=n.faces,c=0,h=u.length;c<h;c++)for(var d=u[c],p=0;p<3;p++){o[0]=d[a[p]],o[1]=d[a[(p+1)%3]],o.sort(i);var f=o.toString();void 0===s[f]?s[f]={vert1:o[0],vert2:o[1],face1:c,face2:void 0}:s[f].face2=c}var m=[];for(var f in s){var g=s[f];if(void 0===g.face2||u[g.face1].normal.dot(u[g.face2].normal)<=r){var y=l[g.vert1];m.push(y.x),m.push(y.y),m.push(y.z),y=l[g.vert2],m.push(y.x),m.push(y.y),m.push(y.z)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(m),3))},THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry,THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(THREE.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;n<i;n++){var r=e[n];this.addShape(r,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){var n,r,o=1,s=e.x-t.x,a=e.y-t.y,l=i.x-e.x,u=i.y-e.y,c=s*s+a*a,h=s*u-a*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+u*u),f=t.x-a/d,m=t.y+s/d,g=i.x-u/p,y=i.y+l/p,v=((g-f)*u-(y-m)*l)/(s*u-a*l);n=f+s*v-e.x,r=m+a*v-e.y;var E=n*n+r*r;if(E<=2)return new THREE.Vector2(n,r);o=Math.sqrt(E/2)}else{var T=!1;s>Number.EPSILON?l>Number.EPSILON&&(T=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(T=!0):Math.sign(a)===Math.sign(u)&&(T=!0),T?(n=-a,r=s,o=Math.sqrt(c)):(n=s,r=a,o=Math.sqrt(c/2))}return new THREE.Vector2(n/o,r/o)}function r(){if(E){var e=0,t=U*e;for($=0;$<V;$++)z=N[$],l(z[2]+t,z[1]+t,z[0]+t);for(e=b+2*v,t=U*e,$=0;$<V;$++)z=N[$],l(z[0]+t,z[1]+t,z[2]+t)}else{for($=0;$<V;$++)z=N[$],l(z[2],z[1],z[0]);for($=0;$<V;$++)z=N[$],l(z[0]+U*b,z[1]+U*b,z[2]+U*b)}}function o(){var e=0;for(s(P,e),e+=P.length,R=0,L=M.length;R<L;R++)w=M[R],s(w,e),e+=w.length}function s(e,t){var i,n;for($=e.length;--$>=0;){i=$,n=$-1,n<0&&(n=e.length-1);var r=0,o=b+2*v;for(r=0;r<o;r++){var s=U*r,a=U*(r+1),l=t+i+s,c=t+n+s,h=t+n+a,d=t+i+a;u(l,c,h,d,e,r,o,i,n)}}}function a(e,t,i){S.vertices.push(new THREE.Vector3(e,t,i))}function l(e,t,i){e+=_,t+=_,i+=_,S.faces.push(new THREE.Face3(e,t,i,null,null,0));var n=x.generateTopUV(S,e,t,i);S.faceVertexUvs[0].push(n)}function u(e,t,i,n,r,o,s,a,l){e+=_,t+=_,i+=_,n+=_,S.faces.push(new THREE.Face3(e,t,n,null,null,1)),S.faces.push(new THREE.Face3(t,i,n,null,null,1));var u=x.generateSideWallUV(S,e,t,i,n);S.faceVertexUvs[0].push([u[0],u[1],u[3]]),S.faceVertexUvs[0].push([u[1],u[2],u[3]])}var c,h,d,p,f,m=void 0!==t.amount?t.amount:100,g=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:g-2,v=void 0!==t.bevelSegments?t.bevelSegments:3,E=void 0===t.bevelEnabled||t.bevelEnabled,T=void 0!==t.curveSegments?t.curveSegments:12,b=void 0!==t.steps?t.steps:1,C=t.extrudePath,O=!1,x=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;C&&(c=C.getSpacedPoints(b),O=!0,E=!1,h=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(C,b,(!1)),d=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3),E||(v=0,g=0,y=0);var w,R,L,S=this,_=this.vertices.length,I=e.extractPoints(T),D=I.shape,M=I.holes,A=!THREE.ShapeUtils.isClockWise(D);if(A){for(D=D.reverse(),R=0,L=M.length;R<L;R++)w=M[R],THREE.ShapeUtils.isClockWise(w)&&(M[R]=w.reverse());A=!1}var N=THREE.ShapeUtils.triangulateShape(D,M),P=D;for(R=0,L=M.length;R<L;R++)w=M[R],D=D.concat(w);for(var k,H,F,B,K,z,U=D.length,V=N.length,G=[],$=0,W=P.length,j=W-1,X=$+1;$<W;$++,j++,X++)j===W&&(j=0),X===W&&(X=0),G[$]=n(P[$],P[j],P[X]);var q,Z=[],Y=G.concat();for(R=0,L=M.length;R<L;R++){for(w=M[R],q=[],$=0,W=w.length,j=W-1,X=$+1;$<W;$++,j++,X++)j===W&&(j=0),X===W&&(X=0),q[$]=n(w[$],w[j],w[X]);Z.push(q),Y=Y.concat(q)}for(k=0;k<v;k++){for(F=k/v,B=g*(1-F),H=y*Math.sin(F*Math.PI/2),$=0,W=P.length;$<W;$++)K=i(P[$],G[$],H),a(K.x,K.y,-B);for(R=0,L=M.length;R<L;R++)for(w=M[R],q=Z[R],$=0,W=w.length;$<W;$++)K=i(w[$],q[$],H),a(K.x,K.y,-B)}for(H=y,$=0;$<U;$++)K=E?i(D[$],Y[$],H):D[$],O?(p.copy(h.normals[0]).multiplyScalar(K.x),d.copy(h.binormals[0]).multiplyScalar(K.y),f.copy(c[0]).add(p).add(d),a(f.x,f.y,f.z)):a(K.x,K.y,0);var J;for(J=1;J<=b;J++)for($=0;$<U;$++)K=E?i(D[$],Y[$],H):D[$],O?(p.copy(h.normals[J]).multiplyScalar(K.x),d.copy(h.binormals[J]).multiplyScalar(K.y),f.copy(c[J]).add(p).add(d),a(f.x,f.y,f.z)):a(K.x,K.y,m/b*J);for(k=v-1;k>=0;k--){for(F=k/v,B=g*(1-F),H=y*Math.sin(F*Math.PI/2),$=0,W=P.length;$<W;$++)K=i(P[$],G[$],H),a(K.x,K.y,m+B);for(R=0,L=M.length;R<L;R++)for(w=M[R],q=Z[R],$=0,W=w.length;$<W;$++)K=i(w[$],q[$],H),O?a(K.x,K.y+c[b-1].y,c[b-1].x+B):a(K.x,K.y,m+B)}r(),o()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n){var r=e.vertices,o=r[t],s=r[i],a=r[n];return[new THREE.Vector2(o.x,o.y),new THREE.Vector2(s.x,s.y),new THREE.Vector2(a.x,a.y)]},generateSideWallUV:function(e,t,i,n,r){var o=e.vertices,s=o[t],a=o[i],l=o[n],u=o[r];return Math.abs(s.y-a.y)<.01?[new THREE.Vector2(s.x,1-s.z),new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(l.x,1-l.z),new THREE.Vector2(u.x,1-u.z)]:[new THREE.Vector2(s.y,1-s.z),new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(l.y,1-l.z),new THREE.Vector2(u.y,1-u.z)]}},THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry,THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;i<n;i++)this.addShape(e[i],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,n,r,o=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,a=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,u=e.extractPoints(o),c=u.shape,h=u.holes,d=!THREE.ShapeUtils.isClockWise(c);if(d){for(c=c.reverse(),i=0,n=h.length;i<n;i++)r=h[i],THREE.ShapeUtils.isClockWise(r)&&(h[i]=r.reverse());d=!1}var p=THREE.ShapeUtils.triangulateShape(c,h);for(i=0,n=h.length;i<n;i++)r=h[i],c=c.concat(r);var f,m,g=c.length,y=p.length;for(i=0;i<g;i++)f=c[i],this.vertices.push(new THREE.Vector3(f.x,f.y,0));for(i=0;i<y;i++){m=p[i];var v=m[0]+l,E=m[1]+l,T=m[2]+l;this.faces.push(new THREE.Face3(v,E,T,null,null,s)),this.faceVertexUvs[0].push(a.generateTopUV(this,v,E,T))}},THREE.LatheBufferGeometry=function(e,t,i,n){THREE.BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t)||12,i=i||0,n=n||2*Math.PI,n=THREE.Math.clamp(n,0,2*Math.PI);var r,o,s,a=(t+1)*e.length,l=t*e.length*2*3,u=new THREE.BufferAttribute(new(l>65535?Uint32Array:Uint16Array)(l),1),c=new THREE.BufferAttribute(new Float32Array(3*a),3),h=new THREE.BufferAttribute(new Float32Array(2*a),2),d=0,p=0,f=(1/(e.length-1),1/t),m=new THREE.Vector3,g=new THREE.Vector2;for(o=0;o<=t;o++){var y=i+o*f*n,v=Math.sin(y),E=Math.cos(y);for(s=0;s<=e.length-1;s++)m.x=e[s].x*v,m.y=e[s].y,m.z=e[s].x*E,c.setXYZ(d,m.x,m.y,m.z),g.x=o/t,g.y=s/(e.length-1),h.setXY(d,g.x,g.y),d++}for(o=0;o<t;o++)for(s=0;s<e.length-1;s++){r=s+o*e.length;var T=r,b=r+e.length,C=r+e.length+1,O=r+1;u.setX(p,T),p++,u.setX(p,b),p++,u.setX(p,O),p++,u.setX(p,b),p++,u.setX(p,C),p++,u.setX(p,O),p++}if(this.setIndex(u),this.addAttribute("position",c),this.addAttribute("uv",h),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,w=new THREE.Vector3,R=new THREE.Vector3,L=new THREE.Vector3;for(r=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)w.x=x[s+0],w.y=x[s+1],w.z=x[s+2],R.x=x[r+s+0],R.y=x[r+s+1],R.z=x[r+s+2],L.addVectors(w,R).normalize(),x[s+0]=x[r+s+0]=L.x,x[s+1]=x[r+s+1]=L.y,x[s+2]=x[r+s+2]=L.z}},THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry,THREE.LatheGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},this.fromBufferGeometry(new THREE.LatheBufferGeometry(e,t,i,n)),this.mergeVertices()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,i,n))},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.PlaneBufferGeometry=function(e,t,i,n){THREE.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};for(var r=e/2,o=t/2,s=Math.floor(i)||1,a=Math.floor(n)||1,l=s+1,u=a+1,c=e/s,h=t/a,d=new Float32Array(l*u*3),p=new Float32Array(l*u*3),f=new Float32Array(l*u*2),m=0,g=0,y=0;y<u;y++)for(var v=y*h-o,E=0;E<l;E++){var T=E*c-r;d[m]=T,d[m+1]=-v,p[m+2]=1,f[g]=E/s,f[g+1]=1-y/a,m+=3,g+=2}m=0;for(var b=new(d.length/3>65535?Uint32Array:Uint16Array)(s*a*6),y=0;y<a;y++)for(var E=0;E<s;E++){var C=E+l*y,O=E+l*(y+1),x=E+1+l*(y+1),w=E+1+l*y;b[m]=C,b[m+1]=O,b[m+2]=w,b[m+3]=O,b[m+4]=x,b[m+5]=w,m+=6}this.setIndex(new THREE.BufferAttribute(b,1)),this.addAttribute("position",new THREE.BufferAttribute(d,3)),this.addAttribute("normal",new THREE.BufferAttribute(p,3)),this.addAttribute("uv",new THREE.BufferAttribute(f,2))},THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry,THREE.RingBufferGeometry=function(e,t,i,n,r,o){THREE.BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},e=e||20,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,n=void 0!==n?Math.max(1,n):1;var s,a,l,u=(i+1)*(n+1),c=i*n*2*3,h=new THREE.BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),d=new THREE.BufferAttribute(new Float32Array(3*u),3),p=new THREE.BufferAttribute(new Float32Array(3*u),3),f=new THREE.BufferAttribute(new Float32Array(2*u),2),m=0,g=0,y=e,v=(t-e)/n,E=new THREE.Vector3,T=new THREE.Vector2;
for(a=0;a<=n;a++){for(l=0;l<=i;l++)s=r+l/i*o,E.x=y*Math.cos(s),E.y=y*Math.sin(s),d.setXYZ(m,E.x,E.y,E.z),p.setXYZ(m,0,0,1),T.x=(E.x/t+1)/2,T.y=(E.y/t+1)/2,f.setXY(m,T.x,T.y),m++;y+=v}for(a=0;a<n;a++){var b=a*(i+1);for(l=0;l<i;l++){s=l+b;var C=s,O=s+i+1,x=s+i+2,w=s+1;h.setX(g,C),g++,h.setX(g,O),g++,h.setX(g,x),g++,h.setX(g,C),g++,h.setX(g,x),g++,h.setX(g,w),g++}}this.setIndex(h),this.addAttribute("position",d),this.addAttribute("normal",p),this.addAttribute("uv",f)},THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry,THREE.RingGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new THREE.RingBufferGeometry(e,t,i,n,r,o))},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry.prototype.constructor=THREE.RingGeometry,THREE.SphereGeometry=function(e,t,i,n,r,o,s){THREE.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new THREE.SphereBufferGeometry(e,t,i,n,r,o,s))},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.SphereBufferGeometry=function(e,t,i,n,r,o,s){THREE.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;for(var a=o+s,l=(t+1)*(i+1),u=new THREE.BufferAttribute(new Float32Array(3*l),3),c=new THREE.BufferAttribute(new Float32Array(3*l),3),h=new THREE.BufferAttribute(new Float32Array(2*l),2),d=0,p=[],f=new THREE.Vector3,m=0;m<=i;m++){for(var g=[],y=m/i,v=0;v<=t;v++){var E=v/t,T=-e*Math.cos(n+E*r)*Math.sin(o+y*s),b=e*Math.cos(o+y*s),C=e*Math.sin(n+E*r)*Math.sin(o+y*s);f.set(T,b,C).normalize(),u.setXYZ(d,T,b,C),c.setXYZ(d,f.x,f.y,f.z),h.setXY(d,E,1-y),g.push(d),d++}p.push(g)}for(var O=[],m=0;m<i;m++)for(var v=0;v<t;v++){var x=p[m][v+1],w=p[m][v],R=p[m+1][v],L=p[m+1][v+1];(0!==m||o>0)&&O.push(x,w,L),(m!==i-1||a<Math.PI)&&O.push(w,R,L)}this.setIndex(new(u.count>65535?THREE.Uint32Attribute:THREE.Uint16Attribute)(O,1)),this.addAttribute("position",u),this.addAttribute("normal",c),this.addAttribute("uv",h),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry,THREE.TextGeometry=function(e,t){t=t||{};var i=t.font;if(i instanceof THREE.Font==!1)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new THREE.Geometry;var n=i.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.TorusBufferGeometry=function(e,t,i,n,r){THREE.BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},e=e||100,t=t||40,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var o,s,a=(i+1)*(n+1),l=i*n*2*3,u=new(l>65535?Uint32Array:Uint16Array)(l),c=new Float32Array(3*a),h=new Float32Array(3*a),d=new Float32Array(2*a),p=0,f=0,m=0,g=new THREE.Vector3,y=new THREE.Vector3,v=new THREE.Vector3;for(o=0;o<=i;o++)for(s=0;s<=n;s++){var E=s/n*r,T=o/i*Math.PI*2;y.x=(e+t*Math.cos(T))*Math.cos(E),y.y=(e+t*Math.cos(T))*Math.sin(E),y.z=t*Math.sin(T),c[p]=y.x,c[p+1]=y.y,c[p+2]=y.z,g.x=e*Math.cos(E),g.y=e*Math.sin(E),v.subVectors(y,g).normalize(),h[p]=v.x,h[p+1]=v.y,h[p+2]=v.z,d[f]=s/n,d[f+1]=o/i,p+=3,f+=2}for(o=1;o<=i;o++)for(s=1;s<=n;s++){var b=(n+1)*o+s-1,C=(n+1)*(o-1)+s-1,O=(n+1)*(o-1)+s,x=(n+1)*o+s;u[m]=b,u[m+1]=C,u[m+2]=x,u[m+3]=C,u[m+4]=O,u[m+5]=x,m+=6}this.setIndex(new THREE.BufferAttribute(u,1)),this.addAttribute("position",new THREE.BufferAttribute(c,3)),this.addAttribute("normal",new THREE.BufferAttribute(h,3)),this.addAttribute("uv",new THREE.BufferAttribute(d,2))},THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry,THREE.TorusGeometry=function(e,t,i,n,r){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new THREE.TorusBufferGeometry(e,t,i,n,r))},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotBufferGeometry=function(e,t,i,n,r,o){function s(e,t,i,n,r){var o=Math.cos(e),s=Math.sin(e),a=i/t*e,l=Math.cos(a);r.x=n*(2+l)*.5*o,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(a)*.5}THREE.BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},e=e||100,t=t||40,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,o=o||3;var a,l,u=(n+1)*(i+1),c=n*i*2*3,h=new THREE.BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),d=new THREE.BufferAttribute(new Float32Array(3*u),3),p=new THREE.BufferAttribute(new Float32Array(3*u),3),f=new THREE.BufferAttribute(new Float32Array(2*u),2),m=0,g=0,y=new THREE.Vector3,v=new THREE.Vector3,E=new THREE.Vector2,T=new THREE.Vector3,b=new THREE.Vector3,C=new THREE.Vector3,O=new THREE.Vector3,x=new THREE.Vector3;for(a=0;a<=i;++a){var w=a/i*r*Math.PI*2;for(s(w,r,o,e,T),s(w+.01,r,o,e,b),O.subVectors(b,T),x.addVectors(b,T),C.crossVectors(O,x),x.crossVectors(C,O),C.normalize(),x.normalize(),l=0;l<=n;++l){var R=l/n*Math.PI*2,L=-t*Math.cos(R),S=t*Math.sin(R);y.x=T.x+(L*x.x+S*C.x),y.y=T.y+(L*x.y+S*C.y),y.z=T.z+(L*x.z+S*C.z),d.setXYZ(m,y.x,y.y,y.z),v.subVectors(y,T).normalize(),p.setXYZ(m,v.x,v.y,v.z),E.x=a/i,E.y=l/n,f.setXY(m,E.x,E.y),m++}}for(l=1;l<=i;l++)for(a=1;a<=n;a++){var _=(n+1)*(l-1)+(a-1),I=(n+1)*l+(a-1),D=(n+1)*l+a,M=(n+1)*(l-1)+a;h.setX(g,_),g++,h.setX(g,I),g++,h.setX(g,M),g++,h.setX(g,I),g++,h.setX(g,D),g++,h.setX(g,M),g++}this.setIndex(h),this.addAttribute("position",d),this.addAttribute("normal",p),this.addAttribute("uv",f)},THREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry,THREE.TorusKnotGeometry=function(e,t,i,n,r,o,s){THREE.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(e,t,i,n,r,o)),this.mergeVertices()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,i,n,r,o){function s(e,t,i){return _.vertices.push(new THREE.Vector3(e,t,i))-1}THREE.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:i,radialSegments:n,closed:r,taper:o},t=t||64,i=i||1,n=n||8,r=r||!1,o=o||THREE.TubeGeometry.NoTaper;var a,l,u,c,h,d,p,f,m,g,y,v,E,T,b,C,O,x,w,R,L,S=[],_=this,I=t+1,D=new THREE.Vector3,M=new THREE.TubeGeometry.FrenetFrames(e,t,r),A=M.tangents,N=M.normals,P=M.binormals;for(this.tangents=A,this.normals=N,this.binormals=P,g=0;g<I;g++)for(S[g]=[],c=g/(I-1),m=e.getPointAt(c),a=A[g],l=N[g],u=P[g],d=i*o(c),y=0;y<n;y++)h=y/n*2*Math.PI,p=-d*Math.cos(h),f=d*Math.sin(h),D.copy(m),D.x+=p*l.x+f*u.x,D.y+=p*l.y+f*u.y,D.z+=p*l.z+f*u.z,S[g][y]=s(D.x,D.y,D.z);for(g=0;g<t;g++)for(y=0;y<n;y++)v=r?(g+1)%t:g+1,E=(y+1)%n,T=S[g][y],b=S[v][y],C=S[v][E],O=S[g][E],x=new THREE.Vector2(g/t,y/n),w=new THREE.Vector2((g+1)/t,y/n),R=new THREE.Vector2((g+1)/t,(y+1)/n),L=new THREE.Vector2(g/t,(y+1)/n),this.faces.push(new THREE.Face3(T,b,O)),this.faceVertexUvs[0].push([x,w,L]),this.faces.push(new THREE.Face3(b,C,O)),this.faceVertexUvs[0].push([w.clone(),R,L.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.NoTaper=function(e){return 1},THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},THREE.TubeGeometry.FrenetFrames=function(e,t,i){function n(){p[0]=new THREE.Vector3,f[0]=new THREE.Vector3,o=Number.MAX_VALUE,s=Math.abs(d[0].x),a=Math.abs(d[0].y),l=Math.abs(d[0].z),s<=o&&(o=s,h.set(1,0,0)),a<=o&&(o=a,h.set(0,1,0)),l<=o&&h.set(0,0,1),m.crossVectors(d[0],h).normalize(),p[0].crossVectors(d[0],m),f[0].crossVectors(d[0],p[0])}var r,o,s,a,l,u,c,h=new THREE.Vector3,d=[],p=[],f=[],m=new THREE.Vector3,g=new THREE.Matrix4,y=t+1;for(this.tangents=d,this.normals=p,this.binormals=f,u=0;u<y;u++)c=u/(y-1),d[u]=e.getTangentAt(c),d[u].normalize();for(n(),u=1;u<y;u++)p[u]=p[u-1].clone(),f[u]=f[u-1].clone(),m.crossVectors(d[u-1],d[u]),m.length()>Number.EPSILON&&(m.normalize(),r=Math.acos(THREE.Math.clamp(d[u-1].dot(d[u]),-1,1)),p[u].applyMatrix4(g.makeRotationAxis(m,r))),f[u].crossVectors(d[u],p[u]);if(i)for(r=Math.acos(THREE.Math.clamp(p[0].dot(p[y-1]),-1,1)),r/=y-1,d[0].dot(m.crossVectors(p[0],p[y-1]))>0&&(r=-r),u=1;u<y;u++)p[u].applyMatrix4(g.makeRotationAxis(d[u],r*u)),f[u].crossVectors(d[u],p[u])},THREE.PolyhedronGeometry=function(e,t,i,n){function r(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var i=a(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-n),t}function o(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);c.faces.push(n),E.copy(e).add(t).add(i).divideScalar(3);var r=a(E);c.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(i.uv,i,r)])}function s(e,t){for(var i=Math.pow(2,t),n=r(c.vertices[e.a]),s=r(c.vertices[e.b]),a=r(c.vertices[e.c]),l=[],u=0;u<=i;u++){l[u]=[];for(var h=r(n.clone().lerp(a,u/i)),d=r(s.clone().lerp(a,u/i)),p=i-u,f=0;f<=p;f++)0===f&&u===i?l[u][f]=h:l[u][f]=r(h.clone().lerp(d,f/p))}for(var u=0;u<i;u++)for(var f=0;f<2*(i-u)-1;f++){var m=Math.floor(f/2);f%2===0?o(l[u][m+1],l[u+1][m],l[u][m]):o(l[u][m+1],l[u+1][m+1],l[u+1][m])}}function a(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function u(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0;for(var c=this,h=0,d=e.length;h<d;h+=3)r(new THREE.Vector3(e[h],e[h+1],e[h+2]));for(var p=this.vertices,f=[],h=0,m=0,d=t.length;h<d;h+=3,m++){var g=p[t[h]],y=p[t[h+1]],v=p[t[h+2]];f[m]=new THREE.Face3(g.index,y.index,v.index,[g.clone(),y.clone(),v.clone()])}for(var E=new THREE.Vector3,h=0,d=f.length;h<d;h++)s(f[h],n);for(var h=0,d=this.faceVertexUvs[0].length;h<d;h++){var T=this.faceVertexUvs[0][h],b=T[0].x,C=T[1].x,O=T[2].x,x=Math.max(b,C,O),w=Math.min(b,C,O);x>.9&&w<.1&&(b<.2&&(T[0].x+=1),C<.2&&(T[1].x+=1),O<.2&&(T[2].x+=1))}for(var h=0,d=this.vertices.length;h<d;h++)this.vertices[h].multiplyScalar(i);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.DodecahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry,THREE.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,n,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,i){THREE.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};var n,r,o,s,a,l=this.vertices,u=this.faces,c=this.faceVertexUvs[0],h=t+1;for(n=0;n<=i;n++)for(a=n/i,r=0;r<=t;r++)s=r/t,o=e(s,a),l.push(o);var d,p,f,m,g,y,v,E;for(n=0;n<i;n++)for(r=0;r<t;r++)d=n*h+r,p=n*h+r+1,f=(n+1)*h+r+1,m=(n+1)*h+r,g=new THREE.Vector2(r/t,n/i),y=new THREE.Vector2((r+1)/t,n/i),v=new THREE.Vector2((r+1)/t,(n+1)/i),E=new THREE.Vector2(r/t,(n+1)/i),u.push(new THREE.Face3(d,p,m)),c.push([g,y,E]),u.push(new THREE.Face3(p,f,m)),c.push([y.clone(),v,E.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.WireframeGeometry=function(e){function t(e,t){return e-t}THREE.BufferGeometry.call(this);var i=[0,0],n={},r=["a","b","c"];if(e instanceof THREE.Geometry){for(var o=e.vertices,s=e.faces,a=0,l=new Uint32Array(6*s.length),u=0,c=s.length;u<c;u++)for(var h=s[u],d=0;d<3;d++){i[0]=h[r[d]],i[1]=h[r[(d+1)%3]],i.sort(t);var p=i.toString();void 0===n[p]&&(l[2*a]=i[0],l[2*a+1]=i[1],n[p]=!0,a++)}for(var f=new Float32Array(2*a*3),u=0,c=a;u<c;u++)for(var d=0;d<2;d++){var m=o[l[2*u+d]],g=6*u+3*d;f[g+0]=m.x,f[g+1]=m.y,f[g+2]=m.z}this.addAttribute("position",new THREE.BufferAttribute(f,3))}else if(e instanceof THREE.BufferGeometry)if(null!==e.index){var y=e.index.array,o=e.attributes.position,v=e.groups,a=0;0===v.length&&e.addGroup(0,y.length);for(var l=new Uint32Array(2*y.length),E=0,T=v.length;E<T;++E)for(var b=v[E],C=b.start,O=b.count,u=C,x=C+O;u<x;u+=3)for(var d=0;d<3;d++){i[0]=y[u+d],i[1]=y[u+(d+1)%3],i.sort(t);var p=i.toString();void 0===n[p]&&(l[2*a]=i[0],l[2*a+1]=i[1],n[p]=!0,a++)}for(var f=new Float32Array(2*a*3),u=0,c=a;u<c;u++)for(var d=0;d<2;d++){var g=6*u+3*d,w=l[2*u+d];f[g+0]=o.getX(w),f[g+1]=o.getY(w),f[g+2]=o.getZ(w)}this.addAttribute("position",new THREE.BufferAttribute(f,3))}else{for(var o=e.attributes.position.array,a=o.length/3,R=a/3,f=new Float32Array(2*a*3),u=0,c=R;u<c;u++)for(var d=0;d<3;d++){var g=18*u+6*d,L=9*u+3*d;f[g+0]=o[L],f[g+1]=o[L+1],f[g+2]=o[L+2];var w=9*u+3*((d+1)%3);f[g+3]=o[w],f[g+4]=o[w+1],f[g+5]=o[w+2]}this.addAttribute("position",new THREE.BufferAttribute(f,3))}},THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry,THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.BufferAttribute(t,3)),n.addAttribute("color",new THREE.BufferAttribute(i,3));var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,n,r)},THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(){var e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var t=new THREE.CylinderBufferGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(i,n,r,o,s,a){THREE.Object3D.call(this),void 0===o&&(o=16776960),void 0===r&&(r=1),void 0===s&&(s=.2*r),void 0===a&&(a=.2*s),this.position.copy(n),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(r,s,a)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},THREE.BoxHelper=function(e,t){void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new THREE.BufferGeometry;r.setIndex(new THREE.BufferAttribute(i,1)),r.addAttribute("position",new THREE.BufferAttribute(n,3)),THREE.LineSegments.call(this,r,new THREE.LineBasicMaterial({color:t})),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.BoxHelper.prototype.constructor=THREE.BoxHelper,THREE.BoxHelper.prototype.update=function(){var e=new THREE.Box3;return function(t){if(t instanceof THREE.Box3?e.copy(t):e.setFromObject(t),!e.isEmpty()){var i=e.min,n=e.max,r=this.geometry.attributes.position,o=r.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=i.x,o[4]=n.y,o[5]=n.z,o[6]=i.x,o[7]=i.y,o[8]=n.z,o[9]=n.x,o[10]=i.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=i.z,o[15]=i.x,o[16]=n.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=n.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),THREE.BoundingBoxHelper=function(e,t){var i=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:i,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper,THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){n.vertices.push(new THREE.Vector3),n.colors.push(new THREE.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={},s=16755200,a=16711680,l=43775,u=16777215,c=3355443;t("n1","n2",s),t("n2","n4",s),t("n4","n3",s),t("n3","n1",s),t("f1","f2",s),t("f2","f4",s),t("f4","f3",s),t("f3","f1",s),t("n1","f1",s),t("n2","f2",s),t("n3","f3",s),t("n4","f4",s),t("p","n1",a),t("p","n2",a),t("p","n3",a),t("p","n4",a),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",u),t("p","c",c),t("cn1","cn2",c),t("cn3","cn4",c),t("cf1","cf2",c),t("cf3","cf4",c),THREE.LineSegments.call(this,n,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,o,s,a){n.set(o,s,a).unproject(r);var l=i[e];if(void 0!==l)for(var u=0,c=l.length;u<c;u++)t.vertices[l[u]].copy(n)}var t,i,n=new THREE.Vector3,r=new THREE.Camera;return function(){t=this.geometry,i=this.pointMap;var n=1,o=1;r.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-n,-o,-1),e("n2",n,-o,-1),e("n3",-n,o,-1),e("n4",n,o,-1),e("f1",-n,-o,1),e("f2",n,-o,1),e("f3",-n,o,1),e("f4",n,o,1),e("u1",.7*n,1.1*o,-1),e("u2",.7*-n,1.1*o,-1),e("u3",0,2*o,-1),e("cf1",-n,0,1),e("cf2",n,0,1),e("cf3",0,-o,1),e("cf4",0,o,1),e("cn1",-n,0,-1),e("cn2",n,0,-1),e("cn3",0,-o,-1),e("cn4",0,o,-1),t.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,void 0===t&&(t=1);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32Attribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new THREE.LineBasicMaterial({fog:!1});this.add(new THREE.Line(i,n)),i=new THREE.BufferGeometry,i.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3)),this.add(new THREE.Line(i,n)),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper,THREE.DirectionalLightHelper.prototype.dispose=function(){var e=this.children[0],t=this.children[1];e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e);var n=this.children[0],r=this.children[1];n.lookAt(i),n.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),r.lookAt(i),r.scale.z=i.length()}}(),THREE.EdgesHelper=function(e,t,i){var n=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(e.geometry,i),new THREE.LineBasicMaterial({color:n})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper,THREE.FaceNormalsHelper=function(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a instanceof THREE.Geometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new THREE.BufferGeometry,u=new THREE.Float32Attribute(2*s*3,3);l.addAttribute("position",u),THREE.LineSegments.call(this,l,new THREE.LineBasicMaterial({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper,THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,u=0,c=a.length;u<c;u++){var h=a[u],d=h.normal;e.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),r.setXYZ(l,e.x,e.y,e.z),l+=1,r.setXYZ(l,t.x,t.y,t.z),l+=1}return r.needsUpdate=!0,this}}(),THREE.GridHelper=function(e,t,i,n){i=new THREE.Color(void 0!==i?i:4473924),n=new THREE.Color(void 0!==n?n:8947848);for(var r=[],o=[],s=-e,a=0;s<=e;s+=t){r.push(-e,0,s,e,0,s),r.push(s,0,-e,s,0,e);var l=0===s?i:n;l.toArray(o,a),a+=3,l.toArray(o,a),a+=3,l.toArray(o,a),a+=3,l.toArray(o,a),a+=3}var u=new THREE.BufferGeometry;u.addAttribute("position",new THREE.Float32Attribute(r,3)),u.addAttribute("color",new THREE.Float32Attribute(o,3));var c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,u,c)},THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.GridHelper.prototype.constructor=THREE.GridHelper,THREE.GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var i=new THREE.SphereGeometry(t,4,2);i.rotateX(-Math.PI/2);for(var n=0,r=8;n<r;n++)i.faces[n].color=this.colors[n<4?0:1];var o=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(i,o),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper,THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new THREE.SphereBufferGeometry(t,4,2),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper,THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new THREE.Geometry,i=0;i<this.bones.length;i++){var n=this.bones[i];n.parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}t.dynamic=!0;var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,t,r),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper,THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),i=new THREE.Matrix4,n=0,r=0;r<this.bones.length;r++){var o=this.bones[r];o.parent instanceof THREE.Bone&&(i.multiplyMatrices(t,o.matrixWorld),e.vertices[n].setFromMatrixPosition(i),i.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(i),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;for(var t=new THREE.BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,r=1,o=32;n<o;n++,r++){var s=n/o*Math.PI*2,a=r/o*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}t.addAttribute("position",new THREE.Float32Attribute(i,3));var l=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(t,l),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper,THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a instanceof THREE.Geometry?s=3*a.faces.length:a instanceof THREE.BufferGeometry&&(s=a.attributes.normal.count);var l=new THREE.BufferGeometry,u=new THREE.Float32Attribute(2*s*3,3);l.addAttribute("position",u),THREE.LineSegments.call(this,l,new THREE.LineBasicMaterial({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper,THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Matrix3;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s instanceof THREE.Geometry)for(var a=s.vertices,l=s.faces,u=0,c=0,h=l.length;c<h;c++)for(var d=l[c],p=0,f=d.vertexNormals.length;p<f;p++){var m=a[d[n[p]]],g=d.vertexNormals[p];e.copy(m).applyMatrix4(r),t.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}else if(s instanceof THREE.BufferGeometry)for(var y=s.attributes.position,v=s.attributes.normal,u=0,p=0,f=y.count;p<f;p++)e.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(r),t.set(v.getX(p),v.getY(p),v.getZ(p)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1;return o.needsUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var i=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(e.geometry),new THREE.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper,THREE.ImmediateRenderObject=function(e){
THREE.Object3D.call(this),this.material=e,this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n="__default",r=0,o=i-1,s=i/1;this.createAnimation(n,r,o,s),this.setAnimationWeight(n,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){var r={start:t,end:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\d+)/i,n={},r=this.geometry,o=0,s=r.morphTargets.length;o<s;o++){var a=r.morphTargets[o],l=a.name.match(i);if(l&&l.length>1){var u=l[1];n[u]||(n[u]={start:1/0,end:-(1/0)});var c=n[u];o<c.start&&(c.start=o),o>c.end&&(c.end=o),t||(t=u)}}for(var u in n){var c=n[u];this.createAnimation(u,c.start,c.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+THREE.Math.clamp(Math.floor(n.time/r),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%r/r;n.directionBackwards&&(a=1-a),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s):this.morphTargetInfluences[n.currentFrame]=s}}};var THREEx=THREEx||{};if(THREEx.RendererStats=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var t=document.createElement("div");t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;",e.appendChild(t);var i=document.createElement("div");i.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="WebGLRenderer",t.appendChild(i);for(var n=[],r=9,o=0;o<r;o++)n[o]=document.createElement("div"),n[o].style.cssText="color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",t.appendChild(n[o]),n[o].innerHTML="-";var s=Date.now();return{domElement:e,update:function(e){if(console.assert(e instanceof THREE.WebGLRenderer),!(Date.now()-s<1e3/30)){s=Date.now();var t=0;n[t++].textContent="== Memory =====",n[t++].textContent="Programs: "+e.info.memory.programs,n[t++].textContent="Geometries: "+e.info.memory.geometries,n[t++].textContent="Textures: "+e.info.memory.textures,n[t++].textContent="== Render =====",n[t++].textContent="Calls: "+e.info.render.calls,n[t++].textContent="Vertices: "+e.info.render.vertices,n[t++].textContent="Faces: "+e.info.render.faces,n[t++].textContent="Points: "+e.info.render.points}}}},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=earcut),earcut.deviation=function(e,t,i,n){var r=t&&t.length,o=r?t[0]*i:e.length,s=Math.abs(signedArea(e,0,o,i));if(r)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(signedArea(e,u,c,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,f=n[a+2]*i;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},earcut.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[r][o][s]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i},!window.THREE)throw new Error("ERROR: three.js not loaded");THREE.Triangulation=function(){function e(){t(s),o.enabled?(THREE.ShapeUtils.triangulate=function(){return l[s].triangulate.apply(this,arguments)},THREE.ShapeUtils.triangulateShape=function(){o.start=Date.now();var e=l[s].triangulateShape.apply(this,arguments);return o.end=Date.now(),console.log("%c "+s+": "+(o.end-o.start)+"ms","color: #0000ff"),e}):(THREE.ShapeUtils.triangulate=l[s].triangulate,THREE.ShapeUtils.triangulateShape=l[s].triangulateShape)}function t(e){switch(e){case a.earcut:if(!window.earcut)throw new Error("ERROR: earcut not loaded");break;case a.poly2tri:if(!window.poly2tri)throw new Error("ERROR: poly2tri not loaded");break;case a.libtess:if(!window.tessy)throw new Error("ERROR: libtess not loaded")}}function i(t){if(!a.hasOwnProperty(t))throw new Error("ERROR: unknown library "+t);s=t,e()}function n(t){o.enabled=t,e()}function r(){return!!o.enabled&&o.end-o.start}var o={enabled:!1,start:null,end:null},s="original",a={original:"original",earcut:"earcut",poly2tri:"poly2tri",libtess:"libtess"},l={};return l[a.original]={triangulate:THREE.ShapeUtils.triangulate,triangulateShape:THREE.ShapeUtils.triangulateShape},l[a.earcut]={triangulateShape:function(e,t){function i(e){var t,i=e.length;for(t=0;t<i;t++)l.push(e[t].x,e[t].y)}var n,r,o,s=2,a=[],l=[];for(i(e),n=0,r=t.length;n<r;n++)a.push(l.length/s),i(t[n]);o=earcut(l,a,s);var u=[];for(n=0,r=o.length;n<r;n+=3)u.push(o.slice(n,n+3));return u}},l[a.poly2tri]={triangulateShape:function(e,t){function i(e){var t,i=e.length,n=[];for(t=0;t<i;t++)n.push(new poly2tri.Point(e[t].x,e[t].y)),l[e[t].x+","+e[t].y]=u,u++;return n}var n,r,o,s,a,l={},u=0;for(p=i(e),s=new poly2tri.SweepContext(p),n=0,r=t.length;n<r;n++)p=i(t[n]),s.addHole(p),p=p.concat(p);o=s.triangulate(),a=o.triangles_;var c,h,d,p,f=[];for(n=0,r=a.length;n<r;n++)p=a[n].points_,c=l[p[0].x+","+p[0].y],h=l[p[1].x+","+p[1].y],d=l[p[2].x+","+p[2].y],f.push([c,h,d]);return f}},l[a.libtess]={triangulateShape:function(e,t){function i(e){var t,i,n=e.length;for(tessy.gluTessBeginContour(),t=0;t<n;t++)i=[e[t].x,e[t].y,0],tessy.gluTessVertex(i,i),s[e[t].x+","+e[t].y]=a,a++;return tessy.gluTessEndContour(),h}var n,r,o=[],s={},a=0;for(tessy.gluTessNormal(0,0,1),tessy.gluTessBeginPolygon(o),h=i(e),n=0,r=t.length;n<r;n++)h=i(t[n]);tessy.gluTessEndPolygon();var l,u,c,h,d=[];for(n=0,r=o.length;n<r;n+=6)l=s[o[n]+","+o[n+1]],u=s[o[n+2]+","+o[n+3]],c=s[o[n+4]+","+o[n+5]],d.push([l,u,c]);return d}},e(),{libraries:a,setTimer:n,getTime:r,setLibrary:i}}(),Potree.workers={},Potree.Shaders={},Potree.WorkerManager=function(e){this.code=e,this.instances=[],this.createdInstances=0},Potree.WorkerManager.prototype.getWorker=function(){var e=this.instances.pop();return void 0===e&&(e=Potree.utils.createWorker(this.code),this.createdInstances++),e},Potree.WorkerManager.prototype.returnWorker=function(e){this.instances.push(e)},Potree.WorkerManager.fromUrls=function(e){for(var t="",i=0;i<e.length;i++){var n=e[i],r=new XMLHttpRequest;r.open("GET",n,!1),r.responseType="text",r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),200===r.status&&(t+=r.responseText+"\n")}return new Potree.WorkerManager(t)},Potree.workers.binaryDecoder=new Potree.WorkerManager(atob("KGZ1bmN0aW9uIChmYWN0b3J5KSB7DQogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgew0KICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuDQogICAgICAgIGRlZmluZShbXSwgZmFjdG9yeSk7DQogICAgfSBlbHNlIGZhY3RvcnkoKTsNCn0pKGZ1bmN0aW9uKCkgew0KICAgICJ1c2Ugc3RyaWN0IjsNCiAgICAvLyB4IHwgMCBpcyB0aGUgc2ltcGxlc3Qgd2F5IHRvIGltcGxlbWVudCBUb1VpbnQzMih4KQ0KICAgIHZhciBNID0gTWF0aCwNCiAgICAgICAgTiA9IE51bWJlciwNCiAgICAgICAgcHJvcCwgZGVmID0gT2JqZWN0LmRlZmluZVByb3BlcnR5LA0KICAgICAgICBtYXRoWHRyYSA9IHsNCiAgICAgICAgICAgIC8vIEh5cGVyYm9saWMgZnVuY3Rpb25zDQogICAgICAgICAgICBzaW5oOiBmdW5jdGlvbiBzaW5oKHgpIHsNCiAgICAgICAgICAgICAgICAvLyBJZiAtMCwgbXVzdCByZXR1cm4gLTAuDQogICAgICAgICAgICAgICAgaWYgKHggPT09IDApIHJldHVybiB4Ow0KICAgICAgICAgICAgICAgIHZhciBleHAgPSBNLmV4cCh4KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZXhwLzIgLSAuNS9leHA7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY29zaDogZnVuY3Rpb24gY29zaCh4KSB7DQogICAgICAgICAgICAgICAgdmFyIGV4cCA9IE0uZXhwKHgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBleHAvMiArIC41L2V4cDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB0YW5oOiBmdW5jdGlvbiB0YW5oKHgpIHsNCiAgICAgICAgICAgICAgICAvLyBJZiAtMCwgbXVzdCByZXR1cm4gLTAuDQogICAgICAgICAgICAgICAgaWYgKHggPT09IDApIHJldHVybiB4Ow0KICAgICAgICAgICAgICAgIC8vIE1hdGhlbWF0aWNhbGx5IHNwZWFraW5nLCB0aGUgZm9ybXVsYWUgYXJlIGVxdWl2YWxlbnQuDQogICAgICAgICAgICAgICAgLy8gQnV0IGNvbXB1dGF0aW9uYWxseSwgaXQncyBiZXR0ZXIgdG8gbWFrZSBleHAgdGVuZCB0byAwDQogICAgICAgICAgICAgICAgLy8gcmF0aGVyIHRoYW4gK0luZmluaXR5DQogICAgICAgICAgICAgICAgaWYgKHggPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBleHAgPSBNLmV4cCgyICogeCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoZXhwIC0gMSkgLyAoZXhwICsgMSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cCA9IE0uZXhwKC0yICogeCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMSAtIGV4cCkgLyAoMSArIGV4cCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFzaW5oOiBmdW5jdGlvbiBhc2luaCh4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHggPT09IC1JbmZpbml0eSA/IC1JbmZpbml0eSA6IE0ubG9nKHggKyBNLnNxcnQoeCAqIHggKyAxKSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYWNvc2g6IGZ1bmN0aW9uIGFjb3NoKHgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4geCA+PSAxID8gTS5sb2coeCArIE0uc3FydCh4ICogeCAtIDEpKSA6IE5hTjsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhdGFuaDogZnVuY3Rpb24gYXRhbmgoeCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB4ID49IC0xICYmIHggPD0gMSA/IE0ubG9nKCgxICsgeCkgLyAoMSAtIHgpKSAvIDIgOiBOYU47DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAvLyBFeHBvbmVudGlhbHMgYW5kIGxvZ2FyaXRobXMNCiAgICAgICAgICAgIGV4cG0xOiBmdW5jdGlvbiBleHBtMSh4KSB7DQogICAgICAgICAgICAgICAgLy8gSWYgLTAsIG11c3QgcmV0dXJuIC0wLiBCdXQgTWF0aC5leHAoLTApIC0gMSB5aWVsZHMgKzAuDQogICAgICAgICAgICAgICAgcmV0dXJuIHggPT09IDAgPyB4IDogTS5leHAoeCkgLSAxOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvZzEwOiBmdW5jdGlvbiBsb2cxMCh4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE0ubG9nKHgpIC8gTS5MTjEwOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvZzI6IGZ1bmN0aW9uIGxvZzIoeCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNLmxvZyh4KSAvIE0uTE4yOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvZzFwOiBmdW5jdGlvbiBsb2cxcCh4KSB7DQogICAgICAgICAgICAgICAgLy8gSWYgLTAsIG11c3QgcmV0dXJuIC0wLiBCdXQgTWF0aC5sb2coMSArIC0wKSB5aWVsZHMgKzAuDQogICAgICAgICAgICAgICAgcmV0dXJuIHggPT09IDAgPyB4IDogTS5sb2coMSArIHgpOw0KICAgICAgICAgICAgfSwNCg0KICAgICAgICAgICAgLy8gVmFyaW91cw0KICAgICAgICAgICAgc2lnbjogZnVuY3Rpb24gc2lnbih4KSB7DQogICAgICAgICAgICAgICAgLy8gSWYgLTAsIG11c3QgcmV0dXJuIC0wLg0KICAgICAgICAgICAgICAgIHJldHVybiBpc05hTih4KSA/IE5hTiA6IHggPCAwID8gLTEgOiB4ID4gMCA/IDEgOiAreDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjYnJ0OiBmdW5jdGlvbiBjYnJ0KHgpIHsNCiAgICAgICAgICAgICAgICAvLyBJZiAtMCwgbXVzdCByZXR1cm4gLTAuDQogICAgICAgICAgICAgICAgcmV0dXJuIHggPT09IDAgPyB4IDogeCA8IDAgPyAtTS5wb3coLXgsIDEvMykgOiBNLnBvdyh4LCAxLzMpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGh5cG90OiBmdW5jdGlvbiBoeXBvdCh2YWx1ZTEsIHZhbHVlMikgeyAvLyBNdXN0IGhhdmUgYSBsZW5ndGggb2YgMg0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBzID0gMCwgYXJncyA9IGFyZ3VtZW50czsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgICAgIHMgKz0gYXJnc1tpXSAqIGFyZ3NbaV07DQogICAgICAgICAgICAgICAgcmV0dXJuIE0uc3FydChzKTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8vIFJvdW5kaW5nIGFuZCAzMi1iaXQgb3BlcmF0aW9ucw0KICAgICAgICAgICAgdHJ1bmM6IGZ1bmN0aW9uIHRydW5jKHgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4geCA9PT0gMCA/IHggOiB4IDwgMCA/IE0uY2VpbCh4KSA6IE0uZmxvb3IoeCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZnJvdW5kOiB0eXBlb2YgRmxvYXQzMkFycmF5ID09PSAiZnVuY3Rpb24iDQogICAgICAgICAgICAgICAgICAgID8gKGZ1bmN0aW9uKGFycikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZyb3VuZCh4KSB7IHJldHVybiBhcnJbMF0gPSB4LCBhcnJbMF07IH07DQogICAgICAgICAgICAgICAgICAgIH0pKG5ldyBGbG9hdDMyQXJyYXkoMSkpDQogICAgICAgICAgICAgICAgICAgIDogZnVuY3Rpb24gZnJvdW5kKHgpIHsgcmV0dXJuIHg7IH0sDQoNCiAgICAgICAgICAgIGNsejMyOiBmdW5jdGlvbiBjbHozMih4KSB7DQogICAgICAgICAgICAgICAgaWYgKHggPT09IC1JbmZpbml0eSkgcmV0dXJuIDMyOw0KICAgICAgICAgICAgICAgIGlmICh4IDwgMCB8fCAoeCB8PSAwKSA8IDApIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIGlmICgheCkgcmV0dXJuIDMyOw0KICAgICAgICAgICAgICAgIHZhciBpID0gMzE7DQogICAgICAgICAgICAgICAgd2hpbGUgKHggPj49IDEpIGktLTsNCiAgICAgICAgICAgICAgICByZXR1cm4gaTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBpbXVsOiBmdW5jdGlvbiBpbXVsKHgsIHkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKHggfCAwKSAqICh5IHwgMCkgfCAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBudW1YdHJhID0gew0KICAgICAgICAgICAgaXNOYU46IGZ1bmN0aW9uIGlzTmFOKHgpIHsNCiAgICAgICAgICAgICAgICAvLyBOYU4gaXMgdGhlIG9ubHkgSmF2YXNjcmlwdCBvYmplY3Qgc3VjaCB0aGF0IHggIT09IHgNCiAgICAgICAgICAgICAgICAvLyBUaGUgY29udHJvbCBvbiB0aGUgdHlwZSBpcyBmb3IgZXZlbnR1YWwgaG9zdCBvYmplY3RzDQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAibnVtYmVyIiAmJiB4ICE9PSB4Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGlzRmluaXRlOiBmdW5jdGlvbiBpc0Zpbml0ZSh4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAibnVtYmVyIiAmJiB4ID09PSB4ICYmIHggIT09IEluZmluaXR5ICYmIHggIT09IC1JbmZpbml0eTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBpc0ludGVnZXI6IGZ1bmN0aW9uIGlzSW50ZWdlcih4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAibnVtYmVyIiAmJiB4ICE9PSBJbmZpbml0eSAmJiB4ICE9PSAtSW5maW5pdHkgJiYgTS5mbG9vcih4KSA9PT0geDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBpc1NhZmVJbnRlZ2VyOiBmdW5jdGlvbiBpc1NhZmVJbnRlZ2VyKHgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHggPT09ICJudW1iZXIiICYmIHggPiAtOTAwNzE5OTI1NDc0MDk5MiAmJiB4IDwgOTAwNzE5OTI1NDc0MDk5MiAmJiBNLmZsb29yKHgpID09PSB4Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHBhcnNlRmxvYXQ6IHBhcnNlRmxvYXQsDQogICAgICAgICAgICBwYXJzZUludDogcGFyc2VJbnQNCiAgICAgICAgfSwNCiAgICAgICAgbnVtQ29uc3RzID0gew0KICAgICAgICAgICAgRVBTSUxPTjogMi4yMjA0NDYwNDkyNTAzMTMwODA4NDcyNjMzMzYxODE2ZS0xNiwNCiAgICAgICAgICAgIE1BWF9TQUZFX0lOVEVHRVI6IDkwMDcxOTkyNTQ3NDA5OTEsDQogICAgICAgICAgICBNSU5fU0FGRV9JTlRFR0VSOiAtOTAwNzE5OTI1NDc0MDk5MQ0KICAgICAgICB9Ow0KDQogICAgZm9yIChwcm9wIGluIG1hdGhYdHJhKQ0KICAgICAgICBpZiAodHlwZW9mIE1bcHJvcF0gIT09ICJmdW5jdGlvbiIpDQogICAgICAgICAgICBNW3Byb3BdID0gbWF0aFh0cmFbcHJvcF07DQoNCiAgICBmb3IgKHByb3AgaW4gbnVtWHRyYSkNCiAgICAgICAgaWYgKHR5cGVvZiBOW3Byb3BdICE9PSAiZnVuY3Rpb24iKQ0KICAgICAgICAgICAgTltwcm9wXSA9IG51bVh0cmFbcHJvcF07DQoNCiAgICB0cnkgew0KICAgICAgICBwcm9wID0ge307DQogICAgICAgIGRlZihwcm9wLCAwLCB7fSk7DQogICAgICAgIGZvciAocHJvcCBpbiBudW1Db25zdHMpDQogICAgICAgICAgICBpZiAoIShwcm9wIGluIE4pKQ0KICAgICAgICAgICAgICAgIGRlZihOLCBwcm9wLCB7dmFsdWU6IG51bUNvbnN0c1twcm9wXX0pOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgZm9yIChwcm9wIGluIG51bUNvbnN0cykNCiAgICAgICAgICAgIGlmICghKHByb3AgaW4gTikpDQogICAgICAgICAgICAgICAgTltwcm9wXSA9IG51bUNvbnN0c1twcm9wXTsNCiAgICB9DQp9KTsKLy8gaHR0cDovL2pzcGVyZi5jb20vdWludDhhcnJheS12cy1kYXRhdmlldzMvMwpmdW5jdGlvbiBDdXN0b21WaWV3KGJ1ZmZlcikgewoJdGhpcy5idWZmZXIgPSBidWZmZXI7Cgl0aGlzLnU4ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKCQoJdmFyIHRtcCA9IG5ldyBBcnJheUJ1ZmZlcig0KTsKCXZhciB0bXBmID0gbmV3IEZsb2F0MzJBcnJheSh0bXApOwoJdmFyIHRtcHU4ID0gbmV3IFVpbnQ4QXJyYXkodG1wKTsKCQoJdGhpcy5nZXRVaW50MzIgPSBmdW5jdGlvbiAoaSkgewoJCXJldHVybiAodGhpcy51OFtpKzNdIDw8IDI0KSB8ICh0aGlzLnU4W2krMl0gPDwgMTYpIHwgKHRoaXMudThbaSsxXSA8PCA4KSB8IHRoaXMudThbaV07Cgl9OwoJCgl0aGlzLmdldFVpbnQxNiA9IGZ1bmN0aW9uIChpKSB7CgkJcmV0dXJuICh0aGlzLnU4W2krMV0gPDwgOCkgfCB0aGlzLnU4W2ldOwoJfTsKCQoJdGhpcy5nZXRGbG9hdCA9IGZ1bmN0aW9uKGkpewoJCXRtcHU4WzBdID0gdGhpcy51OFtpKzBdOwoJCXRtcHU4WzFdID0gdGhpcy51OFtpKzFdOwoJCXRtcHU4WzJdID0gdGhpcy51OFtpKzJdOwoJCXRtcHU4WzNdID0gdGhpcy51OFtpKzNdOwoJCQoJCXJldHVybiB0bXBmWzBdOwoJfTsKCQoJdGhpcy5nZXRVaW50OCA9IGZ1bmN0aW9uKGkpewoJCXJldHVybiB0aGlzLnU4W2ldOwoJfTsKfQoKUG90cmVlID0ge307CgoKb25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpewoJdmFyIGJ1ZmZlciA9IGV2ZW50LmRhdGEuYnVmZmVyOwoJdmFyIHBvaW50QXR0cmlidXRlcyA9IGV2ZW50LmRhdGEucG9pbnRBdHRyaWJ1dGVzOwoJdmFyIG51bVBvaW50cyA9IGJ1ZmZlci5ieXRlTGVuZ3RoIC8gcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplOwoJdmFyIGN2ID0gbmV3IEN1c3RvbVZpZXcoYnVmZmVyKTsKCXZhciB2ZXJzaW9uID0gbmV3IFBvdHJlZS5WZXJzaW9uKGV2ZW50LmRhdGEudmVyc2lvbik7Cgl2YXIgbWluID0gZXZlbnQuZGF0YS5taW47Cgl2YXIgbm9kZU9mZnNldCA9IGV2ZW50LmRhdGEub2Zmc2V0OwoJdmFyIHNjYWxlID0gZXZlbnQuZGF0YS5zY2FsZTsKCXZhciB0aWdodEJveE1pbiA9IFsgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIE51bWJlci5QT1NJVElWRV9JTkZJTklUWV07Cgl2YXIgdGlnaHRCb3hNYXggPSBbIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSAsIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSAsIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdOwoJCgl2YXIgYXR0cmlidXRlQnVmZmVycyA9IHt9OwoJCgl2YXIgb2Zmc2V0ID0gMDsKCWZvcih2YXIgaSA9IDA7IGkgPCBwb2ludEF0dHJpYnV0ZXMuYXR0cmlidXRlcy5sZW5ndGg7IGkrKyl7CgkJdmFyIHBvaW50QXR0cmlidXRlID0gcG9pbnRBdHRyaWJ1dGVzLmF0dHJpYnV0ZXNbaV07CgkKCQlpZihwb2ludEF0dHJpYnV0ZS5uYW1lID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuUE9TSVRJT05fQ0FSVEVTSUFOLm5hbWUpewoJCQkKCQkJdmFyIGJ1ZmYgPSBuZXcgQXJyYXlCdWZmZXIobnVtUG9pbnRzKjQqMyk7CgkJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmYpOwoJCQkKCQkJZm9yKHZhciBqID0gMDsgaiA8IG51bVBvaW50czsgaisrKXsKCQkJCWlmKHZlcnNpb24ubmV3ZXJUaGFuKCIxLjMiKSl7CgkJCQkJcG9zaXRpb25zWzMqaiswXSA9IChjdi5nZXRVaW50MzIob2Zmc2V0ICsgaipwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUrMCkgKiBzY2FsZSkgKyBtaW5bMF07CgkJCQkJcG9zaXRpb25zWzMqaisxXSA9IChjdi5nZXRVaW50MzIob2Zmc2V0ICsgaipwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUrNCkgKiBzY2FsZSkgKyBtaW5bMV07CgkJCQkJcG9zaXRpb25zWzMqaisyXSA9IChjdi5nZXRVaW50MzIob2Zmc2V0ICsgaipwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUrOCkgKiBzY2FsZSkgKyBtaW5bMl07CgkJCQl9ZWxzZXsKCQkJCQlwb3NpdGlvbnNbMypqKzBdID0gY3YuZ2V0RmxvYXQoaipwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUrMCkgKyBub2RlT2Zmc2V0WzBdOwoJCQkJCXBvc2l0aW9uc1szKmorMV0gPSBjdi5nZXRGbG9hdChqKnBvaW50QXR0cmlidXRlcy5ieXRlU2l6ZSs0KSArIG5vZGVPZmZzZXRbMV07CgkJCQkJcG9zaXRpb25zWzMqaisyXSA9IGN2LmdldEZsb2F0KGoqcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplKzgpICsgbm9kZU9mZnNldFsyXTsKCQkJCX0KCQkJCQoJCQkJdGlnaHRCb3hNaW5bMF0gPSBNYXRoLm1pbih0aWdodEJveE1pblswXSwgcG9zaXRpb25zWzMqaiswXSk7CgkJCQl0aWdodEJveE1pblsxXSA9IE1hdGgubWluKHRpZ2h0Qm94TWluWzFdLCBwb3NpdGlvbnNbMypqKzFdKTsKCQkJCXRpZ2h0Qm94TWluWzJdID0gTWF0aC5taW4odGlnaHRCb3hNaW5bMl0sIHBvc2l0aW9uc1szKmorMl0pOwoJCQkJCgkJCQl0aWdodEJveE1heFswXSA9IE1hdGgubWF4KHRpZ2h0Qm94TWF4WzBdLCBwb3NpdGlvbnNbMypqKzBdKTsKCQkJCXRpZ2h0Qm94TWF4WzFdID0gTWF0aC5tYXgodGlnaHRCb3hNYXhbMV0sIHBvc2l0aW9uc1szKmorMV0pOwoJCQkJdGlnaHRCb3hNYXhbMl0gPSBNYXRoLm1heCh0aWdodEJveE1heFsyXSwgcG9zaXRpb25zWzMqaisyXSk7CgkJCX0KCQkJCgkJCWF0dHJpYnV0ZUJ1ZmZlcnNbcG9pbnRBdHRyaWJ1dGUubmFtZV0gPSB7IGJ1ZmZlcjogYnVmZiwgYXR0cmlidXRlOiBwb2ludEF0dHJpYnV0ZX07CgkJCQoJCX1lbHNlIGlmKHBvaW50QXR0cmlidXRlLm5hbWUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5DT0xPUl9QQUNLRUQubmFtZSl7CgkJCQoJCQl2YXIgYnVmZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1Qb2ludHMqMyk7CgkJCXZhciBjb2xvcnMgPSBuZXcgVWludDhBcnJheShidWZmKTsKCQkJCgkJCWZvcih2YXIgaiA9IDA7IGogPCBudW1Qb2ludHM7IGorKyl7CgkJCQljb2xvcnNbMypqKzBdID0gY3YuZ2V0VWludDgob2Zmc2V0ICsgaipwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUgKyAwKTsKCQkJCWNvbG9yc1szKmorMV0gPSBjdi5nZXRVaW50OChvZmZzZXQgKyBqKnBvaW50QXR0cmlidXRlcy5ieXRlU2l6ZSArIDEpOwoJCQkJY29sb3JzWzMqaisyXSA9IGN2LmdldFVpbnQ4KG9mZnNldCArIGoqcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplICsgMik7CgkJCX0KCQkJCgkJCWF0dHJpYnV0ZUJ1ZmZlcnNbcG9pbnRBdHRyaWJ1dGUubmFtZV0gPSB7IGJ1ZmZlcjogYnVmZiwgYXR0cmlidXRlOiBwb2ludEF0dHJpYnV0ZX07CgkJCQoJCX1lbHNlIGlmKHBvaW50QXR0cmlidXRlLm5hbWUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5JTlRFTlNJVFkubmFtZSl7CgoJCQl2YXIgYnVmZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1Qb2ludHMqNCk7CgkJCXZhciBpbnRlbnNpdGllcyA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZik7CgkJCQoJCQlmb3IodmFyIGogPSAwOyBqIDwgbnVtUG9pbnRzOyBqKyspewoJCQkJdmFyIGludGVuc2l0eSA9IGN2LmdldFVpbnQxNihvZmZzZXQgKyBqKnBvaW50QXR0cmlidXRlcy5ieXRlU2l6ZSk7CgkJCQlpbnRlbnNpdGllc1tqXSA9IGludGVuc2l0eTsKCQkJfQoJCQkKCQkJYXR0cmlidXRlQnVmZmVyc1twb2ludEF0dHJpYnV0ZS5uYW1lXSA9IHsgYnVmZmVyOiBidWZmLCBhdHRyaWJ1dGU6IHBvaW50QXR0cmlidXRlfTsKCQkKCQl9ZWxzZSBpZihwb2ludEF0dHJpYnV0ZS5uYW1lID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuQ0xBU1NJRklDQVRJT04ubmFtZSl7CgoJCQl2YXIgYnVmZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1Qb2ludHMqNCk7CgkJCXZhciBjbGFzc2lmaWNhdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmYpOwoJCQkKCQkJZm9yKHZhciBqID0gMDsgaiA8IG51bVBvaW50czsgaisrKXsKCQkJCXZhciBjbGFzc2lmaWNhdGlvbiA9IGN2LmdldFVpbnQ4KG9mZnNldCArIGoqcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplKTsKCQkJCWNsYXNzaWZpY2F0aW9uc1tqXSA9IGNsYXNzaWZpY2F0aW9uOwoJCQl9CgkJCQoJCQlhdHRyaWJ1dGVCdWZmZXJzW3BvaW50QXR0cmlidXRlLm5hbWVdID0geyBidWZmZXI6IGJ1ZmYsIGF0dHJpYnV0ZTogcG9pbnRBdHRyaWJ1dGV9OwoJCQoJCX1lbHNlIGlmKHBvaW50QXR0cmlidXRlLm5hbWUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5OT1JNQUxfU1BIRVJFTUFQUEVELm5hbWUpewoKCQkJdmFyIGJ1ZmYgPSBuZXcgQXJyYXlCdWZmZXIobnVtUG9pbnRzKjQqMyk7CgkJCXZhciBub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShidWZmKTsKCQkJCgkJCWZvcih2YXIgaiA9IDA7IGogPCBudW1Qb2ludHM7IGorKyl7CgkJCQl2YXIgYnggPSBjdi5nZXRVaW50OChvZmZzZXQgKyBqICogcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplICsgMCk7CgkJCQl2YXIgYnkgPSBjdi5nZXRVaW50OChvZmZzZXQgKyBqICogcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplICsgMSk7CgkJCQoJCQkJdmFyIGV4ID0gYnggLyAyNTU7CgkJCQl2YXIgZXkgPSBieSAvIDI1NTsKCQkJCQoJCQkJdmFyIG54ID0gZXggKiAyIC0gMTsKCQkJCXZhciBueSA9IGV5ICogMiAtIDE7CgkJCQl2YXIgbnogPSAxOwoJCQkJdmFyIG53ID0gLTE7CgkJCQkKCQkJCXZhciBsID0gKG54ICogKC1ueCkpICsgKG55ICogKC1ueSkpICsgKG56ICogKC1udykpOwoJCQkJbnogPSBsOwoJCQkJbnggPSBueCAqIE1hdGguc3FydChsKTsKCQkJCW55ID0gbnkgKiBNYXRoLnNxcnQobCk7CgkJCQkKCQkJCW54ID0gbnggKiAyOwoJCQkJbnkgPSBueSAqIDI7CgkJCQlueiA9IG56ICogMiAtIDE7CgkJCQkKCQkJCW5vcm1hbHNbMypqICsgMF0gPSBueDsKCQkJCW5vcm1hbHNbMypqICsgMV0gPSBueTsKCQkJCW5vcm1hbHNbMypqICsgMl0gPSBuejsKCQkJfQoJCQkKCQkJYXR0cmlidXRlQnVmZmVyc1twb2ludEF0dHJpYnV0ZS5uYW1lXSA9IHsgYnVmZmVyOiBidWZmLCBhdHRyaWJ1dGU6IHBvaW50QXR0cmlidXRlfTsKCQl9ZWxzZSBpZihwb2ludEF0dHJpYnV0ZS5uYW1lID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMX09DVDE2Lm5hbWUpewoJCQkKCQkJdmFyIGJ1ZmYgPSBuZXcgQXJyYXlCdWZmZXIobnVtUG9pbnRzKjQqMyk7CgkJCXZhciBub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShidWZmKTsKCQkJZm9yKHZhciBqID0gMDsgaiA8IG51bVBvaW50czsgaisrKXsKCQkJCXZhciBieCA9IGN2LmdldFVpbnQ4KG9mZnNldCArIGogKiBwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUgKyAwKTsKCQkJCXZhciBieSA9IGN2LmdldFVpbnQ4KG9mZnNldCArIGogKiBwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUgKyAxKTsKCQkJCQoJCQkJdmFyIHUgPSAoYnggLyAyNTUpICogMiAtIDE7CgkJCQl2YXIgdiA9IChieSAvIDI1NSkgKiAyIC0gMTsKCQkJCQoJCQkJdmFyIHogPSAxIC0gTWF0aC5hYnModSkgLSBNYXRoLmFicyh2KTsKCQkJCQoJCQkJdmFyIHggPSAwOwoJCQkJdmFyIHkgPSAwOwoJCQkJaWYoeiA+PSAwKXsKCQkJCQl4ID0gdTsKCQkJCQl5ID0gdjsKCQkJCX1lbHNlewoJCQkJCXggPSAtICh2L01hdGguc2lnbih2KSAtIDEpIC8gTWF0aC5zaWduKHUpOwoJCQkJCXkgPSAtICh1L01hdGguc2lnbih1KSAtIDEpIC8gTWF0aC5zaWduKHYpOwoJCQkJfQoJCQkJCgkJCQl2YXIgbGVuZ3RoID0gTWF0aC5zcXJ0KHgqeCArIHkqeSArIHoqeik7CgkJCQl4ID0geCAvIGxlbmd0aDsKCQkJCXkgPSB5IC8gbGVuZ3RoOwoJCQkJeiA9IHogLyBsZW5ndGg7CgkJCQkKCQkJCW5vcm1hbHNbMypqICsgMF0gPSB4OwoJCQkJbm9ybWFsc1szKmogKyAxXSA9IHk7CgkJCQlub3JtYWxzWzMqaiArIDJdID0gejsKCQkJfQoJCQlhdHRyaWJ1dGVCdWZmZXJzW3BvaW50QXR0cmlidXRlLm5hbWVdID0geyBidWZmZXI6IGJ1ZmYsIGF0dHJpYnV0ZTogcG9pbnRBdHRyaWJ1dGV9OwoJCX1lbHNlIGlmKHBvaW50QXR0cmlidXRlLm5hbWUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5OT1JNQUwubmFtZSl7CgkJCgkJCXZhciBidWZmID0gbmV3IEFycmF5QnVmZmVyKG51bVBvaW50cyo0KjMpOwoJCQl2YXIgbm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZik7CgkJCWZvcih2YXIgaiA9IDA7IGogPCBudW1Qb2ludHM7IGorKyl7CgkJCQl2YXIgeCA9IGN2LmdldEZsb2F0KG9mZnNldCArIGogKiBwb2ludEF0dHJpYnV0ZXMuYnl0ZVNpemUgKyAwKTsKCQkJCXZhciB5ID0gY3YuZ2V0RmxvYXQob2Zmc2V0ICsgaiAqIHBvaW50QXR0cmlidXRlcy5ieXRlU2l6ZSArIDQpOwoJCQkJdmFyIHogPSBjdi5nZXRGbG9hdChvZmZzZXQgKyBqICogcG9pbnRBdHRyaWJ1dGVzLmJ5dGVTaXplICsgOCk7CgkJCQkKCQkJCW5vcm1hbHNbMypqICsgMF0gPSB4OwoJCQkJbm9ybWFsc1szKmogKyAxXSA9IHk7CgkJCQlub3JtYWxzWzMqaiArIDJdID0gejsKCQkJfQoJCQlhdHRyaWJ1dGVCdWZmZXJzW3BvaW50QXR0cmlidXRlLm5hbWVdID0geyBidWZmZXI6IGJ1ZmYsIGF0dHJpYnV0ZTogcG9pbnRBdHRyaWJ1dGV9OwoJCX0KCQkKCQlvZmZzZXQgKz0gcG9pbnRBdHRyaWJ1dGUuYnl0ZVNpemU7Cgl9CgkKCXZhciBtZXNzYWdlID0gewoJCWF0dHJpYnV0ZUJ1ZmZlcnM6IGF0dHJpYnV0ZUJ1ZmZlcnMsCgkJdGlnaHRCb3VuZGluZ0JveDogeyBtaW46IHRpZ2h0Qm94TWluLCBtYXg6IHRpZ2h0Qm94TWF4IH0KCX07CgkJCgl2YXIgdHJhbnNmZXJhYmxlcyA9IFtdOwoJCglmb3IodmFyIHByb3BlcnR5IGluIG1lc3NhZ2UuYXR0cmlidXRlQnVmZmVycyl7CgkJaWYobWVzc2FnZS5hdHRyaWJ1dGVCdWZmZXJzLmhhc093blByb3BlcnR5KHByb3BlcnR5KSl7CgkJCXRyYW5zZmVyYWJsZXMucHVzaChtZXNzYWdlLmF0dHJpYnV0ZUJ1ZmZlcnNbcHJvcGVydHldLmJ1ZmZlcik7CgkJfQoJfQoJCglwb3N0TWVzc2FnZShtZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTsKCQp9OwoKUG90cmVlLlZlcnNpb24gPSBmdW5jdGlvbih2ZXJzaW9uKXsKCXRoaXMudmVyc2lvbiA9IHZlcnNpb247Cgl2YXIgdm1MZW5ndGggPSAodmVyc2lvbi5pbmRleE9mKCIuIikgPT09IC0xKSA/IHZlcnNpb24ubGVuZ3RoIDogdmVyc2lvbi5pbmRleE9mKCIuIik7Cgl0aGlzLnZlcnNpb25NYWpvciA9IHBhcnNlSW50KHZlcnNpb24uc3Vic3RyKDAsIHZtTGVuZ3RoKSk7Cgl0aGlzLnZlcnNpb25NaW5vciA9IHBhcnNlSW50KHZlcnNpb24uc3Vic3RyKHZtTGVuZ3RoICsgMSkpOwoJaWYodGhpcy52ZXJzaW9uTWlub3IubGVuZ3RoID09PSAwKXsKCQl0aGlzLnZlcnNpb25NaW5vciA9IDA7Cgl9CgkKfTsKClBvdHJlZS5WZXJzaW9uLnByb3RvdHlwZS5uZXdlclRoYW4gPSBmdW5jdGlvbih2ZXJzaW9uKXsKCXZhciB2ID0gbmV3IFBvdHJlZS5WZXJzaW9uKHZlcnNpb24pOwoJCglpZiggdGhpcy52ZXJzaW9uTWFqb3IgPiB2LnZlcnNpb25NYWpvcil7CgkJcmV0dXJuIHRydWU7Cgl9ZWxzZSBpZiggdGhpcy52ZXJzaW9uTWFqb3IgPT09IHYudmVyc2lvbk1ham9yICYmIHRoaXMudmVyc2lvbk1pbm9yID4gdi52ZXJzaW9uTWlub3IpewoJCXJldHVybiB0cnVlOwoJfWVsc2V7CgkJcmV0dXJuIGZhbHNlOwoJfQp9OwoKUG90cmVlLlZlcnNpb24ucHJvdG90eXBlLmVxdWFsT3JIaWdoZXIgPSBmdW5jdGlvbih2ZXJzaW9uKXsKCXZhciB2ID0gbmV3IFBvdHJlZS5WZXJzaW9uKHZlcnNpb24pOwoJCglpZiggdGhpcy52ZXJzaW9uTWFqb3IgPiB2LnZlcnNpb25NYWpvcil7CgkJcmV0dXJuIHRydWU7Cgl9ZWxzZSBpZiggdGhpcy52ZXJzaW9uTWFqb3IgPT09IHYudmVyc2lvbk1ham9yICYmIHRoaXMudmVyc2lvbk1pbm9yID49IHYudmVyc2lvbk1pbm9yKXsKCQlyZXR1cm4gdHJ1ZTsKCX1lbHNlewoJCXJldHVybiBmYWxzZTsKCX0KfTsKClBvdHJlZS5WZXJzaW9uLnByb3RvdHlwZS51cFRvID0gZnVuY3Rpb24odmVyc2lvbil7CglyZXR1cm4gIXRoaXMubmV3ZXJUaGFuKHZlcnNpb24pOwp9OwpQb3RyZWUuUG9pbnRBdHRyaWJ1dGVOYW1lcyA9IHt9OwoKUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuUE9TSVRJT05fQ0FSVEVTSUFOIAk9IDA7CS8vIGZsb2F0IHgsIHksIHo7ClBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkNPTE9SX1BBQ0tFRAkJPSAxOwkvLyBieXRlIHIsIGcsIGIsIGE7IAlJID0gWzAsMV0KUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuQ09MT1JfRkxPQVRTXzEJCT0gMjsJLy8gZmxvYXQgciwgZywgYjsgCQlJID0gWzAsMV0KUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuQ09MT1JfRkxPQVRTXzI1NQk9IDM7CS8vIGZsb2F0IHIsIGcsIGI7IAkJSSA9IFswLDI1NV0KUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuTk9STUFMX0ZMT0FUUwkJPSA0OyAgCS8vIGZsb2F0IHgsIHksIHo7ClBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkZJTExFUgkJCQk9IDU7ClBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLklOVEVOU0lUWQkJCT0gNjsKUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuQ0xBU1NJRklDQVRJT04JCT0gNzsKUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuTk9STUFMX1NQSEVSRU1BUFBFRAk9IDg7ClBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLk5PUk1BTF9PQ1QxNgkJPSA5OwpQb3RyZWUuUG9pbnRBdHRyaWJ1dGVOYW1lcy5OT1JNQUwJCQkJPSAxMDsKCi8qKgogKiBTb21lIHR5cGVzIG9mIHBvc3NpYmxlIHBvaW50IGF0dHJpYnV0ZSBkYXRhIGZvcm1hdHMKICogCiAqIEBjbGFzcwogKi8KUG90cmVlLlBvaW50QXR0cmlidXRlVHlwZXMgPSB7CglEQVRBX1RZUEVfRE9VQkxFCToge29yZGluYWwgOiAwLCBzaXplOiA4fSwKCURBVEFfVFlQRV9GTE9BVAkJOiB7b3JkaW5hbCA6IDEsIHNpemU6IDR9LAoJREFUQV9UWVBFX0lOVDgJCToge29yZGluYWwgOiAyLCBzaXplOiAxfSwKCURBVEFfVFlQRV9VSU5UOAkJOiB7b3JkaW5hbCA6IDMsIHNpemU6IDF9LAoJREFUQV9UWVBFX0lOVDE2CQk6IHtvcmRpbmFsIDogNCwgc2l6ZTogMn0sCglEQVRBX1RZUEVfVUlOVDE2CToge29yZGluYWwgOiA1LCBzaXplOiAyfSwKCURBVEFfVFlQRV9JTlQzMgkJOiB7b3JkaW5hbCA6IDYsIHNpemU6IDR9LAoJREFUQV9UWVBFX1VJTlQzMgk6IHtvcmRpbmFsIDogNywgc2l6ZTogNH0sCglEQVRBX1RZUEVfSU5UNjQJCToge29yZGluYWwgOiA4LCBzaXplOiA4fSwKCURBVEFfVFlQRV9VSU5UNjQJOiB7b3JkaW5hbCA6IDksIHNpemU6IDh9Cn07Cgp2YXIgaSA9IDA7CmZvcih2YXIgb2JqIGluIFBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzKXsKCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzW2ldID0gUG90cmVlLlBvaW50QXR0cmlidXRlVHlwZXNbb2JqXTsKCWkrKzsKfQoKLyoqCiAqIEEgc2luZ2xlIHBvaW50IGF0dHJpYnV0ZSBzdWNoIGFzIGNvbG9yL25vcm1hbC8uLiBhbmQgaXRzIGRhdGEgZm9ybWF0L251bWJlciBvZiBlbGVtZW50cy8uLi4gCiAqIAogKiBAY2xhc3MKICogQHBhcmFtIG5hbWUgCiAqIEBwYXJhbSB0eXBlCiAqIEBwYXJhbSBzaXplCiAqIEByZXR1cm5zCiAqLwpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUgPSBmdW5jdGlvbihuYW1lLCB0eXBlLCBudW1FbGVtZW50cyl7Cgl0aGlzLm5hbWUgPSBuYW1lOwoJdGhpcy50eXBlID0gdHlwZTsgCgl0aGlzLm51bUVsZW1lbnRzID0gbnVtRWxlbWVudHM7Cgl0aGlzLmJ5dGVTaXplID0gdGhpcy5udW1FbGVtZW50cyAqIHRoaXMudHlwZS5zaXplOwp9OwoKUG90cmVlLlBvaW50QXR0cmlidXRlLlBPU0lUSU9OX0NBUlRFU0lBTiA9IG5ldyBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUoCgkJUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuUE9TSVRJT05fQ0FSVEVTSUFOLAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzLkRBVEFfVFlQRV9GTE9BVCwgMyk7CgpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuUkdCQV9QQUNLRUQgPSBuZXcgUG90cmVlLlBvaW50QXR0cmlidXRlKAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkNPTE9SX1BBQ0tFRCwKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfSU5UOCwgNCk7CgpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuQ09MT1JfUEFDS0VEID0gUG90cmVlLlBvaW50QXR0cmlidXRlLlJHQkFfUEFDS0VEOwoKUG90cmVlLlBvaW50QXR0cmlidXRlLlJHQl9QQUNLRUQgPSBuZXcgUG90cmVlLlBvaW50QXR0cmlidXRlKAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkNPTE9SX1BBQ0tFRCwKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfSU5UOCwgMyk7CgpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMX0ZMT0FUUyA9IG5ldyBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUoCgkJUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuTk9STUFMX0ZMT0FUUywKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfRkxPQVQsIDMpOwoKUG90cmVlLlBvaW50QXR0cmlidXRlLkZJTExFUl8xQiA9IG5ldyBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUoCgkJUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuRklMTEVSLAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzLkRBVEFfVFlQRV9VSU5UOCwgMSk7CgkJClBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5JTlRFTlNJVFkgPSBuZXcgUG90cmVlLlBvaW50QXR0cmlidXRlKAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLklOVEVOU0lUWSwKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfVUlOVDE2LCAxKTsJCQoJCQpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuQ0xBU1NJRklDQVRJT04gPSBuZXcgUG90cmVlLlBvaW50QXR0cmlidXRlKAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkNMQVNTSUZJQ0FUSU9OLAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzLkRBVEFfVFlQRV9VSU5UOCwgMSk7CQoJCQpQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMX1NQSEVSRU1BUFBFRCA9IG5ldyBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUoCgkJUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuTk9STUFMX1NQSEVSRU1BUFBFRCwKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfVUlOVDgsIDIpOwkJCgkJClBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5OT1JNQUxfT0NUMTYgPSBuZXcgUG90cmVlLlBvaW50QXR0cmlidXRlKAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLk5PUk1BTF9PQ1QxNiwKCQlQb3RyZWUuUG9pbnRBdHRyaWJ1dGVUeXBlcy5EQVRBX1RZUEVfVUlOVDgsIDIpOwkKCQkKUG90cmVlLlBvaW50QXR0cmlidXRlLk5PUk1BTCA9IG5ldyBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUoCgkJUG90cmVlLlBvaW50QXR0cmlidXRlTmFtZXMuTk9STUFMLAoJCVBvdHJlZS5Qb2ludEF0dHJpYnV0ZVR5cGVzLkRBVEFfVFlQRV9GTE9BVCwgMyk7CgovKioKICogT3JkZXJlZCBsaXN0IG9mIFBvaW50QXR0cmlidXRlcyB1c2VkIHRvIGlkZW50aWZ5IGhvdyBwb2ludHMgYXJlIGFsaWduZWQgaW4gYSBidWZmZXIuCiAqIAogKiBAY2xhc3MKICogCiAqLwpQb3RyZWUuUG9pbnRBdHRyaWJ1dGVzID0gZnVuY3Rpb24ocG9pbnRBdHRyaWJ1dGVzKXsKCXRoaXMuYXR0cmlidXRlcyA9IFtdOwoJdGhpcy5ieXRlU2l6ZSA9IDA7Cgl0aGlzLnNpemUgPSAwOwoJCglpZihwb2ludEF0dHJpYnV0ZXMgIT0gbnVsbCl7CQoJCWZvcih2YXIgaSA9IDA7IGkgPCBwb2ludEF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspewoJCQl2YXIgcG9pbnRBdHRyaWJ1dGVOYW1lID0gcG9pbnRBdHRyaWJ1dGVzW2ldOwoJCQl2YXIgcG9pbnRBdHRyaWJ1dGUgPSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGVbcG9pbnRBdHRyaWJ1dGVOYW1lXTsKCQkJdGhpcy5hdHRyaWJ1dGVzLnB1c2gocG9pbnRBdHRyaWJ1dGUpOwoJCQl0aGlzLmJ5dGVTaXplICs9IHBvaW50QXR0cmlidXRlLmJ5dGVTaXplOwoJCQl0aGlzLnNpemUrKzsKCQl9Cgl9Cn07CgpQb3RyZWUuUG9pbnRBdHRyaWJ1dGVzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihwb2ludEF0dHJpYnV0ZSl7Cgl0aGlzLmF0dHJpYnV0ZXMucHVzaChwb2ludEF0dHJpYnV0ZSk7Cgl0aGlzLmJ5dGVTaXplICs9IHBvaW50QXR0cmlidXRlLmJ5dGVTaXplOwoJdGhpcy5zaXplKys7Cn07CgpQb3RyZWUuUG9pbnRBdHRyaWJ1dGVzLnByb3RvdHlwZS5oYXNDb2xvcnMgPSBmdW5jdGlvbigpewoJZm9yKHZhciBuYW1lIGluIHRoaXMuYXR0cmlidXRlcyl7CgkJdmFyIHBvaW50QXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGVzW25hbWVdOwoJCWlmKHBvaW50QXR0cmlidXRlLm5hbWUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZU5hbWVzLkNPTE9SX1BBQ0tFRCl7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCQoJcmV0dXJuIGZhbHNlOwp9OwoKUG90cmVlLlBvaW50QXR0cmlidXRlcy5wcm90b3R5cGUuaGFzTm9ybWFscyA9IGZ1bmN0aW9uKCl7Cglmb3IodmFyIG5hbWUgaW4gdGhpcy5hdHRyaWJ1dGVzKXsKCQl2YXIgcG9pbnRBdHRyaWJ1dGUgPSB0aGlzLmF0dHJpYnV0ZXNbbmFtZV07CgkJaWYoCgkJCXBvaW50QXR0cmlidXRlID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMX1NQSEVSRU1BUFBFRCB8fCAKCQkJcG9pbnRBdHRyaWJ1dGUgPT09IFBvdHJlZS5Qb2ludEF0dHJpYnV0ZS5OT1JNQUxfRkxPQVRTIHx8CgkJCXBvaW50QXR0cmlidXRlID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMIHx8CgkJCXBvaW50QXR0cmlidXRlID09PSBQb3RyZWUuUG9pbnRBdHRyaWJ1dGUuTk9STUFMX09DVDE2KXsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoJCglyZXR1cm4gZmFsc2U7Cn07CgoK")),
Potree.Shaders["pointcloud.vs"]=["","// the following is an incomplete list of attributes, uniforms and defines","// which are automatically added through the THREE.ShaderMaterial","","//attribute vec3 position;","//attribute vec3 color;","//attribute vec3 normal;","","//uniform mat4 modelMatrix;","//uniform mat4 modelViewMatrix;","//uniform mat4 projectionMatrix;","//uniform mat4 viewMatrix;","//uniform mat3 normalMatrix;","//uniform vec3 cameraPosition;","","//#define MAX_DIR_LIGHTS 0","//#define MAX_POINT_LIGHTS 1","//#define MAX_SPOT_LIGHTS 0","//#define MAX_HEMI_LIGHTS 0","//#define MAX_SHADOWS 0","//#define MAX_BONES 58","","#define max_clip_boxes 30","","attribute float intensity;","attribute float classification;","attribute float returnNumber;","attribute float numberOfReturns;","attribute float pointSourceID;","attribute vec3 indices;","","uniform float screenWidth;","uniform float screenHeight;","uniform float fov;","uniform float spacing;","uniform float near;","uniform float far;","","#if defined use_clip_box","\tuniform mat4 clipBoxes[max_clip_boxes];","#endif","","","uniform float heightMin;","uniform float heightMax;","uniform float intensityMin;","uniform float intensityMax;","uniform float size;\t\t\t\t// pixel size factor","uniform float minSize;\t\t\t// minimum pixel size","uniform float maxSize;\t\t\t// maximum pixel size","uniform float octreeSize;","uniform vec3 bbSize;","uniform vec3 uColor;","uniform float opacity;","uniform float clipBoxCount;","uniform float alphaAttenuation;","uniform float normalsFilteringThreshold;","","uniform sampler2D visibleNodes;","uniform sampler2D gradient;","uniform sampler2D classificationLUT;","uniform sampler2D depthMap;","","varying vec3\tvColor;","#if defined(weighted_splats) || defined(use_interpolation)","\tvarying float \tvRadius;","#endif","#if defined(color_type_phong)","\tvarying vec3\tvNormal;","#endif","#if defined(use_interpolation) || defined(color_type_phong)","\tvarying vec3\tvViewPosition;","#endif","#ifndef color_type_point_index","\tvarying float\tvOpacity;","#endif","#if defined weighted_splats","\tvarying float\tvLinearDepth;","#endif","#if defined(use_edl)","\tvarying float\tvLogDepth;","#endif","","// ---------------------","// OCTREE","// ---------------------","","#if (defined(adaptive_point_size) || defined(color_type_tree_depth)) && defined(tree_type_octree)","/**"," * number of 1-bits up to inclusive index position"," * number is treated as if it were an integer in the range 0-255"," *"," */","float numberOfOnes(float number, float index){","\tfloat tmp = mod(number, pow(2.0, index + 1.0));","\tfloat numOnes = 0.0;","\tfor(float i = 0.0; i < 8.0; i++){","\t\tif(mod(tmp, 2.0) != 0.0){","\t\t\tnumOnes++;","\t\t}","\t\ttmp = floor(tmp / 2.0);","\t}","\treturn numOnes;","}","","","/**"," * checks whether the bit at index is 1"," * number is treated as if it were an integer in the range 0-255"," *"," */","bool isBitSet(float number, float index){","\treturn mod(floor(number / pow(2.0, index)), 2.0) != 0.0;","}","","","/**"," * find the tree depth at the point position"," */","float getLocalTreeDepth(){","\tvec3 offset = vec3(0.0, 0.0, 0.0);","\tfloat iOffset = 0.0;","\tfloat depth = 0.0;","\tfor(float i = 0.0; i <= 1000.0; i++){","\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i);","\t\tvec3 index3d = (position - offset) / nodeSizeAtLevel;","\t\tindex3d = floor(index3d + 0.5);","\t\tfloat index = 4.0*index3d.x + 2.0*index3d.y + index3d.z;","\t\t","\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));","\t\tfloat mask = value.r * 255.0;","\t\tif(isBitSet(mask, index)){","\t\t\t// there are more visible child nodes at this position","\t\t\tiOffset = iOffset + value.g * 255.0 * 256.0 + value.b * 255.0 + numberOfOnes(mask, index - 1.0);","\t\t\tdepth++;","\t\t}else{","\t\t\t// no more visible child nodes at this position","\t\t\treturn depth;","\t\t}","\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;","\t}","\t\t","\treturn depth;","}","","float getPointSizeAttenuation(){","\treturn pow(1.9, getLocalTreeDepth());","}","","","#endif","","","// ---------------------","// KD-TREE","// ---------------------","","#if (defined(adaptive_point_size) || defined(color_type_tree_depth)) && defined(tree_type_kdtree)","","float getLocalTreeDepth(){","\tvec3 offset = vec3(0.0, 0.0, 0.0);","\tfloat iOffset = 0.0;","\tfloat depth = 0.0;","\t\t","\t\t","\tvec3 size = bbSize;\t","\tvec3 pos = position;","\t\t","\tfor(float i = 0.0; i <= 1000.0; i++){","\t\t","\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));","\t\t","\t\tint children = int(value.r * 255.0);","\t\tfloat next = value.g * 255.0;","\t\tint split = int(value.b * 255.0);","\t\t","\t\tif(next == 0.0){","\t\t \treturn depth;","\t\t}","\t\t","\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);","\t\tif(split == 1){","\t\t\tsplitv.x = 1.0;","\t\t}else if(split == 2){","\t\t \tsplitv.y = 1.0;","\t\t}else if(split == 4){","\t\t \tsplitv.z = 1.0;","\t\t}","\t\t","\t\tiOffset = iOffset + next;","\t\t","\t\tfloat factor = length(pos * splitv / size);","\t\tif(factor < 0.5){","\t\t \t// left","\t\t    if(children == 0 || children == 2){","\t\t    \treturn depth;","\t\t    }","\t\t}else{","\t\t  \t// right","\t\t    pos = pos - size * splitv * 0.5;","\t\t    if(children == 0 || children == 1){","\t\t    \treturn depth;","\t\t    }","\t\t    if(children == 3){","\t\t    \tiOffset = iOffset + 1.0;","\t\t    }","\t\t}","\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);","\t\t","\t\tdepth++;","\t}","\t\t","\t\t","\treturn depth;\t","}","","float getPointSizeAttenuation(){","\treturn pow(1.3, getLocalTreeDepth());","}","","#endif","","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec3 viewPosition = -mvPosition.xyz;","\t#if defined(use_interpolation) || defined(color_type_phong)","\t\tvViewPosition = viewPosition;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;","\t#if defined weighted_splats","\t\tvLinearDepth = -mvPosition.z;","\t#endif","\t#if defined(color_type_phong)","\t\tvNormal = normalize(normalMatrix * normal);","\t#endif","\t#if defined(use_edl)","\t\tvLogDepth = log2(gl_Position.w + 1.0) / log2(far + 1.0);","\t#endif","\t","\t//#if defined(use_logarithmic_depth_buffer)","\t//\tfloat logarithmicZ = (2.0 * log2(gl_Position.w + 1.0) / log2(far + 1.0) - 1.0) * gl_Position.w;","\t//\tgl_Position.z = logarithmicZ;","\t//#endif","","\t// ---------------------","\t// POINT COLOR","\t// ---------------------","\t","\t#ifdef color_type_rgb","\t\tvColor = color;","\t#elif defined color_type_height","\t\tvec4 world = modelMatrix * vec4( position, 1.0 );","\t\tfloat w = (world.z - heightMin) / (heightMax-heightMin);","\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t#elif defined color_type_depth","\t\tfloat linearDepth = -mvPosition.z ;","\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;","\t\tvColor = vec3(linearDepth, expDepth, 0.0);","\t#elif defined color_type_intensity","\t\tfloat w = (intensity - intensityMin) / (intensityMax - intensityMin);","\t\tvColor = vec3(w, w, w);","\t#elif defined color_type_intensity_gradient","\t\tfloat w = (intensity - intensityMin) / intensityMax;","\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t#elif defined color_type_color","\t\tvColor = uColor;","\t#elif defined color_type_tinted","\t\tvColor = color*0.8 + uColor*0.2;","\t#elif defined color_type_tree_depth","\t\tfloat depth = getLocalTreeDepth();","\t\tfloat w = depth / 10.0;","\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t#elif defined color_type_point_index","\t\tvColor = indices.rgb;","\t#elif defined color_type_classification","\t\tfloat c = mod(classification, 16.0);","\t\tvec2 uv = vec2(c / 255.0, 0.5);","\t\tvec4 classColor = texture2D(classificationLUT, uv);","\t\tvColor = classColor.rgb;","\t#elif defined color_type_return_number","\t\tif(numberOfReturns == 1.0){","\t\t\tvColor = vec3(1.0, 1.0, 0.0);","\t\t}else{","\t\t\tif(returnNumber == 1.0){","\t\t\t\tvColor = vec3(1.0, 0.0, 0.0);","\t\t\t}else if(returnNumber == numberOfReturns){","\t\t\t\tvColor = vec3(0.0, 0.0, 1.0);","\t\t\t}else{","\t\t\t\tvColor = vec3(0.0, 1.0, 0.0);","\t\t\t}","\t\t}","\t#elif defined color_type_source","\t\tfloat w = mod(pointSourceID, 10.0) / 10.0;","\t\tvColor = texture2D(gradient, vec2(w,1.0 - w)).rgb;","\t#elif defined color_type_normal","\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz / 2.0 + vec3(0.5, 0.5, 0.5);","\t#elif defined color_type_phong","\t\tvColor = color;","\t#endif","\t","\t/*","\t{","\t\t// TODO might want to combine with the define block above to avoid reading same LUT two times","\t\tfloat c = mod(classification, 16.0);","\t\tvec2 uv = vec2(c / 255.0, 0.5);","\t\t","\t\tif(texture2D(classificationLUT, uv).a == 0.0){","\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);","\t\t}","\t}","\t*/","","\t//if(vNormal.z < 0.0){","\t//\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);","\t//}","\t","\t// ---------------------","\t// POINT SIZE","\t// ---------------------","\tfloat pointSize = 1.0;","\t","\tfloat projFactor = 1.0 / tan(fov / 2.0);","\tprojFactor /= viewPosition.z;","\tprojFactor *= screenHeight / 2.0;","\tfloat r = spacing * 1.5;","\t#if defined fixed_point_size","\t\tpointSize = size;","\t#elif defined attenuated_point_size","\t\tpointSize = size * projFactor / 23.0;","\t#elif defined adaptive_point_size","\t\tfloat worldSpaceSize = size * r / getPointSizeAttenuation();","\t\tpointSize = worldSpaceSize * projFactor;","\t#endif","","\tpointSize = max(minSize, pointSize);","\tpointSize = min(maxSize, pointSize);","\t","\t#if defined(weighted_splats) || defined(use_interpolation)","\t\tvRadius = pointSize / projFactor;","\t#endif","\tgl_PointSize = pointSize;","\t","\t// ---------------------","\t// OPACITY","\t// ---------------------","\t#ifndef color_type_point_index","\t\t#if defined attenuated_opacity","\t\t\t//vOpacity = opacity / (viewPosition.z);// * viewPosition.z);","\t\t\tvOpacity = opacity * exp(- length(viewPosition.xyz) / alphaAttenuation);","\t\t#else //defined fixed_opacity","\t\t\tvOpacity = opacity;","\t\t#endif","\t#endif","","\t// ---------------------","\t// FILTERING","\t// ---------------------","","\t#if defined normals_filtering","\t\tif(abs((modelViewMatrix * vec4(normal, 0.0)).z) > normalsFilteringThreshold ){","\t\t\t// Clip point","\t\t\tgl_Position = vec4(0.0, 0.0, 2.0, 1.0);","\t\t}","\t#endif","","\t// ---------------------","\t// CLIPPING","\t// ---------------------","\t","\t#if defined use_clip_box","\t\tbool insideAny = false;","\t\tfor(int i = 0; i < max_clip_boxes; i++){","\t\t\tif(i == int(clipBoxCount)){","\t\t\t\tbreak;","\t\t\t}","\t\t","\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );","\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;","\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;","\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;","\t\t\tinsideAny = insideAny || inside;","\t\t}","\t\tif(!insideAny){","\t","\t\t\t#if defined clip_outside","\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);","\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)","\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;","\t\t\t#endif","\t\t}else{","\t\t\t#if defined clip_highlight_inside","\t\t\tvColor.r += 0.5;","\t\t\t#endif","\t\t}","\t","\t#endif","\t","}",""].join("\n"),Potree.Shaders["pointcloud.fs"]=["","#if defined use_interpolation","\t#extension GL_EXT_frag_depth : enable","#endif","","","// the following is an incomplete list of attributes, uniforms and defines","// which are automatically added through the THREE.ShaderMaterial","","// #define USE_COLOR","// ","// uniform mat4 viewMatrix;","// uniform vec3 cameraPosition;","","","uniform mat4 projectionMatrix;","uniform float opacity;","","","#if defined(color_type_phong)","","\tuniform vec3 diffuse;","\tuniform vec3 ambient;","\tuniform vec3 emissive;","\tuniform vec3 specular;","\tuniform float shininess;","\tuniform vec3 ambientLightColor;","","\t#if MAX_POINT_LIGHTS > 0","","\t\tuniform vec3 \tpointLightColor[ MAX_POINT_LIGHTS ];","\t\tuniform vec3 \tpointLightPosition[ MAX_POINT_LIGHTS ];","\t\tuniform float \tpointLightDistance[ MAX_POINT_LIGHTS ];","\t\tuniform float \tpointLightDecay[ MAX_POINT_LIGHTS ];","","\t#endif","","\t#if MAX_DIR_LIGHTS > 0","","\t\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","\t\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","","\t#endif","","#endif","","//#if MAX_SPOT_LIGHTS > 0","//","//\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","//\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","//\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","//\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","//\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","//","//\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","//","//#endif","","uniform float fov;","uniform float spacing;","uniform float near;","uniform float far;","uniform float pcIndex;","uniform float screenWidth;","uniform float screenHeight;","","uniform sampler2D depthMap;","","varying vec3\tvColor;","#if defined(color_type_phong)","\tvarying vec3\tvNormal;","#endif","#if defined(weighted_splats) || defined(use_interpolation)","\tvarying float\tvRadius;","#endif","#if defined(use_interpolation) || defined(color_type_phong)","\tvarying vec3\tvViewPosition;","#endif","#ifndef color_type_point_index","\tvarying float\tvOpacity;","#endif","#if defined weighted_splats","\tvarying float\tvLinearDepth;","#endif","#if defined(use_edl)","\tvarying float\tvLogDepth;","#endif","","float specularStrength = 1.0;","","void main() {","","\tvec3 color = vColor;","\tfloat depth = gl_FragCoord.z;","","\t#if defined(circle_point_shape) || defined(use_interpolation) || defined (weighted_splats)","\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;","\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;","\t#endif","\t","\t#if defined(circle_point_shape) || defined (weighted_splats)","\t\tfloat cc = u*u + v*v;","\t\tif(cc > 1.0){","\t\t\tdiscard;","\t\t}","\t#endif","\t","\t#if defined weighted_splats","\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);","\t\tfloat sDepth = texture2D(depthMap, uv).r;","\t\tif(vLinearDepth > sDepth + vRadius){","\t\t\tdiscard;","\t\t}","\t#endif","\t","\t#if defined use_interpolation","\t\tfloat wi = 0.0 - ( u*u + v*v);","\t\tvec4 pos = vec4(-vViewPosition, 1.0);","\t\tpos.z += wi * vRadius;","\t\tfloat linearDepth = pos.z;","\t\tpos = projectionMatrix * pos;","\t\tpos = pos / pos.w;","\t\tfloat expDepth = pos.z;","\t\tdepth = (pos.z + 1.0) / 2.0;","\t\tgl_FragDepthEXT = depth;","\t\t","\t\t#if defined(color_type_depth)","\t\t\tcolor.r = linearDepth;","\t\t\tcolor.g = expDepth;","\t\t#endif","\t\t","\t#endif","\t","\t#if defined color_type_point_index","\t\tgl_FragColor = vec4(color, pcIndex / 255.0);","\t#else","\t\tgl_FragColor = vec4(color, vOpacity);","\t#endif","\t","\t#if defined weighted_splats","\t    float w = pow(1.0 - (u*u + v*v), 2.0);","\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;","\t\tgl_FragColor.a = w;","\t#endif","\t","\t","\t#if defined(color_type_phong)","","\t\tvec3 normal = normalize( vNormal );","\t\tnormal.z = abs(normal.z);","","\t\tvec3 viewPosition = normalize( vViewPosition );","","\t\t// code taken from three.js phong light fragment shader","","\t\t#if MAX_POINT_LIGHTS > 0","","\t\t\tvec3 pointDiffuse = vec3( 0.0 );","\t\t\tvec3 pointSpecular = vec3( 0.0 );","","\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","","\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;","","\t\t\t\tfloat lDistance = 1.0;","\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )","\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","","\t\t\t\tlVector = normalize( lVector );","","\t\t\t\t\t\t// diffuse","","\t\t\t\tfloat dotProduct = dot( normal, lVector );","","\t\t\t\t#ifdef WRAP_AROUND","","\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );","\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","","\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","","\t\t\t\t#else","","\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );","","\t\t\t\t#endif","","\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","","\t\t\t\t\t\t// specular","","\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );","\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);","\t\t\t}","\t\t","\t\t#endif","\t\t","\t\t#if MAX_DIR_LIGHTS > 0","","\t\t\tvec3 dirDiffuse = vec3( 0.0 );","\t\t\tvec3 dirSpecular = vec3( 0.0 );","","\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","","\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );","","\t\t\t\t\t\t// diffuse","","\t\t\t\tfloat dotProduct = dot( normal, dirVector );","","\t\t\t\t#ifdef WRAP_AROUND","","\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );","\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","","\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","","\t\t\t\t#else","","\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );","","\t\t\t\t#endif","","\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","","\t\t\t\t// specular","","\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );","\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","\t\t\t}","","\t\t#endif","\t\t","\t\tvec3 totalDiffuse = vec3( 0.0 );","\t\tvec3 totalSpecular = vec3( 0.0 );","\t\t","\t\t#if MAX_POINT_LIGHTS > 0","","\t\t\ttotalDiffuse += pointDiffuse;","\t\t\ttotalSpecular += pointSpecular;","","\t\t#endif","\t\t","\t\t#if MAX_DIR_LIGHTS > 0","","\t\t\ttotalDiffuse += dirDiffuse;","\t\t\ttotalSpecular += dirSpecular;","","\t\t#endif","\t\t","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","","\t#endif","\t","\t","\t#if defined(use_edl)","\t\tgl_FragColor.a = vLogDepth;","\t#endif","\t","}","","",""].join("\n"),Potree.Shaders["normalize.vs"]=["","varying vec2 vUv;","","void main() {","    vUv = uv;","","    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),Potree.Shaders["normalize.fs"]=["","#extension GL_EXT_frag_depth : enable","","uniform sampler2D depthMap;","uniform sampler2D texture;","","varying vec2 vUv;","","void main() {","    float depth = texture2D(depthMap, vUv).g; ","\t","\tif(depth <= 0.0){","\t\tdiscard;","\t}","\t","    vec4 color = texture2D(texture, vUv); ","\tcolor = color / color.w;","    ","\tgl_FragColor = vec4(color.xyz, 1.0); ","\t","\tgl_FragDepthEXT = depth;","}"].join("\n"),Potree.Shaders["edl.vs"]=["","","varying vec2 vUv;","","void main() {","    vUv = uv;","\t","\tvec4 mvPosition = modelViewMatrix * vec4(position,1.0);","","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),Potree.Shaders["edl.fs"]=["","// ","// adapted from the EDL shader code from Christian Boucheny in cloud compare:","// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL","//","","#define NEIGHBOUR_COUNT 8","","uniform mat4 projectionMatrix;","","uniform float screenWidth;","uniform float screenHeight;","uniform float near;","uniform float far;","uniform vec2 neighbours[NEIGHBOUR_COUNT];","uniform vec3 lightDir;","uniform float expScale;","uniform float edlScale;","uniform float radius;","uniform float opacity;","","//uniform sampler2D depthMap;","uniform sampler2D colorMap;","","varying vec2 vUv;","","/**"," * transform linear depth to [0,1] interval with 1 beeing closest to the camera."," */","float ztransform(float linearDepth){","\treturn 1.0 - (linearDepth - near) / (far - near);","}","","float expToLinear(float z){","    z = 2.0 * z - 1.0;","\tfloat linear = (2.0 * near * far) / (far + near - z * (far - near));","","\treturn linear;","}","","// this actually only returns linear depth values if LOG_BIAS is 1.0","// lower values work out more nicely, though.","#define LOG_BIAS 0.01","float logToLinear(float z){","\treturn (pow((1.0 + LOG_BIAS * far), z) - 1.0) / LOG_BIAS;","}","","float obscurance(float z, float dist){","\treturn max(0.0, z) / dist;","}","","float computeObscurance(float linearDepth){","\tvec4 P = vec4(0, 0, 1, -ztransform(linearDepth));","\tvec2 uvRadius = radius / vec2(screenWidth, screenHeight);","\t","\tfloat sum = 0.0;","\t","\tfor(int c = 0; c < NEIGHBOUR_COUNT; c++){","\t\tvec2 N_rel_pos = uvRadius * neighbours[c];","\t\tvec2 N_abs_pos = vUv + N_rel_pos;","\t\t","\t\tfloat neighbourDepth = logToLinear(texture2D(colorMap, N_abs_pos).a);","\t\t","\t\tif(neighbourDepth != 0.0){","\t\t\tfloat Zn = ztransform(neighbourDepth);","\t\t\tfloat Znp = dot( vec4( N_rel_pos, Zn, 1.0), P );","\t\t\t","\t\t\tsum += obscurance( Znp, 0.05 * linearDepth );","\t\t}","\t}","\t","\treturn sum;","}","","void main(){","\tfloat linearDepth = logToLinear(texture2D(colorMap, vUv).a);","\t","\tfloat f = computeObscurance(linearDepth);","\tf = exp(-expScale * edlScale * f);","\t","\tvec4 color = texture2D(colorMap, vUv);","\tif(color.a == 0.0 && f >= 1.0){","\t\tdiscard;","\t}","\t","\tgl_FragColor = vec4(color.rgb * f, opacity);","}",""].join("\n"),Potree.Shaders["blur.vs"]=["","varying vec2 vUv;","","void main() {","    vUv = uv;","","    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),Potree.Shaders["blur.fs"]=["","uniform mat4 projectionMatrix;","","uniform float screenWidth;","uniform float screenHeight;","uniform float near;","uniform float far;","","uniform sampler2D map;","","varying vec2 vUv;","","void main() {","","\tfloat dx = 1.0 / screenWidth;","\tfloat dy = 1.0 / screenHeight;","","\tvec3 color = vec3(0.0, 0.0, 0.0);","\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;","    ","\tcolor = color / 9.0;","\t","\tgl_FragColor = vec4(color, 1.0);","\t","\t","}"].join("\n"),THREE.PerspectiveCamera.prototype.zoomTo=function(e,t){if(e.geometry||e.boundingSphere||e.boundingBox){e.geometry&&null===e.geometry.boundingSphere&&e.geometry.computeBoundingSphere(),e.updateMatrixWorld();var i;i=e.boundingSphere?e.boundingSphere:e.geometry&&e.geometry.boundingSphere?e.geometry.boundingSphere:e.boundingBox.getBoundingSphere();var n=t||1;i=i.clone().applyMatrix4(e.matrixWorld);var r=i.radius,o=this.fov*Math.PI/180;this.aspect<1&&(o*=this.aspect);var s=Math.abs(r/Math.sin(o/2))*n,a=this.getWorldDirection().multiplyScalar(-s);this.position.copy(i.center.clone().add(a))}},THREE.Ray.prototype.distanceToPlaneWithNegative=function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i},Potree.POCLoader=function(){},Potree.POCLoader.load=function(e,t){try{var i=new Potree.PointCloudOctreeGeometry;i.url=e;var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState&&(200===n.status||0===n.status)){var r=JSON.parse(n.responseText),o=new Potree.Version(r.version);0===r.octreeDir.indexOf("http")?i.octreeDir=r.octreeDir:i.octreeDir=e+"/../"+r.octreeDir,i.spacing=r.spacing,i.hierarchyStepSize=r.hierarchyStepSize,i.pointAttributes=r.pointAttributes;var s=new THREE.Vector3(r.boundingBox.lx,r.boundingBox.ly,r.boundingBox.lz),a=new THREE.Vector3(r.boundingBox.ux,r.boundingBox.uy,r.boundingBox.uz),l=new THREE.Box3(s,a),u=l.clone();r.tightBoundingBox&&(u.min.copy(new THREE.Vector3(r.tightBoundingBox.lx,r.tightBoundingBox.ly,r.tightBoundingBox.lz)),u.max.copy(new THREE.Vector3(r.tightBoundingBox.ux,r.tightBoundingBox.uy,r.tightBoundingBox.uz)));var c=new THREE.Vector3(0,0,0);c.set(-s.x,-s.y,-s.z),l.min.add(c),l.max.add(c),u.min.add(c),u.max.add(c),i.boundingBox=l,i.tightBoundingBox=u,i.boundingSphere=l.getBoundingSphere(),i.tightBoundingSphere=u.getBoundingSphere(),i.offset=c,"LAS"===r.pointAttributes?i.loader=new Potree.LasLazLoader(r.version):"LAZ"===r.pointAttributes?i.loader=new Potree.LasLazLoader(r.version):(i.loader=new Potree.BinaryLoader(r.version,l,r.scale),i.pointAttributes=new Potree.PointAttributes(i.pointAttributes));var h={},d="r",p=new Potree.PointCloudOctreeGeometryNode(d,i,l);if(p.level=0,p.hasChildren=!0,o.upTo("1.5")?p.numPoints=r.hierarchy[0][1]:p.numPoints=0,i.root=p,i.root.load(),h[d]=p,o.upTo("1.4"))for(var f=1;f<r.hierarchy.length;f++){var d=r.hierarchy[f][0],m=r.hierarchy[f][1],g=parseInt(d.charAt(d.length-1)),y=d.substring(0,d.length-1),v=h[y],E=d.length-1,l=Potree.POCLoader.createChildAABB(v.boundingBox,g),T=new Potree.PointCloudOctreeGeometryNode(d,i,l);T.level=E,T.numPoints=m,v.addChild(T),h[d]=T}i.nodes=h,t(i)}},n.send(null)}catch(r){console.log("loading failed: '"+e+"'"),console.log(r)}},Potree.POCLoader.loadPointAttributes=function(e){for(var t=e.pointAttributes,i=new Potree.PointAttributes,n=0;n<t.length;n++){var r=Potree.PointAttribute[t[n]];i.add(r)}return i},Potree.POCLoader.createChildAABB=function(e,t){var i,n,i=(THREE.Vector3,e.min),n=e.max,r=(new THREE.Vector3).copy(n).sub(i).multiplyScalar(.5),o=new THREE.Vector3(r.x,0,0),s=new THREE.Vector3(0,r.y,0),a=new THREE.Vector3(0,0,r.z),l=i,u=(new THREE.Vector3).add(i).add(r);return 1===t?(i=(new THREE.Vector3).copy(l).add(a),n=(new THREE.Vector3).copy(u).add(a)):3===t?(i=(new THREE.Vector3).copy(l).add(a).add(s),n=(new THREE.Vector3).copy(u).add(a).add(s)):0===t?(i=l,n=u):2===t?(i=(new THREE.Vector3).copy(l).add(s),n=(new THREE.Vector3).copy(u).add(s)):5===t?(i=(new THREE.Vector3).copy(l).add(a).add(o),n=(new THREE.Vector3).copy(u).add(a).add(o)):7===t?(i=(new THREE.Vector3).copy(l).add(r),n=(new THREE.Vector3).copy(u).add(r)):4===t?(i=(new THREE.Vector3).copy(l).add(o),n=(new THREE.Vector3).copy(u).add(o)):6===t&&(i=(new THREE.Vector3).copy(l).add(o).add(s),n=(new THREE.Vector3).copy(u).add(o).add(s)),new THREE.Box3(i,n)},Potree.PointAttributeNames={},Potree.PointAttributeNames.POSITION_CARTESIAN=0,Potree.PointAttributeNames.COLOR_PACKED=1,Potree.PointAttributeNames.COLOR_FLOATS_1=2,Potree.PointAttributeNames.COLOR_FLOATS_255=3,Potree.PointAttributeNames.NORMAL_FLOATS=4,Potree.PointAttributeNames.FILLER=5,Potree.PointAttributeNames.INTENSITY=6,Potree.PointAttributeNames.CLASSIFICATION=7,Potree.PointAttributeNames.NORMAL_SPHEREMAPPED=8,Potree.PointAttributeNames.NORMAL_OCT16=9,Potree.PointAttributeNames.NORMAL=10,Potree.PointAttributeTypes={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};var i=0;for(var obj in Potree.PointAttributeTypes)Potree.PointAttributeTypes[i]=Potree.PointAttributeTypes[obj],i++;Potree.PointAttribute=function(e,t,i){this.name=e,this.type=t,this.numElements=i,this.byteSize=this.numElements*this.type.size},Potree.PointAttribute.POSITION_CARTESIAN=new Potree.PointAttribute(Potree.PointAttributeNames.POSITION_CARTESIAN,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),Potree.PointAttribute.RGBA_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,4),Potree.PointAttribute.COLOR_PACKED=Potree.PointAttribute.RGBA_PACKED,Potree.PointAttribute.RGB_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,3),Potree.PointAttribute.NORMAL_FLOATS=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_FLOATS,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),Potree.PointAttribute.FILLER_1B=new Potree.PointAttribute(Potree.PointAttributeNames.FILLER,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1),Potree.PointAttribute.INTENSITY=new Potree.PointAttribute(Potree.PointAttributeNames.INTENSITY,Potree.PointAttributeTypes.DATA_TYPE_UINT16,1),Potree.PointAttribute.CLASSIFICATION=new Potree.PointAttribute(Potree.PointAttributeNames.CLASSIFICATION,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1),Potree.PointAttribute.NORMAL_SPHEREMAPPED=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_SPHEREMAPPED,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2),Potree.PointAttribute.NORMAL_OCT16=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_OCT16,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2),Potree.PointAttribute.NORMAL=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),Potree.PointAttributes=function(e){if(this.attributes=[],this.byteSize=0,this.size=0,null!=e)for(var t=0;t<e.length;t++){var i=e[t],n=Potree.PointAttribute[i];this.attributes.push(n),this.byteSize+=n.byteSize,this.size++}},Potree.PointAttributes.prototype.add=function(e){this.attributes.push(e),this.byteSize+=e.byteSize,this.size++},Potree.PointAttributes.prototype.hasColors=function(){for(var e in this.attributes){var t=this.attributes[e];if(t.name===Potree.PointAttributeNames.COLOR_PACKED)return!0}return!1},Potree.PointAttributes.prototype.hasNormals=function(){for(var e in this.attributes){var t=this.attributes[e];if(t===Potree.PointAttribute.NORMAL_SPHEREMAPPED||t===Potree.PointAttribute.NORMAL_FLOATS||t===Potree.PointAttribute.NORMAL||t===Potree.PointAttribute.NORMAL_OCT16)return!0}return!1},Potree.pickIndicesManager=function(){this.bufferAttribute=void 0,this._max=5e4,this._dirty=!0},Potree.pickIndicesManager.prototype.updateMax=function(e){e&&this._max<e&&(this._max=e,this._dirty=!0)},Object.defineProperty(Potree.pickIndicesManager.prototype,"max",{get:function(){return this._max},set:function(e){this._max!==e&&(this._max=e,this._dirty=!0)}}),Potree.pickIndicesManager.prototype.update=function(e){if(this._dirty){this.deleteBuffer(e);for(var t=new Uint8Array(3*this._max),i=0;i<this._max;i++)t[3*i+0]=i>>0&255,t[3*i+1]=i>>8&255,t[3*i+2]=i>>16&255;this.bufferAttribute=new THREE.BufferAttribute(t,3,(!0)),this._dirty=!1}},Potree.pickIndicesManager.prototype.deleteBuffer=function(e){if(this.bufferAttribute){var t=e.properties.get(this.bufferAttribute).__webglBuffer;void 0!==t&&e.context.deleteBuffer(t),this.bufferAttribute=void 0,
this._dirty=!0}},Potree.BinaryLoader=function(e,t,i){void 0===Potree.PIManager&&(Potree.PIManager=new Potree.pickIndicesManager),"string"==typeof e?this.version=new Potree.Version(e):this.version=e,this.boundingBox=t,this.scale=i},Potree.BinaryLoader.prototype.load=function(e){if(!e.loaded){var t=this,i=e.getURL();this.version.equalOrHigher("1.4")&&(i+=".bin");var n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState)if(200!==n.status&&0!==n.status||!n.response)e.failed=!0,console.log("Failed to load file! HTTP status: "+n.status+", file: "+i);else{var r=n.response;t.parse(e,r)}};try{n.send(null)}catch(r){e.failed=!0,console.log("fehler beim laden der punktwolke: "+r)}}},Potree.BinaryLoader.prototype.parse=function(e,t){var i=t.byteLength/e.pcoGeometry.pointAttributes.byteSize,n=e.pcoGeometry.pointAttributes;this.version.upTo("1.5")&&(e.numPoints=i);var r=Potree.workers.binaryDecoder.getWorker();r.onmessage=function(t){var n=t.data,o=n.attributeBuffers,s=new THREE.Box3((new THREE.Vector3).fromArray(n.tightBoundingBox.min),(new THREE.Vector3).fromArray(n.tightBoundingBox.max));r.onmessage=void 0,Potree.workers.binaryDecoder.returnWorker(r);var a=new THREE.BufferGeometry;for(var l in o)if(o.hasOwnProperty(l)){var u=o[l].buffer,c=o[l].attribute;c.numElements;parseInt(l)===Potree.PointAttributeNames.POSITION_CARTESIAN?a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(l)===Potree.PointAttributeNames.COLOR_PACKED?a.addAttribute("color",new THREE.BufferAttribute(new Uint8Array(u),3,(!0))):parseInt(l)===Potree.PointAttributeNames.INTENSITY?a.addAttribute("intensity",new THREE.BufferAttribute(new Float32Array(u),1)):parseInt(l)===Potree.PointAttributeNames.CLASSIFICATION?a.addAttribute("classification",new THREE.BufferAttribute(new Float32Array(u),1)):parseInt(l)===Potree.PointAttributeNames.NORMAL_SPHEREMAPPED?a.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(l)===Potree.PointAttributeNames.NORMAL_OCT16?a.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(l)===Potree.PointAttributeNames.NORMAL&&a.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3))}var h=a.attributes.position.count;if(Potree.PIManager.updateMax(h),!a.attributes.normal){var u=new Float32Array(3*i);a.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3))}a.boundingBox=e.boundingBox,e.geometry=a,e.tightBoundingBox=s,e.loaded=!0,e.loading=!1,e.pcoGeometry.numNodesLoading--};var o={buffer:t,pointAttributes:n,version:this.version.version,min:[e.boundingBox.min.x,e.boundingBox.min.y,e.boundingBox.min.z],offset:[e.pcoGeometry.offset.x,e.pcoGeometry.offset.y,e.pcoGeometry.offset.z],scale:this.scale};r.postMessage(o,[o.buffer])},Potree.LasLazLoader=function(e){"string"==typeof e?this.version=new Potree.Version(e):this.version=e},Potree.LasLazLoader.prototype.load=function(e){if(!e.loaded){var t=e.pcoGeometry.pointAttributes,i=e.getURL();this.version.equalOrHigher("1.4")&&(i+="."+t.toLowerCase());var n=this,r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType="arraybuffer",r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status&&r.response){var t=r.response;n.parse(e,t)}else e.failed=!0,console.log("Failed to load file! HTTP status: "+r.status+", file: "+i)},r.send(null)}},Potree.LasLazLoader.progressCB=function(e){},Potree.LasLazLoader.prototype.parse=function(e,t){var i=new LASFile(t),n=new Potree.LasLazBatcher(e);return Promise.resolve(i).cancellable().then(function(e){return e.open().then(function(){return e.isOpen=!0,e})["catch"](Promise.CancellationError,function(t){return e.close().then(function(){throw t})})}).then(function(e){return e.getHeader().then(function(t){return[e,t]})}).then(function(e){var t=e[0],i=e[1],r=1,o=0,s=r<=1?i.pointsCount:i.pointsCount/r,a=function(){var e=t.readData(1e6,0,r);return e.then(function(e){return n.push(new LASDecoder(e.buffer,i.pointsFormatId,i.pointsStructSize,e.count,i.scale,i.offset,i.mins,i.maxs)),o+=e.count,Potree.LasLazLoader.progressCB(o/s),e.hasMoreData?a():(i.totalRead=o,i.versionAsString=t.versionAsString,i.isCompressed=t.isCompressed,[t,i,n])})};return a()}).then(function(e){var t=e[0];return Potree.LasLazLoader.progressCB(1),t.close().then(function(){return t.isOpen=!1,Promise.delay(200).cancellable()}).then(function(){return e.slice(1)})})["catch"](Promise.CancellationError,function(e){if(i.isOpen)return i.close().then(function(){throw i.isOpen=!1,e});throw e})},Potree.LasLazLoader.prototype.handle=function(e,t){},Potree.LasLazBatcher=function(e){this.push=function(t){var i=Potree.workers.lasdecoder.getWorker(),n=new THREE.Vector3(t.mins[0],t.mins[1],t.mins[2]),r=new THREE.Vector3(t.maxs[0],t.maxs[1],t.maxs[2]);n.add(e.pcoGeometry.offset),r.add(e.pcoGeometry.offset),i.onmessage=function(o){for(var s=new THREE.BufferGeometry,a=t.pointsCount,l=o.data.position,u=o.data.color,c=o.data.intensity,h=new Uint8Array(o.data.classification),d=new Float32Array(h.byteLength),p=new Uint8Array(o.data.returnNumber),f=new Uint8Array(o.data.numberOfReturns),m=new Float32Array(p.byteLength),g=new Float32Array(f.byteLength),y=new Uint16Array(o.data.pointSourceID),v=new Float32Array(y.length),E=new ArrayBuffer(4*a),T=new Uint32Array(E),b=new THREE.Box3,C=new Float32Array(l),O=0;O<a;O++)d[O]=h[O],m[O]=p[O],g[O]=f[O],v[O]=y[O],T[O]=O,b.expandByPoint(new THREE.Vector3(C[3*O+0],C[3*O+1],C[3*O+2]));s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(l),3)),s.addAttribute("color",new THREE.BufferAttribute(new Float32Array(u),3)),s.addAttribute("intensity",new THREE.BufferAttribute(new Float32Array(c),1)),s.addAttribute("classification",new THREE.BufferAttribute(new Float32Array(d),1)),s.addAttribute("returnNumber",new THREE.BufferAttribute(new Float32Array(m),1)),s.addAttribute("numberOfReturns",new THREE.BufferAttribute(new Float32Array(g),1)),s.addAttribute("pointSourceID",new THREE.BufferAttribute(new Float32Array(v),1)),s.addAttribute("indices",Potree.indexAttributeBuffer),s.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*a),3));var x=new THREE.Box3((new THREE.Vector3).fromArray(o.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(o.data.tightBoundingBox.max));s.boundingBox=new THREE.Box3(n,r),e.tightBoundingBox=x,e.geometry=s,e.loaded=!0,e.loading=!1,e.pcoGeometry.numNodesLoading--,Potree.workers.lasdecoder.returnWorker(i)};var o={buffer:t.arrayb,numPoints:t.pointsCount,pointSize:t.pointSize,pointFormatID:2,scale:t.scale,offset:t.offset,mins:[e.pcoGeometry.boundingBox.min.x,e.pcoGeometry.boundingBox.min.y,e.pcoGeometry.boundingBox.min.z],maxs:[e.pcoGeometry.boundingBox.max.x,e.pcoGeometry.boundingBox.max.y,e.pcoGeometry.boundingBox.max.z],bbOffset:[e.pcoGeometry.offset.x,e.pcoGeometry.offset.y,e.pcoGeometry.offset.z]};i.postMessage(o,[o.buffer])}},Potree.Gradients={RAINBOW:[[0,new THREE.Color(.278,0,.714)],[1/6,new THREE.Color(0,0,1)],[2/6,new THREE.Color(0,1,1)],[.5,new THREE.Color(0,1,0)],[4/6,new THREE.Color(1,1,0)],[5/6,new THREE.Color(1,.64,0)],[1,new THREE.Color(1,0,0)]],GRAYSCALE:[[0,new THREE.Color(0,0,0)],[1,new THREE.Color(1,1,1)]]},Potree.Classification={DEFAULT:{0:new THREE.Vector4(.5,.5,.5,1),1:new THREE.Vector4(.5,.5,.5,1),2:new THREE.Vector4(.63,.32,.18,1),3:new THREE.Vector4(0,1,0,1),4:new THREE.Vector4(0,.8,0,1),5:new THREE.Vector4(0,.6,0,1),6:new THREE.Vector4(1,.66,0,1),7:new THREE.Vector4(1,0,1,1),8:new THREE.Vector4(1,0,0,1),9:new THREE.Vector4(0,0,1,1),12:new THREE.Vector4(1,1,0,1),DEFAULT:new THREE.Vector4(.3,.6,.6,1)}},Potree.PointSizeType={FIXED:0,ATTENUATED:1,ADAPTIVE:2},Potree.PointOpacityType={FIXED:0,ATTENUATED:1},Potree.PointShape={SQUARE:0,CIRCLE:1},Potree.PointColorType={RGB:0,COLOR:1,DEPTH:2,HEIGHT:3,INTENSITY:4,INTENSITY_GRADIENT:5,TREE_DEPTH:6,POINT_INDEX:7,CLASSIFICATION:8,RETURN_NUMBER:9,SOURCE:10,NORMAL:11,PHONG:12,TINTED_RGB:13},Potree.ClipMode={DISABLED:0,CLIP_OUTSIDE:1,HIGHLIGHT_INSIDE:2},Potree.TreeType={OCTREE:0,KDTREE:1},Potree.PointCloudMaterial=function(e){THREE.ShaderMaterial.call(this),e=e||{};var t=new THREE.Color(16777215),i=THREE.ImageUtils.generateDataTexture(2048,1,t);i.magFilter=THREE.NearestFilter,this.visibleNodesTexture=i;var n=e.size||1,r=e.minSize||1,o=e.maxSize||50,s=e.treeType||Potree.TreeType.OCTREE;this._pointOpacityType=Potree.PointOpacityType.ATTENUATED,this._pointSizeType=Potree.PointSizeType.ATTENUATED,this._pointShape=Potree.PointShape.SQUARE,this._interpolate=!1,this._pointColorType=Potree.PointColorType.RGB,this._useClipBox=!1,this.numClipBoxes=0,this._clipMode=Potree.ClipMode.DISABLED,this._weighted=!1,this._normalsFiltering=!1,this._depthMap=null,this._gradient=Potree.Gradients.RAINBOW,this._classification=Potree.Classification.DEFAULT,this.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(this._gradient),this.classificationTexture=Potree.PointCloudMaterial.generateClassificationTexture(this._classification),this.lights=!0,this._treeType=s,this._useLogarithmicDepthBuffer=!1,this._useEDL=!1;var a=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{alphaAttenuation:{type:"f",value:1},normalsFilteringThreshold:{type:"f",value:.1},spacing:{type:"f",value:1},fov:{type:"f",value:1},screenWidth:{type:"f",value:1},screenHeight:{type:"f",value:1},near:{type:"f",value:.1},far:{type:"f",value:1},uColor:{type:"c",value:new THREE.Color(16777215)},opacity:{type:"f",value:1},size:{type:"f",value:10},minSize:{type:"f",value:2},maxSize:{type:"f",value:2},octreeSize:{type:"f",value:0},bbSize:{type:"fv",value:[0,0,0]},heightMin:{type:"f",value:0},heightMax:{type:"f",value:1},intensityMin:{type:"f",value:0},intensityMax:{type:"f",value:1},clipBoxCount:{type:"f",value:0},visibleNodes:{type:"t",value:null},pcIndex:{type:"f",value:0},gradient:{type:"t",value:null},classificationLUT:{type:"t",value:null},clipBoxes:{type:"Matrix4fv",value:[]},depthMap:{type:"t",value:null},diffuse:{type:"fv",value:[1,1,1]},ambient:{type:"fv",value:[.1,.1,.1]},ambientLightColor:{type:"fv",value:[1,1,1]},directionalLightColor:{type:"fv",value:null},directionalLightDirection:{type:"fv",value:null},pointLightColor:{type:"fv",value:null},pointLightPosition:{type:"fv",value:null},pointLightDistance:{type:"fv1",value:null},pointLightDecay:{type:"fv1",value:null},spotLightColor:{type:"fv",value:null},spotLightPosition:{type:"fv",value:null},spotLightDistance:{type:"fv1",value:null},spotLightDecay:{type:"fv1",value:null},spotLightDirection:{type:"fv",value:null},spotLightAngleCos:{type:"fv1",value:null},spotLightExponent:{type:"fv1",value:null},hemisphereLightSkyColor:{type:"fv",value:null},hemisphereLightGroundColor:{type:"fv",value:null},hemisphereLightDirection:{type:"fv",value:null}}]);a.visibleNodes.value=this.visibleNodesTexture,a.gradient.value=this.gradientTexture,a.classificationLUT.value=this.classificationTexture,this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.setValues({uniforms:a,vertexShader:this.getDefines()+Potree.Shaders["pointcloud.vs"],fragmentShader:this.getDefines()+Potree.Shaders["pointcloud.fs"],vertexColors:THREE.VertexColors,size:n,minSize:r,maxSize:o,pcIndex:0,alphaTest:.9})},Potree.PointCloudMaterial.prototype=new THREE.ShaderMaterial,Potree.PointCloudMaterial.prototype.updateShaderSource=function(){var e=this.getDefines()+Potree.Shaders["pointcloud.vs"],t=this.getDefines()+Potree.Shaders["pointcloud.fs"];this.setValues({vertexShader:e,fragmentShader:t}),this.depthMap&&(this.uniforms.depthMap.value=this.depthMap,this.setValues({depthMap:this.depthMap})),1===this.opacity?this.setValues({blending:THREE.NoBlending,depthTest:!0,depthWrite:!0}):this.setValues({blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1,depthWrite:!0}),this.weighted&&this.setValues({blending:THREE.AdditiveBlending,transparent:!0,depthTest:!0,depthWrite:!1}),this.needsUpdate=!0},Potree.PointCloudMaterial.prototype.getDefines=function(){var e="";return this.pointSizeType===Potree.PointSizeType.FIXED?e+="#define fixed_point_size\n":this.pointSizeType===Potree.PointSizeType.ATTENUATED?e+="#define attenuated_point_size\n":this.pointSizeType===Potree.PointSizeType.ADAPTIVE&&(e+="#define adaptive_point_size\n"),this.pointOpacityType===Potree.PointOpacityType.FIXED?e+="#define fixed_opacity\n":this.pointOpacityType===Potree.PointOpacityType.ATTENUATED&&(e+="#define attenuated_opacity\n"),this.pointShape===Potree.PointShape.SQUARE?e+="#define square_point_shape\n":this.pointShape===Potree.PointShape.CIRCLE&&(e+="#define circle_point_shape\n"),this._interpolate&&(e+="#define use_interpolation\n"),this._useLogarithmicDepthBuffer&&(e+="#define use_logarithmic_depth_buffer\n"),this._useEDL&&(e+="#define use_edl\n"),this._pointColorType===Potree.PointColorType.RGB?e+="#define color_type_rgb\n":this._pointColorType===Potree.PointColorType.COLOR?e+="#define color_type_color\n":this._pointColorType===Potree.PointColorType.DEPTH?e+="#define color_type_depth\n":this._pointColorType===Potree.PointColorType.HEIGHT?e+="#define color_type_height\n":this._pointColorType===Potree.PointColorType.INTENSITY?e+="#define color_type_intensity\n":this._pointColorType===Potree.PointColorType.INTENSITY_GRADIENT?e+="#define color_type_intensity_gradient\n":this._pointColorType===Potree.PointColorType.TREE_DEPTH?e+="#define color_type_tree_depth\n":this._pointColorType===Potree.PointColorType.POINT_INDEX?e+="#define color_type_point_index\n":this._pointColorType===Potree.PointColorType.CLASSIFICATION?e+="#define color_type_classification\n":this._pointColorType===Potree.PointColorType.RETURN_NUMBER?e+="#define color_type_return_number\n":this._pointColorType===Potree.PointColorType.SOURCE?e+="#define color_type_source\n":this._pointColorType===Potree.PointColorType.NORMAL?e+="#define color_type_normal\n":this._pointColorType===Potree.PointColorType.PHONG?e+="#define color_type_phong\n":this._pointColorType===Potree.PointColorType.TINTED_RGB&&(e+="#define color_type_tinted\n"),this.clipMode===Potree.ClipMode.DISABLED?e+="#define clip_disabled\n":this.clipMode===Potree.ClipMode.CLIP_OUTSIDE?e+="#define clip_outside\n":this.clipMode===Potree.ClipMode.HIGHLIGHT_INSIDE&&(e+="#define clip_highlight_inside\n"),this._treeType===Potree.TreeType.OCTREE?e+="#define tree_type_octree\n":this._treeType===Potree.TreeType.KDTREE&&(e+="#define tree_type_kdtree\n"),this.weighted&&(e+="#define weighted_splats\n"),this.numClipBoxes>0&&(e+="#define use_clip_box\n"),this.normalsFiltering&&(e+="#define normals_filtering\n"),e},Potree.PointCloudMaterial.prototype.setClipBoxes=function(e){if(e){this.clipBoxes=e;var t=this.numClipBoxes!=e.length&&(0===e.length||0===this.numClipBoxes);this.numClipBoxes=e.length,this.uniforms.clipBoxCount.value=this.numClipBoxes,t&&this.updateShaderSource(),this.uniforms.clipBoxes.value=new Float32Array(16*this.numClipBoxes);for(var i=0;i<this.numClipBoxes;i++){var n=e[i];this.uniforms.clipBoxes.value.set(n.elements,16*i)}}},Object.defineProperty(Potree.PointCloudMaterial.prototype,"gradient",{get:function(){return this._gradient},set:function(e){this._gradient!==e&&(this._gradient=e,this.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"classification",{get:function(){return this._classification},set:function(e){this._classification=e,this.classificationTexture=Potree.PointCloudMaterial.generateClassificationTexture(this._classification),this.uniforms.classificationLUT.value=this.classificationTexture}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"normalsFilteringThreshold",{get:function(){return this.uniforms.normalsFilteringThreshold.value},set:function(e){this.uniforms.normalsFilteringThreshold.value!==e&&(this.uniforms.normalsFilteringThreshold.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"spacing",{get:function(){return this.uniforms.spacing.value},set:function(e){this.uniforms.spacing.value!==e&&(this.uniforms.spacing.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"useClipBox",{get:function(){return this._useClipBox},set:function(e){this._useClipBox!==e&&(this._useClipBox=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"normalsFiltering",{get:function(){return this._normalsFiltering},set:function(e){this._normalsFiltering!==e&&(this._normalsFiltering=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"weighted",{get:function(){return this._weighted},set:function(e){this._weighted!==e&&(this._weighted=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"fov",{get:function(){return this.uniforms.fov.value},set:function(e){this.uniforms.fov.value!==e&&(this.uniforms.fov.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"screenWidth",{get:function(){return this.uniforms.screenWidth.value},set:function(e){this.uniforms.screenWidth.value!==e&&(this.uniforms.screenWidth.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"screenHeight",{get:function(){return this.uniforms.screenHeight.value},set:function(e){this.uniforms.screenHeight.value!==e&&(this.uniforms.screenHeight.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"near",{get:function(){return this.uniforms.near.value},set:function(e){this.uniforms.near.value!==e&&(this.uniforms.near.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"far",{get:function(){return this.uniforms.far.value},set:function(e){this.uniforms.far.value!==e&&(this.uniforms.far.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity&&this.uniforms.opacity.value!==e&&(this.uniforms.opacity.value=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointColorType",{get:function(){return this._pointColorType},set:function(e){this._pointColorType!==e&&(this._pointColorType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointOpacityType",{get:function(){return this._pointOpacityType},set:function(e){this._pointOpacityType!==e&&(this._pointOpacityType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"alphaAttenuation",{get:function(){return this.uniforms.alphaAttenuation.value},set:function(e){this.uniforms.alphaAttenuation.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"depthMap",{get:function(){return this._depthMap},set:function(e){this._depthMap!==e&&(this._depthMap=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointSizeType",{get:function(){return this._pointSizeType},set:function(e){this._pointSizeType!==e&&(this._pointSizeType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"clipMode",{get:function(){return this._clipMode},set:function(e){this._clipMode!==e&&(this._clipMode=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"interpolate",{get:function(){return this._interpolate},set:function(e){this._interpolate!==e&&(this._interpolate=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"useEDL",{get:function(){return this._useEDL},set:function(e){this._useEDL!==e&&(this._useEDL=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"useLogarithmicDepthBuffer",{get:function(){return this._useLogarithmicDepthBuffer},set:function(e){this._useLogarithmicDepthBuffer!==e&&(this._useLogarithmicDepthBuffer=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"color",{get:function(){return this.uniforms.uColor.value},set:function(e){this.uniforms.uColor.value!==e&&(this.uniforms.uColor.value.copy(e),this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointShape",{get:function(){return this._pointShape},set:function(e){this._pointShape!==e&&(this._pointShape=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"size",{get:function(){return this.uniforms.size.value},set:function(e){this.uniforms.size.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"minSize",{get:function(){return this.uniforms.minSize.value},set:function(e){this.uniforms.minSize.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"maxSize",{get:function(){return this.uniforms.maxSize.value},set:function(e){this.uniforms.maxSize.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"heightMin",{get:function(){return this.uniforms.heightMin.value},set:function(e){this.uniforms.heightMin.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"heightMax",{get:function(){return this.uniforms.heightMax.value},set:function(e){this.uniforms.heightMax.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"intensityMin",{get:function(){return this.uniforms.intensityMin.value},set:function(e){this.uniforms.intensityMin.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"intensityMax",{get:function(){return this.uniforms.intensityMax.value},set:function(e){this.uniforms.intensityMax.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pcIndex",{get:function(){return this.uniforms.pcIndex.value},set:function(e){this.uniforms.pcIndex.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"treeType",{get:function(){return this._treeType},set:function(e){this._treeType!=e&&(this._treeType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"bbSize",{get:function(){return this.uniforms.bbSize.value},set:function(e){this.uniforms.bbSize.value=e}}),Potree.PointCloudMaterial.generateGradientTexture=function(e){var t=64;canvas=document.createElement("canvas"),canvas.width=t,canvas.height=t;var i=canvas.getContext("2d");i.rect(0,0,t,t);for(var n=i.createLinearGradient(0,0,t,t),r=0;r<e.length;r++){var o=e[r];n.addColorStop(o[0],"#"+o[1].getHexString())}i.fillStyle=n,i.fill();var s=new THREE.CanvasTexture(canvas);return s},Potree.PointCloudMaterial.generateClassificationTexture=function(e){for(var t=256,i=256,n=t*i,r=new Uint8Array(4*n),o=0;o<t;o++)for(var s=0;s<i;s++){var a,l=o+t*s;a=e[o]?e[o]:e.DEFAULT,r[4*l+0]=255*a.x,r[4*l+1]=255*a.y,r[4*l+2]=255*a.z,r[4*l+3]=255*a.w}var u=new THREE.DataTexture(r,t,i,THREE.RGBAFormat);return u.magFilter=THREE.NearestFilter,u.needsUpdate=!0,u},Potree.EyeDomeLightingMaterial=function(e){THREE.Material.call(this),e=e||{};for(var t=8,i=new Float32Array(2*t),n=0;n<t;n++)i[2*n+0]=Math.cos(2*n*Math.PI/t),i[2*n+1]=Math.sin(2*n*Math.PI/t);var r=new THREE.Vector3(0,0,1).normalize(),o=THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},near:{type:"f",value:0},far:{type:"f",value:0},expScale:{type:"f",value:100},edlScale:{type:"f",value:1},radius:{type:"f",value:3},lightDir:{type:"v3",value:null},neighbours:{type:"2fv",value:null},depthMap:{type:"t",value:null},colorMap:{type:"t",value:null},opacity:{type:"f",value:1}}]);o.lightDir.value=r,o.neighbours.value=i,this.setValues({uniforms:o,vertexShader:Potree.Shaders["edl.vs"],fragmentShader:Potree.Shaders["edl.fs"]})},Potree.EyeDomeLightingMaterial.prototype=new THREE.ShaderMaterial,Potree.BlurMaterial=function(e){THREE.Material.call(this),e=e||{};var t={near:{type:"f",value:0},far:{type:"f",value:0},screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}};this.setValues({uniforms:t,vertexShader:Potree.Shaders["blur.vs"],fragmentShader:Potree.Shaders["blur.fs"]})},Potree.BlurMaterial.prototype=new THREE.ShaderMaterial,LRU.prototype.size=function(){return this.elements},LRU.prototype.contains=function(e){return null==this.items[e.id]},LRU.prototype.touch=function(e){if(e.loaded){var t;null==this.items[e.id]?(t=new LRUItem(e),t.previous=this.last,this.last=t,null!==t.previous&&(t.previous.next=t),this.items[e.id]=t,this.elements++,null===this.first&&(this.first=t),this.numPoints+=e.numPoints):(t=this.items[e.id],null===t.previous?null!==t.next&&(this.first=t.next,this.first.previous=null,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t):null===t.next||(t.previous.next=t.next,t.next.previous=t.previous,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t))}},LRU.prototype.remove=function(e){var t=this.items[e.id];t&&(1===this.elements?(this.first=null,this.last=null):(t.previous||(this.first=t.next,this.first.previous=null),t.next||(this.last=t.previous,this.last.next=null),t.previous&&t.next&&(t.previous.next=t.next,t.next.previous=t.previous)),delete this.items[e.id],this.elements--,this.numPoints-=e.numPoints)},LRU.prototype.getLRUItem=function(){if(null===this.first)return null;var e=this.first;return e.node},LRU.prototype.toString=function(){for(var e="{ ",t=this.first;null!==t;)e+=t.node.id,null!==t.next&&(e+=", "),t=t.next;return e+="}",e+="("+this.size()+")"},LRU.prototype.freeMemory=function(){if(!(this.elements<=1))for(;this.numPoints>Potree.pointLoadLimit;){var e=this.first,t=e.node;this.disposeDescendants(t)}},LRU.prototype.disposeDescendants=function(e){var t=[];for(t.push(e);t.length>0;){var i=t.pop();i.dispose(),this.remove(i);for(var n in i.children)if(i.children.hasOwnProperty(n)){var r=i.children[n];r.loaded&&t.push(i.children[n])}}},Potree.Annotation=function(e,t){var i=this;Potree.Annotation.counter++,this.viewer=e,this.ordinal=t.ordinal||Potree.Annotation.counter,this.title=t.title||"No Title",this.description=t.description||"",this.scene=t.scene||null,this.position=t.position||new THREE.Vector3(0,0,0),this.cameraPosition=t.cameraPosition,this.cameraTarget=t.cameraTarget||this.position,this.view=t.view||null,this.keepOpen=!1,this.domElement=document.createElement("div"),this.domElement.style.position="fixed",this.domElement.style.opacity="0.5",this.domElement.className="annotation",this.elOrdinal=document.createElement("div"),this.elOrdinal.style.position="absolute",this.elOrdinal.style.width="1.5em",this.elOrdinal.style.height="1.5em",this.elOrdinal.style.color="white",this.elOrdinal.style.backgroundColor="black",this.elOrdinal.style.borderRadius="1.5em",this.elOrdinal.style.fontSize="1em",this.elOrdinal.style.opacity="1",this.elOrdinal.style.zIndex="100",this.domElement.appendChild(this.elOrdinal),this.elOrdinal.onmouseenter=function(){},this.elOrdinal.onmouseleave=function(){},this.elOrdinal.onclick=function(){i.moveHere(i.viewer.camera)},this.domElement.onmouseleave=function(){},this.elOrdinalText=document.createElement("span"),this.elOrdinalText.style.display="inline-block",this.elOrdinalText.style.verticalAlign="middle",this.elOrdinalText.style.lineHeight="1.5em",this.elOrdinalText.style.textAlign="center",this.elOrdinalText.style.width="100%",this.elOrdinalText.style.fontFamily="Arial",this.elOrdinalText.style.cursor="default",this.elOrdinalText.innerHTML=this.ordinal,this.elOrdinalText.userSelect="none",this.elOrdinal.appendChild(this.elOrdinalText),this.elButtons=document.createElement("div"),this.elButtons.style.position="absolute",this.elButtons.style.display="block",this.elButtons.style.height="1.5em",this.elButtons.style.backgroundColor="#333333",this.elButtons.style.zIndex="50",this.elButtons.style.borderRadius="1.5em 1.5em 1.5em 1.5em",this.elButtons.style.cursor="default",this.elButtons.style.padding="0.0em 0.0em 0em 1.5em",this.elButtons.style.whiteSpace="nowrap",this.domElement.appendChild(this.elButtons),this.description&&(this.elButtonsInfo=document.createElement("img"),this.elButtonsInfo.src="../resources/icons/info_32x32.png",this.elButtonsInfo.style.width="1.5em",this.elButtonsInfo.style.padding="0em 0em 0em 0.2em",this.elButtons.appendChild(this.elButtonsInfo),this.elButtonsInfo.onclick=function(){i.openDescriptionWindow()}),this.scene&&(this.elButtonsScene=document.createElement("img"),this.elButtonsScene.src="../resources/icons/goto_32x32.png",this.elButtonsScene.style.width="1.5em",this.elButtonsScene.style.padding="0em 0em 0em 0.2em",this.elButtonsScene.onclick=function(){loadScene(i.scene)},this.elButtons.appendChild(this.elButtonsScene)),this.domElement.onmouseenter=function(){i.domElement.style.opacity="0.8"},this.domElement.onmouseleave=function(){i.domElement.style.opacity="0.5"},this.openBar=function(){i.elOrdinal.style.opacity=.8,i.elButtons.style.display="block"},this.closeBar=function(){this.keepOpen||(i.elOrdinal.style.opacity=.5,i.elButtons.style.display="none")},this.openDescriptionWindow=function(){this.elDescription?this.elDescription.style.display="block":(this.elDescription=document.createElement("div"),this.elDescription.className="description",this.elDescriptionHeader=document.createElement("div"),this.elDescriptionHeader.className="description-header",this.elDescription.appendChild(this.elDescriptionHeader),this.elDescriptionTitle=document.createElement("span"),this.elDescriptionTitle.className="description-title",this.elDescriptionTitle.innerHTML=i.title,this.elDescriptionHeader.appendChild(this.elDescriptionTitle),this.elDescriptionButtons=document.createElement("span"),this.elDescriptionButtons.className="description-buttons",this.elDescriptionHeader.appendChild(this.elDescriptionButtons),this.elDescriptionClose=document.createElement("img"),this.elDescriptionClose.src="../resources/icons/close_32x32_black.png",this.elDescriptionClose.onmouseenter=function(){this.src="../resources/icons/close_32x32_black_shadow.png"},this.elDescriptionClose.onmouseleave=function(){this.src="../resources/icons/close_32x32_black.png"},this.elDescriptionClose.style.height="1.5em",this.elDescriptionClose.onclick=function(){i.elDescription.style.display="none"},this.elDescriptionButtons.appendChild(this.elDescriptionClose),this.elDescriptionContent=document.createElement("div"),this.elDescriptionContent.className="description-content",this.elDescriptionContent.innerHTML=this.description,this.elDescription.appendChild(this.elDescriptionContent),document.body.appendChild(this.elDescription))},this.moveHere=function(e){var t=800,n=TWEEN.Easing.Quartic.Out,r=new TWEEN.Tween(e.position).to(i.cameraPosition,t);r.easing(n),r.start();var o=e.position.distanceTo(i.cameraTarget),s=(new THREE.Vector3).addVectors(e.position,e.getWorldDirection().clone().multiplyScalar(o)),r=new TWEEN.Tween(s).to(i.cameraTarget,t);r.easing(n),r.onUpdate(function(){e.lookAt(s),i.viewer.orbitControls.target.copy(s)}),r.onComplete(function(){e.lookAt(s),i.viewer.orbitControls.target.copy(s)}),r.start()},this.dispose=function(){if(this.descriptionDialog){var e="annotation_description_"+i.ordinal;$("#"+e).dialog("destroy")}this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this.elDescription&&this.elDescription.parentElement&&this.elDescription.parentElement.removeChild(this.elDescription)}},Potree.Annotation.counter=0,Potree.ProfileData=function(e){this.profile=e,this.segments=[],this.boundingBox=new THREE.Box3,this.projectedBoundingBox=new THREE.Box2;for(var t=new THREE.Vector3,i=0;i<e.points.length-1;i++){var n=e.points[i],r=e.points[i+1],o=(new THREE.Vector3).addVectors(r,n).multiplyScalar(.5),s=new THREE.Vector3(n.x,0,n.z).distanceTo(new THREE.Vector3(r.x,0,r.z)),a=(new THREE.Vector3).subVectors(r,n).normalize(),l=new THREE.Vector3(0,1,0),u=(new THREE.Vector3).crossVectors(a,l).normalize(),c=u,h=(new THREE.Plane).setFromNormalAndCoplanarPoint(c,n),d=(new THREE.Plane).setFromNormalAndCoplanarPoint(a,o),p=function(e,t,i){var n=e,r=t,o=i,s=new THREE.Vector3(1,0,0),a=(new THREE.Vector3).subVectors(r,n);
a.y=0,a.normalize();var l=Math.acos(s.dot(a));return a.z>0&&(l=-l),function(e){var t=(new THREE.Matrix4).makeTranslation(-n.x,0,-n.z),i=(new THREE.Matrix4).makeRotationY(-l),r=(new THREE.Matrix4).makeTranslation(o.x,0,0),s=e.clone();return s.applyMatrix4(t),s.applyMatrix4(i),s.applyMatrix4(r),s}}(n,r,t.clone()),f={start:n,end:r,cutPlane:h,halfPlane:d,length:s,points:null,project:p};this.segments.push(f),t.x+=new THREE.Vector3(n.x,0,n.z).distanceTo(new THREE.Vector3(r.x,0,r.z)),t.y+=r.y-n.y}this.projectedBoundingBox.min.x=0,this.projectedBoundingBox.min.y=Number.POSITIVE_INFINITY,this.projectedBoundingBox.max.x=t.x,this.projectedBoundingBox.max.y=Number.NEGATIVE_INFINITY,this.size=function(){for(var e=0,t=0;t<this.segments.length;t++)this.segments[t].points&&(e+=this.segments[t].points.numPoints);return e}},Potree.ProfileRequest=function(e,t,i,n){this.pointcloud=e,this.profile=t,this.maxDepth=i||Number.MAX_VALUE,this.callback=n,this.temporaryResult=new Potree.ProfileData(this.profile),this.pointsServed=0,this.priorityQueue=new BinaryHeap(function(e){return 1/e.weight}),this.initialize=function(){this.priorityQueue.push({node:e.pcoGeometry.root,weight:1}),this.traverse(e.pcoGeometry.root)},this.traverse=function(t){for(var i=[],n=0;n<8;n++){var r=t.children[n];r&&e.nodeIntersectsProfile(r,this.profile)&&i.push(r)}for(;i.length>0;){var t=i.pop(),o=t.boundingSphere.radius;if(this.priorityQueue.push({node:t,weight:o}),t.level<this.maxDepth)for(var n=0;n<8;n++){var r=t.children[n];r&&e.nodeIntersectsProfile(r,this.profile)&&i.push(r)}}},this.update=function(){for(var t=[],i=0;i<Math.min(2,this.priorityQueue.size());i++){var r=this.priorityQueue.pop(),o=r.node;o.loaded?(t.push(o),Potree.PointCloudOctree.lru.touch(o),o.level%o.pcoGeometry.hierarchyStepSize===0&&o.hasChildren&&this.traverse(o)):(o.load(),this.priorityQueue.push(r))}if(t.length>0&&(this.getPointsInsideProfile(t,this.temporaryResult),this.temporaryResult.size()>100&&(this.pointsServed+=this.temporaryResult.size(),n.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Potree.ProfileData(this.profile))),0===this.priorityQueue.size()){this.temporaryResult.size()>0&&(this.pointsServed+=this.temporaryResult.size(),n.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Potree.ProfileData(this.profile)),n.onFinish({request:this});var s=e.profileRequests.indexOf(this);s>=0&&e.profileRequests.splice(s,1)}},this.getPointsInsideProfile=function(i,n){for(var r=0;r<n.segments.length;r++){for(var o=n.segments[r],s=0;s<i.length;s++){var a=i[s],l=a.geometry,u=l.attributes.position,c=u.array,h=a.numPoints;if(!o.points){o.points={},o.points.boundingBox=new THREE.Box3;for(var d in l.attributes)l.attributes.hasOwnProperty(d)&&("indices"===d||(o.points[d]=[]))}for(var p=0;p<h;p++){var f=new THREE.Vector3(c[3*p],c[3*p+1],c[3*p+2]);f.applyMatrix4(e.matrixWorld);var m=Math.abs(o.cutPlane.distanceToPoint(f)),g=Math.abs(o.halfPlane.distanceToPoint(f));if(m<t.width/2&&g<o.length/2){o.points.boundingBox.expandByPoint(f);for(var d in l.attributes)if(l.attributes.hasOwnProperty(d))if("position"===d)o.points[d].push(f);else if("indices"===d);else{var y=l.attributes[d];if(1===y.itemSize)o.points[d].push(y.array[p+E]);else{for(var v=[],E=0;E<y.itemSize;E++)v.push(y.array[p*y.itemSize+E]);o.points[d].push(v)}}}}}o.points.numPoints=o.points.position.length,o.points.numPoints>0&&(n.boundingBox.expandByPoint(o.points.boundingBox.min),n.boundingBox.expandByPoint(o.points.boundingBox.max),n.projectedBoundingBox.expandByPoint(new THREE.Vector2(0,n.boundingBox.min.y)),n.projectedBoundingBox.expandByPoint(new THREE.Vector2(0,n.boundingBox.max.y)))}},this.cancel=function(){n.onCancel(),this.priorityQueue=new BinaryHeap(function(e){return 1/e.weight});var t=e.profileRequests.indexOf(this);t>=0&&e.profileRequests.splice(t,1)},this.initialize()},Potree.PointCloudOctreeNode=function(){this.children={},this.sceneNode=null,this.octree=null},Potree.PointCloudOctree=function(e,t){THREE.Object3D.call(this),Potree.PointCloudOctree.lru=Potree.PointCloudOctree.lru||new LRU,this.pcoGeometry=e,this.boundingBox=this.pcoGeometry.tightBoundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(),this.material=t||new Potree.PointCloudMaterial,this.visiblePointsTarget=2e6,this.minimumNodePixelSize=150,this.level=0,this.position.sub(e.offset),this.updateMatrix(),this.showBoundingBox=!1,this.boundingBoxNodes=[],this.loadQueue=[],this.visibleBounds=new THREE.Box3,this.visibleNodes=[],this.visibleGeometry=[],this.pickTarget=null,this.generateDEM=!1,this.profileRequests=[],this.root=this.pcoGeometry.root},Potree.PointCloudOctree.prototype=Object.create(THREE.Object3D.prototype),Potree.PointCloudOctree.prototype.updateVisibility=function(e,t){this.numVisibleNodes=0,this.numVisiblePoints=0,e.updateMatrixWorld();var i=new THREE.Frustum,n=e.matrixWorldInverse,r=this.matrixWorld,o=e.projectionMatrix,s=(new THREE.Matrix4).multiply(o).multiply(n).multiply(r);i.setFromMatrix(s);var a=e.matrixWorld,l=(new THREE.Matrix4).getInverse(r),u=(new THREE.Matrix4).multiply(l).multiply(a),c=(new THREE.Vector3).setFromMatrixPosition(u),h=new BinaryHeap(function(e){return 1/e.weight});h.push({node:this.root,weight:1});var d=[],p=[],f=[];this.root instanceof Potree.PointCloudOctreeNode&&this.hideDescendants(this.root.sceneNode);for(var m=0;m<this.boundingBoxNodes.length;m++)this.boundingBoxNodes[m].visible=!1;for(;h.size()>0;){var g=h.pop(),y=g.node,v=g.parent,E=y.boundingBox,T=i.intersectsBox(E),b=T;if(b=b&&!(this.numVisiblePoints+y.numPoints>this.visiblePointsTarget)){if(this.numVisibleNodes++,this.numVisiblePoints+=y.numPoints,y instanceof Potree.PointCloudOctreeGeometryNode){var C=y,O=C.geometry;if(("undefined"==typeof v||v instanceof Potree.PointCloudOctreeNode)&&C.loaded){var x=new Potree.PointCloudOctreeNode,w=new THREE.Points(O,this.material);w.visible=!1,x.octree=this,x.name=C.name,x.level=C.level,x.numPoints=C.numPoints,x.boundingBox=O.boundingBox,x.tightBoundingBox=O.tightBoundingBox,x.boundingSphere=x.boundingBox.getBoundingSphere(),x.geometryNode=C,x.parent=v,x.children={};for(var R in C.children)x.children[R]=C.children[R];if(w.boundingBox=x.boundingBox,w.boundingSphere=x.boundingSphere,w.numPoints=x.numPoints,w.level=x.level,x.sceneNode=w,"undefined"==typeof y.parent)this.root=x,this.add(x.sceneNode),w.matrixWorld.multiplyMatrices(this.matrixWorld,w.matrix);else{var L=parseInt(x.name[x.name.length-1]);v.sceneNode.add(w),v.children[L]=x,w.matrixWorld.multiplyMatrices(v.sceneNode.matrixWorld,w.matrix)}var S=function(e,t,i){return function(){var n=parseInt(t.name[t.name.length-1]);e.sceneNode.remove(t.sceneNode),e.children[n]=i}}(v,x,y);x.geometryNode.oneTimeDisposeHandlers.push(S),y=x}C.loaded||(f.push(y),p.push(y))}if(y instanceof Potree.PointCloudOctreeNode){if(Potree.PointCloudOctree.lru.touch(y.geometryNode),y.sceneNode.visible=!0,y.sceneNode.material=this.material,d.push(y),p.push(y.geometryNode),y.parent?y.sceneNode.matrixWorld.multiplyMatrices(y.parent.sceneNode.matrixWorld,y.sceneNode.matrix):y.sceneNode.matrixWorld.multiplyMatrices(this.matrixWorld,y.sceneNode.matrix),this.showBoundingBox&&!y.boundingBoxNode){var _;_=new THREE.BoxHelper(y.sceneNode),this.add(_),this.boundingBoxNodes.push(_),y.boundingBoxNode=_,y.boundingBoxNode.matrix.copy(y.sceneNode.matrixWorld),y.boundingBoxNode.matrixAutoUpdate=!1,y.boundingBoxNode.matrixWorldNeedsUpdate=!0}else this.showBoundingBox?(y.boundingBoxNode.visible=!0,y.boundingBoxNode.matrixWorld.copy(y.sceneNode.matrixWorld)):!this.showBoundingBox&&y.boundingBoxNode&&(y.boundingBoxNode.visible=!1);this.generateDEM&&y.level<=2&&(y.dem||(y.dem=this.createDEM(y)))}for(var m=0;m<8;m++)if(y.children[m]){var I,D=y.children[m],M=D.boundingSphere,A=M.center.distanceTo(c),N=M.radius;if(void 0!==e.fov){var P=e.fov/2*Math.PI/180,k=1/Math.tan(P)*N/Math.sqrt(A*A-N*N);I=t.domElement.clientHeight*k}else I=t.domElement.clientHeight*N*e.zoom;var I=t.domElement.clientHeight*k;if(!(I<this.minimumNodePixelSize)){var H=k;A-N<0&&(H=Number.MAX_VALUE),h.push({node:D,parent:y,weight:H})}}}}this.visibleNodes=d,this.visibleGeometry=p;for(var m=0;m<Math.min(5,f.length);m++)f[m].load()},Potree.PointCloudOctree.prototype.updateVisibleBounds=function(){for(var e=[],t=0;t<this.visibleNodes.length;t++){for(var i=this.visibleNodes[t],n=!0,r=0;r<i.children.length;r++){var o=i.children[r];o instanceof Potree.PointCloudOctreeNode?n=n&&!o.sceneNode.visible:o instanceof Potree.PointCloudOctreeGeometryNode&&(n=!0)}n&&e.push(i)}this.visibleBounds.min=new THREE.Vector3(1/0,1/0,1/0),this.visibleBounds.max=new THREE.Vector3((-(1/0)),(-(1/0)),(-(1/0)));for(var t=0;t<e.length;t++){var i=e[t];this.visibleBounds.expandByPoint(i.boundingBox.min),this.visibleBounds.expandByPoint(i.boundingBox.max)}},Potree.PointCloudOctree.prototype.updateMaterial=function(e,t,i,n){e.fov=i.fov*(Math.PI/180),e.screenWidth=n.domElement.clientWidth,e.screenHeight=n.domElement.clientHeight,e.spacing=this.pcoGeometry.spacing,e.near=i.near,e.far=i.far,e.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.size().x,e.pointSizeType&&(e.pointSizeType!==Potree.PointSizeType.ADAPTIVE&&e.pointColorType!==Potree.PointColorType.TREE_DEPTH||this.updateVisibilityTexture(e,t))},Potree.PointCloudOctree.prototype.update=function(e,t){for(var i=0;i<this.profileRequests.length;i++)this.profileRequests[i].update();this.updateVisibility(e,t),this.updateMaterial(this.material,this.visibleNodes,e,t),this.updateVisibleBounds(),Potree.PointCloudOctree.lru.freeMemory()},Potree.PointCloudOctree.prototype.updateVisibilityTexture=function(e,t){if(e){var i=e.visibleNodesTexture,n=i.image.data;t=t.slice();var r=function(e,t){var i=e.name,n=t.name;return i.length!=n.length?i.length-n.length:i<n?-1:i>n?1:0};t.sort(r);for(var o=0;o<t.length;o++){for(var s=t[o],a=[],l=0;l<8;l++){var u=s.children[l];u instanceof Potree.PointCloudOctreeNode&&u.sceneNode.visible&&t.indexOf(u)>=0&&a.push(u)}a.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),n[3*o+0]=0,n[3*o+1]=0,n[3*o+2]=0;for(var l=0;l<a.length;l++){var u=a[l],c=parseInt(u.name.substr(-1));if(n[3*o+0]+=Math.pow(2,c),0===l){var h=t.indexOf(u);n[3*o+1]=Math.floor((h-o)/256),n[3*o+2]=(h-o)%256}}}i.needsUpdate=!0}},Potree.PointCloudOctree.prototype.nodeIntersectsProfile=function(e,t){for(var i=e.boundingBox.clone().applyMatrix4(this.matrixWorld),n=i.getBoundingSphere(),r=0;r<t.points.length-1;r++){var o=new THREE.Vector3(t.points[r].x,n.center.y,t.points[r].z),s=new THREE.Vector3(t.points[r+1].x,n.center.y,t.points[r+1].z),a=new THREE.Ray(o,(new THREE.Vector3).subVectors(s,o).normalize()),l=new THREE.Ray(s,(new THREE.Vector3).subVectors(o,s).normalize());if(a.intersectsSphere(n)&&l.intersectsSphere(n))return!0}return!1},Potree.PointCloudOctree.prototype.nodesOnRay=function(e,t){for(var i=[],n=t.clone(),r=0;r<e.length;r++){var o=e[r],s=o.boundingSphere.clone().applyMatrix4(o.sceneNode.matrixWorld);n.intersectsSphere(s)&&i.push(o)}return i},Potree.PointCloudOctree.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0)},Potree.PointCloudOctree.prototype.hideDescendants=function(e){for(var t=[],i=0;i<e.children.length;i++){var n=e.children[i];n.visible&&t.push(n)}for(;t.length>0;){var e=t.shift();e.visible=!1;for(var i=0;i<e.children.length;i++){var n=e.children[i];n.visible&&t.push(n)}}},Potree.PointCloudOctree.prototype.moveToOrigin=function(){this.position.set(0,0,0),this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld,i=Potree.utils.computeTransformedBoundingBox(e,t);this.position.set(0,0,0).sub(i.center())},Potree.PointCloudOctree.prototype.moveToGroundPlane=function(){this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld,i=Potree.utils.computeTransformedBoundingBox(e,t);this.position.y+=-i.min.y},Potree.PointCloudOctree.prototype.getBoundingBoxWorld=function(){this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld,i=Potree.utils.computeTransformedBoundingBox(e,t);return i},Potree.PointCloudOctree.prototype.getPointsInProfile=function(e,t,i){if(i){var n=new Potree.ProfileRequest(this,e,t,i);return this.profileRequests.push(n),n}for(var r={segments:[],boundingBox:new THREE.Box3,projectedBoundingBox:new THREE.Box2},o=0;o<e.points.length-1;o++){var s=e.points[o],a=e.points[o+1],l=this.getProfile(s,a,e.width,t),u={start:s,end:a,points:l,project:null};r.segments.push(u),r.boundingBox.expandByPoint(l.boundingBox.min),r.boundingBox.expandByPoint(l.boundingBox.max)}for(var c=new THREE.Vector3,o=0;o<r.segments.length;o++){var u=r.segments[o],s=u.start,a=u.end,h=function(e,t,i,n){var r=e,o=t,s=i,a=n,l=new THREE.Vector3(1,0,0),u=(new THREE.Vector3).subVectors(o,r);u.y=0,u.normalize();var c=Math.acos(l.dot(u));return u.z>0&&(c=-c),function(e){var t=(new THREE.Matrix4).makeTranslation(-r.x,-a.min.y,-r.z),i=(new THREE.Matrix4).makeRotationY(-c),n=(new THREE.Matrix4).makeTranslation(s.x,0,0),o=e.clone();return o.applyMatrix4(t),o.applyMatrix4(i),o.applyMatrix4(n),o}}(s,a,c.clone(),r.boundingBox.clone());u.project=h,c.x+=new THREE.Vector3(s.x,0,s.z).distanceTo(new THREE.Vector3(a.x,0,a.z)),c.y+=a.y-s.y}return r.projectedBoundingBox.min.x=0,r.projectedBoundingBox.min.y=r.boundingBox.min.y,r.projectedBoundingBox.max.x=c.x,r.projectedBoundingBox.max.y=r.boundingBox.max.y,r},Potree.PointCloudOctree.prototype.getProfile=function(e,t,i,n,r){if(void 0===r){var o=[];o.push(this);for(var s=(new THREE.Vector3).addVectors(t,e).multiplyScalar(.5),a=(new THREE.Vector3).subVectors(t,e).length(),l=(new THREE.Vector3).subVectors(t,e).normalize(),u=new THREE.Vector3(0,1,0),c=(new THREE.Vector3).crossVectors(l,u).normalize(),h=c,d=(new THREE.Plane).setFromNormalAndCoplanarPoint(h,e),p=(new THREE.Plane).setFromNormalAndCoplanarPoint(l,s),f=null,m=new THREE.Box3;o.length>0;){var g=o.shift(),y=0;if(g instanceof THREE.Points){var v=g.geometry,E=v.attributes.position,T=E.array,b=g.numPoints;if(!f){f={};for(var C in v.attributes)v.attributes.hasOwnProperty(C)&&("indices"===C||(f[C]=[]))}for(var O=0;O<b;O++){var x=new THREE.Vector3(T[3*O],T[3*O+1],T[3*O+2]);x.applyMatrix4(this.matrixWorld);var w=Math.abs(d.distanceToPoint(x)),R=Math.abs(p.distanceToPoint(x));if(w<i/2&&R<a/2){m.expandByPoint(x);for(var C in v.attributes)if(v.attributes.hasOwnProperty(C))if("position"===C)f[C].push(x);else if("indices"===C);else{var L=v.attributes[C];if(1===L.itemSize)f[C].push(L.array[O+_]);else{for(var S=[],_=0;_<L.itemSize;_++)S.push(L.array[O*L.itemSize+_]);f[C].push(S)}}y++}}}if(g==this||g.level<n)for(var O=0;O<g.children.length;O++){var I=g.children[O];if(I instanceof THREE.Points){var D=I.boundingSphere.clone().applyMatrix4(I.matrixWorld);d.distanceToSphere(D)<D.radius&&o.push(I)}}}f.numPoints=f.position.length;var M=function(e,t){var i=e,n=t,r=new THREE.Vector3(1,0,0),o=(new THREE.Vector3).subVectors(n,i);o.y=0,o.normalize();var s=Math.acos(r.dot(o));return o.z>0&&(s=-s),function(e){var t=(new THREE.Matrix4).makeTranslation(-i.x,-i.y,-i.z),n=(new THREE.Matrix4).makeRotationY(-s),r=e.clone();return r.applyMatrix4(t),r.applyMatrix4(n),r}}(e,t);return f.project=M,f.boundingBox=m,f}var A=new Potree.ProfileRequest(e,t,i,n,r);this.profileRequests.push(A)},Potree.PointCloudOctree.prototype.getVisibleExtent=function(){return this.visibleBounds.applyMatrix4(this.matrixWorld)},Potree.PointCloudOctree.prototype.pick=function(e,t,i,n){var n=n||{},r=n.pickWindowSize||17,o=this.nodesOnRay(this.visibleNodes,i);if(0===o.length)return null;var s,a=Math.ceil(e.domElement.clientWidth),l=Math.ceil(e.domElement.clientHeight);if(n.view){var u,c=n.view;s=c.getLastMousePosition(),u=c.getViewport(s.x,s.y),s.y=l-s.y,t=u.getCamera(),e=c.renderer}else s=(new THREE.Vector3).addVectors(t.position,i.direction).project(t),s.addScalar(1).multiplyScalar(.5),s.x*=a,s.y*=l;if(this.pickTarget?this.pickTarget.width==a&&this.pickTarget.height==l||(this.pickTarget.dispose(),this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat})):this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.pickTarget.setSize(a,l),n.view){var h,d,p,f,m;m=n.view.divContainer,h=Math.floor(m.getCurrentWidth()*u.left),d=Math.floor(m.getCurrentHeight()*u.bottom),p=Math.floor(m.getCurrentWidth()*u.width),f=Math.floor(m.getCurrentHeight()*u.height),this.pickTarget.viewport=new THREE.Vector4(h,d,p,f),this.pickTarget.scissor=new THREE.Vector4(h,d,p,f)}Potree.PIManager.update(e),this.pickMaterial||(this.pickMaterial=new Potree.PointCloudMaterial,this.pickMaterial.pointColorType=Potree.PointColorType.POINT_INDEX,this.pickMaterial.uniforms.pcIndex.dynamic=!0),this.pickMaterial.pointSizeType=this.material.pointSizeType,this.pickMaterial.size=this.material.size,this.pickMaterial.pointShape=this.material.pointShape,this.pickMaterial.interpolate=this.material.interpolate,this.pickMaterial.minSize=this.material.minSize,this.pickMaterial.maxSize=this.material.maxSize,this.pickMaterial.classification=this.material.classification,this.pickMaterial.blending=THREE.NoBlending,this.pickMaterial.transparent=!1,this.updateMaterial(this.pickMaterial,this.visibleNodes,t,e);var g=e.getClearColor();e.setClearColor(new THREE.Color(0,0,0),0),e.setRenderTarget(this.pickTarget),this.lastPickState||(this.lastPickState={camera:{matrixWorldInverse:new THREE.Matrix4,projectionMatrix:new THREE.Matrix4},mouse:{x:0,y:0}});var y=!this.lastPickState.camera.matrixWorldInverse.equals(t.matrixWorldInverse)||!this.lastPickState.camera.projectionMatrix.equals(t.projectionMatrix)||this.lastPickState.mouse.x!=s.x||this.lastPickState.mouse.y!=s.y;if(y){this.lastPickState.camera.matrixWorldInverse=t.matrixWorldInverse.clone(),this.lastPickState.camera.projectionMatrix=t.projectionMatrix.clone(),this.lastPickState.mouse.x=s.x,this.lastPickState.mouse.y=s.y,this.pickTarget.scissorTest=!1,e.clearTarget(this.pickTarget),this.pickTarget.scissorTest=!0;for(var v=new Array,E=0;E<o.length;E++){var T=o[E].sceneNode,b=T.children;this.pickMaterial.pcIndex=E+1,T.children=v,T.overrideMaterial=this.pickMaterial,T.geometry.addAttribute("indices",Potree.PIManager.bufferAttribute),e.render(T,t,this.pickTarget),T.geometry.removeAttribute("indices"),T.overrideMaterial=void 0,T.children=b}}var C=r*r,O=new ArrayBuffer(4*C),x=new Uint8Array(O),w=new Uint32Array(O);e.context.readPixels(s.x-(r-1)/2,s.y-(r-1)/2,r,r,e.context.RGBA,e.context.UNSIGNED_BYTE,x),e.setClearColor(g),e.setRenderTarget();for(var R=Number.MAX_VALUE,L=null,S=0;S<r;S++)for(var _=0;_<r;_++){var I=S+_*r,D=Math.pow(S-(r-1)/2,2)+Math.pow(_-(r-1)/2,2),M=x[4*I+3];x[4*I+3]=0;var A=w[I];0!==M&&D<R&&(L={pIndex:A,pcIndex:M-1},R=D)}if(L){var N={};if(!o[L.pcIndex])return console.warn?console.warn("Something went wrong while picking point"):console.log("WARNING! Something went wrong while picking point"),null;var P=o[L.pcIndex].sceneNode,k=P.geometry.attributes;for(var H in k)if(k.hasOwnProperty(H)){var F=P.geometry.attributes[H];if("position"===H){var B=P.geometry.attributes.position.array,K=B[3*L.pIndex+0],z=B[3*L.pIndex+1],U=B[3*L.pIndex+2],V=new THREE.Vector3(K,z,U);V.applyMatrix4(this.matrixWorld),N[H]=V}else if("normal"===H){var G=P.geometry.attributes.normal.array,K=G[3*L.pIndex+0],z=G[3*L.pIndex+1],U=G[3*L.pIndex+2],$=new THREE.Vector3(K,z,U),W=new THREE.Vector4(K,z,U,0),j=new THREE.Matrix4;j.getInverse(this.matrixWorld),j.transpose(),W.applyMatrix4(j),N.normal=new THREE.Vector3(W.x,W.y,W.z),N.dataset_normal=$}else if("indices"===H);else if(1===F.itemSize)N[H]=F.array[E+q];else{for(var X=[],q=0;q<F.itemSize;q++)X.push(F.array[E*F.itemSize+q]);N[H]=X}}return N}return null};var demTime=0;Potree.PointCloudOctree.prototype.createDEM=function(e){for(var t=(new Date).getTime(),i=e.sceneNode,n=i.matrixWorld,r=i.boundingBox.clone().applyMatrix4(n),o=r.size(),s=i.geometry.attributes.position.array,a=64,l=new Array(a*a),u=new Float32Array(a*a),c=s.length/3,h=0;h<c;h++){var d=s[3*h+0],p=s[3*h+1],f=s[3*h+2],m=new THREE.Vector3(d,p,f).applyMatrix4(n),g=parseInt(a*(m.x-r.min.x)/o.x),y=parseInt(a*(m.z-r.min.z)/o.z);g=Math.min(g,a-1),y=Math.min(y,a-1);var v=g+y*a;l[v]||(l[v]=[]),l[v].push(m.y)}for(var h=0;h<l.length;h++){var E=l[h];if(E)if(0===E.length)u[h]=0;else{var T=parseInt((E.length-1)/2);u[h]=E[T]}else u[h]=0}var b=new THREE.Box2;b.expandByPoint(new THREE.Vector3(r.min.x,r.min.z)),b.expandByPoint(new THREE.Vector3(r.max.x,r.max.z));var C={boundingBox:r,boundingBox2D:b,dem:u,demSize:a},O=(new Date).getTime(),x=O-t;return demTime+=x,C},Potree.PointCloudOctree.prototype.getDEMHeight=function(e){var t=new THREE.Vector2(e.x,e.z),i=function(e){var i=e.demSize,n=e.boundingBox2D;n.containsPoint(t);if(n.containsPoint(t)){var r=t.clone().sub(n.min).divide(n.size()),o=r.clone().multiplyScalar(i),s=0;if(o.x>.5&&o.x<i-.5&&o.y>.5&&o.y<i-.5){var a=Math.floor(o.x-.5),l=Math.floor(o.y-.5);a=a===i-1?i-2:a,l=l===i-1?i-2:l;var u=o.x-a-.5,c=o.y-l-.5,h=a+l*i,d=a+1+l*i,p=a+(l+1)*i,f=a+1+(l+1)*i,m=e.dem[h],g=e.dem[d],y=e.dem[p],v=e.dem[f];if(0===m||0===g||0===y||0===v)s=null;else{var E=m*(1-u)+g*u,T=y*(1-u)+v*u;s=E*(1-c)+T*c}}else{o.x=Math.min(parseInt(Math.min(o.x,i)),i-1),o.y=Math.min(parseInt(Math.min(o.y,i)),i-1);var b=o.x+o.y*i;s=e.dem[b]}return s}return null},n=null,r=[];for(this.root.dem&&r.push(this.root);r.length>0;){var o=r.shift(),s=o.dem,a=(s.demSize,s.boundingBox2D);a.containsPoint(t);if(a.containsPoint(t)){var l=i(s);if(n?null!=l&&l>0&&(n=l):n=l,o.level<=2)for(var u=0;u<o.children.length;u++){var c=o.children[u];c.dem&&r.push(c)}}}return n},Potree.PointCloudOctree.prototype.generateTerain=function(){for(var e=this.boundingBox.clone().applyMatrix4(this.matrixWorld),t=300,i=300,n=new THREE.BufferGeometry,r=new Float32Array(t*i*3),o=0,s=0;s<t;s++)for(var a=0;a<i;a++){var l=s/t,u=a/i,c=l*e.size().x+e.min.x,h=u*e.size().z+e.min.z,d=this.getDEMHeight(new THREE.Vector3(c,0,h));d||(d=0),r[o+0]=c,r[o+1]=d,r[o+2]=h,o+=3}n.addAttribute("position",new THREE.BufferAttribute(r,3));var p=new THREE.PointsMaterial({size:20,color:65280}),f=new THREE.Points(n,p);scene.add(f)},Object.defineProperty(Potree.PointCloudOctree.prototype,"progress",{get:function(){return 0==this.visibleNodes.length&&0==this.visibleGeometry.length?1:this.visibleNodes.length/this.visibleGeometry.length}});var nodesLoadTimes={};Potree.PointCloudOctreeGeometry=function(){Potree.PointCloudOctree.lru=Potree.PointCloudOctree.lru||new LRU,this.url=null,this.octreeDir=null,this.spacing=0,this.boundingBox=null,this.root=null,this.numNodesLoading=0,this.nodes=null,this.pointAttributes=null,this.hierarchyStepSize=-1,this.loader=null},Potree.PointCloudOctreeGeometryNode=function(e,t,i){this.id=Potree.PointCloudOctreeGeometryNode.IDCount++,this.name=e,this.index=parseInt(e.charAt(e.length-1)),this.pcoGeometry=t,this.geometry=null,this.boundingBox=i,this.boundingSphere=i.getBoundingSphere(),this.children={},this.numPoints=0,this.level=null,this.loaded=!1,this.oneTimeDisposeHandlers=[]},Potree.PointCloudOctreeGeometryNode.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.PointCloudOctreeGeometryNode.IDCount=0,Potree.PointCloudOctreeGeometryNode.prototype.getURL=function(){var e="",t=this.pcoGeometry.loader.version;return t.equalOrHigher("1.5")?e=this.pcoGeometry.octreeDir+"/"+this.getHierarchyPath()+"/"+this.name:t.equalOrHigher("1.4")?e=this.pcoGeometry.octreeDir+"/"+this.name:t.upTo("1.3")&&(e=this.pcoGeometry.octreeDir+"/"+this.name),e},Potree.PointCloudOctreeGeometryNode.prototype.getHierarchyPath=function(){for(var e="r/",t=this.pcoGeometry.hierarchyStepSize,i=this.name.substr(1),n=Math.floor(i.length/t),r=0;r<n;r++)e+=i.substr(r*t,t)+"/";return e=e.slice(0,-1)},Potree.PointCloudOctreeGeometryNode.prototype.addChild=function(e){this.children[e.index]=e,e.parent=this},Potree.PointCloudOctreeGeometryNode.prototype.load=function(){this.loading===!0||this.loaded===!0||this.pcoGeometry.numNodesLoading>3||(this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.loader.version.equalOrHigher("1.5")&&this.level%this.pcoGeometry.hierarchyStepSize===0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints())},Potree.PointCloudOctreeGeometryNode.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)},Potree.PointCloudOctreeGeometryNode.prototype.loadHierachyThenPoints=function(){var e=this,t=function(e,t){var i=(t.byteLength/5,new DataView(t)),n=[],r=i.getUint8(0),o=i.getUint32(1,!0);e.numPoints=o,n.push({children:r,numPoints:o,name:e.name});for(var s=[],a=5;n.length>0;){for(var l=n.shift(),u=1,c=0;c<8;c++){if(0!==(l.children&u)){var h=l.name+c,d=i.getUint8(a),p=i.getUint32(a+1,!0);n.push({children:d,numPoints:p,name:h}),s.push({children:d,numPoints:p,name:h}),a+=5}u=2*u}if(a===t.byteLength)break}var f={};f[e.name]=e;for(var m=e.pcoGeometry,c=0;c<s.length;c++){var g=s[c].name,o=s[c].numPoints,y=parseInt(g.charAt(g.length-1)),v=g.substring(0,g.length-1),E=f[v],T=g.length-1,b=Potree.POCLoader.createChildAABB(E.boundingBox,y),C=new Potree.PointCloudOctreeGeometryNode(g,m,b);C.level=T,C.numPoints=o,C.hasChildren=s[c].children>0,E.addChild(C),f[g]=C}e.loadPoints()};if(e.level%e.pcoGeometry.hierarchyStepSize===0){var i=e.pcoGeometry.octreeDir+"/"+e.getHierarchyPath()+"/"+e.name+".hrc",n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState)if(200!==n.status&&0!==n.status||!n.response)e.failed=!0,console.log("Failed to load file! HTTP status: "+n.status+", file: "+url);else{var i=n.response;t(e,i)}};try{n.send(null)}catch(r){e.failed=!0,console.log("fehler beim laden der punktwolke: "+r)}}},Potree.PointCloudOctreeGeometryNode.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(var e=0;e<this.oneTimeDisposeHandlers.length;e++){var t=this.oneTimeDisposeHandlers[e];t()}this.oneTimeDisposeHandlers=[]}},Potree.utils=function(){},Potree.utils.pathExists=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),200===t.status},Potree.utils.computeTransformedBoundingBox=function(e,t){var i=[new THREE.Vector3(e.min.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.max.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.min.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.max.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.max.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.min.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.max.y,e.max.z).applyMatrix4(t)],n=new THREE.Box3;return n.setFromPoints(i),n},Potree.utils.addCommas=function(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2},Potree.utils.createWorker=function(e){var t=new Blob([e],{type:"application/javascript"}),i=new Worker(URL.createObjectURL(t));return i},Potree.utils.loadSkybox=function(e){var t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e5),i=new THREE.Scene,n=".jpg",r=[e+"px"+n,e+"nx"+n,e+"py"+n,e+"ny"+n,e+"pz"+n,e+"nz"+n],o=THREE.ImageUtils.loadTextureCube(r,THREE.CubeRefractionMapping),s={uniforms:{tCube:{type:"t",value:o},tFlip:{type:"f",value:-1}},vertexShader:THREE.ShaderLib.cube.vertexShader,fragmentShader:THREE.ShaderLib.cube.fragmentShader},a=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:s.uniforms,depthWrite:!1,side:THREE.BackSide}),l=new THREE.Mesh(new THREE.BoxGeometry(100,100,100),a);return i.add(l),{camera:t,scene:i}},Potree.utils.createGrid=function(e,t,i,n){for(var r=new THREE.LineBasicMaterial({color:n||8947848}),o=new THREE.Geometry,s=0;s<=t;s++)o.vertices.push(new THREE.Vector3(-(i*e)/2,0,s*i-i*t/2)),o.vertices.push(new THREE.Vector3(+(i*e)/2,0,s*i-i*t/2));for(var s=0;s<=e;s++)o.vertices.push(new THREE.Vector3(s*i-i*e/2,0,-(i*t)/2)),o.vertices.push(new THREE.Vector3(s*i-i*e/2,0,+(i*t)/2));var a=new THREE.Line(o,r,THREE.LinePieces);return a.receiveShadow=!0,a},Potree.utils.createBackgroundTexture=function(e,t){function i(e,t){return 1/(2*Math.PI)*Math.exp(-(e*e+t*t)/2)}var n=THREE.ImageUtils.generateDataTexture(e,t,new THREE.Color);n.magFilter=THREE.NearestFilter;for(var r=n.image.data,o=[1,1.5,1.7],s=i(0,0),a=0;a<e;a++)for(var l=0;l<t;l++){var u=2*(a/e)-1,c=2*(l/t)-1,h=a+e*l,d=i(2*u,2*c)/s,p=(Math.random()+Math.random()+Math.random())/3;p=(.5*d+.5)*p*.03,p=.4*p,r[3*h+0]=255*(d/15+.05+p)*o[0],r[3*h+1]=255*(d/15+.05+p)*o[1],r[3*h+2]=255*(d/15+.05+p)*o[2]}return n},Potree.utils.topView=function(e,t){e.position.set(0,1,0),e.rotation.set(-Math.PI/2,0,0),e.zoomTo(t,1)},Potree.utils.frontView=function(e,t){e.position.set(0,0,1),e.rotation.set(0,0,0),e.zoomTo(t,1)},Potree.utils.leftView=function(e,t){e.position.set(-1,0,0),e.rotation.set(0,-Math.PI/2,0),e.zoomTo(t,1)},Potree.utils.rightView=function(e,t){e.position.set(1,0,0),e.rotation.set(0,Math.PI/2,0),e.zoomTo(t,1)},Potree.utils.frustumSphereIntersection=function(e,t){for(var i=e.planes,n=t.center,r=-t.radius,o=Number.MAX_VALUE,s=0;s<6;s++){var a=i[s].distanceToPoint(n);if(a<r)return 0;o=Math.min(o,a)}return o>=t.radius?2:1},Potree.utils.screenPass=new function(){this.screenScene=new THREE.Scene,this.screenQuad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0)),this.screenQuad.material.depthTest=!0,this.screenQuad.material.depthWrite=!0,this.screenQuad.material.transparent=!0,this.screenScene.add(this.screenQuad),this.camera=new THREE.Camera,this.render=function(e,t,i){this.screenQuad.material=t,void 0===typeof i?e.render(this.screenScene,this.camera):e.render(this.screenScene,this.camera,i)}},Potree.Features=function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(null===t)return null;var i,n=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),r=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),o=(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT)),s=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),a=(t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),n.precision>0&&o.precision>0),l=r.precision>0&&s.precision>0;return i=a?"highp":l?"mediump":"lowp",{SHADER_INTERPOLATION:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},SHADER_SPLATS:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getExtension("OES_texture_float"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},SHADER_EDL:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getExtension("OES_texture_float"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},precision:i}}(),Potree.TextSprite=function(e){THREE.Object3D.call(this);var t=new THREE.Texture;t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter;var i=new THREE.SpriteMaterial({map:t,useScreenCoordinates:!1,depthTest:!1,depthWrite:!1});this.material=i,this.sprite=new THREE.Sprite(i),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.setText(e)},Potree.TextSprite.prototype=new THREE.Object3D,Potree.TextSprite.prototype.setText=function(e){this.text=e,this.update()},Potree.TextSprite.prototype.setTextColor=function(e){this.textColor=e,this.update()},Potree.TextSprite.prototype.setBorderColor=function(e){this.borderColor=e,this.update()},Potree.TextSprite.prototype.setBackgroundColor=function(e){
this.backgroundColor=e,this.update()},Potree.TextSprite.prototype.update=function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.font="Bold "+this.fontsize+"px "+this.fontface;var i=t.measureText(this.text),n=i.width,r=n+2*this.borderThickness,o=1.4*this.fontsize+2*this.borderThickness,e=document.createElement("canvas"),t=e.getContext("2d");t.canvas.width=r,t.canvas.height=o,t.font="Bold "+this.fontsize+"px "+this.fontface,t.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",t.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",t.lineWidth=this.borderThickness,this.roundRect(t,this.borderThickness/2,this.borderThickness/2,n+this.borderThickness,1.4*this.fontsize+this.borderThickness,6),t.strokeStyle="rgba(0, 0, 0, 1.0)",t.strokeText(this.text,this.borderThickness,this.fontsize+this.borderThickness),t.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",t.fillText(this.text,this.borderThickness,this.fontsize+this.borderThickness);var s=new THREE.Texture(e);s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.needsUpdate=!0,this.sprite.material.map=s,this.sprite.scale.set(.01*r,.01*o,1)},Potree.TextSprite.prototype.roundRect=function(e,t,i,n,r,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+n-o,i),e.quadraticCurveTo(t+n,i,t+n,i+o),e.lineTo(t+n,i+r-o),e.quadraticCurveTo(t+n,i+r,t+n-o,i+r),e.lineTo(t+o,i+r),e.quadraticCurveTo(t,i+r,t,i+r-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath(),e.fill(),e.stroke()},Potree.Version=function(e){this.version=e;var t=e.indexOf(".")===-1?e.length:e.indexOf(".");this.versionMajor=parseInt(e.substr(0,t)),this.versionMinor=parseInt(e.substr(t+1)),0===this.versionMinor.length&&(this.versionMinor=0)},Potree.Version.prototype.newerThan=function(e){var t=new Potree.Version(e);return this.versionMajor>t.versionMajor||this.versionMajor===t.versionMajor&&this.versionMinor>t.versionMinor},Potree.Version.prototype.equalOrHigher=function(e){var t=new Potree.Version(e);return this.versionMajor>t.versionMajor||this.versionMajor===t.versionMajor&&this.versionMinor>=t.versionMinor},Potree.Version.prototype.upTo=function(e){return!this.newerThan(e)},Potree.Measure=function(){var e=this;THREE.Object3D.call(this),this.points=[],this._showDistances=!0,this._showArea=!0,this._closed=!0,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.areaLabel=new Potree.TextSprite(""),this.areaLabel.setBorderColor({r:0,g:255,b:0,a:0}),this.areaLabel.setBackgroundColor({r:0,g:255,b:0,a:0}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.add(this.areaLabel);var t=new THREE.SphereGeometry(.4,10,10);this.color=new THREE.Color(16711680);var i=function(){var t=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:e.color,ambient:11184810,depthTest:!1,depthWrite:!1});return t},n=function(e){e.target.material.emissive.setHex(8947848)},r=function(e){e.target.material.emissive.setHex(0)},o=function(t){var i=t.tool,n=(i.dragstart,i.mouse,i.getMousePointCloudIntersection());if(n){var r=e.spheres.indexOf(i.dragstart.object);e.setPosition(r,n)}t.event.stopImmediatePropagation()},s=function(e){};this.addMarker=function(e){this.points.push(e);var a=new THREE.Mesh(t,i());a.addEventListener("move",n),a.addEventListener("leave",r),a.addEventListener("drag",o),a.addEventListener("drop",s),this.add(a),this.spheres.push(a);var l=new THREE.Geometry;l.vertices.push(new THREE.Vector3,new THREE.Vector3),l.colors.push(this.color,this.color,this.color);var u=new THREE.LineBasicMaterial({linewidth:1});u.depthTest=!1;var c=new THREE.Line(l,u);c.visible=!0,this.add(c),this.edges.push(c);var h=new Potree.TextSprite(0);h.setBorderColor({r:0,g:255,b:0,a:0}),h.setBackgroundColor({r:0,g:255,b:0,a:0}),h.material.depthTest=!1,h.visible=!1,this.edgeLabels.push(h),this.add(h);var d=new Potree.TextSprite;d.setBorderColor({r:0,g:255,b:0,a:0}),d.setBackgroundColor({r:0,g:255,b:0,a:0}),d.material.depthTest=!1,d.material.opacity=1,d.visible=!1,this.angleLabels.push(d),this.add(d);var p={type:"marker_added",measurement:this};this.dispatchEvent(p),this.setPosition(this.points.length-1,e)},this.removeMarker=function(e){this.points.splice(e,1),this.remove(this.spheres[e]);var t=0===e?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.edgeLabels[t]),this.edgeLabels.splice(t,1),this.spheres.splice(e,1),this.update()},this.setPosition=function(e,t){var i=this.points[e];i.copy(t);var n={type:"marker_moved",measure:this,index:e,position:t.clone()};this.dispatchEvent(n),this.update()},this.getArea=function(){for(var e=0,t=this.points.length-1,i=0;i<this.points.length;i++){var n=this.points[i],r=this.points[t];e+=(r.x+n.x)*(n.z-r.z),t=i}return Math.abs(e/2)},this.getAngleBetweenLines=function(e,t,i){var n=(new THREE.Vector3).subVectors(t,e),r=(new THREE.Vector3).subVectors(i,e);return n.angleTo(r)},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var t=this.points[0];return void this.spheres[0].position.copy(t)}for(var i=this.points.length-1,n=new THREE.Vector3,r=0;r<=i;r++){var t=this.points[r];n.add(t)}n.divideScalar(this.points.length);for(var r=0;r<=i;r++){var o=r,s=r+1>i?0:r+1,a=0===r?i:r-1,t=this.points[o],l=this.points[s],u=this.points[a],c=this.spheres[o];c.position.copy(t),c.material.color=e.color;var h=this.edges[o];h.material.color=this.color,h.geometry.vertices[0].copy(t),h.geometry.vertices[1].copy(l),h.geometry.verticesNeedUpdate=!0,h.geometry.computeBoundingSphere(),h.visible=o<i||this.closed;var d=this.edgeLabels[r],p=(new THREE.Vector3).add(t);p.add(l),p=p.multiplyScalar(.5);var f=t.distanceTo(l);d.position.copy(p),d.setText(f.toFixed(2)),d.visible=this.showDistances&&(o<i||this.closed)&&this.points.length>=2&&f>0;var m=this.angleLabels[r],g=this.getAngleBetweenLines(t,u,l),y=l.clone().sub(u);y.multiplyScalar(.5),y=u.clone().add(y).sub(t).normalize();var v=Math.min(t.distanceTo(u),t.distanceTo(l));v/=9;var E=t.clone().add(y.multiplyScalar(v));m.position.copy(E);var T=Potree.utils.addCommas((g*(180/Math.PI)).toFixed(1))+"°";m.setText(T),m.visible=this.showAngles&&(o<i||this.closed)&&this.points.length>=3&&g>0}this.areaLabel.position.copy(n),this.areaLabel.visible=this.showArea&&this.points.length>=3;var T=Potree.utils.addCommas(this.getArea().toFixed(1))+"²";this.areaLabel.setText(T)}},this.raycast=function(e,t){for(var i=0;i<this.points.length;i++){var n=this.spheres[i];n.raycast(e,t)}for(var i=0;i<t.length;i++){var r=t[i];r.distance=e.ray.origin.distanceTo(r.point)}t.sort(function(e,t){return e.distance-t.distance})}},Potree.Measure.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.Measure.prototype,"showArea",{get:function(){return this._showArea},set:function(e){this._showArea=e,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"closed",{get:function(){return this._closed},set:function(e){this._closed=e,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"showDistances",{get:function(){return this._showDistances},set:function(e){this._showDistances=e,this.update()}}),Potree.MeasuringTool=function(e,t,i){function n(e){if(d===h.INSERT){var t=c.getMousePointCloudIntersection();if(t){var i=t.clone();c.activeMeasurement.addMarker(i);var e={type:"newpoint",position:i.clone()};c.dispatchEvent(e),c.activeMeasurement.points.length>c.activeMeasurement.maxMarkers&&c.finishInsertion()}}}function r(e){var t=c.domElement.getBoundingClientRect();if(c.mouse.x=(e.clientX-t.left)/c.domElement.clientWidth*2-1,c.mouse.y=2*-((e.clientY-t.top)/c.domElement.clientHeight)+1,c.dragstart){var i={type:"drag",event:e,tool:c};c.dragstart.object.dispatchEvent(i)}else if(d==h.INSERT&&c.activeMeasurement){var n=c.getMousePointCloudIntersection();if(n){var r=c.activeMeasurement.points.length-1;c.activeMeasurement.setPosition(r,n)}}else{var n=u();n?(n.object.dispatchEvent({type:"move",target:n.object,event:e}),c.hoveredElement&&c.hoveredElement!==n.object&&c.hoveredElement.dispatchEvent({type:"leave",target:c.hoveredElement,event:e}),c.hoveredElement=n.object):(c.hoveredElement&&c.hoveredElement.dispatchEvent({type:"leave",target:c.hoveredElement,event:e}),c.hoveredElement=null)}}function o(e){d==h.INSERT&&c.finishInsertion()}function s(e){if(1===e.which){d!==h.DEFAULT&&e.stopImmediatePropagation();var t=u();t&&(c.dragstart={object:t.object,sceneClickPos:t.point,sceneStartPos:c.sceneRoot.position.clone(),mousePos:{x:c.mouse.x,y:c.mouse.y}},e.stopImmediatePropagation())}else 3===e.which&&o(e)}function a(e){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),c.activeMeasurement&&d===h.INSERT&&(c.activeMeasurement.removeMarker(c.activeMeasurement.points.length-1),c.finishInsertion())}function l(e){c.dragstart&&(c.dragstart.object.dispatchEvent({type:"drop",event:e}),c.dragstart=null)}function u(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=new THREE.Raycaster;t.ray.set(c.camera.position,e.sub(c.camera.position).normalize());for(var i=[],n=0;n<c.measurements.length;n++)for(var r=c.measurements[n],o=0;o<r.spheres.length;o++)i.push(r.spheres[o]);var s=t.intersectObjects(i,!0);return s.length>0&&s[0]}var c=this;this.enabled=!1,this.scene=e,this.camera=t,this.renderer=i,this.domElement=i.domElement,this.mouse={x:0,y:0};var h={DEFAULT:0,INSERT:1},d=h.DEFAULT;this.activeMeasurement=null,this.measurements=[],this.sceneMeasurement=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneMeasurement.add(this.sceneRoot),this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(0,0,10),this.light.lookAt(new THREE.Vector3(0,0,0)),this.sceneMeasurement.add(this.light),this.hoveredElement=null,this.getState=function(){return d},this.getMousePointCloudIntersection=function(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=e.sub(c.camera.position).normalize(),i=new THREE.Ray(c.camera.position,t),n=[];c.scene.traverse(function(e){(e instanceof Potree.PointCloudOctree||e instanceof Potree.PointCloudArena4D)&&n.push(e)});for(var r=null,o=null,s=0;s<n.length;s++){var a=n[s],l=a.pick(c.renderer,c.camera,i);if(l){var u=c.camera.position.distanceTo(l.position);(!r||u<o)&&(r=l,o=u)}}return r?r.position:null},this.startInsertion=function(e){d=h.INSERT;var e=e||{},t="undefined"==typeof e.showDistances||e.showDistances,i="undefined"!=typeof e.showArea&&e.showArea,n="undefined"!=typeof e.showAngles&&e.showAngles,r="undefined"!=typeof e.closed&&e.closed,o=e.maxMarkers||Number.MAX_SAFE_INTEGER,s=new Potree.Measure;s.showDistances=t,s.showArea=i,s.showAngles=n,s.closed=r,s.maxMarkers=o,this.addMeasurement(s),s.addMarker(new THREE.Vector3(0,0,0)),this.activeMeasurement=s},this.finishInsertion=function(){this.activeMeasurement.removeMarker(this.activeMeasurement.points.length-1);var e={type:"insertion_finished",measurement:this.activeMeasurement};this.dispatchEvent(e),this.activeMeasurement=null,d=h.DEFAULT},this.addMeasurement=function(e){this.sceneMeasurement.add(e),this.measurements.push(e),this.dispatchEvent({type:"measurement_added",measurement:e}),e.addEventListener("marker_added",function(e){c.dispatchEvent(e)}),e.addEventListener("marker_removed",function(e){c.dispatchEvent(e)}),e.addEventListener("marker_moved",function(e){c.dispatchEvent(e)})},this.removeMeasurement=function(e){this.sceneMeasurement.remove(e);var t=this.measurements.indexOf(e);t>=0&&this.measurements.splice(t,1)},this.reset=function(){for(var e=this.measurements.length-1;e>=0;e--){var t=this.measurements[e];this.removeMeasurement(t)}},this.update=function(){for(var e=[],t=0;t<this.measurements.length;t++)e.push(this.measurements[t]);this.activeMeasurement&&e.push(this.activeMeasurement);for(var t=0;t<e.length;t++){for(var n=e[t],r=0;r<n.spheres.length;r++){var o=n.spheres[r],s=c.camera.position.distanceTo(o.getWorldPosition()),a=projectedRadius(1,c.camera.fov*Math.PI/180,s,i.domElement.clientHeight),l=15/a;o.scale.set(l,l,l)}for(var r=0;r<n.edgeLabels.length;r++){var u=n.edgeLabels[r],s=c.camera.position.distanceTo(u.getWorldPosition()),a=projectedRadius(1,c.camera.fov*Math.PI/180,s,i.domElement.clientHeight),l=70/a;u.scale.set(l,l,l)}for(var r=0;r<n.edgeLabels.length;r++){var u=n.angleLabels[r],s=c.camera.position.distanceTo(u.getWorldPosition()),a=projectedRadius(1,c.camera.fov*Math.PI/180,s,i.domElement.clientHeight),l=70/a;u.scale.set(l,l,l)}var s=c.camera.position.distanceTo(n.areaLabel.getWorldPosition()),a=projectedRadius(1,c.camera.fov*Math.PI/180,s,i.domElement.clientHeight),l=80/a;n.areaLabel.scale.set(l,l,l)}this.light.position.copy(this.camera.position),this.light.lookAt(this.camera.getWorldDirection().add(this.camera.position))},this.render=function(){this.update(),this.renderer.render(this.sceneMeasurement,this.camera)},this.domElement.addEventListener("click",n,!1),this.domElement.addEventListener("dblclick",a,!1),this.domElement.addEventListener("mousemove",r,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mouseup",l,!0)},Potree.MeasuringTool.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.HeightProfile=function(){var e=this;THREE.Object3D.call(this),this.points=[],this.spheres=[],this.edges=[],this.boxes=[],this.width=1,this.height=20,this._modifiable=!0;var t=new THREE.SphereGeometry(.4,10,10),i=new THREE.Color(16711680),n=function(){var e=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:16711680,ambient:11184810,depthTest:!1,depthWrite:!1});return e},r=function(e){e.target.material.emissive.setHex(8947848)},o=function(e){e.target.material.emissive.setHex(0)},s=function(t){var i=t.tool,n=i.dragstart,r=i.mouse;if(t.event.ctrlKey){var o=new THREE.Vector3(n.mousePos.x,n.mousePos.y,0),s=new THREE.Vector3(r.x,r.y,0),a=n.widthStart,l=1-10*(o.y-s.y);l=Math.max(.01,l),a&&e.setWidth(a*l)}else{var u=i.getMousePointCloudIntersection();if(u){var c=e.spheres.indexOf(i.dragstart.object);e.setPosition(c,u)}}t.event.stopImmediatePropagation()},a=function(e){};this.addMarker=function(e){this.points.push(e);var l=new THREE.Mesh(t,n());if(l.addEventListener("mousemove",r),l.addEventListener("mouseleave",o),l.addEventListener("mousedrag",s),l.addEventListener("drop",a),this.add(l),this.spheres.push(l),this.points.length>1){var u=new THREE.Geometry;u.vertices.push(new THREE.Vector3,new THREE.Vector3),u.colors.push(i,i,i);var c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:2,transparent:!0,opacity:.4});c.depthTest=!1;var h=new THREE.Line(u,c);h.visible=!1,this.add(h),this.edges.push(h);var d=new THREE.BoxGeometry(1,1,1),p=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.2}),f=new THREE.Mesh(d,p);f.visible=!1,this.add(f),this.boxes.push(f)}var m={type:"marker_added",profile:this};this.dispatchEvent(m),this.setPosition(this.points.length-1,e)},this.removeMarker=function(e){this.points.splice(e,1),this.remove(this.spheres[e]);var t=0===e?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.boxes[t]),this.boxes.splice(t,1),this.spheres.splice(e,1),this.update();var i={type:"marker_removed",profile:this};this.dispatchEvent(i)},this.getArea=function(){for(var e=0,t=this.points.length-1,i=0;i<this.points.length;i++){var n=this.points[i],r=this.points[t];e+=(r.x+n.x)*(n.z-r.z),t=i}return Math.abs(e/2)},this.setPosition=function(e,t){var i=this.points[e];i.copy(t);var n={type:"marker_moved",profile:this,index:e,position:t.clone()};this.dispatchEvent(n),this.update()},this.setWidth=function(e){this.width=e;var t={type:"width_changed",profile:this,width:e};this.dispatchEvent(t),this.update()},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var e=this.points[0];return void this.spheres[0].position.copy(e)}for(var t=this.points[0].clone(),i=this.points[0].clone(),n=new THREE.Vector3,r=this.points.length-1,o=0;o<=r;o++){var e=this.points[o],s=this.spheres[o],a=0===o?r:o-1,l=o===r?0:o+1,u=this.points[a],c=this.points[l],h=this.edges[a],d=this.edges[o],p=this.boxes[a];this.boxes[o],e.distanceTo(u),e.distanceTo(c),(new THREE.Vector3).addVectors(u,e).multiplyScalar(.5),(new THREE.Vector3).addVectors(e,c).multiplyScalar(.5);if(s.position.copy(e),this._modifiable?s.visible=!0:s.visible=!1,h&&(h.geometry.vertices[1].copy(e),h.geometry.verticesNeedUpdate=!0,h.geometry.computeBoundingSphere()),d&&(d.geometry.vertices[0].copy(e),d.geometry.verticesNeedUpdate=!0,d.geometry.computeBoundingSphere()),p){var f=u,m=e,g=f.clone().setY(0).distanceTo(m.clone().setY(0));p.scale.set(g,this.height,this.width);var y=(new THREE.Vector3).addVectors(f,m).multiplyScalar(.5),v=(new THREE.Vector3).subVectors(m,f),E=new THREE.Vector3(v.z,0,(-v.x));p.position.set(0,0,0),p.lookAt(E),p.position.copy(y)}n.add(e),t.min(e),i.max(e)}n.multiplyScalar(1/this.points.length);for(var o=0;o<this.boxes.length;o++){var T=this.boxes[o];T.position.y=t.y+(i.y-t.y)/2,T.scale.y=1e6}}},this.raycast=function(e,t){for(var i=0;i<this.points.length;i++){var n=this.spheres[i];n.raycast(e,t)}for(var i=0;i<t.length;i++){var r=t[i];r.distance=e.ray.origin.distanceTo(r.point)}t.sort(function(e,t){return e.distance-t.distance})}},Potree.HeightProfile.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.HeightProfile.prototype,"modifiable",{get:function(){return this.modifiable},set:function(e){this._modifiable=e,this.update()}}),Potree.ProfileTool=function(e,t,i){function n(e){if(d===h.INSERT){var t=c.getMousePointCloudIntersection();if(t){var i=t.clone();c.activeProfile.addMarker(i);var e={type:"newpoint",position:i.clone()};c.dispatchEvent(e)}}}function r(e){var t=c.domElement.getBoundingClientRect();if(c.mouse.x=(e.clientX-t.left)/c.domElement.clientWidth*2-1,c.mouse.y=2*-((e.clientY-t.top)/c.domElement.clientHeight)+1,c.dragstart){var i={type:"mousedrag",event:e,tool:c};c.dragstart.object.dispatchEvent(i)}else if(d==h.INSERT&&c.activeProfile){var n=c.getMousePointCloudIntersection();if(n){var r=c.activeProfile.points.length-1;c.activeProfile.setPosition(r,n)}}else{var n=u();n?(n.object.dispatchEvent({type:"mousemove",target:n.object,event:e}),c.hoveredElement&&c.hoveredElement!==n.object&&c.hoveredElement.dispatchEvent({type:"mouseleave",target:c.hoveredElement,event:e}),c.hoveredElement=n.object):(c.hoveredElement&&c.hoveredElement.dispatchEvent({type:"mouseleave",target:c.hoveredElement,event:e}),c.hoveredElement=null)}}function o(e){d==h.INSERT&&c.finishInsertion()}function s(e){if(d!==h.DEFAULT&&e.stopImmediatePropagation(),1===e.which){var t=u();if(t){for(var i=null,n=0;n<c.profiles.length;n++)for(var r=c.profiles[n],s=0;s<r.spheres.length;s++){var a=r.spheres[s];a===t.object&&(i=r.width)}c.dragstart={object:t.object,sceneClickPos:t.point,sceneStartPos:c.sceneRoot.position.clone(),mousePos:{x:c.mouse.x,y:c.mouse.y},widthStart:i},e.stopImmediatePropagation()}}else 3===e.which&&o(e)}function a(e){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),c.activeProfile&&d===h.INSERT&&(c.activeProfile.removeMarker(c.activeProfile.points.length-1),c.finishInsertion())}function l(e){c.dragstart&&(c.dragstart.object.dispatchEvent({type:"drop",event:e}),c.dragstart=null)}function u(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=new THREE.Raycaster;t.ray.set(c.camera.position,e.sub(c.camera.position).normalize());var i=t.intersectObjects(c.profiles);return i.length>0&&i[0]}var c=this;this.enabled=!1,this.scene=e,this.camera=t,this.renderer=i,this.domElement=i.domElement,this.mouse={x:0,y:0};var h={DEFAULT:0,INSERT:1},d=h.DEFAULT;new THREE.SphereGeometry(.4,10,10);this.activeProfile=null,this.profiles=[],this.sceneProfile=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneProfile.add(this.sceneRoot),this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(0,0,10),this.light.lookAt(new THREE.Vector3(0,0,0)),this.sceneProfile.add(this.light),this.hoveredElement=null,this.getMousePointCloudIntersection=function(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=e.sub(c.camera.position).normalize(),i=new THREE.Ray(c.camera.position,t),n=[];c.scene.traverse(function(e){(e instanceof Potree.PointCloudOctree||e instanceof Potree.PointCloudArena4D)&&n.push(e)});for(var r=null,o=null,s=0;s<n.length;s++){var a=n[s],l=a.pick(c.renderer,c.camera,i);if(l){var u=c.camera.position.distanceTo(l.position);(!r||u<o)&&(r=l,o=u)}}return r?r.position:null},this.startInsertion=function(e){d=h.INSERT;var e=e||{},t=e.clip||!1,i=e.width||1;return this.activeProfile=new Potree.HeightProfile,this.activeProfile.clip=t,this.activeProfile.setWidth(i),this.addProfile(this.activeProfile),this.activeProfile.addMarker(new THREE.Vector3(0,0,0)),this.activeProfile},this.finishInsertion=function(){this.activeProfile.removeMarker(this.activeProfile.points.length-1);var e={type:"insertion_finished",profile:this.activeProfile};this.dispatchEvent(e),this.activeProfile=null,d=h.DEFAULT},this.addProfile=function(e){this.profiles.push(e),this.sceneProfile.add(e),e.update(),this.dispatchEvent({type:"profile_added",profile:e}),e.addEventListener("marker_added",function(e){c.dispatchEvent(e)}),e.addEventListener("marker_removed",function(e){c.dispatchEvent(e)}),e.addEventListener("marker_moved",function(e){c.dispatchEvent(e)})},this.removeProfile=function(e){this.sceneProfile.remove(e);var t=this.profiles.indexOf(e);t>=0&&this.profiles.splice(t,1),this.dispatchEvent({type:"profile_removed",profile:e})},this.reset=function(){for(var e=this.profiles.length-1;e>=0;e--){var t=this.profiles[e];this.removeProfile(t)}},this.update=function(){for(var e=0;e<this.profiles.length;e++)for(var t=this.profiles[e],n=0;n<t.spheres.length;n++){var r=t.spheres[n],o=c.camera.position.distanceTo(r.getWorldPosition()),s=projectedRadius(1,c.camera.fov*Math.PI/180,o,i.domElement.clientHeight),a=15/s;r.scale.set(a,a,a)}this.light.position.copy(this.camera.position),this.light.lookAt(this.camera.getWorldDirection().add(this.camera.position))},this.render=function(){this.update(),i.render(this.sceneProfile,this.camera)},this.domElement.addEventListener("click",n,!1),this.domElement.addEventListener("dblclick",a,!1),this.domElement.addEventListener("mousemove",r,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mouseup",l,!0)},Potree.ProfileTool.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.TransformationTool=function(e,t,i){function n(e){if(a.mouse.x=e.clientX/a.domElement.clientWidth*2-1,a.mouse.y=2*-(e.clientY/a.domElement.clientHeight)+1,a.dragstart)a.dragstart.object.dispatchEvent({type:"mousedrag",event:e});else{var t=s();if(t){var i=t.object;i.dispatchEvent({type:"mousemove",event:e}),a.hoveredElement&&a.hoveredElement!==i&&a.hoveredElement.dispatchEvent({type:"mouseleave",event:e}),a.hoveredElement=i}else a.hoveredElement&&a.hoveredElement.dispatchEvent({type:"mouseleave",event:e}),a.hoveredElement=null}}function r(e){if(1===e.which){var t=s();if(t){for(var i=[],n=[],r=0;r<a.targets.length;r++)i.push(a.targets[r].scale.clone()),n.push(a.targets[r].rotation.clone());a.dragstart={object:t.object,sceneClickPos:t.point,sceneStartPos:a.sceneRoot.position.clone(),mousePos:{x:a.mouse.x,y:a.mouse.y},scales:i,rotations:n},e.stopImmediatePropagation()}}else 3===e.which&&a.setTargets([])}function o(e){a.dragstart&&(a.dragstart.object.dispatchEvent({type:"drop",event:e}),a.dragstart=null)}function s(){if(0!==a.targets.length){var e=new THREE.Vector3(a.mouse.x,a.mouse.y,.5);e.unproject(a.camera);var t=new THREE.Raycaster;t.ray.set(a.camera.position,e.sub(a.camera.position).normalize()),t.linePrecision=.2;var i=[];a.translationNode.visible?i.push(a.translationNode):a.scaleNode.visible?i.push(a.scaleNode):a.rotationNode.visible&&(i.push(a.rotationNode),i.push(a.sceneRotation));for(var n=t.intersectObjects(i,!0),r=0;r<n.length;r++){var o=n[r];o.distance=a.camera.position.distanceTo(o.point)}return n.sort(function(e,t){return e.distance-t.distance}),n.length>0&&n[0]}}var a=this;this.enabled=!1,this.scene=e,this.camera=t,this.renderer=i,this.domElement=i.domElement,this.mouse={x:0,y:0},this.dragstart=null,this.sceneTransformation=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneTransformation.add(this.sceneRoot),this.sceneRotation=new THREE.Scene,this.translationNode=new THREE.Object3D,this.rotationNode=new THREE.Object3D,this.scaleNode=new THREE.Object3D,this.sceneRoot.add(this.translationNode),this.sceneRoot.add(this.rotationNode),this.sceneRoot.add(this.scaleNode),this.sceneRoot.visible=!1,this.hoveredElement=null,this.STATE={DEFAULT:0,TRANSLATE_X:1,TRANSLATE_Y:2,TRANSLATE_Z:3,SCALE_X:1,SCALE_Y:2,SCALE_Z:3},this.parts={ARROW_X:{name:"arrow_x",object:void 0,color:new THREE.Color(16711680),state:this.STATE.TRANSLATE_X},ARROW_Z:{name:"arrow_z",object:void 0,color:new THREE.Color(255),state:this.STATE.TRANSLATE_Z},ARROW_Y:{name:"arrow_y",object:void 0,color:new THREE.Color(65280),state:this.STATE.TRANSLATE_Y},SCALE_X:{name:"scale_x",object:void 0,color:new THREE.Color(16711680),state:this.STATE.SCALE_X},SCALE_Z:{name:"scale_z",object:void 0,color:new THREE.Color(255),state:this.STATE.SCALE_Z},SCALE_Y:{name:"scale_y",object:void 0,color:new THREE.Color(65280),state:this.STATE.SCALE_Y},ROTATE_X:{name:"rotate_x",object:void 0,color:new THREE.Color(16711680),state:this.STATE.ROTATE_X},ROTATE_Z:{name:"rotate_z",object:void 0,color:new THREE.Color(255),state:this.STATE.ROTATE_Z},ROTATE_Y:{name:"rotate_y",object:void 0,color:new THREE.Color(65280),state:this.STATE.ROTATE_Y}},this.buildTranslationNode=function(){var e=a.createArrow(a.parts.ARROW_X,a.parts.ARROW_X.color);e.rotation.z=-Math.PI/2;var t=a.createArrow(a.parts.ARROW_Y,a.parts.ARROW_Y.color),i=a.createArrow(a.parts.ARROW_Z,a.parts.ARROW_Z.color);i.rotation.x=-Math.PI/2,this.translationNode.add(e),this.translationNode.add(t),this.translationNode.add(i)},this.buildScaleNode=function(){var e=this.createScaleHandle(a.parts.SCALE_X,16711680);e.rotation.z=-Math.PI/2;var t=this.createScaleHandle(a.parts.SCALE_Y,65280),i=this.createScaleHandle(a.parts.SCALE_Z,255);i.rotation.x=-Math.PI/2,this.scaleNode.add(e),this.scaleNode.add(t),this.scaleNode.add(i)},this.buildRotationNode=function(){var e=this.createRotationCircle(a.parts.ROTATE_X,16711680);e.rotation.y=-Math.PI/2;var t=this.createRotationCircle(a.parts.ROTATE_Y,65280),i=this.createRotationCircle(a.parts.ROTATE_Z,255);t.rotation.x=-Math.PI/2,this.rotationNode.add(e),this.rotationNode.add(t),this.rotationNode.add(i);var n=new THREE.SphereGeometry(2.9,24,24),r=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:11184810,transparent:!0,opacity:.4}));this.sceneRotation.add(r);var o=function(e){r.material.color.setHex(5592405)},s=function(e){r.material.color.setHex(11184810)},l=function(e){e.event.stopImmediatePropagation();for(var t=new THREE.Vector3(a.dragstart.mousePos.x,a.dragstart.mousePos.y,.1),i=new THREE.Vector3(a.mouse.x,a.mouse.y,.1),n=(new THREE.Vector3).subVectors(i,t),r=t.clone().unproject(a.camera),o=i.clone().unproject(a.camera),s=(new THREE.Vector3).subVectors(o,r),l=s.clone().normalize(),u=(new THREE.Vector3).subVectors(a.camera.position,r).normalize(),c=u.clone().cross(l),h=6*n.length(),d=0;d<a.targets.length;d++){var p=a.targets[d],f=a.dragstart.rotations[d];p.rotation.copy(f);var m=new THREE.Quaternion;m.setFromAxisAngle(c,h),p.quaternion.multiplyQuaternions(m,p.quaternion)}},u=function(e){};r.addEventListener("mousemove",o),r.addEventListener("mouseleave",s),r.addEventListener("mousedrag",l),r.addEventListener("drop",u)},this.createBox=function(e){var t=new THREE.BoxGeometry(1,1,1),i=new THREE.MeshBasicMaterial({color:e,transparent:!0,opacity:.5}),n=new THREE.Mesh(t,i);return n};this.createRotationCircle=function(e,t){for(var i=[],n=128,r=0;r<=n;r++){var o=2*Math.PI*r/n,s=3*Math.cos(o),l=3*Math.sin(o);i.push(new THREE.Vector3(s,l,0))}for(var u=new THREE.Geometry,r=0;r<i.length;r++)u.vertices.push(i[r]);var c=new THREE.LineBasicMaterial({color:t}),h=new THREE.Line(u,c);h.mode=THREE.LineStrip,h.scale.set(1,1,1);var d=function(e){c.color.setRGB(1,1,0)},p=function(e){c.color.setHex(t)},f=function(t){t.event.stopImmediatePropagation();var i=new THREE.Vector3;e===a.parts.ROTATE_X?i.x=1:e===a.parts.ROTATE_Y?i.y=1:e===a.parts.ROTATE_Z&&(i.z=-1);var n=a.dragstart.sceneClickPos.clone(),r=a.sceneRoot.position.clone(),o=n.clone().sub(r).normalize(),s=n.clone().project(a.camera),l=r.clone().project(a.camera),u=s.clone().sub(l).normalize(),c=(new THREE.Vector3(u.y,u.x,0),new THREE.Vector3(a.dragstart.mousePos.x,a.dragstart.mousePos.y,0),new THREE.Vector3(a.mouse.x,a.mouse.y,0)),h=(new THREE.Plane).setFromNormalAndCoplanarPoint(i,a.sceneRoot.position),d=a.camera.position,p=(new THREE.Vector3(0,0,(-1)).applyQuaternion(a.camera.quaternion),new THREE.Vector3(c.x,c.y,.5).unproject(a.camera).sub(a.camera.position).normalize()),f=new THREE.Ray(d,p),m=f.intersectPlane(h);if(m){sceneTargetNormal=m.clone().sub(r).normalize();var g,y;e===a.parts.ROTATE_X?(g=2*Math.PI+Math.atan2(o.y,-o.z),y=4*Math.PI+Math.atan2(sceneTargetNormal.y,-sceneTargetNormal.z)):e===a.parts.ROTATE_Y?(g=2*Math.PI+Math.atan2(-o.z,o.x),y=4*Math.PI+Math.atan2(-sceneTargetNormal.z,sceneTargetNormal.x)):e===a.parts.ROTATE_Z&&(g=2*Math.PI+Math.atan2(o.x,o.y),y=4*Math.PI+Math.atan2(sceneTargetNormal.x,sceneTargetNormal.y));for(var v=y-g,E=0;E<a.targets.length;E++){var T=a.targets[E],b=a.dragstart.rotations[E];T.rotation.copy(b);var C=new THREE.Quaternion;C.setFromAxisAngle(i,v),T.quaternion.multiplyQuaternions(C,T.quaternion)}}},m=function(e){};return h.addEventListener("mousemove",d),h.addEventListener("mouseleave",p),h.addEventListener("mousedrag",f),h.addEventListener("drop",m),h},this.createScaleHandle=function(e,t){var i=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshBasicMaterial({color:t,depthTest:!1,depthWrite:!1}),r=new THREE.Mesh(i,n);r.scale.set(.3,.3,.3),r.position.set(0,3,0);var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,3,0));var s=new THREE.LineBasicMaterial({color:t,depthTest:!1,depthWrite:!1}),l=new THREE.Line(o,s),u=new THREE.Object3D;u.add(r),u.add(l),u.partID=e;var c=function(e){s.color.setRGB(1,1,0),n.color.setRGB(1,1,0)},h=function(e){s.color.setHex(t),n.color.setHex(t)},d=function(t){var i=new THREE.Vector3;e===a.parts.SCALE_X?i.x=1:e===a.parts.SCALE_Y?i.y=1:e===a.parts.SCALE_Z&&(i.z=-1);var n=a.dragstart.sceneClickPos.clone();n.multiply(i),n.z*=-1;var r=a.dragstart.sceneStartPos.clone().project(a.camera),o=a.dragstart.sceneStartPos.clone().add(i).project(a.camera),s=r.clone(),l=o.clone().sub(r);l.normalize();var u=new THREE.Vector3(a.dragstart.mousePos.x,a.dragstart.mousePos.y,0),c=new THREE.Vector3(a.mouse.x,a.mouse.y,0),h=(new THREE.Vector3).subVectors(c,u).dot(l),d=l.clone().multiplyScalar(h).add(s);d.unproject(a.camera);var p=a.sceneRoot.position.clone().sub(d);p.multiply(new THREE.Vector3((-1),(-1),1));for(var f=0;f<a.targets.length;f++){var m=a.targets[f],g=a.dragstart.scales[f];m.scale.copy(g).add(p),m.scale.x=Math.max(m.scale.x,.01),m.scale.y=Math.max(m.scale.y,.01),m.scale.z=Math.max(m.scale.z,.01)}t.event.stopImmediatePropagation()},p=function(e){n.color.set(t)};return r.addEventListener("mousemove",c),r.addEventListener("mouseleave",h),r.addEventListener("mousedrag",d),r.addEventListener("drop",p),l.addEventListener("mousemove",c),l.addEventListener("mouseleave",h),l.addEventListener("mousedrag",d),l.addEventListener("drop",p),u},this.createArrow=function(e,t){var i=new THREE.MeshBasicMaterial({color:t,depthTest:!1,depthWrite:!1}),n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,0,0)),n.vertices.push(new THREE.Vector3(0,3,0));
var r=new THREE.LineBasicMaterial({color:t,depthTest:!1,depthWrite:!1}),o=new THREE.Line(n,r),s=new THREE.CylinderGeometry(0,.2,.5,10,1,(!1)),l=i,u=new THREE.Mesh(s,l);u.position.y=3;var c=new THREE.Object3D;c.add(o),c.add(u),c.partID=e,c.material=i;var h=function(e){l.color.setRGB(1,1,0),r.color.setRGB(1,1,0)},d=function(e){l.color.set(t),r.color.set(t)},p=function(t){var i=new THREE.Vector3;e===a.parts.ARROW_X?i.x=1:e===a.parts.ARROW_Y?i.y=1:e===a.parts.ARROW_Z&&(i.z=-1);var n=a.dragstart.sceneClickPos.clone();n.multiply(i),n.z*=-1;var r=a.dragstart.sceneStartPos.clone().project(a.camera),o=a.dragstart.sceneStartPos.clone().add(i).project(a.camera),s=r.clone(),l=o.clone().sub(r);l.normalize();var u=new THREE.Vector3(a.dragstart.mousePos.x,a.dragstart.mousePos.y,0),c=new THREE.Vector3(a.mouse.x,a.mouse.y,0),h=(new THREE.Vector3).subVectors(c,u).dot(l),d=l.clone().multiplyScalar(h).add(s);d.unproject(a.camera);var p=a.sceneRoot.position.clone();n.clone().sub(a.dragstart.sceneStartPos);a.sceneRoot.position.copy(d),p.sub(a.sceneRoot.position);for(var f=0;f<a.targets.length;f++){var m=a.targets[f];m.position.sub(p)}t.event.stopImmediatePropagation()},f=function(e){r.color.set(t)};return o.addEventListener("mousemove",h),u.addEventListener("mousemove",h),o.addEventListener("mouseleave",d),u.addEventListener("mouseleave",d),o.addEventListener("mousedrag",p),u.addEventListener("mousedrag",p),o.addEventListener("drop",f),u.addEventListener("drop",f),c},this.setTargets=function(e){if(a.targets=e,0===a.targets.length)return this.sceneRoot.visible=!1,void(this.sceneRotation.visible=!1);this.sceneRoot.visible=!0;var t,i=e[0];if(t=i.geometry&&i.geometry.boundingBox?i.geometry.boundingBox:i.boundingBox){var n=t.clone().applyMatrix4(i.matrixWorld).center();a.sceneRoot.position.copy(n)}},this.update=function(){var e=this.sceneRoot,i=e.getWorldPosition().applyMatrix4(this.camera.matrixWorldInverse),n=(new THREE.Vector4(i.x,i.y,i.z).applyMatrix4(t.projectionMatrix),Math.abs(i.z/20));e.scale.set(n,n,n),this.targets&&1===this.targets.length&&this.scaleNode.rotation.copy(this.targets[0].rotation),this.sceneRotation.scale.set(n,n,n)},this.render=function(){this.update(),this.sceneRotation.position.copy(this.sceneRoot.position),this.sceneRotation.visible=this.rotationNode.visible&&this.sceneRoot.visible,i.render(this.sceneRotation,this.camera),i.render(this.sceneTransformation,this.camera)},this.translate=function(){this.translationNode.visible=!0,this.scaleNode.visible=!1,this.rotationNode.visible=!1},this.scale=function(){this.translationNode.visible=!1,this.scaleNode.visible=!0,this.rotationNode.visible=!1},this.rotate=function(){this.translationNode.visible=!1,this.scaleNode.visible=!1,this.rotationNode.visible=!0},this.reset=function(){this.setTargets([])},this.buildTranslationNode(),this.buildScaleNode(),this.buildRotationNode(),this.rotate(),this.setTargets([]),this.domElement.addEventListener("mousemove",n,!0),this.domElement.addEventListener("mousedown",r,!0),this.domElement.addEventListener("mouseup",o,!0)},Potree.Volume=function(e){THREE.Object3D.call(this),e=e||{},this._clip=e.clip||!1,this._modifiable=e.modifiable||!0;var t=new THREE.BoxGeometry(1,1,1);t.computeBoundingBox();var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3((-.5),(-.5),.5)),i.vertices.push(new THREE.Vector3(.5,(-.5),.5)),i.vertices.push(new THREE.Vector3(.5,(-.5),.5)),i.vertices.push(new THREE.Vector3(.5,(-.5),(-.5))),i.vertices.push(new THREE.Vector3(.5,(-.5),(-.5))),i.vertices.push(new THREE.Vector3((-.5),(-.5),(-.5))),i.vertices.push(new THREE.Vector3((-.5),(-.5),(-.5))),i.vertices.push(new THREE.Vector3((-.5),(-.5),.5)),i.vertices.push(new THREE.Vector3((-.5),.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,(-.5))),i.vertices.push(new THREE.Vector3(.5,.5,(-.5))),i.vertices.push(new THREE.Vector3((-.5),.5,(-.5))),i.vertices.push(new THREE.Vector3((-.5),.5,(-.5))),i.vertices.push(new THREE.Vector3((-.5),.5,.5)),i.vertices.push(new THREE.Vector3((-.5),(-.5),.5)),i.vertices.push(new THREE.Vector3((-.5),.5,.5)),i.vertices.push(new THREE.Vector3(.5,(-.5),.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,(-.5),(-.5))),i.vertices.push(new THREE.Vector3(.5,.5,(-.5))),i.vertices.push(new THREE.Vector3((-.5),(-.5),(-.5))),i.vertices.push(new THREE.Vector3((-.5),.5,(-.5))),this.dimension=new THREE.Vector3(1,1,1);var n=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!0});this.box=new THREE.Mesh(t,n),this.box.geometry.computeBoundingBox(),this.boundingBox=this.box.geometry.boundingBox,this.add(this.box),this.frame=new THREE.Line(i,new THREE.LineBasicMaterial({color:0})),this.frame.mode=THREE.LinePieces,this.add(this.frame),this.label=new Potree.TextSprite("0"),this.label.setBorderColor({r:0,g:255,b:0,a:0}),this.label.setBackgroundColor({r:0,g:255,b:0,a:0}),this.label.material.depthTest=!1,this.label.material.depthWrite=!1,this.label.material.transparent=!0,this.label.position.y-=.5,this.add(this.label);var r=this;this.label.updateMatrixWorld=function(){var e=new THREE.Vector3;e.setFromMatrixPosition(r.matrixWorld),r.label.position.copy(e),r.label.updateMatrix(),r.label.matrixWorld.copy(r.label.matrix),r.label.matrixWorldNeedsUpdate=!1;for(var t=0,i=r.label.children.length;t<i;t++)r.label.children[t].updateMatrixWorld(!0)},this.setDimension=function(e,t,i){this.dimension.set(e,t,i),this.box.scale.set(e,t,i),this.frame.scale.set(e,t,i)},this.volume=function(){return Math.abs(this.scale.x*this.scale.y*this.scale.z)},this.update=function(){this.boundingBox=this.box.geometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(),this._clip?(this.box.visible=!1,this.label.visible=!1):(this.box.visible=!0,this.label.visible=!0)},this.raycast=function(e,t){var i=[];if(this.box.raycast(e,i),i.length>0){var n=i[0];t.push({distance:n.distance,object:this,point:n.point.clone()})}},this.update()},Potree.Volume.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.Volume.prototype,"clip",{get:function(){return this._clip},set:function(e){this._clip=e,this.update()}}),Object.defineProperty(Potree.Volume.prototype,"modifiable",{get:function(){return this._modifiable},set:function(e){this._modifiable=e,this.update()}}),Potree.VolumeTool=function(e,t,i,n){function r(e){var t=c.domElement.getBoundingClientRect();c.mouse.x=(e.clientX-t.left)/c.domElement.clientWidth*2-1,c.mouse.y=2*-((e.clientY-t.top)/c.domElement.clientHeight)+1}function o(e){}function s(e){if(d!==h.DEFAULT&&e.stopImmediatePropagation(),d===h.INSERT_VOLUME)c.finishInsertion();else if(1===e.which){var t=l();t&&t.object.modifiable&&c.transformationTool.setTargets([t.object])}3===e.which}function a(e){return e.preventDefault(),!1}function l(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=new THREE.Raycaster;t.ray.set(c.camera.position,e.sub(c.camera.position).normalize());for(var i=[],n=0;n<c.volumes.length;n++){var r=c.volumes[n];i.push(r)}var o=t.intersectObjects(i,!1);return o.length>0&&o[0]}function u(){var e=new THREE.Vector3(c.mouse.x,c.mouse.y,.5);e.unproject(c.camera);var t=e.sub(c.camera.position).normalize(),i=new THREE.Ray(c.camera.position,t),n=[];c.scene.traverse(function(e){(e instanceof Potree.PointCloudOctree||e instanceof Potree.PointCloudArena4D)&&n.push(e)});for(var r=null,o=null,s=0;s<n.length;s++){var a=n[s],l=a.pick(c.renderer,c.camera,i);if(l){var u=c.camera.position.distanceTo(l.position);(!r||u<o)&&(r=l,o=u)}}return r?r.position:null}var c=this;this.enabled=!1,this.scene=e,this.sceneVolume=new THREE.Scene,this.camera=t,this.renderer=i,this.transformationTool=n,this.domElement=this.renderer.domElement,this.mouse={x:0,y:0},this.volumes=[];var h={DEFAULT:0,INSERT_VOLUME:1},d=h.DEFAULT;this.update=function(e){if(d===h.INSERT_VOLUME){var t=u();if(t){this.activeVolume.position.copy(t);var i=this.activeVolume.getWorldPosition().applyMatrix4(this.camera.matrixWorldInverse),n=(new THREE.Vector4(i.x,i.y,i.z).applyMatrix4(this.camera.projectionMatrix),Math.abs(i.z/10));this.activeVolume.scale.set(n,n,n)}}for(var r=[],o=0;o<this.volumes.length;o++)r.push(this.volumes[o]);this.activeVolume&&r.push(this.activeVolume);for(var o=0;o<r.length;o++){var s=r[o],a=(s.box,s.label),l=s.volume(),p=Potree.utils.addCommas(l.toFixed(1))+"³";a.setText(p);var f=c.camera.position.distanceTo(a.getWorldPosition()),m=projectedRadius(1,c.camera.fov*Math.PI/180,f,c.renderer.domElement.clientHeight),g=70/m;a.scale.set(g,g,g)}},this.startInsertion=function(e){d=h.INSERT_VOLUME;var e=e||{},t=e.clip||!1;this.activeVolume=new Potree.Volume,this.activeVolume.clip=t,this.sceneVolume.add(this.activeVolume),this.volumes.push(this.activeVolume)},this.finishInsertion=function(){c.transformationTool.setTargets([this.activeVolume]);var e={type:"insertion_finished",volume:this.activeVolume};this.dispatchEvent(e),this.activeVolume=null,d=h.DEFAULT},this.addVolume=function(e){this.sceneVolume.add(e),this.volumes.push(e)},this.removeVolume=function(e){this.sceneVolume.remove(e);var t=this.volumes.indexOf(e);t>=0&&this.volumes.splice(t,1)},this.reset=function(){for(var e=this.volumes.length-1;e>=0;e--){var t=this.volumes[e];this.removeVolume(t)}},this.render=function(e){c.renderer.render(this.sceneVolume,this.camera,e)},this.domElement.addEventListener("click",o,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mousemove",r,!1),this.domElement.addEventListener("contextmenu",a,!1)},Potree.VolumeTool.prototype=Object.create(THREE.EventDispatcher.prototype),BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},remove:function(e){for(var t=this.content.length,i=0;i<t;i++)if(this.content[i]==e){var n=this.content.pop();if(i==t-1)break;this.content[i]=n,this.bubbleUp(i),this.sinkDown(i);break}},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e],i=this.scoreFunction(t);e>0;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(i>=this.scoreFunction(r))break;this.content[n]=t,this.content[e]=r,e=n}},sinkDown:function(e){for(var t=this.content.length,i=this.content[e],n=this.scoreFunction(i);;){var r=2*(e+1),o=r-1,s=null;if(o<t){var a=this.content[o],l=this.scoreFunction(a);l<n&&(s=o)}if(r<t){var u=this.content[r],c=this.scoreFunction(u);c<(null==s?n:l)&&(s=r)}if(null==s)break;this.content[e]=this.content[s],this.content[s]=i,e=s}}};var OpenLayers={VERSION_NUMBER:"Release 2.14 dev (navvis)",singleFile:!0,_getScriptLocation:function(){for(var e,t,i=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),n=document.getElementsByTagName("script"),r="",o=0,s=n.length;o<s;o++)if(e=n[o].getAttribute("src"),e&&(t=e.match(i))){r=t[1];break}return function(){return r}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var r=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,r)}else n.prototype=i;return n},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,r,o;for(n=2,r=arguments.length;n<r;n++)o=arguments[n],"function"==typeof o&&(o=o.prototype),OpenLayers.Util.extend(e.prototype,o)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}var r="function"==typeof window.Event&&t instanceof window.Event;!r&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return e.indexOf(t)!=-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],n=1,r=t.length;n<r;n++){var o=t[n];i+=o.charAt(0).toUpperCase()+o.substring(1)}return i},format:function(e,t,i){t||(t=window);var n=function(e,n){for(var r,o=n.split(/\.+/),s=0;s<o.length&&(0==s&&(r=t),void 0!==r);s++)r=r[o[s]];return"function"==typeof r&&(r=i?r.apply(null,i):r()),"undefined"==typeof r?"undefined":r};return e.replace(OpenLayers.String.tokenRegEx,n)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return t===!0&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):i}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var r=e.toString().split(".");1==r.length&&null==t&&(t=0);var o=r[0];if(i)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(o);)o=o.replace(s,"$1"+i+"$2");var a;if(0==t)a=o;else{var l=r.length>1?r[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),a=o+n+l}return a},zeroPad:function(e,t,i){for(var n=e.toString(i||10);n.length<t;)n="0"+n;return n}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.call(arguments,2);return function(){var n=i.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var r=e.length;if("function"!=typeof t)throw new TypeError;for(var o=0;o<r;o++)if(o in e){var s=e[o];t.call(i,s,o,e)&&n.push(s)}}return n}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){OpenLayers.Util.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,r=Math.round(this.bottom*i)/i,o=Math.round(this.right*i)/i,s=Math.round(this.top*i)/i;return t===!0?r+","+n+","+s+","+o:n+","+r+","+o+","+s},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y);var r=(this.left-i)*e+i,o=(this.bottom-n)*e+n,s=(this.right-i)*e+i,a=(this.top-n)*e+n;return new OpenLayers.Bounds(r,o,s,a)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null,(null==this.left||e<this.left)&&(this.left=e),(null==this.bottom||t<this.bottom)&&(this.bottom=t),(null==this.right||e>this.right)&&(this.right=e),(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;if(n&&!i){var r=n.getWidth(),o=(n.left+n.right)/2,s=Math.round((e.lon-o)/r);i=this.containsLonLat({lon:e.lon-s*r,lat:e.lat},{inclusive:t.inclusive})}return i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var n=!1;return n=i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,r=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!r){var o=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top,s=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,a=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,l=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;n=(o||s)&&(a||l)}if(t.worldBounds&&!n){var u=t.worldBounds,c=u.getWidth(),h=!u.containsBounds(i),d=!u.containsBounds(e);h&&!d?(e=e.add(-c,0),n=i.intersectsBounds(e,{inclusive:t.inclusive})):d&&!h&&(i=i.add(-c,0),n=e.intersectsBounds(i,{inclusive:t.inclusive}))}return n},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),r=this.contains(e.right,e.bottom,i),o=this.contains(e.left,e.top,i),s=this.contains(e.right,e.top,i);return t?n||r||o||s:n&&r&&o&&s},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),o=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,r.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,o.x),this.top=Math.max(r.y,o.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,n=t.rightTolerance||0,r=this.clone();if(e){for(var o=e.getWidth();r.left<e.left&&r.right-n<=e.left;)r=r.add(o,0);for(;r.left+i>=e.right&&r.right>e.right;)r=r.add(-o,0);var s=r.left+i;s<e.right&&s>e.left&&r.right-n>e.right&&(r=r.add(-o,0))}return r},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"==e.charAt(0)?"b":"t",t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"none":"";i.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(e,null);i=n?n.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var r=["left","top","right","bottom"];window.opera&&OpenLayers.Util.indexOf(r,t)!=-1&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],n=t&&e[1];return new OpenLayers.LonLat(i,n)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(e[t].src.indexOf("firebug.js")!=-1&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var n=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],n=i&&i[e];return n||(n=e),t&&(n=OpenLayers.String.format(n,t)),n}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,i,n,r,o,s,a){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),r&&(e.style.position=r),o&&(e.style.border=o),s&&(e.style.overflow=s),parseFloat(a)>=0&&parseFloat(a)<1?(e.style.filter="alpha(opacity="+100*a+")",e.style.opacity=a):1==parseFloat(a)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,r,o,s,a){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,r,o,s,a),l},OpenLayers.Util.createImage=function(e,t,i,n,r,o,s,a){function l(){u.style.display="",OpenLayers.Event.stopObservingElement(u)}var u=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="relative"),OpenLayers.Util.modifyDOMElement(u,e,t,i,r,o,null,s),a&&(u.style.display="none",OpenLayers.Event.observe(u,"load",l),OpenLayers.Event.observe(u,"error",l)),u.style.alt=e,u.galleryImg="no",n&&(u.src=n),u},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(n){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&t<7}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,o,null,null,l);var u=e.childNodes[0];r&&(u.src=r),OpenLayers.Util.modifyDOMElement(u,e.id+"_innerImage",null,n,"relative",s),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==a&&(a="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.src+"', sizingMethod='"+a+"')",parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),u.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){var u=OpenLayers.Util.createDiv(),c=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);return c.className="olAlphaImg",u.appendChild(c),OpenLayers.Util.modifyAlphaImageDiv(u,e,t,i,n,r,o,s,a),u},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var n in t)(void 0===e[n]||!i&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var n=e[i];if(null!=n&&"function"!=typeof n){var r;if("object"==typeof n&&n.constructor==Array){for(var o,s=[],a=0,l=n.length;a<l;a++)o=n[a],s.push(encodeURIComponent(null===o||void 0===o?"":o));r=s.join(",")}else r=encodeURIComponent(n);t.push(encodeURIComponent(i)+"="+r)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var n=(e+" ").split(/[?&]/);i+=" "===n.pop()?t:n.length?"&"+t:"?"+t}return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var n=arguments[t];try{e=n();break}catch(r){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,r=i.b,o=i.f,s=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(t.lat))),u=Math.sin(a),c=Math.cos(a),h=Math.sin(l),d=Math.cos(l),p=s,f=2*Math.PI,m=20;Math.abs(p-f)>1e-12&&--m>0;){var g=Math.sin(p),y=Math.cos(p),v=Math.sqrt(d*g*(d*g)+(c*h-u*d*y)*(c*h-u*d*y));if(0==v)return 0;var E=u*h+c*d*y,T=Math.atan2(v,E),b=Math.asin(c*d*g/v),C=Math.cos(b)*Math.cos(b),O=E-2*u*h/C,x=o/16*C*(4+o*(4-3*C));f=p,p=s+(1-x)*o*Math.sin(b)*(T+x*v*(O+x*E*(-1+2*O*O)))}if(0==m)return NaN;var w=C*(n*n-r*r)/(r*r),R=1+w/16384*(4096+w*(-768+w*(320-175*w))),L=w/1024*(256+w*(-128+w*(74-47*w))),S=L*v*(O+L/4*(E*(-1+2*O*O)-L/6*O*(-3+4*v*v)*(-3+4*O*O))),_=r*R*(T-S),I=_.toFixed(3)/1e3;return I},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var n=OpenLayers.Util,r=n.VincentyConstants,o=r.a,s=r.b,a=r.f,l=e.lon,u=e.lat,c=i,h=n.rad(t),d=Math.sin(h),p=Math.cos(h),f=(1-a)*Math.tan(n.rad(u)),m=1/Math.sqrt(1+f*f),g=f*m,y=Math.atan2(f,p),v=m*d,E=1-v*v,T=E*(o*o-s*s)/(s*s),b=1+T/16384*(4096+T*(-768+T*(320-175*T))),C=T/1024*(256+T*(-128+T*(74-47*T))),O=c/(s*b),x=2*Math.PI;Math.abs(O-x)>1e-12;){var w=Math.cos(2*y+O),R=Math.sin(O),L=Math.cos(O),S=C*R*(w+C/4*(L*(-1+2*w*w)-C/6*w*(-3+4*R*R)*(-3+4*w*w)));x=O,O=c/(s*b)+S}var _=g*R-m*L*p,I=Math.atan2(g*L+m*R*p,(1-a)*Math.sqrt(v*v+_*_)),D=Math.atan2(R*d,m*L-g*R*p),M=a/16*E*(4+a*(4-3*E)),A=D-(1-M)*a*v*(O+M*R*(w+M*L*(-1+2*w*w)));Math.atan2(v,-_);return new OpenLayers.LonLat(l+n.deg(A),n.deg(I))},OpenLayers.Util.getParameters=function(e,t){t=t||{},e=null===e||void 0===e?window.location.href:e;var i="";if(OpenLayers.String.contains(e,"?")){var n=e.indexOf("?")+1,r=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;
i=e.substring(n,r)}for(var o={},s=i.split(/[&;]/),a=0,l=s.length;a<l;++a){var u=s[a].split("=");if(u[0]){var c=u[0];try{c=decodeURIComponent(c)}catch(h){c=unescape(c)}var d=(u[1]||"").replace(/\+/g," ");try{d=decodeURIComponent(d)}catch(h){d=unescape(d)}t.splitArgs!==!1&&(d=d.split(",")),1==d.length&&(d=d[0]),o[c]=d}}return o},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var n=OpenLayers.Util.normalizeScale(e);i=1/(n*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n,r=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),o=null;if(e.getBoundingClientRect){n=e.getBoundingClientRect();var s=window.pageYOffset||i.scrollTop,a=window.pageXOffset||i.scrollLeft;t[0]=n.left+a,t[1]=n.top+s}else if(document.getBoxObjectFor&&!r){n=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=n.screenX-l.screenX,t[1]=n.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,o=e.offsetParent,o!=e)for(;o;)t[0]+=o.offsetLeft,t[1]+=o.offsetTop,o=o.offsetParent;var u=OpenLayers.BROWSER_NAME;for(("opera"==u||"safari"==u&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),o=e.offsetParent;o&&o!=document.body;)t[0]-=o.scrollLeft,"opera"==u&&"TR"==o.tagName||(t[1]-=o.scrollTop),o=o.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var n=OpenLayers.Util.createUrlObject(e,i),r=OpenLayers.Util.createUrlObject(t,i);for(var o in n)if("args"!==o&&n[o]!=r[o])return!1;for(var o in n.args){if(n.args[o]!=r.args[o])return!1;delete r.args[o]}for(var o in r.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",r=i.protocol+"//"+i.host.split(":").shift()+n;if(0===e.indexOf("/"))e=r+e;else{var o=i.pathname.split("/");o.pop(),e=r+o.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var a={};a.host=s.host.split(":").shift(),a.protocol=s.protocol,t.ignorePort80?a.port="80"==s.port||"0"==s.port?"":s.port:a.port=""==s.port||"0"==s.port?"80":s.port,a.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var u=e.indexOf("?");l=u!=-1?e.substr(u):""}return a.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs}),a.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname,a},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),n=e.indexOf("#");return t=i==-1?n!=-1?e.substr(0,n):e:n!=-1?e.substr(0,Math.min(i,n)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")==-1&&e.indexOf("gecko")!=-1}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return t.indexOf("opera")!=-1?e="opera":t.indexOf("msie")!=-1?e="msie":t.indexOf("safari")!=-1?e="safari":t.indexOf("mozilla")!=-1&&(e=t.indexOf("firefox")!=-1?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,r,o=document.createElement("div");o.style.visibility="hidden";for(var s=i&&i.containerElement?i.containerElement:document.body,a=!1,l=null,u=s;u&&"body"!=u.tagName.toLowerCase();){var c=OpenLayers.Element.getStyle(u,"position");if("absolute"==c){a=!0;break}if(c&&"static"!=c)break;u=u.parentNode}!a||0!==s.clientHeight&&0!==s.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(o)),o.style.position="absolute",t&&(t.w?(n=t.w,o.style.width=n+"px"):t.h&&(r=t.h,o.style.height=r+"px")),i&&i.displayClass&&(o.className=i.displayClass);var h=document.createElement("div");if(h.innerHTML=e,h.style.overflow="visible",h.childNodes)for(var d=0,p=h.childNodes.length;d<p;d++)h.childNodes[d].style&&(h.childNodes[d].style.overflow="visible");return o.appendChild(h),l?s.appendChild(l):s.appendChild(o),n||(n=parseInt(h.scrollWidth),o.style.width=n+"px"),r||(r=parseInt(h.scrollHeight)),o.removeChild(h),l?(l.removeChild(o),s.removeChild(l)):s.removeChild(o),new OpenLayers.Size(n,r)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,n=0,r=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),n=i.offsetWidth,t.style.overflow="scroll",r=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=n-r,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),s=o;o=Math.floor(o);var a=(s-o)/(1/60);a=Math.round(10*a),a/=10,a>=60&&(a-=60,o+=1,o>=60&&(o-=60,r+=1)),r<10&&(r="0"+r);var l=r+"°";return i.indexOf("dm")>=0&&(o<10&&(o="0"+o),l+=o+"'",i.indexOf("dms")>=0&&(a<10&&(a="0"+a),l+=a+'"')),l+="lon"==t?e<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):e<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Util.getConstructor=function(e){var t,i=e.split(".");t="OpenLayers"===i[0]?OpenLayers:window[i[0]];for(var n=1,r=i.length;n<r;++n)t=t[i[n]];return t},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){OpenLayers.Format.XML.supportActiveX&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=OpenLayers.Format.XML.supportActiveX&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return this.keepData&&(this.data=i),i},write:function(e){var t;if(this.xmldom)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var n=document.implementation.createDocument("","",null);n.importNode&&(e=n.importNode(e,!0)),n.appendChild(e),t=i.serializeToString(n)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){var i;return i=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){var e;return e=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){var t;return"string"!=typeof e&&(e=String(e)),t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,i);else for(var r,o,s=e.getElementsByTagName("*"),a=0,l=s.length;a<l;++a)r=s[a],o=r.prefix?r.prefix+":"+i:i,"*"!=i&&o!=r.nodeName||"*"!=t&&t!=r.namespaceURI||n.push(r);return n},getAttributeNodeNS:function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var r,o,s=e.attributes,a=0,l=s.length;a<l;++a)if(r=s[a],r.namespaceURI==t&&(o=r.prefix?r.prefix+":"+i:i,o==r.nodeName)){n=r;break}return n},getAttributeNS:function(e,t,i){var n="";if(e.getAttributeNS)n=e.getAttributeNS(t,i)||"";else{var r=this.getAttributeNodeNS(e,t,i);r&&(n=r.nodeValue)}return n},getChildValue:function(e,t){var i=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:i+=n.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,n=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,r=e.firstChild;r;r=r.nextSibling){switch(r.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)n=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return n},hasAttributeNS:function(e,t,i){var n=!1;return n=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,n){if(e.setAttributeNS)e.setAttributeNS(t,i,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var r=e.ownerDocument.createNode(2,i,t);r.nodeValue=n,e.setAttributeNode(r)}else e.setAttribute(i,n)}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var n=e.indexOf(":");i=this.namespaces[e.substring(0,n)]}i||(i=this.namespaces[this.defaultPrefix]);var r=this.createElementNS(i,e);t.attributes&&this.setAttributes(r,t.attributes);var o=t.value;return null!=o&&r.appendChild(this.createTextNode(o)),r},setAttributes:function(e,t){var i,n;for(var r in t)null!=t[r]&&t[r].toString&&(i=t[r].toString(),n=this.namespaces[r.substring(0,r.indexOf(":"))]||null,this.setAttributeNS(e,n,r,i))},getFirstElementChild:function(e){if(e.firstElementChild)return e.firstElementChild;for(var t=e.firstChild;1!=t.nodeType&&(t=t.nextSibling););return t},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var n=e.localName||e.nodeName.split(":").pop(),r=i[n]||i["*"];r&&r.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,n=e.childNodes,r=0,o=n.length;r<o;++r)i=n[r],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var n,r,o=e.indexOf(":");o>0?(n=e.substring(0,o),r=e.substring(o+1)):(n=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,r=e);var s=this.writers[n][r].apply(this,[t]);return i&&i.appendChild(s),s},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var n=e;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(t&&t!==(n.localName||n.nodeName.split(":").pop())||i&&i!==n.namespaceURI))break e;n=null;break e;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break e}return n||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var n=e.attributes.length;if(n)for(var r,o=0;o<n;++o){if(r=e.attributes[o],"xmlns"===r.prefix&&r.name==="xmlns:"+t){i=r.value||null;break e}if("xmlns"===r.name&&null===t){i=r.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&OpenLayers.Format.XML.supportActiveX&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.XML.supportActiveX=function(){return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window}(),OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){var t;return t=isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"}}(),parse:function(e){var t,i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var n=parseInt(i[1],10)||0,r=parseInt(i[2],10)-1||0,o=parseInt(i[3],10)||1;t=new Date(Date.UTC(n,r,o));var s=i[7];if(s){var a=parseInt(i[4],10),l=parseInt(i[5],10),u=parseFloat(i[6]),c=0|u,h=Math.round(1e3*(u-c));if(t.setUTCHours(a,l,c,h),"Z"!==s){var d=parseInt(s,10),p=parseInt(i[8],10)||0,f=-1e3*(60*(60*d)+60*p);t=new Date(t.getTime()+f)}}}else t=new Date("invalid");return t}},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var n=this.geometry.getBounds();t=i.intersectsBounds(n)}else{var r=i.toGeometry();t=r.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();return this.geometry.move(n*(t.x-i.x),n*(i.y-t.y)),this.layer.drawFeature(this),i}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var n=!1,r=this.getBounds();if(null!=r&&null!=e){var o=null!=t?t:0,s=null!=i?i:0,a=new OpenLayers.Bounds(this.bounds.left-o,this.bounds.bottom-s,this.bounds.right+o,this.bounds.top+s);n=a.containsLonLat(e)}return n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i);var n=i.read(e);if(n instanceof OpenLayers.Feature.Vector)t=n.geometry;else if(OpenLayers.Util.isArray(n)){for(var r=n.length,o=new Array(r),s=0;s<r;++s)o[s]=n[s].geometry;t=new OpenLayers.Geometry.Collection(o)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point,r=i&&i.tolerance,o=!1,s=e.x1-t.x1,a=e.y1-t.y1,l=e.x2-e.x1,u=e.y2-e.y1,c=t.y2-t.y1,h=t.x2-t.x1,d=c*l-h*u,p=h*a-c*s,f=l*a-u*s;if(0==d)0==p&&0==f&&(o=!0);else{var m=p/d,g=f/d;if(m>=0&&m<=1&&g>=0&&g<=1)if(n){var y=e.x1+m*l,v=e.y1+m*u;o=new OpenLayers.Geometry.Point(y,v)}else o=!0}if(r){var E;if(o){if(n){var T,y,v,b=[e,t];e:for(var C=0;C<2;++C){T=b[C];for(var O=1;O<3;++O)if(y=T["x"+O],v=T["y"+O],E=Math.sqrt(Math.pow(y-o.x,2)+Math.pow(v-o.y,2)),E<r){o.x=y,o.y=v;break e}}}}else{var x,w,y,v,R,L,b=[e,t];e:for(var C=0;C<2;++C){x=b[C],w=b[(C+1)%2];for(var O=1;O<3;++O)if(R={x:x["x"+O],y:x["y"+O]},L=OpenLayers.Geometry.distanceToSegment(R,w),L.distance<r){o=!n||new OpenLayers.Geometry.Point(R.x,R.y);break e}}}}return o},OpenLayers.Geometry.distanceToSegment=function(e,t){var i=OpenLayers.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var i,n,r=e.x,o=e.y,s=t.x1,a=t.y1,l=t.x2,u=t.y2,c=l-s,h=u-a,d=0==c&&0==h?0:(c*(r-s)+h*(o-a))/(Math.pow(c,2)+Math.pow(h,2));return d<=0?(i=s,n=a):d>=1?(i=l,n=u):(i=s+d*c,n=a+d*h),{distance:Math.pow(i-r,2)+Math.pow(n-o,2),x:i,y:n,along:d}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,r,o,s,a,l=!(t&&t.edge===!1),u=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,r=this.y,o=e.x,s=e.y,i=Math.sqrt(Math.pow(n-o,2)+Math.pow(r-s,2)),a=u?{x0:n,y0:r,x1:o,y1:s,distance:i}:i):(a=e.distanceTo(this,t),u&&(a={x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0,distance:a.distance})),a},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var e=OpenLayers.Util.getConstructor(this.CLASS_NAME),t=new e,i=0,n=this.components.length;i<n;i++)t.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(t,this),t},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;i<n;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),r=this.components.slice(t,this.components.length);n.push(e),this.components=n.concat(r)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,n=[],r=[],o=0,s=Number.MAX_VALUE,a=0;a<t;++a){i=this.components[a];var l=i.getArea(),u=i.getCentroid(!0);isNaN(l)||isNaN(u.x)||isNaN(u.y)||(n.push(l),o+=l,s=l<s&&l>0?l:s,r.push(u))}if(t=n.length,0===o){for(var a=0;a<t;++a)n[a]=1;o=n.length}else{for(var a=0;a<t;++a)n[a]/=s;o/=s}for(var u,l,c=0,h=0,a=0;a<t;++a)u=r[a],l=n[a],c+=u.x*l,h+=u.y*l;return new OpenLayers.Geometry.Point(c/o,h/o)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;i<n;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,r,o=!(t&&t.edge===!1),s=o&&t&&t.details,a=Number.POSITIVE_INFINITY,l=0,u=this.components.length;l<u&&(i=this.components[l].distanceTo(e,t),r=s?i.distance:i,!(r<a&&(a=r,n=i,0==a)));++l);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;i<n;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;
return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n;i++){var r=this.components[i];r.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;i<n&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;i<n;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0;if(t.components&&t.components.length>1)for(var r,o,s=1,a=t.components.length;s<a;s++)r=t.components[s-1],o=t.components[s],n+=OpenLayers.Util.distVincenty({lon:r.x,lat:r.y},{lon:o.x,lat:o.y});return 1e3*n},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;return t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,r=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var o,s,a,l,u,c,h,d;e:for(var p=0,f=r.length;p<f;++p){o=r[p],s=o.x1,a=o.x2,l=o.y1,u=o.y2;for(var m=0,g=n.length;m<g&&(c=n[m],!(c.x1>a));++m)if(!(c.x2<s)&&(h=c.y1,d=c.y2,!(Math.min(h,d)>Math.max(l,u))&&!(Math.max(h,d)<Math.min(l,u))&&OpenLayers.Geometry.segmentsIntersect(o,c))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,r=new Array(n),o=0;o<n;++o)t=this.components[o],i=this.components[o+1],t.x<i.x?r[o]={x1:t.x,y1:t.y,x2:i.x,y2:i.y}:r[o]={x1:i.x,y1:i.y,x2:t.x,y2:t.y};return r.sort(e)},splitWithSegment:function(e,t){for(var i,n,r,o,s,a=!(t&&t.edge===!1),l=t&&t.tolerance,u=[],c=this.getVertices(),h=[],d=[],p=!1,f={point:!0,tolerance:l},m=null,g=0,y=c.length-2;g<=y;++g)if(i=c[g],h.push(i.clone()),n=c[g+1],s={x1:i.x,y1:i.y,x2:n.x,y2:n.y},r=OpenLayers.Geometry.segmentsIntersect(e,s,f),r instanceof OpenLayers.Geometry.Point&&(o=!!(r.x===e.x1&&r.y===e.y1||r.x===e.x2&&r.y===e.y2||r.equals(i)||r.equals(n)),o||a)){if(r.equals(d[d.length-1])||d.push(r.clone()),0===g&&r.equals(i))continue;if(r.equals(n))continue;p=!0,r.equals(i)||h.push(r),u.push(new OpenLayers.Geometry.LineString(h)),h=[r.clone()]}if(p&&(h.push(n.clone()),u.push(new OpenLayers.Geometry.LineString(h))),d.length>0){var v=e.x1<e.x2?1:-1,E=e.y1<e.y2?1:-1;m={lines:u,points:d.sort(function(e,t){return v*e.x-v*t.x||E*e.y-E*t.y})}}return m},split:function(e,t){var i,n,r,o,s=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,u,c,h,d,p,f=this.getVertices(),m=[];r=[];for(var g=0,y=f.length-2;g<=y;++g){l=f[g],u=f[g+1],c={x1:l.x,y1:l.y,x2:u.x,y2:u.y},o=o||[e],a&&m.push(l.clone());for(var v=0;v<o.length;++v)if(h=o[v].splitWithSegment(c,t),h&&(d=h.lines,d.length>0&&(d.unshift(v,1),Array.prototype.splice.apply(o,d),v+=d.length-2),a))for(var E=0,T=h.points.length;E<T;++E)p=h.points[E],p.equals(l)||(m.push(p),r.push(new OpenLayers.Geometry.LineString(m)),m=p.equals(u)?[]:[p.clone()])}a&&r.length>0&&m.length>0&&(m.push(u.clone()),r.push(new OpenLayers.Geometry.LineString(m)))}else s=e.splitWith(this,t);return o&&o.length>1?n=!0:o=[],r&&r.length>1?i=!0:r=[],(n||i)&&(s=a?[r,o]:o),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1),r=n&&t&&t.details,o={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point)for(var a,l=this.getSortedSegments(),u=e.x,c=e.y,h=0,d=l.length;h<d&&(a=l[h],i=OpenLayers.Geometry.distanceToSegment(e,a),!(i.distance<s&&(s=i.distance,o=r?{distance:s,x0:i.x,y0:i.y,x1:u,y1:c,index:h,indexDistance:new OpenLayers.Geometry.Point(a.x1,a.y1).distanceTo(e)}:s,0===s)));++h);else if(e instanceof OpenLayers.Geometry.LineString){var p,f,m,g,y,v=this.getSortedSegments(),E=e.getSortedSegments(),T=E.length,b={point:!0};e:for(var h=0,d=v.length;h<d;++h){p=v[h],g=p.x1,y=p.y1;for(var C=0;C<T;++C){if(f=E[C],m=OpenLayers.Geometry.segmentsIntersect(p,f,b)){s=0,o={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:g,y:y},f),i.distance<s&&(s=i.distance,o={distance:s,x0:g,y0:y,x1:i.x,y1:i.y})}}if(r||(o=o.distance),0!==s&&p){i=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var O=r?i.distance:i;O<s&&(o=r?{distance:s,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:O)}}else o=e.distanceTo(this,t),r&&(o={distance:o.distance,x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0});return o},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t){return e-t},n=function(e,t,i,o){for(var s,l=0,u=0,c=t;c<i;c++)s=r(e[t],e[i],e[c]),s>l&&(l=s,u=c);l>o&&u!=t&&(a.push(u),n(e,t,u,o),n(e,u,i,o))},r=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=n/r*2;return o},o=0,s=t.length-1,a=[];for(a.push(o),a.push(s);t[o].equals(t[s]);)s--,a.push(s);n(t,o,s,e);var l=[];a.sort(i);for(var u=0;u<a.length;u++)l.push(t[a[u]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LineString.geodesic=function(e,t,i){for(var n,r,o,s,a,l,u=[],c=e(0),h=e(1),d=t(c),p=t(h),f=[h,c],m=[p,d],g=[1,0],y={},v=1e5;--v>0&&g.length>0;)o=g.pop(),c=f.pop(),d=m.pop(),l=o.toString(),l in y||(u.push(d),y[l]=!0),s=g.pop(),h=f.pop(),p=m.pop(),a=(o+s)/2,n=e(a),r=t(n),OpenLayers.Geometry.distanceSquaredToSegment(r,{x1:d.x,y1:d.y,x2:p.x,y2:p.y}).distance<i?(u.push(p),l=s.toString(),y[l]=!0):(g.push(s,a,a,o),m.push(p,r,r,d),f.push(h,n,n,c));return new OpenLayers.Geometry.LineString(u)},OpenLayers.Geometry.LineString.geodesicMeridian=function(e,t,i,n,r){var o=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(n){return new OpenLayers.Geometry.Point(e,t+(i-t)*n)},function(e){return e.transform(o,n)},r)},OpenLayers.Geometry.LineString.geodesicParallel=function(e,t,i,n,r){var o=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(n){return new OpenLayers.Geometry.Point(t+(i-t)*n,e)},function(e){return e.transform(o,n)},r)},OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,n=this.components.pop();null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var r=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[r]),i},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,n=this.components.length;i<n-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,r=this.components.length;n<r-1;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n-1;i++){var r=this.components[i];r.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&e<=2)return this.components[0].clone();if(e>2){var t=0,i=0,n=this.components[0].x,r=this.components[0].y,o=-1*this.getArea();if(0!=o){for(var s=0;s<e-1;s++){var a=this.components[s],l=this.components[s+1];t+=(a.x+l.x-2*n)*((a.x-n)*(l.y-r)-(l.x-n)*(a.y-r)),i+=(a.y+l.y-2*r)*((a.x-n)*(l.y-r)-(l.x-n)*(a.y-r))}var u=n+t/(6*o),c=r+i/(6*o)}else{for(var s=0;s<e-1;s++)t+=this.components[s].x,i+=this.components[s].y;var u=t/(e-1),c=i/(e-1)}return new OpenLayers.Geometry.Point(u,c)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,n=this.components.length;i<n-1;i++){var r=this.components[i],o=this.components[i+1];t+=(r.x+o.x)*(o.y-r.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0,r=t.components&&t.components.length;if(r>2){for(var o,s,a=0;a<r-1;a++)o=t.components[a],s=t.components[a+1],n+=OpenLayers.Util.rad(s.x-o.x)*(2+Math.sin(OpenLayers.Util.rad(o.y))+Math.sin(OpenLayers.Util.rad(s.y)));n=n*OpenLayers.Util.VincentyConstants.a*OpenLayers.Util.VincentyConstants.a/2}return n},containsPoint:function(e){function t(e,t,i,n,r){return(e-r)*((n-t)/(r-i))+n}for(var i,n,r,o,s,a,l,u=OpenLayers.Number.limitSigDigs,c=14,h=u(e.x,c),d=u(e.y,c),p=this.components.length-1,f=0,m=0;m<p;++m)if(i=this.components[m],r=u(i.x,c),o=u(i.y,c),n=this.components[m+1],s=u(n.x,c),a=u(n.y,c),o!=a){if(l=u(t(d,r,o,s,a),c),l==h&&(o<a&&d>=o&&d<=a||o>a&&d<=o&&d>=a)){f=-1;break}l<=h||r!=s&&(l<Math.min(r,s)||l>Math.max(r,s))||(o<a&&d>=o&&d<a||o>a&&d<o&&d>=a)&&++f}else if(d==o&&(r<=s&&h>=r&&h<=s||r>=s&&h<=r&&h>=s)){f=-1;break}var g=f==-1?1:!!(1&f);return g},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;i<n&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,n=this.components.length;i<n;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var n,r=1;r<t;++r)if(n=this.components[r].containsPoint(e)){i=1===n&&1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;t<i&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var r=this.components[0];for(t=0,i=r.components.length;t<i&&!(n=e.containsPoint(r.components[t]));++t);}return n},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1);return i=!n&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var r=Math.PI*(1/i-.5);n&&(r+=n/180*Math.PI);for(var o,s,a,l=[],u=0;u<i;++u)o=r+2*u*Math.PI/i,s=e.x+t*Math.cos(o),a=e.y+t*Math.sin(o),l.push(new OpenLayers.Geometry.Point(s,a));var c=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([c])},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isTouchEvent:function(e){return 0===(""+e.type).indexOf("touch")||"pointerType"in e&&(e.pointerType===e.MSPOINTER_TYPE_TOUCH||"touch"===e.pointerType)},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){var r=OpenLayers.Util.getElement(e);if(n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!r._eventCacheID){var o="eventCacheID_";r.id&&(o=r.id+"_"+o),r._eventCacheID=OpenLayers.Util.createUniqueID(o)}var s=r._eventCacheID;this.observers[s]||(this.observers[s]=[]),this.observers[s].push({element:r,name:t,observer:i,useCapture:n}),r.addEventListener?r.addEventListener(t,i,n):r.attachEvent&&r.attachEvent("on"+t,i)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,n){n=n||!1;var r=OpenLayers.Util.getElement(e),o=r._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.detachEvent)&&(t="keydown");var s=!1,a=OpenLayers.Event.observers[o];if(a)for(var l=0;!s&&l<a.length;){var u=a[l];if(u.name==t&&u.observer==i&&u.useCapture==n){a.splice(l,1),0==a.length&&delete OpenLayers.Event.observers[o],s=!0;break}l++}return s&&(r.removeEventListener?r.removeEventListener(t,i,n):r&&r.detachEvent&&r.detachEvent("on"+t,i)),s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],TOUCH_MODEL_POINTER:"pointer",TOUCH_MODEL_MSPOINTER:"MSPointer",TOUCH_MODEL_TOUCH:"touch",listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,n,r){OpenLayers.Util.extend(this,r),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},this._pointerTouches=[],null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t,i=this.getTouchModel(),n=0,r=this.BROWSER_EVENTS.length;n<r;n++)t=this.BROWSER_EVENTS[n],OpenLayers.Event.observe(e,t,this.eventHandler),i!==this.TOUCH_MODEL_POINTER&&i!==this.TOUCH_MODEL_MSPOINTER||0!==t.indexOf("touch")||this.addPointerTouchListener(e,t,this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,n){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var r=this.listeners[e];r||(r=[],this.listeners[e]=r,this.extensionCount[e]=0);var o={obj:t,func:i};n?(r.splice(this.extensionCount[e],0,o),"object"==typeof n&&n.extension&&this.extensionCount[e]++):r.push(o)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var n=this.listeners[e];if(null!=n)for(var r=0,o=n.length;r<o;r++)if(n[r].obj==t&&n[r].func==i){n.splice(r,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(i&&0!=i.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var n,r=0,o=i.length;r<o;r++){var s=i[r];if(n=s.func.apply(s.obj,[t]),void 0!=n&&0==n)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),n}},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){var n=e.touches;if(n&&n[0]){for(var r,o=0,s=0,a=n.length,l=0;l<a;++l)r=this.getTouchClientXY(n[l]),o+=r.clientX,s+=r.clientY;e.clientX=o/a,e.clientY=s/a}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,i=t.pageXOffset,n=t.pageYOffset,r=e.clientX,o=e.clientY;return 0===e.pageY&&Math.floor(o)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(r)>Math.floor(e.pageX)?(r-=i,o-=n):(o<e.pageY-n||r<e.pageX-i)&&(r=e.pageX-i,o=e.pageY-n),e.olClientX=r,e.olClientY=o,{clientX:r,clientY:o}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},getTouchModel:function(){return"_TOUCH_MODEL"in OpenLayers.Events||(OpenLayers.Events._TOUCH_MODEL=window.PointerEvent&&"pointer"||window.MSPointerEvent&&"MSPointer"||"ontouchdown"in document&&"touch"||null),OpenLayers.Events._TOUCH_MODEL},addPointerTouchListener:function(e,t,i){function n(e){i(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=r.length-1;e>=0;--e)r[e].stopPropagation()},preventDefault:function(){for(var e=r.length-1;e>=0;--e)r[e].preventDefault()},type:t},e))}var r=(this.eventHandler,this._pointerTouches);switch(t){case"touchstart":return this.addPointerTouchListenerStart(e,t,n);case"touchend":return this.addPointerTouchListenerEnd(e,t,n);case"touchmove":return this.addPointerTouchListenerMove(e,t,n);default:throw"Unknown touch event type"}},addPointerTouchListenerStart:function(e,t,i){var n=this._pointerTouches,r=function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=!1,r=0,o=n.length;r<o;++r)if(n[r].pointerId==e.pointerId){t=!0;break}t||n.push(e),e.touches=n.slice(),i(e)}};OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerDown":"pointerdown",r);var o=function(e){if(OpenLayers.Event.isTouchEvent(e))for(var t=0,i=n.length;t<i;++t)if(n[t].pointerId==e.pointerId){0!=this.clientWidth&&0!=this.clientHeight&&(Math.ceil(e.clientX)>=this.clientWidth||Math.ceil(e.clientY)>=this.clientHeight)&&n.splice(t,1);break}};OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerOut":"pointerout",o)},addPointerTouchListenerMove:function(e,t,i){var n=this._pointerTouches,r=function(e){if(OpenLayers.Event.isTouchEvent(e)&&(1!=n.length||n[0].pageX!=e.pageX||n[0].pageY!=e.pageY)){for(var t=0,r=n.length;t<r;++t)if(n[t].pointerId==e.pointerId){n[t]=e;break}e.touches=n.slice(),i(e)}};OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerMove":"pointermove",r)},addPointerTouchListenerEnd:function(e,t,i){var n=this._pointerTouches,r=function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=0,r=n.length;t<r;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}e.touches=n.slice(),i(e)}};OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerUp":"pointerup",r)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),n=!i&&e.match(this.URL_SPLIT_REGEX);if(n){var r=window.location;i=n[1]==r.protocol&&n[3]==r.hostname;var o=n[4],s=r.port;(80!=o&&""!=o||"80"!=s&&""!=s)&&(i=i&&o==s)}return i||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e)),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{},e.headers=e.headers||{},e=OpenLayers.Util.applyDefaults(e,t),e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var i,n=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(n=!0);n===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var r=new OpenLayers.Request.XMLHttpRequest,o=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));o=OpenLayers.Request.makeSameOrigin(o,e.proxy),r.open(e.method,o,e.async,e.user,e.password);for(var s in e.headers)r.setRequestHeader(s,e.headers[s]);var a=this.events,l=this;return r.onreadystatechange=function(){if(r.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=a.triggerEvent("complete",{request:r,config:e,requestUrl:o});t!==!1&&l.runCallbacks({request:r,config:e,requestUrl:o})}},e.async===!1?r.send(e.data):window.setTimeout(function(){0!==r.readyState&&r.send(e.data)},0),r},runCallbacks:function(e){var t,i=e.request,n=e.config,r=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var o;n.failure&&(o=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure),"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&i.responseText&&(i.status=200),r(i),(!i.status||i.status>=200&&i.status<300)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(i.status<200||i.status>=300)&&(this.events.triggerEvent("failure",e),o&&o(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=a&&!c?new a:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){if(e._object.send(e._data),l&&!e._async)for(e.readyState=t.OPENED,o(e);e.readyState<t.DONE;)if(e.readyState++,n(e),e._aborted)return}function n(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function r(e){var t=e.responseXML,i=e.responseText;return u&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&(u&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function o(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=r(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function s(e){e._object.onreadystatechange=new window.Function}var a=window.XMLHttpRequest,l=!!window.controllers,u=window.document.all&&!window.opera,c=u&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,l&&a.wrapped&&(t.wrapped=a.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,i,r,a,c){delete this._headers,arguments.length<3&&(r=!0),this._async=r;var h,d=this,p=this.readyState;u&&r&&(h=function(){p!=t.DONE&&(s(d),d.abort())},window.attachEvent("onunload",h)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,i,r,a,c):arguments.length>3?this._object.open(e,i,r,a):this._object.open(e,i,r),this.readyState=t.OPENED,n(this),this._object.onreadystatechange=function(){if(!l||r){if(d.readyState=d._object.readyState,o(d),d._aborted)return void(d.readyState=t.UNSENT);d.readyState==t.DONE&&(delete d._data,s(d),u&&r&&window.detachEvent("onunload",h)),p!=d.readyState&&n(d),p=d.readyState}}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,i(this)},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),s(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var n,r=0;n=this._listeners[r];r++)if(n[0]==e&&n[1]==t&&n[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var n,r=0;(n=this._listeners[r])&&(n[0]!=e||n[1]!=t||n[2]!=i);r++);n&&this._listeners.splice(r,1)},t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,n=0;i=this._listeners[n];n++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),"object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var n=this.getCode(),r=t.getCode();i=n==r||!!OpenLayers.Projection.transforms[n]&&OpenLayers.Projection.transforms[n][r]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],worldExtent:[-180,-89,180,89]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var n=t.getCode(),r=i.getCode(),o=OpenLayers.Projection.transforms;o[n]&&o[n][r]&&o[n][r](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/r,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/r*Math.PI))-Math.PI/2),e}function t(e){e.x=e.x*r/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*r;return e.y=Math.max(-20037508.34,Math.min(t,20037508.34)),e}function i(i,n){var r,o,s,a,l,u=OpenLayers.Projection.addTransform,c=OpenLayers.Projection.nullTransform;for(r=0,o=n.length;r<o;++r)for(s=n[r],u(i,s,t),u(s,i,e),l=r+1;l<o;++l)a=n[l],u(s,a,c),u(a,s,c)}var n,r=20037508.34,o=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100","OSGEO:41001"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];
for(n=o.length-1;n>=0;--n)i(o[n],s);for(n=s.length-1;n>=0;--n)i(s[n],o)}(),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[],this.styles={},this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],n=0,r=i.length;n<r;++n){var o=i[n],s=this.getElementsByTagNameNS(e,"*",o);if(0!=s.length)switch(o.toLowerCase()){case"link":case"networklink":this.parseLinks(s,t);break;case"style":this.extractStyles&&this.parseStyles(s,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(s,t);break;case"placemark":this.parseFeatures(s,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=OpenLayers.Util.extend({},t);i.depth++;for(var n=0,r=e.length;n<r;n++){var o=this.parseProperty(e[n],"*","href");if(o&&!this.fetched[o]){this.fetched[o]=!0;var s=this.fetchLink(o);s&&this.parseData(s,i)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});if(t)return t.responseText},parseStyles:function(e,t){for(var i=0,n=e.length;i<n;i++){var r=this.parseStyle(e[i]);if(r){var o=(t.styleBaseUrl||"")+"#"+r.id;this.styles[o]=r}}},parseKmlColor:function(e){var t=null;if(e){var i=e.match(this.regExes.kmlColor);i&&(t={color:"#"+i[4]+i[3]+i[2],opacity:parseInt(i[1],16)/255})}return t},parseStyle:function(e){for(var t,i,n={},r=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],o=0,s=r.length;o<s;++o)if(t=r[o],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var a=this.parseProperty(i,"*","color"),l=this.parseKmlColor(a);l&&(n.strokeColor=l.color,n.strokeOpacity=l.opacity);var u=this.parseProperty(i,"*","width");u&&(n.strokeWidth=u);break;case"polystyle":var a=this.parseProperty(i,"*","color"),l=this.parseKmlColor(a);l&&(n.fillOpacity=l.opacity,n.fillColor=l.color);var c=this.parseProperty(i,"*","fill");"0"==c&&(n.fillColor="none");var h=this.parseProperty(i,"*","outline");"0"==h&&(n.strokeWidth="0");break;case"iconstyle":var d=parseFloat(this.parseProperty(i,"*","scale")||1),u=32*d,p=32*d,f=this.getElementsByTagNameNS(i,"*","Icon")[0];if(f){var m=this.parseProperty(f,"*","href");if(m){var g=this.parseProperty(f,"*","w"),y=this.parseProperty(f,"*","h"),v="http://maps.google.com/mapfiles/kml";!OpenLayers.String.startsWith(m,v)||g||y||(g=64,y=64,d/=2),g=g||y,y=y||g,g&&(u=parseInt(g)*d),y&&(p=parseInt(y)*d);var E=m.match(this.regExes.kmlIconPalette);if(E){var T=E[1],b=E[2],C=this.parseProperty(f,"*","x"),O=this.parseProperty(f,"*","y"),x=C?C/32:0,w=O?7-O/32:7,R=8*w+x;m="http://maps.google.com/mapfiles/kml/pal"+T+"/icon"+R+b}n.graphicOpacity=1,n.externalGraphic=m}}var L=this.getElementsByTagNameNS(i,"*","hotSpot")[0];if(L){var C=parseFloat(L.getAttribute("x")),O=parseFloat(L.getAttribute("y")),S=L.getAttribute("xunits");"pixels"==S?n.graphicXOffset=-C*d:"insetPixels"==S?n.graphicXOffset=-u+C*d:"fraction"==S&&(n.graphicXOffset=-u*C);var _=L.getAttribute("yunits");"pixels"==_?n.graphicYOffset=-p+O*d+1:"insetPixels"==_?n.graphicYOffset=-(O*d)+1:"fraction"==_&&(n.graphicYOffset=-p*(1-O)+1)}n.graphicWidth=u,n.graphicHeight=p;break;case"balloonstyle":var I=OpenLayers.Util.getXmlNodeValue(i);I&&(n.balloonStyle=I.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var a=this.parseProperty(i,"*","color"),l=this.parseKmlColor(a);l&&(n.fontColor=l.color,n.fontOpacity=l.opacity)}!n.strokeColor&&n.fillColor&&(n.strokeColor=n.fillColor);var D=e.getAttribute("id");return D&&n&&(n.id=D),n},parseStyleMaps:function(e,t){for(var i=0,n=e.length;i<n;i++)for(var r=e[i],o=this.getElementsByTagNameNS(r,"*","Pair"),s=r.getAttribute("id"),a=0,l=o.length;a<l;a++){var u=o[a],c=this.parseProperty(u,"*","key"),h=this.parseProperty(u,"*","styleUrl");h&&"normal"==c&&(this.styles[(t.styleBaseUrl||"")+"#"+s]=this.styles[(t.styleBaseUrl||"")+h])}},parseFeatures:function(e,t){for(var i=[],n=0,r=e.length;n<r;n++){var o=e[n],s=this.parseFeature.apply(this,[o]);if(!s)throw"Bad Placemark: "+n;if(this.extractStyles&&s.attributes&&s.attributes.styleUrl&&(s.style=this.getStyle(s.attributes.styleUrl,t)),this.extractStyles){var a=this.getElementsByTagNameNS(o,"*","Style")[0];if(a){var l=this.parseStyle(a);l&&(s.style=OpenLayers.Util.extend(s.style,l))}}if(this.extractTracks){var u=this.getElementsByTagNameNS(o,this.namespaces.gx,"Track");if(u&&u.length>0){var c=u[0],h={features:[],feature:s};this.readNode(c,h),h.features.length>0&&i.push.apply(i,h.features)}}else i.push(s)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){var n;i.attributes={};for(var r=0,o=this.trackAttributes.length;r<o;++r)n=this.trackAttributes[r],i.attributes[n]=[],n in this.readers.kml||(this.readers.kml[n]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var s=i.angles.length>0;if(s&&i.whens.length!==i.angles.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(var a,l,u,r=0,o=i.whens.length;r<o;++r){if(a=t.feature.clone(),a.fid=t.feature.fid||t.feature.id,l=i.points[r],a.geometry=l,"z"in l&&(a.attributes.altitude=l.z),this.internalProjection&&this.externalProjection&&a.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var c=0,h=this.trackAttributes.length;c<h;++c){var n=this.trackAttributes[c];a.attributes[n]=i.attributes[n][r]}a.attributes.when=i.whens[r],a.attributes.trackId=t.feature.id,s&&(u=i.angles[r],a.attributes.heading=parseFloat(u[0]),a.attributes.tilt=parseFloat(u[1]),a.attributes.roll=parseFloat(u[2])),t.features.push(a)}},coord:function(e,t){var i=this.getChildValue(e),n=i.replace(this.regExes.trimSpace,"").split(/\s+/),r=new OpenLayers.Geometry.Point(n[0],n[1]);n.length>2&&(r.z=parseFloat(n[2])),t.points.push(r)},angles:function(e,t){var i=this.getChildValue(e),n=i.replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(n)}}},parseFeature:function(e){for(var t,i,n,r,o=["MultiGeometry","Polygon","LineString","Point"],s=0,a=o.length;s<a;++s)if(t=o[s],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,i=this.getElementsByTagNameNS(e,this.internalns,t),i.length>0){var r=this.parseGeometry[t.toLowerCase()];if(!r)throw new TypeError("Unsupported geometry type: "+t);n=r.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var l;this.extractAttributes&&(l=this.parseAttributes(e));var u=new OpenLayers.Feature.Vector(n,l),c=e.getAttribute("id")||e.getAttribute("name");return null!=c&&(u.fid=c),u},getStyle:function(e,t){var i=OpenLayers.Util.removeTail(e),n=OpenLayers.Util.extend({},t);if(n.depth++,n.styleBaseUrl=i,!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&n.depth<=this.maxDepth&&!this.fetched[i]){var r=this.fetchLink(i);r&&this.parseData(r,n)}var o=OpenLayers.Util.extend({},this.styles[e]);return o},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),i=[];if(t.length>0){var n=t[0].firstChild.nodeValue;n=n.replace(this.regExes.removeSpace,""),i=n.split(",")}var r=null;if(!(i.length>1))throw"Bad coordinate string: "+n;return 2==i.length&&(i[2]=null),r=new OpenLayers.Geometry.Point(i[0],i[1],i[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=null;if(i.length>0){var r=this.getChildValue(i[0]);r=r.replace(this.regExes.trimSpace,""),r=r.replace(this.regExes.trimComma,",");for(var o,s,a=r.split(this.regExes.splitSpace),l=a.length,u=new Array(l),c=0;c<l;++c){if(o=a[c].split(","),s=o.length,!(s>1))throw"Bad LineString point coordinates: "+a[c];2==o.length&&(o[2]=null),u[c]=new OpenLayers.Geometry.Point(o[0],o[1],o[2])}if(!l)throw"Bad LineString coordinates: "+r;n=t?new OpenLayers.Geometry.LinearRing(u):new OpenLayers.Geometry.LineString(u)}return n},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),i=t.length,n=new Array(i);if(i>0)for(var r,o=0,s=t.length;o<s;++o){if(r=this.parseGeometry.linestring.apply(this,[t[o],!0]),!r)throw"Bad LinearRing geometry: "+o;n[o]=r}return new OpenLayers.Geometry.Polygon(n)},multigeometry:function(e){for(var t,i,n=[],r=e.childNodes,o=0,s=r.length;o<s;++o)if(t=r[o],1==t.nodeType){var a=t.prefix?t.nodeName.split(":")[1]:t.nodeName,i=this.parseGeometry[a.toLowerCase()];i&&n.push(i.apply(this,[t]))}return new OpenLayers.Geometry.Collection(n)}},parseAttributes:function(e){var t={},i=e.getElementsByTagName("ExtendedData");i.length&&(t=this.parseExtendedData(i[0]));for(var n,r,o,s=e.childNodes,a=0,l=s.length;a<l;++a)if(n=s[a],1==n.nodeType&&(r=n.childNodes,r.length>=1&&r.length<=3)){var o;switch(r.length){case 1:o=r[0];break;case 2:var u=r[0],c=r[1];o=3==u.nodeType||4==u.nodeType?u:c;break;case 3:default:o=r[1]}if(3==o.nodeType||4==o.nodeType){var h=n.prefix?n.nodeName.split(":")[1]:n.nodeName,d=OpenLayers.Util.getXmlNodeValue(o);d&&(d=d.replace(this.regExes.trimSpace,""),t[h]=d)}}return t},parseExtendedData:function(e){var t,i,n,r,o={},s=e.getElementsByTagName("Data");for(t=0,i=s.length;t<i;t++){n=s[t],r=n.getAttribute("name");var a={},l=n.getElementsByTagName("value");if(l.length&&(a.value=this.getChildValue(l[0])),this.kvpAttributes)o[r]=a.value;else{var u=n.getElementsByTagName("displayName");u.length&&(a.displayName=this.getChildValue(u[0])),o[r]=a}}var c=e.getElementsByTagName("SimpleData");for(t=0,i=c.length;t<i;t++){var a={};n=c[t],r=n.getAttribute("name"),a.value=this.getChildValue(n),this.kvpAttributes?o[r]=a.value:(a.displayName=r,o[r]=a)}return o},parseProperty:function(e,t,i){var n,r=this.getElementsByTagNameNS(e,t,i);try{n=OpenLayers.Util.getXmlNodeValue(r[0])}catch(o){n=null}return n},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),n=0,r=e.length;n<r;++n)i.appendChild(this.createPlacemarkXML(e[n]));return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}if(this.foldersDesc){var n=this.createElementNS(this.kmlns,"description"),r=this.createTextNode(this.foldersDesc);n.appendChild(r),e.appendChild(n)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),i=e.style&&e.style.label?e.style.label:e.id,n=e.attributes.name||i;t.appendChild(this.createTextNode(n));var r=this.createElementNS(this.kmlns,"description"),o=e.attributes.description||this.placemarksDesc;r.appendChild(this.createTextNode(o));var s=this.createElementNS(this.kmlns,"Placemark");if(null!=e.fid&&s.setAttribute("id",e.fid),s.appendChild(t),s.appendChild(r),e.attributes){var a=this.buildExtendedData(e.attributes);a&&s.appendChild(a)}var l=this.buildGeometryNode(e.geometry);return s.appendChild(l),s},buildGeometryNode:function(e){var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[i.toLowerCase()],r=null;return n&&(r=n.apply(this,[e])),r},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n,r=this.createElementNS(this.kmlns,"Polygon"),o=e.components,s=0,a=o.length;s<a;++s)n=0==s?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,n),i=this.buildGeometry.linearring.apply(this,[o[s]]),t.appendChild(i),r.appendChild(t);return r},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),n=0,r=e.components.length;n<r;++n)t=this.buildGeometryNode.apply(this,[e.components[n]]),t&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates"),n=e.components;if(n){for(var r,o=n.length,s=new Array(o),a=0;a<o;++a)r=n[a],s[a]=this.buildCoordinates(r);t=s.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);return i.appendChild(l),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection)),e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var i in e)if(e[i]&&"name"!=i&&"description"!=i&&"styleUrl"!=i){var n=this.createElementNS(this.kmlns,"Data");n.setAttribute("name",i);var r=this.createElementNS(this.kmlns,"value");if("object"==typeof e[i]){if(e[i].value&&r.appendChild(this.createTextNode(e[i].value)),e[i].displayName){var o=this.createElementNS(this.kmlns,"displayName");o.appendChild(this.getXMLDoc().createCDATASection(e[i].displayName)),n.appendChild(o)}}else r.appendChild(this.createTextNode(e[i]));n.appendChild(r),t.appendChild(n)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,n,r,o,s,a=null,l=t&&t.mutual,u=[],c=[e],h=0,d=this.components.length;h<d;++h){n=this.components[h],o=!1;for(var p=0;p<c.length;++p)if(i=n.split(c[p],t)){if(l){r=i[0];for(var f=0,m=r.length;f<m;++f)0===f&&u.length?u[u.length-1].addComponent(r[f]):u.push(new OpenLayers.Geometry.MultiLineString([r[f]]));o=!0,i=i[1]}if(i.length){i.unshift(p,1),Array.prototype.splice.apply(c,i);break}}o||(u.length?u[u.length-1].addComponent(n.clone()):u=[new OpenLayers.Geometry.MultiLineString(n.clone())])}return u&&u.length>1?o=!0:u=[],c&&c.length>1?s=!0:c=[],(o||s)&&(a=l?[u,c]:c),a},splitWith:function(e,t){var i,n,r,o,s,a,l,u=null,c=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[],a=[e];for(var h=0,d=this.components.length;h<d;++h){s=!1,n=this.components[h];for(var p=0;p<a.length;++p)if(i=a[p].split(n,t)){c&&(r=i[0],r.length&&(r.unshift(p,1),Array.prototype.splice.apply(a,r),p+=r.length-2),i=i[1],0===i.length&&(i=[n.clone()]));for(var f=0,m=i.length;f<m;++f)0===f&&l.length?l[l.length-1].addComponent(i[f]):l.push(new OpenLayers.Geometry.MultiLineString([i[f]]));s=!0}s||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString([n.clone()])])}}else u=e.split(this);return a&&a.length>1?o=!0:a=[],l&&l.length>1?s=!0:l=[],(o||s)&&(u=c?[a,l]:l),u},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],n=0;n<t.length;n++){var r=this.parseFeature(t[n]);r&&i.push(r)}return i},parseFeature:function(e){for(var t,i,n,r,o=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],s=0;s<o.length;++s)if(t=o[s],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){if(r=this.parseGeometry[t.toLowerCase()],!r)throw new TypeError("Unsupported geometry type: "+t);n=r.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var a,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(s=0;s<l.length;++s){var u=l[s],c=this.parseGeometry.box.apply(this,[u]),h=u.parentNode,d=h.localName||h.nodeName.split(":").pop();"boundedBy"===d?a=c:n=c.toGeometry()}var p;this.extractAttributes&&(p=this.parseAttributes(e));var f=new OpenLayers.Feature.Vector(n,p);f.bounds=a;var m=this.getFirstElementChild(e);f.gml={featureType:m.nodeName.split(":")[1],featureNS:m.namespaceURI,featureNSPrefix:m.prefix},f.type=f.gml.featureType;for(var g,y=e.firstChild;y&&(1!=y.nodeType||!(g=y.getAttribute("fid")||y.getAttribute("id")));)y=y.nextSibling;return f.fid=g,f},parseGeometry:{point:function(e){var t,i,n=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),n=i.split(this.regExes.splitSpace)),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),n=i.split(","))),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0)){var r=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),o=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");r.length>0&&o.length>0&&(n=[r[0].firstChild.nodeValue,o[0].firstChild.nodeValue])}return 2==n.length&&(n[2]=null),this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var n,r=0;r<t.length;++r)n=this.parseGeometry.point.apply(this,[t[r]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(e,t){var i,n,r=[],o=[];if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),r=n.split(this.regExes.splitSpace);for(var s,a,l,u,c=parseInt(i[0].getAttribute("dimension")),h=0;h<r.length/c;++h)s=h*c,a=r[s],l=r[s+1],u=2==c?null:r[s+2],this.xy?o.push(new OpenLayers.Geometry.Point(a,l,u)):o.push(new OpenLayers.Geometry.Point(l,a,u))}if(0==r.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0)){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,",");for(var d=n.split(this.regExes.splitSpace),h=0;h<d.length;++h)r=d[h].split(","),2==r.length&&(r[2]=null),this.xy?o.push(new OpenLayers.Geometry.Point(r[0],r[1],r[2])):o.push(new OpenLayers.Geometry.Point(r[1],r[0],r[2]))}var p=null;return 0!=o.length&&(p=t?new OpenLayers.Geometry.LinearRing(o):new OpenLayers.Geometry.LineString(o)),p},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var n,r=0;r<t.length;++r)n=this.parseGeometry.linestring.apply(this,[t[r]]),n&&i.push(n);return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var n,r=0;r<t.length;++r)n=this.parseGeometry.linestring.apply(this,[t[r],!0]),n&&i.push(n);return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var n,r=0;r<t.length;++r)n=this.parseGeometry.polygon.apply(this,[t[r]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t,i,n=[],r=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(r.length>0){var o=[];if(r.length>0&&(t=r[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),o=t.split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var s=new OpenLayers.Geometry.Point(o[0],o[1],o[2]);else var s=new OpenLayers.Geometry.Point(o[1],o[0],o[2])}var a=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(a.length>0){var o=[];if(a.length>0&&(t=a[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),o=t.split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var l=new OpenLayers.Geometry.Point(o[0],o[1],o[2]);else var l=new OpenLayers.Geometry.Point(o[1],o[0],o[2])}if(s&&l){n.push(new OpenLayers.Geometry.Point(s.x,s.y)),n.push(new OpenLayers.Geometry.Point(l.x,s.y)),n.push(new OpenLayers.Geometry.Point(l.x,l.y)),n.push(new OpenLayers.Geometry.Point(s.x,l.y)),n.push(new OpenLayers.Geometry.Point(s.x,s.y));var u=new OpenLayers.Geometry.LinearRing(n);i=new OpenLayers.Geometry.Polygon([u])}return i},box:function(e){var t,i,n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),r=null,o=null;if(n.length>0&&(t=n[0].firstChild.nodeValue,i=t.split(" "),2==i.length&&(r=i[0].split(","),o=i[1].split(","))),null!==r&&null!==o)return new OpenLayers.Bounds(parseFloat(r[0]),parseFloat(r[1]),parseFloat(o[0]),parseFloat(o[1]))}},parseAttributes:function(e){for(var t,i,n,r,o,s,a,l={},u=e.firstChild;u;){if(1==u.nodeType){for(t=u.childNodes,i=0;i<t.length;++i)n=t[i],1==n.nodeType&&(r=n.childNodes,1==r.length?(o=r[0],3!=o.nodeType&&4!=o.nodeType||(s=n.prefix?n.nodeName.split(":")[1]:n.nodeName,a=o.nodeValue.replace(this.regExes.trimSpace,""),l[s]=a)):l[n.nodeName.split(":").pop()]=null);break}u=u.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);n.appendChild(i);var r=this.createElementNS(this.gmlns,"gml:"+this.featureName),o=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),s=e.fid||e.id;o.setAttribute("fid",s),o.appendChild(n);for(var a in e.attributes){var l=this.createTextNode(e.attributes[a]),u=a.substring(a.lastIndexOf(":")+1),c=this.createElementNS(this.featureNS,this.featurePrefix+":"+u);c.appendChild(l),o.appendChild(c)}return r.appendChild(o),r},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[i.toLowerCase()];return n.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPoint"),r=e.components,o=0;o<r.length;o++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[r[o]]),t.appendChild(i),n.appendChild(t);return n},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiLineString"),r=e.components,o=0;o<r.length;++o)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[r[o]]),t.appendChild(i),n.appendChild(t);return n},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n,r=this.createElementNS(this.gmlns,"gml:Polygon"),o=e.components,s=0;s<o.length;++s)n=0==s?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+n),i=this.buildGeometry.linearring.apply(this,[o[s]]),t.appendChild(i),r.appendChild(t);return r},multipolygon:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPolygon"),r=e.components,o=0;o<r.length;++o)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[r[o]]),t.appendChild(i),n.appendChild(t);return n},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var n=e.components?e.components:[e],r=0;r<n.length;r++)i.push(n[r].x+","+n[r].y);var o=this.createTextNode(i.join(" "));return t.appendChild(o),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,featurePrefix:"feature",geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace(this.featurePrefix,e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0==t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var n=0,r=i.length;n<r;++n)this.readNode(i[n],{features:t},!0);else{var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");i.length&&this.readNode(i[0],{features:t},!0)}}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,i){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var n,r=i.split(this.regExes.splitSpace),o=r.length,s=new Array(o),a=0;a<o;++a)n=r[a].split(","),this.xy?s[a]=new OpenLayers.Geometry.Point(n[0],n[1],n[2]):s[a]=new OpenLayers.Geometry.Point(n[1],n[0],n[2]);t.points=s},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,n=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||OpenLayers.Util.indexOf(this.featureType,n)===-1?n===this.featureType&&(i="_typeName"):i="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var n=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(n.type=e.nodeName.split(":").pop(),n.namespace=e.namespaceURI);var r=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");r&&(n.fid=r),this.internalProjection&&this.externalProjection&&n.geometry&&n.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(n.bounds=i.bounds),t.features.push(n)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),n=this.getChildValue(e);t.attributes[i]=n}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){
var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],n=0,r=i.length;n<r;++n)this.writeNode("pointMember",i[n],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],n=0,r=i.length;n<r;++n)this.writeNode("lineStringMember",i[n],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],n=0,r=i.length;n<r;++n)this.writeNode("polygonMember",i[n],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,n=e.components.length;i<n;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus(this.featurePrefix+":"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes){var n=e.attributes[i];null!=n&&this.writeNode("feature:_attribute",{name:i,value:n},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus(this.featurePrefix+":"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],n=this.writeNode("gml:"+i,e,t);return this.srsName&&n.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus(this.featurePrefix+":"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,n=e.length;i<n;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],r=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,r.x,r.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,n=new Array(i),r=0;r<i;++r)t=e[r],this.xy?n[r]=t.x+","+t.y:n[r]=t.y+","+t.x,void 0!=t.z&&(n[r]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?n[0]:n.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,r=[],o=!1,s=0,a=n.length;s<a;s++){t=n[s];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?r.push(t):(o=!0,this.applySymbolizer(t,i,e)))}if(0==o&&r.length>0){o=!0;for(var s=0,a=r.length;s<a;s++)this.applySymbolizer(r[s],i,e)}return n.length>0&&0==o&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],r=e.symbolizer[n]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var o=this.defaultStyle;OpenLayers.Util.applyDefaults(r,{pointRadius:o.pointRadius}),r.stroke!==!0&&r.graphic!==!0||OpenLayers.Util.applyDefaults(r,{strokeWidth:o.strokeWidth,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeDashstyle:o.strokeDashstyle,strokeLinecap:o.strokeLinecap}),r.fill!==!0&&r.graphic!==!0||OpenLayers.Util.applyDefaults(r,{fillColor:o.fillColor,fillOpacity:o.fillOpacity}),r.graphic===!0&&OpenLayers.Util.applyDefaults(r,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,r),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,n,r=this.rules,o=0,s=r.length;o<s;o++){i=r[o].symbolizer;for(var a in i){if(n=i[a],"object"!=typeof n){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var i;for(var n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;i<n;i++)if(e.CLASS_NAME.indexOf(t[i])!=-1)return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var n=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(n,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&e.indexOf("${")!=-1&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={},OpenLayers.Util.extend(this,e),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer)this.symbolizer[e]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(e){var t=this.getContext(e),i=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var n=e.layer.map.getScale();return this.minScaleDenominator&&(i=n>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)),i&&this.maxScaleDenominator&&(i=n<OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)),i&&this.filter&&(i="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(e):this.filter.evaluate(t)),i},getContext:function(e){var t=this.context;return t||(t=e.attributes||e.data),"function"==typeof this.context&&(t=this.context(e)),t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=new Array(t);for(var i=0;i<t;++i)e.symbolizers[i]=this.symbolizers[i].clone()}else{e.symbolizer={};var n,r;for(var o in this.symbolizer)n=this.symbolizer[o],r=typeof n,"object"===r?e.symbolizer[o]=OpenLayers.Util.extend({},n):"string"===r&&(e.symbolizer[o]=n)}return e.filter=this.filter&&this.filter.clone(),e.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement,i={exceptionReport:null};return t&&(this.readChildNodes(e,i),null===i.exceptionReport&&(i=(new OpenLayers.Format.OWSCommon).read(e))),i},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var n=this.parser.write(e,t);return this.stringifyOutput===!1?n:OpenLayers.Format.XML.prototype.write.apply(this,[n])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,n=this.getVersion(i);this.parser=this.getParser(n);var r=this.parser.read(e,t),o=this.parser.errorProperty||null;if(null!==o&&void 0===r[o]){var s=new OpenLayers.Format.OGCExceptionReport;r.error=s.read(e)}return r.version=n,r.requestType=this.name,r},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;t<i;t++){var n=e.fid||e.id;if(n==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;t<i;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;t<i;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}},clone:function(){for(var e=[],t=0,i=this.filters.length;t<i;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t=!1,i=e[this.property];if(void 0===i)return!1;var n;switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:n=this.value,t=this.matchCase||"string"!=typeof i||"string"!=typeof n?i==n:i.toUpperCase()==n.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:n=this.value,t=this.matchCase||"string"!=typeof i||"string"!=typeof n?i!=n:i.toUpperCase()!=n.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:t=i<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:t=i>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:t=i<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:t=i>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:t=i>=this.lowerBoundary&&i<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var r=new RegExp(this.value,"gi");t=r.test(i);break;case OpenLayers.Filter.Comparison.IS_NULL:t=null===i}return t},value2regex:function(e,t,i){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return e=e?e:"*",t=t?t:".",i=i?i:"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 1:t=this.readNode(n),t.property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=n.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var n=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,n),n.value=n.components[0],delete n.components,t.filters.push(n)},encodeLiteral:function(e){return e instanceof Date&&(e=OpenLayers.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,n=e.fids.length;i<n;++i)this.writeNode("ogc:FeatureId",e.fids[i],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),n=0,r=e.filters.length;n<r;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),n=0,r=e.filters.length;n<r;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,n=0,r=i.length;n<r;n++)this.writeOgcExpression(i[n],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",e,t),t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),r=e.getAttribute("singleChar"),o=e.getAttribute("escape");i.value2regex(n,r,o),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(e){OpenLayers.Util.extend(this,e)},clone:function(){var e=OpenLayers.Util.getConstructor(this.CLASS_NAME);return new e(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={namedLayers:t.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(e,i),i},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.description=this.getChildValue(e)},NamedLayer:function(e,t){var i={userStyles:[],namedStyles:[]};this.readChildNodes(e,i);for(var n=0,r=i.userStyles.length;n<r;++n)i.userStyles[n].layerName=i.name;OpenLayers.Util.isArray(t.namedLayers)?t.namedLayers.push(i):t.namedLayers[i.name]=i},NamedStyle:function(e,t){t.namedStyles.push(this.getChildValue(e.firstChild))},UserStyle:function(e,t){var i={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(e,i);var n;this.multipleSymbolizers?(delete i.defaultsPerSymbolizer,n=new OpenLayers.Style2(i)):n=new OpenLayers.Style(this.defaultSymbolizer,i),t.userStyles.push(n)},IsDefault:function(e,t){"1"==this.getChildValue(e)&&(t.isDefault=!0)},FeatureTypeStyle:function(e,t){++this.featureTypeCounter;var i={rules:this.multipleSymbolizers?t.rules:[]};this.readChildNodes(e,i),this.multipleSymbolizers||(t.rules=i.rules)},Rule:function(e,t){var i;this.multipleSymbolizers&&(i={symbolizers:[]});var n=new OpenLayers.Rule(i);this.readChildNodes(e,n),t.rules.push(n)},ElseFilter:function(e,t){t.elseFilter=!0},MinScaleDenominator:function(e,t){t.minScaleDenominator=parseFloat(this.getChildValue(e))},MaxScaleDenominator:function(e,t){t.maxScaleDenominator=parseFloat(this.getChildValue(e))},TextSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),
this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Text(i))):t.symbolizer.Text=OpenLayers.Util.applyDefaults(i,t.symbolizer.Text)},LabelPlacement:function(e,t){this.readChildNodes(e,t)},PointPlacement:function(e,t){var i={};this.readChildNodes(e,i),i.labelRotation=i.rotation,delete i.rotation;var n,r=t.labelAnchorPointX,o=t.labelAnchorPointY;r<=1/3?n="l":r>1/3&&r<2/3?n="c":r>=2/3&&(n="r"),o<=1/3?n+="b":o>1/3&&o<2/3?n+="m":o>=2/3&&(n+="t"),i.labelAlign=n,OpenLayers.Util.applyDefaults(t,i)},AnchorPoint:function(e,t){this.readChildNodes(e,t)},AnchorPointX:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelAnchorPointX=i)},AnchorPointY:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelAnchorPointY=i)},Displacement:function(e,t){this.readChildNodes(e,t)},DisplacementX:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelXOffset=i)},DisplacementY:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelYOffset=i)},LinePlacement:function(e,t){this.readChildNodes(e,t)},PerpendicularOffset:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelPerpendicularOffset=i)},Label:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.label=OpenLayers.String.trim(i))},Font:function(e,t){this.readChildNodes(e,t)},Halo:function(e,t){var i={};this.readChildNodes(e,i),t.haloRadius=i.haloRadius,t.haloColor=i.fillColor,t.haloOpacity=i.fillOpacity},Radius:function(e,t){var i=this.readers.ogc._expression.call(this,e);null!=i&&(t.haloRadius=i)},RasterSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Raster(i))):t.symbolizer.Raster=OpenLayers.Util.applyDefaults(i,t.symbolizer.Raster)},Geometry:function(e,t){t.geometry={},this.readChildNodes(e,t.geometry)},ColorMap:function(e,t){t.colorMap=[],this.readChildNodes(e,t.colorMap)},ColorMapEntry:function(e,t){var i=e.getAttribute("quantity"),n=e.getAttribute("opacity");t.push({color:e.getAttribute("color"),quantity:null!==i?parseFloat(i):void 0,label:e.getAttribute("label")||void 0,opacity:null!==n?parseFloat(n):void 0})},LineSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Line(i))):t.symbolizer.Line=OpenLayers.Util.applyDefaults(i,t.symbolizer.Line)},PolygonSymbolizer:function(e,t){var i={fill:!1,stroke:!1};this.multipleSymbolizers||(i=t.symbolizer.Polygon||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Polygon(i))):t.symbolizer.Polygon=i},PointSymbolizer:function(e,t){var i={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(i=t.symbolizer.Point||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Point(i))):t.symbolizer.Point=i},Stroke:function(e,t){t.stroke=!0,this.readChildNodes(e,t)},Fill:function(e,t){t.fill=!0,this.readChildNodes(e,t)},CssParameter:function(e,t){var i=e.getAttribute("name"),n=this.cssMap[i];if(t.label&&("fill"===i?n="fontColor":"fill-opacity"===i&&(n="fontOpacity")),n){var r=this.readers.ogc._expression.call(this,e);r&&(t[n]=r)}},Graphic:function(e,t){t.graphic=!0;var i={};this.readChildNodes(e,i);for(var n,r,o=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],s=0,a=o.length;s<a;++s)n=o[s],r=i[n],void 0!=r&&(t[n]=r);if(void 0!=i.opacity&&(t.graphicOpacity=i.opacity),void 0!=i.size){var l=i.size/2;isNaN(l)?t.graphicWidth=i.size:t.pointRadius=i.size/2}void 0!=i.href&&(t.externalGraphic=i.href),void 0!=i.rotation&&(t.rotation=i.rotation)},ExternalGraphic:function(e,t){this.readChildNodes(e,t)},Mark:function(e,t){this.readChildNodes(e,t)},WellKnownName:function(e,t){t.graphicName=this.getChildValue(e)},Opacity:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.opacity=i)},Size:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.size=i)},Rotation:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.rotation=i)},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},Format:function(e,t){t.graphicFormat=this.getChildValue(e)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var t=null;for(var i in this.cssMap)if(this.cssMap[i]==e){t=i;break}return t},getGraphicFormat:function(e){var t;for(var i in this.graphicFormats)if(this.graphicFormats[i].test(e)){t=i;break}return t||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(e){return this.writers.sld.StyledLayerDescriptor.apply(this,[e])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(e,t){var i=this.createElementNSPlus(e),n="string"==typeof t?t.split("${"):[t];i.appendChild(this.createTextNode(n[0]));for(var r,o,s=1,a=n.length;s<a;s++)r=n[s],o=r.indexOf("}"),o>0?(this.writeNode("ogc:PropertyName",{property:r.substring(0,o)},i),i.appendChild(this.createTextNode(r.substring(++o)))):i.appendChild(this.createTextNode("${"+r));return i},StyledLayerDescriptor:function(e){var t=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:gml",this.namespaces.gml),e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),OpenLayers.Util.isArray(e.namedLayers))for(var i=0,n=e.namedLayers.length;i<n;++i)this.writeNode("NamedLayer",e.namedLayers[i],t);else for(var r in e.namedLayers)this.writeNode("NamedLayer",e.namedLayers[r],t);return t},Name:function(e){return this.createElementNSPlus("sld:Name",{value:e})},Title:function(e){return this.createElementNSPlus("sld:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("sld:Abstract",{value:e})},NamedLayer:function(e){var t=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",e.name,t),e.namedStyles)for(var i=0,n=e.namedStyles.length;i<n;++i)this.writeNode("NamedStyle",e.namedStyles[i],t);if(e.userStyles)for(var i=0,n=e.userStyles.length;i<n;++i)this.writeNode("UserStyle",e.userStyles[i],t);return t},NamedStyle:function(e){var t=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",e,t),t},UserStyle:function(e){var t=this.createElementNSPlus("sld:UserStyle");if(e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.isDefault&&this.writeNode("IsDefault",e.isDefault,t),this.multipleSymbolizers&&e.rules){for(var i,n,r,o,s,a={0:[]},l=[0],u=0,c=e.rules.length;u<c;++u)if(i=e.rules[u],i.symbolizers){n={};for(var h=0,d=i.symbolizers.length;h<d;++h)r=i.symbolizers[h],o=r.zIndex,o in n||(s=i.clone(),s.symbolizers=[],n[o]=s),n[o].symbolizers.push(r.clone());for(o in n)o in a||(l.push(o),a[o]=[]),a[o].push(n[o])}else a[0].push(i.clone());l.sort();for(var p,u=0,c=l.length;u<c;++u)p=a[l[u]],p.length>0&&(s=e.clone(),s.rules=a[l[u]],this.writeNode("FeatureTypeStyle",s,t))}else this.writeNode("FeatureTypeStyle",e,t);return t},IsDefault:function(e){return this.createElementNSPlus("sld:IsDefault",{value:e?"1":"0"})},FeatureTypeStyle:function(e){for(var t=this.createElementNSPlus("sld:FeatureTypeStyle"),i=0,n=e.rules.length;i<n;++i)this.writeNode("Rule",e.rules[i],t);return t},Rule:function(e){var t=this.createElementNSPlus("sld:Rule");e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.elseFilter?this.writeNode("ElseFilter",null,t):e.filter&&this.writeNode("ogc:Filter",e.filter,t),void 0!=e.minScaleDenominator&&this.writeNode("MinScaleDenominator",e.minScaleDenominator,t),void 0!=e.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",e.maxScaleDenominator,t);var i,n;if(this.multipleSymbolizers&&e.symbolizers)for(var n,r=0,o=e.symbolizers.length;r<o;++r)n=e.symbolizers[r],i=n.CLASS_NAME.split(".").pop(),this.writeNode(i+"Symbolizer",n,t);else for(var s=OpenLayers.Style.SYMBOLIZER_PREFIXES,r=0,a=s.length;r<a;++r)i=s[r],n=e.symbolizer[i],n&&this.writeNode(i+"Symbolizer",n,t);return t},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(e){return this.createElementNSPlus("sld:MinScaleDenominator",{value:e})},MaxScaleDenominator:function(e){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:e})},LineSymbolizer:function(e){var t=this.createElementNSPlus("sld:LineSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),this.writeNode("Stroke",e,t),t},Stroke:function(e){var t=this.createElementNSPlus("sld:Stroke");return void 0!=e.strokeColor&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeColor"},t),void 0!=e.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeOpacity"},t),void 0!=e.strokeWidth&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeWidth"},t),void 0!=e.strokeDashstyle&&"solid"!==e.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeDashstyle"},t),void 0!=e.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeLinecap"},t),t},CssParameter:function(e){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(e.key)},value:e.symbolizer[e.key]})},TextSymbolizer:function(e){var t=this.createElementNSPlus("sld:TextSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),null!=e.label&&this.writeNode("Label",e.label,t),null==e.fontFamily&&null==e.fontSize&&null==e.fontWeight&&null==e.fontStyle||this.writeNode("Font",e,t),null==e.labelAnchorPointX&&null==e.labelAnchorPointY&&null==e.labelAlign&&null==e.labelXOffset&&null==e.labelYOffset&&null==e.labelRotation&&null==e.labelPerpendicularOffset||this.writeNode("LabelPlacement",e,t),null==e.haloRadius&&null==e.haloColor&&null==e.haloOpacity||this.writeNode("Halo",e,t),null==e.fontColor&&null==e.fontOpacity||this.writeNode("Fill",{fillColor:e.fontColor,fillOpacity:e.fontOpacity},t),t},LabelPlacement:function(e){var t=this.createElementNSPlus("sld:LabelPlacement");return null==e.labelAnchorPointX&&null==e.labelAnchorPointY&&null==e.labelAlign&&null==e.labelXOffset&&null==e.labelYOffset&&null==e.labelRotation||null!=e.labelPerpendicularOffset||this.writeNode("PointPlacement",e,t),null!=e.labelPerpendicularOffset&&this.writeNode("LinePlacement",e,t),t},LinePlacement:function(e){var t=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",e.labelPerpendicularOffset,t),t},PerpendicularOffset:function(e){return this.createElementNSPlus("sld:PerpendicularOffset",{value:e})},PointPlacement:function(e){var t=this.createElementNSPlus("sld:PointPlacement");return null==e.labelAnchorPointX&&null==e.labelAnchorPointY&&null==e.labelAlign||this.writeNode("AnchorPoint",e,t),null==e.labelXOffset&&null==e.labelYOffset||this.writeNode("Displacement",e,t),null!=e.labelRotation&&this.writeNode("Rotation",e.labelRotation,t),t},AnchorPoint:function(e){var t=this.createElementNSPlus("sld:AnchorPoint"),i=e.labelAnchorPointX,n=e.labelAnchorPointY;if(null!=i&&this.writeNode("AnchorPointX",i,t),null!=n&&this.writeNode("AnchorPointY",n,t),null==i&&null==n){var r=e.labelAlign.substr(0,1),o=e.labelAlign.substr(1,1);"l"===r?i=0:"c"===r?i=.5:"r"===r&&(i=1),"b"===o?n=0:"m"===o?n=.5:"t"===o&&(n=1),this.writeNode("AnchorPointX",i,t),this.writeNode("AnchorPointY",n,t)}return t},AnchorPointX:function(e){return this.createElementNSPlus("sld:AnchorPointX",{value:e})},AnchorPointY:function(e){return this.createElementNSPlus("sld:AnchorPointY",{value:e})},Displacement:function(e){var t=this.createElementNSPlus("sld:Displacement");return null!=e.labelXOffset&&this.writeNode("DisplacementX",e.labelXOffset,t),null!=e.labelYOffset&&this.writeNode("DisplacementY",e.labelYOffset,t),t},DisplacementX:function(e){return this.createElementNSPlus("sld:DisplacementX",{value:e})},DisplacementY:function(e){return this.createElementNSPlus("sld:DisplacementY",{value:e})},Font:function(e){var t=this.createElementNSPlus("sld:Font");return e.fontFamily&&this.writeNode("CssParameter",{symbolizer:e,key:"fontFamily"},t),e.fontSize&&this.writeNode("CssParameter",{symbolizer:e,key:"fontSize"},t),e.fontWeight&&this.writeNode("CssParameter",{symbolizer:e,key:"fontWeight"},t),e.fontStyle&&this.writeNode("CssParameter",{symbolizer:e,key:"fontStyle"},t),t},Label:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Label",e)},Halo:function(e){var t=this.createElementNSPlus("sld:Halo");return e.haloRadius&&this.writeNode("Radius",e.haloRadius,t),(e.haloColor||e.haloOpacity)&&this.writeNode("Fill",{fillColor:e.haloColor,fillOpacity:e.haloOpacity},t),t},Radius:function(e){return this.createElementNSPlus("sld:Radius",{value:e})},RasterSymbolizer:function(e){var t=this.createElementNSPlus("sld:RasterSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),e.opacity&&this.writeNode("Opacity",e.opacity,t),e.colorMap&&this.writeNode("ColorMap",e.colorMap,t),t},Geometry:function(e){var t=this.createElementNSPlus("sld:Geometry");return e.property&&this.writeNode("ogc:PropertyName",e,t),t},ColorMap:function(e){for(var t=this.createElementNSPlus("sld:ColorMap"),i=0,n=e.length;i<n;++i)this.writeNode("ColorMapEntry",e[i],t);return t},ColorMapEntry:function(e){var t=this.createElementNSPlus("sld:ColorMapEntry"),i=e;return t.setAttribute("color",i.color),void 0!==i.opacity&&t.setAttribute("opacity",parseFloat(i.opacity)),void 0!==i.quantity&&t.setAttribute("quantity",parseFloat(i.quantity)),void 0!==i.label&&t.setAttribute("label",i.label),t},PolygonSymbolizer:function(e){var t=this.createElementNSPlus("sld:PolygonSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},Fill:function(e){var t=this.createElementNSPlus("sld:Fill");return e.fillColor&&this.writeNode("CssParameter",{symbolizer:e,key:"fillColor"},t),null!=e.fillOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"fillOpacity"},t),t},PointSymbolizer:function(e){var t=this.createElementNSPlus("sld:PointSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),this.writeNode("Graphic",e,t),t},Graphic:function(e){var t=this.createElementNSPlus("sld:Graphic");return void 0!=e.externalGraphic?this.writeNode("ExternalGraphic",e,t):this.writeNode("Mark",e,t),void 0!=e.graphicOpacity&&this.writeNode("Opacity",e.graphicOpacity,t),void 0!=e.pointRadius?this.writeNode("Size",2*e.pointRadius,t):void 0!=e.graphicWidth&&this.writeNode("Size",e.graphicWidth,t),void 0!=e.rotation&&this.writeNode("Rotation",e.rotation,t),t},ExternalGraphic:function(e){var t=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",e.externalGraphic,t);var i=e.graphicFormat||this.getGraphicFormat(e.externalGraphic);return this.writeNode("Format",i,t),t},Mark:function(e){var t=this.createElementNSPlus("sld:Mark");return e.graphicName&&this.writeNode("WellKnownName",e.graphicName,t),e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},WellKnownName:function(e){return this.createElementNSPlus("sld:WellKnownName",{value:e})},Opacity:function(e){return this.createElementNSPlus("sld:Opacity",{value:e})},Size:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Size",e)},Rotation:function(e){return this.createElementNSPlus("sld:Rotation",{value:e})},OnlineResource:function(e){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":e}})},Format:function(e){return this.createElementNSPlus("sld:Format",{value:e})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(e,t){var i,n=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(t&&t.map)if(this.context=n,t.map instanceof OpenLayers.Map)i=this.mergeContextToMap(n,t.map);else{var r=t.map;(OpenLayers.Util.isElement(r)||"string"==typeof r)&&(r={div:r}),i=this.contextToMap(n,r)}else i=n;return i},getLayerFromContext:function(e){var t,i,n={queryable:e.queryable,visibility:e.visibility,maxExtent:e.maxExtent,metadata:OpenLayers.Util.applyDefaults(e.metadata,{styles:e.styles,formats:e.formats,"abstract":e["abstract"],dataURL:e.dataURL}),numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity,gutter:e.gutter,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.tileSize?new OpenLayers.Size(e.tileSize.width,e.tileSize.height):void 0,minScale:e.minScale||e.maxScaleDenominator,maxScale:e.maxScale||e.minScaleDenominator,srs:e.srs,dimensions:e.dimensions,metadataURL:e.metadataURL,attribution:e.attribution};this.layerOptions&&OpenLayers.Util.applyDefaults(n,this.layerOptions);var r={layers:e.name,transparent:e.transparent,version:e.version};if(e.formats&&e.formats.length>0)for(r.format=e.formats[0].value,t=0,i=e.formats.length;t<i;t++){var o=e.formats[t];if(1==o.current){r.format=o.value;break}}if(e.styles&&e.styles.length>0)for(t=0,i=e.styles.length;t<i;t++){var s=e.styles[t];if(1==s.current){s.href?r.sld=s.href:s.body?r.sld_body=s.body:r.styles=s.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(r,this.layerParams);var a=null,l=e.service;return l==OpenLayers.Format.Context.serviceTypes.WFS?(n.strategies=[new OpenLayers.Strategy.BBOX],n.protocol=new OpenLayers.Protocol.WFS({url:e.url,featurePrefix:e.name.split(":")[0],featureType:e.name.split(":").pop()}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.KML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.KML}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.GML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.GML}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):e.features?(a=new OpenLayers.Layer.Vector(e.title||e.name,n),a.addFeatures(e.features)):e.categoryLayer!==!0&&(a=new OpenLayers.Layer.WMS(e.title||e.name,e.url,r,n)),a},getLayersFromContext:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=this.getLayerFromContext(e[i]);null!==r&&t.push(r)}return t},contextToMap:function(e,t){t=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},t),t.maxExtent&&(t.maxResolution=t.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var i={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};t.metadata=i;var n=new OpenLayers.Map(t);return n.addLayers(this.getLayersFromContext(e.layersContext)),n.setCenter(e.bounds.getCenterLonLat(),n.getZoomForExtent(e.bounds,!0)),n},mergeContextToMap:function(e,t){return t.addLayers(this.getLayersFromContext(e.layersContext)),t},write:function(e,t){return e=this.toContext(e),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(e,t){var i=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===i&&(i=this.defaultVersion),i},toContext:function(e){var t={};return"OpenLayers.Map"==e.CLASS_NAME&&(t.bounds=e.getExtent(),t.maxExtent=e.maxExtent,t.projection=e.projection,t.size=e.getSize(),t.layers=e.layers),t},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var i=this.version;if(!i){var n=e.getAttribute("xmlns:ows");n&&"1.1"===n.substring(n.lastIndexOf("/")+1)&&(i="1.1.0"),i||(i=this.defaultVersion)}return i},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Facsimile:function(e,t){t.facsimile=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.left=n[0],t.bottom=n[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.right=n[0],t.top=n[1],t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featurePrefix:"feature",featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(e){if(e.layersContext)for(var t=0,i=e.layersContext.length;t<i;t++){var n=e.layersContext[t],r=[],o=e.title||"";e.metadata&&e.metadata.nestingPath&&(r=e.metadata.nestingPath.slice()),""!=o&&r.push(o),n.metadata.nestingPath=r,n.layersContext&&this.setNestingPath(n)}},decomposeNestingPath:function(e){var t=[];if(OpenLayers.Util.isArray(e)){for(var i=e.slice();i.length>0;)t.push(i.slice()),i.pop();t.reverse()}return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t),this.setNestingPath({layersContext:t.layersContext});var i=[];return this.processLayer(i,t),delete t.layersContext,t.layersContext=i,t},processLayer:function(e,t){if(t.layersContext)for(var i=0,n=t.layersContext.length;i<n;i++){var r=t.layersContext[i];e.push(r),r.layersContext&&this.processLayer(e,r)}},write:function(e,t){var i="OWSContext";this.nestingLayerLookup={},t=t||{},OpenLayers.Util.applyDefaults(t,e);var n=this.writeNode(i,t);return this.nestingLayerLookup=null,this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[n])},readers:{kml:{Document:function(e,t){t.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(e)}},owc:{OWSContext:function(e,t){this.readChildNodes(e,t)},General:function(e,t){this.readChildNodes(e,t)},ResourceList:function(e,t){this.readChildNodes(e,t)},Layer:function(e,t){var i={metadata:{},visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),opacity:null!=e.getAttribute("opacity")?parseFloat(e.getAttribute("opacity")):null,name:e.getAttribute("name"),categoryLayer:null==e.getAttribute("name"),formats:[],styles:[]};t.layersContext||(t.layersContext=[]),t.layersContext.push(i),this.readChildNodes(e,i)},InlineGeometry:function(e,t){t.features=[];var i,n=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(n.length>=1&&(i=n[0]),i&&i.firstChild){var r=i.firstChild.nextSibling?i.firstChild.nextSibling:i.firstChild;this.setNamespace("feature",r.namespaceURI),this.featureType=r.localName||r.nodeName.split(":").pop(),this.readChildNodes(e,t)}},Server:function(e,t){(t.service||t.version)&&t.service==OpenLayers.Format.Context.serviceTypes.WMS||(t.service=e.getAttribute("service"),t.version=e.getAttribute("version"),this.readChildNodes(e,t))},Name:function(e,t){t.name=this.getChildValue(e),this.readChildNodes(e,t)},Title:function(e,t){t.title=this.getChildValue(e),this.readChildNodes(e,t)},StyleList:function(e,t){this.readChildNodes(e,t.styles)},Style:function(e,t){var i={};t.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={};t.legend=i,this.readChildNodes(e,i)},OnlineResource:function(e,t){t.url=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(e){var t=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:e.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",e,t),this.writeNode("ResourceList",e,t),t},General:function(e){var t=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",e,t),this.writeNode("ows:Title",e.title||"OpenLayers OWSContext",t),t},ResourceList:function(e){for(var t=this.createElementNSPlus("ResourceList"),i=0,n=e.layers.length;i<n;i++){var r=e.layers[i],o=this.decomposeNestingPath(r.metadata.nestingPath);this.writeNode("_Layer",{layer:r,subPaths:o},t)}return t},Server:function(e){var t=this.createElementNSPlus("Server",{attributes:{version:e.version,service:e.service}});return this.writeNode("OnlineResource",e,t),t},OnlineResource:function(e){var t=this.createElementNSPlus("OnlineResource",{
attributes:{"xlink:href":e.url}});return t},InlineGeometry:function(e){var t=this.createElementNSPlus("InlineGeometry"),i=e.getDataExtent();null!==i&&this.writeNode("gml:boundedBy",i,t);for(var n=0,r=e.features.length;n<r;n++)this.writeNode("gml:featureMember",e.features[n],t);return t},StyleList:function(e){for(var t=this.createElementNSPlus("StyleList"),i=0,n=e.length;i<n;i++)this.writeNode("Style",e[i],t);return t},Style:function(e){var t=this.createElementNSPlus("Style");return this.writeNode("Name",e,t),this.writeNode("Title",e,t),e.legend&&this.writeNode("LegendURL",e,t),t},Name:function(e){var t=this.createElementNSPlus("Name",{value:e.name});return t},Title:function(e){var t=this.createElementNSPlus("Title",{value:e.title});return t},LegendURL:function(e){var t=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",e.legend,t),t},_WMS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.params.LAYERS,queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1",opacity:e.hasOwnProperty("opacity")?e.opacity:null}});return this.writeNode("ows:Title",e.name,t),this.writeNode("ows:OutputFormat",e.params.FORMAT,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:e.params.VERSION,url:e.url},t),e.metadata.styles&&e.metadata.styles.length>0&&this.writeNode("StyleList",e.metadata.styles,t),t},_Layer:function(e){var t,i,n,r;if(t=e.layer,i=e.subPaths,n=null,r=null,i.length>0){var o=i[0].join("/"),s=o.lastIndexOf("/");return n=this.nestingLayerLookup[o],r=s>0?o.substring(s+1,o.length):o,n||(n=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",r,n),this.nestingLayerLookup[o]=n),e.subPaths.shift(),this.writeNode("_Layer",e,n),n}return t instanceof OpenLayers.Layer.WMS?n=this.writeNode("_WMS",t):t instanceof OpenLayers.Layer.Vector&&(t.protocol instanceof OpenLayers.Protocol.WFS.v1?n=this.writeNode("_WFS",t):t.protocol instanceof OpenLayers.Protocol.HTTP?t.protocol.format instanceof OpenLayers.Format.GML?(t.protocol.format.version="2.1.2",n=this.writeNode("_GML",t)):t.protocol.format instanceof OpenLayers.Format.KML&&(t.protocol.format.version="2.2",n=this.writeNode("_KML",t)):(this.setNamespace("feature",this.featureNS),n=this.writeNode("_InlineGeometry",t))),t.options.maxScale&&this.writeNode("sld:MinScaleDenominator",t.options.maxScale,n),t.options.minScale&&this.writeNode("sld:MaxScaleDenominator",t.options.minScale,n),this.nestingLayerLookup[t.name]=n,n},_WFS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.protocol.featurePrefix+":"+e.protocol.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:e.protocol.version,url:e.protocol.url},t),t},_InlineGeometry:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("InlineGeometry",e,t),t},_GML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:e.protocol.url,version:e.protocol.format.version},t),t},_KML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:e.protocol.format.version,url:e.protocol.url},t),t}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(e){var t=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",e,t),t}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Format.CSWGetRecords=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetRecords.DEFAULTS);var t=OpenLayers.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetRecords version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WPSDescribeProcess.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},errorProperty:"processDescriptions",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{ProcessDescriptions:function(e,t){t.processDescriptions={},this.readChildNodes(e,t.processDescriptions)},ProcessDescription:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),n={processVersion:i,statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,n),t[n.identifier]=n},DataInputs:function(e,t){t.dataInputs=[],this.readChildNodes(e,t.dataInputs)},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},ComplexOutput:function(e,t){t.complexOutput={},this.readChildNodes(e,t.complexOutput)},LiteralOutput:function(e,t){t.literalOutput={},this.readChildNodes(e,t.literalOutput)},Input:function(e,t){var i={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,i),t.push(i)},BoundingBoxData:function(e,t){t.boundingBoxData={},this.readChildNodes(e,t.boundingBoxData)},CRS:function(e,t){t.CRSs||(t.CRSs={}),t.CRSs[this.getChildValue(e)]=!0},LiteralData:function(e,t){t.literalData={},this.readChildNodes(e,t.literalData)},ComplexData:function(e,t){t.complexData={},this.readChildNodes(e,t.complexData)},Default:function(e,t){t["default"]={},this.readChildNodes(e,t["default"])},Supported:function(e,t){t.supported={},this.readChildNodes(e,t.supported)},Format:function(e,t){var i={};this.readChildNodes(e,i),t.formats||(t.formats={}),t.formats[i.mimeType]=!0},MimeType:function(e,t){t.mimeType=this.getChildValue(e)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,isDeviceTouchCapable:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--i>0&&e);return t},ignore:function(e){var t=3,i=!1;do{if("a"===e.nodeName.toLowerCase()){i=!0;break}e=e.parentNode}while(--t>0&&e);return i},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)&&!this.isDeviceTouchCapable||!~e.type.indexOf("mouse"))){var n=this.getPressedButton(i);if(n){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:n}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var r=OpenLayers.Util.pagePosition(n),o=OpenLayers.Util.getViewportElement(),s=window.pageYOffset||o.scrollTop,a=window.pageXOffset||o.scrollLeft;r[0]=r[0]-a,r[1]=r[1]-s,this.target.triggerEvent("buttonclick",{buttonElement:n,buttonXY:{x:this.startEvt.clientX-r[0],y:this.startEvt.clientY-r[1]}})}this.cancelRegEx.test(e.type)&&e.touches&&this.startEvt.touches&&(Math.abs(e.touches[0].olClientX-this.startEvt.touches[0].olClientX)>4||Math.abs(e.touches[0].olClientY-this.startEvt.touches[0].olClientY))>4&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt}return t}}),OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===s[t]){var i=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),r=n(i);s[t]=e(r)}return s[t]}function i(e,t){if(void 0===a[t]){var i,n,o=0,s=r.length,l="undefined"!=typeof e.cssText;for(a[t]=null;o<s;o++)if(n=r[o],n?(l||(n=n.toLowerCase()),i=n+t.charAt(0).toUpperCase()+t.slice(1)):i=t,void 0!==e[i]){a[t]=i;break}}return a[t]}function n(e){return i(o,e)}var r=["","O","ms","Moz","Webkit"],o=document.createElement("div").style,s={},a={};return{css:t,js:i,style:n,cssCache:s,jsCache:a}}(),OpenLayers.Animation=function(e){function t(e,t,i){t=t>0?t:Number.POSITIVE_INFINITY;var n=++s,r=+new Date;return a[n]=function(){a[n]&&+new Date-r<=t?(e(),a[n]&&o(a[n],i)):delete a[n]},o(a[n],i),n}function i(e){delete a[e]}var n=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),r=!!n,o=function(){var t=e[n]||function(t,i){e.setTimeout(t,16)};return function(i,n){t.apply(e,[i,n])}}(),s=0,a={};return{isNative:r,requestFrame:o,start:t,stop:i}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.minFrameRate=n.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],n=this.finish[t];if(null==i||null==n||isNaN(i)||isNaN(n))throw new TypeError("invalid value for Tween");var r=n-i;e[t]=this.easing.apply(this,[this.time,i,r,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){var i=OpenLayers.Util.isElement(e);1!==arguments.length||"object"!=typeof e||i||(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t);var n=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[n]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var r=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(r,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),r=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(r),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var o=!0,s=document.getElementsByTagName("link"),a=0,l=s.length;a<l;++a)if(OpenLayers.Util.isEquivalentUrl(s.item(a).href,this.theme)){o=!1;break}if(o){var u=document.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("type","text/css"),u.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(u)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var a=0,l=this.controls.length;a<l;a++)this.addControlToMap(this.controls[a]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test,r=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])});return r},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;i<n;i++){var r=this.layers[i];if(r.id==e){t=r;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;t<i;t++)if(this.layers[t]==e)return!1;return this.events.triggerEvent("preaddlayer",{layer:e})!==!1&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;i<n;i++){var r=this.layers[i];if(r.isBaseLayer||this.allOverlays){this.setBaseLayer(r);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(t<0?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var n=0,r=this.layers.length;n<r;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&OpenLayers.Util.indexOf(this.layers,e)!=-1){var t=this.getCachedCenter(),i=this.getResolution(),n=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=t){var r=this.getZoomForResolution(n||this.resolution,!0);this.setCenter(t,r,!1,i!=n)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,r=e.length;n<r;n++){var o=e[n],s=i[n]?i[n]:null;this.addControl(o,s)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;i<n;i++){var r=this.controls[i];if(r.id==e){t=r;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var n=e.draw();n&&(n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(n))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,n=this.layers.length;i<n;i++)this.layers[i].onMapResize();var r=this.getCachedCenter();if(null!=this.baseLayer&&null!=r){var o=this.getZoom();this.zoom=null,this.setCenter(r,o)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var n=this.size.w*t/2,r=this.size.h*t/2;i=new OpenLayers.Bounds(e.lon-n,e.lat-r,e.lon+n,e.lat+r)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)0==e&&0==t||this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),r=n.add(e,t);if(this.dragging||!r.equals(n)){var o=this.getLonLatFromViewPortPx(r);i.animate?this.panTo(o):(this.moveTo(o),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(e.equals(t))return;var i=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),r={x:n.x-i.x,y:n.y-i.y},o={x:0,y:0};this.panTween.start({x:0,y:0},r,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-o.x,i=e.y-o.y;this.moveByPx(t,i),o.x=Math.round(e.x),o.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,r=i+e,o=n+t,s=this.baseLayer.wrapDateLine,a=0,l=0;if(this.restrictedExtent&&(a=i,l=n,s=!1),e=s||r<=this.maxPx.x-a&&r>=this.minPx.x+a?Math.round(e):0,t=o<=this.maxPx.y-l&&o>=this.minPx.y+l?Math.round(t):0,e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerOriginPx.x-=e,this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerOriginPx.y-=t,this.minPx.y-=t,this.maxPx.y-=t),this.applyTransform();var u,c,h;for(c=0,h=this.layers.length;c<h;++c)u=this.layers[c],u.visibility&&(u===this.baseLayer||u.inRange)&&(u.moveByPx(e,t),u.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)if(this.fractionalZoom)e=this.getZoomForResolution(i);else for(var n=0|e,r=t.length;n<r;++n)if(t[n]<=i){e=n;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var n=t;t=this.adjustZoom(t),t!==n&&(e=this.getCenter());var r=i.dragging||this.dragging,o=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var s=this.getResolutionForZoom(t),a=this.calculateBounds(e,s);if(!this.restrictedExtent.containsBounds(a)){var l=this.restrictedExtent.getCenterLonLat();a.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):a.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-a.left,0):a.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-a.right,0)),a.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):a.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-a.bottom):a.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-a.top))}}var u=o||this.isValidZoomLevel(t)&&t!=this.getZoom(),c=this.isValidLonLat(e)&&!e.equals(this.center);if(u||c||r){r||this.events.triggerEvent("movestart",{zoomChanged:u}),c&&(!u&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var h=u?this.getResolutionForZoom(t):this.getResolution();if(u||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var d=this.getMaxExtent({restricted:!0}),p=d.getCenterLonLat(),f=this.center.lon-p.lon,m=p.lat-this.center.lat,g=Math.round(d.getWidth()/h),y=Math.round(d.getHeight()/h);
this.minPx={x:(this.size.w-g)/2-f/h,y:(this.size.h-y)/2-m/h},this.maxPx={x:this.minPx.x+Math.round(d.getWidth()/h),y:this.minPx.y+Math.round(d.getHeight()/h)}}u&&(this.zoom=t,this.resolution=h);var v=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(v,u,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:u})),v=this.baseLayer.getExtent();for(var E=this.layers.length-1;E>=0;--E){var T=this.layers[E];if(T!==this.baseLayer&&!T.isBaseLayer){var b=T.calculateInRange();T.inRange!=b&&(T.inRange=b,b||T.display(!1),this.events.triggerEvent("changelayer",{layer:T,property:"visibility"})),b&&T.visibility&&(T.moveTo(v,u,i.dragging),i.dragging||T.events.triggerEvent("moveend",{zoomChanged:u}))}}if(this.events.triggerEvent("move"),r||this.events.triggerEvent("moveend"),u){for(var E=0,C=this.popups.length;E<C;E++)this.popups[E].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=this.layerContainerOriginPx.x,r=this.layerContainerOriginPx.y,o=Math.round(t.x-i.x),s=Math.round(t.y-i.y);this.applyTransform(this.layerContainerOriginPx.x=o,this.layerContainerOriginPx.y=s);var a=n-o,l=r-s;this.minPx.x-=a,this.maxPx.x-=a,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var i=this.getMaxExtent(),n=this.baseLayer.wrapDateLine&&i;t=i.containsLonLat(e,{worldBounds:n})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e,t){var i=this;if(i.isValidZoomLevel(e)){i.baseLayer.wrapDateLine&&(e=i.adjustZoom(e));var n=t?i.getZoomTargetCenter(t,i.getResolutionForZoom(e)):i.getCenter();if(n&&i.events.triggerEvent("zoomstart",{center:n,zoom:e}),i.zoomTween){i.zoomTween.stop();var r=i.getResolution(),o=i.getResolutionForZoom(e),s={scale:1},a={scale:r/o};if(!t){var l=i.getSize();t={x:l.w/2,y:l.h/2}}i.zoomTween.start(s,a,i.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var n=i.layerContainerOriginPx,r=e.scale,o=(r-1)*(n.x-t.x)|0,s=(r-1)*(n.y-t.y)|0;i.applyTransform(n.x+o,n.y+s,r)},done:function(e){i.applyTransform();var r=i.getResolution()/e.scale,o=i.getZoomForResolution(r,!0),s=1===e.scale?n:i.getZoomTargetCenter(t,r);i.moveTo(s,o)}}})}else i.setCenter(n,e)}},zoomIn:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=n.getWidth();i=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=!e||e.restricted,i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*i/2,r=this.size.h*i/2,o=this.getCachedCenter(),s=new OpenLayers.Bounds(o.lon-n,o.lat-r,o.lon+n,o.lat+r);this.zoomToExtent(s,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getZoomTargetCenter:function(e,t){var i=null,n=this.getSize(),r=n.w/2-e.x,o=e.y-n.h/2,s=this.getLonLatFromPixel(e);return s&&(i=new OpenLayers.LonLat(s.lon+r*t,s.lat+o*t)),i},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),n=t.add(-i/2,0),r=t.add(i/2,0),o=t.add(0,-i/2),s=t.add(0,i/2),a=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||a;return l.equals(a)||(n.transform(l,a),r.transform(l,a),o.transform(l,a),s.transform(l,a)),new OpenLayers.Size(OpenLayers.Util.distVincenty(n,r),OpenLayers.Util.distVincenty(o,s))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=this.layerContainerOriginPx.x,n=this.layerContainerOriginPx.y;t=e.add(i,n)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-this.layerContainerOriginPx.x,n=-this.layerContainerOriginPx.y;t=e.add(i,n),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,i){i=i||1;var n=this.layerContainerOriginPx,r=1!==i;e=e||n.x,t=t||n.y;var o=this.layerContainerDiv.style,s=this.applyTransform.transform,a=this.applyTransform.template;if(void 0===s&&(s=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=s,s)){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));l&&"none"===l||(a=["translate3d(",",0) ","scale3d(",",1)"],o[s]=[a[0],"0,0",a[1]].join("")),a&&~o[s].indexOf(a[0])||(a=["translate(",") ","scale(",")"]),this.applyTransform.template=a}null===s||"translate3d("!==a[0]&&r!==!0?(o.left=e+"px",o.top=t+"px",null!==s&&(o[s]="")):(r===!0&&"translate("===a[0]&&(e-=n.x,t-=n.y,o.left=n.x+"px",o.top=n.y+"px"),o[s]=[a[0],e,"px,",t,"px",a[1],a[2],i,",",i,a[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t;var n=this.map||e.map;n&&this.setMap(n),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.startTouch(),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this["double"]&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy),t&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,n=this.down.touches.length;i<n;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=!0;return this.down&&this.first&&(t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=new Array(i);for(var n,r=0;r<i;r++)n=e.touches[r],t[r]={clientX:n.olClientX,clientY:n.olClientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,i){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var n=this;this._docMove=function(e){n.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})},this._docUp=function(e){n.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&this._pointerId==e.pointerId&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.start=e.xy,this.last=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(delete this._pointerId,this.started=!1,this.start=null,this.last=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this._pointerId!=e.pointerId||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started&&this._pointerId==e.pointerId){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.started=!1,this.dragging=!1,delete this._pointerId,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.startTouch(),"_pointerId"in this||(this._pointerId=e.pointerId),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,i=this.handlers.drag.last.y-e.y;if(0!=t||0!=i){var n=this.rectPxBounds.top,r=this.rectPxBounds.left,o=Math.abs(this.rectPxBounds.getHeight()),s=this.rectPxBounds.getWidth(),a=Math.max(0,n-i);a=Math.min(a,this.ovmap.size.h-this.hComp-o);var l=Math.max(0,r-t);l=Math.min(l,this.ovmap.size.w-this.wComp-s),this.setRectPxBounds(new OpenLayers.Bounds(l,a+o,l+s,a))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),i=e.xy.x-t.x,n=e.xy.y-t.y,r=this.rectPxBounds.top,o=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),a=this.rectPxBounds.getWidth(),l=Math.max(0,r+n);l=Math.min(l,this.ovmap.size.h-s);var u=Math.max(0,o+i);u=Math.min(u,this.ovmap.size.w-a),this.setRectPxBounds(new OpenLayers.Bounds(u,l+s,u+a,l)),this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="",this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap(),!this.autoPan&&this.isSuitableOverview()||this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),i=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(i=i.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var n=this.ovmap.getResolution()/this.map.getResolution();return n>this.minRatio&&n<=this.maxRatio&&this.ovmap.getExtent().containsBounds(i)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),i=t/e;i>this.maxRatio?t=this.minRatio*e:i<=this.minRatio&&(t=this.maxRatio*e);var n;this.ovmap.getProjection()!=this.map.getProjection()?(n=this.map.center.clone(),n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):n=this.map.center,this.ovmap.setCenter(n,this.ovmap.getZoomForResolution(t*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,e),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,(!0)),this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,i=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&i?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[i]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),i=Math.max(e.left,0),n=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),r=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),o=Math.max(r-i,0),s=Math.max(n-t,0);if(o<this.minRectSize||s<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var a=i+o/2-this.minRectSize/2,l=t+s/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px",this.extentRectangle.style.left=Math.round(a)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(t)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(s)+"px",this.extentRectangle.style.width=Math.round(o)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(n),Math.round(r),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),i=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),n=null;return t&&i&&(n=new OpenLayers.Bounds(t.x,t.y,i.x,i.y)),n},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),i=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,i=this.ovmap.getResolution(),n=this.ovmap.getExtent().getCenterLonLat(),r=e.x-t.w/2,o=e.y-t.h/2;return{lon:n.lon+r*i,lat:n.lat-o*i}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),i=this.ovmap.getExtent();if(i)return{x:Math.round(1/t*(e.lon-i.left)),y:Math.round(1/t*(i.top-e.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),n=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var r in e)if(e.hasOwnProperty(r)&&OpenLayers.Util.indexOf(n,r)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(e,t,i){var n=this.visibility;this.isBaseLayer||(n=n&&this.inRange),this.display(n)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()?this.units=this.projection.getUnits():this.units=this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},r=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],r&&this.options[i]&&(r=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=r),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var o;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(o=this.options.maxResolution),this.options.minScale&&(o=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution),
this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),o||(o=n.resolutions[0]),!s)){var a=n.resolutions.length-1;s=n.resolutions[a]}if(this.resolutions=n.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=new Array(t),e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=s,s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units)),this.maxResolution=o,o&&(this.minScale=OpenLayers.Util.getScaleFromResolution(o,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=new Array(n),i=0;i<n;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n,r=e.maxResolution;null!=e.minScale?r=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==r&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,n=this.maxExtent.getHeight()/t.h,r=Math.max(i,n));var o=e.minResolution;if(null!=e.maxScale?o=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,n=this.minExtent.getHeight()/t.h,o=Math.max(i,n)),"number"!=typeof r&&"number"!=typeof o&&null!=this.maxExtent){var s=this.map.getTileSize();r=Math.max(this.maxExtent.getWidth()/s.w,this.maxExtent.getHeight()/s.h)}var a=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof o&&"number"==typeof r&&void 0===l){var u=r/o;l=Math.floor(Math.log(u)/Math.log(2))+1}else void 0===l&&null!=a&&(l=a+1);if(!("number"!=typeof l||l<=0||"number"!=typeof r&&"number"!=typeof o)){var c=new Array(l),h=2;"number"==typeof o&&"number"==typeof r&&(h=Math.pow(r/o,1/(l-1)));var d;if("number"==typeof r)for(d=0;d<l;d++)c[d]=r/Math.pow(h,d);else for(d=0;d<l;d++)c[l-1-d]=o*Math.pow(h,d);return c}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),n=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),n=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[n])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,n,r;if(this.map.fractionalZoom){var o,s=0,a=this.resolutions.length-1,l=this.resolutions[s],u=this.resolutions[a];for(n=0,r=this.resolutions.length;n<r;++n)if(o=this.resolutions[n],o>=e&&(l=o,s=n),o<=e){u=o,a=n;break}var c=l-u;i=c>0?s+(l-e)/c:s}else{var h,d=Number.POSITIVE_INFINITY;for(n=0,r=this.resolutions.length;n<r;n++)if(t){if(h=Math.abs(this.resolutions[n]-e),h>d)break;d=h}else if(this.resolutions[n]<e)break;i=Math.max(0,n-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var n=i.getResolution(),r=i.getMaxExtent({restricted:!0}),o=(e.x-i.minPx.x)*n+r.left,s=(i.minPx.y-e.y)*n+r.top;t=new OpenLayers.LonLat(o,s),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;if(null!=e){t=t||this.map.getResolution();var n=this.map.calculateBounds(null,t);i=new OpenLayers.Pixel(1/t*(e.lon-n.left),1/t*(n.top-e.lat))}return i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,n=t.length;i<n;++i){var r=t[i].firstChild||t[i],o=t[i].lastChild;o&&"iframe"===o.nodeName.toLowerCase()&&(r=o.parentNode),OpenLayers.Util.modifyDOMElement(r,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var e=null;return e=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(e){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(e){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var e=156543.03390625,t=0;t<=this.MAX_ZOOM_LEVEL;++t)this.RESOLUTIONS[t]=e/Math.pow(2,t);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var e=new OpenLayers.Projection("EPSG:4326"),t=new OpenLayers.Projection("EPSG:900913");return function(i,n){var r=OpenLayers.Projection.transform({x:i,y:n},e,t);return new OpenLayers.LonLat(r.x,r.y)}}(),inverseMercator:function(){var e=new OpenLayers.Projection("EPSG:4326"),t=new OpenLayers.Projection("EPSG:900913");return function(i,n){var r=OpenLayers.Projection.transform({x:i,y:n},t,e);return new OpenLayers.LonLat(r.x,r.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage(),this.map.events.register("zoomstart",this,this.onZoomStart)},removeMap:function(e){this.map.events.unregister("zoomstart",this,this.onZoomStart),this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},onZoomStart:function(e){if(null!=this.mapObject){var t=this.getMapObjectLonLatFromOLLonLat(e.center),i=this.getMapObjectZoomFromOLZoom(e.zoom);this.setMapObjectCenter(t,i,!1)}},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize(),t=Math.min(e.w,300),i=Math.min(e.h,200),n=new OpenLayers.Size(t,i),r=new OpenLayers.Pixel(e.w/2,e.h/2),o=r.add(-n.w/2,-n.h/2),s=OpenLayers.Util.createDiv(this.name+"_warning",o,n,null,null,null,"auto");s.style.padding="7px",s.style.backgroundColor="yellow",s.innerHTML=this.getWarningHTML(),this.div.appendChild(s)},getWarningHTML:function(){return""},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(e){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(e,t){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(e,-t):this.moveTo(this.map.getCachedCenter())},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var n=this.map.getCenter(),r=this.map.getZoom();if(null!=n){var o=this.getMapObjectCenter(),s=this.getOLLonLatFromMapObjectLonLat(o),a=this.getMapObjectZoom(),l=this.getOLZoomFromMapObjectZoom(a);if(!n.equals(s)||r!=l)if(!t&&s&&this.dragPanMapObject&&this.smoothDragPan){var u=this.map.getViewPortPxFromLonLat(s),c=this.map.getViewPortPxFromLonLat(n);this.dragPanMapObject(c.x-u.x,u.y-c.y)}else{var h=this.getMapObjectLonLatFromOLLonLat(n),d=this.getMapObjectZoomFromOLZoom(r);this.setMapObjectCenter(h,d,i)}}}},getLonLatFromViewPortPx:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectPixelFromOLPixel(e),n=this.getMapObjectLonLatFromMapObjectPixel(i);t=this.getOLLonLatFromMapObjectLonLat(n)}return t},getViewPortPxFromLonLat:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectLonLatFromOLLonLat(e),n=this.getMapObjectPixelFromMapObjectLonLat(i);t=this.getOLPixelFromMapObjectPixel(n)}return t},getOLLonLatFromMapObjectLonLat:function(e){var t=null;if(null!=e){var i=this.getLongitudeFromMapObjectLonLat(e),n=this.getLatitudeFromMapObjectLonLat(e);t=new OpenLayers.LonLat(i,n)}return t},getMapObjectLonLatFromOLLonLat:function(e){var t=null;return null!=e&&(t=this.getMapObjectLonLatFromLonLat(e.lon,e.lat)),t},getOLPixelFromMapObjectPixel:function(e){var t=null;if(null!=e){var i=this.getXFromMapObjectPixel(e),n=this.getYFromMapObjectPixel(e);t=new OpenLayers.Pixel(i,n)}return t},getMapObjectPixelFromOLPixel:function(e){var t=null;return null!=e&&(t=this.getMapObjectPixelFromXY(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var e=["minZoomLevel","maxZoomLevel","numZoomLevels"],t=0,i=e.length;t<i;t++){var n=e[t];this[n]=null!=this.options[n]?this.options[n]:this.map[n]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var r,o=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(r=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,null!=r?this.numZoomLevels=Math.min(r,o):this.numZoomLevels=o,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var s=0;this.resolutions=[];for(var t=this.minZoomLevel;t<=this.maxZoomLevel;t++)this.resolutions[s++]=this.RESOLUTIONS[t];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var e=null,t=this.map.getSize(),i=this.getExtent();return null!=t&&null!=i&&(e=Math.max(i.getWidth()/t.w,i.getHeight()/t.h)),e},getExtent:function(){var e=this.map.getSize(),t=this.getLonLatFromViewPortPx({x:0,y:0}),i=this.getLonLatFromViewPortPx({x:e.w,y:e.h});return null!=t&&null!=i?new OpenLayers.Bounds(t.lon,i.lat,i.lon,t.lat):null},getZoomForResolution:function(e){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var t=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(t)},getOLZoomFromMapObjectZoom:function(e){var t=null;return null!=e&&(t=e-this.minZoomLevel,this.map.baseLayer!==this&&(t=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(t)))),t},getMapObjectZoomFromOLZoom:function(e){var t=null;return null!=e&&(t=e+this.minZoomLevel,this.map.baseLayer!==this&&(t=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(t)))),t},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,useTiltImages:!1,version:null,initialize:function(e,t){t=t||{},t.version="3";var i=OpenLayers.Layer.Google["v"+t.version.replace(/\./g,"_")];if(!i)throw"Unsupported Google Maps API version: "+t.version;OpenLayers.Util.applyDefaults(t,i),OpenLayers.Util.applyDefaults(t,i.DEFAULTS),t.maxExtent&&(t.maxExtent=t.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,t]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,t]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(e){var t=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(t)},display:function(e){this._dragging||this.setGMapVisibility(e),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,t,i){this._dragging=i,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(e){if(e!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=e),this.getVisibility()){var t=this.getMapContainer();OpenLayers.Util.modifyDOMElement(t,null,null,null,null,null,null,e)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var e=OpenLayers.Layer.Google.cache[this.map.id];e&&e.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var e=OpenLayers.Layer.Google.cache[this.map.id];if(e){var t=this.mapObject&&this.getMapContainer();t&&t.parentNode&&t.parentNode.removeChild(t);var i=e.termsOfUse;i&&i.parentNode&&i.parentNode.removeChild(i);var n=e.poweredBy;n&&n.parentNode&&n.parentNode.removeChild(n),this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(e){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var t=OpenLayers.Layer.Google.cache[e.id];t&&(t.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[e.id]):--t.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(e){var t=null;if(null!=e){var i=e.getSouthWest(),n=e.getNorthEast();this.sphericalMercator?(i=this.forwardMercator(i.lng(),i.lat()),n=this.forwardMercator(n.lng(),n.lat())):(i=new OpenLayers.LonLat(i.lng(),i.lat()),n=new OpenLayers.LonLat(n.lng(),n.lat())),t=new OpenLayers.Bounds(i.lon,i.lat,n.lon,n.lat)}return t},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lon:e.lng()},getLatitudeFromMapObjectLonLat:function(e){var t=this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lat:e.lat();return t},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Format.TMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"tms",readers:{tms:{Services:function(e,t){t.services=[],this.readChildNodes(e,t)},TileMapService:function(e,t){t.services?t.services.push({service:"TMS",version:e.getAttribute("version"),title:e.getAttribute("title"),href:e.getAttribute("href")}):this.readChildNodes(e,t)},TileMaps:function(e,t){t.tileMaps=[],this.readChildNodes(e,t)},TileMap:function(e,t){t.tileMaps?t.tileMaps.push({href:e.getAttribute("href"),srs:e.getAttribute("srs"),title:e.getAttribute("title"),profile:e.getAttribute("profile")}):(t.version=e.getAttribute("version"),t.tileMapService=e.getAttribute("tilemapservice"),this.readChildNodes(e,t))},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},SRS:function(e,t){t.srs=this.getChildValue(e)},BoundingBox:function(e,t){t.bbox=new OpenLayers.Bounds(e.getAttribute("minx"),e.getAttribute("miny"),e.getAttribute("maxx"),e.getAttribute("maxy"))},Origin:function(e,t){t.origin=new OpenLayers.LonLat(e.getAttribute("x"),e.getAttribute("y"))},TileFormat:function(e,t){t.tileFormat={width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10),mimeType:e.getAttribute("mime-type"),extension:e.getAttribute("extension")}},TileSets:function(e,t){t.tileSets=[],this.readChildNodes(e,t)},TileSet:function(e,t){t.tileSets.push({href:e.getAttribute("href"),unitsPerPixel:parseFloat(e.getAttribute("units-per-pixel")),order:parseInt(e.getAttribute("order"),10)})},TileMapServerError:function(e,t){t.error=!0},Message:function(e,t){t.message=this.getChildValue(e)}}},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},CLASS_NAME:"OpenLayers.Format.TMSCapabilities"}),OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),n=this.schemaLocationAttr();return n&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",n),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,viewParams:e&&e.viewParams,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,n=this.featureType.length;i<n;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){e=e||{};var t,i,n=e.options||{},r=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:n.handle}}),o=e.features;if(o){n.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var s,a;for(t=0,i=o.length;t<i;++t)a=o[t],s=this.stateName[a.state],s&&this.writeNode(s,{feature:a,options:n},r);n.multi===!0&&this.setGeometryTypes()}if(n.nativeElements)for(t=0,i=n.nativeElements.length;t<i;++t)this.writeNode("wfs:Native",n.nativeElements[t],r);return r},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,n),n},Update:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS);var r=t.modified;null===this.geometryName||r&&void 0===r.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},n));for(var o in t.attributes)void 0===t.attributes[o]||r&&r.attributes&&!(r.attributes&&o in r.attributes)||this.writeNode("Property",{name:o,value:t.attributes[o]},n);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,n=[];for(var r in t)i=this.namespaces[r],i&&n.push(i+" "+t[r]);var o=n.join(" ")||void 0;return o},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;t<i;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,i){var n=parseInt(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;n&&(t.srsDimension=n)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,n=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=n.split(this.regExes.splitSpace);i=this.xy?new OpenLayers.Geometry.Point(r[0],r[1],r[2]):new OpenLayers.Geometry.Point(r[1],r[0],r[2]),t.points||(t.points=[]),t.points.push(i)},posList:function(e,t){for(var i,n,r,o=this.getChildValue(e).replace(this.regExes.trimSpace,""),s=o.split(this.regExes.splitSpace),a=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=s.length/a,u=new Array(l),c=0,h=s.length;c<h;c+=a)i=s[c],n=s[c+1],r=2==a?void 0:s[c+2],this.xy?u[c/a]=new OpenLayers.Geometry.Point(i,n,r):u[c/a]=new OpenLayers.Geometry.Point(n,i,r);t.points=u},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],r=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,r.x,r.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,n=e.length;i<n;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,n=new Array(i),r=0;r<i;++r)t=e[r],this.xy?n[r]=t.x+" "+t.y:n[r]=t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:n.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;i<n;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;i<n;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],n=0,r=i.length;n<r;++n)this.writeNode("curveMember",i[n],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],n=0,r=i.length;n<r;++n)this.writeNode("surfaceMember",i[n],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),r=e.getAttribute("singleChar"),o=e.getAttribute("escapeChar");i.value2regex(n,r,o),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),
t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,n=e.length;i<n;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,r=e.propertyNames.length;n<r;n++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wfs:{WFS_Capabilities:function(e,t){this.readChildNodes(e,t)},FeatureTypeList:function(e,t){t.featureTypeList={featureTypes:[]},this.readChildNodes(e,t.featureTypeList)},FeatureType:function(e,t){var i={};this.readChildNodes(e,i),t.featureTypes.push(i)},Name:function(e,t){var i=this.getChildValue(e);if(i){var n=i.split(":");t.name=n.pop(),n.length>0&&(t.featureNS=this.lookupNamespaceURI(e,n[0]))}},Title:function(e,t){var i=this.getChildValue(e);i&&(t.title=i)},Abstract:function(e,t){var i=this.getChildValue(e);i&&(t["abstract"]=i)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(e){OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t;if("linestring"==this.geometryType)t=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)t=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)t=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&&"polygon"!=this.geometryType)return null;for(var i=this.decodeDeltas(e,2),n=i.length,r=[],o=0;o+1<n;){var s=i[o++],a=i[o++];r.push(new OpenLayers.Geometry.Point(a,s))}return"point"==this.geometryType?new OpenLayers.Feature.Vector(r[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(r)])):new OpenLayers.Feature.Vector(new t(r))},decode:function(e,t,i){for(var n=i||1e5,r=this.decodeDeltas(e,t,n),o=r.length,s=[],a=0;a+(t-1)<o;){for(var l=[],u=0;u<t;++u)l.push(r[a++]);s.push(l)}return s},write:function(e){var t;t=e.constructor==Array?e[0]:e;var i,n=t.geometry,r=n.CLASS_NAME.split(".")[2].toLowerCase();if("point"==r)i=new Array(n);else if("linestring"==r||"linearring"==r||"multipoint"==r)i=n.components;else{if("polygon"!=r)return null;i=n.components[0].components}for(var o=[],s=i.length,a=0;a<s;++a){var l=i[a];o.push(l.y),o.push(l.x)}return this.encodeDeltas(o,2)},encode:function(e,t,i){for(var n=i||1e5,r=[],o=e.length,s=0;s<o;++s)for(var a=e[s],l=0;l<t;++l)r.push(a[l]);return this.encodeDeltas(r,t,n)},encodeDeltas:function(e,t,i){var n,r=i||1e5,o=new Array(t);for(n=0;n<t;++n)o[n]=0;for(var s=e.length,a=0;a<s;)for(n=0;n<t;++n,++a){var l=e[a],u=l-o[n];o[n]=l,e[a]=u}return this.encodeFloats(e,r)},decodeDeltas:function(e,t,i){var n,r=i||1e5,o=new Array(t);for(n=0;n<t;++n)o[n]=0;for(var s=this.decodeFloats(e,r),a=s.length,l=0;l<a;)for(n=0;n<t;++n,++l)o[n]+=s[l],s[l]=o[n];return s},encodeFloats:function(e,t){for(var i=t||1e5,n=e.length,r=0;r<n;++r)e[r]=Math.round(e[r]*i);return this.encodeSignedIntegers(e)},decodeFloats:function(e,t){for(var i=t||1e5,n=this.decodeSignedIntegers(e),r=n.length,o=0;o<r;++o)n[o]/=i;return n},encodeSignedIntegers:function(e){for(var t=e.length,i=0;i<t;++i){var n=e[i],r=n<<1;n<0&&(r=~r),e[i]=r}return this.encodeUnsignedIntegers(e)},decodeSignedIntegers:function(e){for(var t=this.decodeUnsignedIntegers(e),i=t.length,n=0;n<i;++n){var r=t[n];t[n]=1&r?~(r>>1):r>>1}return t},encodeUnsignedIntegers:function(e){for(var t="",i=e.length,n=0;n<i;++n)t+=this.encodeUnsignedInteger(e[n]);return t},decodeUnsignedIntegers:function(e){for(var t=[],i=0,n=0,r=e.length,o=0;o<r;++o){var s=e.charCodeAt(o)-63;i|=(31&s)<<n,s<32?(t.push(i),i=0,n=0):n+=5}return t},encodeFloat:function(e,t){return e=Math.round(e*(t||1e5)),this.encodeSignedInteger(e)},decodeFloat:function(e,t){var i=this.decodeSignedInteger(e);return i/(t||1e5)},encodeSignedInteger:function(e){var t=e<<1;return e<0&&(t=~t),this.encodeUnsignedInteger(t)},decodeSignedInteger:function(e){var t=this.decodeUnsignedInteger(e);return 1&t?~(t>>1):t>>1},encodeUnsignedInteger:function(e){for(var t,i="";e>=32;)t=(32|31&e)+63,i+=String.fromCharCode(t),e>>=5;return t=e+63,i+=String.fromCharCode(t)},decodeUnsignedInteger:function(e){for(var t=0,i=0,n=e.length,r=0;r<n;++r){var o=e.charCodeAt(r)-63;if(t|=(31&o)<<i,o<32)break;i+=5}return t},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--)e=this.controls[t],e.events&&e.events.un({activate:this.iconOn,deactivate:this.iconOff}),e.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;t<i;t++)e=this.controls[t],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;t<i;t++)e=this.controls[t],this.activeState[e.id]=e.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var e=this.div.childNodes.length,t=e-1;t>=0;t--)this.div.removeChild(this.div.childNodes[t]);if(this.div.innerHTML="",this.active)for(var t=0,i=this.controls.length;t<i;t++)this.div.appendChild(this.controls[t].panel_div)},activateControl:function(e){if(!this.active)return!1;if(e.type==OpenLayers.Control.TYPE_BUTTON)return void e.trigger();if(e.type==OpenLayers.Control.TYPE_TOGGLE)return void(e.active?e.deactivate():e.activate());if(this.allowDepress&&e.active)e.deactivate();else{for(var t,i=0,n=this.controls.length;i<n;i++)t=this.controls[i],t==e||t.type!==OpenLayers.Control.TYPE_TOOL&&null!=t.type||t.deactivate();e.activate()}},addControls:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.controls=this.controls.concat(e);for(var t=0,i=e.length;t<i;t++){var n=e[t],r=this.createControlMarkup(n);OpenLayers.Element.addClass(r,n.displayClass+"ItemInactive"),OpenLayers.Element.addClass(r,"olButton"),""==n.title||r.title||(r.title=n.title),n.panel_div=r}this.map&&(this.addControlsToMap(e),this.redraw())},createControlMarkup:function(e){return document.createElement("div")},addControlsToMap:function(e){for(var t,i=0,n=e.length;i<n;i++)t=e[i],t.autoActivate===!0?(t.autoActivate=!1,this.map.addControl(t),t.autoActivate=!0):(this.map.addControl(t),t.deactivate()),t.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");e.className=e.className.replace(t,"$1Active")},iconOff:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Active\\b");e.className=e.className.replace(t,"$1Inactive")},onButtonClick:function(e){for(var t=this.controls,i=e.buttonElement,n=t.length-1;n>=0;--n)if(t[n].panel_div===i){this.activateControl(t[n]);break}},getControlsBy:function(e,t){var i="function"==typeof t.test,n=OpenLayers.Array.filter(this.controls,function(n){return n[e]==t||i&&t.test(n[e])});return n},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?(this.events.triggerEvent("refresh"),this.mergeNewParams({_olSalt:Math.random()})):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,r=e.length;n<r;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var r=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(r,i));var o=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var s in n)s.toUpperCase()in o&&delete n[s];return r=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,r)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,r,o){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=n,r&&(this.size=r.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,o),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&this.events.triggerEvent("beforedraw")===!1&&(t=null),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,n=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:n})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,n,r,o){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=n,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):e===!1&&this.unload(),e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),this.layerAlphaHack===!0&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=this.layer.gutter/this.layer.tileSize.w*100,i=this.layer.gutter/this.layer.tileSize.h*100),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.stopLoading(),this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading(),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;return e.className="olTileImage",e.galleryImg="no",e}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,i,n){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var i=this.grid[e],n=0,r=i.length;n<r;n++){var o=i[n];this.destroyTile(o)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(e,t){var i=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&i&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.visibility&&this.moveTo(null,!0))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.loading=!1,e.numLoadingTiles=0,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var n=!this.grid.length||t,r=this.getTilesBounds(),o=this.map.getResolution();this.getServerResolution(o);this.singleTile?(n||!i&&!r.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(o),this.initSingleTile(e)):(n=n||!r.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),n?(!t||"resize"!==this.transitionEffect&&this.gridResolution!==o||this.applyBackBuffer(o),this.initGriddedTiles(e)):this.moveGriddedTiles())}},getTileData:function(e){var t=null,i=e.lon,n=e.lat,r=this.grid.length;if(this.map&&r){var o=this.map.getResolution(),s=this.tileSize.w,a=this.tileSize.h,l=this.grid[0][0].bounds,u=l.left,c=l.top;if(i<u&&this.map.baseLayer.wrapDateLine){var h=this.map.getMaxExtent().getWidth(),d=Math.ceil((u-i)/h);i+=h*d}var p=(i-u)/(o*s),f=(c-n)/(o*a),m=Math.floor(p),g=Math.floor(f);if(g>=0&&g<r){var y=this.grid[g][m];y&&(t={tile:y,i:Math.floor((p-m)*s),j:Math.floor((f-g)*a)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,e)===-1){var i,n,r,o;for(i=this.serverResolutions.length-1;i>=0&&(r=this.serverResolutions[i],n=Math.abs(r-e),!(n>t));i--)t=n,o=r;e=o}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}for(var n,r=this.backBufferResolution/e,o=t.childNodes,s=o.length-1;s>=0;--s)n=o[s],n.style.top=(r*n._i*t._th|0)+"px",n.style.left=(r*n._j*t._tw|0)+"px",n.style.width=Math.round(r*n._w)+"px",n.style.height=Math.round(r*n._h)+"px";var a=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,u=this.map.layerContainerOriginPx.y;t.style.left=Math.round(a.x-l)+"px",t.style.top=Math.round(a.y-u)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var i=0,n=this.grid.length;i<n;i++)for(var r=0,o=this.grid[i].length;r<o;r++){var s=this.grid[i][r],a=this.grid[i][r].createBackBuffer();a&&(a._i=i,a._j=r,a._w=this.singleTile?this.getImageSize(s.bounds).w:s.size.w,a._h=s.size.h,a.id=s.id+"_bb",e.appendChild(a))}e._tw=this.tileSize.w,e._th=this.tileSize.h}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio,10),e.w=parseInt(e.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var i=this.grid[t-1][0].bounds,n=this.grid[0].length*i.getWidth(),r=this.grid.length*i.getHeight();e=new OpenLayers.Bounds(i.left,i.bottom,i.left+n,i.bottom+r)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio,r=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2);this.gridResolution=this.getServerResolution();var o=this.maxExtent;o&&(!this.displayOutsideMaxExtent||this.map.baseLayer.wrapDateLine&&this.maxExtent.equals(this.map.getMaxExtent()))&&(r.left=Math.max(r.left,o.left),r.right=Math.min(r.right,o.right));var s=this.map.getLayerPxFromLonLat({lon:r.left,lat:r.top});this.grid.length||(this.grid[0]=[]);var a=this.grid[0][0];a?a.moveTo(r,s):(a=this.addTile(r,s),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,r=i*this.tileSize.h,o=e.left-t.lon,s=Math.floor(o/n)-this.buffer,a=this.rowSign,l=a*(t.lat-e.top+r),u=Math[~a?"floor":"ceil"](l/r)-this.buffer*a;return{tilelon:n,tilelat:r,startcol:s,startrow:u}},getImageSize:function(e){var t=OpenLayers.Layer.HTTPRequest.prototype.getImageSize.apply(this,arguments);return this.singleTile&&(t=new OpenLayers.Size(Math.round(e.getWidth()/this.gridResolution),t.h)),t},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin(),n=this.gridLayout,r=n.tilelon,o=n.tilelat,s=n.startcol,a=n.startrow,l=this.rowSign;return new OpenLayers.Bounds(i.lon+(s+t)*r,i.lat-(a+e*l)*o*l,i.lon+(s+t+1)*r,i.lat-(a+(e-1)*l)*o*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),i=this.getTileOrigin(),n=this.map.getResolution(),r=this.getServerResolution(),o=n/r,s={w:this.tileSize.w/o,h:this.tileSize.h/o},a=Math.ceil(t.h/s.h)+2*this.buffer+1,l=Math.ceil(t.w/s.w)+2*this.buffer+1,u=this.calculateGridLayout(e,i,r);this.gridLayout=u;var c=u.tilelon,h=u.tilelat,d=this.map.layerContainerOriginPx.x,p=this.map.layerContainerOriginPx.y,f=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));m.x=Math.round(m.x)-d,m.y=Math.round(m.y)-p;var g=[],y=this.map.getCenter(),v=0;do{var E=this.grid[v];E||(E=[],this.grid.push(E));var T=0;do{f=this.getTileBoundsForGridIndex(v,T);var b=m.clone();b.x=b.x+T*Math.round(s.w),b.y=b.y+v*Math.round(s.h);var C=E[T];C?C.moveTo(f,b,!1):(C=this.addTile(f,b),this.addTileMonitoringHooks(C),E.push(C));var O=f.getCenterLonLat();g.push({tile:C,distance:Math.pow(O.lon-y.lon,2)+Math.pow(O.lat-y.lat,2)}),T+=1}while(f.right<=e.right+c*this.buffer||T<l);v+=1}while(f.bottom>=e.bottom-h*this.buffer||v<a);this.removeExcessTiles(v,T);var n=this.getServerResolution();this.gridResolution=n,g.sort(function(e,t){return e.distance-t.distance});for(var x=0,w=g.length;x<w;++x)g[x].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:i}),i},addTileMonitoringHooks:function(e){var t="olTileReplacing";e.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),t)},e.onLoadEnd=function(i){this.numLoadingTiles--;var n="unload"===i.type;if(this.events.triggerEvent("tileloaded",{tile:e,aborted:n}),!this.singleTile&&!n&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var r=e.getTile();if("none"===OpenLayers.Element.getStyle(r,"display")){var o=document.getElementById(e.id+"_bb");o&&o.parentNode.removeChild(o)}OpenLayers.Element.removeClass(r,t)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{
this._transitionElement=n?this.div.lastChild:e.imgDiv;for(var s=this.transitionendEvents,a=s.length-1;a>=0;--a)OpenLayers.Event.observe(this._transitionElement,s[a],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],i={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},n=this.getServerResolution()/this.map.getResolution(),r={w:Math.round(this.tileSize.w*n),h:Math.round(this.tileSize.h*n)};if(i.x>-r.w*(e-1))this.shiftColumn(!0,r);else if(i.x<-r.w*e)this.shiftColumn(!1,r);else if(i.y>-r.h*(e-1))this.shiftRow(!0,r);else{if(!(i.y<-r.h*e))break;this.shiftRow(!1,r)}}},shiftRow:function(e,t){var i=this.grid,n=e?0:i.length-1,r=e?-1:1,o=this.rowSign,s=this.gridLayout;s.startrow+=r*o;for(var a=i[n],l=i[e?"pop":"shift"](),u=0,c=l.length;u<c;u++){var h=l[u],d=a[u].position.clone();d.y+=t.h*r,h.moveTo(this.getTileBoundsForGridIndex(n,u),d)}i[e?"unshift":"push"](l)},shiftColumn:function(e,t){var i=this.grid,n=e?0:i[0].length-1,r=e?-1:1,o=this.gridLayout;o.startcol+=r;for(var s=0,a=i.length;s<a;s++){var l=i[s],u=l[n].position.clone(),c=l[e?"pop":"shift"]();u.x+=t.w*r,c.moveTo(this.getTileBoundsForGridIndex(s,n),u),l[e?"unshift":"push"](c)}},removeExcessTiles:function(e,t){for(var i,n;this.grid.length>e;){var r=this.grid.pop();for(i=0,n=r.length;i<n;i++){var o=r[i];this.destroyTile(o)}}for(i=0,n=this.grid.length;i<n;i++)for(;this.grid[i].length>t;){var r=this.grid[i],o=r.pop();this.destroyTile(o)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,r=i*this.tileSize.h,o=this.getLonLatFromViewPortPx(e),s=t.left+n*Math.floor((o.lon-t.left)/n),a=t.bottom+r*Math.floor((o.lat-t.bottom)/r);return new OpenLayers.Bounds(s,a,s+n,a+r)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(e){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,e)if("feature"==e.requesttype){this.request.get_image=null;var t=this.request.get_feature.query;this.addCoordSys(t.featurecoordsys,e.featureCoordSys),this.addCoordSys(t.filtercoordsys,e.filterCoordSys),e.polygon?(t.isspatial=!0,t.spatialfilter.polygon=e.polygon):e.envelope&&(t.isspatial=!0,t.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(t.spatialfilter.envelope,e.envelope))}else if("image"==e.requesttype){this.request.get_feature=null;var i=this.request.get_image.properties;this.parseEnvelope(i.envelope,e.envelope),this.addLayers(i.layerlist,e.layers),this.addImageSize(i.imagesize,e.tileSize),this.addCoordSys(i.featurecoordsys,e.featureCoordSys),this.addCoordSys(i.filtercoordsys,e.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},parseEnvelope:function(e,t){t&&4==t.length&&(e.minx=t[0],e.miny=t[1],e.maxx=t[2],e.maxy=t[3])},addLayers:function(e,t){for(var i=0,n=t.length;i<n;i++)e.push(t[i])},addImageSize:function(e,t){null!==t&&(e.width=t.w,e.height=t.h,e.printwidth=t.w,e.printheight=t.h)},addCoordSys:function(e,t){"string"==typeof t?(e.id=parseInt(t),e.string=t):"object"==typeof t&&null!==t.proj?(e.id=t.proj.srsProjNumber,e.string=t.proj.srsCode):e=t},iserror:function(e){var t=null;if(e){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);var i=e.documentElement.getElementsByTagName("ERROR");t=null!==i&&i.length>0}else t=""!==this.response.error;return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;if(e&&e.documentElement&&(t="ARCXML"==e.documentElement.nodeName?e.documentElement:e.documentElement.getElementsByTagName("ARCXML")[0]),!t||"parsererror"===t.firstChild.nodeName){var i,n;try{i=e.firstChild.nodeValue,n=e.firstChild.childNodes[1].firstChild.nodeValue}catch(r){}throw{message:"Error parsing the ArcXML request",error:i,source:n}}var o=this.parseResponse(t);return o},write:function(e){e||(e=this.request);var t=this.createElementNS("","ARCXML");t.setAttribute("version","1.1");var i=this.createElementNS("","REQUEST");if(null!=e.get_image){var n=this.createElementNS("","GET_IMAGE");i.appendChild(n);var r=this.createElementNS("","PROPERTIES");n.appendChild(r);var o=e.get_image.properties;if(null!=o.featurecoordsys){var s=this.createElementNS("","FEATURECOORDSYS");r.appendChild(s),0===o.featurecoordsys.id?s.setAttribute("string",o.featurecoordsys.string):s.setAttribute("id",o.featurecoordsys.id)}if(null!=o.filtercoordsys){var a=this.createElementNS("","FILTERCOORDSYS");r.appendChild(a),0===o.filtercoordsys.id?a.setAttribute("string",o.filtercoordsys.string):a.setAttribute("id",o.filtercoordsys.id)}if(null!=o.envelope){var l=this.createElementNS("","ENVELOPE");r.appendChild(l),l.setAttribute("minx",o.envelope.minx),l.setAttribute("miny",o.envelope.miny),l.setAttribute("maxx",o.envelope.maxx),l.setAttribute("maxy",o.envelope.maxy)}var u=this.createElementNS("","IMAGESIZE");if(r.appendChild(u),u.setAttribute("height",o.imagesize.height),u.setAttribute("width",o.imagesize.width),o.imagesize.height==o.imagesize.printheight&&o.imagesize.width==o.imagesize.printwidth||(u.setAttribute("printheight",o.imagesize.printheight),u.setArrtibute("printwidth",o.imagesize.printwidth)),null!=o.background){var c=this.createElementNS("","BACKGROUND");r.appendChild(c),c.setAttribute("color",o.background.color.r+","+o.background.color.g+","+o.background.color.b),null!==o.background.transcolor&&c.setAttribute("transcolor",o.background.transcolor.r+","+o.background.transcolor.g+","+o.background.transcolor.b)}if(null!=o.layerlist&&o.layerlist.length>0){var h=this.createElementNS("","LAYERLIST");r.appendChild(h);for(var d=0;d<o.layerlist.length;d++){var p=this.createElementNS("","LAYERDEF");if(h.appendChild(p),p.setAttribute("id",o.layerlist[d].id),p.setAttribute("visible",o.layerlist[d].visible),"object"==typeof o.layerlist[d].query){var f=o.layerlist[d].query;if(f.where.length<0)continue;var m=null;m="boolean"==typeof f.spatialfilter&&f.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),m.setAttribute("where",f.where),"number"==typeof f.accuracy&&f.accuracy>0&&m.setAttribute("accuracy",f.accuracy),"number"==typeof f.featurelimit&&f.featurelimit<2e3&&m.setAttribute("featurelimit",f.featurelimit),"string"==typeof f.subfields&&"#ALL#"!=f.subfields&&m.setAttribute("subfields",f.subfields),"string"==typeof f.joinexpression&&f.joinexpression.length>0&&m.setAttribute("joinexpression",f.joinexpression),"string"==typeof f.jointables&&f.jointables.length>0&&m.setAttribute("jointables",f.jointables),p.appendChild(m)}"object"==typeof o.layerlist[d].renderer&&this.addRenderer(p,o.layerlist[d].renderer)}}}else if(null!=e.get_feature){var n=this.createElementNS("","GET_FEATURES");if(n.setAttribute("outputmode","newxml"),n.setAttribute("checkesc","true"),e.get_feature.geometry?n.setAttribute("geometry",e.get_feature.geometry):n.setAttribute("geometry","false"),e.get_feature.compact&&n.setAttribute("compact",e.get_feature.compact),"number"==e.get_feature.featurelimit&&n.setAttribute("featurelimit",e.get_feature.featurelimit),n.setAttribute("globalenvelope","true"),i.appendChild(n),null!=e.get_feature.layer&&e.get_feature.layer.length>0){var g=this.createElementNS("","LAYER");g.setAttribute("id",e.get_feature.layer),n.appendChild(g)}var y=e.get_feature.query;if(null!=y){var v=null;if(v=y.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),n.appendChild(v),"number"==typeof y.accuracy&&v.setAttribute("accuracy",y.accuracy),null!=y.featurecoordsys){var E=this.createElementNS("","FEATURECOORDSYS");0==y.featurecoordsys.id?E.setAttribute("string",y.featurecoordsys.string):E.setAttribute("id",y.featurecoordsys.id),v.appendChild(E)}if(null!=y.filtercoordsys){var T=this.createElementNS("","FILTERCOORDSYS");0===y.filtercoordsys.id?T.setAttribute("string",y.filtercoordsys.string):T.setAttribute("id",y.filtercoordsys.id),v.appendChild(T)}if(y.buffer>0){var b=this.createElementNS("","BUFFER");b.setAttribute("distance",y.buffer),v.appendChild(b)}if(y.isspatial){var C=this.createElementNS("","SPATIALFILTER");if(C.setAttribute("relation",y.spatialfilter.relation),v.appendChild(C),y.spatialfilter.envelope){var O=this.createElementNS("","ENVELOPE");O.setAttribute("minx",y.spatialfilter.envelope.minx),O.setAttribute("miny",y.spatialfilter.envelope.miny),O.setAttribute("maxx",y.spatialfilter.envelope.maxx),O.setAttribute("maxy",y.spatialfilter.envelope.maxy),C.appendChild(O)}else"object"==typeof y.spatialfilter.polygon&&C.appendChild(this.writePolygonGeometry(y.spatialfilter.polygon))}null!=y.where&&y.where.length>0&&v.setAttribute("where",y.where)}}return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},addGroupRenderer:function(e,t){var i=this.createElementNS("","GROUPRENDERER");e.appendChild(i);for(var n=0;n<t.length;n++){var r=t[n];this.addRenderer(i,r)}},addRenderer:function(e,t){if(OpenLayers.Util.isArray(t))this.addGroupRenderer(e,t);else{var i=this.createElementNS("",t.type.toUpperCase()+"RENDERER");e.appendChild(i),"VALUEMAPRENDERER"==i.tagName?this.addValueMapRenderer(i,t):"VALUEMAPLABELRENDERER"==i.tagName?this.addValueMapLabelRenderer(i,t):"SIMPLELABELRENDERER"==i.tagName?this.addSimpleLabelRenderer(i,t):"SCALEDEPENDENTRENDERER"==i.tagName&&this.addScaleDependentRenderer(i,t)}},addScaleDependentRenderer:function(e,t){"string"!=typeof t.lower&&"number"!=typeof t.lower||e.setAttribute("lower",t.lower),"string"!=typeof t.upper&&"number"!=typeof t.upper||e.setAttribute("upper",t.upper),this.addRenderer(e,t.renderer)},addValueMapLabelRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),e.setAttribute("labelfield",t.labelfield),"object"==typeof t.exacts)for(var i=0,n=t.exacts.length;i<n;i++){var r=t.exacts[i],o=this.createElementNS("","EXACT");if("string"==typeof r.value&&o.setAttribute("value",r.value),"string"==typeof r.label&&o.setAttribute("label",r.label),"string"==typeof r.method&&o.setAttribute("method",r.method),e.appendChild(o),"object"==typeof r.symbol){var s=null;if("text"==r.symbol.type&&(s=this.createElementNS("","TEXTSYMBOL")),null!=s){for(var a=this.fontStyleKeys,l=0,u=a.length;l<u;l++){var c=a[l];r.symbol[c]&&s.setAttribute(c,r.symbol[c])}o.appendChild(s)}}}},addValueMapRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),"object"==typeof t.ranges)for(var i=0,n=t.ranges.length;i<n;i++){var r=t.ranges[i],o=this.createElementNS("","RANGE");if(o.setAttribute("lower",r.lower),o.setAttribute("upper",r.upper),e.appendChild(o),"object"==typeof r.symbol){var s=null;"simplepolygon"==r.symbol.type&&(s=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=s&&("string"==typeof r.symbol.boundarycolor&&s.setAttribute("boundarycolor",r.symbol.boundarycolor),"string"==typeof r.symbol.fillcolor&&s.setAttribute("fillcolor",r.symbol.fillcolor),"number"==typeof r.symbol.filltransparency&&s.setAttribute("filltransparency",r.symbol.filltransparency),o.appendChild(s))}}else if("object"==typeof t.exacts)for(var a=0,l=t.exacts.length;a<l;a++){var u=t.exacts[a],c=this.createElementNS("","EXACT");if("string"==typeof u.value&&c.setAttribute("value",u.value),"string"==typeof u.label&&c.setAttribute("label",u.label),"string"==typeof u.method&&c.setAttribute("method",u.method),e.appendChild(c),"object"==typeof u.symbol){var s=null;"simplemarker"==u.symbol.type&&(s=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=s&&("string"==typeof u.symbol.antialiasing&&s.setAttribute("antialiasing",u.symbol.antialiasing),"string"==typeof u.symbol.color&&s.setAttribute("color",u.symbol.color),"string"==typeof u.symbol.outline&&s.setAttribute("outline",u.symbol.outline),"string"==typeof u.symbol.overlap&&s.setAttribute("overlap",u.symbol.overlap),"string"==typeof u.symbol.shadow&&s.setAttribute("shadow",u.symbol.shadow),"number"==typeof u.symbol.transparency&&s.setAttribute("transparency",u.symbol.transparency),"string"==typeof u.symbol.usecentroid&&s.setAttribute("usecentroid",u.symbol.usecentroid),"number"==typeof u.symbol.width&&s.setAttribute("width",u.symbol.width),c.appendChild(s))}}},addSimpleLabelRenderer:function(e,t){e.setAttribute("field",t.field);for(var i=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],n=0,r=i.length;n<r;n++){var o=i[n];t[o]&&e.setAttribute(o,t[o])}if("text"==t.symbol.type){var s=t.symbol,a=this.createElementNS("","TEXTSYMBOL");e.appendChild(a);for(var i=this.fontStyleKeys,n=0,r=i.length;n<r;n++){var o=i[n];s[o]&&a.setAttribute(o,t[o])}}},writePolygonGeometry:function(e){if(!(e instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+e.CLASS_NAME+" object.",geometry:e};for(var t=this.createElementNS("","POLYGON"),i=0,n=e.components.length;i<n;i++){for(var r=e.components[i],o=this.createElementNS("","RING"),s=0,a=r.components.length;s<a;s++){var l=r.components[s],u=this.createElementNS("","POINT");u.setAttribute("x",l.x),u.setAttribute("y",l.y),o.appendChild(u)}t.appendChild(o)}return t},parseResponse:function(e){if("string"==typeof e){var t=new OpenLayers.Format.XML;e=t.read(e)}var i=new OpenLayers.Format.ArcXML.Response,n=e.getElementsByTagName("ERROR");if(null!=n&&n.length>0)i.error=this.getChildValue(n,"Unknown error.");else{var r=e.getElementsByTagName("RESPONSE");if(null==r||0==r.length)return i.error="No RESPONSE tag found in ArcXML response.",i;var o=r[0].firstChild.nodeName;if("#text"==o&&(o=r[0].firstChild.nextSibling.nodeName),"IMAGE"==o){var s=e.getElementsByTagName("ENVELOPE"),a=e.getElementsByTagName("OUTPUT");if(null==s||0==s.length)i.error="No ENVELOPE tag found in ArcXML response.";else if(null==a||0==a.length)i.error="No OUTPUT tag found in ArcXML response.";else{var l=this.parseAttributes(s[0]),u=this.parseAttributes(a[0]);"string"==typeof u.type?i.image={envelope:l,output:{type:u.type,data:this.getChildValue(a[0])}}:i.image={envelope:l,output:u}}}else if("FEATURES"==o){var c=r[0].getElementsByTagName("FEATURES"),h=c[0].getElementsByTagName("FEATURECOUNT");if(i.features.featurecount=h[0].getAttribute("count"),i.features.featurecount>0){var d=c[0].getElementsByTagName("ENVELOPE");i.features.envelope=this.parseAttributes(d[0],"number");for(var p=c[0].getElementsByTagName("FEATURE"),f=0;f<p.length;f++){for(var m=new OpenLayers.Feature.Vector,g=p[f].getElementsByTagName("FIELD"),y=0;y<g.length;y++){var v=g[y].getAttribute("name"),E=g[y].getAttribute("value");m.attributes[v]=E}var T=p[f].getElementsByTagName("POLYGON");if(T.length>0){for(var b=T[0].getElementsByTagName("RING"),C=[],O=0;O<b.length;O++){var x=[];x.push(this.parsePointGeometry(b[O]));for(var w=b[O].getElementsByTagName("HOLE"),R=0;R<w.length;R++)x.push(this.parsePointGeometry(w[R]));w=null,C.push(new OpenLayers.Geometry.Polygon(x)),x=null}b=null,1==C.length?m.geometry=C[0]:m.geometry=new OpenLayers.Geometry.MultiPolygon(C)}i.features.feature.push(m)}}}else i.error="Unidentified response type."}return i},parseAttributes:function(e,t){for(var i={},n=0;n<e.attributes.length;n++)"number"==t?i[e.attributes[n].nodeName]=parseFloat(e.attributes[n].nodeValue):i[e.attributes[n].nodeName]=e.attributes[n].nodeValue;return i},parsePointGeometry:function(e){var t=[],i=e.getElementsByTagName("COORDS");if(i.length>0){var n=this.getChildValue(i[0]);n=n.split(/;/);for(var r=0;r<n.length;r++){var o=n[r].split(/ /);t.push(new OpenLayers.Geometry.Point(o[0],o[1]))}i=null}else{var s=e.getElementsByTagName("POINT");if(s.length>0)for(var a=0;a<s.length;a++)t.push(new OpenLayers.Geometry.Point(parseFloat(s[a].getAttribute("x")),parseFloat(s[a].getAttribute("y"))));s=null}return new OpenLayers.Geometry.LinearRing(t)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(e){var t={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,t)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(e){var t={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,t)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(e,t,i){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:i.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(i,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,this.params,i]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])},getURL:function(e){var t="";e=this.adjustBounds(e);var i=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize})),n=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:i.write(),async:!1});if(null!=n){var r=n.responseXML;r&&r.documentElement||(r=n.responseText);var o=new OpenLayers.Format.ArcXML,s=o.read(r);t=this.getUrlOrImage(s.image.output)}return t},getURLasync:function(e,t,i){e=this.adjustBounds(e);var n=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:n.write(),callback:function(e){var n=e.responseXML;n&&n.documentElement||(n=e.responseText);var r=new OpenLayers.Format.ArcXML,o=r.read(n);t.call(i,this.getUrlOrImage(o.image.output))},scope:this})},getUrlOrImage:function(e){var t="";return e.url?t=e.url:e.data&&(t="data:image/"+e.type+";base64,"+e.data),t},setLayerQuery:function(e,t){for(var i=0;i<this.options.layers.length;i++)if(e==this.options.layers[i].id)return void(this.options.layers[i].query=t);this.options.layers.push({id:e,visible:!0,query:t})},getFeatureInfo:function(e,t,i){var n=i.buffer||1,r=i.callback||function(){},o=i.scope||window,s={};OpenLayers.Util.extend(s,this.options),s.requesttype="feature",e instanceof OpenLayers.LonLat?(s.polygon=null,s.envelope=[e.lon-n,e.lat-n,e.lon+n,e.lat+n]):e instanceof OpenLayers.Geometry.Polygon&&(s.envelope=null,s.polygon=e);var a=new OpenLayers.Format.ArcXML(s);if(OpenLayers.Util.extend(a.request.get_feature,i),a.request.get_feature.layer=t.id,"number"==typeof t.query.accuracy)a.request.get_feature.query.accuracy=t.query.accuracy;else{var l=this.map.getCenter(),u=this.map.getViewPortPxFromLonLat(l);u.x++;var c=this.map.getLonLatFromPixel(u);a.request.get_feature.query.accuracy=c.lon-l.lon}a.request.get_feature.query.where=t.query.where,a.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:a.write(),callback:function(e){var t=a.parseResponse(e.responseText);a.iserror()?r.call(o,null):r.call(o,t.features)}})},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(e){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&!this.outsideViewport&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var t;this.outsideViewport?(this.events.attachToElement(this.div),t=this):t=this.map,t.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position,this.buttons=[];var t={w:18,h:18},i=new OpenLayers.Pixel(e.x+t.w/2,e.y);return this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this._addButton("panright","east-mini.png",e.add(t.w,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),this._addButton("zoomworld","zoom-world-mini.png",i.add(0,4*t.h+5),t),this._addButton("zoomout","zoom-minus-mini.png",i.add(0,5*t.h+5),t),this.div},_addButton:function(e,t,i,n){var r=OpenLayers.Util.getImageLocation(t),o=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,i,n,r,"absolute");return o.style.cursor="pointer",this.div.appendChild(o),o.action=e,o.className="olButton",this.buttons.push(o),o},_removeButton:function(e){this.div.removeChild(e),OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.outsideViewport&&this.events.attachToElement(this.div),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position.clone(),this.buttons=[];var t={w:18,h:18};if(this.panIcons){var i=new OpenLayers.Pixel(e.x+t.w/2,e.y),n=t.w;this.zoomWorldIcon&&(i=new OpenLayers.Pixel(e.x+t.w,e.y)),this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t),n*=2),this._addButton("panright","east-mini.png",e.add(n,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),i=this._addZoomBar(i.add(0,4*t.h+5)),this._addButton("zoomout","zoom-minus-mini.png",i,t)}else this._addButton("zoomin","zoom-plus-mini.png",e,t),i=this._addZoomBar(e.add(0,t.h)),this._addButton("zoomout","zoom-minus-mini.png",i,t),this.zoomWorldIcon&&(i=i.add(0,t.h+3),this._addButton("zoomworld","zoom-world-mini.png",i,t));return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),i=this.id+"_"+this.map.id,n=this.map.getMinZoom(),r=this.map.getNumZoomLevels()-1-this.map.getZoom(),o=OpenLayers.Util.createAlphaImageDiv(i,e.add(-1,r*this.zoomStopHeight),{w:20,h:9},t,"absolute");o.style.cursor="move",this.slider=o,this.sliderEvents=new OpenLayers.Events(this,o,null,(!0),{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var s={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-n)},t=OpenLayers.Util.getImageLocation("zoombar.png"),a=null;if(OpenLayers.Util.alphaHack()){var i=this.id+"_"+this.map.id;a=OpenLayers.Util.createAlphaImageDiv(i,e,{w:s.w,h:this.zoomStopHeight},t,"absolute",null,"crop"),a.style.height=s.h+"px"}else a=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,s,t);return a.style.cursor="pointer",a.className="olButton",this.zoombarDiv=a,this.div.appendChild(a),this.startTop=parseInt(a.style.top),this.div.appendChild(o),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-n))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(t=Math.floor(t));var i=this.map.getNumZoomLevels()-1-t;i=Math.min(Math.max(i,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(i)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){var t=this.outsideViewport?this:this.map;t.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=e.xy.clone(),this.zoomStart=e.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,i=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-i[1]>0&&e.clientY-i[1]<parseInt(this.zoombarDiv.style.height)-2){var n=parseInt(this.slider.style.top)-t;this.slider.style.top=n+"px",this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y,OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="";var t=this.outsideViewport?this:this.map;t.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var i=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(i+=this.deltaY/this.zoomStopHeight,i=Math.min(Math.max(i,0),this.map.getNumZoomLevels()-1)):(i+=this.deltaY/this.zoomStopHeight,i=Math.max(Math.round(i),0)),this.map.zoomTo(i),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(e,t,i,n,r){this.url=t,this.extent=i,this.maxExtent=i,this.size=n,OpenLayers.Layer.prototype.initialize.apply(this,[e,r]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setMap:function(e){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=null==this.tile;if(t||n){this.setTileSize();var r=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});n?(this.tile=new OpenLayers.Tile.Image(this,r,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=r.clone()),this.tile.draw()}},setTileSize:function(){var e=this.extent.getWidth()/this.map.getResolution(),t=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(e,t)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.events.triggerEvent("loadstart")},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},setUrl:function(e){this.url=e,this.tile.draw()},getURL:function(e){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return!this.active&&(this.active=!0,!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"
}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(e){OpenLayers.Strategy.prototype.initialize.apply(this,[e]),this.events=new OpenLayers.Events(this)},activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},triggerSave:function(e){var t=e.feature;t.state!==OpenLayers.State.INSERT&&t.state!==OpenLayers.State.UPDATE&&t.state!==OpenLayers.State.DELETE||this.save([e.feature])},save:function(e){e||(e=this.layer.features),this.events.triggerEvent("start",{features:e});var t=this.layer.projection,i=this.layer.map.getProjectionObject();if(!i.equals(t)){for(var n,r,o=e.length,s=new Array(o),a=0;a<o;++a)n=e[a],r=n.clone(),r.fid=n.fid,r.state=n.state,n.url&&(r.url=n.url),r._original=n,r.geometry.transform(i,t),s[a]=r;e=s}this.layer.protocol.commit(e,{callback:this.onCommit,scope:this})},onCommit:function(e){var t={response:e};if(e.success()){for(var i,n,r=e.reqFeatures,o=[],s=e.insertIds||[],a=0,l=0,u=r.length;l<u;++l)n=r[l],n=n._original||n,i=n.state,i&&(i==OpenLayers.State.DELETE?o.push(n):i==OpenLayers.State.INSERT&&(n.fid=s[a],++a),n.state=null);o.length>0&&this.layer.destroyFeatures(o),this.events.triggerEvent("success",t)}else this.events.triggerEvent("fail",t)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],lastClientX:0,lastClientY:0,initialize:function(e){if(this.target=e,e.object instanceof OpenLayers.Map)this.setMap(e.object);else{if(!(e.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";e.object.map?this.setMap(e.object.map):e.object.events.register("added",this,function(t){this.setMap(e.object.map)})}for(var t=this.provides.length-1;t>=0;--t)e.extensions[this.provides[t]]=!0},setMap:function(e){this.map=e,this.cache={},e.events.register("mousedown",this,this.start,{extension:!0}),e.events.register("mouseup",this,this.onClick,{extension:!0}),e.events.register("touchstart",this,this.start,{extension:!0}),e.events.register("touchmove",this,this.cancel,{extension:!0}),e.events.register("touchend",this,this.onClick,{extension:!0}),e.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(e){this.startEvt=e},cancel:function(e){delete this.startEvt},onClick:function(e){if(this.startEvt&&("touchend"===e.type||OpenLayers.Event.isLeftClick(e))){var t=this.getFeatures(this.startEvt);delete this.startEvt;for(var i,n,r,o={},s=0,a=t.length;s<a&&(i=t[s],n=i.layer,o[n.id]=!0,r=this.triggerEvent("featureclick",{feature:i}),r!==!1);++s);for(s=0,a=this.map.layers.length;s<a;++s)n=this.map.layers[s],n instanceof OpenLayers.Layer.Vector&&!o[n.id]&&this.triggerEvent("nofeatureclick",{layer:n})}},onMousemove:function(e){delete this.startEvt;var t=e.clientX,i=e.clientY;if(this.lastClientX!=t||this.lastClientY!=i){this.lastClientX=t,this.lastClientY=i;for(var n,r=this.getFeatures(e),o={},s=[],a=0,l=r.length;a<l;++a)n=r[a],o[n.id]=n,this.cache[n.id]||s.push(n);var u=[];for(var c in this.cache)n=this.cache[c],n.layer&&n.layer.map?o[n.id]||u.push(n):delete this.cache[c];var h;for(a=0,l=s.length;a<l&&(n=s[a],this.cache[n.id]=n,h=this.triggerEvent("featureover",{feature:n}),h!==!1);++a);for(a=0,l=u.length;a<l&&(n=u[a],delete this.cache[n.id],h=this.triggerEvent("featureout",{feature:n}),h!==!1);++a);}},triggerEvent:function(e,t){var i=t.feature?t.feature.layer:t.layer,n=this.target.object;if(n instanceof OpenLayers.Map||n===i)return this.target.triggerEvent(e,t)},getFeatures:function(e){var t,i,n,r,o,s,a,l=e.clientX,u=e.clientY,c=[],h=[],d=[];for(o=this.map.layers.length-1;o>=0;--o)if(t=this.map.layers[o],i=t.renderer,"none"!==t.div.style.display)if(i instanceof OpenLayers.Renderer.Elements){if(t instanceof OpenLayers.Layer.Vector)for(n=document.elementFromPoint(l,u);n&&(a=i.getFeatureIdFromEvent({target:n}));)r=t.getFeatureById(a),r?(c.push(r),n.style.display="none",h.push(n),n=document.elementFromPoint(l,u)):n=!1;d.push(t),t.div.style.display="none"}else i instanceof OpenLayers.Renderer.Canvas&&(r=i.getFeatureIdFromEvent(e),r&&(c.push(r),d.push(t)));for(o=0,s=h.length;o<s;++o)h[o].style.display="";for(o=d.length-1;o>=0;--o)d[o].div.style.display="block";return c},destroy:function(){for(var e=this.provides.length-1;e>=0;--e)delete this.target.extensions[this.provides[e]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(e){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=[];if(this.extractTracks)for(var i=e.getElementsByTagName("trk"),n=0,r=i.length;n<r;n++){var o={};this.extractAttributes&&(o=this.parseAttributes(i[n]));for(var s=this.getElementsByTagNameNS(i[n],i[n].namespaceURI,"trkseg"),a=0,l=s.length;a<l;a++){var u=this.extractSegment(s[a],"trkpt");t.push(new OpenLayers.Feature.Vector(u,o))}}if(this.extractRoutes)for(var c=e.getElementsByTagName("rte"),h=0,d=c.length;h<d;h++){var o={};this.extractAttributes&&(o=this.parseAttributes(c[h]));var p=this.extractSegment(c[h],"rtept");t.push(new OpenLayers.Feature.Vector(p,o))}if(this.extractWaypoints)for(var f=e.getElementsByTagName("wpt"),m=0,r=f.length;m<r;m++){var o={};this.extractAttributes&&(o=this.parseAttributes(f[m]));var g=new OpenLayers.Geometry.Point(f[m].getAttribute("lon"),f[m].getAttribute("lat"));t.push(new OpenLayers.Feature.Vector(g,o))}if(this.internalProjection&&this.externalProjection)for(var y=0,v=t.length;y<v;y++)t[y].geometry.transform(this.externalProjection,this.internalProjection);return t},extractSegment:function(e,t){for(var i=this.getElementsByTagNameNS(e,e.namespaceURI,t),n=[],r=0,o=i.length;r<o;r++)n.push(new OpenLayers.Geometry.Point(i[r].getAttribute("lon"),i[r].getAttribute("lat")));return new OpenLayers.Geometry.LineString(n)},parseAttributes:function(e){for(var t,i,n={},r=e.firstChild;r;)1==r.nodeType&&r.firstChild&&(t=r.firstChild,3!=t.nodeType&&4!=t.nodeType||(i=r.prefix?r.nodeName.split(":")[1]:r.nodeName,"trkseg"!=i&&"rtept"!=i&&(n[i]=t.nodeValue))),r=r.nextSibling;return n},write:function(e,t){e=OpenLayers.Util.isArray(e)?e:[e];var i=this.createElementNS(this.namespaces.gpx,"gpx");i.setAttribute("version","1.1"),i.setAttribute("creator",this.creator),this.setAttributes(i,{"xsi:schemaLocation":this.schemaLocation}),t&&"object"==typeof t&&i.appendChild(this.buildMetadataNode(t));for(var n=0,r=e.length;n<r;n++)i.appendChild(this.buildFeatureNode(e[n]));return OpenLayers.Format.XML.prototype.write.apply(this,[i])},buildMetadataNode:function(e){for(var t=["name","desc","author"],i=this.createElementNS(this.namespaces.gpx,"metadata"),n=0;n<t.length;n++){var r=t[n];if(e[r]){var o=this.createElementNS(this.namespaces.gpx,r);o.appendChild(this.createTextNode(e[r])),i.appendChild(o)}}return i},buildFeatureNode:function(e){var t=e.geometry;if(t=t.clone(),this.internalProjection&&this.externalProjection&&t.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==t.CLASS_NAME){var i=this.buildWptNode(t);return this.appendAttributesNode(i,e),i}var n=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(n,e);var r=this.buildTrkSegNode(t);r=OpenLayers.Util.isArray(r)?r:[r];for(var o=0,s=r.length;o<s;o++)n.appendChild(r[o]);return n},buildTrkSegNode:function(e){var t,i,n,r,o;if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=this.createElementNS(this.namespaces.gpx,"trkseg"),i=0,n=e.components.length;i<n;i++)r=e.components[i],t.appendChild(this.buildTrkPtNode(r));return t}for(o=[],i=0,n=e.components.length;i<n;i++)o.push(this.buildTrkSegNode(e.components[i]));return o},buildTrkPtNode:function(e){var t=this.createElementNS(this.namespaces.gpx,"trkpt");return t.setAttribute("lon",e.x),t.setAttribute("lat",e.y),t},buildWptNode:function(e){var t=this.createElementNS(this.namespaces.gpx,"wpt");return t.setAttribute("lon",e.x),t.setAttribute("lat",e.y),t},appendAttributesNode:function(e,t){var i=this.createElementNS(this.namespaces.gpx,"name");i.appendChild(this.createTextNode(t.attributes.name||t.id)),e.appendChild(i);var n=this.createElementNS(this.namespaces.gpx,"desc");n.appendChild(this.createTextNode(t.attributes.description||t.attributes.desc||this.defaultDesc)),e.appendChild(n)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i,n,r=[],o={},s={complexTypes:r,customTypes:o};this.readChildNodes(e,s);var a,l,u=e.attributes;for(i=0,n=u.length;i<n;++i)a=u[i],l=a.name,0===l.indexOf("xmlns")?this.setNamespace(l.split(":")[1]||"",a.value):t[l]=a.value;t.featureTypes=r,t.targetPrefix=this.namespaceAlias[t.targetNamespace];var c,h;for(i=0,n=r.length;i<n;++i)c=r[i],h=o[c.typeName],o[c.typeName]&&(c.typeName=h.name)},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i),t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i),t.properties=i.elements},element:function(e,t){var i;if(t.elements){for(var n,r={},o=e.attributes,s=0,a=o.length;s<a;++s)n=o[s],r[n.name]=n.value;i=r.type,i||(i={},this.readChildNodes(e,i),r.restriction=i,r.type=i.base);var l=i.base||i;r.localType=l.split(":").pop(),t.elements.push(r),this.readChildNodes(e,r)}if(t.complexTypes){i=e.getAttribute("type");var u=i.split(":").pop();t.customTypes[u]={name:e.getAttribute("name"),type:i}}},annotation:function(e,t){t.annotation={},this.readChildNodes(e,t.annotation)},appinfo:function(e,t){t.appinfo||(t.appinfo=[]),t.appinfo.push(this.getChildValue(e))},documentation:function(e,t){t.documentation||(t.documentation=[]);var i=this.getChildValue(e);t.documentation.push({lang:e.getAttribute("xml:lang"),textContent:i.replace(this.regExes.trimSpace,"")})},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base"),this.readRestriction(e,t)}}},readRestriction:function(e,t){for(var i,n,r,o=e.childNodes,s=0,a=o.length;s<a;++s)i=o[s],1==i.nodeType&&(n=i.nodeName.split(":").pop(),r=i.getAttribute("value"),t[n]?("string"==typeof t[n]&&(t[n]=[t[n]]),t[n].push(r)):t[n]=r)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};if("ExceptionReport"===e.nodeName.split(":").pop()){var i=new OpenLayers.Format.OGCExceptionReport;t.error=i.read(e)}else this.readNode(e,t);return t},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(i,n):t={display:"none"};var r=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&r!==!1){var o=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var s=isNaN(t.labelXOffset)?0:t.labelXOffset,a=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();o.move(s*l,a*l)}this.drawText(e.id,t,o)}else this.removeText(e.id);return r}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth(),n=(this.extent.left+this.extent.right)/2,r=(e.left+e.right)/2,o=Math.round((r-n)/i);this.featureDx=o*i}},drawGeometry:function(e,t,i){},drawText:function(e,t,i){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this._clearRectId=OpenLayers.Util.createUniqueID(),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var n,r=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());var o=r&&r.intersectsBounds(this.extent,{worldBounds:n});i="none"!==t.display&&!!r&&o,i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=n&&"OpenLayers.Geometry.MultiPoint"!=n&&"OpenLayers.Geometry.MultiLineString"!=n&&"OpenLayers.Geometry.MultiPolygon"!=n)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}else for(var r=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),o=0;o<e.components.length;o++)this.calculateFeatureDx(e.components[o].getBounds(),r),this.drawGeometry(e.components[o],t,i)},drawExternalGraphic:function(e,t,i){var n=new Image,r=t.title||t.graphicTitle;r&&(n.title=r);var o=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth;o=o?o:2*t.pointRadius,s=s?s:2*t.pointRadius;var a=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*o),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s),u=this._clearRectId,c=t.graphicOpacity||t.fillOpacity,h=function(){if(this.features[i]&&u===this._clearRectId){var t=this.getLocalXY(e),r=t[0],h=t[1];if(!isNaN(r)&&!isNaN(h)){var d=r+a|0,p=h+l|0,f=this.canvas;f.globalAlpha=c;var m=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);f.drawImage(n,d*m,p*m,o*m,s*m),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(d,p,o,s))}}};n.onload=OpenLayers.Function.bind(h,this),n.src=t.externalGraphic,n.complete&&(n.onload(),n.onload=null)},drawNamedSymbol:function(e,t,i){var n,r,o,s,a,l,u,c,h,d=Math.PI/180,p=OpenLayers.Renderer.symbol[t.graphicName];if(!p)throw new Error(t.graphicName+" is not a valid symbol name");if(p.length&&!(p.length<2)){var f=this.getLocalXY(e),m=f[0],g=f[1];if(!isNaN(m)&&!isNaN(g)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{for(l=new OpenLayers.Bounds,a=0;a<p.length;a+=2)l.extend(new OpenLayers.LonLat(p[a],p[a+1]));this.cachedSymbolBounds[t.graphicName]=l}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(m,g),this.hitDetection&&this.hitContext.translate(m,g),c=d*t.rotation,isNaN(c)||(this.canvas.rotate(c),this.hitDetection&&this.hitContext.rotate(c)),u=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight()),this.canvas.scale(u,u),this.hitDetection&&this.hitContext.scale(u,u),o=l.getCenterLonLat().lon,s=l.getCenterLonLat().lat,this.canvas.translate(-o,-s),this.hitDetection&&this.hitContext.translate(-o,-s),h=t.strokeWidth,t.strokeWidth=h/u,t.fill!==!1){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),a=0;a<p.length;a+=2)n=p[a],r=p[a+1],0==a&&this.canvas.moveTo(n,r),this.canvas.lineTo(n,r);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),a=0;a<p.length;a+=2)n=p[a],r=p[a+1],0==a&&this.canvas.moveTo(n,r),this.hitContext.lineTo(n,r);this.hitContext.closePath(),this.hitContext.fill()}}if(t.stroke!==!1){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),a=0;a<p.length;a+=2)n=p[a],r=p[a+1],0==a&&this.canvas.moveTo(n,r),this.canvas.lineTo(n,r);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,u),this.hitContext.beginPath(),a=0;a<p.length;a+=2)n=p[a],r=p[a+1],0==a&&this.hitContext.moveTo(n,r),this.hitContext.lineTo(n,r);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=h,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),n=i.length;return i="#"+i.substring(n-6,n)},setHitContextStyle:function(e,t,i,n){var r=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=r):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=r,"undefined"==typeof n?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=i.strokeWidth+2/n)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var n=this.getLocalXY(e),r=n[0],o=n[1];if(!isNaN(r)&&!isNaN(o)){var s=2*Math.PI,a=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(r,o,a,0,s,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(r,o,a,0,s,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(r,o,a,0,s,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(r,o,a,0,s,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,n,r){var o=t.components,s=o.length;e.beginPath();var a=this.getLocalXY(o[0]),l=a[0],u=a[1];if(!isNaN(l)&&!isNaN(u)){e.moveTo(a[0],a[1]);for(var c=1;c<s;++c){var h=this.getLocalXY(o[c]);e.lineTo(h[0],h[1])}"fill"===r?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var n=e.components,r=n.length;this.drawLinearRing(n[0],t,i);for(var o=1;o<r;++o)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(n[o],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(n[o],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),r=t.label.split("\n"),o=r.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var a=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=a*s*(o-1);for(var l=0;l<o;l++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1,this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(r[l],i[0],i[1]+a*l+1),this.canvas.restore()),this.canvas.fillText(r[l],i[0],i[1]+a*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var u=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==u&&(u=-.5);var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var a=this.canvas.mozMeasureText("xx");i[1]+=a*(1+s*o);for(var l=0;l<o;l++){var c=i[0]+u*this.canvas.mozMeasureText(r[l]),h=i[1]+l*a;this.canvas.translate(c,h),this.canvas.mozDrawText(r[l]),this.canvas.translate(-c,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,n=(e.x-this.featureDx)/t+-i.left/t,r=i.top/t-e.y/t;return[n,r]},clear:function(){this.clearCanvas(),this.features={}},clearCanvas:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this._clearRectId=OpenLayers.Util.createUniqueID(),this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,i;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var n=e.xy,r=0|n.x,o=0|n.y,s=this.hitContext.getImageData(r,o,1,1).data;if(255===s[3]){var a=s[2]+256*(s[1]+256*s[0]);if(a){t="OpenLayers_Feature_Vector_"+(a-1+this.hitOverflow);try{i=this.features[t][0]}catch(l){}}}}return i},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){this.clearCanvas();var e,t,i,n=[],r=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features)this.features.hasOwnProperty(o)&&(e=this.features[o][0],t=e.geometry,this.calculateFeatureDx(t.getBounds(),r),i=this.features[o][1],this.drawGeometry(t,i,e.id),i.label&&n.push([e,i]));for(var s,a=0,l=n.length;a<l;++a)s=n[a],this.drawText(s[0].geometry.getCentroid(),s[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.WCSDescribeCoverage=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage"}),OpenLayers.Format.WCSDescribeCoverage.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};if("ExceptionReport"===e.nodeName.split(":").pop()){var i=new OpenLayers.Format.OGCExceptionReport;t.error=i.read(e)}else this.readNode(e,t);return t},CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage.v1"}),OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"}),OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"}),OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"serviceIdentification",readers:{wcs:{WCS_Capabilities:function(e,t){this.readChildNodes(e,t)},Service:function(e,t){var i={};this.readChildNodes(e,i);var n=i.serviceContact.providerName;delete i.serviceContact.providerName,t.serviceProvider={providerName:n,serviceContact:i.serviceContact},i.serviceContact=void 0,t.serviceIdentification=i},keywords:function(e,t){t.keywords=[],this.readChildNodes(e,t.keywords)},keyword:function(e,t){t.push(this.getChildValue(e))},responsibleParty:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},individualName:function(e,t){t.individualName=this.getChildValue(e)},organisationName:function(e,t){t.providerName=this.getChildValue(e)},positionName:function(e,t){t.positionName=this.getChildValue(e)},contactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},voice:function(e,t){t.voice=this.getChildValue(e)},facsimile:function(e,t){t.facsimile=this.getChildValue(e)},address:function(e,t){t.address={},this.readChildNodes(e,t.address)},deliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},city:function(e,t){t.city=this.getChildValue(e)},postalCode:function(e,t){t.postalCode=this.getChildValue(e)},country:function(e,t){t.country=this.getChildValue(e)},electronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},fees:function(e,t){t.fees=this.getChildValue(e)},accessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ContentMetadata:function(e,t){t.contentMetadata=[],this.readChildNodes(e,t.contentMetadata)},CoverageOfferingBrief:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},name:function(e,t){"Service"===e.parentNode.nodeName.split(":").pop()?t.title=this.getChildValue(e):t.identifier=this.getChildValue(e)},label:function(e,t){"Service"===e.parentNode.nodeName.split(":").pop()?t["abstract"]=this.getChildValue(e):t.title=this.getChildValue(e)},lonLatEnvelope:function(e,t){var i=this.getElementsByTagNameNS(e,"http://www.opengis.net/gml","pos");if(2==i.length){var n={},r={};this.xy=!0,this.readers.gml.pos.apply(this,[i[0],n]),this.readers.gml.pos.apply(this,[i[1],r]),t.lonLatEnvelope={},t.lonLatEnvelope.srsName=e.getAttribute("srsName"),t.lonLatEnvelope.min=n.points[0],t.lonLatEnvelope.max=r.points[0]}}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"}),OpenLayers.Format.WCSDescribeCoverage.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSDescribeCoverage.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml"},readers:{wcs:{CoverageDescription:function(e,t){t.coverageDescriptions={},this.readChildNodes(e,t.coverageDescriptions),t.coverageDescriptionKeys=[];for(var i in t.coverageDescriptions)t.coverageDescriptionKeys.push(i)},CoverageOffering:function(e,t){var i={};this.readChildNodes(e,i),t[i.identifier]=i,i.nativeCRS=i.supportedCRSs.nativeCRSs[0]},name:function(e,t){t.identifier=this.getChildValue(e)},label:function(e,t){t.title=this.getChildValue(e)},lonLatEnvelope:function(e,t){OpenLayers.Format.WCSCapabilities.v1_0_0.prototype.readers.wcs.lonLatEnvelope.call(this,e,t)},domainSet:function(e,t){t.domain={},this.readChildNodes(e,t.domain)},spatialDomain:function(e,t){t.spatialDomain={boundingBoxes:{}},this.readChildNodes(e,t.spatialDomain)},nativeCRSs:function(e,t){t.nativeCRSs||(t.nativeCRSs=[]);var i=this.getChildValue(e);t.nativeCRSs.push(i)},supportedCRSs:function(e,t){t.supportedCRSs||(t.supportedCRSs=[]),this.readChildNodes(e,t.supportedCRSs)},requestResponseCRSs:function(e,t){t.push(this.getChildValue(e))},supportedFormats:function(e,t){t.supportedFormats||(t.supportedFormats=[]),this.readChildNodes(e,t.supportedFormats)},formats:function(e,t){t.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Util.applyDefaults({
Envelope:function(e,t){var i=e.getAttribute("srsName");if(i){var n={points:[]};this.readChildNodes(e,n);var r=n.points[0],o=n.points[1],s=new OpenLayers.Bounds(r.x,r.y,o.x,o.y);t.boundingBoxes[i]=s}}},OpenLayers.Format.GML.v3.prototype.readers.gml)},CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage.v1_0_0"}),OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,shareNode:!1,interestingTagsExclude:null,areaTags:null,relationsParsers:{},initialize:function(e){var t={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};e=e?e:{},t=OpenLayers.Util.extend(t,e);for(var i={},n=0;n<t.interestingTagsExclude.length;n++)i[t.interestingTagsExclude[n]]=!0;t.interestingTagsExclude=i;for(var r={},n=0;n<t.areaTags.length;n++)r[t.areaTags[n]]=!0;t.areaTags=r,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[t])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=this.getNodes(e),i=this.getWays(e),n=this.getRelations(e),r=[];for(var o in n){var s=n[o];if(this.relationsParsers[s.tags.type])for(var a=this.relationsParsers[s.tags.type](s,this,t,i,n),l=0,u=a.length;l<u;l++)r.push(a[l])}for(var c in i){var h=i[c];if(h.interesting){var d=this.isWayArea(h)?1:0,p=this.getPointList(h,t),f=null;f=d?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(p)):new OpenLayers.Geometry.LineString(p);var m=new OpenLayers.Feature.Vector(f,h.tags);m.osm_id=parseInt(h.id),m.osm_version=parseInt(h.version),m.geometry.osm_id=m.osm_id,m.type="way",m.fid="way."+m.osm_id,r.push(m)}}for(var g in t){var y=t[g];(!y.used||!this.checkTags||Object.keys(y.attributes).length>1)&&r.push(y)}return r},getPointList:function(e,t){if(!e)return[];for(var i=new Array(e.nodes.length),n=0;n<e.nodes.length;n++){var r=t[e.nodes[n]];r.used=!0;var o=r.geometry;this.shareNode||(o=new OpenLayers.Geometry.Point(r.geometry.x,r.geometry.y),o.osm_id=r.osm_id),i[n]=o}return i},concatPathsIfLinear:function(e,t){var i={};return 0==e.length?(i.succed=!0,i.lastPointList=t,i):0==t.length?(i.succed=!0,i.lastPointList=e,i):e[e.length-1].x==t[0].x&&e[e.length-1].y==t[0].y?(t=t.slice(1,t.length),e=e.concat(t),i.succed=!0,i.lastPointList=e,i):e[0].x==t[t.length-1].x&&e[0].y==t[t.length-1].y?(e=e.slice(1,e.length),e=t.concat(e),i.succed=!0,i.lastPointList=e,i):e[0].x==t[0].x&&e[0].y==t[0].y?(e.length>t.length?(t=t.slice(1,t.length),e=t.reverse().concat(e)):(e=e.slice(1,e.length),e=e.reverse().concat(t)),i.succed=!0,i.lastPointList=e,i):e[e.length-1].x==t[t.length-1].x&&e[e.length-1].y==t[t.length-1].y?(e.length>t.length?(t=t.slice(0,t.length-1),e=e.concat(t.reverse())):(e=e.slice(0,e.length-1),e=t.concat(e.reverse())),i.succed=!0,i.lastPointList=e,i):(i.succed=!1,i)},getNodes:function(e){for(var t=e.getElementsByTagName("node"),i={},n=0;n<t.length;n++){var r=t[n],o=r.getAttribute("id"),s=new OpenLayers.Geometry.Point(r.getAttribute("lon"),r.getAttribute("lat"));this.internalProjection&&this.externalProjection&&s.transform(this.externalProjection,this.internalProjection);var a=new OpenLayers.Feature.Vector(s,this.getTags(r));a.osm_id=parseInt(o),a.osm_version=parseInt(r.getAttribute("version")),a.type="node",a.fid="node."+a.osm_id,a.geometry.osm_id=a.osm_id,i[o]=a}return i},getRelations:function(e){for(var t=e.getElementsByTagName("relation"),i={},n=0;n<t.length;n++){var r=t[n],o=r.getAttribute("id"),s={id:o,version:r.getAttribute("version")};s.tags=this.getTags(r),s.nodes=[],s.ways=[],s.relations=[];for(var a=r.getElementsByTagName("member"),l=0;l<a.length;l++){var u=a[l],c=u.getAttribute("type");"node"==c?s.nodes[s.nodes.length]=u:"way"==c?s.ways[s.ways.length]=u:"relation"==c&&(s.relations[s.relations.length]=u)}i[o]=s}return i},getWays:function(e){for(var t=e.getElementsByTagName("way"),i={},n=0;n<t.length;n++){var r=t[n],o=r.getAttribute("id"),s={id:o,version:r.getAttribute("version")};if(this.checkTags){var a=this.getTags(r,!0);s.interesting=a[1],s.tags=a[0]}else s.interesting=!0,s.tags=this.getTags(r);var l=r.getElementsByTagName("nd");s.nodes=new Array(l.length);for(var u=0;u<l.length;u++)s.nodes[u]=l[u].getAttribute("ref");i[o]=s}return i},getTags:function(e,t){for(var i=e.getElementsByTagName("tag"),n={},r=!1,o=0;o<i.length;o++){var s=i[o].getAttribute("k");this.checkTags&&this.interestingTagsExclude[s]||(n[s]=i[o].getAttribute("v")),t&&!this.interestingTagsExclude[s]&&(r=!0)}return t?[n,r]:n},isWayArea:function(e){var t=!1,i=!1;if(e.nodes[0]==e.nodes[e.nodes.length-1]&&(t=!0),this.checkTags)for(var n in e.tags)if(this.areaTags[n]){i=!0;break}return t&&(!this.checkTags||i)},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.osm_id=1,this.created_nodes={};var t=this.createElementNS(null,"osm");t.setAttribute("version","0.5"),t.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var i=e.length-1;i>=0;i--)for(var n=this.createFeatureNodes(e[i]),r=0;r<n.length;r++)t.appendChild(n[r]);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureNodes:function(e){var t=[],i=e.geometry.CLASS_NAME,n=i.substring(i.lastIndexOf(".")+1);n=n.toLowerCase();var r=this.createXML[n];return r&&(t=r.apply(this,[e])),t},createXML:{point:function(e){var t=null,i=e.geometry?e.geometry:e;this.internalProjection&&this.externalProjection&&(i=i.clone(),i.transform(this.internalProjection,this.externalProjection));var n=!1;if(e.osm_id?(t=e.osm_id,this.created_nodes[t]&&(n=!0)):(t=-this.osm_id,this.osm_id++),n)r=this.created_nodes[t];else var r=this.createElementNS(null,"node");return this.created_nodes[t]=r,r.setAttribute("id",t),r.setAttribute("lon",i.x),r.setAttribute("lat",i.y),e.attributes&&this.serializeTags(e,r),this.setState(e,r),n?[]:[r]},linestring:function(e){var t,i=[],n=e.geometry;e.osm_id?t=e.osm_id:(t=-this.osm_id,this.osm_id++);var r=this.createElementNS(null,"way");r.setAttribute("id",t);for(var o=0;o<n.components.length;o++){var s=this.createXML.point.apply(this,[n.components[o]]);if(s.length){s=s[0];var a=s.getAttribute("id");i.push(s)}else a=n.components[o].osm_id,s=this.created_nodes[a];this.setState(e,s);var l=this.createElementNS(null,"nd");l.setAttribute("ref",a),r.appendChild(l)}return this.serializeTags(e,r),i.push(r),i},polygon:function(e){var t=OpenLayers.Util.extend({area:"yes"},e.attributes),i=new OpenLayers.Feature.Vector(e.geometry.components[0],t);return i.osm_id=e.osm_id,i.geometry.osm_id=i.osm_id,this.createXML.linestring.apply(this,[i])}},serializeTags:function(e,t){for(var i in e.attributes){var n=this.createElementNS(null,"tag");n.setAttribute("k",i),n.setAttribute("v",e.attributes[i]),t.appendChild(n)}},setState:function(e,t){if(e.state){var i=null;switch(e.state){case OpenLayers.State.UPDATE:i="modify";case OpenLayers.State.DELETE:i="delete"}i&&t.setAttribute("action",i)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Format.OSM.multipolygonParser=function(e,t,i,n,r){for(var o="",s=[],a=[],l=[],u=0;u<e.ways.length;u++){var c=e.ways[u],h=c.getAttribute("ref"),d=c.getAttribute("role"),p=t.getPointList(n[h],i);if(0!=p.length){var f=!0;if(""==o&&(o=d),o==d){var m=t.concatPathsIfLinear(s,p);m.succed&&(f=!1,s=m.lastPointList)}if(f){if(s.length>0)if("inner"==o||"enclave"==o){var g=new OpenLayers.Geometry.LinearRing(s);a.push(g)}else{var g=new OpenLayers.Geometry.LinearRing(s);l.push(g)}s=p,o=d}}}if(s.length>0)if("inner"==o||"enclave"==o){var g=new OpenLayers.Geometry.LinearRing(s);a.push(g)}else{var g=new OpenLayers.Geometry.LinearRing(s);l.push(g)}for(var y=[],u=0;u<l.length;u++)if(0==a.length)y.push(new OpenLayers.Geometry.Polygon([l[u]]));else{for(var v=[],E=0;E<a.length;E++){var T=a[E];l[u].containsPoint(T.getCentroid())&&v.push(T)}y.push(new OpenLayers.Geometry.Polygon([l[u]].concat(v)))}var g=new OpenLayers.Geometry.MultiPolygon(y),b=new OpenLayers.Feature.Vector(g,e.tags);return b.osm_id=parseInt(e.id),b.type="relation",b.fid="relation."+b.osm_id,[b]},OpenLayers.Format.OSM.getLineStrings=function(e,t,i,n){for(var r=[],o=0;o<e.ways.length;o++){var s=e.ways[o],a=s.getAttribute("ref"),l=t.getPointList(n[a],i);0!=l.length&&r.push(new OpenLayers.Geometry.LineString(l))}return r},OpenLayers.Format.OSM.routeParser=function(e,t,i,n,r){var o=OpenLayers.Format.OSM.getLineStrings(e,t,i,n),s=new OpenLayers.Geometry.MultiLineString(o),a=new OpenLayers.Feature.Vector(s,e.tags);return a.osm_id=parseInt(e.id),a.type="relation",a.fid="relation."+a.osm_id,[a]},OpenLayers.Format.OSM.genericParser=function(e,t,i,n,r){for(var o=OpenLayers.Format.OSM.getLineStrings(e,t,i,n),s=0;s<e.nodes.length;s++){var a=e.nodes[s];o.push(new OpenLayers.Geometry.Node(a))}var l=new OpenLayers.Geometry.Collection(o),u=new OpenLayers.Feature.Vector(l,e.tags);return u.osm_id=parseInt(e.id),u.type="relation",u.fid="relation."+u.osm_id,[u]},OpenLayers.Format.OSM.routeParserWithRoles=function(e,t,i,n,r){for(var o="",s=[],a=[],l=0;l<e.ways.length;l++){var u=e.ways[l],c=u.getAttribute("ref"),h=u.getAttribute("role"),d=t.getPointList(n[c],i);if(0!=d.length){var p=!0;if(""==o&&(o=h),o==h){var f=t.concatPathsIfLinear(s,d);f.succed&&(p=!1,s=f.lastPointList)}if(p){var m=new OpenLayers.Geometry.LineString(s),g=new OpenLayers.Feature.Vector(m,e.tags);h&&(g.attributes.role=h),g.osm_id=parseInt(e.id),g.type="relation",g.fid="relation."+g.osm_id+"."+l,a.push(g),s=d,o=h}}}var m=new OpenLayers.Geometry.LineString(s),g=new OpenLayers.Feature.Vector(m,e.tags);return h&&(g.attributes.role=h),g.osm_id=parseInt(e.id),g.type="relation",g.fid="relation."+g.osm_id,a.push(g),a},OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;t<i;t++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[t],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{bySegment:!1,documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var i={down:function(e){this.vertex=null;var t=this.layer.getFeatureFromEvent(this.handlers.drag.evt);t?this.dragStart(t):this.clickout&&(this._unselect=this.feature)},move:function(e){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,e)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(e){this.vertex&&this.dragComplete(this.vertex)}},n=this,r={documentDrag:this.documentDrag,setEvent:function(e){var t=n.feature;n._lastVertex=t?t.layer.getFeatureFromEvent(e):null,OpenLayers.Handler.Drag.prototype.setEvent.apply(this,arguments)},stopDown:!1},o={keydown:this.handleKeypress};if(this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,o),drag:new OpenLayers.Handler.Drag(this,i,r)},this.bySegment){if(!window.rbush)throw new Error("The rbush library is required");if(!OpenLayers.Control.ModifyFeature.BySegment)throw new Error("OpenLayers.Control.ModifyFeature.BySegment is missing from the build");OpenLayers.Util.extend(this,OpenLayers.Control.ModifyFeature.BySegment)}},createVirtualVertex:function(e,t){var i=(e.x+t.x)/2,n=(e.y+t.y)/2,r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i,n),null,this.virtualStyle);return r._sketch=!0,r},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this._lastVertex=null,this.handlers.keyboard.activate()&&this.handlers.drag.activate())},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var t=this.feature;t&&t.geometry&&t.layer&&this.unselectFeature(t),e=!0}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){var t=OpenLayers.Util.indexOf;if(!(this.feature===e||this.geometryTypes&&t(this.geometryTypes,e.geometry.CLASS_NAME)==-1)){this.beforeSelectFeature(e)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=e,t(this.layer.selectedFeatures,e)==-1&&this.layer.selectedFeatures.push(e),this.layer.drawFeature(e,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var i=e.modified;!e.geometry||i&&i.geometry||(this._originalGeometry=e.geometry.clone())}},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,e),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e){var t="OpenLayers.Geometry.Point"==e.geometry.CLASS_NAME;this.standalone||(e._sketch||!t)&&e._sketch||(this.toggle&&this.feature===e&&(this._unselect=e),this.selectFeature(e)),this.feature&&(e._sketch||t&&e===this.feature)&&(this.vertex=e,this.handlers.drag.stopDown=!0)},dragVertex:function(e,t){var i=this.map.getLonLatFromViewPortPx(t),n=e.geometry;n.move(i.lon-n.x,i.lat-n.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}):(e._index?(e._index==-1&&(e._index=OpenLayers.Util.indexOf(e.geometry.parent.components,e._next)),e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(e)},dragComplete:function(e){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,t)!=-1){var i=this._lastVertex;i&&OpenLayers.Util.indexOf(this.vertices,i)!=-1&&!this.handlers.drag.dragging&&i.geometry.parent&&(i.geometry.parent.removeComponent(i.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function e(i){var n,r,o,s;if("OpenLayers.Geometry.Point"==i.CLASS_NAME)r=new OpenLayers.Feature.Vector(i),r._sketch=!0,r.renderIntent=t.vertexRenderIntent,t.vertices.push(r);else{var a=i.components.length;for("OpenLayers.Geometry.LinearRing"==i.CLASS_NAME&&(a-=1),n=0;n<a;++n)o=i.components[n],"OpenLayers.Geometry.Point"==o.CLASS_NAME?(r=new OpenLayers.Feature.Vector(o),r._sketch=!0,r.renderIntent=t.vertexRenderIntent,t.vertices.push(r)):e(o);if(t.createVertices&&"OpenLayers.Geometry.MultiPoint"!=i.CLASS_NAME)for(n=0,s=i.components.length;n<s-1;++n){var l=i.components[n],u=i.components[n+1];if("OpenLayers.Geometry.Point"==l.CLASS_NAME&&"OpenLayers.Geometry.Point"==u.CLASS_NAME){var c=t.createVirtualVertex.call(t,l,u);c.geometry.parent=i,c._index=n+1,t.virtualVertices.push(c)}}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),n=new OpenLayers.Feature.Vector(i);i.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},n._sketch=!0,this.dragHandle=n,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),r=new OpenLayers.Geometry.Point(t.right,t.bottom),o=new OpenLayers.Feature.Vector(r),s=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,a=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,l=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;r.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var r=this.x-n.x,o=this.y-n.y,u=r-t,c=o-i;if(l){var h=Math.atan2(c,u),d=Math.atan2(o,r),p=d-h;p*=180/Math.PI,e.rotate(p,n)}if(s){var f,m;if(a)f=o/c,m=r/u/f;else{var g=Math.sqrt(u*u+c*c),y=Math.sqrt(r*r+o*o);f=y/g}e.resize(f,n,m)}},o._sketch=!0,this.radiusHandle=o,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.handlers.drag.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:this.serverResolutions?this.serverResolutions.length:19},i)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var n=""+t.x+t.y+t.z;i=this.selectUrl(n,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),r=this.getServerZoom();if(this.wrapDateLine){var o=Math.pow(2,r);i=(i%o+o)%o}return{x:i,y:n,z:r}},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169,.03732276771218,.01866138385609],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e);var t=e.name||"Bing "+(e.type||this.type),i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),t=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e),i=document.createElement("script");i.type="text/javascript",i.src=t,i.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(i)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],t=e.imageUrl.replace("{quadkey}","${quadkey}");t=t.replace("{culture}",this.culture),t=t.replace(this.protocolRegex,this.protocol),this.url=[];for(var i=0;i<e.imageUrlSubdomains.length;++i)this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(e){if(this.url){for(var t=this.getXYZ(e),i=t.x,n=t.y,r=t.z,o=[],s=r;s>0;--s){var a="0",l=1<<s-1;0!=(i&l)&&a++,0!=(n&l)&&(a++,a++),o.push(a)}var u=o.join(""),c=this.selectUrl(""+i+n+r,this.url);return OpenLayers.String.format(c,{quadkey:u})}},updateAttribution:function(){var e=this.metadata;if(e.resourceSets&&this.map&&this.map.center){var t,i,n,r,o,s,a,l=e.resourceSets[0].resources[0],u=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),c=l.imageryProviders||[],h=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),d="";for(i=0,n=c.length;i<n;++i)for(t=c[i],r=0,o=t.coverageAreas.length;r<o;++r)a=t.coverageAreas[r],s=OpenLayers.Bounds.fromArray(a.bbox,!0),u.intersectsBounds(s)&&h<=a.zoomMax&&h>=a.zoomMin&&(d+=t.attribution+" ");var p=e.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:p,copyrights:d}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Bing(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e,this.initLayer();var t=document.getElementById(this._callbackId);t.parentNode.removeChild(t),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={features:[]};this.readNode(e,t);for(var i=[],n=0,r=t.features.length;n<r;n++){var o=t.features[n];this.internalProjection&&this.externalProjection&&o.components[0]&&o.components[0].transform(this.externalProjection,this.internalProjection);var s=new OpenLayers.Feature.Vector(o.components[0],o.attributes);i.push(s)}return i},readers:{sa:{SamplingPoint:function(e,t){if(!t.attributes){var i={attributes:{}};t.features.push(i),t=i}t.attributes.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},position:function(e,t){this.readChildNodes(e,t)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){this.readChildNodes(e,t)},featureMember:function(e,t){var i={attributes:{}};t.features.push(i),this.readChildNodes(e,i)},name:function(e,t){t.attributes.name=this.getChildValue(e)},pos:function(e,t){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(e.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[e,t])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(e){for(var t=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),i=0,n=e.fois.length;i<n;i++)this.writeNode("FeatureOfInterestId",{foi:e.fois[i]},t);return t},FeatureOfInterestId:function(e){var t=this.createElementNSPlus("FeatureOfInterestId",{value:e.foi});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",xmlns:"http://www.w3.org/2000/xmlns/"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={measurements:[],observations:[]};return this.readNode(e,t),t},write:function(e){var t=this.writeNode("sos:GetObservation",e);return this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:om",this.namespaces.om),this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},readers:{om:{ObservationCollection:function(e,t){t.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},member:function(e,t){this.readChildNodes(e,t)},Measurement:function(e,t){var i={};t.measurements.push(i),this.readChildNodes(e,i)},Observation:function(e,t){var i={};t.observations.push(i),this.readChildNodes(e,i)},samplingTime:function(e,t){var i={};t.samplingTime=i,this.readChildNodes(e,i)},observedProperty:function(e,t){t.observedProperty=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},procedure:function(e,t){t.procedure=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},featureOfInterest:function(e,t){var i={features:[]};t.fois=[],t.fois.push(i),this.readChildNodes(e,i);for(var n=[],r=0,o=i.features.length;r<o;r++){var s=i.features[r];n.push(new OpenLayers.Feature.Vector(s.components[0],s.attributes))}i.features=n},result:function(e,t){var i={};t.result=i,""!==this.getChildValue(e)?(i.value=this.getChildValue(e),i.uom=e.getAttribute("uom")):this.readChildNodes(e,i)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(e,t){var i={};t.timeInstant=i,this.readChildNodes(e,i)},timePosition:function(e,t){t.timePosition=this.getChildValue(e)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(e){var t=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",e,t),e.eventTime&&this.writeNode("eventTime",e,t);for(var i in e.procedures)this.writeNode("procedure",e.procedures[i],t);
for(var n in e.observedProperties)this.writeNode("observedProperty",e.observedProperties[n],t);return e.foi&&this.writeNode("featureOfInterest",e.foi,t),this.writeNode("responseFormat",e,t),e.resultModel&&this.writeNode("resultModel",e,t),e.responseMode&&this.writeNode("responseMode",e,t),t},featureOfInterest:function(e){var t=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",e.objectId,t),t},ObjectID:function(e){return this.createElementNSPlus("ObjectID",{value:e})},responseFormat:function(e){return this.createElementNSPlus("responseFormat",{value:e.responseFormat})},procedure:function(e){return this.createElementNSPlus("procedure",{value:e})},offering:function(e){return this.createElementNSPlus("offering",{value:e.offering})},observedProperty:function(e){return this.createElementNSPlus("observedProperty",{value:e})},eventTime:function(e){var t=this.createElementNSPlus("eventTime");return"latest"===e.eventTime&&this.writeNode("ogc:TM_Equals",e,t),t},resultModel:function(e){return this.createElementNSPlus("resultModel",{value:e.resultModel})},responseMode:function(e){return this.createElementNSPlus("responseMode",{value:e.responseMode})}},ogc:{TM_Equals:function(e){var t=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},t),"latest"===e.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})}},gml:{TimeInstant:function(e){var t=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",e,t),t},timePosition:function(e){var t=this.createElementNSPlus("gml:timePosition",{value:e.value});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,i=!1,n=!1,r=OpenLayers.Event.element(e);null!=r&&!n&&!t;){if(!t)try{var o;if(r.currentStyle)o=r.currentStyle.overflow;else{var s=document.defaultView.getComputedStyle(r,null);o=s.getPropertyValue("overflow")}t=o&&"auto"==o||"scroll"==o}catch(a){}if(!i&&(i=OpenLayers.Element.hasClass(r,"olScrollable"),!i))for(var l=0,u=this.map.layers.length;l<u;l++){var c=this.map.layers[l];if(r==c.div||r==c.pane){i=!0;break}}n=r==this.map.div,r=r.parentNode}if(!t&&n){if(i){var h=0;if(e.wheelDelta?(h=e.wheelDelta,h%160===0&&(h=.75*h),h/=120):e.detail&&(h=-(e.detail/Math.abs(e.detail))),this.delta+=h,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var d=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(d)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),t<0?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1]))},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",t),OpenLayers.Event.observe(window,"mousewheel",t),OpenLayers.Event.observe(document,"mousewheel",t),!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t),OpenLayers.Event.stopObserving(window,"mousewheel",t),OpenLayers.Event.stopObserving(document,"mousewheel",t),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds=t.insertIds.concat(i.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,r=e.propertyNames.length;n<r;n++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,r=this.order.length;r-n>1;){i=parseInt((n+r)/2);var o=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));o>0?n=i:r=i}return this.order.splice(r,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(r)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){for(var t=e+1,i=void 0;t<this.order.length&&void 0==i;t++)i=OpenLayers.Util.getElement(this.order[t]);return i||null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var n=e.getZIndex(t),r=0;if(i){var o=e.getZIndex(i);r=n-o}return r},Z_ORDER_DRAWING_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===n){var r=i._boundsBottom-t._boundsBottom;n=0===r?1:r}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var r,o=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/o),s=this.map.getMaxExtent();s.right>e.left&&s.right<e.right?r=!0:s.left>e.left&&s.left<e.right&&(r=!1),(r!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=r===!0?s.getWidth()/n:0),this.rightOfDateLine=r}return i},getNodeType:function(e,t){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,r=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var o=0,s=e.components.length;o<s;o++)r=this.drawGeometry(e.components[o],t,i)&&r;return r}r=!1;var a=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):a=!0,r=this.redrawNode(e.id,e,t,i)),0==r){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(a=!0),l.parentNode.removeChild(l))}if(a){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return r},redrawNode:function(e,t,i,n){i=this.applyDefaultSymbolizer(i);var r=this.nodeFactory(e,this.getNodeType(t,i));r._featureId=n,r._boundsBottom=t.getBounds().bottom,r._geometryClass=t.CLASS_NAME,r._style=i;var o=this.drawGeometryNode(r,t,i);if(o===!1)return!1;if(r=o.node,this.indexer){var s=this.indexer.insert(r);s?this.vectorRoot.insertBefore(r,s):this.vectorRoot.appendChild(r)}else r.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(r);return this.postDraw(r),o.complete},redrawBackgroundNode:function(e,t,i,n){var r=OpenLayers.Util.extend({},i);return r.externalGraphic=r.backgroundGraphic,r.graphicXOffset=r.backgroundXOffset,r.graphicYOffset=r.backgroundYOffset,r.graphicZIndex=r.backgroundGraphicZIndex,r.graphicWidth=r.backgroundWidth||r.graphicWidth,r.graphicHeight=r.backgroundHeight||r.graphicHeight,r.backgroundGraphic=null,r.backgroundXOffset=null,r.backgroundYOffset=null,r.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,r,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,r={isFilled:void 0===i.fill||i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(r.isFilled=!1,r.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=r,0!=n&&{node:this.setStyle(e,i,r,t),complete:n}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);i&&this.textRoot.removeChild(i)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,n=i?i:t||e.srcElement;return n._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;i<n;i++)this.eraseGeometry(e.components[i],t);else{var r=OpenLayers.Util.getElement(e.id);if(r&&r.parentNode&&(r.geometry&&(r.geometry.destroy(),r.geometry=null),r.parentNode.removeChild(r),this.indexer&&this.indexer.remove(r),r._style.backgroundGraphic)){var o=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(o);s&&s.parentNode&&s.parentNode.removeChild(s)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){e=e||window.location.href;var t=OpenLayers.Util.getParameters(e),i=e.indexOf("#");return i>0&&(e="?"+e.substring(i+1,e.length),OpenLayers.Util.extend(t,OpenLayers.Util.getParameters(e))),t},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var t=0,i=this.map.controls.length;t<i;t++){var n=this.map.controls[t];if(n!=this&&"OpenLayers.Control.ArgParser"==n.CLASS_NAME){n.displayProjection!=this.displayProjection&&(this.displayProjection=n.displayProjection);break}}if(t==this.map.controls.length){var r=this.getParameters();r.layers&&(this.layers=r.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),r.lat&&r.lon&&(this.center=new OpenLayers.LonLat(parseFloat(r.lon),parseFloat(r.lat)),r.zoom&&(this.zoom=parseFloat(r.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var e=0,t=this.layers.length;e<t;e++){var i=this.map.layers[e],n=this.layers.charAt(e);"B"==n?this.map.setBaseLayer(i):"T"!=n&&"F"!=n||i.setVisibility("T"==n)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(e,t,i){null===e||"object"!=typeof e||OpenLayers.Util.isElement(e)?(OpenLayers.Control.prototype.initialize.apply(this,[i]),this.element=OpenLayers.Util.getElement(e),this.base=t||document.location.href):(i=e,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[i]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var t=0,i=this.map.controls.length;t<i;t++){var n=this.map.controls[t];if(n.CLASS_NAME==this.argParserClass.CLASS_NAME){n.displayProjection!=this.displayProjection&&(this.displayProjection=n.displayProjection);break}}t==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var e=this.anchor?"#":"?",t=this.base,i=null;t.indexOf("#")!=-1&&0==this.anchor&&(i=t.substring(t.indexOf("#"),t.length)),t.indexOf(e)!=-1&&(t=t.substring(0,t.indexOf(e)));var n=t.split("#");t=n[0]+e+OpenLayers.Util.getParameterString(this.createParams()),i&&(t+=i),this.anchor&&!this.element?window.location.href=t:this.element.href=t},createParams:function(e,t,i){e=e||this.map.getCenter();var n=OpenLayers.Util.getParameters(this.base);if(e){n.zoom=t||this.map.getZoom();var r=e.lat,o=e.lon;if(this.displayProjection){var s=OpenLayers.Projection.transform({x:o,y:r},this.map.getProjectionObject(),this.displayProjection);o=s.x,r=s.y}n.lat=Math.round(1e5*r)/1e5,n.lon=Math.round(1e5*o)/1e5,i=i||this.map.layers,n.layers="";for(var a=0,l=i.length;a<l;a++){var u=i[a];u.isBaseLayer?n.layers+=u==this.map.baseLayer?"B":"0":n.layers+=u.getVisibility()?"T":"F"}}return n},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var n=[];n.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,n)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),r=this.getServerZoom(),o=this.serviceVersion+"/"+this.layername+"/"+r+"/"+i+"/"+n+"."+this.type,s=this.url;return OpenLayers.Util.isArray(s)&&(s=this.selectUrl(o,s)),s+o},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter}),t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var i=e.features;if(i&&i.length>0){var n=t.projection,r=t.map.getProjectionObject();if(!r.equals(n))for(var o,s=0,a=i.length;s<a;++s)o=i[s].geometry,o&&o.transform(n,r);t.addFeatures(i)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),i=t.zoomIn,n=t.zoomOut,r=this.map.events;return n.parentNode!==e&&(r=this.events,r.attachToElement(n.parentNode)),r.register("buttonclick",this,this.onZoomClick),this.zoomInLink=i,this.zoomOutLink=n,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),i=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),i||(i=document.createElement("a"),i.href="#zoomOut",i.appendChild(document.createTextNode(this.zoomOutText)),i.className="olControlZoomOut",e.appendChild(i)),OpenLayers.Element.addClass(i,"olButton"),{zoomIn:t,zoomOut:i}},onZoomClick:function(e){var t=e.buttonElement;t===this.zoomInLink?this.map.zoomIn():t===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var r=[];for(var o in i)r.push(new OpenLayers.Rule({symbolizer:i[o],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:o})}));this.styles[e].addRules(r)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,n=this.strategies.length;i<n;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=t[r].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var i=this.renderers[e],n="function"==typeof i?i:OpenLayers.Renderer[i];if(n&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio,t.h=t.h*this.ratio,this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(e){if(this.drawn=!1,this.strategies){var t,i,n;for(i=0,n=this.strategies.length;i<n;i++)t=this.strategies[i],t.autoActivate&&t.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!i){this.renderer.root.style.visibility="hidden";var r=this.map.getSize(),o=r.w,s=r.h,a=o/2*this.ratio-o/2,l=s/2*this.ratio-s/2;a+=this.map.layerContainerOriginPx.x,a=-Math.round(a),l+=this.map.layerContainerOriginPx.y,l=-Math.round(l),this.div.style.left=a+"px",this.div.style.top=l+"px";var u=this.map.getExtent().scale(this.ratio);if(n=this.renderer.setExtent(u,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&n)for(var c in this.unrenderedFeatures){var h=this.unrenderedFeatures[c];this.drawFeature(h)}}if(!this.drawn||t||!n){this.drawn=!0;for(var h,c=0,d=this.features.length;c<d;c++)this.renderer.locked=c!==d-1,h=this.features[c],this.drawFeature(h)}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e},r=this.events.triggerEvent("beforefeaturesadded",n);if(r===!1)return;e=n.features}for(var o=[],s=0,a=e.length;s<a;s++){s!=e.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var l=e[s];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}o.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:o})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){0!=n&&e[n-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var r=e[n];delete this.unrenderedFeatures[r.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:r}),this.features=OpenLayers.Util.removeItem(this.features,r),r.layer=null,r.geometry&&this.renderer.eraseFeatures(r),OpenLayers.Util.indexOf(this.selectedFeatures,r)!=-1&&OpenLayers.Util.removeItem(this.selectedFeatures,r),i&&this.events.triggerEvent("featureremoved",{feature:r})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var n,r=i.length-1;r>=0;r--)n=i[r],t&&this.events.triggerEvent("beforefeatureremoved",{feature:n}),n.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:n});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var n=this.renderer.drawFeature(e,t);n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,i=this.renderer.getFeatureIdFromEvent(e);return i&&(t="string"==typeof i?this.getFeatureById(i):i),t},getFeatureBy:function(e,t){for(var i=null,n=0,r=this.features.length;n<r;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,r=this.features.length,o=[];for(i=0;i<r;i++)n=this.features[i],n&&n.attributes&&n.attributes[e]===t&&o.push(n);return o},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,n=0,r=t.length;n<r;n++)i=t[n].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(e,t){if(e.length<2)throw new Error("At least two point features have to be added to create a line from");for(var i,n,r,o=new Array(e.length-1),s=0,a=e.length;s<a;s++){if(i=e[s],r=i.geometry){if("OpenLayers.Geometry.Point"!=r.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else{var l=i.lonlat;r=new OpenLayers.Geometry.Point(l.lon,l.lat)}if(s>0){var u=null!=this.dataFrom?e[s+this.dataFrom].data||e[s+this.dataFrom].attributes:null,c=null!=this.styleFrom?e[s+this.styleFrom].style:null,h=new OpenLayers.Geometry.LineString([n,r]);o[s-1]=new OpenLayers.Feature.Vector(h,u,c)}n=r}this.addFeatures(o,t)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){var t;return t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0;
},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,n,r=e.params.LAYERS,o=(OpenLayers.Util.isArray(r)?r[0]:r).split(":");o.length>1&&(n=o[0]),i=o.pop();var s={url:e.url,featureType:i,featurePrefix:n,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,s))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.markers.length;t<i;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var n=0,r=this.markers.length;n<r;n++)this.drawMarker(this.markers[n]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),this.opacity<1&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var i=e.draw(t);this.div.appendChild(i)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;t<i;t++){var n=this.markers[t];e.extend(n.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(e,t){this.direction=e,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[t])},trigger:function(){if(this.map){var e=OpenLayers.Function.bind(function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-e("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,e("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-e("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(e("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetDomain.DEFAULTS);var t=OpenLayers.Format.CSWGetDomain["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetDomain version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetDomainResponse:function(e,t){this.readChildNodes(e,t)},DomainValues:function(e,t){OpenLayers.Util.isArray(t.DomainValues)||(t.DomainValues=[]);for(var i=e.attributes,n={},r=0,o=i.length;r<o;++r)n[i[r].name]=i[r].nodeValue;this.readChildNodes(e,n),t.DomainValues.push(n)},PropertyName:function(e,t){t.PropertyName=this.getChildValue(e)},ParameterName:function(e,t){t.ParameterName=this.getChildValue(e)},ListOfValues:function(e,t){OpenLayers.Util.isArray(t.ListOfValues)||(t.ListOfValues=[]),this.readChildNodes(e,t.ListOfValues)},Value:function(e,t){for(var i=e.attributes,n={},r=0,o=i.length;r<o;++r)n[i[r].name]=i[r].nodeValue;n.value=this.getChildValue(e),t.push({Value:n})},ConceptualScheme:function(e,t){t.ConceptualScheme={},this.readChildNodes(e,t.ConceptualScheme)},Name:function(e,t){t.Name=this.getChildValue(e)},Document:function(e,t){t.Document=this.getChildValue(e)},Authority:function(e,t){t.Authority=this.getChildValue(e)},RangeOfValues:function(e,t){t.RangeOfValues={},this.readChildNodes(e,t.RangeOfValues)},MinValue:function(e,t){for(var i=e.attributes,n={},r=0,o=i.length;r<o;++r)n[i[r].name]=i[r].nodeValue;n.value=this.getChildValue(e),t.MinValue=n},MaxValue:function(e,t){for(var i=e.attributes,n={},r=0,o=i.length;r<o;++r)n[i[r].name]=i[r].nodeValue;n.value=this.getChildValue(e),t.MaxValue=n}}},write:function(e){var t=this.writeNode("csw:GetDomain",e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetDomain:function(e){var t=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return e.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",e.PropertyName||this.PropertyName,t):(e.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",e.ParameterName||this.ParameterName,t),this.readChildNodes(t,e),t},PropertyName:function(e){var t=this.createElementNSPlus("csw:PropertyName",{value:e});return t},ParameterName:function(e){var t=this.createElementNSPlus("csw:ParameterName",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(e){var t=new OpenLayers.Format.ArcXML,i=t.read(e);return i.features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.layer&&this.setLayer(this.options.layer);var t=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(t,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(e){this.active?(this.deactivate(),this.layer=e,this.activate()):this.layer=e},setTargets:function(e){if(this.targets=[],e&&e.length)for(var t,i=0,n=e.length;i<n;++i)t=e[i],t instanceof OpenLayers.Layer.Vector?this.addTargetLayer(t):this.addTarget(t)},addTargetLayer:function(e){this.addTarget({layer:e})},addTarget:function(e){e=OpenLayers.Util.applyDefaults(e,this.defaults),e.nodeTolerance=e.nodeTolerance||e.tolerance,e.vertexTolerance=e.vertexTolerance||e.tolerance,e.edgeTolerance=e.edgeTolerance||e.tolerance,this.targets.push(e)},removeTargetLayer:function(e){for(var t,i=this.targets.length-1;i>=0;--i)t=this.targets[i],t.layer===e&&this.removeTarget(t)},removeTarget:function(e){return OpenLayers.Util.removeItem(this.targets,e)},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,e},onSketchModified:function(e){this.feature=e.feature,this.considerSnapping(e.vertex,e.vertex)},onVertexModified:function(e){this.feature=e.feature;var t=this.layer.map.getLonLatFromViewPortPx(e.pixel);this.considerSnapping(e.vertex,new OpenLayers.Geometry.Point(t.lon,t.lat))},considerSnapping:function(e,t){for(var i,n,r={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},o=!1,s=0,a=this.targets.length;s<a;++s)if(n=this.targets[s],i=this.testTarget(n,t)){if(this.greedy){r=i,r.target=n,o=!0;break}(i.rank<r.rank||i.rank===r.rank&&i.dist<r.dist)&&(r=i,r.target=n,o=!0)}if(o){var l=this.events.triggerEvent("beforesnap",{point:e,x:r.x,y:r.y,distance:r.dist,layer:r.target.layer,snapType:this.precedence[r.rank]});l!==!1?(e.x=r.x,e.y=r.y,this.point=e,this.events.triggerEvent("snap",{point:e,snapType:this.precedence[r.rank],layer:r.target.layer,distance:r.dist})):o=!1}this.point&&!o&&(e.x=t.x,e.y=t.y,this.point=null,this.events.triggerEvent("unsnap",{point:e}))},testTarget:function(e,t){var i=this.layer.map.getResolution();if("minResolution"in e&&i<e.minResolution)return null;if("maxResolution"in e&&i>=e.maxResolution)return null;for(var n,r,o,s,a,l,u,c={node:this.getGeoTolerance(e.nodeTolerance,i),vertex:this.getGeoTolerance(e.vertexTolerance,i),edge:this.getGeoTolerance(e.edgeTolerance,i)},h=Math.max(c.node,c.vertex,c.edge),d={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},p=!1,f=e.layer.features,m=this.precedence.length,g=new OpenLayers.LonLat(t.x,t.y),y=0,v=f.length;y<v;++y)if(n=f[y],n!==this.feature&&!n._sketch&&n.state!==OpenLayers.State.DELETE&&(!e.filter||e.filter.evaluate(n))&&n.atPoint(g,h,h))for(var E=0,T=Math.min(d.rank+1,m);E<T;++E)if(r=this.precedence[E],e[r])if("edge"===r){if(a=n.geometry.distanceTo(t,{details:!0}),l=a.distance,l<=c[r]&&l<d.dist){d={rank:E,dist:l,x:a.x0,y:a.y0},p=!0;break}}else{o=n.geometry.getVertices("node"===r),u=!1;for(var b=0,C=o.length;b<C;++b)s=o[b],l=s.distanceTo(t),l<=c[r]&&(E<d.rank||E===d.rank&&l<d.dist)&&(d={rank:E,dist:l,x:s.x,y:s.y},p=!0,u=!0);if(u)break}return p?d:null},getGeoTolerance:function(e,t){t!==this.resolution&&(this.resolution=t,this.geoToleranceCache={});var i=this.geoToleranceCache[e];return void 0===i&&(i=e*t,this.geoToleranceCache[e]=i),i},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,n=e.timePeriods.length;i<n;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){var t=this.createElementNSPlus("wcs:BeginPosition",{value:e});return t},EndPosition:function(e){var t=this.createElementNSPlus("wcs:EndPosition",{value:e});return t},TimeResolution:function(e){var t=this.createElementNSPlus("wcs:TimeResolution",{value:e});return t},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.Filter.v2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{fes:"http://www.opengis.net/fes/2.0",gml:"http://www.opengis.net/gml/3.2",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"fes",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.fes.Filter.apply(this,[e,t]),t.filter},readers:{fes:{_expression:function(e){for(var t,i="",n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 1:t=this.readNode(n),t.property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=n.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},ResourceId:function(e,t){var i=e.getAttribute("rid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},ValueReference:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.fes._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.fes._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var n=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,n),n.value=n.components[0],delete n.components,t.filters.push(n)},encodeLiteral:function(e){return e instanceof Date&&(e=OpenLayers.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.fes.Filter.apply(this,[e])},writers:{fes:{Filter:function(e){var t=this.createElementNSPlus("fes:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,n=e.fids.length;i<n;++i)this.writeNode("fes:ResourceId",e.fids[i],t);return t},ResourceId:function(e){return this.createElementNSPlus("fes:ResourceId",{attributes:{rid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("fes:And"),n=0,r=e.filters.length;n<r;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("fes:Or"),n=0,r=e.filters.length;n<r;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("fes:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("fes:PropertyIsLessThan");return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("fes:PropertyIsGreaterThan");return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("fes:PropertyIsLessThanOrEqualTo");return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("fes:PropertyIsGreaterThanOrEqualTo");return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("fes:PropertyIsBetween");return this.writeNode("ValueReference",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},ValueReference:function(e){return this.createElementNSPlus("fes:ValueReference",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("fes:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("fes:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("fes:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("fes:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("fes:Function",{attributes:{name:e.name}}),i=e.params,n=0,r=i.length;n<r;n++)this.writeOgcExpression(i[n],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("fes:PropertyIsNull");return this.writeNode("ValueReference",e,t),t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v2"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var i={};if(this.readNode(e,i),void 0===i.service){var n=new OpenLayers.Format.OGCExceptionReport;i.error=n.read(t)}return i},readers:{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e,t){var i={};i.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var n={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};return isNaN(n.x)&&isNaN(n.y)||(i.res=n),i},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var i,n;t.capability?(n=t.capability,i=t):n=t;var r=e.getAttributeNode("queryable"),o=r&&r.specified?e.getAttribute("queryable"):null;r=e.getAttributeNode("cascaded");var s=r&&r.specified?e.getAttribute("cascaded"):null;r=e.getAttributeNode("opaque");var a=r&&r.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),u=e.getAttribute("fixedWidth"),c=e.getAttribute("fixedHeight"),h=i||{},d=OpenLayers.Util.extend,p={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?d({},h.srs):{},metadataURLs:[],bbox:i?d({},h.bbox):{},llbbox:h.llbbox,dimensions:i?d({},h.dimensions):{},authorityURLs:i?d({},h.authorityURLs):{},identifiers:{},keywords:[],queryable:o&&""!==o?"1"===o||"true"===o:h.queryable||!1,cascaded:null!==s?parseInt(s):h.cascaded||0,opaque:a?"1"===a||"true"===a:h.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:h.noSubsets||!1,fixedWidth:null!=u?parseInt(u):h.fixedWidth||0,fixedHeight:null!=c?parseInt(c):h.fixedHeight||0,minScale:h.minScale,maxScale:h.maxScale,attribution:h.attribution};if(t.nestedLayers.push(p),p.capability=n,this.readChildNodes(e,p),delete p.capability,p.name){var f=p.name.split(":"),m=n.request,g=m.getfeatureinfo;f.length>0&&(p.prefix=f[0]),n.layers.push(p),void 0===p.formats&&(p.formats=m.getmap.formats),void 0===p.infoFormats&&g&&(p.infoFormats=g.formats)}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i,this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i),this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name"),n={};this.readChildNodes(e,n),t.authorityURLs[i]=n.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS"),t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min"),n=e.getAttribute("max"),r=Math.pow(2,.5),o=OpenLayers.INCHES_PER_UNIT.m;0!=i&&(t.maxScale=parseFloat((i/r*o*OpenLayers.DOTS_PER_INCH).toPrecision(13))),n!=Number.POSITIVE_INFINITY&&(t.minScale=parseFloat((n/r*o*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),n={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[n.name]=n},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t.dimensions){var n=t.dimensions[i];n.nearestVal="1"===e.getAttribute("nearestValue"),n.multipleVal="1"===e.getAttribute("multipleValues"),n.current="1"===e.getAttribute("current"),n["default"]=e.getAttribute("default")||"";var r=this.getChildValue(e);n.values=r.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var i=this.getChildValue(e),n=i.split(/ +/),r=0,o=n.length;r<o;r++)t.srs[n[r]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),e},update:function(e){var t=this.getMapBounds();null!==t&&(e&&e.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(t))&&(this.calculateBounds(t),this.resolution=this.layer.map.getResolution(),this.triggerRead(e))},getMapBounds:function(){if(null===this.layer.map)return null;var e=this.layer.map.getExtent();return e&&this.layer.projection&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(e=e.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),e},invalidBounds:function(e){e||(e=this.getMapBounds());var t=!this.bounds||!this.bounds.containsBounds(e);if(!t&&this.resFactor){var i=this.resolution/this.layer.map.getResolution();t=i>=this.resFactor||i<=1/this.resFactor}return t},calculateBounds:function(e){e||(e=this.getMapBounds());var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2)},triggerRead:function(e){!this.response||e&&e.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var t={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",t),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:t.filter,callback:this.merge,scope:this},e))},createFilter:function(){var e=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,e]})),e},merge:function(e){if(this.layer.destroyFeatures(),e.success()){var t=e.features;if(t&&t.length>0){var i=this.layer.projection,n=this.layer.map.getProjectionObject();if(i&&n&&!n.equals(i))for(var r,o=0,s=t.length;o<s;++o)r=t[o].geometry,r&&r.transform(i,n);this.layer.addFeatures(t)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{
"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},touchstart:function(e){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(e)||this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),!this.handle(e)||!this.stopDown},mouseup:function(e){return this.up=e.xy,!this.handle(e)||!this.stopUp},click:function(e){return!this.handle(e)||!this.stopClick},mousemove:function(e){return!this.callbacks.over&&!this.callbacks.out||(this.handle(e),!0)},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature,r="click"==t||"dblclick"==t||"touchstart"==t;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var o=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(n&&o?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):n&&!r||this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(n&&o||r)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(n||r)&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var n=this.EVENTMAP[e][t];if(n)if("click"==e&&this.up&&this.down){var r=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));r<=this.clickTolerance&&this.callback(n,i),this.up=this.down=null}else this.callback(n,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,n=0;n<i.length;n++)if(t=i[n].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],OpenLayers.Util.indexOf(this.layers,e)!=-1&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&OpenLayers.Util.indexOf(this.layers,t)!=-1&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,n,r,o=this.layers||[this.layer];for(n=0;n<o.length;++n)if(t=o[n],r=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>r;)i=t.selectedFeatures[r],e&&e.except==i?++r:this.unselect(i)},clickFeature:function(e){if(!this.hover){var t=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;t?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):OpenLayers.Util.indexOf(t.selectedFeatures,e)==-1&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var n=this.selectStyle||this.renderIntent;t.drawFeature(e,n),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter==this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;t!==!1&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),t!==!1&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),i=this.map.getLonLatFromPixel({x:e.right,y:e.top}),n=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var r=this.multiple;this.multiple=!0;var o=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:o});for(var s,a=0;a<o.length;++a){s=o[a];for(var l=0,u=s.features.length;l<u;++l){var c=s.features[l];c.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,c.geometry.CLASS_NAME)>-1)&&n.toGeometry().intersects(c.geometry)&&OpenLayers.Util.indexOf(s.selectedFeatures,c)==-1&&this.select(c)}}this.multiple=r,this.events.triggerEvent("boxselectionend",{layers:o})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},addLayer:function(e){var t=this.active;this.deactivate(),null==this.layers?null!=this.layer?(this.layers=[this.layer],this.layers.push(e)):this.layers=[e]:this.layers.push(e),this.initLayer(this.layers),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.startTouch(),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(e)||(!(!this.lastUp||!this.lastUp.equals(e.xy))||(!this.lastDown||!this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp)))},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var n=!0;if(null!=i&&e&&t){var r=e.distanceTo(t);r>i&&(n=!1)}return n},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,n=this.line.geometry.components[i];!n||isNaN(n.x)||isNaN(n.y)||this.insertXY(n.x+e,n.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e),n=t*Math.sin(e);this.insertDeltaXY(i,n)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var n=this.line.geometry.components[i],r=this.line.geometry.components[i-1],o=Math.atan2(n.y-r.y,n.x-r.x);this.insertDirectionLength(180*o/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,n=t[i],r=e.removeComponent(n);if(r){if(this.touch&&i>0){t=e.components;var o=t[i-1],s=this.getCurrentPointIndex(),a=t[s];a.x=o.x,a.y=o.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(n),this.drawFeature()}return r},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(e,t,i){var n=i||OpenLayers.Spherical.DEFAULT_RADIUS,r=Math.sin(Math.PI*(t.lon-e.lon)/360),o=Math.sin(Math.PI*(t.lat-e.lat)/360),s=o*o+r*r*Math.cos(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180);return 2*n*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))},OpenLayers.Spherical.computeHeading=function(e,t){var i=Math.sin(Math.PI*(e.lon-t.lon)/180)*Math.cos(Math.PI*t.lat/180),n=Math.cos(Math.PI*e.lat/180)*Math.sin(Math.PI*t.lat/180)-Math.sin(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180)*Math.cos(Math.PI*(e.lon-t.lon)/180);return 180*Math.atan2(i,n)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var t,i=this.layers||e.layers;for(t=i.length-1;t>=0;--t)this.addLayer({layer:i[t]});this.layers||e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(e){e.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(e){e.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(e){if(this.active){var t=e.tile;if(t instanceof OpenLayers.Tile.Image&&!t.crossOriginKeyword&&"data:"!==t.url.substr(0,5)){var i=OpenLayers.Request.makeSameOrigin(t.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[i]=t.url,t.url=i}}},onTileLoaded:function(e){this.active&&!e.aborted&&e.tile instanceof OpenLayers.Tile.Image&&"data:"!==e.tile.url.substr(0,5)&&(this.cache({tile:e.tile}),delete OpenLayers.Control.CacheWrite.urlMap[e.tile.url])},cache:function(e){if(window.localStorage){var t=e.tile;try{var i=t.getCanvasContext();if(i){var n=OpenLayers.Control.CacheWrite.urlMap,r=n[t.url]||t.url;window.localStorage.setItem("olCache_"+r,i.canvas.toDataURL(this.imageFormat))}}catch(o){var s=o.name||o.message;s&&this.quotaRegEx.test(s)?this.events.triggerEvent("cachefull",{tile:t}):OpenLayers.Console.error(o.toString())}}},destroy:function(){if(this.layers||this.map){var e,t=this.layers||this.map.layers;for(e=t.length-1;e>=0;--e)this.removeLayer({layer:t[e]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var e,t;for(e=window.localStorage.length-1;e>=0;--e)t=window.localStorage.key(e),"olCache_"===t.substr(0,8)&&window.localStorage.removeItem(t)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);var e={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,e)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",layerTemplate:'<a href="${href}" target="_blank">${title}</a>',destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var e,t=[];if(this.map&&this.map.layers){for(var i=0,n=this.map.layers.length;i<n;i++){var r=this.map.layers[i];r.attribution&&r.getVisibility()&&(e="object"==typeof r.attribution?OpenLayers.String.format(this.layerTemplate,r.attribution):r.attribution,OpenLayers.Util.indexOf(t,e)===-1&&t.push(e))}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:t.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,n=(new Date).getTime(),r=0,o=this.points.length;r<o&&(i=this.points[r],!(n-i.tick>this.delay));r++)t=i;if(t){var s=(new Date).getTime()-t.tick,a=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=a/s;if(!(0==l||l<this.threshold)){var u=Math.asin((e.y-t.xy.y)/a);return t.xy.x<=e.x&&(u=Math.PI-u),{speed:l,theta:u}}}},move:function(e,t){var i=e.speed,n=Math.cos(e.theta),r=-Math.sin(e.theta),o=(new Date).getTime(),s=0,a=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-o,l=-this.deceleration*Math.pow(e,2)/2+i*e,u=l*n,c=l*r,h={};h.end=!1;var d=-this.deceleration*e+i;d<=0&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,h.end=!0),h.x=u-s,h.y=c-a,s=u,a=c,t(h.x,h.y,h.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Format.WFSCapabilities.v2_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs/2.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wfs:{WFS_Capabilities:function(e,t){this.readChildNodes(e,t)},FeatureTypeList:function(e,t){t.featureTypeList={featureTypes:[]},this.readChildNodes(e,t.featureTypeList)},FeatureType:function(e,t){var i={};this.readChildNodes(e,i),t.featureTypes.push(i)},Name:function(e,t){var i=this.getChildValue(e);if(i){var n=i.split(":");t.name=n.pop(),n.length>0&&(t.featureNS=this.lookupNamespaceURI(e,n[0]))}},Title:function(e,t){var i=this.getChildValue(e);i&&(t.title=i)},Abstract:function(e,t){var i=this.getChildValue(e);i&&(t["abstract"]=i)},DefaultCRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v2_0_0"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(e){},write:function(e){var t;OpenLayers.Format.XML.supportActiveX?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs)for(var i=0,n=e.outputs.length;i<n;i++)this.writeNode("wps:Output",e.outputs[i],t);return t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference,mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e["abstract"],t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,n=e.length;i<n;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),e.boundingBoxData&&this.writeNode("wps:BoundingBoxData",e.boundingBoxData,t),t},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData?this.writeNode("wps:ComplexData",e.complexData,t):e.boundingBoxData&&this.writeNode("ows:BoundingBox",e.boundingBoxData,t),t},LiteralData:function(e){var t=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value});return t},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),i=e.value;return"string"==typeof i?t.appendChild(this.getXMLDoc().createCDATASection(e.value)):t.appendChild(i),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},BoundingBoxData:function(e,t){this.writers.ows.BoundingBox.apply(this,[e,t,"wps:BoundingBoxData"])},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(e,t){t.executeResponse={lang:e.getAttribute("lang"),statusLocation:e.getAttribute("statusLocation"),serviceInstance:e.getAttribute("serviceInstance"),service:e.getAttribute("service")},this.readChildNodes(e,t.executeResponse)},Process:function(e,t){t.process={},this.readChildNodes(e,t.process)},Status:function(e,t){t.status={creationTime:e.getAttribute("creationTime")},this.readChildNodes(e,t.status)},ProcessSucceeded:function(e,t){t.processSucceeded=!0},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Reference:function(e,t){t.reference={href:e.getAttribute("href"),mimeType:e.getAttribute("mimeType"),encoding:e.getAttribute("encoding"),schema:e.getAttribute("schema")}},Data:function(e,t){t.data={},this.readChildNodes(e,t)},LiteralData:function(e,t){t.literalData={dataType:e.getAttribute("dataType"),uom:e.getAttribute("uom"),value:this.getChildValue(e)}},ComplexData:function(e,t){if(t.complexData={mimeType:e.getAttribute("mimeType"),schema:e.getAttribute("schema"),encoding:e.getAttribute("encoding"),value:""},this.isSimpleContent(e)){var i;for(i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 3:case 4:t.complexData.value+=i.nodeValue}}else for(i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&(t.complexData.value=i)},BoundingBox:function(e,t){t.boundingBoxData={dimensions:e.getAttribute("dimensions"),crs:e.getAttribute("crs")},this.readChildNodes(e,t.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,
initialize:function(e,t,i){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,i]),this.location=t,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(e,t,i){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(e){var t=e.responseXML;if(t&&t.documentElement||(t=OpenLayers.Format.XML.prototype.read(e.responseText)),this.useFeedTitle){var i=null;try{i=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(n){i=t.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}var r={};OpenLayers.Util.extend(r,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(r.externalProjection=this.projection,r.internalProjection=this.map.getProjectionObject());for(var o=new OpenLayers.Format.GeoRSS(r),s=o.read(t),a=0,l=s.length;a<l;a++){var u={},c=s[a];if(c.geometry){var h=c.attributes.title?c.attributes.title:"Untitled",d=c.attributes.description?c.attributes.description:"No description.",p=c.attributes.link?c.attributes.link:"",f=c.geometry.getBounds().getCenterLonLat();if(u.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),u.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),h||d){u.title=h,u.description=d;var m='<div class="olLayerGeoRSSClose">[x]</div>';m+='<div class="olLayerGeoRSSTitle">',p&&(m+='<a class="link" href="'+p+'" target="_blank">'),m+=h,p&&(m+="</a>"),m+="</div>",m+='<div style="" class="olLayerGeoRSSDescription">',m+=d,m+="</div>",u.popupContentHTML=m}var c=new OpenLayers.Feature(this,f,u);this.features.push(c);var g=c.createMarker();g.events.register("click",c,this.markerClick),this.addMarker(g)}}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;i<n;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!t){var r=this.createPopup();OpenLayers.Event.observe(r.div,"click",OpenLayers.Function.bind(function(){for(var e=0,t=this.layer.map.popups.length;e<t;e++)this.layer.map.removePopup(this.layer.map.popups[e])},this)),this.layer.map.addPopup(r)}OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS"),t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){var i=parseFloat(this.getChildValue(e)).toPrecision(16);0!=i&&(t.maxScale=i)},MaxScaleDenominator:function(e,t){var i=parseFloat(this.getChildValue(e)).toPrecision(16);i!=Number.POSITIVE_INFINITY&&(t.minScale=i)},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),n={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[n.name]=n},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(i)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]),t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature")),t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,i,n){var r=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),r.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(e),i={},n=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,n):e.toArray(n),i.WIDTH=t.w,i.HEIGHT=t.h;var r=this.getFullRequestString(i);return r},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e,t){var i=this.map.getProjectionObject(),n=this.projection&&this.projection.equals(i)?this.projection.getCode():i.getCode(),r="none"==n?null:n;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=r:this.params.SRS=r,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,t,i,n){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),r=-Math.round(e.top/t);return this.getFullRequestString({t:r,l:n,s:i})},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,r=i*this.tileSize.h,o=e.left,s=Math.floor(o/n)-this.buffer,a=e.top,l=Math.floor(a/r)+this.buffer;return{tilelon:n,tilelat:r,startcol:s,startrow:l}},getTileBoundsForGridIndex:function(e,t){var i=(this.getTileOrigin(),this.gridLayout),n=i.tilelon,r=i.tilelat,o=(i.startcol+t)*n,s=(i.startrow-e)*r;return new OpenLayers.Bounds(o,s,o+n,s+r)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,n=t*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),o=i*Math.floor(r.lon/i),s=n*Math.floor(r.lat/n);return new OpenLayers.Bounds(o,s,o+i,s+n)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(e){var t=this.getParser(),i={queryable:e.queryable,visibility:e.visibility,name:e.params.LAYERS,title:e.name,"abstract":e.metadata["abstract"],dataURL:e.metadata.dataURL,metadataURL:e.metadataURL,attribution:e.attribution,server:{version:e.params.VERSION,url:e.url},maxExtent:e.maxExtent,transparent:e.params.TRANSPARENT,numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:1==e.opacity?void 0:e.opacity,gutter:0==e.gutter?void 0:e.gutter,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.singleTile||!e.tileSize?void 0:{width:e.tileSize.w,height:e.tileSize.h},minScale:e.options.resolutions||e.options.scales||e.options.maxResolution||e.options.minScale?e.minScale:void 0,maxScale:e.options.resolutions||e.options.scales||e.options.minResolution||e.options.maxScale?e.maxScale:void 0,formats:[],styles:[],srs:e.srs,dimensions:e.dimensions};if(e.metadata.servertitle&&(i.server.title=e.metadata.servertitle),e.metadata.formats&&e.metadata.formats.length>0)for(var n=0,r=e.metadata.formats.length;n<r;n++){var o=e.metadata.formats[n];i.formats.push({value:o.value,current:o.value==e.params.FORMAT})}else i.formats.push({value:e.params.FORMAT,current:!0});if(e.metadata.styles&&e.metadata.styles.length>0)for(var n=0,r=e.metadata.styles.length;n<r;n++){var s=e.metadata.styles[n];s.href==e.params.SLD||s.body==e.params.SLD_BODY||s.name==e.params.STYLES?s.current=!0:s.current=!1,i.styles.push(s)}else i.styles.push({href:e.params.SLD,body:e.params.SLD_BODY,name:e.params.STYLES||t.defaultStyleName,title:t.defaultStyleTitle,current:!0});return i},toContext:function(e){var t={},i=e.layers;if("OpenLayers.Map"==e.CLASS_NAME){var n=e.metadata||{};t.size=e.getSize(),t.bounds=e.getExtent(),t.projection=e.projection,t.title=e.title,t.keywords=n.keywords,t["abstract"]=n["abstract"],t.logo=n.logo,t.descriptionURL=n.descriptionURL,t.contactInformation=n.contactInformation,t.maxExtent=e.maxExtent}else OpenLayers.Util.applyDefaults(t,e),void 0!=t.layers&&delete t.layers;if(void 0==t.layersContext&&(t.layersContext=[]),void 0!=i&&OpenLayers.Util.isArray(i))for(var r=0,o=i.length;r<o;r++){var s=i[r];s instanceof OpenLayers.Layer.WMS&&t.layersContext.push(this.layerToContext(s))}return t},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(e){var t=null;if(null==e)t=this.namespaces[this.defaultPrefix];else for(t in this.namespaces)if(this.namespaces[t]==e)break;return t},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;this.rootPrefix=t.prefix;var i={version:t.getAttribute("version")};return this.runChildNodes(i,t),i},runChildNodes:function(e,t){for(var i,n,r,o,s=t.childNodes,a=0,l=s.length;a<l;++a)i=s[a],1==i.nodeType&&(r=this.getNamespacePrefix(i.namespaceURI),o=i.nodeName.split(":").pop(),n=this["read_"+r+"_"+o],n&&n.apply(this,[e,i]))},read_wmc_General:function(e,t){this.runChildNodes(e,t)},read_wmc_BoundingBox:function(e,t){e.projection=t.getAttribute("SRS"),e.bounds=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"))},read_wmc_LayerList:function(e,t){e.layersContext=[],this.runChildNodes(e,t)},read_wmc_Layer:function(e,t){var i={visibility:"1"!=t.getAttribute("hidden"),queryable:"1"==t.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(i,t),e.layersContext.push(i)},read_wmc_Extension:function(e,t){this.runChildNodes(e,t)},read_ol_units:function(e,t){e.units=this.getChildValue(t)},read_ol_maxExtent:function(e,t){var i=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"));e.maxExtent=i},read_ol_transparent:function(e,t){e.transparent=this.getChildValue(t)},read_ol_numZoomLevels:function(e,t){e.numZoomLevels=parseInt(this.getChildValue(t))},read_ol_opacity:function(e,t){e.opacity=parseFloat(this.getChildValue(t))},read_ol_singleTile:function(e,t){e.singleTile="true"==this.getChildValue(t)},read_ol_tileSize:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height")};e.tileSize=i},read_ol_gutter:function(e,t){e.gutter=parseInt(this.getChildValue(t))},read_ol_isBaseLayer:function(e,t){e.isBaseLayer="true"==this.getChildValue(t)},read_ol_displayInLayerSwitcher:function(e,t){e.displayInLayerSwitcher="true"==this.getChildValue(t)},read_ol_attribution:function(e,t){e.attribution={},this.runChildNodes(e.attribution,t)},read_wmc_Server:function(e,t){e.version=t.getAttribute("version"),e.url=this.getOnlineResource_href(t),e.metadata.servertitle=t.getAttribute("title")},read_wmc_FormatList:function(e,t){this.runChildNodes(e,t)},read_wmc_Format:function(e,t){var i={value:this.getChildValue(t)};"1"==t.getAttribute("current")&&(i.current=!0),e.formats.push(i)},read_wmc_StyleList:function(e,t){this.runChildNodes(e,t)},read_wmc_Style:function(e,t){var i={};this.runChildNodes(i,t),"1"==t.getAttribute("current")&&(i.current=!0),e.styles.push(i)},read_wmc_SLD:function(e,t){this.runChildNodes(e,t)},read_sld_StyledLayerDescriptor:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_sld_FeatureTypeStyle:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_wmc_OnlineResource:function(e,t){e.href=this.getAttributeNS(t,this.namespaces.xlink,"href")},read_wmc_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_wmc_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_wmc_MetadataURL:function(e,t){e.metadataURL=this.getOnlineResource_href(t)},read_wmc_KeywordList:function(e,t){e.keywords=[],this.runChildNodes(e.keywords,t)},read_wmc_Keyword:function(e,t){e.push(this.getChildValue(t))},read_wmc_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e["abstract"]=i)},read_wmc_LogoURL:function(e,t){e.logo={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)}},read_wmc_DescriptionURL:function(e,t){e.descriptionURL=this.getOnlineResource_href(t)},read_wmc_ContactInformation:function(e,t){var i={};this.runChildNodes(i,t),e.contactInformation=i},read_wmc_ContactPersonPrimary:function(e,t){var i={};this.runChildNodes(i,t),e.personPrimary=i},read_wmc_ContactPerson:function(e,t){var i=this.getChildValue(t);i&&(e.person=i)},read_wmc_ContactOrganization:function(e,t){var i=this.getChildValue(t);i&&(e.organization=i)},read_wmc_ContactPosition:function(e,t){var i=this.getChildValue(t);i&&(e.position=i)},read_wmc_ContactAddress:function(e,t){var i={};this.runChildNodes(i,t),e.contactAddress=i},read_wmc_AddressType:function(e,t){var i=this.getChildValue(t);i&&(e.type=i)},read_wmc_Address:function(e,t){var i=this.getChildValue(t);i&&(e.address=i)},read_wmc_City:function(e,t){var i=this.getChildValue(t);i&&(e.city=i)},read_wmc_StateOrProvince:function(e,t){var i=this.getChildValue(t);i&&(e.stateOrProvince=i)},read_wmc_PostCode:function(e,t){var i=this.getChildValue(t);i&&(e.postcode=i)},read_wmc_Country:function(e,t){var i=this.getChildValue(t);i&&(e.country=i)},read_wmc_ContactVoiceTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.phone=i)},read_wmc_ContactFacsimileTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.fax=i)},read_wmc_ContactElectronicMailAddress:function(e,t){var i=this.getChildValue(t);i&&(e.email=i)},read_wmc_DataURL:function(e,t){e.dataURL=this.getOnlineResource_href(t)},read_wmc_LegendURL:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)};e.legend=i},read_wmc_DimensionList:function(e,t){e.dimensions={},this.runChildNodes(e.dimensions,t)},read_wmc_Dimension:function(e,t){var i=t.getAttribute("name").toLowerCase(),n={name:i,units:t.getAttribute("units")||"",unitSymbol:t.getAttribute("unitSymbol")||"",userValue:t.getAttribute("userValue")||"",nearestValue:"1"===t.getAttribute("nearestValue"),multipleValues:"1"===t.getAttribute("multipleValues"),current:"1"===t.getAttribute("current"),"default":t.getAttribute("default")||""},r=this.getChildValue(t);n.values=r.split(","),e[n.name]=n},write:function(e,t){var i=this.createElementDefaultNS("ViewContext");return this.setAttributes(i,{version:this.VERSION,id:t&&"string"==typeof t.id?t.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),i.appendChild(this.write_wmc_General(e)),i.appendChild(this.write_wmc_LayerList(e)),OpenLayers.Format.XML.prototype.write.apply(this,[i])},createElementDefaultNS:function(e,t,i){var n=this.createElementNS(this.namespaces[this.defaultPrefix],e);return t&&n.appendChild(this.createTextNode(t)),i&&this.setAttributes(n,i),n},setAttributes:function(e,t){var i;for(var n in t)i=t[n].toString(),i.match(/[A-Z]/)?this.setAttributeNS(e,null,n,i):e.setAttribute(n,i)},write_wmc_General:function(e){var t=this.createElementDefaultNS("General");e.size&&t.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var i=e.bounds;return t.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18),SRS:e.projection})),t.appendChild(this.createElementDefaultNS("Title",e.title)),e.keywords&&t.appendChild(this.write_wmc_KeywordList(e.keywords)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.logo&&t.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo)),e.descriptionURL&&t.appendChild(this.write_wmc_URLType("DescriptionURL",e.descriptionURL)),e.contactInformation&&t.appendChild(this.write_wmc_ContactInformation(e.contactInformation)),t.appendChild(this.write_ol_MapExtension(e)),t},write_wmc_KeywordList:function(e){for(var t=this.createElementDefaultNS("KeywordList"),i=0,n=e.length;i<n;i++)t.appendChild(this.createElementDefaultNS("Keyword",e[i]));return t},write_wmc_ContactInformation:function(e){var t=this.createElementDefaultNS("ContactInformation");return e.personPrimary&&t.appendChild(this.write_wmc_ContactPersonPrimary(e.personPrimary)),e.position&&t.appendChild(this.createElementDefaultNS("ContactPosition",e.position)),e.contactAddress&&t.appendChild(this.write_wmc_ContactAddress(e.contactAddress)),e.phone&&t.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",e.phone)),e.fax&&t.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",e.fax)),e.email&&t.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",e.email)),t},write_wmc_ContactPersonPrimary:function(e){var t=this.createElementDefaultNS("ContactPersonPrimary");return e.person&&t.appendChild(this.createElementDefaultNS("ContactPerson",e.person)),e.organization&&t.appendChild(this.createElementDefaultNS("ContactOrganization",e.organization)),t},write_wmc_ContactAddress:function(e){var t=this.createElementDefaultNS("ContactAddress");return e.type&&t.appendChild(this.createElementDefaultNS("AddressType",e.type)),e.address&&t.appendChild(this.createElementDefaultNS("Address",e.address)),e.city&&t.appendChild(this.createElementDefaultNS("City",e.city)),e.stateOrProvince&&t.appendChild(this.createElementDefaultNS("StateOrProvince",e.stateOrProvince)),e.postcode&&t.appendChild(this.createElementDefaultNS("PostCode",e.postcode)),e.country&&t.appendChild(this.createElementDefaultNS("Country",e.country)),t},write_ol_MapExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent;if(i){var n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n)}return t},write_wmc_LayerList:function(e){for(var t=this.createElementDefaultNS("LayerList"),i=0,n=e.layersContext.length;i<n;++i)t.appendChild(this.write_wmc_Layer(e.layersContext[i]));return t},write_wmc_Layer:function(e){var t=this.createElementDefaultNS("Layer",null,{queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1"});return t.appendChild(this.write_wmc_Server(e)),t.appendChild(this.createElementDefaultNS("Name",e.name)),t.appendChild(this.createElementDefaultNS("Title",e.title)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.dataURL&&t.appendChild(this.write_wmc_URLType("DataURL",e.dataURL)),e.metadataURL&&t.appendChild(this.write_wmc_URLType("MetadataURL",e.metadataURL)),t},write_ol_attribution:function(e){"string"==typeof e&&(e={title:e});var t=this.createElementNS(this.namespaces.ol,"ol:attribution");return t.appendChild(this.createElementDefaultNS("Title",e.title)),e.href&&t.appendChild(this.write_wmc_OnlineResource(e.href)),e.logo&&t.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo)),t},write_wmc_LayerExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent,n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n),e.tileSize&&!e.singleTile){var r=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(r,e.tileSize),t.appendChild(r)}for(var o,s=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile","gutter"],a=0,l=s.length;a<l;++a)o=this.createOLPropertyNode(e,s[a]),o&&t.appendChild(o);if(e.attribution){var u=this.write_ol_attribution(e.attribution);t.appendChild(u)}return t},createOLPropertyNode:function(e,t){var i=null;return null!=e[t]&&(i=this.createElementNS(this.namespaces.ol,"ol:"+t),i.appendChild(this.createTextNode(e[t].toString()))),i},write_wmc_Server:function(e){var t=e.server,i=this.createElementDefaultNS("Server"),n={service:"OGC:WMS",version:t.version};return t.title&&(n.title=t.title),this.setAttributes(i,n),i.appendChild(this.write_wmc_OnlineResource(t.url)),i},write_wmc_URLType:function(e,t,i){var n=this.createElementDefaultNS(e);if(n.appendChild(this.write_wmc_OnlineResource(t)),i)for(var r=["width","height","format"],o=0;o<r.length;o++)r[o]in i&&n.setAttribute(r[o],i[r[o]]);return n},write_wmc_DimensionList:function(e){var t=this.createElementDefaultNS("DimensionList");for(var i in e.dimensions){var n={},r=e.dimensions[i];for(var o in r)"boolean"==typeof r[o]?n[o]=Number(r[o]):n[o]=r[o];var s="";n.values&&(s=n.values.join(","),delete n.values),t.appendChild(this.createElementDefaultNS("Dimension",s,n))}return t},write_wmc_FormatList:function(e){for(var t=this.createElementDefaultNS("FormatList"),i=0,n=e.formats.length;i<n;i++){var r=e.formats[i];t.appendChild(this.createElementDefaultNS("Format",r.value,r.current&&1==r.current?{current:"1"}:null))}return t},write_wmc_StyleList:function(e){var t=this.createElementDefaultNS("StyleList"),i=e.styles;if(i&&OpenLayers.Util.isArray(i))for(var n,r=0,o=i.length;r<o;r++){var s=i[r],a=this.createElementDefaultNS("Style",null,s.current&&1==s.current?{current:"1"}:null);if(s.href){n=this.createElementDefaultNS("SLD"),s.name&&n.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&n.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&n.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));var l=this.write_wmc_OnlineResource(s.href);n.appendChild(l),a.appendChild(n)}else if(s.body){n=this.createElementDefaultNS("SLD"),s.name&&n.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&n.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&n.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));var u=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]),c=u.documentElement;n.ownerDocument&&n.ownerDocument.importNode&&(c=n.ownerDocument.importNode(c,!0)),n.appendChild(c),a.appendChild(n)}else a.appendChild(this.createElementDefaultNS("Name",s.name)),a.appendChild(this.createElementDefaultNS("Title",s.title)),s["abstract"]&&a.appendChild(this.createElementDefaultNS("Abstract",s["abstract"])),s.legend&&a.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));t.appendChild(a)}return t},write_wmc_OnlineResource:function(e){var t=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(t,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(t,this.namespaces.xlink,"xlink:href",e),t},getOnlineResource_href:function(e){var t={},i=e.getElementsByTagName("OnlineResource");return i.length>0&&this.read_wmc_OnlineResource(t,i[0]),t.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])},read_sld_MinScaleDenominator:function(e,t){var i=parseFloat(this.getChildValue(t));i>0&&(e.maxScale=i)},read_sld_MaxScaleDenominator:function(e,t){e.minScale=parseFloat(this.getChildValue(t))},read_wmc_SRS:function(e,t){"srs"in e||(e.srs={}),e.srs[this.getChildValue(t)]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.maxScale){var i=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");i.appendChild(this.createTextNode(e.maxScale.toPrecision(16))),t.appendChild(i)}if(e.minScale){var n=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");n.appendChild(this.createTextNode(e.minScale.toPrecision(16))),t.appendChild(n)}if(e.srs)for(var r in e.srs)t.appendChild(this.createElementDefaultNS("SRS",r));return t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e)),t},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{xls:{XLS:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Response:function(e,t){this.readChildNodes(e,t)},GeocodeResponse:function(e,t){t.responseLists=[],this.readChildNodes(e,t)},GeocodeResponseList:function(e,t){var i={features:[],numberOfGeocodedAddresses:parseInt(e.getAttribute("numberOfGeocodedAddresses"))};t.responseLists.push(i),this.readChildNodes(e,i)},GeocodedAddress:function(e,t){var i=new OpenLayers.Feature.Vector;t.features.push(i),this.readChildNodes(e,i),i.geometry=i.components[0]},GeocodeMatchCode:function(e,t){t.attributes.matchCode={accuracy:parseFloat(e.getAttribute("accuracy")),matchType:e.getAttribute("matchType")}},Address:function(e,t){var i={countryCode:e.getAttribute("countryCode"),addressee:e.getAttribute("addressee"),street:[],place:[]};t.attributes.address=i,this.readChildNodes(e,i)},freeFormAddress:function(e,t){t.freeFormAddress=this.getChildValue(e)},StreetAddress:function(e,t){this.readChildNodes(e,t)},Building:function(e,t){t.building={number:e.getAttribute("number"),subdivision:e.getAttribute("subdivision"),buildingName:e.getAttribute("buildingName")}},Street:function(e,t){t.street.push(this.getChildValue(e))},Place:function(e,t){t.place[e.getAttribute("type")]=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(e){return this.writers.xls.XLS.apply(this,[e])},writers:{xls:{XLS:function(e){var t=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",e.header,t),this.writeNode("Request",e,t),t},RequestHeader:function(e){return this.createElementNSPlus("xls:RequestHeader")},Request:function(e){var t=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:e.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",e.addresses,t),t},GeocodeRequest:function(e){for(var t=this.createElementNSPlus("xls:GeocodeRequest"),i=0,n=e.length;i<n;i++)this.writeNode("Address",e[i],t);return t},Address:function(e){var t=this.createElementNSPlus("xls:Address",{attributes:{countryCode:e.countryCode}});return e.freeFormAddress?this.writeNode("freeFormAddress",e.freeFormAddress,t):(e.street&&this.writeNode("StreetAddress",e,t),e.municipality&&this.writeNode("Municipality",e.municipality,t),e.countrySubdivision&&this.writeNode("CountrySubdivision",e.countrySubdivision,t),e.postalCode&&this.writeNode("PostalCode",e.postalCode,t)),t},freeFormAddress:function(e){return this.createElementNSPlus("freeFormAddress",{value:e})},StreetAddress:function(e){var t=this.createElementNSPlus("xls:StreetAddress");e.building&&this.writeNode(t,"Building",e.building);var i=e.street;OpenLayers.Util.isArray(i)||(i=[i]);for(var n=0,r=i.length;n<r;n++)this.writeNode("Street",i[n],t);return t},Building:function(e){return this.createElementNSPlus("xls:Building",{attributes:{number:e.number,subdivision:e.subdivision,buildingName:e.buildingName}})},Street:function(e){return this.createElementNSPlus("xls:Street",{value:e})},Municipality:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:e})},CountrySubdivision:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:e})},PostalCode:function(e){return this.createElementNSPlus("xls:PostalCode",{value:e})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),
"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,n=typeof e;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(r){OpenLayers.Console.error("Trouble serializing: "+r)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,n,r,o=!1;for(i in e)e.hasOwnProperty(i)&&(n=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),r=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=n&&null!=r&&(o&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),r),o=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var n=0,r=e.length;n<r;++n)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=t&&(n>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var n=t[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var n=e+(i?0:this.translationParameters.x),r=t+(i?0:this.translationParameters.y);return n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL&&r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),r=-e.left/n,o=e.top/n;if(t){this.left=r,this.top=o;var s="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",s),this.translate(this.xOffset,0),!0}var a=this.translate(r-this.left+this.xOffset,o-this.top);return a||this.setExtent(e,!0),i&&a},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path"}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var n=t.title||t.graphicTitle;if(n){e.setAttributeNS(null,"title",n);var r=e.getElementsByTagName("title");if(r.length>0)r[0].firstChild.textContent=n;else{var o=this.nodeFactory(null,"title");o.textContent=n,e.appendChild(o)}}var s,a=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&a){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){s=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var u=t.graphicWidth||t.graphicHeight,c=t.graphicHeight||t.graphicWidth;u=u?u:2*t.pointRadius,c=c?c:2*t.pointRadius;var h=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*u),d=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*c),p=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+h).toFixed()),e.setAttributeNS(null,"y",(s.y+d).toFixed()),e.setAttributeNS(null,"width",u),e.setAttributeNS(null,"height",c),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+p),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var f=3*t.pointRadius,m=2*f,g=this.importSymbol(t.graphicName);s=this.getPosition(e),l=3*this.symbolMetrics[g.id][0]/m;var y=e.parentNode,v=e.nextSibling;y&&y.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(g.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",g.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",m),e.setAttributeNS(null,"height",m),e.setAttributeNS(null,"x",s.x-f),e.setAttributeNS(null,"y",s.y-f),v?y.insertBefore(e,v):y&&y.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var E=t.rotation;if((void 0!==E||void 0!==e._rotation)&&s)if(e._rotation=E,E=E||0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+E+" "+s.x+" "+s.y+")");else{var T=this.symbolMetrics[g.id];e.firstChild.setAttributeNS(null,"transform","rotate("+E+" "+T[1]+" "+T[2]+")")}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*l),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),r=(t.x-this.featureDx)/n+this.left,o=this.top-t.y/n;return!!this.inValidRange(r,o)&&(e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",o),e.setAttributeNS(null,"r",i),e)},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawPolygon:function(e,t){for(var i,n,r="",o=!0,s=!0,a=0,l=t.components.length;a<l;a++)r+=" M",i=this.getComponentsString(t.components[a].components," "),n=i.path,n?(r+=" "+n,s=i.complete&&s):o=!1;return r+=" z",!!o&&(e.setAttributeNS(null,"d",r),e.setAttributeNS(null,"fill-rule","evenodd"),s?e:null)},drawRectangle:function(e,t){var i=this.getResolution(),n=(t.x-this.featureDx)/i+this.left,r=this.top-t.y/i;return!!this.inValidRange(n,r)&&(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",r),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e)},drawText:function(e,t,i){var n=!!t.labelOutlineWidth;if(n){var r=OpenLayers.Util.extend({},t);r.fontColor=r.labelOutlineColor,r.fontStrokeColor=r.labelOutlineColor,r.fontStrokeWidth=t.labelOutlineWidth,t.labelOutlineOpacity&&(r.fontOpacity=t.labelOutlineOpacity),delete r.labelOutlineWidth,this.drawText(e,r,i)}var o=this.getResolution(),s=(i.x-this.featureDx)/o+this.left,a=i.y/o-this.top,l=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+l,"text");u.setAttributeNS(null,"x",s),u.setAttributeNS(null,"y",-a),t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(u.setAttributeNS(null,"pointer-events","visible"),u._featureId=e):u.setAttributeNS(null,"pointer-events","none");var c=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[0]]||"middle"),OpenLayers.IS_GECKO===!0&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[1]]||"central");for(var h=t.label.split("\n"),d=h.length;u.childNodes.length>d;)u.removeChild(u.lastChild);for(var p=0;p<d;p++){var f=this.nodeFactory(e+l+"_tspan_"+p,"tspan");if(t.labelSelect===!0&&(f._featureId=e,f._geometry=i,f._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[c[1]]||"-35%"),f.setAttribute("x",s),0==p){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[c[1]];null==m&&(m=-.5),f.setAttribute("dy",m*(d-1)+"em")}else f.setAttribute("dy","1em");f.textContent=""===h[p]?" ":h[p],f.parentNode||u.appendChild(f)}u.parentNode||this.textRoot.appendChild(u)},getComponentsString:function(e,t){for(var i,n,r=[],o=!0,s=e.length,a=[],l=0;l<s;l++)n=e[l],r.push(n),i=this.getShortString(n),i?a.push(i):(l>0&&this.getShortString(e[l-1])&&a.push(this.clipLine(e[l],e[l-1])),l<s-1&&this.getShortString(e[l+1])&&a.push(this.clipLine(e[l],e[l+1])),o=!1);return{path:a.join(t||","),complete:o}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),r=this.MAX_PIXEL-this.translationParameters.x,o=this.MAX_PIXEL-this.translationParameters.y,s=(t.x-this.featureDx)/n+this.left,a=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,u=this.top-e.y/n;return(l<-r||l>r)&&(i=(u-a)/(l-s),l=l<0?-r:r,u=a+(l-s)*i),(u<-o||u>o)&&(i=(l-s)/(u-a),u=u<0?-o:o,l=s+(u-a)*i),l+","+u},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left,n=this.top-e.y/t;return!!this.inValidRange(i,n)&&i+","+n},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");var r=this.nodeFactory(t,"symbol"),o=this.nodeFactory(null,"polygon");r.appendChild(o);for(var s,a,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),u=[],c=0;c<n.length;c+=2)s=n[c],a=n[c+1],l.left=Math.min(l.left,s),l.bottom=Math.min(l.bottom,a),l.right=Math.max(l.right,s),l.top=Math.max(l.top,a),u.push(s,",",a);o.setAttributeNS(null,"points",u.join(" "));var h=l.getWidth(),d=l.getHeight(),p=[l.left-h,l.bottom-d,3*h,3*d];return r.setAttributeNS(null,"viewBox",p.join(" ")),this.symbolMetrics[t]=[Math.max(h,d),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(r),r},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot?i.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(e){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t,i,n=e.documentElement,r=n.childNodes,o={layerDescriptions:[]},s=0;s<r.length;++s)if(t=r[s],i=t.nodeName,"LayerDescription"==i){var a=t.getAttribute("name"),l="",u="",c="";t.getAttribute("owsType")?(l=t.getAttribute("owsType"),u=t.getAttribute("owsURL")):""!=t.getAttribute("wfs")?(l="WFS",u=t.getAttribute("wfs")):""!=t.getAttribute("wcs")&&(l="WCS",u=t.getAttribute("wcs"));var h=t.getElementsByTagName("Query");h.length>0&&(c=h[0].getAttribute("typeName"),c||(c=h[0].getAttribute("typename")));var d={layerName:a,owsType:l,owsURL:u,typeName:c};o.layerDescriptions.push(d),o.length=o.layerDescriptions.length,o[o.length-1]=d}else if("ServiceException"==i){var p=new OpenLayers.Format.OGCExceptionReport;return{error:p.read(e)}}return o},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Control.TextButtonPanel=OpenLayers.Class(OpenLayers.Control.Panel,{vertical:!1,additionalClass:null,draw:function(){return OpenLayers.Control.Panel.prototype.draw.apply(this,arguments),this.setOrientationClass(),this.setAdditionalClass(),this.div},redraw:function(){OpenLayers.Control.Panel.prototype.redraw.apply(this,arguments),this.setOrientationClass()},setOrientationClass:function(){this.vertical?OpenLayers.Element.addClass(this.div,"vertical"):OpenLayers.Element.removeClass(this.div,"vertical")},setAdditionalClass:function(){this.additionalClass&&OpenLayers.Element.addClass(this.div,this.additionalClass)},CLASS_NAME:"OpenLayers.Control.TextButtonPanel"}),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop),""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t,i=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,i),r=parseInt(e/n);return t=r>5?5:r>2?2:1,t*n},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*e*i[t],r=1;if(this.geodesic===!0){var o=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,s=n/i.km;r=o/s,n*=r}var a,l;n>1e5?(a=this.topOutUnits,l=this.bottomOutUnits):(a=this.topInUnits,l=this.bottomInUnits);var u=n/i[a],c=n/i[l],h=this.getBarLen(u),d=this.getBarLen(c);u=h/i[t]*i[a],c=d/i[t]*i[l];var p=u/e/r,f=c/e/r;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(f)+"px",this.eBottom.innerHTML=d+" "+l),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(p)+"px",this.eTop.innerHTML=h+" "+a)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,n){this.url=e,this.size=t||{w:20,h:20},this.offset=i||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=n;var r=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(r)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var i=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=i:(this.icon.url=i.url,this.icon.size=i.size,this.icon.offset=i.offset,this.icon.calculateOffset=i.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,n,r,o){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=n&&(this.contentHTML=n),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var s=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(s,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),r&&this.addCloseBox(o),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,n=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv){var r=parseInt(this.closeDiv.style.width);i+=r+t.right}this.size.w+=i,this.size.h+=n,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),n=this.getSafeContentSize(i),r=null;if(n.equals(i))r=i;else{var o={w:n.w<i.w?n.w:null,h:n.h<i.h?n.h:null};if(o.w&&o.h)r=n;else{var s=OpenLayers.Util.getRenderedDimensions(e,o,{displayClass:this.contentDisplayClass,containerElement:t}),a=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=a&&s.equals(n)){var l=OpenLayers.Util.getScrollbarWidth();o.w?s.h+=l:s.w+=l}r=this.getSafeContentSize(s)}}this.setSize(r)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,n=t.length;i<n;i++){var r=t[i];if(0==r.width||0==r.height){var o={popup:this,img:r};r._onImgLoad=OpenLayers.Function.bind(e,o),OpenLayers.Event.observe(r,"load",r._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),i=this.getContentDivPadding(),n=i.left+i.right,r=i.top+i.bottom;if(this.fixPadding(),n+=this.padding.left+this.padding.right,r+=this.padding.top+this.padding.bottom,this.closeDiv){var o=parseInt(this.closeDiv.style.width);n+=o+i.right}if(this.minSize&&(t.w=Math.max(t.w,this.minSize.w-n),t.h=Math.max(t.h,this.minSize.h-r)),this.maxSize&&(t.w=Math.min(t.w,this.maxSize.w-n),t.h=Math.min(t.h,this.maxSize.h-r)),this.map&&this.map.size){var s=0,a=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":s=l.x,a=this.map.size.h-l.y;break;case"tl":s=this.map.size.w-l.x,a=this.map.size.h-l.y;break;case"bl":s=this.map.size.w-l.x,a=l.y;break;case"br":s=l.x,a=l.y;break;default:s=l.x,a=this.map.size.h-l.y}}var u=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-r-a,c=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-s;t.w=Math.min(t.w,c),t.h=Math.min(t.h,u)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var n=t.x-i.x,r=t.y-i.y;this.map.pan(n,r)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,(!0)),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),e},cacheFeatures:function(e){this.paging||(this.clearCache(),this.features=e.features,this.pageNext(e))},clearCache:function(){if(this.features)for(var e=0;e<this.features.length;++e)this.features[e].destroy();this.features=null,this.num=null},pageCount:function(){var e=this.features?this.features.length:0;return Math.ceil(e/this.length)},pageNum:function(){return this.num},pageLength:function(e){return e&&e>0&&(this.length=e),this.length},pageNext:function(e){var t=!1;if(this.features){null===this.num&&(this.num=-1);var i=(this.num+1)*this.length;t=this.page(i,e)}return t},pagePrevious:function(){var e=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var t=(this.num-1)*this.length;e=this.page(t)}return e},page:function(e,t){var i=!1;if(this.features&&e>=0&&e<this.features.length){var n=Math.floor(e/this.length);if(n!=this.num){this.paging=!0;var r=this.features.slice(e,e+this.length);this.layer.removeFeatures(this.layer.features),this.num=n,t&&t.features?t.features=r:this.layer.addFeatures(r),this.paging=!1,i=!0}}return i},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,i,n,r,o,s){var a=[e,t,i,n,o,s];OpenLayers.Popup.prototype.initialize.apply(this,a),this.anchor=null!=r?r:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e)),this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),i=this.map.getExtent(),n=i.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(n)},updateRelativePosition:function(){},
calculateNewPx:function(e){var t=e.offset(this.anchor.offset),i=this.size||this.contentSize,n="t"==this.relativePosition.charAt(0);t.y+=n?-i.h:this.anchor.size.h;var r="l"==this.relativePosition.charAt(1);return t.x+=r?-i.w:this.anchor.size.w,t},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,i,n,r,o,s){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(e){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,o&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return t=t.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var i=this.positionBlocks[e],n=0;n<i.blocks.length;n++){var r={};this.blocks.push(r);var o=this.id+"_FrameDecorationDiv_"+n;r.div=OpenLayers.Util.createDiv(o,null,null,null,"absolute",null,"hidden",null);var s=this.id+"_FrameDecorationImg_"+n,a=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;r.image=a(s,null,this.imageSize,this.imageSrc,"absolute",null,null,null),r.div.appendChild(r.image),this.groupDiv.appendChild(r.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var i=e.blocks[t],n=this.blocks[t],r=i.anchor.left,o=i.anchor.bottom,s=i.anchor.right,a=i.anchor.top,l=isNaN(i.size.w)?this.size.w-(s+r):i.size.w,u=isNaN(i.size.h)?this.size.h-(o+a):i.size.h;n.div.style.width=(l<0?0:l)+"px",n.div.style.height=(u<0?0:u)+"px",n.div.style.left=null!=r?r+"px":"",n.div.style.bottom=null!=o?o+"px":"",n.div.style.right=null!=s?s+"px":"",n.div.style.top=null!=a?a+"px":"",n.image.style.left=i.position.x+"px",n.image.style.top=i.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,n=Math.abs(t-e.x),r=Math.abs(i-e.y),o=this.getBoxOffsets();this.zoomBox.style.width=n+o.width+1+"px",this.zoomBox.style.height=r+o.height+1+"px",this.zoomBox.style.left=(e.x<t?t-n-o.left:t-o.left)+"px",this.zoomBox.style.top=(e.y<i?i-r-o.top:i-o.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start,n=Math.min(i.y,e.y),r=Math.max(i.y,e.y),o=Math.min(i.x,e.x),s=Math.max(i.x,e.x);t=new OpenLayers.Bounds(o,r,s,n)}else t=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),o=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:i,right:n,top:r,bottom:o,width:t===!1?i+n:0,height:t===!1?r+o:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(this.out){var n=e.right-e.left,r=e.bottom-e.top,o=Math.min(this.map.size.h/r,this.map.size.w/n),s=this.map.getExtent(),a=this.map.getLonLatFromPixel(i),l=a.lon-s.getWidth()/2*o,u=a.lon+s.getWidth()/2*o,c=a.lat-s.getHeight()/2*o,h=a.lat+s.getHeight()/2*o;t=new OpenLayers.Bounds(l,c,u,h)}else{var d=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),p=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(d.lon,d.lat,p.lon,p.lat)}var f=this.map.getZoom(),m=this.map.getSize(),g={x:m.w/2,y:m.h/2},y=this.map.getZoomForExtent(t),v=this.map.getResolution(),E=this.map.getResolutionForZoom(y);if(v==E)this.map.setCenter(this.map.getLonLatFromPixel(i));else{var T={x:(v*i.x-E*g.x)/(v-E),y:(v*i.y-E*g.y)/(v-E)};this.map.zoomTo(y,T)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,n){i.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var i=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(i,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var i=this.map.getZoom(),n=i+t;n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i&&this.map.zoomTo(n,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var n=this.layer.styleMap&&this.layer.styleMap.styles.temporary;n&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":n})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){var t=new OpenLayers.Feature.Vector(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&(t.state=OpenLayers.State.INSERT,this.layer.addFeatures([t]),this.featureAdded(t),this.events.triggerEvent("featureadded",{feature:t}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,i,n=this.point.geometry,r=this.control.layer.features,o=r.length-1;o>=0;--o)if(t=r[o].geometry,(t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(n)){i=r[o],this.control.layer.removeFeatures([i],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),i.geometry.addComponent(this.line.geometry),this.polygon=i,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var n=i[i.length-3];t.x=n.x,t.y=n.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,n=i.length-2;n>=0;--n)if(e.intersects(i[n])){t=!1;break}if(t){e:for(var n=i.length-2;n>0;--n)for(var r=i[n].components,o=0,s=r.length;o<s;++o)if(e.containsPoint(r[o])){t=!1;break e}}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(e,t){OpenLayers.Control.Panel.prototype.initialize.apply(this,[t]),this.addControls([new OpenLayers.Control.Navigation]);var i=[new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(i)},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var n=this["read_"+i.nodeName];t=n?n.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var n=0,r=i.length;n<r;++n){var o=i[n],s=o.nodeName;o.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),a=this.getSiblingNodesByTagCriteria(o,this.featureIdentifier);if(a)for(var l=0;l<a.length;l++){var u=a[l],c=this.parseGeometry(u),h=this.parseAttributes(u),d=new OpenLayers.Feature.Vector(c.geometry,h,null);d.bounds=c.bounds,d.type=s,t.push(d)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,r=i.length;n<r;n++){var o,s=i[n],a=null,l={},u=s.attributes.length;if(u>0)for(o=0;o<u;o++){var c=s.attributes[o];l[c.nodeName]=c.nodeValue}else{var h=s.childNodes;for(o=0,u=h.length;o<u;++o){var d=h[o];3!=d.nodeType&&(l[d.getAttribute("name")]=d.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(a,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,n,r,o,s,a=[];if(e&&e.hasChildNodes()){i=e.childNodes,r=i.length;for(var l=0;l<r;l++){for(s=i[l];s&&1!=s.nodeType;)s=s.nextSibling,l++;n=s?s.nodeName:"",n.length>0&&n.indexOf(t)>-1?a.push(s):(o=this.getSiblingNodesByTagCriteria(s,t),o.length>0&&(0==a.length?a=o:a.push(o)))}}return a},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,n=i.length,r=0;r<n;++r){var o=i[r];if(1==o.nodeType){var s=o.childNodes,a=o.prefix?o.nodeName.split(":")[1]:o.nodeName;if(0==s.length)t[a]=null;else if(1==s.length||s[0].nodeValue.replace(this.regExes.trimSpace,"").length>0){var l=s[0];if(3==l.nodeType||4==l.nodeType){var u=l.wholeText?l.wholeText:l.nodeValue;t[a]=u.replace(this.regExes.trimSpace,"")}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),n=null;return i&&(t=i.geometry&&i.geometry.clone(),n=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var n=null,r=null;if(r="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof r.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(r,t))switch(t){case"Geometry":try{n=this.parseGeometry(r)}catch(o){OpenLayers.Console.error(o)}break;case"Feature":try{n=this.parseFeature(r),n.type="Feature"}catch(o){OpenLayers.Console.error(o)}break;case"FeatureCollection":switch(n=[],r.type){case"Feature":try{n.push(this.parseFeature(r))}catch(o){n=null,OpenLayers.Console.error(o)}break;case"FeatureCollection":for(var s=0,a=r.features.length;s<a;++s)try{n.push(this.parseFeature(r.features[s]))}catch(o){n=null,OpenLayers.Console.error(o)}break;default:try{var l=this.parseGeometry(r);n.push(new OpenLayers.Feature.Vector(l))}catch(o){n=null,OpenLayers.Console.error(o)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)==-1?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,n,r;n=e.properties?e.properties:{},r=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(o){throw o}return t=new OpenLayers.Feature.Vector(i,n),r&&(t.bounds=OpenLayers.Bounds.fromArray(r)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var n=e.geometries.length,r=new Array(n),o=0;o<n;++o)r[o]=this.parseGeometry.apply(this,[e.geometries[o]]);t=new OpenLayers.Geometry.Collection(r),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(s){throw s}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,n=0,r=e.length;n<r;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,n=0,r=e.length;n<r;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,n=0,r=e.length;n<r;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,n=[],r=0,o=e.length;r<o;++r){try{i=this.parseCoords.linestring.apply(this,[e[r]])}catch(s){throw s}t=new OpenLayers.Geometry.LinearRing(i.components),n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],i=null,n=0,r=e.length;n<r;++n){try{i=this.parseCoords.polygon.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var n=e.length;i.features=new Array(n);for(var r=0;r<n;++r){var o=e[r];if(!o instanceof OpenLayers.Feature.Vector){var s="FeatureCollection only supports collections of features: "+o;throw s}i.features[r]=this.extract.feature.apply(this,[o])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var n=parseInt(t.substring(t.indexOf(":")+1));i=4326==n?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+n}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t,i=e.CLASS_NAME.split(".")[2],n=this.extract[i.toLowerCase()].apply(this,[e]);return t="Collection"==i?{type:"GeometryCollection",geometries:n}:{type:i,coordinates:n}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),n=0;n<t;++n)i[n]=this.extract.geometry.apply(this,[e.components[n]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(i.status>=200&&i.status<300){var n=this.parseResponse(i,t.readOptions);n&&n.success!==!1?(t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,n):e.features=n,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=n)}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||i.length<=0)return null;var n=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t);if(!this.featureNS){var r=this.readFormat||this.format;this.featureNS=r.featureNS,r.autoConfig=!1,this.geometryName||this.setGeometryName(r.geometryName)}return n},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,n=i.responseXML;n&&n.documentElement||(n=i.responseText);var r=this.format.read(n)||{};e.insertIds=r.insertIds||[],r.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=r),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),n=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var r=this.format.writeNode("ogc:Filter",e);n.appendChild(r),i.appendChild(n);var o=OpenLayers.Format.XML.prototype.write.apply(this.format,[i]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:o})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.priority=OpenLayers.String.trim(i))},VendorOption:function(e,t){t.vendorOptions||(t.vendorOptions={}),t.vendorOptions[e.getAttribute("name")]=this.getChildValue(e)},TextSymbolizer:function(e,t){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var i=this.multipleSymbolizers?t.symbolizers[t.symbolizers.length-1]:t.symbolizer.Text;void 0===i.graphic&&(i.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Priority",e)},VendorOption:function(e){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:e.name},value:e.value})},TextSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.TextSymbolizer.apply(this,arguments);return e.graphic!==!1&&(e.externalGraphic||e.graphicName)&&this.writeNode("Graphic",e,i),"priority"in e&&this.writeNode("Priority",e.priority,i),this.addVendorOptions(i,e)},PointSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)},LineSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)},
PolygonSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(e,t){var i=t.vendorOptions;if(i)for(var n in t.vendorOptions)this.writeNode("VendorOption",{name:n,value:t.vendorOptions[n]},e);return e},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Protocol.CSW=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.CSW.DEFAULTS);var t=OpenLayers.Protocol.CSW["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSW version: "+e.version;return new t(e)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,n=e.contents,r=(n.layers,0),o=n.layers.length;r<o;++r)if(n.layers[r].identifier===t.layer){i=n.layers[r];break}if(!i)throw new Error("Layer not found");var s=t.format;!s&&i.formats&&i.formats.length&&(s=i.formats[0]);var a;if(t.matrixSet)a=n.tileMatrixSets[t.matrixSet];else if(t.projection){for(var r=0,l=i.tileMatrixSetLinks.length;r<l;r++)if(n.tileMatrixSets[i.tileMatrixSetLinks[r].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===t.projection){a=n.tileMatrixSets[i.tileMatrixSetLinks[r].tileMatrixSet];break}}else i.tileMatrixSetLinks.length>=1&&(a=n.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]);if(!a)throw new Error("matrixSet not found");for(var u,r=0,o=i.styles.length;r<o&&(u=i.styles[r],!u.isDefault);++r);var c=t.requestEncoding;if(!c&&(c="KVP",e.operationsMetadata.GetTile.dcp.http)){var h=e.operationsMetadata.GetTile.dcp.http;if(h.get[0].constraints){var d=h.get[0].constraints,p=d.GetEncoding.allowedValues;p.KVP||!p.REST&&!p.RESTful||(c="REST")}}var f=[],m=t.params||{};delete t.params;for(var g=0,y=i.dimensions.length;g<y;g++){var v=i.dimensions[g];f.push(v.identifier),m.hasOwnProperty(v.identifier)||(m[v.identifier]=v["default"])}for(var E,T,b,C=t.projection||a.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),O=t.units||("EPSG:4326"===C?"degrees":"m"),x=[],w=[],R=i.tileMatrixSetLinks,L=function(e){x.push(28e-5*e/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[O]),(!E||E>e)&&(E=e),(!T||T<e)&&(T=e)},S=0,l=R.length;S<l;S++)if(b=R[S],b.tileMatrixSet===a.identifier){if(b.tileMatrixSetLimits){for(var _,I={},D=0,M=a.matrixIds.length;D<M;D++)I[a.matrixIds[D].identifier]=a.matrixIds[D];for(var D=0,M=b.tileMatrixSetLimits.length;D<M;D++)_=I[b.tileMatrixSetLimits[D].tileMatrix],w.push(_),L(_.scaleDenominator)}else for(var D=0,M=a.matrixIds.length;D<M;D++)L(a.matrixIds[D].scaleDenominator);break}var A;if("REST"===c&&i.resourceUrls){A=[];for(var N,P=(i.resourceUrls,0),k=i.resourceUrls.length;P<k;++P)N=i.resourceUrls[P],N.format===s&&"tile"===N.resourceType&&A.push(N.template)}else{var H=e.operationsMetadata.GetTile.dcp.http.get;A=[];for(var F,r=0,o=H.length;r<o;r++)F=H[r].constraints,(!F||F&&F.GetEncoding.allowedValues[c])&&A.push(H[r].url)}x.sort(function(e,t){return t-e});var B=OpenLayers.Util.applyDefaults(t,{url:A,requestEncoding:c,name:i.title,style:u&&u.identifier||"",format:s,matrixIds:w.length?w:a.matrixIds,matrixSet:a.identifier,projection:C,units:O,tileFullExtent:a.bounds,dimensions:f,params:m,resolutions:t.isBaseLayer===!1?void 0:x,serverResolutions:x,minScale:1/Math.ceil(T),maxScale:1/Math.floor(E)});return new OpenLayers.Layer.WMTS(B)},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var e,t=OpenLayers.Layer.Google.cache[this.map.id];if(t)e=t.mapObject,++t.count;else{var i=this.map.getCenter(),n=document.createElement("div");n.className="olForeignContainer",n.style.width="100%",n.style.height="100%",e=new google.maps.Map(n,{center:i?new google.maps.LatLng(i.lat,i.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,tilt:this.useTiltImages?45:0});var r=document.createElement("div");r.style.width="100%",r.style.height="100%",e.controls[google.maps.ControlPosition.TOP_LEFT].push(r),t={googleControl:r,mapObject:e,count:1},OpenLayers.Layer.Google.cache[this.map.id]=t}this.mapObject=e,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id],i=this.map;if(t){for(var n,r=this.type,o=i.layers,s=o.length-1;s>=0;--s)if(n=o[s],n instanceof OpenLayers.Layer.Google&&n.visibility===!0&&n.inRange===!0){r=n.type,e=!0;break}var a=this.mapObject.getDiv();if(e===!0){if(a.parentNode!==i.div){if(t.rendered)t.googleControl.appendChild(i.viewPortDiv);else{a.style.visibility="hidden";var l=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){t.rendered=!0,a.style.visibility="",l.setGMapVisibility(!0),l.moveTo(l.map.getCenter()),t.googleControl.appendChild(i.viewPortDiv),l.setGMapVisibility(l.visible)})}i.div.appendChild(a),google.maps.event.trigger(this.mapObject,"resize")}this.mapObject.setMapTypeId(r)}else t.googleControl.hasChildNodes()&&(i.div.appendChild(i.viewPortDiv),i.div.contains(a)&&i.div.removeChild(a))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),n=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lon),new google.maps.LatLng(n.lat,n.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize(),i=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),n=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),r=this.map.getResolution(),o=e.x-t.w/2,s=e.y-t.h/2,a=new OpenLayers.LonLat(i+o*r,n-s*r);return this.wrapDateLine&&(a=a.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(a.lon,a.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e),i=this.getLatitudeFromMapObjectLonLat(e),n=this.map.getResolution(),r=this.map.getExtent();return this.getMapObjectPixelFromXY(1/n*(t-r.left),1/n*(r.top-i))},setMapObjectCenter:function(e,t){if(this.animationEnabled===!1&&t!=this.mapObject.zoom){var i=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){i.style.visibility=""}),i.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var n=this.inverseMercator(e,t);i=new google.maps.LatLng(n.lat,n.lon)}else i=new google.maps.LatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)}},OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,n;e=e.replace(/[\n\r]/g," ");var r=this.regExes.typeStr.exec(e);if(r&&(i=r[1].toLowerCase(),n=r[2],this.parse[i]&&(t=this.parse[i].apply(this,[n])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var o=0,s=t.length;o<s;o++){var a=t[o];a.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,n;e.constructor==Array?(t=e,n=!0):(t=[e],n=!1);var r=[];n&&r.push("GEOMETRYCOLLECTION(");for(var o=0,s=t.length;o<s;++o)n&&o>0&&r.push(","),i=t[o].geometry,r.push(this.extractGeometry(i));return n&&r.push(")"),r.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),n=i+"("+this.extract[t].apply(this,[e])+")";return n},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(n))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],n=0,r=t.length;n<r;++n)i.push(this.parse.point.apply(this,[t[n]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(n))},polygon:function(e){for(var t,i,n,r=OpenLayers.String.trim(e).split(this.regExes.parenComma),o=[],s=0,a=r.length;s<a;++s)t=r[s].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,n=new OpenLayers.Geometry.LinearRing(i.components),o.push(n);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(o))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(n))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],n=0,r=t.length;n<r;++n)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[n]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(e){if(e=e||{},this.description){if(e.callback){var t=this.description;window.setTimeout(function(){e.callback.call(e.scope,t)},0)}}else this.client.describeProcess(this.server,this.identifier,function(t){this.description||this.parseDescription(t),e.callback&&e.callback.call(e.scope,this.description)},this)},configure:function(e){return this.describe({callback:function(){var t,i,n,r=this.description,o=e.inputs;for(i=0,n=r.dataInputs.length;i<n;++i)t=r.dataInputs[i],this.setInputData(t,o[t.identifier]);e.callback&&e.callback.call(e.scope)},scope:this}),this},execute:function(e){this.configure({inputs:e.inputs,callback:function(){var t=this,i=this.getOutputIndex(t.description.processOutputs,e.output);t.setResponseForm({outputIndex:i}),function n(){return OpenLayers.Util.removeItem(t.executeCallbacks,n),0!==t.chained?void t.executeCallbacks.push(n):void OpenLayers.Request.POST({url:t.client.servers[t.server].url,data:(new OpenLayers.Format.WPSExecute).write(t.description),success:function(n){var r,o=t.description.processOutputs[i];if(o.literalOutput)r="boolean"===o.literalOutput.dataType?"true"===OpenLayers.String.trim(n.responseText).toLowerCase():"double"===o.literalOutput.dataType?parseFloat(n.responseText):n.responseText;else if(o.complexOutput){var s=t.findMimeType(o.complexOutput.supported.formats);r=t.formats[s].read(n.responseText),r instanceof OpenLayers.Feature.Vector&&(r=[r])}if(e.success){var a={};a[e.output||"result"]=r,e.success.call(e.scope,a)}},scope:t})}()},scope:this})},output:function(e){return new OpenLayers.WPSProcess.ChainLink({process:this,output:e})},parseDescription:function(e){var t=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(t.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(e,t){if(delete e.data,delete e.reference,t instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,e.reference={method:"POST",href:t.process.server===this.server?this.localWPS:this.client.servers[t.process.server].url},t.process.describe({callback:function(){--this.chained,this.chainProcess(e,t)},scope:this});else{e.data={};var i=e.complexData;if(i){var n=this.findMimeType(i.supported.formats);e.data.complexData={mimeType:n,value:this.formats[n].write(this.toFeatures(t))}}else e.data.literalData={value:t}}},setResponseForm:function(e){e=e||{};var t,i=this.description.processOutputs[e.outputIndex||0];i.complexOutput&&(t=this.findMimeType(i.complexOutput.supported.formats,e.supportedFormats)),this.description.responseForm={rawDataOutput:{identifier:i.identifier,mimeType:t}}},getOutputIndex:function(e,t){var i;if(t){for(var n=e.length-1;n>=0;--n)if(e[n].identifier===t){i=n;break}}else i=0;return i},chainProcess:function(e,t){var i=this.getOutputIndex(t.process.description.processOutputs,t.output);e.reference.mimeType=this.findMimeType(e.complexData.supported.formats,t.process.description.processOutputs[i].complexOutput.supported.formats);var n={};for(n[e.reference.mimeType]=!0,t.process.setResponseForm({outputIndex:i,supportedFormats:n}),e.reference.body=t.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(e){var t=OpenLayers.Util.isArray(e);t||(e=[e]);for(var i,n=new Array(e.length),r=0,o=e.length;r<o;++r)i=e[r],n[r]=i instanceof OpenLayers.Feature.Vector?i:new OpenLayers.Feature.Vector(i);return t?n:n[0]},findMimeType:function(e,t){t=t||this.formats;for(var i in e)if(i in t)return i},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(e){OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.servers={};for(var t in e.servers)this.servers[t]="string"==typeof e.servers[t]?{url:e.servers[t],version:this.version,processDescription:{}}:e.servers[t]},execute:function(e){var t=this.getProcess(e.server,e.process);t.execute({inputs:e.inputs,success:e.success,scope:e.scope})},getProcess:function(e,t,i){var n=new OpenLayers.WPSProcess({client:this,server:e,identifier:t});return this.lazy||n.describe(i),n},describeProcess:function(e,t,i,n){var r=this.servers[e];r.processDescription[t]?window.setTimeout(function(){i.call(n,r.processDescription[t])},0):t in r.processDescription?this.events.register("describeprocess",this,function o(e){e.identifier===t&&(this.events.unregister("describeprocess",this,o),i.call(n,e.raw))}):(r.processDescription[t]=null,OpenLayers.Request.GET({url:r.url,params:{SERVICE:"WPS",VERSION:r.version,REQUEST:"DescribeProcess",IDENTIFIER:t},success:function(e){r.processDescription[t]=e.responseText,this.events.triggerEvent("describeprocess",{identifier:t,raw:e.responseText}),i.call(n,e.responseText)},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.Format.Filter.v2_0_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v2,{VERSION:"2.0.0",schemaLocation:"http://schemas.opengis.net/filter/2.0/filterAll.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{fes:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),r=e.getAttribute("singleChar"),o=e.getAttribute("escapeChar");i.value2regex(n,r,o),t.filters.push(i)}},OpenLayers.Format.Filter.v2.prototype.readers.fes),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{fes:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("fes:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("fes:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("ValueReference",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("fes:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("ValueReference",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("fes:BBOX");e.property&&this.writeNode("ValueReference",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("fes:SortBy"),i=0,n=e.length;i<n;i++)this.writeNode("fes:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("fes:SortProperty");return this.writeNode("fes:ValueReference",e,t),this.writeNode("fes:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("fes:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v2.prototype.writers.fes),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("fes:"+t);if(this.writeNode("ValueReference",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v2_0_0"}),OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(e,t,i){this.bounds=e,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(t,i)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(e,t){e||(e="red"),t||(t=2),this.div.style.border=t+"px solid "+e},draw:function(e,t){return OpenLayers.Util.modifyDOMElement(this.div,null,e,t),this.div},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsBounds(this.bounds,!0,!0)}return e},display:function(e){this.div.style.display=e?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(e){e=e||{},e.extractStyles!==!1&&(e.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){for(var t,i=e.split("\n"),n=[],r=0;r<i.length-1;r++){var o=i[r].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=o.charAt(0))if(t){for(var s=o.split("\t"),a=new OpenLayers.Geometry.Point(0,0),l={},u=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,c=!1,h=0;h<s.length;h++)if(s[h])if("point"==t[h]){var d=s[h].split(",");a.y=parseFloat(d[0]),a.x=parseFloat(d[1]),c=!0}else if("lat"==t[h])a.y=parseFloat(s[h]),c=!0;else if("lon"==t[h])a.x=parseFloat(s[h]),c=!0;else if("title"==t[h])l.title=s[h];else if("image"==t[h]||"icon"==t[h]&&u)u.externalGraphic=s[h];else if("iconSize"==t[h]&&u){var p=s[h].split(",");u.graphicWidth=parseFloat(p[0]),u.graphicHeight=parseFloat(p[1])}else if("iconOffset"==t[h]&&u){var f=s[h].split(",");u.graphicXOffset=parseFloat(f[0]),u.graphicYOffset=parseFloat(f[1])}else"description"==t[h]?l.description=s[h]:"overflow"==t[h]?l.overflow=s[h]:l[t[h]]=s[h];if(c){this.internalProjection&&this.externalProjection&&a.transform(this.externalProjection,this.internalProjection);var m=new OpenLayers.Feature.Vector(a,l,u);n.push(m)}}else t=o.split("\t")}return n},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(e,t){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var e=function(e){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:e,scope:this}),this.loaded=!0}},moveTo:function(e,t,i){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(e){var t=e.responseText,i={};OpenLayers.Util.extend(i,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());for(var n=new OpenLayers.Format.Text(i),r=n.read(t),o=0,s=r.length;o<s;o++){var a,l,u,c={},h=r[o];a=new OpenLayers.LonLat(h.geometry.x,h.geometry.y),h.style.graphicWidth&&h.style.graphicHeight&&(l=new OpenLayers.Size(h.style.graphicWidth,h.style.graphicHeight)),void 0!==h.style.graphicXOffset&&void 0!==h.style.graphicYOffset&&(u=new OpenLayers.Pixel(h.style.graphicXOffset,h.style.graphicYOffset)),null!=h.style.externalGraphic?c.icon=new OpenLayers.Icon(h.style.externalGraphic,l,u):(c.icon=OpenLayers.Marker.defaultIcon(),null!=l&&c.icon.setSize(l)),null!=h.attributes.title&&null!=h.attributes.description&&(c.popupContentHTML="<h2>"+h.attributes.title+"</h2><p>"+h.attributes.description+"</p>"),c.overflow=h.attributes.overflow||"auto";var d=new OpenLayers.Feature(this,a,c);this.features.push(d);var p=d.createMarker();null!=h.attributes.title&&null!=h.attributes.description&&p.events.register("click",d,this.markerClick),this.addMarker(p)}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;i<n;i++)this.layer.map.removePopup(this.layer.map.popups[i]);t||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Format.WCSDescribeCoverage.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSDescribeCoverage.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1",owsesri:"http://www.opengis.net/ows"},readers:{wcs:{CoverageDescriptions:function(e,t){t.coverageDescriptions={},this.readChildNodes(e,t.coverageDescriptions),t.coverageDescriptionKeys=[];for(var i in t.coverageDescriptions)t.coverageDescriptionKeys.push(i)},CoverageDescription:function(e,t){var i={};this.readChildNodes(e,i),t[i.identifier]=i,i.nativeCRS=i.domain.spatialDomain.gridCRS.gridBaseCRS},Identifier:function(e,t){t.identifier=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Domain:function(e,t){t.domain={},this.readChildNodes(e,t.domain)},SpatialDomain:function(e,t){t.spatialDomain={boundingBoxes:{}};var i={BoundingBox:[]};this.readChildNodes(e,i);for(var n=0,r=i.BoundingBox.length;n<r;n++)i.BoundingBox[n].crs&&(t.spatialDomain.boundingBoxes[i.BoundingBox[n].crs]=i.BoundingBox[n].bounds);t.spatialDomain.gridCRS=i.gridCRS},GridCRS:function(e,t){t.gridCRS={},this.readChildNodes(e,t.gridCRS)},GridBaseCRS:function(e,t){t.gridBaseCRS=this.getChildValue(e)},GridType:function(e,t){t.gridType=this.getChildValue(e)},GridOrigin:function(e,t){var i=this.getChildValue(e).split(" ");2==i.length&&(t.gridOrigin={},t.gridOrigin.x=Number(i[0]),t.gridOrigin.y=Number(i[1]))},GridOffsets:function(e,t){var i=this.getChildValue(e).split(" ");2==i.length&&(t.gridOffsets={},t.gridOffsets.x=Number(i[0]),t.gridOffsets.y=Number(i[1]))},GridCS:function(e,t){t.gridCS=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRSs||(t.supportedCRSs=[]);var i=this.getChildValue(e);t.supportedCRSs.push(i)},SupportedFormat:function(e,t){t.supportedFormats||(t.supportedFormats=[]);var i=this.getChildValue(e);t.supportedFormats.push(i)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows,owsesri:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage.v1_1_0"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,template:"Scale = 1 : ${scaleDenom}",initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.element=OpenLayers.Util.getElement(e)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var e;if(this.geodesic===!0){var t=this.map.getUnits();if(!t)return;var i=OpenLayers.INCHES_PER_UNIT;e=(this.map.getGeodesicPixelSize().w||1e-6)*i.km*OpenLayers.DOTS_PER_INCH}else e=this.map.getScale();if(e){e=e>=9500&&e<=95e4?Math.round(e/1e3)+"K":e>=95e4?Math.round(e/1e6)+"M":Math.round(e);var n=OpenLayers.i18n(this.template,{scaleDenom:e});this.element.innerHTML=n}},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(e){e=e||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[e.name,e])},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),e.events.register("moveend",this,this.onMoveEnd)},removeMap:function(e){e.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(e){this.ratio=e,this.updateGrid(!0)},setMaxFeatures:function(e){this.maxFeatures=e,this.updateGrid(!0)},setSpacing:function(e,t){this.dx=e,this.dy=t||e,this.updateGrid(!0)},setOrigin:function(e){this.origin=e,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(e){this.rotation=e,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var e=this.map.getExtent();if(this.rotation){var t=this.getOrigin(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),n=e.toGeometry();n.rotate(-this.rotation,i),e=n.getBounds()}return e},updateGrid:function(e){if(e||this.invalidBounds()){var t=this.getViewBounds(),i=this.getOrigin(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),r=t.getWidth(),o=t.getHeight(),s=r/o,a=Math.sqrt(this.dx*this.dy*this.maxFeatures/s),l=a*s,u=Math.min(r*this.ratio,l),c=Math.min(o*this.ratio,a),h=t.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(h.lon-u/2,h.lat-c/2,h.lon+u/2,h.lat+c/2);for(var d,p,f,m=Math.floor(c/this.dy),g=Math.floor(u/this.dx),y=i.lon+this.dx*Math.ceil((this.gridBounds.left-i.lon)/this.dx),v=i.lat+this.dy*Math.ceil((this.gridBounds.bottom-i.lat)/this.dy),E=new Array(m*g),T=0;T<g;++T){d=y+T*this.dx;for(var b=0;b<m;++b)p=v+b*this.dy,f=new OpenLayers.Geometry.Point(d,p),this.rotation&&f.rotate(this.rotation,n),E[T*m+b]=new OpenLayers.Feature.Vector(f)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(E,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(e,t,i,n){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),null!=n&&null!=n.isBaseLayer||(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),n&&null!=n.useOverlay&&(this.useOverlay=n.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),
this.setTileSize(this.defaultSize))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t,i=e.getCenterLonLat(),n=this.map.getSize();if(this.singleTile){var r={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:n.h*this.ratio,setdisplaywidth:n.w*this.ratio,setviewcenterx:i.lon,setviewcentery:i.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var o={};o=OpenLayers.Util.extend(o,r),o.operation="GETVISIBLEMAPEXTENT",o.version="1.0.0",o.session=this.params.session,o.mapName=this.params.mapName,o.format="text/xml",t=this.getFullRequestString(o),OpenLayers.Request.GET({url:t,async:!1})}t=this.getFullRequestString(r)}else{var s=this.map.getResolution(),a=Math.floor((e.left-this.maxExtent.left)/s);a=Math.round(a/this.tileSize.w);var l=Math.floor((this.maxExtent.top-e.top)/s);l=Math.round(l/this.tileSize.h),t=this.useHttpTile?this.getImageFilePath({tilecol:a,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:a,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1})}return t},getFullRequestString:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var n=i,r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var o=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var s in r)s.toUpperCase()in o&&delete r[s];var a=OpenLayers.Util.getParameterString(r);if(a=a.replace(/,/g,"+"),""!=a){var l=i.charAt(i.length-1);n+="&"==l||"?"==l?a:i.indexOf("?")==-1?"?"+a:"&"+a}return n},getImageFilePath:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var n=i,r="",o="";e.tilerow<0&&(r="-"),r+=0==e.tilerow?"0":Math.floor(Math.abs(e.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,e.tilecol<0&&(o="-"),o+=0==e.tilecol?"0":Math.floor(Math.abs(e.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var s="/S"+Math.floor(e.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+r+"/C"+o+"/"+e.tilerow%this.params.tileRowsPerFolder+"_"+e.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(s+="?"+this.params.querystring),n+=s},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){this.immediate=e,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&this.deactivate(),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var i,n;e.CLASS_NAME.indexOf("LineString")>-1?(i=this.getBestLength(e),n=1):(i=this.getBestArea(e),n=2),this.events.triggerEvent(t,{measure:i[0],units:i[1],order:n,geometry:e})},getBestArea:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],r=0,o=n.length;r<o&&(t=n[r],i=this.getArea(e,t),!(i>1));++r);return[i,t]},getArea:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),n="m"):(i=e.getArea(),n=this.map.getUnits());var r=OpenLayers.INCHES_PER_UNIT[t];if(r){var o=OpenLayers.INCHES_PER_UNIT[n];i*=Math.pow(o/r,2)}return i},getBestLength:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],r=0,o=n.length;r<o&&(t=n[r],i=this.getLength(e,t),!(i>1));++r);return[i,t]},getLength:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),n="m"):(i=e.getLength(),n=this.map.getUnits());var r=OpenLayers.INCHES_PER_UNIT[t];if(r){var o=OpenLayers.INCHES_PER_UNIT[n];i*=o/r}return i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])},read_wmc_SRS:function(e,t){var i=this.getChildValue(t);"object"!=typeof e.projections&&(e.projections={});for(var n=i.split(/ +/),r=0,o=n.length;r<o;r++)e.projections[n[r]]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.srs){var i=[];for(var n in e.srs)i.push(n);t.appendChild(this.createElementDefaultNS("SRS",i.join(" ")))}t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrixSetLimits:function(e,t){t.tileMatrixSetLimits=[],this.readChildNodes(e,t)},TileMatrixLimits:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLimits.push(i)},MinTileRow:function(e,t){t.minTileRow=parseInt(this.getChildValue(e))},MaxTileRow:function(e,t){t.maxTileRow=parseInt(this.getChildValue(e))},MinTileCol:function(e,t){t.minTileCol=parseInt(this.getChildValue(e))},MaxTileCol:function(e,t){t.maxTileCol=parseInt(this.getChildValue(e))},TileMatrix:function(e,t){if(t.identifier){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)}else t.tileMatrix=this.getChildValue(e)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,n=this.getChildValue(e),r=n.split(" ");if(t.supportedCRS){var o=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[o]}i?t.topLeftCorner=new OpenLayers.LonLat(r[1],r[0]):t.topLeftCorner=new OpenLayers.LonLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var n=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(n)},LegendURL:function(e,t){t.legends=t.legends||[];var i={format:e.getAttribute("format"),href:e.getAttribute("xlink:href")},n=e.getAttribute("width"),r=e.getAttribute("height"),o=e.getAttribute("minScaleDenominator"),s=e.getAttribute("maxScaleDenominator");null!==n&&(i.width=parseInt(n)),null!==r&&(i.height=parseInt(r)),null!==o&&(i.minScaleDenominator=parseInt(o)),null!==s&&(i.maxScaleDenominator=parseInt(s)),t.legends.push(i)},InfoFormat:function(e,t){t.infoFormats=t.infoFormats||[],t.infoFormats.push(this.getChildValue(e))},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t["default"]=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(e,t,i,n,r,o){this.lzd=i,this.zoomLevels=n;var s=[];s.push(e,t,r,o),OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var e=this.map.getZoom();this.map.getMaxExtent();return e-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(e){e=this.adjustBounds(e);var t=this.getZoom(),i=this.map.getMaxExtent(),n=this.lzd/Math.pow(2,this.getZoom()),r=Math.floor((e.left-i.left)/n),o=Math.floor((e.bottom-i.bottom)/n);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:t,X:r,Y:o}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel((-1238),0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,(-631))},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel((-1238),(-632))},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,(-688))}]},tr:{offset:new OpenLayers.Pixel((-45),0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel((-1238),0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,(-631))},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel((-1238),(-631))},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel((-215),(-687))}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel((-1238),0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,(-629))},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel((-1238),(-629))},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel((-101),(-674))}]},br:{offset:new OpenLayers.Pixel((-44),0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel((-1238),0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,(-629))},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel((-1238),(-629))},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel((-311),(-674))}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,i,n,r,o,s){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{gml:OpenLayers.Util.applyDefaults({name:function(e,t){t.name=this.getChildValue(e)},TimePeriod:function(e,t){t.timePeriod={},this.readChildNodes(e,t.timePeriod)},beginPosition:function(e,t){t.beginPosition=this.getChildValue(e)},endPosition:function(e,t){t.endPosition=this.getChildValue(e)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},this.readChildNodes(e,t.contents)},ObservationOfferingList:function(e,t){t.offeringList={},this.readChildNodes(e,t.offeringList)},ObservationOffering:function(e,t){var i=this.getAttributeNS(e,this.namespaces.gml,"id");t[i]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(e,t[i])},time:function(e,t){t.time={},this.readChildNodes(e,t.time)},procedure:function(e,t){t.procedures.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},observedProperty:function(e,t){t.observedProperties.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},featureOfInterest:function(e,t){t.featureOfInterestIds.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},responseFormat:function(e,t){t.responseFormats.push(this.getChildValue(e))},resultModel:function(e,t){t.resultModels.push(this.getChildValue(e))},responseMode:function(e,t){t.responseModes.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(e))this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){return!(this.started&&!OpenLayers.Event.isMultiTouch(e))||(this.started=!1,this.pinching=!1,this.callback("done",[e,this.start,this.last]),this.start=null,this.last=null,!1)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,e=!0),e},getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(t.olClientX-i.olClientX,2)+Math.pow(t.olClientY-i.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:i}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Format.WFST.v2_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v2_0_0,OpenLayers.Format.WFST.v1,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs/2.0",gml:"http://www.opengis.net/gml/3.2",fes:"http://www.opengis.net/fes/2.0",xmlns:"http://www.w3.org/2000/xmlns/"},version:"2.0.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/2.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v2_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberReturned=parseInt(e.getAttribute("numberReturned")),t.numberMatched=parseInt(e.getAttribute("numberMatched")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])},member:function(e,t){this.readChildNodes(e,t)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,fes:OpenLayers.Format.Filter.v2_0_0.prototype.readers.fes},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeNames:(e.featureNS?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,r=e.propertyNames.length;n<r;n++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("fes:Filter",e.filter,i)),i},Update:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS);var r=t.modified;null===this.geometryName||r&&void 0===r.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},n));for(var o in t.attributes)void 0===t.attributes[o]||r&&r.attributes&&!(r.attributes&&o in r.attributes)||this.writeNode("Property",{name:o,value:t.attributes[o]},n);return this.writeNode("fes:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("ValueReference",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})},ValueReference:function(e){return this.createElementNSPlus("wfs:ValueReference",{value:e})},Delete:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("fes:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,fes:OpenLayers.Format.Filter.v2_0_0.prototype.writers.fes},CLASS_NAME:"OpenLayers.Format.WFST.v2_0_0"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["//a.tile.openstreetmap.org/${z}/${x}/${y}.png","//b.tile.openstreetmap.org/${z}/${x}/${y}.png","//c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='//www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(e,t,i){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this})),e},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){return this.passesTolerance(e.xy)&&(this.clearTimer(),this.callback("move",[e]),this.px=e.xy,e=OpenLayers.Util.extend({},e),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)),!this.stopMove},mouseout:function(e){return OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[e])),!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),e=!0),e},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.ModifyFeature.BySegment={hoverTolerance:25,collectVertices:OpenLayers.Function.Void,setMap:function(e){OpenLayers.Control.ModifyFeature.prototype.setMap.apply(this,arguments),this.handlers.hover||(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.onHoverMove})),this.handlers.hover.setMap(e),this.layer.events.on({beforefeaturemodified:this.createSpatialIndex,afterfeaturemodified:this.deactivateHover,scope:this})},deactivateHover:function(){this.handlers.hover.deactivate()},destroy:function(){this.layer&&this.layer.events.un({beforefeaturemodified:this.createSpatialIndex,afterfeaturemodified:this.deactivateHover,scope:this}),OpenLayers.Control.ModifyFeature.prototype.destroy.apply(this,[])},dragStart:function(e){OpenLayers.Control.ModifyFeature.prototype.dragStart.apply(this,arguments),this.vertexGeom=e.geometry.clone(),this.handlers.drag.stopDown&&this.handlers.hover.deactivate()},dragComplete:function(e){this.updateSpatialIndex(e),OpenLayers.Control.ModifyFeature.prototype.dragComplete.apply(this,arguments),this.handlers.hover.activate()},onHoverMove:function(e){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);var t=e.xy,i=t.add(-this.hoverTolerance/2,this.hoverTolerance/2),n=t.add(this.hoverTolerance/2,-this.hoverTolerance/2),r=this.map.getLonLatFromPixel(i),o=this.map.getLonLatFromPixel(n),s=this.tree.search([r.lon,r.lat,o.lon,o.lat]);if(s.length>0){for(var a,l=this.map.getLonLatFromPixel(t),u=new OpenLayers.Geometry.Point(l.lon,l.lat),c=Number.MAX_VALUE,h=0,d=s.length;h<d;++h){var p=s[h],f=OpenLayers.Geometry.distanceSquaredToSegment(u,{x1:p.point1.x,x2:p.point2.x,y1:p.point1.y,y2:p.point2.y}).distance;f<c&&(a=p),c=f}var m=function(e){var t=new OpenLayers.Feature.Vector(e);t._sketch=!0,t.renderIntent=this.vertexRenderIntent,this.vertices.push(t)};m.call(this,a.point1),m.call(this,a.point2);var g=this.createVirtualVertex(a.point1,a.point2);g._previous=a.point1,g._next=a.point2,g._index=-1,g.geometry.parent=a.point1.parent,this.virtualVertices.push(g)}this.layer.addFeatures(this.vertices,{silent:!0}),this.layer.addFeatures(this.virtualVertices,{silent:!0})},createSpatialIndex:function(e){function t(e){var i,r,o;if("OpenLayers.Geometry.Point"!==e.CLASS_NAME){var s=e.components.length;for("OpenLayers.Geometry.LinearRing"!=e.CLASS_NAME&&"OpenLayers.Geometry.LineString"!=e.CLASS_NAME||(s-=1),o=e.components[0],i=1;i<=s;++i)if(r=o,o=e.components[i],"OpenLayers.Geometry.Point"==r.CLASS_NAME){var a=this.createBBOX(r,o);a.point1=r,a.point2=o,n.push(a)}else t.call(this,r)}}var i=e.feature,n=[];t.call(this,i.geometry),this.tree=window.rbush(),this.tree.load(n),this.handlers.hover.activate()},createBBOX:function(e,t){return[e.x<t.x?e.x:t.x,e.y<t.y?e.y:t.y,e.x<t.x?t.x:e.x,e.y<t.y?t.y:e.y]},updateSpatialIndex:function(e){var t,i,n,r=this.tree.search([this.vertexGeom.x,this.vertexGeom.y,this.vertexGeom.x,this.vertexGeom.y]);if(e._previous)t=this.createBBOX(e._previous,e.geometry),t.point1=e._previous,t.point2=e.geometry,this.tree.insert(t),t=this.createBBOX(e.geometry,e._next),t.point1=e.geometry,t.point2=e._next,this.tree.insert(t),this.tree.remove(r[0]),delete e._next,delete e._previous;else for(i=0,n=r.length;i<n;++i){var o=r[i];this.vertexGeom.equals(o.point1)?(t=this.createBBOX(e.geometry,o.point2),t.point1=e.geometry,t.point2=o.point2):(t=this.createBBOX(e.geometry,o.point1),t.point1=o.point1,t.point2=e.geometry),this.tree.insert(t),this.tree.remove(o)}this.vertexGeom.destroy(),this.vertexGeom=null}},OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(e,t,i,n){var r=[];i=OpenLayers.Util.upperCaseObject(i),r.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.projection.getCode().split(":"),i=t[t.length-1],n=this.getImageSize(e),r={BBOX:e.toBBOX(),SIZE:n.w+","+n.h,F:"image",BBOXSR:i,IMAGESR:i};if(this.layerDefs){var o,s=[];for(o in this.layerDefs)this.layerDefs.hasOwnProperty(o)&&this.layerDefs[o]&&(s.push(o),s.push(":"),s.push(this.layerDefs[o]),s.push(";"));s.length>0&&(r.LAYERDEFS=s.join(""))}var a=this.getFullRequestString(r);return a},setLayerFilter:function(e,t){this.layerDefs||(this.layerDefs={}),t?this.layerDefs[e]=t:delete this.layerDefs[e]},clearLayerFilter:function(e){e?delete this.layerDefs[e]:delete this.layerDefs},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(e){e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.applyDefaults(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var e in this.handlers)this.handlers[e].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var e in this.handlers)this.handlers[e].deactivate();
return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(e){var t=this.pixelToBounds(e.xy);this.setModifiers(e),this.request(t,{single:this.single})},selectBox:function(e){var t;if(e instanceof OpenLayers.Bounds){var i=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),n=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(i.lon,i.lat,n.lon,n.lat)}else{if(this.click)return;t=this.pixelToBounds(e)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(t)},selectHover:function(e){var t=this.pixelToBounds(e.xy);this.request(t,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,t){t=t||{};var i=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var n=this.protocol.read({maxFeatures:1==t.single?this.maxFeatures:void 0,filter:i,callback:function(i){i.success()&&(i.features.length?1==t.single?this.selectBestFeature(i.features,e.getCenterLonLat(),t):this.select(i.features):t.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==t.hover&&(this.hoverResponse=n)},selectBestFeature:function(e,t,i){if(i=i||{},e.length){for(var n,r,o,s=new OpenLayers.Geometry.Point(t.lon,t.lat),a=Number.MAX_VALUE,l=0;l<e.length&&(n=e[l],!(n.geometry&&(o=s.distanceTo(n.geometry,{edge:!1}),o<a&&(a=o,r=n,0==a))));++l);1==i.hover?this.hoverSelect(r):this.select(r||e)}},setModifiers:function(e){this.modifiers={multiple:this.multiple||this.multipleKey&&e[this.multipleKey],toggle:this.toggle||this.toggleKey&&e[this.toggleKey]}},select:function(e){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(e)||(e=[e]);var t=this.events.triggerEvent("beforefeaturesselected",{features:e});if(t!==!1){for(var i,n=[],r=0,o=e.length;r<o;++r)i=e[r],this.features[i.fid||i.id]?this.modifiers.toggle&&this.unselect(this.features[i.fid||i.id]):(t=this.events.triggerEvent("beforefeatureselected",{feature:i}),t!==!1&&(this.features[i.fid||i.id]=i,n.push(i),this.events.triggerEvent("featureselected",{feature:i})));this.events.triggerEvent("featuresselected",{features:n})}},hoverSelect:function(e){var t=e?e.fid||e.id:null,i=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;i&&i!=t&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),t&&t!=i&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(e){delete this.features[e.fid||e.id],this.events.triggerEvent("featureunselected",{feature:e})},unselectAll:function(){for(var e in this.features)this.unselect(this.features[e])},setMap:function(e){for(var t in this.handlers)this.handlers[t].setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(e){var t=e.add(-this.clickTolerance/2,this.clickTolerance/2),i=e.add(this.clickTolerance/2,-this.clickTolerance/2),n=this.map.getLonLatFromPixel(t),r=this.map.getLonLatFromPixel(i);return new OpenLayers.Bounds(n.lon,n.lat,r.lon,r.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function e(e){return e=e.replace(/%/g,"\\%"),e=e.replace(/\\\\\.(\*)?/g,function(e,t){return t?e:"\\\\_"}),e=e.replace(/\\\\\.\*/g,"\\\\%"),e=e.replace(/(\\)?\.(\*)?/g,function(e,t,i){return t||i?e:"_"}),e=e.replace(/(\\)?\.\*/g,function(e,t){return t?e:"%"}),e=e.replace(/\\\./g,"."),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"*"})}var t={};return t[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",t[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",t[OpenLayers.Filter.Comparison.LESS_THAN]="lt",t[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",t[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",t[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",t[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(i,n){n=n||{};var r=i.CLASS_NAME,o=r.substring(r.lastIndexOf(".")+1);switch(o){case"Spatial":switch(i.type){case OpenLayers.Filter.Spatial.BBOX:n.bbox=i.value.toArray(),this.srsInBBOX&&i.projection&&n.bbox.push(i.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:n.tolerance=i.distance;case OpenLayers.Filter.Spatial.WITHIN:n.lon=i.value.x,n.lat=i.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+i.type)}break;case"Comparison":var s=t[i.type];if(void 0!==s){var a=i.value;i.type==OpenLayers.Filter.Comparison.LIKE&&(a=e(a),this.wildcarded&&(a="%"+a+"%")),n[i.property+"__"+s]=a,n.queryable=n.queryable||[],n.queryable.push(i.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+i.type);break;case"Logical":if(i.type===OpenLayers.Filter.Logical.AND)for(var l=0,u=i.filters.length;l<u;l++)n=this.write(i.filters[l],n);else OpenLayers.Console.warn("Unsupported logical filter type "+i.type);break;default:OpenLayers.Console.warn("Unknown filter type "+o)}return n},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contentMetadata=[],this.readChildNodes(e,t.contentMetadata)},CoverageSummary:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},SupportedCRS:function(e,t){var i=this.getChildValue(e);i&&(t.supportedCRS||(t.supportedCRS=[]),t.supportedCRS.push(i))},SupportedFormat:function(e,t){var i=this.getChildValue(e);i&&(t.supportedFormat||(t.supportedFormat=[]),t.supportedFormat.push(i))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Util.applyDefaults({Keywords:function(e,t){t.keywords=[],this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t.push(this.getChildValue(e))}},OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(e){var t;if(null==e)return void this.reset();if(null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=e.xy);if(t=this.map.getLonLatFromPixel(e.xy)){this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy;var i=this.formatOutput(t);i!=this.element.innerHTML&&(this.element.innerHTML=i)}},reset:function(e){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits),i=this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix;return i},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(e){var t=new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(t),this.events.triggerEvent("locationupdated",{position:e,point:new OpenLayers.Geometry.Point(t.lon,t.lat)})},getCurrentLocation:function(){return!(!this.active||this.watch)&&(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(e){this.events.triggerEvent("locationfailed",{error:e})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var t=new OpenLayers.Protocol.Script({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=e.data},scope:this});t.read(),this.request=t}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),200===e.status&&this.parseData(e.responseText)},scope:this});else this.unload();return e},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(e,t){var i=null;if(this.json){var n=this.getFeatureId(e,t);null!==n&&(i={id:n,data:this.json.data[n]})}return i},getFeatureId:function(e,t){var i=null;if(this.json){var n=this.utfgridResolution,r=Math.floor(t/n),o=Math.floor(e/n),s=this.json.grid[r].charCodeAt(o),a=this.indexFromCharCode(s),l=this.json.keys;!isNaN(a)&&a in l&&(i=l[a])}return i},indexFromCharCode:function(e){return e>=93&&e--,e>=35&&e--,e-32},parseData:function(e){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(e)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions),this.previous=new OpenLayers.Control.Button(t);var i={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(i,this.nextOptions),this.next=new OpenLayers.Control.Button(i),this.clear()},onPreviousChange:function(e,t){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e,t){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e,this.next.setMap(e),this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();return void 0!=t?(this.nextStack.unshift(e),this.previousStack.unshift(t),this.restoring=!0,this.restore(t),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(e),t},nextTrigger:function(){var e=this.nextStack.shift();return void 0!=e&&(this.previousStack.unshift(e),this.restoring=!0,this.restore(e),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),e},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,i;if(this.map.getProjectionObject()==e.projection)i=this.map.getZoomForResolution(e.resolution),t=e.center;else{t=e.center.clone(),t.transform(e.projection,this.map.getProjectionObject());var n=e.units,r=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,o=n&&r?OpenLayers.INCHES_PER_UNIT[n]/OpenLayers.INCHES_PER_UNIT[r]:1;i=this.map.getZoomForResolution(o*e.resolution)}this.map.setCenter(t,i)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0,0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear(),e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})),e},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this.cluster(),t=!1),t},clearCache:function(){this.clustering||(this.features=null)},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var i,n,r,o=[],s=0;s<this.features.length;++s)if(i=this.features[s],i.geometry){n=!1;for(var a=o.length-1;a>=0;--a)if(r=o[a],this.shouldCluster(r,i)){this.addToCluster(r,i),n=!0;break}n||o.push(this.createCluster(this.features[s]))}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,o.length>0){if(this.threshold>1){var l=o.slice();o=[];for(var u,s=0,c=l.length;s<c;++s)u=l[s],u.attributes.count<this.threshold?Array.prototype.push.apply(o,u.cluster):o.push(u)}this.clustering=!0,this.layer.addFeatures(o),this.clustering=!1}this.clusters=o}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var i=e.geometry.getBounds().getCenterLonLat(),n=t.geometry.getBounds().getCenterLonLat(),r=Math.sqrt(Math.pow(i.lon-n.lon,2)+Math.pow(i.lat-n.lat,2))/this.resolution;return r<=this.distance},addToCluster:function(e,t){e.cluster.push(t),e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});return i.cluster=[e],i},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),e},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var i,n=0,r=t.length;n<r;++n)i=t[n],this.filter.evaluate(i)?e.features.push(i):this.cache.push(i)}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),t.length>0){var i={features:t};this.handleAdd(i),i.features.length>0&&(this.caching=!0,this.layer.addFeatures(i.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Protocol.SOS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.SOS.DEFAULTS);var t=OpenLayers.Protocol.SOS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported SOS version: "+e.version;return new t(e)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point"),i=this.getElementsByTagNameNS(e,this.geons,"lat"),n=this.getElementsByTagNameNS(e,this.geons,"long"),r=this.getElementsByTagNameNS(e,this.georssns,"line"),o=this.getElementsByTagNameNS(e,this.georssns,"polygon"),s=this.getElementsByTagNameNS(e,this.georssns,"where"),a=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||i.length>0&&n.length>0){var l;t.length>0?(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/),2!=l.length&&(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/))):l=[parseFloat(i[0].firstChild.nodeValue),parseFloat(n[0].firstChild.nodeValue)];var u=new OpenLayers.Geometry.Point(l[1],l[0])}else if(r.length>0){for(var t,c=OpenLayers.String.trim(this.getChildValue(r[0])).split(/\s+/),h=[],d=0,p=c.length;d<p;d+=2)t=new OpenLayers.Geometry.Point(c[d+1],c[d]),h.push(t);u=new OpenLayers.Geometry.LineString(h)}else if(o.length>0){for(var t,c=OpenLayers.String.trim(this.getChildValue(o[0])).split(/\s+/),h=[],d=0,p=c.length;d<p;d+=2)t=new OpenLayers.Geometry.Point(c[d+1],c[d]),h.push(t);u=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(h)])}else if(s.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var f=this.gmlParser.parseFeature(s[0]);u=f.geometry}else if(a.length>0){var t,c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\s+/),h=[];c.length>3&&(t=new OpenLayers.Geometry.Point(c[1],c[0]),h.push(t),t=new OpenLayers.Geometry.Point(c[1],c[2]),h.push(t),t=new OpenLayers.Geometry.Point(c[3],c[2]),h.push(t),t=new OpenLayers.Geometry.Point(c[3],c[0]),h.push(t),t=new OpenLayers.Geometry.Point(c[1],c[0]),h.push(t)),u=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(h)])}return u&&this.internalProjection&&this.externalProjection&&u.transform(this.externalProjection,this.internalProjection),u},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e),i=this._getChildValue(e,"*","title",this.featureTitle),n=this._getChildValue(e,"*","description",this._getChildValue(e,"*","content",this._getChildValue(e,"*","summary",this.featureDescription))),r=this._getChildValue(e,"*","link");if(!r)try{r=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(o){r=null}var s=this._getChildValue(e,"*","id",null),a={title:i,description:n,link:r},l=new OpenLayers.Feature.Vector(t,a);return l.fid=s,l},_getChildValue:function(e,t,i,n){var r,o=this.getElementsByTagNameNS(e,t,i);return r=o&&o[0]&&o[0].firstChild&&o[0].firstChild.nodeValue?this.getChildValue(o[0]):void 0==n?"":n},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;t=this.getElementsByTagNameNS(e,"*","item"),0==t.length&&(t=this.getElementsByTagNameNS(e,"*","entry"));for(var i=t.length,n=new Array(i),r=0;r<i;r++)n[r]=this.createFeatureFromItem(t[r]);return n},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNS(this.rssns,"rss");for(var i=0,n=e.length;i<n;i++)t.appendChild(this.createFeatureXML(e[i]))}else t=this.createFeatureXML(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.rssns,"item"),n=this.createElementNS(this.rssns,"title");n.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:""));var r=this.createElementNS(this.rssns,"description");if(r.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:"")),i.appendChild(n),i.appendChild(r),e.attributes.link){var o=this.createElementNS(this.rssns,"link");o.appendChild(this.createTextNode(e.attributes.link)),i.appendChild(o)}for(var s in e.attributes)if("link"!=s&&"title"!=s&&"description"!=s){var a=this.createTextNode(e.attributes[s]),l=s;s.search(":")!=-1&&(l=s.split(":")[1]);var u=this.createElementNS(this.featureNS,"feature:"+l);u.appendChild(a),i.appendChild(u)}return i.appendChild(t),i},buildGeometryNode:function(e){this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t;if("OpenLayers.Geometry.Polygon"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:polygon"),t.appendChild(this.buildCoordinatesNode(e.components[0]));else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:line"),t.appendChild(this.buildCoordinatesNode(e));else{if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw"Couldn't parse "+e.CLASS_NAME;t=this.createElementNS(this.georssns,"georss:point"),t.appendChild(this.buildCoordinatesNode(e))}return t},buildCoordinatesNode:function(e){var t=null;e.components&&(t=e.components);var i;if(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=t[o].y+" "+t[o].x;i=r.join(" ")}else i=e.y+" "+e.x;return this.createTextNode(i)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{Capabilities:function(e,t){this.readChildNodes(e,t)},ProcessOfferings:function(e,t){t.processOfferings={},this.readChildNodes(e,t.processOfferings)},Process:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),n={processVersion:i};this.readChildNodes(e,n),t[n.identifier]=n},Languages:function(e,t){t.languages=[],this.readChildNodes(e,t.languages)},Default:function(e,t){var i={isDefault:!0};this.readChildNodes(e,i),t.push(i)},Supported:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var i=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.pinchOrigin=i,this.currentCenter=i},pinchMove:function(e,t){var i=t.scale,n=this.map.layerContainerOriginPx,r=this.pinchOrigin,o=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy,s=Math.round(n.x+o.x-r.x+(i-1)*(n.x-r.x)),a=Math.round(n.y+o.y-r.y+(i-1)*(n.y-r.y));this.map.applyTransform(s,a,i),this.currentCenter=o},pinchDone:function(e,t,i){this.map.applyTransform();var n=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var r=this.map.getResolutionForZoom(n),o=this.map.getLonLatFromPixel(this.pinchOrigin),s=this.currentCenter,a=this.map.getSize();o.lon+=r*(a.w/2-s.x),o.lat-=r*(a.h/2-s.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(o,n)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0)},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,t,i){this.rgb={r:e,g:t,b:i}},setRed:function(e){this.rgb.r=e},setGreen:function(e){this.rgb.g=e},setBlue:function(e){this.rgb.b=e},setHue:function(e){var t=this.asHSB();t.h=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setSaturation:function(e){var t=this.asHSB();t.s=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setBrightness:function(e){var t=this.asHSB();t.b=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},darken:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.max(t.b-e,0))},brighten:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.min(t.b+e,1))},blend:function(e){this.rgb.r=Math.floor((this.rgb.r+e.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+e.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+e.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length)for(var t=e,e="#",i=1;i<4;i++)e+=t.charAt(i)+t.charAt(i);0==e.indexOf("#")&&(e=e.substring(1));var n=e.substring(0,2),r=e.substring(2,4),o=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(n,16),parseInt(r,16),parseInt(o,16))},OpenLayers.Rico.Color.createColorFromBackground=function(e){var t=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(e),"backgroundColor");if("transparent"==t&&e.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(e.parentNode);if(null==t)return new OpenLayers.Rico.Color(255,255,255);if(0==t.indexOf("rgb(")){var i=t.substring(4,t.length-1),n=i.split(",");return new OpenLayers.Rico.Color(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]))}return 0==t.indexOf("#")?OpenLayers.Rico.Color.createFromHex(t):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(e,t,i){var n=0,r=0,o=0;if(0==t)n=parseInt(255*i+.5),r=n,o=n;else{var s=6*(e-Math.floor(e)),a=s-Math.floor(s),l=i*(1-t),u=i*(1-t*a),c=i*(1-t*(1-a));switch(parseInt(s)){case 0:n=255*i+.5,r=255*c+.5,o=255*l+.5;break;case 1:n=255*u+.5,r=255*i+.5,o=255*l+.5;break;case 2:n=255*l+.5,r=255*i+.5,o=255*c+.5;break;case 3:n=255*l+.5,r=255*u+.5,o=255*i+.5;break;case 4:n=255*c+.5,r=255*l+.5,o=255*i+.5;break;case 5:n=255*i+.5,r=255*l+.5,o=255*u+.5}}return{r:parseInt(n),g:parseInt(r),b:parseInt(o)}},OpenLayers.Rico.Color.RGBtoHSB=function(e,t,i){var n,r,o,s=e>t?e:t;i>s&&(s=i);var a=e<t?e:t;if(i<a&&(a=i),o=s/255,r=0!=s?(s-a)/s:0,0==r)n=0;else{var l=(s-e)/(s-a),u=(s-t)/(s-a),c=(s-i)/(s-a);n=e==s?c-u:t==s?2+l-c:4+u-l,n/=6,n<0&&(n+=1)}return{h:n,s:r,b:o}},OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,
rules:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy();delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(e){var t=this.map.getLayerPxFromLonLat({lon:e.bounds.left,lat:e.bounds.top}),i=this.map.getLayerPxFromLonLat({lon:e.bounds.right,lat:e.bounds.bottom});if(null==i||null==t)e.display(!1);else{var n=e.draw(t,{w:Math.max(1,i.x-t.x),h:Math.max(1,i.y-t.y)});e.drawn||(this.div.appendChild(n),e.drawn=!0)}},removeMarker:function(e){OpenLayers.Util.removeItem(this.markers,e),null!=e.div&&e.div.parentNode==this.div&&this.div.removeChild(e.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},OnlineResource:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.onlineResource=i)},Keywords:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.keywords=i.split(", "))},Capability:function(e,t){t.capability={},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetFeature:function(e,t){t.getfeature={href:{},formats:[]},this.readChildNodes(e,t.getfeature)},ResultFormat:function(e,t){for(var i,n=e.childNodes,r=0;r<n.length;r++)i=n[r],1==i.nodeType&&t.formats.push(i.nodeName)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t.href)},Get:function(e,t){t.get=e.getAttribute("onlineResource")},Post:function(e,t){t.post=e.getAttribute("onlineResource")},SRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)},LatLongBoundingBox:function(e,t){t.latLongBoundingBox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[],this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");""!=i&&(t.version=i)},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");""!=i&&(t.SearchStatus.timestamp=i)},SearchResults:function(e,t){this.readChildNodes(e,t);for(var i=e.attributes,n={},r=0,o=i.length;r<o;++r)"numberOfRecordsMatched"==i[r].name||"numberOfRecordsReturned"==i[r].name||"nextRecord"==i[r].name?n[i[r].name]=parseInt(i[r].nodeValue):n[i[r].name]=i[r].nodeValue;t.SearchResults=n},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i),t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i),t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i),t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i),t.records.push(i)},"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();t[i]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i),t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=[]);for(var n={},r=e.attributes,o=0,s=r.length;o<s;++o)n[r[o].name]=r[o].nodeValue;n.value=this.getChildValue(e),""!=n.value&&t[i].push(n)}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=[]),t[i].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(e,t){t.bounds&&(t.BoundingBox=[{crs:t.projection,value:[t.bounds.left,t.bounds.bottom,t.bounds.right,t.bounds.top]}],delete t.projection,delete t.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var t=this.writeNode("csw:GetRecords",e);return this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){e||(e={});var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});(e.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t);var i=e.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var n=0,r=i.length;n<r;n++)this.writeNode("csw:ResponseHandler",i[n],t);return this.writeNode("Query",e.Query||this.Query,t),t},DistributedSearch:function(e){var t=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}});return t},ResponseHandler:function(e){var t=this.createElementNSPlus("csw:ResponseHandler",{value:e.value});return t},Query:function(e){e||(e={});var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}}),i=e.ElementName;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var n=0,r=i.length;n<r;n++)this.writeNode("csw:ElementName",i[n],t);else this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t);return e.Constraint&&this.writeNode("csw:Constraint",e.Constraint,t),e.SortBy&&this.writeNode("ogc:SortBy",e.SortBy,t),t},ElementName:function(e){var t=this.createElementNSPlus("csw:ElementName",{value:e.value});return t},ElementSetName:function(e){var t=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value});return t},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new OpenLayers.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var n=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(n)}return t}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(e){if(e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.request(e.xy,{})},getInfoForHover:function(e){this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t=this.layers||this.map.layers,i=[],n=t.length-1;n>=0&&(e=t[n],!(e instanceof OpenLayers.Layer.WMTS&&e.requestEncoding===this.requestEncoding)||this.queryVisible&&!e.getVisibility()||(i.push(e),this.drillDown&&!this.hover));--n);return i},buildRequestOptions:function(e,t){var i=this.map.getLonLatFromPixel(t),n=e.getURL(new OpenLayers.Bounds(i.lon,i.lat,i.lon,i.lat)),r=OpenLayers.Util.getParameters(n),o=e.getTileInfo(i);return OpenLayers.Util.extend(r,{service:"WMTS",version:e.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,feature_count:this.maxFeatures,i:o.i,j:o.j}),OpenLayers.Util.applyDefaults(r,this.vendorParams),{url:OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,params:OpenLayers.Util.upperCaseObject(r),callback:function(i){this.handleResponse(t,i,e)},scope:this}},request:function(e,t){t=t||{};var i=this.findLayers();if(i.length>0){for(var n,r,o=0,s=i.length;o<s;o++)if(r=i[o],n=this.events.triggerEvent("beforegetfeatureinfo",{xy:e,layer:r}),n!==!1){++this.pending;var a=this.buildRequestOptions(r,e),l=OpenLayers.Request.GET(a);t.hover===!0&&(this.hoverRequest=l)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(e,t,i){if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),t.status&&(t.status<200||t.status>=300))this.events.triggerEvent("exception",{xy:e,request:t,layer:i});else{var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var r,o;try{r=this.format.read(n)}catch(s){o=!0,this.events.triggerEvent("exception",{xy:e,request:t,error:s,layer:i})}o||this.events.triggerEvent("getfeatureinfo",{text:t.responseText,features:r,request:t,xy:e,layer:i})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(e,t,i,n){this.initializeZoomify(i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},n])},initializeZoomify:function(e){var t=e.clone();this.size=e.clone();var i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize));for(this.tierSizeInTiles=[i],this.tierImageSize=[t];t.w>this.standardTileSize||t.h>this.standardTileSize;)t=new OpenLayers.Size(Math.floor(t.w/2),Math.floor(t.h/2)),i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize)),this.tierSizeInTiles.push(i),this.tierImageSize.push(t);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length;var n=[1];this.tileCountUpToTier=[0];for(var r=1;r<this.numberOfTiers;r++)n.unshift(Math.pow(2,r)),this.tileCountUpToTier.push(this.tierSizeInTiles[r-1].w*this.tierSizeInTiles[r-1].h+this.tileCountUpToTier[r-1]);this.serverResolutions||(this.serverResolutions=n)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},createBackBuffer:function(){var e=OpenLayers.Layer.Grid.prototype.createBackBuffer.apply(this,arguments);if(e)for(var t,i=e.childNodes.length-1;i>=0;--i)t=e.childNodes[i],t._w=t.width,t._h=t.height;return e},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),r=this.getZoomForResolution(t),o=i+n*this.tierSizeInTiles[r].w+this.tileCountUpToTier[r],s="TileGroup"+Math.floor(o/256)+"/"+r+"-"+i+"-"+n+".jpg",a=this.url;return OpenLayers.Util.isArray(a)&&(a=this.selectUrl(s,a)),a+s},getImageSize:function(){if(arguments.length>0){var e=this.adjustBounds(arguments[0]),t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),r=this.getZoomForResolution(t),o=this.standardTileSize,s=this.standardTileSize;if(i==this.tierSizeInTiles[r].w-1){var o=this.tierImageSize[r].w%this.standardTileSize;0==o&&(o=this.standardTileSize)}if(n==this.tierSizeInTiles[r].h-1){var s=this.tierImageSize[r].h%this.standardTileSize;0==s&&(s=this.standardTileSize)}return i==this.tierSizeInTiles[r].w&&(o=Math.ceil(this.size.w/Math.pow(2,this.numberOfTiers-1-r)-this.tierImageSize[r].w)),n==this.tierSizeInTiles[r].h&&(s=Math.ceil(this.size.h/Math.pow(2,this.numberOfTiers-1-r)-this.tierImageSize[r].h)),new OpenLayers.Size(o,s)}return this.tileSize},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),e=!0}return e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius;var t=this.layer.getLonLatFromViewPortPx(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var n=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,n)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var r,o=i.x-this.origin.x,s=i.y-this.origin.y;r=0==s?o/(this.radius*Math.sqrt(2)):o/s,this.feature.geometry.resize(1,this.origin,r),this.feature.geometry.move(o/2,s/2)}this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(e){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var n=0;n<this.sides;++n)t=i.components[n],e=this.angle+2*n*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var n=Math.PI/180*this.snapAngle;this.angle=Math.round(i/n)*n}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e,t){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,t,i,n){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),null!=n&&null!=n.isBaseLayer||(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=[e.left,e.bottom,e.right,e.top],i=this.getImageSize(e),n=this.getFullRequestString({mapext:t,imgext:t,map_size:[i.w,i.h],imgx:i.w/2,imgy:i.h/2,imgxy:[i.w,i.h]});return n},getFullRequestString:function(e,t){var i=null==t?this.url:t,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var r=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(r,i));var o=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var s in n)s.toUpperCase()in o&&delete n[s];r=OpenLayers.Util.getParameterString(n);var a=i;if(r=r.replace(/,/g,"+"),""!=r){var l=i.charAt(i.length-1);a+="&"==l||"?"==l?r:i.indexOf("?")==-1?"?"+r:"&"+r}return a},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),i=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],n=0,r=i.length;n<r;n++)t.addRule("olv\\:"+i[n],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),r=e.left/n|0,o=e.top/n-this.size.h|0;t||!this.offset?(this.offset={x:r,y:o},r=0,o=0):(r-=this.offset.x,o-=this.offset.y);var s=r-this.xOffset+" "+o;this.root.coordorigin=s;for(var a,l=[this.root,this.vectorRoot,this.textRoot],u=0,c=l.length;u<c;++u){a=l[u];var h=this.size.w+" "+this.size.h;a.coordsize=h}return this.root.style.flip="y",i},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,i=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],n=this.size.w+"px",r=this.size.h+"px",o=0,s=i.length;o<s;++o)t=i[o],t.style.width=n,t.style.height=r},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="olv:shape"}return i},setStyle:function(e,t,i,n){t=t||e._style,i=i||e._options;var r=t.fillColor,o=t.title||t.graphicTitle;if(o&&(e.title=o),"OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0;var s=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth;s=s?s:2*t.pointRadius,a=a?a:2*t.pointRadius;var l=this.getResolution(),u=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),c=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a);e.style.left=((n.x-this.featureDx)/l-this.offset.x+u|0)+"px",e.style.top=(n.y/l-this.offset.y-(c+a)|0)+"px",e.style.width=s+"px",e.style.height=a+"px",e.style.flip="y",r="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var h=this.importSymbol(t.graphicName);e.path=h.path,e.coordorigin=h.left+","+h.bottom;var d=h.size;e.coordsize=d+","+d,this.drawCircle(e,n,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,n,t.pointRadius);i.isFilled?e.fillcolor=r:e.filled="false";var p=e.getElementsByTagName("fill"),f=0==p.length?null:p[0];i.isFilled?(f||(f=this.createNode("olv:fill",e.id+"_fill")),f.opacity=t.fillOpacity,"OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic&&(t.graphicOpacity&&(f.opacity=t.graphicOpacity),f.src=t.externalGraphic,f.type="frame",t.graphicWidth&&t.graphicHeight||(f.aspect="atmost")),f.parentNode!=e&&e.appendChild(f)):f&&e.removeChild(f);var m=t.rotation;void 0===m&&void 0===e._rotation||(e._rotation=m,t.externalGraphic?(this.graphicRotate(e,u,c,t),f.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=m||0));var g=e.getElementsByTagName("stroke"),y=0==g.length?null:g[0];return i.isStroked?(y||(y=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(y)),y.on=!0,y.color=t.strokeColor,y.weight=t.strokeWidth+"px",y.opacity=t.strokeOpacity,y.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(y.dashstyle=this.dashStyle(t))):(e.stroked=!1,y&&(y.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,n){var r,o,n=n||e._style,s=n.rotation||0;if(!n.graphicWidth||!n.graphicHeight){var a=new Image;return a.onreadystatechange=OpenLayers.Function.bind(function(){"complete"!=a.readyState&&"interactive"!=a.readyState||(r=a.width/a.height,o=Math.max(2*n.pointRadius,n.graphicWidth||0,n.graphicHeight||0),t*=r,n.graphicWidth=o*r,n.graphicHeight=o,this.graphicRotate(e,t,i,n))},this),void(a.src=n.externalGraphic)}o=Math.max(n.graphicWidth,n.graphicHeight),r=n.graphicWidth/n.graphicHeight;var l=Math.round(n.graphicWidth||o*r),u=Math.round(n.graphicHeight||o);e.style.width=l+"px",e.style.height=u+"px";var c=document.getElementById(e.id+"_image");c||(c=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(c)),c.style.width=l+"px",c.style.height=u+"px",c.src=n.externalGraphic,c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var h=s*Math.PI/180,d=Math.sin(h),p=Math.cos(h),f="progid:DXImageTransform.Microsoft.Matrix(M11="+p+",M12="+-d+",M21="+d+",M22="+p+",SizingMethod='auto expand')\n",m=n.graphicOpacity||n.fillOpacity;m&&1!=m&&(f+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+m+")\n"),e.style.filter=f;var g=new OpenLayers.Geometry.Point((-t),(-i)),y=new OpenLayers.Bounds(0,0,l,u).toGeometry();y.rotate(n.rotation,g);var v=y.getBounds();e.style.left=Math.round(parseInt(e.style.left)+v.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-v.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var n=this.getResolution(),r=new OpenLayers.Bounds((i.left-this.featureDx)/n-this.offset.x|0,i.bottom/n-this.offset.y|0,(i.right-this.featureDx)/n-this.offset.x|0,i.top/n-this.offset.y|0);e.style.left=r.left+"px",e.style.top=r.top+"px",e.style.width=r.getWidth()+"px",e.style.height=r.getHeight()+"px",e.coordorigin=r.left+" "+r.top,e.coordsize=r.getWidth()+" "+r.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,n=i.indexOf(":");n!=-1&&(i=i.substr(n+1));var r=e.nodeName;return n=r.indexOf(":"),n!=-1&&(r=r.substr(n+1)),i==r},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var n=this.getResolution();e.style.left=((t.x-this.featureDx)/n-this.offset.x|0)-i+"px",e.style.top=(t.y/n-this.offset.y|0)-i+"px";var r=2*i;return e.style.width=r+"px",e.style.height=r+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var n,r,o,s=this.getResolution(),a=t.components.length,l=new Array(a),u=0;u<a;u++)n=t.components[u],r=(n.x-this.featureDx)/s-this.offset.x|0,o=n.y/s-this.offset.y|0,l[u]=" "+r+","+o+" l ";var c=i?" x e":" e";return e.path="m"+l.join("")+c,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,n,r,o,s,a,l,u,c,h,d,p,f=this.getResolution(),m=[];for(i=0,n=t.components.length;i<n;i++){for(m.push("m"),r=t.components[i].components,o=0===i,s=null,a=null,l=0,u=r.length;l<u;l++)c=r[l],d=(c.x-this.featureDx)/f-this.offset.x|0,p=c.y/f-this.offset.y|0,h=" "+d+","+p,m.push(h),0==l&&m.push(" l"),o||(s?s!=h&&(a?a!=h&&(o=!0):a=h):s=h);m.push(o?" x ":" ")}return m.push("e"),e.path=m.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=((t.x-this.featureDx)/i-this.offset.x|0)+"px",e.style.top=(t.y/i-this.offset.y|0)+"px",e.style.width=(t.width/i|0)+"px",e.style.height=(t.height/i|0)+"px",e},drawText:function(e,t,i){var n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),r=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),o=this.getResolution();n.style.left=((i.x-this.featureDx)/o-this.offset.x|0)+"px",n.style.top=(i.y/o-this.offset.y|0)+"px",n.style.flip="y",r.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(r.style.cursor=t.cursor),t.fontColor&&(r.style.color=t.fontColor),t.fontOpacity&&(r.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(r.style.fontFamily=t.fontFamily),t.fontSize&&(r.style.fontSize=t.fontSize),t.fontWeight&&(r.style.fontWeight=t.fontWeight),t.fontStyle&&(r.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(n._featureId=e,r._featureId=e,r._geometry=i,r._geometryClass=i.CLASS_NAME),r.style.whiteSpace="nowrap",r.inset="1px,0px,0px,0px",n.parentNode||(n.appendChild(r),this.textRoot.appendChild(n));var s=t.labelAlign||"cm";1==s.length&&(s+="m");var a=r.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)],l=r.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)];n.style.left=parseInt(n.style.left)-a-1+"px",n.style.top=parseInt(n.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");for(var r=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=["m"],s=0;s<n.length;s+=2){var a=n[s],l=n[s+1];r.left=Math.min(r.left,a),r.bottom=Math.min(r.bottom,l),r.right=Math.max(r.right,a),r.top=Math.max(r.top,l),o.push(a),o.push(l),0==s&&o.push("l")}o.push("x e");var u=o.join(" "),c=(r.getWidth()-r.getHeight())/2;return c>0?(r.bottom=r.bottom-c,r.top=r.top+c):(r.left=r.left+c,r.right=r.right-c),i={path:u,size:r.getWidth(),left:r.left,bottom:r.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var t,i=this.layers||e.layers;for(t=i.length-1;t>=0;--t)this.addLayer({layer:i[t]});this.layers||e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(e){e.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(e){e.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(e){if(this.active&&window.localStorage&&e.tile instanceof OpenLayers.Tile.Image){var t=e.tile,i=t.url;!t.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===i.indexOf(OpenLayers.ProxyHost)&&(i=OpenLayers.Control.CacheWrite.urlMap[i]);var n=window.localStorage.getItem("olCache_"+i);n&&(t.url=n,"tileerror"===e.type&&t.setImgSrc(n))}},destroy:function(){if(this.layers||this.map){var e,t=this.layers||this.map.layers;for(e=t.length-1;e>=0;--e)this.removeLayer({layer:t[e]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var n=e.headers||{};n["Content-Type"]="application/x-www-form-urlencoded",i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:n})}else i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers});return i;
},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),r=this.updateWithPOST?"POST":"PUT";return n.priv=OpenLayers.Request[r]({url:i,callback:this.createCallback(this.handleUpdate,n,t),headers:t.headers,data:this.format.write(e)}),n},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),r=this.deleteWithPOST?"POST":"DELETE",o={url:i,callback:this.createCallback(this.handleDelete,n,t),headers:t.headers};return this.deleteWithPOST&&(o.data=this.format.write(e)),n.priv=OpenLayers.Request[r](o),n},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&i.status<300?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=new Array(t),r=0;r<t;++r)i[r]=e.features[r].fid;f.insertIds=i,n.apply(this,[e])}function n(e){this.callUserCallback(e,t),p=p&&e.success(),o++,o>=d&&t.callback&&(f.code=p?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[f]))}t=OpenLayers.Util.applyDefaults(t,this.options);var r=[],o=0,s={};s[OpenLayers.State.INSERT]=[],s[OpenLayers.State.UPDATE]=[],s[OpenLayers.State.DELETE]=[];for(var a,l,u=[],c=0,h=e.length;c<h;++c)a=e[c],l=s[a.state],l&&(l.push(a),u.push(a));var d=(s[OpenLayers.State.INSERT].length>0?1:0)+s[OpenLayers.State.UPDATE].length+s[OpenLayers.State.DELETE].length,p=!0,f=new OpenLayers.Protocol.Response({reqFeatures:u}),m=s[OpenLayers.State.INSERT];m.length>0&&r.push(this.create(m,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),m=s[OpenLayers.State.UPDATE];for(var c=m.length-1;c>=0;--c)r.push(this.update(m[c],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.update)));m=s[OpenLayers.State.DELETE];for(var c=m.length-1;c>=0;--c)r.push(this["delete"](m[c],OpenLayers.Util.applyDefaults({callback:n,scope:this},t["delete"])));return r},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Protocol.WFS.v2_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"2.0.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml3"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v3({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v2_0_0"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.format.write(e.params||e);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&i.status<300?(e.data=this.parseData(i),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseData:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new e(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var e in this.layerCache)delete this.layerCache[e];for(var e in this.wfsCache)delete this.wfsCache[e];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(e){this.setVisibility(e.object.getVisibility())},createSelectionLayer:function(e){var t;return this.layerCache[e.id]?t=this.layerCache[e.id]:(t=new OpenLayers.Layer.WMS(e.name,e.url,e.params,OpenLayers.Util.applyDefaults(this.layerOptions,e.getOptions())),this.layerCache[e.id]=t,this.layerOptions.displayInLayerSwitcher===!1&&e.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:t}),this.map.addLayer(t)),t},createSLD:function(e,t,i){for(var n={version:"1.0.0",namedLayers:{}},r=[e.params.LAYERS].join(",").split(","),o=0,s=r.length;o<s;o++){var a=r[o];n.namedLayers[a]={name:a,userStyles:[]};var l=this.selectionSymbolizer,u=i[o];u.type.indexOf("Polygon")>=0?l={Polygon:this.selectionSymbolizer.Polygon}:u.type.indexOf("LineString")>=0?l={Line:this.selectionSymbolizer.Line}:u.type.indexOf("Point")>=0&&(l={Point:this.selectionSymbolizer.Point});var c=t[o];n.namedLayers[a].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:c,maxScaleDenominator:e.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(n)},parseDescribeLayer:function(e){var t=new OpenLayers.Format.WMSDescribeLayer,i=e.responseXML;i&&i.documentElement||(i=e.responseText);for(var n=t.read(i),r=[],o=null,s=0,a=n.length;s<a;s++)"WFS"==n[s].owsType&&(r.push(n[s].typeName),o=n[s].owsURL);var l={url:o,params:{SERVICE:"WFS",TYPENAME:r.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(e){var t=new OpenLayers.Format.WFSDescribeFeatureType,i=e.responseXML;i&&i.documentElement||(i=e.responseText);var n=t.read(i);this.control.wfsCache[this.layer.id]=n,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(l)},getGeometryAttributes:function(e){for(var t=[],i=this.wfsCache[e.id],n=0,r=i.featureTypes.length;n<r;n++)for(var o=i.featureTypes[n],s=o.properties,a=0,l=s.length;a<l;a++){var u=s[a],c=u.type;(c.indexOf("LineString")>=0||c.indexOf("GeometryAssociationType")>=0||c.indexOf("GeometryPropertyType")>=0||c.indexOf("Point")>=0||c.indexOf("Polygon")>=0)&&t.push(u)}return t},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);if(e)for(var t=0,i=this.layers.length;t<i;t++){var n=this.layers[t];if(n&&!this.wfsCache[n.id]){var r={url:n.url,params:{SERVICE:"WMS",VERSION:n.params.VERSION,LAYERS:n.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:n,control:this}};OpenLayers.Request.GET(r)}}return e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);if(e)for(var t=0,i=this.layers.length;t<i;t++){var n=this.layers[t];if(n&&this.clearOnDeactivate===!0){var r=this.layerCache,o=r[n.id];o&&(n.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:o}),o.destroy(),delete r[n.id])}}return e},setLayers:function(e){this.active?(this.deactivate(),this.layers=e,this.activate()):this.layers=e},createFilter:function(e,t){var i=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?i=this.handler.irregular===!0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e.name,value:t.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Polygon?i=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Path?i=e.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Click&&(i=e.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t})),i},select:function(e){this._queue=function(){for(var t=0,i=this.layers.length;t<i;t++){for(var n=this.layers[t],r=this.getGeometryAttributes(n),o=[],s=0,a=r.length;s<a;s++){var l=r[s];if(null!==l){if(!(e instanceof OpenLayers.Geometry)){var u=this.map.getLonLatFromPixel(e.xy);e=new OpenLayers.Geometry.Point(u.lon,u.lat)}var c=this.createFilter(l,e);null!==c&&o.push(c)}}var h=this.createSelectionLayer(n);this.events.triggerEvent("selected",{layer:n,filters:o});var d=this.createSLD(n,o,r);h.mergeNewParams({SLD_BODY:d}),delete this._queue}},this.applySelection()},applySelection:function(){for(var e=!0,t=0,i=this.layers.length;t<i;t++)if(!this.wfsCache[this.layers[t].id]){e=!1;break}e&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],intervalHeights:null,intervalHeightFactor:1,displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",labelLonYOffset:2,labelLatXOffset:-2,lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:null,gratLayer:null,epsg4326Projection:null,projection:null,projectionCenterLonLat:null,maxLat:1/0,maxLon:1/0,minLat:-(1/0),minLon:-(1/0),meridians:null,parallels:null,initialize:function(e){e=e||{},e.layerName=e.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[e]),this.labelSymbolizer={stroke:!1,fill:!1,label:"${label}",labelAlign:"${labelAlign}",labelXOffset:"${xOffset}",labelYOffset:"${yOffset}"},this.epsg4326Projection=new OpenLayers.Projection("EPSG:4326"),this.parallels=[],this.meridians=[]},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var e=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":e}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher,renderers:["Canvas","VML","SVG"]})}return this.div},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0)},update:function(){var e=this.map,t=this.map.getExtent();if(t){var i=e.getCenter(),n=e.getProjectionObject(),r=e.getResolution(),o=r*r/4,s=!this.projection||!this.projection.equals(n);if(s&&this.updateProjectionInfo(n),this.createGraticule(t,i,r,o),this.gratLayer.destroyFeatures(),this.gratLayer.addFeatures(this.meridians),this.gratLayer.addFeatures(this.parallels),this.labelled){var a,l,u,c,h,d,p=new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(t.left,t.bottom),new OpenLayers.Geometry.Point(t.left,t.top)]),f=new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(t.left,t.top),new OpenLayers.Geometry.Point(t.right,t.top)]),m=[];for(a=0,l=this.meridians.length;a<l;++a)u=this.meridians[a],c=u.attributes.labelPoint,d="cb",c||(h=u.geometry.split(p),h&&(c=h[0].components[1],d="lt")),c&&m.push(new OpenLayers.Feature.Vector(c,{value:u.attributes.lon,label:OpenLayers.Util.getFormattedLonLat(u.attributes.lon,"lon",this.labelFormat),labelAlign:d,xOffset:0,yOffset:this.labelLonYOffset}));for(a=0,l=this.parallels.length;a<l;++a)u=this.parallels[a],c=u.attributes.labelPoint,d="rb",c||(h=u.geometry.split(f),h&&(c=h[0].components[1],d="ct")),c&&m.push(new OpenLayers.Feature.Vector(c,{value:u.attributes.lat,label:OpenLayers.Util.getFormattedLonLat(u.attributes.lat,"lat",this.labelFormat),labelAlign:d,xOffset:this.labelLatXOffset,yOffset:2}));this.gratLayer.addFeatures(m)}}},createGraticule:function(e,t,i,n){var r=t.clone().transform(this.projection,this.epsg4326Projection);(isNaN(r.lon)||isNaN(r.lat))&&(r=t.add(1e-9,1e-9).transform(this.projection,this.epsg4326Projection));var o,s,a,l,u=e.toGeometry(),c=e.clone().transform(this.projection,this.epsg4326Projection),h=this.map.getGeodesicPixelSize();h.w<.5&&h.h<.5&&c.right>c.left&&c.top>c.bottom&&Math.abs(c.bottom)/c.bottom==Math.abs(c.top)/c.top&&Math.abs(c.left)/c.left==Math.abs(c.right)/c.right?(o=Math.max(c.left,this.minLon),s=Math.max(c.bottom,this.minLat),a=Math.min(c.right,this.maxLon),l=Math.min(c.top,this.maxLat)):(o=this.minLon,s=this.minLat,a=this.maxLon,l=this.maxLat);var d,p,f,m,g,y,v,E,T,b=this.map.getSize();g=Math.ceil(b.w/this.targetSize),v=0;do{for(y=this.intervals[v++],E=Math.floor(r.lon/y)*y,f=Math.max(E,this.minLon),f=Math.min(f,this.maxLon),d=this.addMeridian(f,s,l,n,u,0);f!=this.minLon&&(f=Math.max(f-y,this.minLon),p=d,d=this.addMeridian(f,s,l,n,u,d),p!=d););for(f=Math.max(E,this.minLon),f=Math.min(f,this.maxLon);f!=this.maxLon&&(f=Math.min(f+y,this.maxLon),p=d,d=this.addMeridian(f,s,l,n,u,d),p!=d););}while(v<this.intervals.length&&d<=g);this.meridians.length=d,g=Math.ceil(b.h/this.targetSize),v=0;do{for(y=this.intervalHeights?this.intervalHeights[v++]:this.intervals[v++]*this.intervalHeightFactor,T=Math.floor(r.lat/y)*y,m=Math.max(T,this.minLat),m=Math.min(m,this.maxLat),d=this.addParallel(m,o,a,n,u,0);m!=this.minLat&&(m=Math.max(m-y,this.minLat),p=d,d=this.addParallel(m,o,a,n,u,d),p!=d););for(m=Math.max(T,this.minLat),m=Math.min(m,this.maxLat);m!=this.maxLat&&(m=Math.min(m+y,this.maxLat),p=d,d=this.addParallel(m,o,a,n,u,d),p!=d););}while(v<this.intervals.length&&d<=g);this.parallels.length=d},updateProjectionInfo:function(e){var t=OpenLayers.Projection.defaults[e.getCode()],i=t&&t.maxExtent?OpenLayers.Bounds.fromArray(t.maxExtent):this.map.getMaxExtent(),n=t&&t.worldExtent?t.worldExtent:[-180,-90,180,90];this.maxLat=n[3],this.maxLon=n[2],this.minLat=n[1],this.minLon=n[0],this.projectionCenterLonLat=i.clone().transform(e,this.epsg4326Projection).getCenterLonLat(),this.projection=e},addMeridian:function(e,t,i,n,r,o){var s=OpenLayers.Geometry.LineString.geodesicMeridian(e,t,i,this.projection,n),a=s.split(new OpenLayers.Geometry.LineString(r.components[0].components.slice(0,2)));return(a||r.intersects(s))&&(this.meridians[o++]=new OpenLayers.Feature.Vector(s,{lon:e,labelPoint:a?a[0].components[1]:void 0})),o},addParallel:function(e,t,i,n,r,o){var s=OpenLayers.Geometry.LineString.geodesicParallel(e,t,i,this.projection,n),a=s.split(new OpenLayers.Geometry.LineString(r.components[0].components.slice(1,3)));return(a||r.intersects(s))&&(this.parallels[o++]=new OpenLayers.Feature.Vector(s,{lat:e,labelPoint:a?a[0].components[1]:void 0})),o},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(e,t){},onDrag:function(e,t){},onComplete:function(e,t){},onEnter:function(e){},onLeave:function(e){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.feature.id==e.id?this.over=!0:this.over=!1:(this.feature=e,this.handlers.drag.activate(),t=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(e){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id==e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(e,t){e=OpenLayers.Util.getElement(e),this._setOptions(t);var i=this.options.color;"fromElement"==this.options.color&&(i=this._background(e));var n=this.options.bgColor;"fromParent"==this.options.bgColor&&(n=this._background(e.offsetParent)),this._roundCornersImpl(e,i,n)},changeColor:function(e,t){e.style.backgroundColor=t;for(var i=e.parentNode.getElementsByTagName("span"),n=0;n<i.length;n++)i[n].style.backgroundColor=t},changeOpacity:function(e,t){var i=t,n="alpha(opacity="+100*t+")";e.style.opacity=i,e.style.filter=n;for(var r=e.parentNode.getElementsByTagName("span"),o=0;o<r.length;o++)r[o].style.opacity=i,r[o].style.filter=n},reRound:function(e,t){var i=e.parentNode.childNodes[0],n=e.parentNode.childNodes[2];e.parentNode.removeChild(i),e.parentNode.removeChild(n),this.round(e.parentNode,t)},_roundCornersImpl:function(e,t,i){this.options.border&&this._renderBorder(e,i),this._isTopRounded()&&this._roundTopCorners(e,t,i),this._isBottomRounded()&&this._roundBottomCorners(e,t,i)},_renderBorder:function(e,t){var i="1px solid "+this._borderColor(t),n="border-left: "+i,r="border-right: "+i,o="style='"+n+";"+r+"'";e.innerHTML="<div "+o+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,t,i){for(var n=this._createCorner(i),r=0;r<this.options.numSlices;r++)n.appendChild(this._createCornerSlice(t,i,r,"top"));e.style.paddingTop=0,e.insertBefore(n,e.firstChild)},_roundBottomCorners:function(e,t,i){for(var n=this._createCorner(i),r=this.options.numSlices-1;r>=0;r--)n.appendChild(this._createCornerSlice(t,i,r,"bottom"));e.style.paddingBottom=0,e.appendChild(n)},_createCorner:function(e){var t=document.createElement("div");return t.style.backgroundColor=this._isTransparent()?"transparent":e,t},_createCornerSlice:function(e,t,i,n){var r=document.createElement("span"),o=r.style;o.backgroundColor=e,o.display="block",o.height="1px",o.overflow="hidden",o.fontSize="1px";var s=this._borderColor(e,t);return this.options.border&&0==i?(o.borderTopStyle="solid",o.borderTopWidth="1px",o.borderLeftWidth="0px",o.borderRightWidth="0px",o.borderBottomWidth="0px",o.height="0px",o.borderColor=s):s&&(o.borderColor=s,o.borderStyle="solid",o.borderWidth="0px 1px"),this.options.compact||i!=this.options.numSlices-1||(o.height="2px"),this._setMargin(r,i,n),this._setBorder(r,i,n),r},_setOptions:function(e){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,e||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(e,t){return"transparent"==e?t:this.options.border?this.options.border:this.options.blend?this._blend(t,e):""},_setMargin:function(e,t,i){var n=this._marginSize(t),r="top"==i?this._whichSideTop():this._whichSideBottom();"left"==r?(e.style.marginLeft=n+"px",e.style.marginRight="0px"):"right"==r?(e.style.marginRight=n+"px",e.style.marginLeft="0px"):(e.style.marginLeft=n+"px",e.style.marginRight=n+"px")},_setBorder:function(e,t,i){var n=this._borderSize(t),r="top"==i?this._whichSideTop():this._whichSideBottom();"left"==r?(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth="0px"):"right"==r?(e.style.borderRightWidth=n+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px"),0!=this.options.border&&(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px")},_marginSize:function(e){if(this._isTransparent())return 0;var t=[5,3,2,1],i=[3,2,1,0],n=[2,1],r=[1,0];return this.options.compact&&this.options.blend?r[e]:this.options.compact?n[e]:this.options.blend?i[e]:t[e]},_borderSize:function(e){var t=[5,3,2,1],i=[2,1,1,1],n=[1,0],r=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?n[e]:this.options.blend?i[e]:this.options.border?r[e]:this._isTransparent()?t[e]:0},_hasString:function(e){for(var t=1;t<arguments.length;t++)if(e.indexOf(arguments[t])>=0)return!0;return!1},_blend:function(e,t){var i=OpenLayers.Rico.Color.createFromHex(e);return i.blend(OpenLayers.Rico.Color.createFromHex(t)),i},_background:function(e){try{return OpenLayers.Rico.Color.createColorFromBackground(e).asHex()}catch(t){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(e){return 1==e.childNodes.length&&3==e.childNodes[0].nodeType}},OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(e){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e.name,e.url,{},e]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(e){return null==e&&(e=new OpenLayers.Layer.UTFGrid(this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getFeatureInfo:function(e){var t=null,i=this.getTileData(e);return i&&i.tile&&(t=i.tile.getFeatureInfo(i.i,i.j)),t},getFeatureId:function(e){var t=null,i=this.getTileData(e);return i.tile&&(t=i.tile.getFeatureId(i.i,i.j)),t},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(e),this.tileQueue[e.id]=[];for(var t=0,i=e.layers.length;t<i;++t)this.addLayer({layer:e.layers[t]});e.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[e.id]),e.layers)for(var t=0,i=e.layers.length;t<i;++t)this.removeLayer({layer:e.layers[t]});e.events&&e.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[e.id],delete this.tileQueueId[e.id],OpenLayers.Util.removeItem(this.maps,e)}},move:function(e){this.updateTimeout(e.object,this.moveDelay,!0)},zoomEnd:function(e){this.updateTimeout(e.object,this.zoomDelay)},changeLayer:function(e){"visibility"!==e.property&&"params"!==e.property||this.updateTimeout(e.object,0)},addLayer:function(e){var t=e.layer;if(t instanceof OpenLayers.Layer.Grid){t.events.on({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this});var i,n,r;for(i=t.grid.length-1;i>=0;--i)for(n=t.grid[i].length-1;n>=0;--n)r=t.grid[i][n],this.addTile({tile:r}),r.url&&!r.imgDiv&&this.manageTileCache({object:r})}},removeLayer:function(e){var t=e.layer;if(t instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:t}),t.events&&t.events.un({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this}),t.grid)){var i,n,r;for(i=t.grid.length-1;i>=0;--i)for(n=t.grid[i].length-1;n>=0;--n)r=t.grid[i][n],this.unloadTile({object:r})}},handleLayerRefresh:function(e){var t=e.object;if(t.grid){var i,n,r;for(i=t.grid.length-1;i>=0;--i)for(n=t.grid[i].length-1;n>=0;--n)r=t.grid[i][n],OpenLayers.Util.removeItem(this.tileCacheIndex,r.url),delete this.tileCache[r.url]}},updateTimeout:function(e,t,i){window.clearTimeout(this.tileQueueId[e.id]);var n=this.tileQueue[e.id];i&&!n.length||(this.tileQueueId[e.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(e),n.length&&this.updateTimeout(e,this.frameDelay)},this),t))},addTile:function(e){e.tile instanceof OpenLayers.Tile.Image?e.tile.layer.singleTile||e.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:e.tile.layer})},unloadTile:function(e){var t=e.object;t.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[t.layer.map.id],t)},queueTileDraw:function(e){var t=e.object,i=!1,n=t.layer,r=n.getURL(t.bounds),o=this.tileCache[r];if(o&&"olTileImage"!==o.className&&(delete this.tileCache[r],OpenLayers.Util.removeItem(this.tileCacheIndex,r),o=null),n.url&&(n.async||!o)){var s=this.tileQueue[n.map.id];~OpenLayers.Util.indexOf(s,t)||s.push(t),i=!0}return!i},drawTilesFromQueue:function(e){for(var t=this.tileQueue[e.id],i=this.tilesPerFrame,n=e.zoomTween&&e.zoomTween.playing;!n&&t.length&&i;)t.shift().draw(!0),--i},manageTileCache:function(e){var t=e.object,i=this.tileCache[t.url];i&&(i.parentNode&&OpenLayers.Element.hasClass(i.parentNode,"olBackBuffer")&&(i.parentNode.removeChild(i),i.id=null),i.parentNode||(i.style.visibility="hidden",i.style.opacity=0,t.setImage(i),OpenLayers.Util.removeItem(this.tileCacheIndex,t.url),this.tileCacheIndex.push(t.url)))},addToCache:function(e){var t=e.object;this.tileCache[t.url]||OpenLayers.Element.hasClass(t.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[t.url]=t.imgDiv,this.tileCacheIndex.push(t.url))},clearTileQueue:function(e){for(var t=e.object,i=this.tileQueue[t.map.id],n=i.length-1;n>=0;--n)i[n].layer===t&&i.splice(n,1)},destroy:function(){for(var e=this.maps.length-1;e>=0;--e)this.removeMap(this.maps[e]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options),e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(i){t.data=i,this.handleRead(t,e)},this));return t.priv=i,t},createRequest:function(e,t,i){var n=OpenLayers.Protocol.Script.register(i),r=OpenLayers.String.format(this.callbackTemplate,{id:n});t=OpenLayers.Util.extend({},t),t[this.callbackKey]=this.callbackPrefix+r,e=OpenLayers.Util.urlAppend(e,OpenLayers.Util.getParameterString(t));var o=document.createElement("script");o.type="text/javascript",o.src=e,o.id="OpenLayers_Protocol_Script_"+n,this.pendingRequests[o.id]=o;var s=document.getElementsByTagName("head")[0];return s.appendChild(o),o},destroyRequest:function(e){
OpenLayers.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var e=OpenLayers.Protocol.Script,t=0;e.registry={},e.register=function(i){var n="c"+ ++t;return e.registry[n]=function(){i.apply(this,arguments)},n},e.unregister=function(t){delete e.registry[t]}}(),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var e=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),e=!0),e},setMap:function(e){this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(e,t){t=OpenLayers.Util.applyDefaults(t,{rotation:0,scale:1,ratio:1});var i=this.rotation,n=this.center;OpenLayers.Util.extend(this,t);var r=this.events.triggerEvent("beforesetfeature",{feature:e});if(r!==!1){this.feature=e,this.activate(),this._setfeature=!0;var o=this.feature.geometry.getBounds();this.box.move(o.getCenterLonLat()),this.box.geometry.rotate(-i,n),this._angle=0;var s;if(this.rotation){var a=e.geometry.clone();a.rotate(-this.rotation,this.center);var l=new OpenLayers.Feature.Vector(a.getBounds().toGeometry());l.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(l.geometry.getBounds().getCenterLonLat());var u=l.geometry.components[0].components[0];s=u.getBounds().getCenterLonLat()}else s=new OpenLayers.LonLat(o.left,o.bottom);this.handles[0].move(s),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:e})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var e=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point((-1),(-1)),new OpenLayers.Geometry.Point(0,(-1)),new OpenLayers.Geometry.Point(1,(-1)),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point((-1),1),new OpenLayers.Geometry.Point((-1),0),new OpenLayers.Geometry.Point((-1),(-1))]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(t,i){e._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),e.center.move(t,i),delete e._moving};for(var t,i,n,r=function(e,t){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(e,t),this._handle.geometry.move(e,t)},o=function(e,t,i){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(e,t,i),this._handle.geometry.resize(e,t,i)},s=function(e,t){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(e,t),this._handle.geometry.rotate(e,t)},a=function(t,i){var n=this.x,r=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var o=e.dragControl.handlers.drag.evt,s=!e._setfeature&&e.preserveAspectRatio,a=!(s||o&&o.shiftKey),l=new OpenLayers.Geometry.Point(n,r),u=e.center;this.rotate(-e.rotation,u),l.rotate(-e.rotation,u);var c=this.x-u.x,h=this.y-u.y,d=c-(this.x-l.x),p=h-(this.y-l.y);e.irregular&&!e._setfeature&&(c-=(this.x-l.x)/2,h-=(this.y-l.y)/2),this.x=n,this.y=r;var f,m=1;if(a)f=Math.abs(p)<1e-5?1:h/p,m=(Math.abs(d)<1e-5?1:c/d)/f;else{var g=Math.sqrt(d*d+p*p),y=Math.sqrt(c*c+h*h);f=y/g}if(e._moving=!0,e.box.geometry.rotate(-e.rotation,u),delete e._moving,e.box.geometry.resize(f,u,m),e.box.geometry.rotate(e.rotation,u),e.transformFeature({scale:f,ratio:m}),e.irregular&&!e._setfeature){var v=u.clone();v.x+=Math.abs(n-u.x)<1e-5?0:this.x-n,v.y+=Math.abs(r-u.y)<1e-5?0:this.y-r,e.box.geometry.move(this.x-n,this.y-r),e.transformFeature({center:v})}}},l=function(t,i){var n=this.x,r=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var o=e.dragControl.handlers.drag.evt,s=o&&o.shiftKey?45:1,a=e.center,l=this.x-a.x,u=this.y-a.y,c=l-t,h=u-i;this.x=n,this.y=r;var d=Math.atan2(h,c),p=Math.atan2(u,l),f=p-d;f*=180/Math.PI,e._angle=(e._angle+f)%360;var m=e.rotation%s;(Math.abs(e._angle)>=s||0!==m)&&(f=Math.round(e._angle/s)*s-m,e._angle=0,e.box.geometry.rotate(f,a),e.transformFeature({rotation:f}))}},u=new Array(8),c=new Array(4),h=["sw","s","se","e","ne","n","nw","w"],d=0;d<8;++d)t=this.box.geometry.components[d],i=new OpenLayers.Feature.Vector(t.clone(),{role:h[d]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),d%2==0&&(n=new OpenLayers.Feature.Vector(t.clone(),{role:h[d]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),n.geometry.move=l,t._rotationHandle=n,c[d/2]=n),t.move=r,t.resize=o,t.rotate=s,i.geometry.move=a,t._handle=i,u[d]=i;this.rotationHandles=c,this.handles=u},createControl:function(){var e=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(t){this.feature===e.feature&&(this.feature=e.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(t,i){t===e.box&&e.transformFeature({center:e.center})},onStart:function(t,i){var n=!e.geometryTypes||OpenLayers.Util.indexOf(e.geometryTypes,t.geometry.CLASS_NAME)!==-1,r=OpenLayers.Util.indexOf(e.handles,t);r+=OpenLayers.Util.indexOf(e.rotationHandles,t),t!==e.feature&&t!==e.box&&r==-2&&n&&e.setFeature(t)},onComplete:function(t,i){e.events.triggerEvent("transformcomplete",{feature:e.feature})}})},drawHandles:function(){for(var e=this.layer,t=0;t<8;++t)this.rotate&&t%2===0&&e.drawFeature(this.rotationHandles[t/2],this.rotationHandleSymbolizer),e.drawFeature(this.handles[t],this.renderIntent)},transformFeature:function(e){if(!this._setfeature){this.scale*=e.scale||1,this.ratio*=e.ratio||1;var t=this.rotation;if(this.rotation=(this.rotation+(e.rotation||0))%360,this.events.triggerEvent("beforetransform",e)!==!1){var i=this.feature,n=i.geometry,r=this.center;n.rotate(-t,r),e.scale||e.ratio?n.resize(e.scale,r,e.ratio):e.center&&i.move(e.center.getBounds().getCenterLonLat()),n.rotate(this.rotation,r),this.layer.drawFeature(i),i.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",e)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var e,t=0;t<8;++t)e=this.box.geometry.components[t],e._handle.destroy(),e._handle=null,e._rotationHandle&&e._rotationHandle.destroy(),e._rotationHandle=null;this.center=null,this.feature=null,this.handles=null,this.rotationHandleSymbolizer=null,this.rotationHandles=null,this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,hexZoom:!1,initialize:function(e,t,i){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var n=this.layerInfo,r=new OpenLayers.Bounds(n.fullExtent.xmin,n.fullExtent.ymin,n.fullExtent.xmax,n.fullExtent.ymax);if(this.projection="EPSG:"+n.spatialReference.wkid,this.sphericalMercator=102100==n.spatialReference.wkid,this.units="esriFeet"==n.units?"ft":"m",n.tileInfo){this.tileSize=new OpenLayers.Size(n.tileInfo.width||n.tileInfo.cols,n.tileInfo.height||n.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(n.tileInfo.origin.x,n.tileInfo.origin.y);var o=new OpenLayers.Geometry.Point(r.left,r.top),s=new OpenLayers.Geometry.Point(r.right,r.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var a in n.tileInfo.lods)if(n.tileInfo.lods.hasOwnProperty(a)){var l=n.tileInfo.lods[a];this.useScales?this.scales.push(l.scale):this.resolutions.push(l.resolution);var u=this.getContainingTileCoords(o,l.resolution);l.startTileCol=u.x,l.startTileRow=u.y;var c=this.getContainingTileCoords(s,l.resolution);l.endTileCol=c.x,l.endTileRow=c.y,this.lods.push(l)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&n.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=n.tileInfo.dpi)}}},getContainingTileCoords:function(e,t){return new OpenLayers.Pixel(Math.max(Math.floor((e.x-this.tileOrigin.lon)/(this.tileSize.w*t)),0),Math.max(Math.floor((this.tileOrigin.lat-e.y)/(this.tileSize.h*t)),0))},calculateMaxExtentWithLOD:function(e){var t=e.endTileCol-e.startTileCol+1,i=e.endTileRow-e.startTileRow+1,n=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,r=n+t*this.tileSize.w*e.resolution,o=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution,s=o-i*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(n,s,r,o)},calculateMaxExtentWithExtent:function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.top),n=new OpenLayers.Geometry.Point(e.right,e.bottom),r=this.getContainingTileCoords(i,t),o=this.getContainingTileCoords(n,t),s={resolution:t,startTileCol:r.x,startTileRow:r.y,endTileCol:o.x,endTileRow:o.y};return this.calculateMaxExtentWithLOD(s)},getUpperLeftTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(t,e)},getLowerRightTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(t,e)},getMaxExtentForResolution:function(e){var t=this.getUpperLeftTileCoord(e),i=this.getLowerRightTileCoord(e),n=i.x-t.x+1,r=i.y-t.y+1,o=this.tileOrigin.lon+t.x*this.tileSize.w*e,s=o+n*this.tileSize.w*e,a=this.tileOrigin.lat-t.y*this.tileSize.h*e,l=a-r*this.tileSize.h*e;return new OpenLayers.Bounds(o,l,s,a)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},initGriddedTiles:function(e){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var e=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(e)},getTileOrigin:function(){if(!this._tileOrigin){var e=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(e.left,e.bottom)}return this._tileOrigin},getURL:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,n=this.tileOrigin.lat-t*this.tileSize.h/2,r=e.getCenterLonLat(),o=({x:r.lon,y:r.lat},Math.round(Math.abs((r.lon-i)/(t*this.tileSize.w)))),s=Math.round(Math.abs((n-r.lat)/(t*this.tileSize.h))),a=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(o<l.startTileCol||o>l.endTileCol||s<l.startTileRow||s>l.endTileRow)return null}else{var u=this.getUpperLeftTileCoord(t),c=this.getLowerRightTileCoord(t);if(o<u.x||o>=c.x||s<u.y||s>=c.y)return null}var h=this.url,d=""+o+s+a;return OpenLayers.Util.isArray(h)&&(h=this.selectUrl(d,h)),this.useArcGISServer?h+="/tile/${z}/${y}/${x}":(o="C"+OpenLayers.Number.zeroPad(o,8,16),s="R"+OpenLayers.Number.zeroPad(s,8,16),a="L"+OpenLayers.Number.zeroPad(a,2,this.hexZoom?16:10),h=h+"/${z}/${y}/${x}."+this.type),h=OpenLayers.String.format(h,{x:o,y:s,z:a}),OpenLayers.Util.urlAppend(h,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){if(e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t,i=this.layers||this.map.layers,n=[],r=i.length-1;r>=0;--r)e=i[r],e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())&&(t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,this.drillDown!==!1||this.url||(this.url=t),(this.drillDown===!0||this.urlMatches(t))&&n.push(e));return n},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var i=0,n=this.layerUrls.length;i<n;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],e)){t=!0;break}return t},buildWMSOptions:function(e,t,i,n){for(var r=[],o=[],s=0,a=t.length;s<a;s++)null!=t[s].params.LAYERS&&(r=r.concat(t[s].params.LAYERS),o=o.concat(this.getStyleNames(t[s])));var l=t[0],u=this.map.getProjection(),c=l.projection;c&&c.equals(this.map.getProjectionObject())&&(u=c.getCode());var h=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:n,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:u,i:parseInt(i.x),j:parseInt(i.y)}:{srs:u,x:parseInt(i.x),y:parseInt(i.y)});return 0!=r.length&&(h=OpenLayers.Util.extend({layers:r,query_layers:r,styles:o},h)),OpenLayers.Util.applyDefaults(h,this.vendorParams),{url:e,params:OpenLayers.Util.upperCaseObject(h),callback:function(t){this.handleResponse(i,t,e)},scope:this}},getStyleNames:function(e){var t;return t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.toString().replace(/[^,]/g,"")},request:function(e,t){var i=this.findLayers();if(0==i.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(t=t||{},this.drillDown===!1){var n=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),r=OpenLayers.Request.GET(n);t.hover===!0&&(this.hoverRequest=r)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var o,s={},a=0,l=i.length;a<l;a++){var u=i[a];o=OpenLayers.Util.isArray(u.url)?u.url[0]:u.url,o in s?s[o].push(u):(this._numRequests++,s[o]=[u])}var i;for(var o in s){i=s[o];var n=this.buildWMSOptions(o,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(n)}}},triggerGetFeatureInfo:function(e,t,i){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:i,request:e,xy:t}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,i){var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var r=[],o=t.getAllResponseHeaders();r=o&&"application/json"===this.infoFormat&&o.indexOf("application/json")!==-1?(new OpenLayers.Format.GeoJSON).read(n):this.format.read(n),this.drillDown===!1?this.triggerGetFeatureInfo(t,e,r):(this._requestCount++,"object"===this.output?this._features=(this._features||[]).concat({url:i,features:r}):this._features=(this._features||[]).concat(r),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(t,e,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(e,t){OpenLayers.Format.GML.prototype.initialize.apply(this,[e]),this.layer=t,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var t=this.createElementNS(this.wfsns,"wfs:Transaction");t.setAttribute("version","1.0.0"),t.setAttribute("service","WFS");for(var i=0;i<e.length;i++)switch(e[i].state){case OpenLayers.State.INSERT:t.appendChild(this.insert(e[i]));break;case OpenLayers.State.UPDATE:t.appendChild(this.update(e[i]));break;case OpenLayers.State.DELETE:t.appendChild(this.remove(e[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.featureNS,"feature:"+this.geometryName);i.appendChild(t);var n=this.createElementNS(this.featureNS,"feature:"+this.featureName);n.appendChild(i);for(var r in e.attributes){var o=this.createTextNode(e.attributes[r]),s=r;r.search(":")!=-1&&(s=r.split(":")[1]);var a=this.createElementNS(this.featureNS,"feature:"+s);a.appendChild(o),n.appendChild(a)}return n},insert:function(e){var t=this.createElementNS(this.wfsns,"wfs:Insert");return t.appendChild(this.createFeatureXML(e)),t},update:function(e){e.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var t=this.createElementNS(this.wfsns,"wfs:Update");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.wfsns,"wfs:Property"),n=this.createElementNS(this.wfsns,"wfs:Name"),r=this.createTextNode(this.geometryName);n.appendChild(r),i.appendChild(n);var o=this.createElementNS(this.wfsns,"wfs:Value"),s=this.buildGeometryNode(e.geometry);e.layer&&s.setAttribute("srsName",e.layer.projection.getCode()),o.appendChild(s),i.appendChild(o),t.appendChild(i);for(var a in e.attributes)i=this.createElementNS(this.wfsns,"wfs:Property"),n=this.createElementNS(this.wfsns,"wfs:Name"),n.appendChild(this.createTextNode(a)),i.appendChild(n),o=this.createElementNS(this.wfsns,"wfs:Value"),o.appendChild(this.createTextNode(e.attributes[a])),i.appendChild(o),t.appendChild(i);var l=this.createElementNS(this.ogcns,"ogc:Filter"),u=this.createElementNS(this.ogcns,"ogc:FeatureId");return u.setAttribute("fid",e.fid),l.appendChild(u),t.appendChild(l),t},remove:function(e){if(!e.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var t=this.createElementNS(this.wfsns,"wfs:Delete");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.ogcns,"ogc:Filter"),n=this.createElementNS(this.ogcns,"ogc:FeatureId");return n.setAttribute("fid",e.fid),i.appendChild(n),t.appendChild(i),t},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(e){this.handlerMode=e,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),!!this.handler},initialize:function(e){e=e||{},e.handlerOptions=e.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[e]),this.resetHandler()},handleEvent:function(e){if(null==e)return void this.reset();var t=this.map.getLonLatFromPixel(e.xy);if(t){var i=this.findLayers();if(i.length>0){for(var n,r,o={},s=0,a=i.length;s<a;s++)n=i[s],r=OpenLayers.Util.indexOf(this.map.layers,n),o[r]=n.getFeatureInfo(t);this.callback(o,t,e.xy)}}},callback:function(e){},reset:function(e){this.callback(null)},findLayers:function(){for(var e,t=this.layers||this.map.layers,i=[],n=t.length-1;n>=0;--n)e=t[n],e instanceof OpenLayers.Layer.UTFGrid&&i.push(e);return i},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Format.CQL=function(){function e(e,t){return t instanceof RegExp?t.exec(e):t(e)}function t(t,i){var n,r,s=i.length;for(n=0;n<s;n++){r=i[n];var a=o[r],l=e(t,a);if(l){var u=l[0],c=t.substr(u.length).replace(/^\s*/,"");return{type:r,text:u,remainder:c}}}var h="ERROR: In parsing: ["+t+"], expected one of: ";for(n=0;n<s;n++)r=i[n],h+="\n    "+r+": "+o[r];throw new Error(h)}function i(e){var i,n=[],r=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(i=t(e,r),e=i.remainder,r=s[i.type],"END"!=i.type&&!r)throw new Error("No follows list for "+i.type);n.push(i)}while("END"!=i.type);return n}function n(e){function t(){var e=n.pop();switch(e.type){case"LOGICAL":var i=t(),r=t();return new OpenLayers.Filter.Logical({filters:[r,i],type:u[e.text.toUpperCase()]});case"NOT":var o=t();return new OpenLayers.Filter.Logical({filters:[o],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var s,l,c;return n.pop(),l=t(),s=t(),c=t(),new OpenLayers.Filter.Comparison({property:c,lowerBoundary:s,upperBoundary:l,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var h=t(),c=t();return new OpenLayers.Filter.Comparison({property:c,value:h,type:a[e.text.toUpperCase()]});case"IS_NULL":var c=t();return new OpenLayers.Filter.Comparison({property:c,type:a[e.text.toUpperCase()]});case"VALUE":var d=e.text.match(/^'(.*)'$/);return d?d[1].replace(/''/g,"'"):Number(e.text);case"SPATIAL":switch(e.text.toUpperCase()){case"BBOX":var p=t(),f=t(),m=t(),g=t(),y=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:y,value:OpenLayers.Bounds.fromArray([g,m,f,p])});case"INTERSECTS":var h=t(),c=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:c,value:h});case"WITHIN":var h=t(),c=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:c,value:h});case"CONTAINS":var h=t(),c=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:c,value:h});case"DWITHIN":var v=t(),h=t(),c=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:h,property:c,distance:Number(v)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(e.text);default:return e.text}}for(var i=[],n=[];e.length;){var r=e.shift();switch(r.type){case"PROPERTY":case"GEOMETRY":case"VALUE":n.push(r);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var o=h[r.type];i.length>0&&h[i[i.length-1].type]<=o;)n.push(i.pop());i.push(r);break;case"SPATIAL":case"NOT":case"LPAREN":i.push(r);break;case"RPAREN":for(;i.length>0&&"LPAREN"!=i[i.length-1].type;)n.push(i.pop());i.pop(),i.length>0&&"SPATIAL"==i[i.length-1].type&&n.push(i.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+r.type)}}for(;i.length>0;)n.push(i.pop());var s=t();if(n.length>0){for(var l="Remaining tokens after building AST: \n",c=n.length-1;c>=0;c--)l+=n[c].type+": "+n[c].text+"\n";throw new Error(l)}return s}var r,o={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|-?\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length,n=e.indexOf("(",t[0].length);if(n>-1)for(var r=1;n<i&&r>0;)switch(n++,e.charAt(n)){case"(":r++;break;case")":r--}return[e.substr(0,n+1)]}},END:/^$/},s={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},a={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},l={},u={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},c={},h={RPAREN:3,LOGICAL:2,COMPARISON:1};for(r in a)a.hasOwnProperty(r)&&(l[a[r]]=r);for(r in u)u.hasOwnProperty(r)&&(c[u[r]]=r);return OpenLayers.Class(OpenLayers.Format,{read:function(e){var t=n(i(e));return this.keepData&&(this.data=t),t},write:function(e){if(e instanceof OpenLayers.Geometry)return e.toString();switch(e.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw new Error("Unknown spatial filter type: "+e.type)}case"OpenLayers.Filter.Logical":if(e.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(e.filters[0])+")";for(var t="(",i=!0,n=0;n<e.filters.length;n++)i?i=!1:t+=") "+c[e.type]+" (",t+=this.write(e.filters[n]);return t+")";case"OpenLayers.Filter.Comparison":return e.type==OpenLayers.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):null!==e.value?e.property+" "+l[e.type]+" "+this.write(e.value):e.property+" "+l[e.type];case void 0:if("string"==typeof e)return"'"+e.replace(/'/g,"''")+"'";if("number"==typeof e)return String(e);default:throw new Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.source&&this.setSource(this.options.source)},setSource:function(e){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=e,this.activate()):this.source=e},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(e){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(e)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),e},onSketchComplete:function(e){return this.feature=null,!this.considerSplit(e.feature)},afterFeatureModified:function(e){if(e.modified){var t=e.feature;"function"==typeof t.geometry.split&&(this.feature=e.feature,this.considerSplit(e.feature))}},removeByGeometry:function(e,t){for(var i=0,n=e.length;i<n;++i)if(e[i].geometry===t){e.splice(i,1);break}},isEligible:function(e){return!!e.geometry&&(e.state!==OpenLayers.State.DELETE&&"function"==typeof e.geometry.split&&this.feature!==e&&(!this.targetFilter||this.targetFilter.evaluate(e.attributes)))},considerSplit:function(e){var t=!1,i=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(e.attributes)){for(var n,r,o,s,a,l,u,c=this.layer&&this.layer.features||[],h=[],d=[],p=this.layer===this.source&&this.mutual,f={edge:this.edge,tolerance:this.tolerance,mutual:p},m=[e.geometry],g=0,y=c.length;g<y;++g)if(s=c[g],this.isEligible(s)){a=[s.geometry];for(var v=0;v<m.length;++v){l=m[v];for(var E=0;E<a.length;++E)n=a[E],l.getBounds().intersectsBounds(n.getBounds())&&(r=l.split(n,f),r&&(o=this.events.triggerEvent("beforesplit",{source:e,target:s}),o!==!1&&(p&&(u=r[0],u.length>1&&(u.unshift(v,1),Array.prototype.splice.apply(m,u),v+=u.length-3),r=r[1]),r.length>1&&(r.unshift(E,1),Array.prototype.splice.apply(a,r),E+=r.length-3))))}a&&a.length>1&&(this.geomsToFeatures(s,a),this.events.triggerEvent("split",{original:s,features:a}),Array.prototype.push.apply(h,a),d.push(s),i=!0)}if(m&&m.length>1&&(this.geomsToFeatures(e,m),this.events.triggerEvent("split",{original:e,features:m}),Array.prototype.push.apply(h,m),d.push(e),t=!0),t||i){if(this.deferDelete){for(var T,b=[],g=0,y=d.length;g<y;++g)T=d[g],T.state===OpenLayers.State.INSERT?b.push(T):(T.state=OpenLayers.State.DELETE,this.layer.drawFeature(T));this.layer.destroyFeatures(b,{silent:!0});for(var g=0,y=h.length;g<y;++g)h[g].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(d,{silent:!0});this.layer.addFeatures(h,{silent:!0}),this.events.triggerEvent("aftersplit",{source:e,features:h})}}return t},geomsToFeatures:function(e,t){var i=e.clone();delete i.geometry;for(var n,r=0,o=t.length;r<o;++r)n=i.clone(),n.geometry=t[r],n.state=OpenLayers.State.INSERT,
t[r]=n},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw new Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var n=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,n),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var r=this.matrixIds.length;if(r&&"string"==typeof this.matrixIds[0]){var o=this.matrixIds;this.matrixIds=new Array(r);for(var s=0;s<r;++s)this.matrixIds[s]={identifier:o[s]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t,i){return!t&&this.matrix||this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,n=Number.POSITIVE_INFINITY,r=0,o=this.matrixIds.length;r<o;++r)t=Math.abs(1-this.matrixIds[r].scaleDenominator/i),t<n&&(n=t,e=this.matrixIds[r]);else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),n=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),r=Math.floor(i),o=Math.floor(n);return{col:r,row:o,i:Math.floor((i-r)*this.tileSize.w),j:Math.floor((n-o)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var i,n=e.getCenterLonLat(),r=this.getTileInfo(n),o=(this.matrix.identifier,this.dimensions);if(t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,r.row,r.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(i=this.params,t.indexOf("{")!==-1){var s=t.replace(/\{/g,"${"),a={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:r.row,TileCol:r.col};if(o){var l,u;for(u=o.length-1;u>=0;--u)l=o[u],a[l]=i[l.toUpperCase()]}t=OpenLayers.String.format(s,a)}else{var c=this.version+"/"+this.layer+"/"+this.style+"/";if(o)for(var u=0;u<o.length;u++)void 0!==i[o[u]]&&(c=c+i[o[u]]+"/");c=c+this.matrixSet+"/"+this.matrix.identifier+"/"+r.row+"/"+r.col+"."+this.formatSuffix,t.match(/\/$/)||(t+="/"),t+=c}else"KVP"===this.requestEncoding.toUpperCase()&&(i={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:r.row,TILECOL:r.col,FORMAT:this.format},t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[i]))}return t},mergeNewParams:function(e){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)])},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.format,n=OpenLayers.Format.XML.prototype.write.apply(i,[i.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),data:n}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&i.status<300?(e.features=this.parseFeatures(i),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(e,t,i,n){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),r=-Math.round(e.top/t),o=Math.floor(n/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,s=Math.floor(r/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,a=["/",this.params.map,"/",i,"/",this.params.g.replace(/\s/g,"_"),"/def/t",s,"/l",o,"/t",r,"l",n,".",this.extension],l=this.url;return OpenLayers.Util.isArray(l)&&(l=this.selectUrl(a.join(""),l)),l+a.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(e,t,i,n){this.layername=i,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},n]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getServerResolution(),i=this.maxExtent,n=this.tileSize,r=Math.round((e.left-i.left)/(t*n.w)),o=Math.round((e.bottom-i.bottom)/(t*n.h)),s=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom(),a=[this.layername,OpenLayers.Number.zeroPad(s,2),OpenLayers.Number.zeroPad(parseInt(r/1e6),3),OpenLayers.Number.zeroPad(parseInt(r/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(r)%1e3,3),OpenLayers.Number.zeroPad(parseInt(o/1e6),3),OpenLayers.Number.zeroPad(parseInt(o/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(o)%1e3,3)+"."+this.extension],l=a.join("/"),u=this.url;return OpenLayers.Util.isArray(u)&&(u=this.selectUrl(l,u)),u="/"==u.charAt(u.length-1)?u:u+"/",u+l},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]},this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i),t.tileSets.push(i)},Resolutions:function(e,t){for(var i=this.getChildValue(e).split(" "),n=0,r=i.length;n<r;n++)""!=i[n]&&t.resolutions.push(parseFloat(i[n]))},Width:function(e,t){t.width=parseInt(this.getChildValue(e))},Height:function(e,t){t.height=parseInt(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(e){return"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),this.parseFeatures(e)},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNSPlus("atom:feed"),t.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var i=0,n=e.length;i<n;i++)t.appendChild(this.buildEntryNode(e[i]))}else t=this.buildEntryNode(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},buildContentNode:function(e){var t=this.createElementNSPlus("atom:content",{attributes:{type:e.type||null}});if(e.src)t.setAttribute("src",e.src);else if("text"==e.type||null==e.type)t.appendChild(this.createTextNode(e.value));else if("html"==e.type){if("string"!=typeof e.value)throw"HTML content must be in form of an escaped string";t.appendChild(this.createTextNode(e.value))}else"xhtml"==e.type?t.appendChild(e.value):"xhtml"==e.type||e.type.match(/(\+|\/)xml$/)?t.appendChild(e.value):t.appendChild(this.createTextNode(e.value));return t},buildEntryNode:function(e){var t=e.attributes,i=t.atom||{},n=this.createElementNSPlus("atom:entry");if(i.authors)for(var r=OpenLayers.Util.isArray(i.authors)?i.authors:[i.authors],o=0,s=r.length;o<s;o++)n.appendChild(this.buildPersonConstructNode("author",r[o]));if(i.categories)for(var a,l=OpenLayers.Util.isArray(i.categories)?i.categories:[i.categories],o=0,s=l.length;o<s;o++)a=l[o],n.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:a.term,scheme:a.scheme||null,label:a.label||null}}));if(i.content&&n.appendChild(this.buildContentNode(i.content)),i.contributors)for(var u=OpenLayers.Util.isArray(i.contributors)?i.contributors:[i.contributors],o=0,s=u.length;o<s;o++)n.appendChild(this.buildPersonConstructNode("contributor",u[o]));if(e.fid&&n.appendChild(this.createElementNSPlus("atom:id",{value:e.fid})),i.links)for(var c,h=OpenLayers.Util.isArray(i.links)?i.links:[i.links],o=0,s=h.length;o<s;o++)c=h[o],n.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:c.href,rel:c.rel||null,type:c.type||null,hreflang:c.hreflang||null,title:c.title||null,length:c.length||null}}));if(i.published&&n.appendChild(this.createElementNSPlus("atom:published",{value:i.published})),i.rights&&n.appendChild(this.createElementNSPlus("atom:rights",{value:i.rights})),(i.summary||t.description)&&n.appendChild(this.createElementNSPlus("atom:summary",{value:i.summary||t.description})),n.appendChild(this.createElementNSPlus("atom:title",{value:i.title||t.title||this.defaultEntryTitle})),i.updated&&n.appendChild(this.createElementNSPlus("atom:updated",{value:i.updated})),e.geometry){var d=this.createElementNSPlus("georss:where");d.appendChild(this.buildGeometryNode(e.geometry)),n.appendChild(d)}return n},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(e){this.gmlParser||this.initGmlParser();var t=this.gmlParser.writeNode("feature:_geometry",e);return t.firstChild},buildPersonConstructNode:function(e,t){var i=["uri","email"],n=this.createElementNSPlus("atom:"+e);n.appendChild(this.createElementNSPlus("atom:name",{value:t.name}));for(var r=0,o=i.length;r<o;r++)t[i[r]]&&n.appendChild(this.createElementNSPlus("atom:"+i[r],{value:t[i[r]]}));return n},getFirstChildValue:function(e,t,i,n){var r,o=this.getElementsByTagNameNS(e,t,i);return r=o&&o.length>0?this.getChildValue(o[0],n):n},parseFeature:function(e){var t={},i=null,n=null,r=null,o=this.namespaces.atom;this.parsePersonConstructs(e,"author",t),n=this.getElementsByTagNameNS(e,o,"category"),n.length>0&&(t.categories=[]);for(var s=0,a=n.length;s<a;s++)i={},i.term=n[s].getAttribute("term"),r=n[s].getAttribute("scheme"),r&&(i.scheme=r),r=n[s].getAttribute("label"),r&&(i.label=r),t.categories.push(i);n=this.getElementsByTagNameNS(e,o,"content"),n.length>0&&(i={},r=n[0].getAttribute("type"),r&&(i.type=r),r=n[0].getAttribute("src"),r?i.src=r:("text"==i.type||"html"==i.type||null==i.type?i.value=this.getFirstChildValue(e,o,"content",null):"xhtml"==i.type||i.type.match(/(\+|\/)xml$/)?i.value=this.getChildEl(n[0]):i.value=this.getFirstChildValue(e,o,"content",null),t.content=i)),this.parsePersonConstructs(e,"contributor",t),t.id=this.getFirstChildValue(e,o,"id",null),n=this.getElementsByTagNameNS(e,o,"link"),n.length>0&&(t.links=new Array(n.length));for(var l=["rel","type","hreflang","title","length"],s=0,a=n.length;s<a;s++){i={},i.href=n[s].getAttribute("href");for(var u=0,c=l.length;u<c;u++)r=n[s].getAttribute(l[u]),r&&(i[l[u]]=r);t.links[s]=i}i=this.getFirstChildValue(e,o,"published",null),i&&(t.published=i),i=this.getFirstChildValue(e,o,"rights",null),i&&(t.rights=i),i=this.getFirstChildValue(e,o,"summary",null),i&&(t.summary=i),t.title=this.getFirstChildValue(e,o,"title",null),t.updated=this.getFirstChildValue(e,o,"updated",null);var h={title:t.title,description:t.summary,atom:t},d=this.parseLocations(e)[0],p=new OpenLayers.Feature.Vector(d,h);return p.fid=t.id,p},parseFeatures:function(e){var t=[],i=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");0==i.length&&(i=[e]);for(var n=0,r=i.length;n<r;n++)t.push(this.parseFeature(i[n]));return t},parseLocations:function(e){var t=this.namespaces.georss,i={components:[]},n=this.getElementsByTagNameNS(e,t,"where");if(n&&n.length>0){this.gmlParser||this.initGmlParser();for(var r=0,o=n.length;r<o;r++)this.gmlParser.readChildNodes(n[r],i)}var s=i.components,a=this.getElementsByTagNameNS(e,t,"point");if(a&&a.length>0)for(var r=0,o=a.length;r<o;r++){var l=OpenLayers.String.trim(a[r].firstChild.nodeValue).split(/\s+/);2!=l.length&&(l=OpenLayers.String.trim(a[r].firstChild.nodeValue).split(/\s*,\s*/)),s.push(new OpenLayers.Geometry.Point(l[1],l[0]))}var u=this.getElementsByTagNameNS(e,t,"line");if(u&&u.length>0)for(var c,h,d,r=0,o=u.length;r<o;r++){c=OpenLayers.String.trim(u[r].firstChild.nodeValue).split(/\s+/),d=[];for(var p=0,f=c.length;p<f;p+=2)h=new OpenLayers.Geometry.Point(c[p+1],c[p]),d.push(h);s.push(new OpenLayers.Geometry.LineString(d))}var m=this.getElementsByTagNameNS(e,t,"polygon");if(m&&m.length>0)for(var c,h,d,r=0,o=m.length;r<o;r++){c=OpenLayers.String.trim(m[r].firstChild.nodeValue).split(/\s+/),d=[];for(var p=0,f=c.length;p<f;p+=2)h=new OpenLayers.Geometry.Point(c[p+1],c[p]),d.push(h);s.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)]))}if(this.internalProjection&&this.externalProjection)for(var r=0,o=s.length;r<o;r++)s[r]&&s[r].transform(this.externalProjection,this.internalProjection);return s},parsePersonConstructs:function(e,t,i){for(var n=[],r=this.namespaces.atom,o=this.getElementsByTagNameNS(e,r,t),s=["uri","email"],a=0,l=o.length;a<l;a++){var u={};u.name=this.getFirstChildValue(o[a],r,"name",null);for(var c=0,h=s.length;c<h;c++){var d=this.getFirstChildValue(o[a],r,s[c],null);d&&(u[s[c]]=d)}n.push(u)}n.length>0&&(i[t+"s"]=n)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(e){var t=e.buttonElement;t===this.minimizeDiv?this.minimizeControl():t===this.maximizeDiv?this.maximizeControl():t._layerSwitcher===this.id&&(t["for"]&&(t=document.getElementById(t["for"])),t.disabled||("radio"==t.type?(t.checked=!0,this.map.setBaseLayer(this.map.getLayer(t._layer))):(t.checked=!t.checked,this.updateMap())))},clearLayersArray:function(e){this[e+"LayersDiv"].innerHTML="",this[e+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var e=0,t=this.layerStates.length;e<t;e++){var i=this.layerStates[e],n=this.map.layers[e];if(i.name!=n.name||i.inRange!=n.inRange||i.id!=n.id||i.visibility!=n.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var e=!1,t=!1,i=this.map.layers.length;this.layerStates=new Array(i);for(var n=0;n<i;n++){var r=this.map.layers[n];this.layerStates[n]={name:r.name,visibility:r.visibility,inRange:r.inRange,id:r.id}}var o=this.map.layers.slice();this.ascending||o.reverse();for(var n=0,i=o.length;n<i;n++){var r=o[n],s=r.isBaseLayer;if(r.displayInLayerSwitcher){s?t=!0:e=!0;var a=s?r==this.map.baseLayer:r.getVisibility(),l=document.createElement("input"),u=OpenLayers.Util.createUniqueID(this.id+"_input_");l.id=u,l.name=s?this.id+"_baseLayers":r.name,l.type=s?"radio":"checkbox",l.value=r.name,l.checked=a,l.defaultChecked=a,l.className="olButton",l._layer=r.id,l._layerSwitcher=this.id,s||r.inRange||(l.disabled=!0);var c=document.createElement("label");c["for"]=l.id,OpenLayers.Element.addClass(c,"labelSpan olButton"),c._layer=r.id,c._layerSwitcher=this.id,s||r.inRange||(c.style.color="gray"),c.innerHTML=r.name,c.style.verticalAlign=s?"bottom":"baseline";var h=document.createElement("br"),d=s?this.baseLayers:this.dataLayers;d.push({layer:r,inputElem:l,labelSpan:c});var p=s?this.baseLayersDiv:this.dataLayersDiv;p.appendChild(l),p.appendChild(c),p.appendChild(h)}}return this.dataLbl.style.display=e?"":"none",this.baseLbl.style.display=t?"":"none",this.div},updateMap:function(){for(var e=0,t=this.baseLayers.length;e<t;e++){var i=this.baseLayers[e];i.inputElem.checked&&this.map.setBaseLayer(i.layer,!1)}for(var e=0,t=this.dataLayers.length;e<t;e++){var i=this.dataLayers[e];i.layer.setVisibility(i.inputElem.checked)}},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":"",this.layersDiv.style.display=e?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv);var e=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,e,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv);var e=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,e,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var e=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(e){var t=this.layer.getURL(this.bounds),i=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&t.length>this.maxGetUrlLength;var n=i&&!this.useIFrame,r=!i&&this.useIFrame;(n||r)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,n&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var e=document.createElement("div"),t=e.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex=1,t.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(e)}var i,n=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(i=document.createElement('<iframe name="'+n+'">'),i.style.backgroundColor="#FFFFFF",i.style.filter="chroma(color=#FFFFFF)"):(i=document.createElement("iframe"),i.style.backgroundColor="transparent",i.name=n),i.scrolling="no",i.marginWidth="0px",i.marginHeight="0px",i.frameBorder="0",i.style.position="absolute",i.style.width="100%",i.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(i),this.imgDiv=i,i}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),e.target=this.id+"_iFrame";var i,n=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var r in n)i=document.createElement("input"),i.type="hidden",i.name=r,i.value=n[r],e.appendChild(i);return e},setImgSrc:function(e){if(this.useIFrame===!0)if(e){var t=this.createRequestForm();this.frame.appendChild(t),t.submit(),this.frame.removeChild(t)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var e;return this.useIFrame===!1&&(e=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),e}},OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var e=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:e})},defaultKeyPress:function(e){var t,i=!0,n=OpenLayers.Event.element(e);if(!n||"INPUT"!=n.tagName&&"TEXTAREA"!=n.tagName&&"SELECT"!=n.tagName){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:t=this.map.getSize(),this.map.pan(0,-.75*t.h);break;case 34:t=this.map.getSize(),this.map.pan(0,.75*t.h);break;case 35:t=this.map.getSize(),this.map.pan(.75*t.w,0);break;case 36:t=this.map.getSize(),this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:i=!1}i&&OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),angular.module("gettext",[]),angular.module("gettext").constant("gettext",function(e){return e}),angular.module("gettext").factory("gettextCatalog",["gettextPlurals","gettextFallbackLanguage","$http","$cacheFactory","$interpolate","$rootScope",function(e,t,i,n,r,o){function s(){o.$broadcast("gettextLanguageChanged")}var a,l="$$noContext",u='<span id="test" title="test" class="tested">test</span>',c=angular.element("<span>"+u+"</span>").html()!==u,h=function(e){return a.debug&&a.currentLanguage!==a.baseLanguage?a.debugPrefix+e:e},d=function(e){return a.showTranslatedMarkers?a.translatedMarkerPrefix+e+a.translatedMarkerSuffix:e};return a={debug:!1,debugPrefix:"[MISSING]: ",showTranslatedMarkers:!1,translatedMarkerPrefix:"[",translatedMarkerSuffix:"]",strings:{},baseLanguage:"en",currentLanguage:"en",cache:n("strings"),setCurrentLanguage:function(e){this.currentLanguage=e,s()},getCurrentLanguage:function(){return this.currentLanguage},setStrings:function(t,i){this.strings[t]||(this.strings[t]={});var n=e(t,1);for(var r in i){var o=i[r];if(c&&(r=angular.element("<span>"+r+"</span>").html()),angular.isString(o)||angular.isArray(o)){var a={};a[l]=o,o=a}this.strings[t][r]||(this.strings[t][r]={});for(var u in o){var h=o[u];angular.isArray(h)?this.strings[t][r][u]=h:(this.strings[t][r][u]=[],this.strings[t][r][u][n]=h)}}s()},getStringFormFor:function(t,i,n,r){if(!t)return null;var o=this.strings[t]||{},s=o[i]||{},a=s[r||l]||[];return a[e(t,n)]},getString:function(e,i,n){var o=t(this.currentLanguage);return e=this.getStringFormFor(this.currentLanguage,e,1,n)||this.getStringFormFor(o,e,1,n)||h(e),e=i?r(e)(i):e,d(e)},getPlural:function(e,i,n,o,s){var a=t(this.currentLanguage);return i=this.getStringFormFor(this.currentLanguage,i,e,s)||this.getStringFormFor(a,i,e,s)||h(1===e?i:n),o&&(o.$count=e,i=r(i)(o)),d(i)},loadRemote:function(e){return i({method:"GET",url:e,cache:a.cache}).then(function(e){var t=e.data;for(var i in t)a.setStrings(i,t[i]);return e})}}}]),angular.module("gettext").directive("translate",["gettextCatalog","$parse","$animate","$compile","$window","gettextUtil",function(e,t,i,n,r,o){function s(e){return o.lcFirst(e.replace(u,""))}function a(e,t,i){var n=Object.keys(t).filter(function(e){return o.startsWith(e,u)&&e!==u});if(!n.length)return null;var r=angular.extend({},e),a=[];return n.forEach(function(n){var o=e.$watch(t[n],function(e){var t=s(n);r[t]=e,i(r)});a.push(o)}),e.$on("$destroy",function(){a.forEach(function(e){e()})}),r}var l=parseInt((/msie (\d+)/.exec(angular.lowercase(r.navigator.userAgent))||[])[1],10),u="translateParams";return{restrict:"AE",terminal:!0,compile:function(r,s){o.assert(!s.translatePlural||s.translateN,"translate-n","translate-plural"),o.assert(!s.translateN||s.translatePlural,"translate-plural","translate-n");var u=o.trim(r.html()),c=s.translatePlural,h=s.translateContext;return l<=8&&"<!--IE fix-->"===u.slice(-13)&&(u=u.slice(0,-13)),{post:function(r,s,l){function d(t){t=t||null;var a;c?(r=f||(f=r.$new()),r.$count=p(r),a=e.getPlural(r.$count,u,c,t,h)):a=e.getString(u,t,h);var l=s.contents();if(0!==l.length){if(a===o.trim(l.html()))return void(m&&n(l)(r));var d=angular.element("<span>"+a+"</span>");n(d.contents())(r);var g=d.contents();i.enter(g,s),i.leave(l)}}var p=t(l.translateN),f=null,m=!0,g=a(r,l,d);d(g),m=!1,l.translateN&&r.$watch(l.translateN,function(){d(g)}),r.$on("gettextLanguageChanged",function(){d(g)})}}}}}]),angular.module("gettext").factory("gettextFallbackLanguage",function(){var e={},t=/([^_]+)_[^_]+$/;return function(i){if(e[i])return e[i];var n=t.exec(i);return n?(e[i]=n[1],n[1]):null}}),angular.module("gettext").filter("translate",["gettextCatalog",function(e){function t(t,i){return e.getString(t,null,i)}return t.$stateful=!0,t}]),angular.module("gettext").factory("gettextPlurals",function(){function e(e){return t[e]||(t[e]=e.split(/\-|_/).shift()),t[e]}var t={pt_BR:"pt_BR","pt-BR":"pt_BR"};return function(t,i){switch(e(t)){case"ay":case"bo":case"cgg":case"dz":case"fa":case"id":case"ja":case"jbo":case"ka":case"kk":case"km":case"ko":case"ky":case"lo":case"ms":case"my":case"sah":case"su":case"th":case"tt":case"ug":case"vi":case"wo":case"zh":return 0;case"is":return i%10!=1||i%100==11?1:0;case"jv":return 0!=i?1:0;case"mk":return 1==i||i%10==1?0:1;case"ach":case"ak":case"am":case"arn":case"br":case"fil":case"fr":case"gun":case"ln":case"mfe":case"mg":case"mi":case"oc":case"pt_BR":case"tg":case"ti":case"tr":case"uz":case"wa":case"zh":return i>1?1:0;case"lv":return i%10==1&&i%100!=11?0:0!=i?1:2;case"lt":return i%10==1&&i%100!=11?0:i%10>=2&&(i%100<10||i%100>=20)?1:2;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return i%10==1&&i%100!=11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;case"mnk":return 0==i?0:1==i?1:2;case"ro":return 1==i?0:0==i||i%100>0&&i%100<20?1:2;case"pl":return 1==i?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;case"cs":case"sk":return 1==i?0:i>=2&&i<=4?1:2;case"sl":return i%100==1?1:i%100==2?2:i%100==3||i%100==4?3:0;case"mt":return 1==i?0:0==i||i%100>1&&i%100<11?1:i%100>10&&i%100<20?2:3;case"gd":return 1==i||11==i?0:2==i||12==i?1:i>2&&i<20?2:3;case"cy":return 1==i?0:2==i?1:8!=i&&11!=i?2:3;case"kw":return 1==i?0:2==i?1:3==i?2:3;case"ga":return 1==i?0:2==i?1:i<7?2:i<11?3:4;case"ar":return 0==i?0:1==i?1:2==i?2:i%100>=3&&i%100<=10?3:i%100>=11?4:5;default:return 1!=i?1:0}}}),angular.module("gettext").factory("gettextUtil",function(){function e(e,t,i){if(!e)throw new Error("You should add a "+t+" attribute whenever you add a "+i+" attribute.")}function t(e,t){return 0===e.indexOf(t)}function i(e){var t=e.charAt(0).toLowerCase();return t+e.substr(1)}var n=function(){return String.prototype.trim?function(e){return"string"==typeof e?e.trim():e}:function(e){return"string"==typeof e?e.replace(/^\s*/,"").replace(/\s*$/,""):e}}();return{trim:n,assert:e,startsWith:t,lcFirst:i}}),function(e,t){var i=t.isDefined,n=t.isUndefined,r=t.isNumber,o=t.isObject,s=t.isArray,a=t.isString,l=t.extend,u=t.toJson;t.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1
},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setDefaultToCookie=function(e){return this.defaultToCookie=!!e,this},this.setStorageCookie=function(e,t,i){return this.cookie.expiry=e,this.cookie.path=t,this.cookie.secure=i,this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(e,t,c,h,d){function p(i){if(i||(i=t.event),v.setItem&&a(i.key)&&C(i.key)){var n=b(i.key);d(function(){e.$broadcast("LocalStorageModule.notification.changed",{key:n,newvalue:i.newValue,storageType:m.storageType})})}}var f,m=this,g=m.prefix,y=m.cookie,v=m.notify,E=m.storageType;c?c[0]&&(c=c[0]):c=document,"."!==g.substr(-1)&&(g=g?g+".":"");var T=function(e){return g+e},b=function(e){return e.replace(new RegExp("^"+g,"g"),"")},C=function(e){return 0===e.indexOf(g)},O=function(){try{var i=E in t&&null!==t[E],n=T("__"+Math.round(1e7*Math.random()));return i&&(f=t[E],f.setItem(n,""),f.removeItem(n)),i}catch(r){return m.defaultToCookie&&(E="cookie"),e.$broadcast("LocalStorageModule.notification.error",r.message),!1}},x=O(),w=function(t,i,r){if(k(r),i=n(i)?null:u(i),!x&&m.defaultToCookie||"cookie"===m.storageType)return x||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:"cookie"}),D(t,i);try{f&&f.setItem(T(t),i),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:m.storageType})}catch(o){return e.$broadcast("LocalStorageModule.notification.error",o.message),D(t,i)}return!0},R=function(t,i){if(k(i),!x&&m.defaultToCookie||"cookie"===m.storageType)return x||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),M(t);var n=f?f.getItem(T(t)):null;if(!n||"null"===n)return null;try{return JSON.parse(n)}catch(r){return n}},L=function(){var t=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(t=1,k(arguments[arguments.length-1]));var i,n;for(i=0;i<arguments.length-t;i++)if(n=arguments[i],!x&&m.defaultToCookie||"cookie"===m.storageType)x||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:n,storageType:"cookie"}),A(n);else try{f.removeItem(T(n)),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:n,storageType:m.storageType})}catch(r){e.$broadcast("LocalStorageModule.notification.error",r.message),A(n)}},S=function(t){if(k(t),!x)return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var i=g.length,n=[];for(var r in f)if(r.substr(0,i)===g)try{n.push(r.substr(i))}catch(o){return e.$broadcast("LocalStorageModule.notification.error",o.Description),[]}return n},_=function(t,i){k(i);var n=g?new RegExp("^"+g):new RegExp,r=t?new RegExp(t):new RegExp;if(!x&&m.defaultToCookie||"cookie"===m.storageType)return x||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),N();if(!x&&!m.defaultToCookie)return!1;var o=g.length;for(var s in f)if(n.test(s)&&r.test(s.substr(o)))try{L(s.substr(o))}catch(a){return e.$broadcast("LocalStorageModule.notification.error",a.message),N()}return!0},I=function(){try{return t.navigator.cookieEnabled||"cookie"in c&&(c.cookie.length>0||(c.cookie="test").indexOf.call(c.cookie,"test")>-1)}catch(i){return e.$broadcast("LocalStorageModule.notification.error",i.message),!1}}(),D=function(t,i,a,l){if(n(i))return!1;if((s(i)||o(i))&&(i=u(i)),!I)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var h="",d=new Date,p="";if(null===i?(d.setTime(d.getTime()+-864e5),h="; expires="+d.toGMTString(),i=""):r(a)&&0!==a?(d.setTime(d.getTime()+24*a*60*60*1e3),h="; expires="+d.toGMTString()):0!==y.expiry&&(d.setTime(d.getTime()+24*y.expiry*60*60*1e3),h="; expires="+d.toGMTString()),t){var f="; path="+y.path;y.domain&&(p="; domain="+y.domain),"boolean"==typeof l?l===!0&&(p+="; secure"):y.secure===!0&&(p+="; secure"),c.cookie=T(t)+"="+encodeURIComponent(i)+h+f+p}}catch(m){return e.$broadcast("LocalStorageModule.notification.error",m.message),!1}return!0},M=function(t){if(!I)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var i=c.cookie&&c.cookie.split(";")||[],n=0;n<i.length;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(T(t)+"=")){var o=decodeURIComponent(r.substring(g.length+t.length+1,r.length));try{var s=JSON.parse(o);return"number"==typeof s?o:s}catch(a){return o}}}return null},A=function(e){D(e,null)},N=function(){for(var e=null,t=g.length,i=c.cookie.split(";"),n=0;n<i.length;n++){for(e=i[n];" "===e.charAt(0);)e=e.substring(1,e.length);var r=e.substring(t,e.indexOf("="));A(r)}},P=function(){return E},k=function(e){return e&&E!==e&&(E=e,x=O()),x},H=function(e,t,n,r,s){r=r||t;var a=R(r,s);return null===a&&i(n)?a=n:o(a)&&o(n)&&(a=l(a,n)),h(t).assign(e,a),e.$watch(t,function(e){w(r,e,s)},o(e[t]))};x&&(t.addEventListener?(t.addEventListener("storage",p,!1),e.$on("$destroy",function(){t.removeEventListener("storage",p)})):t.attachEvent&&(t.attachEvent("onstorage",p),e.$on("$destroy",function(){t.detachEvent("onstorage",p)})));var F=function(e){k(e);for(var i=0,n=t[E],r=0;r<n.length;r++)0===n.key(r).indexOf(g)&&i++;return i};return{isSupported:x,getStorageType:P,setStorageType:k,set:w,add:w,get:R,keys:S,remove:L,clearAll:_,bind:H,deriveKey:T,underiveKey:b,length:F,defaultToCookie:this.defaultToCookie,cookie:{isSupported:I,set:D,add:D,get:M,remove:A,clearAll:N}}}]})}(window,window.angular),!function(e,t,i){"use strict";function n(t){if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),this.support){this.supportDirectory=/Chrome/.test(e.navigator.userAgent),this.files=[],this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,allowDuplicateUploads:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,413,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1,initFileFn:null,readFileFn:o},this.opts={},this.events={};var i=this;this.onDrop=function(e){i.opts.onDropStopPropagation&&e.stopPropagation(),e.preventDefault();var t=e.dataTransfer;t.items&&t.items[0]&&t.items[0].webkitGetAsEntry?i.webkitReadDataTransfer(e):i.addFiles(t.files,e)},this.preventEvent=function(e){e.preventDefault()},this.opts=n.extend({},this.defaults,t||{})}}function r(e,t){this.flowObj=e,this.bytes=null,this.file=t,this.name=t.fileName||t.name,this.size=t.size,this.relativePath=t.relativePath||t.webkitRelativePath||this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.chunks=[],this.paused=!1,this.error=!1,this.averageSpeed=0,this.currentSpeed=0,this._lastProgressCallback=Date.now(),this._prevUploadedSize=0,this._prevProgress=0,this.bootstrap()}function o(e,t,i,n,r){var o="slice";e.file.slice?o="slice":e.file.mozSlice?o="mozSlice":e.file.webkitSlice&&(o="webkitSlice"),r.readFinished(e.file[o](t,i,n))}function s(e,t,i){this.flowObj=e,this.fileObj=t,this.offset=i,this.tested=!1,this.retries=0,this.pendingRetry=!1,this.preprocessState=0,this.readState=0,this.loaded=0,this.total=0,this.chunkSize=this.flowObj.opts.chunkSize,this.startByte=this.offset*this.chunkSize,this.computeEndByte=function(){var e=Math.min(this.fileObj.size,(this.offset+1)*this.chunkSize);return this.fileObj.size-e<this.chunkSize&&!this.flowObj.opts.forceChunkSize&&(e=this.fileObj.size),e},this.endByte=this.computeEndByte(),this.xhr=null;var n=this;this.event=function(e,t){t=Array.prototype.slice.call(arguments),t.unshift(n),n.fileObj.chunkEvent.apply(n.fileObj,t)},this.progressHandler=function(e){e.lengthComputable&&(n.loaded=e.loaded,n.total=e.total),n.event("progress",e)},this.testHandler=function(e){var t=n.status(!0);"error"===t?(n.event(t,n.message()),n.flowObj.uploadNextChunk()):"success"===t?(n.tested=!0,n.event(t,n.message()),n.flowObj.uploadNextChunk()):n.fileObj.paused||(n.tested=!0,n.send())},this.doneHandler=function(e){var t=n.status();if("success"===t||"error"===t)delete this.data,n.event(t,n.message()),n.flowObj.uploadNextChunk();else{n.event("retry",n.message()),n.pendingRetry=!0,n.abort(),n.retries++;var i=n.flowObj.opts.chunkRetryInterval;null!==i?setTimeout(function(){n.send()},i):n.send()}}}function a(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function l(e,t){return"function"==typeof e&&(t=Array.prototype.slice.call(arguments),e=e.apply(null,t.slice(1))),e}function u(e,t){setTimeout(e.bind(t),0)}function c(e,t){return h(arguments,function(t){t!==e&&h(t,function(t,i){e[i]=t})}),e}function h(e,t,i){if(e){var n;if("undefined"!=typeof e.length){for(n=0;n<e.length;n++)if(t.call(i,e[n],n)===!1)return}else for(n in e)if(e.hasOwnProperty(n)&&t.call(i,e[n],n)===!1)return}}var d=e.navigator.msPointerEnabled;n.prototype={on:function(e,t){e=e.toLowerCase(),this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)},off:function(e,t){e!==i?(e=e.toLowerCase(),t!==i?this.events.hasOwnProperty(e)&&a(this.events[e],t):delete this.events[e]):this.events={}},fire:function(e,t){t=Array.prototype.slice.call(arguments),e=e.toLowerCase();var i=!1;return this.events.hasOwnProperty(e)&&h(this.events[e],function(e){i=e.apply(this,t.slice(1))===!1||i},this),"catchall"!=e&&(t.unshift("catchAll"),i=this.fire.apply(this,t)===!1||i),!i},webkitReadDataTransfer:function(e){function t(e){e.readEntries(function(o){o.length?(s+=o.length,h(o,function(e){if(e.isFile){var r=e.fullPath;e.file(function(e){i(e,r)},n)}else e.isDirectory&&t(e.createReader())}),t(e)):r()},n)}function i(e,t){e.relativePath=t.substring(1),a.push(e),r()}function n(e){throw e}function r(){0==--s&&o.addFiles(a,e)}var o=this,s=e.dataTransfer.items.length,a=[];h(e.dataTransfer.items,function(e){var n=e.webkitGetAsEntry();return n?void(n.isFile?i(e.getAsFile(),n.fullPath):t(n.createReader())):void r()})},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;if("function"==typeof t)return t(e);var i=e.relativePath||e.webkitRelativePath||e.fileName||e.name;return e.size+"-"+i.replace(/[^0-9a-zA-Z_-]/gim,"")},uploadNextChunk:function(e){var t=!1;if(this.opts.prioritizeFirstAndLastChunk&&(h(this.files,function(e){return!e.paused&&e.chunks.length&&"pending"===e.chunks[0].status()?(e.chunks[0].send(),t=!0,!1):!e.paused&&e.chunks.length>1&&"pending"===e.chunks[e.chunks.length-1].status()?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return t;if(h(this.files,function(e){return e.paused||h(e.chunks,function(e){return"pending"===e.status()?(e.send(),t=!0,!1):void 0}),!t&&void 0}),t)return!0;var i=!1;return h(this.files,function(e){return e.isComplete()?void 0:(i=!0,!1)}),i||e||u(function(){this.fire("complete")},this),!1},assignBrowse:function(e,i,n,r){e instanceof Element&&(e=[e]),h(e,function(e){var o;"INPUT"===e.tagName&&"file"===e.type?o=e:(o=t.createElement("input"),o.setAttribute("type","file"),c(o.style,{visibility:"hidden",position:"absolute",width:"1px",height:"1px"}),e.appendChild(o),e.addEventListener("click",function(){o.click()},!1)),this.opts.singleFile||n||o.setAttribute("multiple","multiple"),i&&o.setAttribute("webkitdirectory","webkitdirectory"),h(r,function(e,t){o.setAttribute(t,e)});var s=this;o.addEventListener("change",function(e){e.target.value&&(s.addFiles(e.target.files,e),e.target.value="")},!1)},this)},assignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),h(e,function(e){e.addEventListener("dragover",this.preventEvent,!1),e.addEventListener("dragenter",this.preventEvent,!1),e.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),h(e,function(e){e.removeEventListener("dragover",this.preventEvent),e.removeEventListener("dragenter",this.preventEvent),e.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var e=!1;return h(this.files,function(t){return t.isUploading()?(e=!0,!1):void 0}),e},_shouldUploadNext:function(){var e=0,t=!0,i=this.opts.simultaneousUploads;return h(this.files,function(n){h(n.chunks,function(n){return"uploading"===n.status()&&(e++,e>=i)?(t=!1,!1):void 0})}),t&&e},upload:function(){var e=this._shouldUploadNext();if(e!==!1){this.fire("uploadStart");for(var t=!1,i=1;i<=this.opts.simultaneousUploads-e;i++)t=this.uploadNextChunk(!0)||t;t||u(function(){this.fire("complete")},this)}},resume:function(){h(this.files,function(e){e.resume()})},pause:function(){h(this.files,function(e){e.pause()})},cancel:function(){for(var e=this.files.length-1;e>=0;e--)this.files[e].cancel()},progress:function(){var e=0,t=0;return h(this.files,function(i){e+=i.progress()*i.size,t+=i.size}),t>0?e/t:0},addFile:function(e,t){this.addFiles([e],t)},addFiles:function(e,t){var i=[];h(e,function(e){if((!d||d&&e.size>0)&&(e.size%4096!==0||"."!==e.name&&"."!==e.fileName)&&(this.opts.allowDuplicateUploads||!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(e)))){var n=new r(this,e);this.fire("fileAdded",n,t)&&i.push(n)}},this),this.fire("filesAdded",i,t)&&(h(i,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",i,t))},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&(this.files.splice(t,1),e.abort(),this.fire("fileRemoved",e))},getFromUniqueIdentifier:function(e){var t=!1;return h(this.files,function(i){i.uniqueIdentifier===e&&(t=i)}),t},getSize:function(){var e=0;return h(this.files,function(t){e+=t.size}),e},sizeUploaded:function(){var e=0;return h(this.files,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){var e=0,t=0;return h(this.files,function(i){i.paused||i.error||(e+=i.size-i.sizeUploaded(),t+=i.averageSpeed)}),e&&!t?Number.POSITIVE_INFINITY:e||t?Math.floor(e/t):0}},r.prototype={measureSpeed:function(){var e=Date.now()-this._lastProgressCallback;if(e){var t=this.flowObj.opts.speedSmoothingFactor,i=this.sizeUploaded();this.currentSpeed=Math.max((i-this._prevUploadedSize)/e*1e3,0),this.averageSpeed=t*this.currentSpeed+(1-t)*this.averageSpeed,this._prevUploadedSize=i}},chunkEvent:function(e,t,i){switch(t){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now();break;case"error":this.error=!0,this.abort(!0),this.flowObj.fire("fileError",this,i,e),this.flowObj.fire("error",i,this,e);break;case"success":if(this.error)return;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now(),this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,i,e));break;case"retry":this.flowObj.fire("fileRetry",this,e)}},pause:function(){this.paused=!0,this.abort()},resume:function(){this.paused=!1,this.flowObj.upload()},abort:function(e){this.currentSpeed=0,this.averageSpeed=0;var t=this.chunks;e&&(this.chunks=[]),h(t,function(e){"uploading"===e.status()&&(e.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){"function"==typeof this.flowObj.opts.initFileFn&&this.flowObj.opts.initFileFn(this),this.abort(!0),this.error=!1,this._prevProgress=0;for(var e=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor,t=Math.max(e(this.size/this.flowObj.opts.chunkSize),1),i=0;t>i;i++)this.chunks.push(new s(this.flowObj,this,i))},progress:function(){if(this.error)return 1;if(1===this.chunks.length)return this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress;var e=0;h(this.chunks,function(t){e+=t.progress()*(t.endByte-t.startByte)});var t=e/this.size;return this._prevProgress=Math.max(this._prevProgress,t>.9999?1:t),this._prevProgress},isUploading:function(){var e=!1;return h(this.chunks,function(t){return"uploading"===t.status()?(e=!0,!1):void 0}),e},isComplete:function(){var e=!1;return h(this.chunks,function(t){var i=t.status();return"pending"===i||"uploading"===i||"reading"===i||1===t.preprocessState||1===t.readState?(e=!0,!1):void 0}),!e},sizeUploaded:function(){var e=0;return h(this.chunks,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){if(this.paused||this.error)return 0;var e=this.size-this.sizeUploaded();return e&&!this.averageSpeed?Number.POSITIVE_INFINITY:e||this.averageSpeed?Math.floor(e/this.averageSpeed):0},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}},s.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObj.size,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(e,t){return e+=e.indexOf("?")<0?"?":"&",e+t.join("&")},test:function(){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.testHandler,!1),this.xhr.addEventListener("error",this.testHandler,!1);var e=l(this.flowObj.opts.testMethod,this.fileObj,this),t=this.prepareXhrRequest(e,!0);this.xhr.send(t)},preprocessFinished:function(){this.endByte=this.computeEndByte(),this.preprocessState=2,this.send()},readFinished:function(e){this.readState=2,this.bytes=e,this.send()},send:function(){var e=this.flowObj.opts.preprocess,t=this.flowObj.opts.readFileFn;if("function"==typeof e)switch(this.preprocessState){case 0:return this.preprocessState=1,void e(this);case 1:return}switch(this.readState){case 0:return this.readState=1,void t(this.fileObj,this.startByte,this.endByte,this.fileObj.file.type,this);case 1:return}if(this.flowObj.opts.testChunks&&!this.tested)return void this.test();this.loaded=0,this.total=0,this.pendingRetry=!1,this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",this.progressHandler,!1),this.xhr.addEventListener("load",this.doneHandler,!1),this.xhr.addEventListener("error",this.doneHandler,!1);var i=l(this.flowObj.opts.uploadMethod,this.fileObj,this),n=this.prepareXhrRequest(i,!1,this.flowObj.opts.method,this.bytes);this.xhr.send(n)},abort:function(){var e=this.xhr;this.xhr=null,e&&e.abort()},status:function(e){return 1===this.readState?"reading":this.pendingRetry||1===this.preprocessState?"uploading":this.xhr?this.xhr.readyState<4?"uploading":this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!e&&this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var e=this.status();return"success"===e||"error"===e?1:"pending"===e?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var e=this.endByte-this.startByte;return"success"!==this.status()&&(e=this.progress()*e),e},prepareXhrRequest:function(e,t,i,n){var r=l(this.flowObj.opts.query,this.fileObj,this,t);r=c(r,this.getParams());var o=l(this.flowObj.opts.target,this.fileObj,this,t),s=null;if("GET"===e||"octet"===i){var a=[];h(r,function(e,t){a.push([encodeURIComponent(t),encodeURIComponent(e)].join("="))}),o=this.getTarget(o,a),s=n||null}else s=new FormData,h(r,function(e,t){s.append(t,e)}),s.append(this.flowObj.opts.fileParameterName,n,this.fileObj.file.name);return this.xhr.open(e,o,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,h(l(this.flowObj.opts.headers,this.fileObj,this,t),function(e,t){this.xhr.setRequestHeader(t,e)},this),s}},n.evalOpts=l,n.extend=c,n.each=h,n.FlowFile=r,n.FlowChunk=s,n.version="2.11.2","object"==typeof module&&module&&"object"==typeof module.exports?module.exports=n:(e.Flow=n,"function"==typeof define&&define.amd&&define("flow",[],function(){return n}))}(window,document),angular.module("flow.provider",[]).provider("flowFactory",function(){"use strict";this.defaults={},this.factory=function(e){return new Flow(e)},this.events=[],this.on=function(e,t){this.events.push([e,t])},this.$get=function(){var e=this.factory,t=this.defaults,i=this.events;return{create:function(n){var r=e(angular.extend({},t,n));return angular.forEach(i,function(e){r.on(e[0],e[1])}),r}}}}),angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(e,t,i,n){var r=angular.extend({},e.$eval(t.flowInit)),o=e.$eval(t.flowObject)||n.create(r),s=function(t){var i=Array.prototype.slice.call(arguments);i.shift();var n=e.$broadcast.apply(e,["flow::"+t,o].concat(i));return{progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[t]&&e.$apply(),!n.defaultPrevented&&void 0};o.on("catchAll",s),e.$on("$destroy",function(){o.off("catchAll",s)}),e.$flow=o,t.hasOwnProperty("flowName")&&(i(t.flowName).assign(e,o),e.$on("$destroy",function(){i(t.flowName).assign(e)}))}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]),angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(e,t,i){var n=i.hasOwnProperty("flowDirectory"),r=i.hasOwnProperty("flowSingleFile"),o=i.hasOwnProperty("flowAttrs")&&e.$eval(i.flowAttrs);e.$flow.assignBrowse(t,n,r,o)}}}]),angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(e,t,i){t.bind("drop dragover",function(e){e.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(e){return{scope:!1,link:function(t,i,n){function r(e){var t=!1,i=e.dataTransfer||e.originalEvent.dataTransfer;return angular.forEach(i&&i.types,function(e){"Files"===e&&(t=!0)}),t}var o,s=!1;i.bind("dragover",function(i){r(i)&&(s||(t.$apply(n.flowDragEnter),s=!0),e.cancel(o),i.preventDefault())}),i.bind("dragleave drop",function(i){e.cancel(o),o=e(function(){t.$eval(n.flowDragLeave),o=null,s=!1},100)})}}}]),angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){function n(){e.$flow.assignDrop(t)}function r(){e.$flow.unAssignDrop(t)}i.flowDropEnabled?e.$watch(i.flowDropEnabled,function(e){e?n():r()}):n()}}}),!function(e){"use strict";function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}var i=e.module("flow.events",["flow.init"]),n={fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]};e.forEach(n,function(n,r){var o="flow"+t(r);"flowUploadStart"==o&&(o="flowUploadStarted"),i.directive(o,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(t,i){t.$on("flow::"+r,function(){var r=Array.prototype.slice.call(arguments),s=r.shift();if(t.$flow===r.shift()){var a={};e.forEach(n,function(e,t){a[e]=r[t]}),t.$eval(i[o],a)===!1&&s.preventDefault()}})}]}}])})}(angular),angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){var n=i.flowImg;e.$watch(n,function(t){if(t){var n=new FileReader;n.readAsDataURL(t.file),n.onload=function(t){e.$apply(function(){i.$set("src",t.target.result)})}}})}}}]),angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(e){e.transfers=e.$flow.files}}}]),angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]),"object"==typeof module&&module.exports&&(module.exports="luegg.directives"),function(e,t){"use strict";function i(e,i,n){function r(e){var t=e;return{getValue:function(){return t},setValue:function(e){t=e}}}function o(e,t){return{getValue:function(){return e(t)},setValue:function(){}}}function s(e,t,i){return{getValue:function(){return e(i)},setValue:function(n){n!==e(i)&&i.$apply(function(){t(i,n)})}}}if(""!==i){var a=e(i);return a.assign!==t?s(a,a.assign,n):o(a,n)}return r(!0)}function n(t,n,r){t.directive(n,["$parse","$window","$timeout",function(t,o,s){return{priority:1,restrict:"A",link:function(a,l,u){function c(){p.getValue()&&!r.isAttached(d)&&s(function(){r.scroll(d)})}function h(){p.setValue(r.isAttached(d))}var d=l[0],p=i(t,u[n],a);s(c,0,!1),l[0].hasAttribute("force-glue")||l.on("scroll",h);var f=!1;e.forEach(l.children(),function(e){e.hasAttribute("scroll-glue-anchor")&&(f=!0,a.$watch(function(){return e.offsetHeight},function(){c()}))}),f||(a.$watch(c),o.addEventListener("resize",c,!1)),l.on("$destroy",function(){l.unbind("scroll",h)}),a.$on("$destroy",function(){o.removeEventListener("resize",c,!1)})}}}])}var r={isAttached:function(e){return e.scrollTop+e.clientHeight+1>=e.scrollHeight},scroll:function(e){e.scrollTop=e.scrollHeight}},o={isAttached:function(e){return e.scrollTop<=1},scroll:function(e){e.scrollTop=0}},s={isAttached:function(e){return e.scrollLeft+e.clientWidth+1>=e.scrollWidth},scroll:function(e){e.scrollLeft=e.scrollWidth}},a={isAttached:function(e){return e.scrollLeft<=1},scroll:function(e){e.scrollLeft=0}},l=e.module("luegg.directives",[]);n(l,"scrollGlue",r),n(l,"scrollGlueTop",o),n(l,"scrollGlueBottom",r),n(l,"scrollGlueLeft",a),n(l,"scrollGlueRight",s)}(angular),function(e){"use strict";var t=e.module("angular-progress-arc",[]);t.provider("progressArcDefaults",function(){var t={size:200,strokeWidth:20,stroke:"black",background:null};this.setDefault=function(e,i){return t[e]=i,this},this.$get=function(){return function(i){e.forEach(t,function(e,t){i[t]||(i[t]=e)})}}}),t.directive("progressArc",["progressArcDefaults",function(e){return{restrict:"E",scope:{size:"@",strokeWidth:"@",stroke:"@",counterClockwise:"@",complete:"&",background:"@"},compile:function(t,i){return e(i),function(e,t,i){e.offset=/firefox/i.test(navigator.userAgent)?-89.9:-90;var n=function(){e.strokeWidthCapped=Math.min(e.strokeWidth,e.size/2-1),e.radius=Math.max((e.size-e.strokeWidthCapped)/2-1,0),e.circumference=2*Math.PI*e.radius};e.$watchCollection("[size, strokeWidth]",n),n()}},template:'<svg ng-attr-width="{{size}}" ng-attr-height="{{size}}"><circle fill="none" ng-if="background" ng-attr-cx="{{size/2}}" ng-attr-cy="{{size/2}}" ng-attr-r="{{radius}}" ng-attr-stroke="{{background}}" ng-attr-stroke-width="{{strokeWidthCapped}}"/><circle fill="none" ng-attr-cx="{{size/2}}" ng-attr-cy="{{size/2}}" ng-attr-r="{{radius}}" ng-attr-stroke="{{stroke}}" ng-attr-stroke-width="{{strokeWidthCapped}}"ng-attr-stroke-dasharray="{{circumference}}"ng-attr-stroke-dashoffset="{{(1 - complete()) * circumference}}"ng-attr-transform="rotate({{offset}}, {{size/2}}, {{size/2}})'+"{{ (counterClockwise && counterClockwise != 'false') ? ' translate(0, ' + size + ') scale(1, -1)' : '' }}\"/></svg>"}}])}(window.angular);
function HTMLContainer(e){var t=this,n=document.getElementById(e),a={width:1,height:1,aspect_ratio:1};this.getContainer=function(){return n},this.onResize=function(){var e=Math.floor(n.getBoundingClientRect().width);isNaN(e)||(a.width=e);var t=Math.floor(n.getBoundingClientRect().height);isNaN(t)||(a.height=t);var i=n.offsetWidth/n.offsetHeight;isNaN(i)||(a.aspect_ratio=i)},this.getCurrentWidth=function(){return a.width},this.getCurrentHeight=function(){return a.height},this.appendChild=function(e){n.appendChild(e)},this.getAspectRatio=function(){return a.aspect_ratio},this.addEventCallback=function(e,t){var a=angular.element(n);a.bind(e,t)},t.onResize()}function requestAnimationFrame_(){var e=document.createElement("script");e.innerHTML=atob("Y29uc29sZS5sb2coIlRoaXMgZmVhdHVyZSByZXF1aXJlcyBhIGxpY2Vuc2Ugd2l0aCB0aGUgQVBJIGZlYXR1cmUuIFBsZWFzZSBjb250YWN0IHNhbGVzQG5hdnZpcy5jb20gZm9yIG1vcmUgaW5mb3JtYXRpb24uIik7"),$("body").append(e)}function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),i=new Uint8Array(a),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);var r=new DataView(a),s=new Blob([r],{type:n});return s}function stripCustomFields(e,t){return e.charAt&&("$"==e.charAt(0)||"_"==e.charAt(e.length-1))||"function"==typeof t?void 0:t}function isUrlRelative(e){return e&&0!=e.indexOf("//")&&0!=e.indexOf("http://")&&0!=e.indexOf("https://")}function WKTParser(){var e=/(.*)\s+\(([^\s]+)\s+([^\s]+)\s+([^\s]+)\)/;this.parse=function(t){if(null==t)return null;var n=e.exec(t);return{type:"point",coordinates:[Number(n[2]),Number(n[3]),Number(n[4])]}},this.parseVector3=function(t){if(null==t)return null;var n=e.exec(t);return new THREE.Vector3(Number(n[2]),Number(n[3]),Number(n[4]))}}function LicenseFactory(e){var t="license",n={url:"api/"+t,method:"POST"},a={url:"api/"+t,method:"GET",isArray:!1,transformResponse:function(e){return angular.fromJson(e)}},i={saveData:n,getData:a};return e("",{},i)}function translationsHelper(e){function t(n){return function(){var a=this;return""==a.name?(n.remove({id:a.id}),a=void 0):void 0==a.id?(a=n.create([a]),a.$promise.then(function(){a.save=t(n),a.language_name_=e.getLanguageName(a.language_key)})):n.update(a),a}}function n(n){return function(a){var i=a||e.getFallbackLanguage(),o={};return o.language_name_=e.getLanguageName(i),o.language_key=i,o.save=t(n),o}}function a(t,n,a){return function(n){var i={};i[t]=n.id,n.getName=function(e){var t=this.getTranslation(e);if(t)return t.name},n.getTranslation=function(t){t=t||e.getDataLanguage();var n=this.translations_[t];return void 0==n||void 0==n.name?this.translations_[e.getFallbackLanguage()]:n},n.save=a}}var i=function(t){var n={};for(var a in t){var i=t[a];i.language_name_=e.getLanguageName(i.language_key),n[i.language_key]=angular.copy(i)}return n};return{getTranslationsMap:i,getSaveTranslationFunction:t,getCreateTranslationFunction:n,getAugmentFunction:a}}function NotifyingAngularService(){var e={};this.onUpdate=function(){var t=arguments;angular.forEach(e,function(e){e.apply(this,t)})},this.registerUpdateCallback=function(t,n){e[t]=n},this.removeUpdateCallback=function(t){delete e[t]}}function EditingOperation(){this.save=function(){},this.undo=function(){},this.getDescription=function(){}}function FlowService(e){function t(){a.datasetUploader=e.create({target:"api/dataset/upload",prioritizeFirstAndLastChunk:!0,allowDuplicateUploads:!0,chunkSize:10485760})}function n(e){a.datasetUploader.opts.query=e}var a=this;this.setDatasetQuery=n,this.datasetUploader=null,t()}function GroupService(e,t,n,a,i){function o(){i.getUserInfo().$promise.then(function(e){r(e.primary_groups)})}function r(e){return T||a.queryGroups({groups:e.join()},m)}function s(){return k}function l(){T=void 0,k=void 0}function c(e){function t(e,t){return e.id===v()?-1:e.name.localeCompare(t.name)}var n=[];return angular.forEach(e.sort(t),function(e){n.push(e),n=n.concat(c(e.child_groups))}),n}function d(e,t,n,i){function o(e){var t=M(e);t.child_groups.push(e),m(T)}var r={name:e,group_read:t,group_write:n};return angular.extend(r,{attributes:i}),a.addGroup({},r,o).$promise}function u(e,t,n){function i(t){var n=E(e,T);n>-1?T[n]=t:k.forEach(function(n){var a=E(e,n.child_groups);a>-1&&(n.child_groups[a]=t)}),m(T)}var o={id:e,name:t};return angular.extend(o,{attributes:n}),a.updateGroup({},o,i).$promise}function g(e){function t(){k.forEach(function(t){var n=E(e,t.child_groups);n>-1&&t.child_groups.splice(n,1)}),m(T)}return a.removeGroup({id:e},t).$promise}function p(){return{can_create_bundles:t.getString("Create buildings"),can_create_datasets:t.getString("Create datasets"),can_create_poi_groups:t.getString("Create POI categories"),can_create_pois:t.getString("Create POIs"),can_create_polygons:t.getString("Create vector maps"),can_create_user_groups:t.getString("Create user groups"),can_make_public:t.getString("Make content public")}}function m(e){T=e,k=c(e)}function v(){return x}function f(){return I}function h(e,t){e.objectType=t,e.warningDialogConfig=O,e.warningContinueHandler=w,e.UserService=i,e.GroupService=C}function b(e){var t=i.getUserInfo();return!(!e||!t.checkAttribute)&&(e.id!==x||e.id===x&&t.checkAttribute("can_make_public"))}function y(e,t){var n="",a=M(e);return a&&(n+=t+y(a,t)),n}function _(e,t){return i.getUserInfo().checkAttribute("can_make_public")?void S(e):void((0==e.state_.previousGroupRead&&0!=e.groupRead||0==e.state_.previousGroupWrite&&0!=e.groupWrite)&&(P.objectType=t,P.groupRead=e.group_read,P.groupWrite=e.group_write,P.object=e,e.group_read=e.state_.previousGroupRead,e.group_write=e.state_.previousGroupWrite,angular.element(document.getElementById(t+O.ID_POSTFIX)).modal("show")))}function w(){P.object.group_read=P.groupRead,P.object.group_write=P.groupWrite,S(P.object),angular.element(document.getElementById(P.objectType+O.ID_POSTFIX)).modal("hide"),P={}}function S(e){n.set("iv_group_read",e.group_read),n.set("iv_group_write",e.group_write)}function E(e,t){for(var n in t)if(t[n].id===e)return n;return-1}function M(e){return k[E(e.group_write,k)]}var C=this;this.getGroupsAsTree=r,this.getGroupsAsArray=s,this.clearGroups=l,this.createGroupsArray=c,this.addGroup=d,this.updateGroup=u,this.removeGroup=g,this.getGroupAttributesNames=p,this.getPublicGroupId=v,this.getAdminGroupId=f,this.preparePermissionsEditor=h,this.isGroupSelectable=b,this.getGroupIndent=y,this.groupChanged=_,this.setGroups=m;var T=void 0,k=void 0,x=0,I=1,O={TITLE:e("Warning before making content non public"),TEXT:e("You intend to make content non public. However, you do not have permissions to make it public again. This change will be irreversible for you. Would you like to continue?"),ID_POSTFIX:"-make-non-public-warning-dialog"};o();var P={objectType:void 0,object:void 0,groupRead:void 0,groupWrite:void 0}}function JobsListService(e,t,n,a,i){function o(){m.loadingJobs=!0,e.get("api/jobs").then(function(e){e.data.forEach(function(e){var t=e.job_id;g[t]||(g[t]={}),f||!e.success||g[t].success||s(e),g[t].name=e.name,g[t].title=e.title,g[t].job_id=e.job_id,g[t].last_output=e.last_output,g[t].busy=e.busy,g[t].success=e.success,g[t].start_time=e.start_time}),m.jobRunning=g.some(d),m.loadingJobs=!1,p.push(t(function(){o()},h)),!v||m.jobRunning||i.datasetUploader.isUploading()||l(),f=!1})}function r(n){e.get("api/jobs/"+n).then(function(e){g[n].output=e.data.output,g[n].last_output=e.data.last_output,e.data.busy&&p.push(t(function(){r(n)},h))})}function s(e){v?$("#ivReinitModal").modal("show"):(n.reinit(),a.refresh())}function l(e){p.forEach(function(e){t.cancel(e)}),e&&o()}function c(t){e["delete"]("api/jobs/"+t.job_id).then(function(e){})}function d(e){return e.busy}function u(e){v=e}var g=[],p=[],m={loadingJobs:!1,jobRunning:!1},v=!1,f=!0,h=2e3,b={refreshJobsList:o,refreshJobDetails:r,clearTimeouts:l,cancelJob:c,showModalOnJobFinish:u,jobs:g,progress:m};return b}function LanguageService(e,t,n){function a(t){p(t)&&(e.setCurrentLanguage(t),e.loadRemote("translations/"+t+".json"),h=t)}function i(){return e.getCurrentLanguage()}function o(){return f}function r(){var e=[];for(var t in v){var n=v[t];e.push({key:n,language_name:u(n)})}return e}function s(){var e=l();return p(e)?e:e.split("_")[0]}function l(){var e=window.navigator;return((angular.isArray(e.languages)?e.languages[0]:e.language||e.browserLanguage||e.systemLanguage||e.userLanguage)||"").split("-").join("_").toLowerCase()}function c(){return h}function d(){return b}function u(e){for(var t in b){var n=b[t];if(n.key==e)return n.nativeName}}function g(){n.get("iv_lang_key")?m.setLanguage(n.get("iv_lang_key")):s()?m.setLanguage(s()):m.setLanguage(f),t.initialized.then(function(){t.getString("lang")&&m.setLanguage(t.getString("lang"))})}function p(e){return v.indexOf(e)>-1}var m=this;this.setLanguage=a,this.getCurrentLanguage=i,this.getFallbackLanguage=o,this.getRegisteredLanguages=r,this.getBrowserLocale=s,this.getBrowserLocaleString=l,this.getDataLanguage=c,this.getAllDataLanguages=d,this.getLanguageName=u;var v=["en","de","ru","pl","zh","zh_tw","ja"],f=v[0],h=f;g();var b=[{key:"ab",name:"Abkhaz",nativeName:"Аҧсуа"},{key:"aa",name:"Afar",nativeName:"Afaraf"},{key:"af",name:"Afrikaans",nativeName:"Afrikaans"},{key:"ak",name:"Akan",nativeName:"Akan"},{key:"sq",name:"Albanian",nativeName:"Shqip"},{key:"am",name:"Amharic",nativeName:"አማርኛ"},{key:"ar",name:"Arabic",nativeName:"العربية"},{key:"an",name:"Aragonese",nativeName:"Aragonés"},{key:"hy",name:"Armenian",nativeName:"Հայերեն"},{key:"as",name:"Assamese",nativeName:"অসমীয়া"},{key:"av",name:"Avaric",nativeName:"Авар мацӀ"},{key:"ae",name:"Avestan",nativeName:"Avesta"},{key:"ay",name:"Aymara",nativeName:"Aymar aru"},{key:"az",name:"Azerbaijani",nativeName:"Azərbaycan dili"},{key:"bm",name:"Bambara",nativeName:"Bamanankan"},{key:"ba",name:"Bashkir",nativeName:"Башҡорт теле"},{key:"eu",name:"Basque",nativeName:"Euskara"},{key:"be",name:"Belarusian",nativeName:"Беларуская"},{key:"bn",name:"Bengali",nativeName:"বাংলা"},{key:"bh",name:"Bihari",nativeName:"भोजपुरी"},{key:"bi",name:"Bislama",nativeName:"Bislama"},{key:"bs",name:"Bosnian",nativeName:"Bosanski jezik"},{key:"br",name:"Breton",nativeName:"Brezhoneg"},{key:"bg",name:"Bulgarian",nativeName:"Български език"},{key:"my",name:"Burmese",nativeName:"ဗမာစာ"},{key:"ca",name:"Catalan; Valencian",nativeName:"Català"},{key:"ch",name:"Chamorro",nativeName:"Chamoru"},{key:"ce",name:"Chechen",nativeName:"Нохчийн мотт"},{key:"ny",name:"Chichewa; Chewa; Nyanja",nativeName:"ChiCheŵa"},{key:"zh",name:"Chinese",nativeName:"简体中文 (Simplified Chinese)"},{key:"zh_tw",name:"Traditional Chinese",nativeName:"繁體中文 (Traditional Chinese)"},{key:"cv",name:"Chuvash",nativeName:"Чӑваш чӗлхи"},{key:"kw",name:"Cornish",nativeName:"Kernewek"},{key:"co",name:"Corsican",nativeName:"Corsu"},{key:"cr",name:"Cree",nativeName:"ᓀᐦᐃᔭᐍᐏᐣ"},{key:"hr",name:"Croatian",nativeName:"Hrvatski"},{key:"cs",name:"Czech",nativeName:"Česky"},{key:"da",name:"Danish",nativeName:"Dansk"},{key:"dv",name:"Divehi; Dhivehi; Maldivian;",nativeName:"ދިވެހި"},{key:"nl",name:"Dutch",nativeName:"Nederlands"},{key:"en",name:"English",nativeName:"English"},{key:"eo",name:"Esperanto",nativeName:"Esperanto"},{key:"et",name:"Estonian",nativeName:"Eesti"},{key:"ee",name:"Ewe",nativeName:"Eʋegbe"},{key:"fo",name:"Faroese",nativeName:"Føroyskt"},{key:"fj",name:"Fijian",nativeName:"Vosa Vakaviti"},{key:"fi",name:"Finnish",nativeName:"Suomi"},{key:"fr",name:"French",nativeName:"Français"},{key:"ff",name:"Fula; Fulah; Pulaar; Pular",nativeName:"Fulfulde"},{key:"gl",name:"Galician",nativeName:"Galego"},{key:"ka",name:"Georgian",nativeName:"ქართული"},{key:"de",name:"German",nativeName:"Deutsch"},{key:"el",name:"Greek, Modern",nativeName:"Ελληνικά"},{key:"gn",name:"Guaraní",nativeName:"Avañeẽ"},{key:"gu",name:"Gujarati",nativeName:"ગુજરાતી"},{key:"ht",name:"Haitian; Haitian Creole",nativeName:"Kreyòl ayisyen"},{key:"ha",name:"Hausa",nativeName:"Hausa"},{key:"he",name:"Hebrew (modern)",nativeName:"עברית"},{key:"hz",name:"Herero",nativeName:"Otjiherero"},{key:"hi",name:"Hindi",nativeName:"हिन्दी"},{key:"ho",name:"Hiri Motu",nativeName:"Hiri Motu"},{key:"hu",name:"Hungarian",nativeName:"Magyar"},{key:"ia",name:"Interlingua",nativeName:"Interlingua"},{key:"id",name:"Indonesian",nativeName:"Bahasa Indonesia"},{key:"ie",name:"Interlingue",nativeName:"Interlingue"},{key:"ga",name:"Irish",nativeName:"Gaeilge"},{key:"ig",name:"Igbo",nativeName:"Asụsụ Igbo"},{key:"ik",name:"Inupiaq",nativeName:"Iñupiaq"},{key:"io",name:"Ido",nativeName:"Ido"},{key:"is",name:"Icelandic",nativeName:"Íslenska"},{key:"it",name:"Italian",nativeName:"Italiano"},{key:"iu",name:"Inuktitut",nativeName:"ᐃᓄᒃᑎᑐᑦ"},{key:"ja",name:"Japanese",nativeName:"日本語"},{key:"jv",name:"Javanese",nativeName:"Basa Jawa"},{key:"kl",name:"Kalaallisut, Greenlandic",nativeName:"Kalaallisut"},{key:"kn",name:"Kannada",nativeName:"ಕನ್ನಡ"},{key:"kr",name:"Kanuri",nativeName:"Kanuri"},{key:"ks",name:"Kashmiri",nativeName:"कश्मीरी"},{key:"kk",name:"Kazakh",nativeName:"Қазақ тілі"},{key:"km",name:"Khmer",nativeName:"ភាសាខ្មែរ"},{key:"ki",name:"Kikuyu, Gikuyu",nativeName:"Gĩkũyũ"},{key:"rw",name:"Kinyarwanda",nativeName:"Ikinyarwanda"},{key:"ky",name:"Kirghiz, Kyrgyz",nativeName:"Кыргыз тили"},{key:"kv",name:"Komi",nativeName:"Коми кыв"},{key:"kg",name:"Kongo",nativeName:"KiKongo"},{key:"ko",name:"Korean",nativeName:"한국어 (韓國語)"},{key:"ku",name:"Kurdish",nativeName:"Kurdî"},{key:"kj",name:"Kwanyama, Kuanyama",nativeName:"Kuanyama"},{key:"la",name:"Latin",nativeName:"Latine"},{key:"lb",name:"Luxembourgish, Letzeburgesch",nativeName:"Lëtzebuergesch"},{key:"lg",name:"Luganda",nativeName:"Luganda"},{key:"li",name:"Limburgish, Limburgan, Limburger",nativeName:"Limburgs"},{key:"ln",name:"Lingala",nativeName:"Lingála"},{key:"lo",name:"Lao",nativeName:"ພາສາລາວ"},{key:"lt",name:"Lithuanian",nativeName:"Lietuvių kalba"},{key:"lu",name:"Luba-Katanga",nativeName:"Luba-Katanga"},{key:"lv",name:"Latvian",nativeName:"Latviešu valoda"},{key:"gv",name:"Manx",nativeName:"Gaelg"},{key:"mk",name:"Macedonian",nativeName:"Македонски јазик"},{key:"mg",name:"Malagasy",nativeName:"Malagasy fiteny"},{key:"ms",name:"Malay",nativeName:"Bahasa Melayu"},{key:"ml",name:"Malayalam",nativeName:"മലയാളം"},{key:"mt",name:"Maltese",nativeName:"Malti"},{key:"mi",name:"Māori",nativeName:"Te reo Māori"},{key:"mr",name:"Marathi (Marāṭhī)",nativeName:"मराठी"},{key:"mh",name:"Marshallese",nativeName:"Kajin M̧ajeļ"},{key:"mn",name:"Mongolian",nativeName:"Монгол"},{key:"na",name:"Nauru",nativeName:"Ekakairũ Naoero"},{key:"nv",name:"Navajo, Navaho",nativeName:"Diné bizaad"},{key:"nb",name:"Norwegian Bokmål",nativeName:"Norsk bokmål"},{key:"nd",name:"North Ndebele",nativeName:"IsiNdebele"},{key:"ne",name:"Nepali",nativeName:"नेपाली"},{key:"ng",name:"Ndonga",nativeName:"Owambo"},{key:"nn",name:"Norwegian Nynorsk",nativeName:"Norsk nynorsk"},{key:"no",name:"Norwegian",nativeName:"Norsk"},{key:"ii",name:"Nuosu",nativeName:"Nuosuhxop"},{key:"nr",name:"South Ndebele",nativeName:"IsiNdebele"},{key:"oc",name:"Occitan",nativeName:"Occitan"},{key:"oj",name:"Ojibwe, Ojibwa",nativeName:"ᐊᓂᔑᓈᐯᒧᐎᓐ"},{key:"cu",name:"Old Church Slavonic",nativeName:"Ѩзыкъ словѣньскъ"},{key:"om",name:"Oromo",nativeName:"Afaan Oromoo"},{key:"or",name:"Oriya",nativeName:"ଓଡ଼ିଆ"},{key:"os",name:"Ossetian, Ossetic",nativeName:"Ирон æвзаг"},{key:"pa",name:"Panjabi, Punjabi",nativeName:"ਪੰਜਾਬੀ"},{key:"pi",name:"Pāli",nativeName:"पाऴि"},{key:"fa",name:"Persian",nativeName:"فارسی"},{key:"pl",name:"Polish",nativeName:"Polski"},{key:"ps",name:"Pashto, Pushto",nativeName:"پښتو"},{key:"pt",name:"Portuguese",nativeName:"Português"},{key:"qu",name:"Quechua",nativeName:"Runa Simi"},{key:"rm",name:"Romansh",nativeName:"Rumantsch grischun"},{key:"rn",name:"Kirundi",nativeName:"KiRundi"},{key:"ro",name:"Romanian, Moldavian, Moldovan",nativeName:"Română"},{key:"ru",name:"Russian",nativeName:"Русский язык"},{key:"sa",name:"Sanskrit (Saṁskṛta)",nativeName:"संस्कृतम्"},{key:"sc",name:"Sardinian",nativeName:"Sardu"},{key:"sd",name:"Sindhi",nativeName:"सिन्धी"},{key:"se",name:"Northern Sami",nativeName:"Davvisámegiella"},{key:"sm",name:"Samoan",nativeName:"Gagana faa Samoa"},{key:"sg",name:"Sango",nativeName:"Yângâ tî sängö"},{key:"sr",name:"Serbian",nativeName:"Српски језик"},{key:"gd",name:"Scottish Gaelic; Gaelic",nativeName:"Gàidhlig"},{key:"sn",name:"Shona",nativeName:"ChiShona"},{key:"si",name:"Sinhala, Sinhalese",nativeName:"සිංහල"},{key:"sk",name:"Slovak",nativeName:"Slovenčina"},{key:"sl",name:"Slovene",nativeName:"Slovenščina"},{key:"so",name:"Somali",nativeName:"Soomaaliga"},{key:"st",name:"Southern Sotho",nativeName:"Sesotho"},{key:"es",name:"Spanish; Castilian",nativeName:"Español"},{key:"su",name:"Sundanese",nativeName:"Basa Sunda"},{key:"sw",name:"Swahili",nativeName:"Kiswahili"},{key:"ss",name:"Swati",nativeName:"SiSwati"},{key:"sv",name:"Swedish",nativeName:"Svenska"},{key:"ta",name:"Tamil",nativeName:"தமிழ்"},{key:"te",name:"Telugu",nativeName:"తెలుగు"},{key:"tg",name:"Tajik",nativeName:"Тоҷикӣ"},{key:"th",name:"Thai",nativeName:"ไทย"},{key:"ti",name:"Tigrinya",nativeName:"ትግርኛ"},{key:"bo",name:"Tibetan Standard, Tibetan, Central",nativeName:"བོད་ཡིག"},{key:"tk",name:"Turkmen",nativeName:"Türkmen"},{key:"tl",name:"Tagalog",nativeName:"Wikang Tagalog"},{key:"tn",name:"Tswana",nativeName:"Setswana"},{key:"to",name:"Tonga (Tonga Islands)",nativeName:"Faka Tonga"},{key:"tr",name:"Turkish",nativeName:"Türkçe"},{key:"ts",name:"Tsonga",nativeName:"Xitsonga"},{key:"tt",name:"Tatar",nativeName:"Татарча"},{key:"tw",name:"Twi",nativeName:"Twi"},{key:"ty",name:"Tahitian",nativeName:"Reo Tahiti"},{key:"ug",name:"Uighur, Uyghur",nativeName:"Uyƣurqə"},{key:"uk",name:"Ukrainian",nativeName:"Українська"},{key:"ur",name:"Urdu",nativeName:"اردو"},{key:"uz",name:"Uzbek",nativeName:"Zbek"},{key:"ve",name:"Venda",nativeName:"Tshivenḓa"},{key:"vi",name:"Vietnamese",nativeName:"Tiếng Việt"},{key:"vo",name:"Volapük",nativeName:"Volapük"},{key:"wa",name:"Walloon",nativeName:"Walon"},{key:"cy",name:"Welsh",nativeName:"Cymraeg"},{key:"wo",name:"Wolof",nativeName:"Wollof"},{key:"fy",name:"Western Frisian",nativeName:"Frysk"},{key:"xh",name:"Xhosa",nativeName:"IsiXhosa"},{key:"yi",name:"Yiddish",nativeName:"ייִדיש"},{key:"yo",name:"Yoruba",nativeName:"Yorùbá"},{key:"za",name:"Zhuang, Chuang",nativeName:"Saɯ cueŋƅ"}]}function LicenseService(e,t,n){function a(){function e(e){b=e,invalidateAngular(),f.daysUntilExpire=f.getNumOfDaysToExpire(),h.resolve()}function t(e){console.error("Failed to retrieve data",e),h.resolve()}return n.getData().$promise.then(e)["catch"](t)}function i(){return b.license_valid}function o(){return b.valid_from?v(b.valid_from):void 0}function r(){return b.valid_to?v(b.valid_to):void 0}function s(){if(!i())return!1;var e=l();return e>0&&e<=y}function l(){function e(e,t){var n=e.getTime()-t.getTime();return Math.ceil(n/864e5)}var t=new Date,n=r();if(!i()||!n)return 0;var a=e(n,t);return f.daysUntilExpire=a,a}function c(e){return i()&&b.features&&b.features.indexOf(e)!==-1}function d(){var e=["routing","analyst","api","user_management"],t=b.features;return angular.forEach(t,function(t){e.indexOf(t)===-1&&e.push(t)}),e}function u(e){switch(e){case f.EFeature.ROUTING:return t("Routing");case f.EFeature.ANALYST:return t("Analyst");case f.EFeature.API:return t("API");case f.EFeature.USER_MANAGEMENT:return t("User Authentication");case f.EFeature.PC_IMPORT:return t("Point Cloud Import");default:return e}}function g(e){return n.saveData({license:e}).$promise}function p(){return b.area}function m(){return b.licensable_square_meters}function v(e){return e?new Date(1e3*e):void 0}var f=this;f.EFeature={ROUTING:"routing",ANALYST:"analyst",API:"api",USER_MANAGEMENT:"user_management",PC_IMPORT:"point_cloud_import"};var h=e.defer(),b={},y=14;f.initialized=h.promise,f.daysUntilExpire=0,f.fetch=a,f.isLicenseValid=i,f.getValidFrom=o,f.getExpirationDate=r,f.getNumOfDaysToExpire=l,f.isExpirationPeriod=s,f.isFeatureEnabled=c,f.getFeatures=d,f.getFeatureText=u,f.saveLicenseData=g,f.getLicensedSqm=p,f.getLicensableSqm=m,a()}function StatusCheckService(e,t,n,a,i,o){function r(){return i.isAdmin()&&l(),g}function s(){return p.health?p.health.status:void 0}function l(){function a(e){p.health=e.data}function o(){t.log("Could not fetch health status from the server.")}function r(){l.resolve()}c();var s=n.defer();d.initialized=s.promise;var l=n.defer();n.defer();return i.getUserInfo().$promise.then(function(t){e.get("status/health").then(a,o)["finally"](r)}),n.all([l.promise]).then(function(){s.resolve(p)}),s.promise}function c(){function e(){g.dismissed=!0}function t(e){if(!u&&a.version.version){var t=a.version.version.split(".");u=t[0]+"."+t[1]}return"https://www.navvis.com/docs/indoorviewer/v"+u+"/en/html/"+e}g.dismiss=e,g.getDocsLink=t,g.dismissed=!1,g.data=p}var d=this;d.check=r,d.getGlobalStatus=s;var u,g={},p={}}function TextGenService(e){function t(e,t){var n=a[e][t];return n?n:(console.log("WARNING: getText failed lookup:",e,t),"FAILED TEXT LOOKUP")}var n=this;n.getText=t;var a={ConfigurationEditor:{LON:e("Geographic latitude of the startup location. A panorama close to this point is chosen as the starting location"),LAT:e("Geographic longitude of the startup location"),Z:e("Height of the startup location"),CORE_INIT_IMAGE:e("Startup image database ID"),CORE_INIT_LON:e("Horizontal view direction"),CORE_INIT_LAT:e("Vertical view direction"),CORE_INIT_VIEW:e('Main view, either "panorama" (the default) or "map"'),MENU_DATASETS_VISIBLE:e("Datasets"),MENU_LOGIN_VISIBLE:e("Login"),MENU_VIEW_VISIBLE:e("View"),MENU_POI_VISIBLE:e("POIs"),MENU_POINTCLOUD_VISIBLE:e("Point Cloud"),MENU_MODE_VISIBLE:e("Mode"),MENU_SHARE_VISIBLE:e("Share"),MENU_ABOUT_VISIBLE:e("Info menu (do not hide this menu, it is required to comply with third party licenses)"),MENU_SETTINGS_VISIBLE:e("Settings"),MENU_NEWWINDOW_VISIBLE:e("Open in New Window"),LAYERS_POINTCLOUD_VISIBLE:e("Point cloud"),LAYERS_PANORAMAS_VISIBLE:e("Panorama images"),LAYERS_NAVGRAPH_VISIBLE:e("Navigation graph"),LAYERS_LOCATIONS_VISIBLE:e("Location markers (image locations on floor)"),LAYERS_MAP_VISIBLE:e("Map window"),POI_SHARE_ENABLED:e("Share button on the POI panel"),POI_VIEW_ENABLED:e("View button on the POI panel"),POI_FULLSCREEN:e("Show POI details as full screen dialog"),POI_NAMES_MAP:e('Show POI names in the "map" view'),POI_NAMES_PANORAMAS:e('Show POI names in the "panorama" view'),POI_VISIBILITYCHECK_ENABLED:e("Check and adjust POI visibility"),UI_POI_PANEL_VISIBLE:e("POI details panel"),UI_FLOORCHANGER_VISIBLE:e("Floor changer widget"),UI_SEARCH_VISIBLE:e("Search box"),UI_STATUSCHECK_VISIBLE:e("Status check"),LAYERS_POINTCLOUD_SAME_RES:e("Disable level-of-detail mechanism for point clouds (all points are loaded with selected resolution, do NOT use this in production)"),ROUTING_ENABLED:e("Enable routing"),CORE_MAP_BG:e("Background color (RGBA) of map (integer), e.g. 0xFFFFFFFF for white + fully opaque or 0 for black + fully transparent"),CORE_MAP_FOV_COLOR:e("Color (RGB) of field of view indicator"),CORE_MAP_FOV_BLENDING:e("Blending mode for field of view indicator (NoBlending = 0, NormalBlending = 1, AdditiveBlending = 2, SubtractiveBlending = 3, MultiplyBlending = 4)"),CORE_MAP_MARKER_COLOR:e("Color (RGB) of location markers in map view (in panorama view they are always white)"),CORE_MAP_MARKER_BLENDING:e("Blending mode for location markers (see core.map.fov.blending)"),CORE_MAP_BASEMAP:e("Base map"),CORE_MAP_TILE_URL:e("Map tile URL"),LAYERS_PANORAMAS_MOBILE_MAX_RES:e("Maximum resolution of the panorama images loaded for mobile users (use 2 or 1)"),POI_TYPES:e("Only show POIs from categories in the comma separated list (e.g. 11,17,18), note: the category numbers are shown in the POI category panel in edit mode"),INFO_TERMS_PRIVACY:e("HTML to show as privacy policy in about box"),INFO_TERMS_EXTRA:e("HTML to show as extra credits in about box"),FEEDBACK_FROM_DOMAIN:e("Domain of from address"),FEEDBACK_RECIPIENT_EMAIL:e("Recipient E-mail"),FEEDBACK_RECIPIENT_SMTPHOST:e("SMTP server"),TRACKING_ENABLED:e("Enable tracking"),TRACKING_CODE:e("Javascript tracking code for statistics (only actually inserted into the page header if tracking is enabled)"),LAYERS_POLYGON_VECTOR_MAP_STYLE:e("Vector map style sheet"),MENU_VISIBILITY:e("Menu Visibility"),UI_ELEMENTS:e("Visibility of built-in UI elements"),LAYER_VISIBILITY:e("Layer Visibility"),CUSTOMIZABLE_CONTENT:e("Customizable Content"),FUNCTIONALITY:e("Functionality"),APPEARANCE:e("Appearance"),MAIN_SCENE:e("Main view"),FEEDBACK_TO_EMAIL:e("E-Mail feedback from users")}}}function UserService(e,t,n,a,i){function o(){return void 0!==x&&x.hasOwnProperty("id")}function r(){return!!C.isUserLoggedIn()&&x.groups.indexOf(T)>-1}function s(){return void 0!==x&&x.groups.indexOf(k)>-1}function l(){return x||a.queryLoggedUser({},S)}function c(){var e=u("iv_group_read");return void 0!==e?e:x&&x.default_group_read}function d(){var e=u("iv_group_write");return void 0!==e?e:x&&x.default_group_write}function u(e){var t=n.get(e);if(!x)return t;if(x.groups.indexOf(t)!==-1&&(0!==t||x.checkAttribute("can_make_public")))return t}function g(e,t){return a.logIn({username:e,password:t},S).$promise}function p(){function n(n){x=void 0,n.logout_url&&e(function(){t.location.href=n.logout_url})}return a.logOut(n).$promise}function m(e,t,n,i){return a.changePassword({id:e},{username:t,password:n,new_password:i}).$promise}function v(e,t,n,i,o){function r(e){I.push(e)}var s={username:e,password:t,first_name:n,last_name:i,email:o};return a.addUser({},s,r).$promise}function f(e,t,n,i,o,r,s){function l(t){var n=M(e);n>-1&&(I[n]=t)}var c={id:e},d={username:t,password:n,new_password:i,first_name:o,last_name:r,email:s};return a.updateUserProfile(c,d,l).$promise}function h(e,t){function n(t){var n=M(e);n>-1&&(I[n]=t)}return a.updateUserPrimaryGroups({id:e},t,n).$promise}function b(e){function t(){var t=M(e);t>-1&&I.splice(t,1)}return a.removeUser({id:e},t).$promise}function y(e){I=e}function _(e){return!e&&I?I:a.queryUsers({},y)}function w(){return{"auth.iv.host.url":i.getString("auth.iv.host.url",""),"auth.local.provider.url":i.getString("auth.local.provider.url",""),"auth.local.key":i.getString("auth.local.key",""),"auth.local.secret":i.getString("auth.local.secret","")}}function S(e){x=e,E(x)}function E(e){function t(){return this.first_name&&this.last_name?this.first_name+" "+this.last_name:this.username}function n(e){return!!this.attributes&&this.attributes[e]}e.getDisplayName=t,e.checkAttribute=n}function M(e){for(var t in I)if(I[t].id===e)return t;return-1}var C=this;this.isUserLoggedIn=o,this.isAdmin=r,this.isGuest=s,this.getUserInfo=l,this.getDefaultGroupRead=c,this.getDefaultGroupWrite=d,this.localLogin=g,this.localLogout=p,this.changePassword=m,this.addUser=v,this.updateUserProfile=f,this.updateUserPrimaryGroups=h,this.removeUser=b,this.setUsers=y,this.getUsers=_,this.getUserAuthConfig=w,this.saveUserAuthConfig=i.saveConfigs;var T=1,k=0,x=void 0,I=void 0}function ParentAlignmentController(e,t,n,a,i,o,r,s,l){var c,d,u=200;e.config=a.config,e.COLOR_DEFS=i.COLOR_DEFS,e.colors=[{key:"red",name:l.getString("red",null,"color name")},{key:"pink",name:l.getString("pink",null,"color name")},{key:"purple",name:l.getString("purple",null,"color name")},{key:"deep purple",name:l.getString("deep purple",null,"color name")},{key:"indigo",name:l.getString("indigo",null,"color name")},{key:"blue",name:l.getString("blue",null,"color name")},{key:"light blue",name:l.getString("light blue",null,"color name")},{key:"cyan",name:l.getString("cyan",null,"color name")},{key:"teal",name:l.getString("teal",null,"color name")},{key:"green",name:l.getString("green",null,"color name")},{key:"light green",name:l.getString("light green",null,"color name")},{key:"lime",name:l.getString("lime",null,"color name")},{key:"yellow",name:l.getString("yellow",null,"color name")},{key:"amber",name:l.getString("amber",null,"color name")},{key:"orange",name:l.getString("orange",null,"color name")},{key:"deep orange",name:l.getString("deep orange",null,"color name")}],e.dataset_colors=i.dataset_colors,e.toggleSelection=function(e){a.toggleInSelected(e)},e.zoomTo=function(e){t.$broadcast("alignment.zoomToDataset",e)},e.zoomToAllSelected=function(){a.setZoomToAllSelected()},e.selectAll=function(){a.selectAll(o.datasets,r.modes.currentMode)},e.selectInverse=function(){a.selectInverse(o.datasets)},e.unSelectAll=function(){a.unSelectAll()},e.anythingSelected=function(){return Object.keys(a.config.selected).length>0},e.lockAll=function(){a.lockAll()},e.unlockAll=function(){a.unlockAll()},e.setAsPrimary=function(e){a.setAsPrimary(e)},e.toggleLock=function(e){a.toggleLock(e)},e.toggleBaseLayer=function(){a.toggleBaseLayer()},e.translate=function(e,t,i){a.translate(new THREE.Vector3(e,t,i)),c||(c=n(function(){a.translate(new THREE.Vector3(e,t,i))},u))},e.StopTranslating=function(){c&&(n.cancel(c),c=null)},e.rotate=function(e){a.rotate(e),d||(d=n(function(){a.rotate(e)},u))},e.StopRotating=function(){d&&(n.cancel(d),d=null)},e.isNonWritableDatasetSelected=function(){var t=!1;return angular.forEach(e.config.selected,function(e){e.security_.can_write||(t=!0)}),t},e.save=function(){a.save()},e.generateXML=function(){var t=function(e){e=e?e:"_";var t=new Date,n=t.getDate(),a=t.getMonth()+1,i=t.getFullYear();return n<10&&(n="0"+n),a<10&&(a="0"+a),i+"_"+a+"_"+n},n=i.generateXML(e.config.referenceDataset,e.config.path_to_data,e.config.selected),a=new Blob([n],{type:"text/xml"}),o=e.config.institution_name?"_":"",r=e.config.institution_name+o+t()+".xml";s(function(){if(navigator.msSaveBlob)navigator.msSaveBlob(a,r);else{var e=(window.URL||window.webkitURL).createObjectURL(a),t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=e,t.download=r,t.target="_blank",t.click(),setTimeout(function(){document.body.removeChild(t),(window.URL||window.webkitURL).revokeObjectURL(e)},100)}})}}function GeoRegOLMController(e,t,n,a,i,o,r,s){function l(){t.$watch("config.googleMapsFetched",function(e){e&&n(f)})}function c(){t.ol_map&&(t.ol_map.switchBaseLayer(),t.config.baseLayer=!1)}function d(e){t.ol_map&&angular.forEach(r.datasets,function(n){e[n.id]?t.ol_map.showMap(n.id):t.ol_map.hideMap(n.id)})}function u(e){t.ol_map&&angular.forEach(r.datasets,function(n){e[n.id]?t.ol_map.lock(n.id):t.ol_map.unlock(n.id)})}function g(e){t.ol_map&&e&&(t.ol_map.moveDragControlTo(e.id),t.ol_map.makeMapsTransparent(t.config.transparent))}function p(e){t.ol_map&&t.ol_map.zoomToMap(e),t.config.zoomToAllSelected={}}function m(){t.ol_map.translateMapsAndTheirMarkers(t.config.GuRM.d_delta),i.rotate(t.config.GuRM.yaw_delta),t.config.GuRM.apply=!1}function v(e){"GeoRegistration"===e&&(t.ol_map?(h(),angular.forEach(r.datasets,function(e){var n=e.getGlobalState();t.mod_data.locations4326[e.id]=n.pos,t.mod_data.orientations[e.id]=n.orientation}),t.ol_map.updateLocationsFromService(t.mod_data.locations4326,!0)):l())}function f(){t.ol_map=new OpenLayersMap(e[0].id,a,i,o),b()}function h(){t.ol_map.removeDeletedMaps(r.datasetsIdMap),b()}function b(){angular.forEach(r.datasets,function(e){var n=e.getGlobalState();t.mod_data.locations4326[e.id]=n.pos,t.mod_data.orientations[e.id]=n.orientation,t.ol_map.addMap(e,t.mod_data.locations4326[e.id])})}t.ol_map=void 0,t.config=i.config,t.mod_data=i.mod_data,t.modes=s.modes,t.$on("alignment.zoomToDataset",function(e,t){p(t)}),t.$watch("config.baseLayer",function(e){e&&c()}),t.$watchCollection("config.zoomToAllSelected",function(e){Object.keys(e).length>0&&p(e)}),t.$watchCollection("config.selected",d),t.$watchCollection("config.lock",u,!0),t.$watch("config.transparent",function(e){t.ol_map&&t.ol_map.makeMapsTransparent(e)}),t.$watch("config.primary",g),t.$watch("config.deltaTranslation",function(e){t.ol_map&&e&&t.ol_map.translateMapsAndTheirMarkers(e)}),t.$watch("mod_data.orientations",function(){t.ol_map&&t.ol_map.updateLocationsFromService(t.mod_data.locations4326)},!0),t.$watch("config.GuRM.apply",function(e){
e&&m()}),t.$watch("modes.currentMode",function(e,t){e!==t&&v(e)})}function GroupController(e,t,n,a,i,o,r){function s(t){function n(t){e.permissions_data=e.permissions_data||{},e.permissions_data.groups=angular.copy(t)}function a(){i.setGroups(r),e.permissions_data=e.permissions_data||{},e.permissions_data.groups=angular.copy(r)}function o(){e.permissions_data.isDataChanged=u,e.groupsTree.setGroups(e.permissions_data.groups),P(),p()}var r=i.getGroupsAsTree(e.userInfo.primary_groups);return t&&i.clearGroups(),i.getGroupsAsTree(e.userInfo.primary_groups).$promise.then(n,a)["finally"](o)}function l(){var t={showChecks:!1,showBadges:!0,selectable:!0,showAttributes:!0,attributeNames:e.attributeNames,allAttributesText:e.allAttributesText,noAttributesText:e.noAttributesText,excludeGroupId:o.isAdmin()?void 0:i.getPublicGroupId()};return new GroupsTree(i,t)}function c(){L=[],D=[],N=[],g(),s()}function d(){g(),L.length&&(e.addingInProgressCount=L.length,x()),D.length&&I(),N.length&&O()}function u(){return L.length>0||D.length>0||N.length>0}function g(){function t(e){return e.local_id}G=R().filter(e.groupsTree.isGroupExpanded).map(t)}function p(){function t(t){return e.groupsTree.getGroupByLocalId(t,R())}var n=G.map(t).filter(Boolean);e.groupsTree.expandGroups(n,!0)}function m(t){e.groupsTree.hoverGroups(R(),!1),e.groupsTree.hoverGroup(t,!0)}function v(t){e.groupsTree.mouseLeaveGroup(t)}function f(t){e.groupsTree.toggleGroupExpanded(t)}function h(t){var n=!e.groupsTree.isGroupSelected(t);e.groupsTree.selectGroups(R(),!1),e.groupsTree.selectGroup(t,n)}function b(t){e.groupsTree.addGroupInAddingState(t,R()),P()}function y(t){var n=e.groupsTree.acceptAddingGroup(t,R());L.push(n)}function _(t){e.groupsTree.cancelAddingGroup(t,R())}function w(t){e.groupsTree.goToGroupEditState(t,R())}function S(t){var n=e.groupsTree.getGroupByLocalId(t,R()),a=(e.groupsTree.getParentGroup(n,R()),e.groupsTree.getGroupById(n.id,V())),i=L.indexOf(n),o=D.indexOf(n);a&&n.name===a.name?o>-1&&D.splice(o,1):i==-1&&o==-1&&D.push(n),i>-1?e.groupsTree.goToGroupAddedState(n):e.groupsTree.goToGroupNormalState(n)}function E(t){e.groupsTree.cancelUpdatingGroupName(t,R())}function M(t){e.groupsTree.getGroupWithDescendants(t);e.groupsTree.selectGroup(t,!1);var n=e.groupsTree.getParentGroup(t,R());if(n){var a=n.child_groups.indexOf(t);a>-1&&n.child_groups.splice(a,1)}void 0==t.id?C(t):N.push(t),P()}function C(t){var n=e.groupsTree.getGroupWithDescendants(t);angular.forEach(n,function(e){var t=L.indexOf(e);t>-1&&L.splice(t,1)})}function T(t,n){if(e.isUserAllowedToChangeAttribute(n)){t.toggleAttribute(n);var a=e.groupsTree.getGroupById(t.id,V()),i=D.indexOf(t);if(a){var o=angular.equals(t.attributes,a.attributes);o||i!=-1?o&&i>-1&&D.splice(i,1):D.push(t)}e.groupsTree.updateGroupAttributesString(t)}}function k(e){function t(t){return t.isAttributeEnabled(e)}return R().some(t)}function x(){function t(t){e.groupsTree.initGroup(t);var n=G.indexOf(l.local_id);n>-1&&(G[n]=t.local_id),angular.forEach(l.child_groups,function(e){e.parent=t})}function n(){r.showMessage(a.getString("Error while adding the group {{name}}",{name:l.name}),a.getString("The group and its subgroups have not been added."))}function o(){s().then(function(){--e.addingInProgressCount,x()})}if(0!=L.length){var l=L.shift(),c=e.groupsTree.getParentGroup(l,R());c&&i.addGroup(l.name,c.id,c.id,l.attributes).then(t,n)["finally"](o)}}function I(){var n=[];angular.forEach(D,function(t){function o(){var n=e.groupsTree.getGroupById(t.id,V());r.showMessage(a.getString("Error while updating the group {{name}}",{name:n.name}),a.getString("The group has not been updated. Restoring the last correct state."))}var s=i.updateGroup(t.id,t.name,t.attributes)["catch"](o);n.push(s)}),t.all(n)["finally"](s),D=[]}function O(){var n=[];angular.forEach(N,function(t){function o(e){var n=e.data&&e.data.msg?e.data.msg:a.getString("The group has not been removed.");r.showMessage(a.getString("Error while removing the group {{name}}",{name:t.name}),n)}var s=e.groupsTree.getParentGroup(t,R());if(s){var l=i.removeGroup(t.id)["catch"](o);n.push(l)}}),n.length&&t.all(n)["finally"](s),N=[]}function P(){U=i.createGroupsArray(e.permissions_data.groups)}function R(){return U}function V(){return i.getGroupsAsArray()}function A(e){return!e||e.security_.can_write?"":a.getString("You do not have permission to edit this group")}e.GroupService=i,e.attributeNames=i.getGroupAttributesNames(),e.allAttributesText=a.getString("All",null,"As in 'All group attributes'"),e.noAttributesText=a.getString("None",null,"As in 'No group attributes'"),e.groupsTree=l(),e.addingInProgressCount=0,e.userInfo=o.getUserInfo(),e.resetGroups=c,e.saveGroups=d,e.isDataChanged=u,e.mouseOverGroup=m,e.mouseLeaveGroup=v,e.toggleGroupExpanded=f,e.toggleGroupSelected=h,e.addGroupInAddingState=b,e.acceptAddingGroup=y,e.cancelAddingGroup=_,e.goToGroupEditState=w,e.acceptUpdatingGroupName=S,e.cancelUpdatingGroupName=E,e.removeGroup=M,e.toggleGroupAttribute=T,e.isUserAllowedToChangeAttribute=k,e.getGroupNotWritableText=A;var L=[],D=[],N=[],G=[],U=[];s(!0)}function UserController(e,t,n,a,i,o,r,s){function l(){e.userInfo=i.getUserInfo(),d(),i.isAdmin()&&c()}function c(t){i.getUsers(t).$promise.then(function(t){e.permissions_data=e.permissions_data||{},e.permissions_data.users=u(t),e.permissions_data.isDataChanged=q})}function d(){o.getGroupsAsTree(e.userInfo.primary_groups).$promise.then(function(t){e.permissions_data=e.permissions_data||{},e.permissions_data.groups=angular.copy(t),e.groupsTree.setGroups(e.permissions_data.groups),e.updateGroupsForSelectedUsers()})}function u(t){function n(t,n){return t.id==e.userInfo.id?-1:n.id==e.userInfo.id?1:t.username.localeCompare(n.username)}return angular.copy(t).sort(n)}function g(){var e={showChecks:!0,showBadges:!1,selectable:!1,showAttributes:!1,excludeGroupId:o.getPublicGroupId(),groupCheckByWritePermission:!i.isAdmin()};return new GroupsTree(o,e)}function p(){function t(){b(),e.login="",e.wrongUserCredentials=!1}function n(t){t.data&&"User credentials have expired"===t.data.msg?(e.wrongUserCredentials=!1,e.passwordExpiredResponse=t,o()):e.wrongUserCredentials=!0}function a(){e.passwordExpired||(e.password=""),e.loginInProgress=!1}function o(){e.passwordExpired=!0}e.loginInProgress=!0,i.localLogin(e.login,e.password).then(t,n)["finally"](a)}function m(){function t(){e.logoutInProgress=!1}e.logoutInProgress=!0,i.localLogout().then(b)["finally"](t)}function v(){function t(){e.password=e.newPassword,e.newPassword=void 0,e.repeatNewPassword=void 0,e.passwordExpired=!1,p()}function n(){e.passwordChangeFailed=!0}function a(){e.loginInProgress=!1}e.loginInProgress=!0,e.passwordChangeFailed=!1,i.changePassword(e.passwordExpiredResponse.data.user_id,e.login,e.password,e.newPassword).then(t,n)["finally"](a)}function f(){t.location.pathname+="/oauthCallback.html"}function h(){var e=i.getUserAuthConfig();return""!==e["auth.local.provider.url"]}function b(){i.getUserInfo().$promise.then(function(t){e.userInfo=t,o.clearGroups(),d(),i.isAdmin()&&c(),s.reinit()})}function y(t){function n(t){return e.userInfo.attributes[t]}return t?Object.keys(e.userInfo.attributes).filter(n).length:Object.keys(e.userInfo.attributes).length}function _(e){return void 0===e.id||T(e)&&i.isAdmin()}function w(e){var t=x(),n=/^[a-zA-Z0-9-_@.]*$/;return e&&e.length>=t.min&&e.length<=t.max&&e.match(n)}function S(e){return e}function E(e){return void 0===e.id?w(e.username)&&S(e.password)&&S(e.repeat_password)&&k(e):w(e.username)&&k(e)}function M(t){return!i.isAdmin()||e.userInfo.id===t}function C(t){return e.userInfo.id===t}function T(e){return"LOCAL"===e.provider}function k(e){return e&&e.repeat_password&&e.password?e.password===e.repeat_password:!(e&&e.repeat_new_password&&e.new_password)||e.new_password===e.repeat_new_password}function x(){return{min:3,max:254}}function I(){return ee}function O(e,t,n,i,o,s,l){function d(){c(),$("#save-user-modal").modal("hide")}function u(e){e.data.msg.toLowerCase().indexOf("user exists in the database")!==-1?g():e.data.msg.toLowerCase().indexOf("not a well-formed email address")!==-1?p():e.data.msg.toLowerCase().indexOf("invalid current password")!==-1?m():v()}function g(){ee.usernameUnique=!1}function p(){ee.emailFormat=!1}function m(){ee.currentPassword=!1}function v(){r.showMessage(a.getString("Error while saving the user {{name}}",{name:t}),a.getString("The user has not been added."))}var f=void 0===e?U(t,n,o,s,l):F(e,t,n,i,o,s,l);f.then(d,u)}function P(t){angular.forEach(t,function(t){function n(){var n=e.getUserById(t,e.permissions_data.users),a=e.permissions_data.users.indexOf(n);a>-1&&e.permissions_data.users.splice(a,1)}function o(){var n=e.getUserById(t,e.permissions_data.users);r.showMessage(a.getString("Error while removing the user {{username}}",{username:n.username}),a.getString("The user has not been removed."))}i.removeUser(t).then(n,o)})}function R(t){function n(){ee={usernameUnique:!0,emailFormat:!0,currentPassword:!0}}function a(t){var n=e.userInfo.id===t?e.userInfo:e.getUserById(t,e.permissions_data.users),a=e.getUserById(t,i.getUsers());n.username=a.username,n.first_name=a.first_name,n.last_name=a.last_name,n.email=a.email}n(),void 0!==t&&a(t)}function V(e){return e.id>=0}function A(t){return t.id!=e.userInfo.id}function L(){function t(e){return V(e)&&A(e)?e.id:void 0}e.selectedUsers=e.permissions_data.users.map(t).filter(Boolean),e.updateGroupsForSelectedUsers()}function D(){e.selectedUsers=[],e.updateGroupsForSelectedUsers()}function N(){e.permissions_data.users=void 0,c(!0)}function G(e,t){function n(t){return t.id===e}return t.filter(n)[0]}function U(e,t,n,a,o){return i.addUser(e,t,n,a,o)}function F(e,t,n,a,o,r,s){return i.updateUserProfile(e,t,n,a,o,r,s)}function H(){var t=X();e.groupsTree.checkGroups(t,CheckState.UNCHECKED),e.groupsTree.expandGroups(t,!1),e.groupsTree.enableGroups(t,e.selectedUsers.length>0);var n={};angular.forEach(e.selectedUsers,function(t){var a=e.getUserById(t,e.permissions_data.users);angular.forEach(Z(a.primary_groups),function(e){n[e]=n[e]||{},n[e].count=n[e].count?n[e].count+1:1})}),angular.forEach(n,function(n,a){var i=e.groupsTree.getGroupById(a,t);n.has_ancestor?(e.groupsTree.checkGroup(i,CheckState.CHECKED),e.groupsTree.enableGroup(i,!1)):n.count==e.selectedUsers.length?e.groupsTree.checkGroup(i,CheckState.CHECKED):n.count>0&&e.groupsTree.checkGroup(i,CheckState.SEMI_CHECKED),e.groupsTree.revealGroup(i,t)})}function z(t){var n=X(),a=o.getPublicGroupId(),r=n.filter(function(t){return e.groupsTree.isGroupChecked(t)&&t.id!=a}),s=n.filter(function(t){return e.groupsTree.isGroupSemiChecked(t)&&t.id!=a}),l=e.groupsTree.getGroupsIds(r),c=e.groupsTree.getGroupsIds(s);angular.forEach(e.selectedUsers,function(t){var n=e.getUserById(t,e.permissions_data.users),o=angular.copy(l);o.push(a),angular.forEach(c,function(e){n.primary_groups.indexOf(e)>-1&&o.push(e)});var r=e.getUserById(t,i.getUsers());e.groupsTree.sameGroupsIds(o,r.primary_groups)?delete Q[n.id]:(n.primary_groups=o,Q[n.id]=n)})}function j(t){function n(t){e.groupsTree.checkGroup(t,CheckState.CHECKED),e.groupsTree.checkGroups(e.groupsTree.getGroupDescendants(t),CheckState.UNCHECKED),e.updateSelectedUsersAfterGroupCheck(t)}function a(t){e.groupsTree.checkGroup(t,CheckState.UNCHECKED),e.updateSelectedUsersAfterGroupCheck(t)}e.groupsTree.isGroupEnabled(t)&&(e.groupsTree.isGroupChecked(t)||e.groupsTree.isGroupSemiChecked(t)?a(t):Y(t)||n(t))}function B(t){e.groupsTree.toggleGroupExpanded(t)}function W(){Q={},e.permissions_data.users=u(i.getUsers()),e.updateGroupsForSelectedUsers()}function K(){Object.keys(Q).length&&J()}function q(){return Object.keys(Q).length>0}function J(){function e(){r.showMessage(a.getString("Error while updating users"),a.getString("The users have not been updated"))}function t(){c(),Q={}}var o=[];angular.forEach(Q,function(e){var t=i.updateUserPrimaryGroups(e.id,Z(e.primary_groups));o.push(t)}),n.all(o)["catch"](e)["finally"](t)}function Y(t){function n(t){return e.groupsTree.isGroupChecked(t)||e.groupsTree.isGroupSemiChecked(t)}var a=e.groupsTree.getGroupWithAncestors(t,X());return a.some(n)}function X(){return e.permissions_data?o.createGroupsArray(e.permissions_data.groups):[]}function Z(t){return e.groupsTree.discardPublicGroup(t)}e.GroupService=o,e.userInfo=void 0,e.loginInProgress=!1,e.logoutInProgress=!1,e.wrongUserCredentials=!1,e.passwordExpired=!1,e.selectedUsers=[],e.userToSave={},e.groupsTree=g(),e.isUserLoggedIn=i.isUserLoggedIn,e.isUsernameEditable=_,e.isCurrentPasswordNeeded=M,e.isCurrentUser=C,e.isUserLocal=T,e.isUsernameFormatValid=w,e.isPasswordFormatValid=S,e.isUserInfoValid=E,e.passwordsMatch=k,e.getUsernameRequiredLength=x,e.getValidationResults=I,e.localLogin=p,e.localLogout=m,e.changeExpiredPassword=v,e.startOidcLogin=f,e.oidcLoginAvailable=h,e.getNrOfUserAttributes=y,e.saveUser=O,e.removeUsers=P,e.closeForm=R,e.isUserVisibleInList=V,e.isUserEnabledInList=A,e.selectAllUsers=L,e.deselectAllUsers=D,e.refreshUsersList=N,e.getUserById=G,e.updateGroupsForSelectedUsers=H,e.updateSelectedUsersAfterGroupCheck=z,e.toggleGroupChecked=j,e.toggleGroupExpanded=B,e.resetUserGroups=W,e.saveUserGroups=K,e.isDataChanged=q,e.getAllGroups=X,e.discardPublicGroup=Z;var Q={},ee={usernameUnique:!0,emailFormat:!0,currentPassword:!0};l()}function IndoorViewer(e){function t(){var t;t=e.base_url?e.base_url:window.location.href.split(/[?#]/)[0],window.IV.base_url=t.replace(/\/?$/,"/")}function n(){window.IV_={},angular.extend(window.IV_,window.IV);var e=Object.keys(i);for(var t in e){var n=i[e[t]],o=a(n);i[e[t]]=o,window.IV[e[t]]=o,window.IV_[e[t]]=n}}function a(e){return function(){return window.IV.injector.get("LicenseService").isFeatureEnabled("api")?e.apply(this,Array.prototype.slice.call(arguments)):(setTimeout(requestAnimationFrame_,0),null)}}var i=this,o=null;this.reinit=function(){o.reinit()},this.setSceneRendering=function(e,t){o.setSceneRendering(e,t)},this.moveToPOIID=function(e,t,n){return o.moveToPOIID(e,t,n)},this.moveToPOI=function(e,t,n){return o.moveToPOI(e,t,n)},this.moveToStartingLoc=function(){o.moveToStartingLoc()},this.moveToLocationID=function(e,t){return o.moveToLocationID(e,t)},this.moveToLocation=function(e,t,n){return o.moveToLocation(e,t,n)},this.moveToGeoLocation=function(e,t,n,a,i,r,s){return o.moveToGeoLocation(e,t,n,a,i,r,s)},this.moveToDataset=function(e,t,n){return o.moveToDataset(e,t,n)},this.isMoving=function(){return o.isMoving()},this.getMainView=function(){return o.getMainView()},this.getMapView=function(){return o.getMapView()},this.resetView=function(){return o.resetView()},this.setMainScene=function(e){return o.setMainScene(e)},this.swapScenes=function(){return o.swapScenes()},this.setPOITypesVisibility=function(e,t){o.setPOITypesVisibility(e,t)},this.getShareURL=function(){return o.getShareURL()},this.setLanguage=function(e){o.setLanguage(e)},this.getLanguage=function(){return o.getLanguage()},this.getCurrentCursorPosition=function(){return o.getCurrentCursorPosition()},this.addEventListener=function(e,t){return o.addEventListener(e,t)},this.triggerEvent=function(e,t){return o.triggerEvent(e,t)},this.route=function(e,t,n){return o.route(e,t,n)};var r=function(){redirectAngularBaseURL(IndoorViewerWebApp,window.IV.base_url),""!=e.base_url&&(THREE_IV.ImageUtils.crossOrigin="anonymous",THREE_IV.OBJLoader.crossOrigin="anonymous")},s=function(){angular.element(document).ready(function(){i.injector=window.IV.injector=angular.bootstrap(document,["IVWebApp"]),o=window.IV.injector.get("IndoorViewerFactory").create(e)})};this.getScreenShot=function(e){return o.getScreenShot(e)},void 0===window.IV.base_url&&(e=e||{},e.base_url=e.base_url||"",t(),r(),s(),n())}function Octree(e,t,n,a,i,o,r){this.queue=new Array,this.max_depth=t,this.res=n;var s=0;this.root=new OctreeNode(1,i,o,r),this.queue.push(this.root);for(var l=0,c=0,d=0,u=0;this.queue.length;){var g=this.queue.shift();if(s>=e.length)throw"Premature end of octree data";var p=g.keys[3];p<t?deserialize(g,p,this.queue,e[s++]):p==t?(l=e[s++],c=g.keys[0]<<1,d=g.keys[1]<<1,u=g.keys[2]<<1,1&l&&a(this,g.children[0],c,d,u),2&l&&a(this,g.children[1],c,d,u+1),4&l&&a(this,g.children[2],c,d+1,u),8&l&&a(this,g.children[3],c,d+1,u+1),16&l&&a(this,g.children[4],c+1,d,u),32&l&&a(this,g.children[5],c+1,d,u+1),64&l&&a(this,g.children[6],c+1,d+1,u),128&l&&a(this,g.children[7],c+1,d+1,u+1)):console.error("shouldn't be here...")}}function OctreeNode(e,t,n,a){this.children=new Array(8),this.keys=new Int32Array(4),this.keys[0]=t,this.keys[1]=n,this.keys[2]=a,this.keys[3]=e}function getDepth(e){return e.keys[3]}function deserialize(e,t,n,a){var i=e.keys[0]<<1,o=e.keys[1]<<1,r=e.keys[2]<<1,s=void 0,l=t+1;1&a&&(s=new OctreeNode(l,i,o,r),e.children[0]=s,n.push(s)),2&a&&(s=new OctreeNode(l,i,o,r+1),e.children[1]=s,n.push(s)),4&a&&(s=new OctreeNode(l,i,o+1,r),e.children[2]=s,n.push(s)),8&a&&(s=new OctreeNode(l,i,o+1,r+1),e.children[3]=s,n.push(s)),16&a&&(s=new OctreeNode(l,i+1,o,r),e.children[4]=s,n.push(s)),32&a&&(s=new OctreeNode(l,i+1,o,r+1),e.children[5]=s,n.push(s)),64&a&&(s=new OctreeNode(l,i+1,o+1,r),e.children[6]=s,n.push(s)),128&a&&(s=new OctreeNode(l,i+1,o+1,r+1),e.children[7]=s,n.push(s))}LicenseFactory.$inject=["$resource"],FlowService.$inject=["flowFactory"],GroupService.$inject=["gettext","gettextCatalog","localStorageService","GroupFactory","UserService"],JobsListService.$inject=["$http","$timeout","IV","DatasetManagementService","FlowService"],LanguageService.$inject=["gettextCatalog","ConfigService","localStorageService"],StatusCheckService.$inject=["$http","$log","$q","CreditsService","UserService","ViewMenuService"],TextGenService.$inject=["gettext"],UserService.$inject=["$timeout","$window","localStorageService","UserFactory","ConfigService"],GeoRegOLMController.$inject=["$element","$scope","$timeout","$q","GeoRegistrationService","ConfigService","DatasetService","ModeService"],GroupController.$inject=["$scope","$q","gettext","gettextCatalog","GroupService","UserService","MessageReportingService"],UserController.$inject=["$scope","$window","$q","gettextCatalog","UserService","GroupService","MessageReportingService","IV"],function(){"use strict";var e=Hammer.EVENT_START,t=Hammer.EVENT_MOVE,n=Hammer.EVENT_END,a=Hammer.event.determineEventTypes(),i=Hammer.utils,o=Hammer.PointerEvent;Hammer.event.onTouch=function(r,s,l){var c=this,d=function(a){var d,u=a.type.toLowerCase(),g=Hammer.HAS_POINTEREVENTS,p=i.inStr(u,"mouse"),m=s;c.shouldDetect&&m===t&&a.button===-1&&0===a.buttons&&(m=d=n),p&&c.preventMouseEvents||(p&&m==e?(c.preventMouseEvents=!1,c.shouldDetect=!0):g&&m==e?c.shouldDetect=!0:p||m!=e||(c.preventMouseEvents=!0,c.shouldDetect=!0),g&&m!=n&&o.updatePointer(m,a),c.shouldDetect&&(d=c.doDetect.call(c,a,m,r,l)),d==n&&(c.preventMouseEvents=!1,c.shouldDetect=!1,o.reset()),g&&m==n&&o.updatePointer(m,a))};return this.on(r,a[s],d),d}}(),window.onload=function(){function e(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return e}var t=function(){var e=document.createElement("div");e.innerHTML='<h1>Your browser or system does not support WebGL</h1><h2>WebGL could not be initialized.</h2><p>Please make sure your browser and graphics hardware support WebGL.<br>Recent versions of <a href="http://www.google.com/chrome/" target="_blank">Google Chrome</a> and<a href="http://www.mozilla.org/firefox" target="_blank">Mozilla Firefox</a> should work fine.</p><p>See <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">this page</a> onhow to get a WebGL implementation.</p><p>You can test if your browser supports WebGL <a href="http://get.webgl.org/" target="_blank">here</a>.</p>',e.style.position="absolute",e.id="webGlMissingIE",e.className="webGlMissing",document.body.appendChild(e)};e()>-1?t():null};var isPlatform=function(e){var t={iOS:["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"]};return t[e].indexOf(navigator.platform)>-1},isMobileBrowser=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|ad|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},hasMethods=function(e){for(var t,n=1;t=arguments[n++];)if("function"!=typeof e[t])return!1;return!0};Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return 180*e/Math.PI};var areObjectCoordinatesCompatible=function(e,t){return!e||!t||null==e.dataset_id||null==t.dataset_id||(e.geo_registered&&t.geo_registered||e.dataset_id==t.dataset_id)};window.KeyEvent||(window.KeyEvent={},window.KeyEvent.DOM_VK_CANCEL=3,window.KeyEvent.DOM_VK_HELP=6,window.KeyEvent.DOM_VK_BACK_SPACE=8,window.KeyEvent.DOM_VK_TAB=9,window.KeyEvent.DOM_VK_CLEAR=12,window.KeyEvent.DOM_VK_RETURN=13,window.KeyEvent.DOM_VK_ENTER=14,window.KeyEvent.DOM_VK_SHIFT=16,window.KeyEvent.DOM_VK_CONTROL=17,window.KeyEvent.DOM_VK_ALT=18,window.KeyEvent.DOM_VK_PAUSE=19,window.KeyEvent.DOM_VK_CAPS_LOCK=20,window.KeyEvent.DOM_VK_ESCAPE=27,window.KeyEvent.DOM_VK_SPACE=32,window.KeyEvent.DOM_VK_PAGE_UP=33,window.KeyEvent.DOM_VK_PAGE_DOWN=34,window.KeyEvent.DOM_VK_END=35,window.KeyEvent.DOM_VK_HOME=36,window.KeyEvent.DOM_VK_LEFT=37,window.KeyEvent.DOM_VK_UP=38,window.KeyEvent.DOM_VK_RIGHT=39,window.KeyEvent.DOM_VK_DOWN=40,window.KeyEvent.DOM_VK_PRINTSCREEN=44,window.KeyEvent.DOM_VK_INSERT=45,window.KeyEvent.DOM_VK_DELETE=46,window.KeyEvent.DOM_VK_0=48,window.KeyEvent.DOM_VK_1=49,window.KeyEvent.DOM_VK_2=50,window.KeyEvent.DOM_VK_3=51,window.KeyEvent.DOM_VK_4=52,window.KeyEvent.DOM_VK_5=53,window.KeyEvent.DOM_VK_6=54,window.KeyEvent.DOM_VK_7=55,window.KeyEvent.DOM_VK_8=56,window.KeyEvent.DOM_VK_9=57,window.KeyEvent.DOM_VK_SEMICOLON=59,window.KeyEvent.DOM_VK_EQUALS=61,window.KeyEvent.DOM_VK_A=65,window.KeyEvent.DOM_VK_B=66,window.KeyEvent.DOM_VK_C=67,window.KeyEvent.DOM_VK_D=68,window.KeyEvent.DOM_VK_E=69,window.KeyEvent.DOM_VK_F=70,window.KeyEvent.DOM_VK_G=71,window.KeyEvent.DOM_VK_H=72,window.KeyEvent.DOM_VK_I=73,window.KeyEvent.DOM_VK_J=74,window.KeyEvent.DOM_VK_K=75,window.KeyEvent.DOM_VK_L=76,window.KeyEvent.DOM_VK_M=77,window.KeyEvent.DOM_VK_N=78,window.KeyEvent.DOM_VK_O=79,window.KeyEvent.DOM_VK_P=80,window.KeyEvent.DOM_VK_Q=81,window.KeyEvent.DOM_VK_R=82,window.KeyEvent.DOM_VK_S=83,window.KeyEvent.DOM_VK_T=84,window.KeyEvent.DOM_VK_U=85,window.KeyEvent.DOM_VK_V=86,window.KeyEvent.DOM_VK_W=87,window.KeyEvent.DOM_VK_X=88,window.KeyEvent.DOM_VK_Y=89,window.KeyEvent.DOM_VK_Z=90,window.KeyEvent.DOM_VK_CONTEXT_MENU=93,window.KeyEvent.DOM_VK_NUMPAD0=96,window.KeyEvent.DOM_VK_NUMPAD1=97,window.KeyEvent.DOM_VK_NUMPAD2=98,window.KeyEvent.DOM_VK_NUMPAD3=99,window.KeyEvent.DOM_VK_NUMPAD4=100,window.KeyEvent.DOM_VK_NUMPAD5=101,window.KeyEvent.DOM_VK_NUMPAD6=102,window.KeyEvent.DOM_VK_NUMPAD7=103,window.KeyEvent.DOM_VK_NUMPAD8=104,window.KeyEvent.DOM_VK_NUMPAD9=105,window.KeyEvent.DOM_VK_MULTIPLY=106,window.KeyEvent.DOM_VK_ADD=107,window.KeyEvent.DOM_VK_SEPARATOR=108,window.KeyEvent.DOM_VK_SUBTRACT=109,window.KeyEvent.DOM_VK_DECIMAL=110,window.KeyEvent.DOM_VK_DIVIDE=111,window.KeyEvent.DOM_VK_F1=112,window.KeyEvent.DOM_VK_F2=113,window.KeyEvent.DOM_VK_F3=114,window.KeyEvent.DOM_VK_F4=115,window.KeyEvent.DOM_VK_F5=116,window.KeyEvent.DOM_VK_F6=117,window.KeyEvent.DOM_VK_F7=118,window.KeyEvent.DOM_VK_F8=119,window.KeyEvent.DOM_VK_F9=120,window.KeyEvent.DOM_VK_F10=121,window.KeyEvent.DOM_VK_F11=122,window.KeyEvent.DOM_VK_F12=123,window.KeyEvent.DOM_VK_F13=124,window.KeyEvent.DOM_VK_F14=125,window.KeyEvent.DOM_VK_F15=126,window.KeyEvent.DOM_VK_F16=127,window.KeyEvent.DOM_VK_F17=128,window.KeyEvent.DOM_VK_F18=129,window.KeyEvent.DOM_VK_F19=130,window.KeyEvent.DOM_VK_F20=131,window.KeyEvent.DOM_VK_F21=132,window.KeyEvent.DOM_VK_F22=133,window.KeyEvent.DOM_VK_F23=134,window.KeyEvent.DOM_VK_F24=135,window.KeyEvent.DOM_VK_NUM_LOCK=144,window.KeyEvent.DOM_VK_SCROLL_LOCK=145,window.KeyEvent.DOM_VK_COMMA=188,window.KeyEvent.DOM_VK_PERIOD=190,window.KeyEvent.DOM_VK_SLASH=191,window.KeyEvent.DOM_VK_BACK_QUOTE=192,window.KeyEvent.DOM_VK_OPEN_BRACKET=219,window.KeyEvent.DOM_VK_BACK_SLASH=220,window.KeyEvent.DOM_VK_CLOSE_BRACKET=221,window.KeyEvent.DOM_VK_QUOTE=222,window.KeyEvent.DOM_VK_META=224),window.Keypress||(window.Keypress={},window.Keypress.DOM_VK_DELETE=127,window.Keypress.DOM_VK_SPACE=32),function(){var e=1;Object.defineProperty(Object.prototype,"__unique_id",{writable:!0}),Object.defineProperty(Object.prototype,"unique_id",{get:function(){return void 0==this.__unique_id&&(this.__unique_id=e++),this.__unique_id}})}();var invalidateAngular=function(){window.IV.injector&&window.IV.injector.get("$timeout")(function(){})};$.fn.modal.Constructor.prototype.enforceFocus=function(){var e=this.$element;$(document).on("focusin.modal",function(t){e[0]===t.target||e.has(t.target).length||0!==$(t.target).parentsUntil('*[role="dialog"]').length||e.focus()})};var nearlyEqual=function(e,t,n){n=n||1e-5;var a=Math.abs(e),i=Math.abs(t),o=Math.abs(e-t);return e==t||(0==e||0==t||o<Number.MIN_VALUE?o<n*Number.MIN_VALUE:o/Math.min(a+i,Number.MAX_VALUE)<n)},nearestPow2=function(e,t){var n=Math.pow(2,Math.round(Math.log(e)/Math.log(2)));return"floor"===t&&n>e?n>>=1:"ceiling"===t&&n<e&&(n<<=1),n},escapeXMLTagContent=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};!function(){function e(e){var t=e.firstElementChild,n=e.lastElementChild,a=t.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,a.style.width=t.offsetWidth+1+"px",a.style.height=t.offsetHeight+1+"px",t.scrollLeft=t.scrollWidth,t.scrollTop=t.scrollHeight}window.addResizeEventListener=function(t,n){function a(){n(),e(this)}var i=document.createElement("div");t.appendChild(i),i.className="resize-triggers",i.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e(i),i.addEventListener("scroll",a,!0)},window.forceResizeEvent=function(t){e($(t).find(".resize-triggers")[0])}}();var getEventPosition=function(e){var t=function(e,t){var n={x:void 0,y:void 0};if(void 0===e.offsetX||navigator.userAgent.toLowerCase().indexOf("firefox")>-1){n.x=e.pageX,n.y=e.pageY;for(var a=t||e.target.offsetParent;a;)n.x-=a.offsetLeft,n.y-=a.offsetTop,a=a.offsetParent}else n.x=e.offsetX,n.y=e.offsetY;return n};return void 0!==e.offsetX||void 0!==e.pageX?t(e):e.originalEvent?t(e.originalEvent):e.gesture&&e.gesture.center?t(e.gesture.center,e.gesture.target):t(e.touches&&e.touches.length?e.touches[0]:e.gesture.srcEvent)},getMouseWheelDelta=function(e){var t=e.originalEvent||e;return t.wheelDeltaY?-t.wheelDeltaY/120:t.wheelDelta?-t.wheelDelta/120:t.detail/3};THREE.Object3D.prototype.toJSON=void 0;var updateOrthographicCamera=function(e,t){var n=e.userData.fov/100,a=t.getCurrentWidth(),i=t.getCurrentHeight();e.left=-a/2*n,e.right=a/2*n,e.top=i/2*n,e.bottom=-i/2*n,e.updateProjectionMatrix()},getTarget=function(e){return e.hasOwnProperty("elements")?new THREE.Vector3(e.elements[8],e.elements[9],e.elements[10]).negate():new THREE.Vector3(e.matrix.elements[8],e.matrix.elements[9],e.matrix.elements[10]).negate()},setMeshScreenSize=function(){var e=new THREE.Frustum,t=new THREE.Matrix4,n=function(e,t,n,a){if(n&&t>1||a&&t<1)e.scale.set(1,1,1);else{var i=e.material.map?e.material.map.image:void 0,o=i?i.width/i.height*t:t;e.scale.set(o,t,t)}};return function(a,i,o,r,s){var l=a.getCamera(),c=a.getWidth();if(i instanceof Array||(i=[i]),l instanceof THREE.PerspectiveCamera){e.setFromMatrix(t.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse));for(var d in i){var u=i[d],g=u.position.clone();g.project(l),g.x+=o/c,g.unproject(l);var p;u instanceof THREE.Sprite?p=g.distanceTo(u.position)/(Math.sqrt(2)/2*1):e.intersectsObject(u)&&(p=g.distanceTo(u.position)/u.geometry.boundingSphere.radius),void 0!==p&&n(u,p,r,s)}}else{var m=l.right-l.left;for(var d in i){var p=o/2/c*m/i[d].geometry.boundingSphere.radius;n(i[d],p,r,s)}}}}(),setSpritePositionAndScreenSize=function(e,t,n){function a(e,t,n,a){var i=e.userData.anchor_point.clone();t instanceof THREE.PerspectiveCamera&&i.project(t),a&&i.addScaledVector(a,n),i.x+=n*u.width/2,t instanceof THREE.PerspectiveCamera&&i.unproject(t),e.position.copy(i)}var i=e.getCamera(),o=e.getWidth();if(t instanceof Array||(t=[t]),i instanceof THREE.PerspectiveCamera){var r=100,s=45,l=r/o;for(var c in t){var d=t[c],u=t[c].material.map.image,g=n.clone();g.x-=u.width/18,d.userData.anchor_point&&a(d,i,l/s,g)}setMeshScreenSize(e,t,s)}else{var r=i.right-i.left,l=(i.top-i.bottom,r/o);for(var c in t){var d=t[c],u=t[c].material.map.image,p=u.height*l;d.userData.anchor_point&&a(d,i,l,n),d.scale.set(u.width/u.height*p,p,p)}}},makeTextSprite=function(e,t){void 0===t&&(t={});var n=t.font_modifier||"bold",a=t.font_face||"Open Sans",i=t.font_size||18,o=t.font_color||"rgba(255,255,255,1)",r=t.font_stroke_width||0,s=t.font_stroke_color||"rgba(0,0,0,1)",l=t.background_color,c=t.background_blur,d=t.border_width||0,u=t.border_color||"rgba(0,0,0,1)",g=t.padding||4,p=t.init_zero_scale||!1,m=1.3,v=document.createElement("canvas"),f=v.getContext("2d");f.font=n+" "+i+"px "+a;var h=f.measureText(e),b=nearestPow2(h.width+2*d+g,"ceiling"),y=nearestPow2(i*m+2*d,"ceiling");v.width=b,v.height=y,v.style.width=b,v.style.height=y;var _=Math.round(d+.5*g),w=Math.round(.5*v.height+.5*i/m),S=Math.round(.5*d),E=Math.round(w-.5*d-i/m-g),M=Math.round(h.width+g+d),C=Math.round(2*g+i/m+d);d&&(f.lineWidth=d,f.strokeStyle=u,f.strokeRect(S,E,M,C)),l&&(f.fillStyle=l,f.fillRect(S,E,M,C)),f.font=n+" "+i+"px "+a,c&&(f.shadowColor=c,f.shadowBlur=2,f.lineWidth=1,f.strokeStyle=c,f.strokeText(e,_,w),f.fillText(e,_,w),f.shadowBlur=0),r>0&&(f.lineWidth=r,f.strokeStyle=s,f.strokeText(e,_,w)),f.lineWidth=1,f.fillStyle=o,f.fillText(e,_,w);var T=new THREE.Texture(v);T.generateMipmaps=!1,T.magFilter=THREE.LinearFilter,T.minFilter=THREE.LinearFilter,T.needsUpdate=!0;var k=new THREE.SpriteMaterial({map:T,transparent:!0}),x=new THREE.Sprite(k);return p&&x.scale.set(0,0,0),
x.userData.text_width=h.width,x.userData.text=e,x},removeTextSprite=function(e){e.parent&&(e.material.map.dispose(),e.material.dispose(),e.parent.remove(e))};THREE.ImageUtils.generateDataTexture=function(e,t,n){for(var a=e*t,i=new Uint8Array(3*a),o=Math.floor(255*n.r),r=Math.floor(255*n.g),s=Math.floor(255*n.b),l=0;l<a;l++)i[3*l]=o,i[3*l+1]=r,i[3*l+2]=s;var c=new THREE.DataTexture(i,e,t,THREE.RGBFormat);return c.needsUpdate=!0,c},THREE_IV={},THREE_IV.ImageUtils={loadTexture:function(e,t,n,a){isUrlRelative(e)&&0!==e.indexOf("data:")&&(e=window.IV.base_url+e);var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new THREE.Texture((void 0),t);return i.load(e,function(e){o.image=e,o.needsUpdate=!0,n&&n(o)},void 0,function(e){a&&a(e)}),o.sourceFile=e,o}},THREE_IV.OBJLoader=function(){this.load=function(e,t,n,a){return isUrlRelative(e)&&(e=window.IV.base_url+e),Object.getPrototypeOf(this).load.call(this,e,t,n,a)}},THREE_IV.OBJLoader.prototype=new THREE.OBJLoader;var translateCamera=function(e,t,n,a,i){var o=new THREE.Vector3(n/e*2,-a/t*2,0),r=new THREE.Vector3(0,0,0);o.unproject(i),r.unproject(i);var s=r.sub(o);i.position.add(s)},equalVectors=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z};THREE.Matrix4.prototype.print=function(){var e=this.elements;return e[0].toFixed(3)+"\t"+e[4].toFixed(3)+"\t"+e[8].toFixed(3)+"\t"+e[12].toFixed(3)+"\n"+e[1].toFixed(3)+"\t"+e[5].toFixed(3)+"\t"+e[9].toFixed(3)+"\t"+e[13].toFixed(3)+"\n"+e[2].toFixed(3)+"\t"+e[6].toFixed(3)+"\t"+e[10].toFixed(3)+"\t"+e[14].toFixed(3)+"\n"+e[3].toFixed(3)+"\t"+e[7].toFixed(3)+"\t"+e[11].toFixed(3)+"\t"+e[15].toFixed(3)};var OpenLayersMap=function(e,t,n,a){function i(e){var t={},a=e.whichMap,i=[e.geometry.x-p[a].location[0],e.geometry.y-p[a].location[1]];if(p[a].lock){var o=p[a].location;return void s(e.geometry,o[0],o[1])}n.config.stateDirty=!0,invalidateAngular();var l=n.mod_data.locations4326[a];c.setOffsetFromGlobal(l),l=T([p[a].location[0]+i[0],p[a].location[1]+i[1]]),d.setOffsetFromGlobal(l),angular.forEach(p,function(e,a){!e.lock&&e.mapLayer.visibility&&(t[a]=C(d.toGlobal(c.toLocal(n.mod_data.locations4326[a]))))}),angular.forEach(p,function(n,a){!n.lock&&n.mapLayer.visibility&&(n.location[0]=t[a][0],n.location[1]=t[a][1],k(n,a),n.markerLayer.features[0]!==e&&(n.markerLayer.features[0].geometry.x=t[a][0],n.markerLayer.features[0].geometry.y=t[a][1]),E(n.markerLayer.features[0].geometry),M(n),r(n.mapLayer))})}function o(e){v=new OpenLayers.Layer.Vector("LocationMarker"),g.addLayer(v);var t=new OpenLayers.Geometry.Point(e[0],e[1]),n=new OpenLayers.Feature.Vector(t);n.geometry.bounds=new OpenLayers.Bounds,E(n.geometry),v.addFeatures([n])}function r(e){e.visibility&&(e.setVisibility(!1),e.setVisibility(!0))}function s(e,t,n){e.x=t,e.y=n,E(e)}var l=this,c=new window.IV.services.GeoTransformationService(t),d=new window.IV.services.GeoTransformationService(t),u=new OpenLayers.Projection("EPSG:4326"),g=void 0,p={},m=!1,v=void 0,f={},h=function(){OpenLayers.Renderer.SVG.MAX_PIXEL=Number.MAX_VALUE,g=new OpenLayers.Map(e,{numZoomLevels:25,units:"m",projection:new OpenLayers.Projection("EPSG:900913")}),g.events.register("mousedown",g,function(t){$("#"+e).trigger("mousedown")},!0);for(var t in x)if(x.hasOwnProperty(t)){var n=x[t](t);g.addLayers([n]),n.mapObject&&n.mapObject.setTilt(0)}g.setCenter(new OpenLayers.LonLat(0,90).transform(u,g.getProjectionObject()),0)},b=function(e){var t={serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],resolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169,.037322767712175846,.018661383856087923,.009330691928043961],sphericalMercator:!0,attribution:"© Mapbox, © OpenStreetMap"};return new OpenLayers.Layer.OSM(e,a.getString("core.map.tile_url"),t)},y=function(e){return new OpenLayers.Layer.Google(e,{sphericalMercator:!0,type:google.maps.MapTypeId.ROADMAP})},_=function(e){return new OpenLayers.Layer.Google(e,{sphericalMercator:!0,type:google.maps.MapTypeId.HYBRID})},w=function(e){return 1/Math.cos(2*Math.atan(Math.exp(e*Math.PI/20037508.34))-Math.PI/2)};this.addMap=function(e,t){var a=function(){var t=p[e.id].location[1];return e.getGridmapRes()*w(t)},i=C(t);if(p[e.id])return!1;p[e.id]={gridmap_size:e.gridmap_size_,gridmap_res:e.getGridmapRes(),gridmap_origin:e.gridmap_origin_,location:i,lock:!1};var o=-e.gridmap_origin_.x/e.getGridmapRes(),r=-e.gridmap_origin_.y/e.getGridmapRes(),s=e.getGridmapOrientation(),l=Math.cos(s)*o+Math.sin(s)*r,c=-Math.sin(s)*o+Math.cos(s)*r;c=e.gridmap_size_.y-c-1;var d=-l,u=-c,v={getUrl:function(){return e.getGridmapDir()+e.getGridmapFilename()},getXO:function(){return d*a()/g.getResolution()},getYO:function(){return u*a()/g.getResolution()},getW:function(){return e.gridmap_size_.x*a()/g.getResolution()},getH:function(){return e.gridmap_size_.y*a()/g.getResolution()},getR:function(){var t=n.mod_data.orientations[e.id],a=t+e.getGridmapOrientation();return 180*-a/Math.PI},getOpacity:function(){return m&&!p[e.id].markerLayer.visibility?.3:1}},f={externalGraphic:"${getUrl}",graphicXOffset:"${getXO}",graphicYOffset:"${getYO}",graphicWidth:"${getW}",graphicHeight:"${getH}",rotation:"${getR}",pointerEvents:"none",graphicOpacity:"${getOpacity}"},h=new OpenLayers.Style(f,{context:v}),b=new OpenLayers.Layer.Vector(e.id,{});return b.styleMap=h,b.setVisibility(!1),g.addLayer(b),p[e.id].mapLayer=b,M(p[e.id]),S(i,e.id),n.config.map_data_present[e.id]=!0,!0},this.removeDeletedMaps=function(e){angular.forEach(p,function(t,n){e[n]||(g.removeLayer(t.mapLayer),delete layerOfGridMap[n])})},this.updateMapSize=function(){g.updateSize()};var S=function(e,t){var n=new OpenLayers.Layer.Vector("Marker"+t);g.addLayer(n);var a=new OpenLayers.Geometry.Point(e[0],e[1]),o=new OpenLayers.Feature.Vector(a);o.geometry.bounds=new OpenLayers.Bounds,E(o.geometry),o.whichMap=t,n.addFeatures([o]);var r=new OpenLayers.Control.DragFeature(n,{onDrag:i});g.addControl(r),r.deactivate(),p[t].markerLayer=n,n.setVisibility(!1),p[t].drag=r},E=function(e){var t=e.bounds,n=e.x,a=e.y;t.left=n-1,t.bottom=a-1,t.right=n+1,t.top=a+1};this.makeMapsTransparent=function(e){m=e,angular.forEach(p,function(e){r(e.mapLayer)})},this.zoomToMap=function(e){if(e.id)e.getCenterGlobal().then(function(e){var t=C(e);g.setCenter(new OpenLayers.LonLat(t[0],t[1]),18)});else{var n=[0,0],a=[];angular.forEach(e,function(e){a.push(e.getCenterGlobal())}),t.all(a).then(function(t){angular.forEach(t,function(e){var t=C(e);n[0]+=t[0],n[1]+=t[1]}),n[0]/=Object.keys(e).length,n[1]/=Object.keys(e).length,g.setCenter(new OpenLayers.LonLat(n[0],n[1]),18)})}},this.showMap=function(e){p[e]&&p[e].mapLayer.setVisibility(!0)},this.hideMap=function(e){p[e]&&(p[e].mapLayer.setVisibility(!1),p[e].markerLayer.setVisibility(!1),p[e].drag.deactivate())},this.lock=function(e){p[e]&&(p[e].lock=!0)},this.unlock=function(e){p[e]&&(p[e].lock=!1)};var M=function(e){e.pointFeature&&e.mapLayer.removeFeatures(e.pointFeature);var t=e.location,n=new OpenLayers.Geometry.Point(t[0],t[1]),a=e.gridmap_origin.length(),i=e.gridmap_size,o=e.gridmap_res,r=w(t[1]),s=(i.length()*o+a)*r;n.setBounds(new OpenLayers.Bounds(t[0]-s,t[1]-s,t[0]+s,t[1]+s)),e.pointFeature=new OpenLayers.Feature.Vector(n),e.mapLayer.addFeatures(e.pointFeature)};this.moveDragControlTo=function(e){p[e]&&p[e].mapLayer.visibility&&(angular.forEach(p,function(e){e.markerLayer.setVisibility(!1),e.drag.deactivate()}),g.removeLayer(p[e].markerLayer),g.addLayer(p[e].markerLayer),p[e].markerLayer.setVisibility(!0),p[e].drag.activate())},this.moveLocationMarkerTo=function(e){var t=[e.longitude,e.latitude],n=C(t);if(v){var a=v.features[0].geometry;s(a,n[0],n[1]),r(v)}else o(n)},this.zoomToLocation=function(e,t){var n=[e.longitude,e.latitude],a=C(n);g.setCenter(a,t)},this.addClickHandler=function(e){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(t){var n=g.getLonLatFromViewPortPx(t.xy),a=T([n.lon,n.lat]);e({longitude:a[0],latitude:a[1]})}});var t=new OpenLayers.Control.Click;g.addControl(t),t.activate(),f.click=t},this.controlActivate=function(e,t){t?f[e].activate():f[e].deactivate()},this.updateLocationsFromService=function(e){var t;angular.forEach(p,function(n,a){n.location=C(e[a]),s(n.markerLayer.features[0].geometry,n.location[0],n.location[1]),n.markerLayer.getVisibility()&&(t=a),M(n),r(n.mapLayer),l.moveDragControlTo(t)})},this.translateMapsAndTheirMarkers=function(e){angular.forEach(p,function(t,n){if(!t.lock&&t.mapLayer.visibility){if(t.location[0]+=e.x,t.location[1]+=e.y,k(t,n,e.z),t.markerLayer.features[0]){var a=t.markerLayer.features[0].geometry;s(a,a.x+e.x,a.y+e.y)}M(t),r(t.mapLayer)}})};var C=function(e){var t=new OpenLayers.LonLat(e[0],e[1]);return t.transform(u,g.getProjectionObject()),[t.lon,t.lat]},T=function(e){var t=new OpenLayers.LonLat(e[0],e[1]);return t.transform(g.getProjectionObject(),u),[t.lon,t.lat]};this.switchBaseLayer=function(){var e=Object.keys(x),t=e.indexOf(g.baseLayer.name);if(t>-1){var n=e[++t%I];g.setBaseLayer(g.getLayersByName(n)[0])}};var k=function(e,t,a){var i=T(e.location);n.mod_data.locations4326[t][0]=i[0],n.mod_data.locations4326[t][1]=i[1],a&&(n.mod_data.locations4326[t][2]+=a)},x={};x["OSM Roadmap"]=b,"undefined"!=typeof google&&(x["Google Roadmap"]=y,x["Google Hybrid"]=_);var I=Object.keys(x).length;h()},Quaternion2SQLArray=function(e){var t="ARRAY["+e.w+","+e.x+","+e.y+","+e.z+"]";return t},WKT2Vector=function(e,t){var n=e.parse(t);return n?new THREE.Vector3(n.coordinates[0],n.coordinates[1],n.coordinates[2]):null},SQLArray2Quaternion=function(e){if(!e)return null;var t=!1;if("ARRAY"===e.substring(0,5)&&(t=!0),t){e=e.substring(5,e.length);var n=JSON.parse(e);return n?new THREE.Quaternion(n[1],n[2],n[3],n[0]):null}var n=angular.fromJson(e.replace("{","[").replace("}","]"));return n?new THREE.Quaternion(n[1],n[2],n[3],n[0]):null};window.IV={},window.IV.updateCursor=!1,window.IV.layers={},window.IV.services={},window.IV.utils={};var IndoorViewerWebApp;!function(){var e=["ui.bootstrap","ngResource","ngCkeditor","angularFileUpload","ui.slider","ngSanitize","ngCookies","gettext","LocalStorageModule","flow","ngAnimate","luegg.directives","angular-progress-arc"];"undefined"!=typeof IndoorViewerWebAppExtraModules&&(e=e.concat(IndoorViewerWebAppExtraModules)),IndoorViewerWebApp=angular.module("IVWebApp",e)}(),IndoorViewerWebApp.factory("IV",[function(){var e=window.IV_;return delete window.IV_,e}]),IndoorViewerWebApp.filter("reverse",[function(){return function(e){return e.slice().reverse()}}]),IndoorViewerWebApp.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(blob|http|https):/)}]),IndoorViewerWebApp.run(["ConfigService",function(e){e.initialized.then(function(){var t="tracking.enabled",n=e.isConfigAvailable(t)&&e.getBoolean(t,!1);if(n){var a=e.getString("tracking.code",void 0);if(void 0===a||""==a)return void console.log("Warning: tracking has been enabled but tracking code is empty or even doesn't exist, so won't insert anything!");a.indexOf("<script")===-1&&(a='<script type="text/javascript">'+a+"</script>"),angular.element("head").append(a)}})}]),IndoorViewerWebApp.directive("clickedOutsideThisPanel",["$document",function(e){return{restrict:"A",link:function(t,n,a,i){n.bind("mousedown",function(e){e.originalEvent&&(e.originalEvent.clickedOnPanel=!0)}),e.bind("mousedown",function(e){e.originalEvent&&e.originalEvent.clickedOnPanel||t.$apply(a.clickedOutsideThisPanel)})}}}]),IndoorViewerWebApp.directive("stackModal",["$document",function(e){return{restrict:"A",link:function(t,n,a){n.bind("shown.bs.modal",function(t){"undefined"==typeof e.data("num_open_modals")&&e.data("num_open_modals",0),n.hasClass("iv-modal-stack")||(n.addClass("iv-modal-stack"),e.data("num_open_modals",e.data("num_open_modals")+1),n.css("z-index",1040+10*e.data("num_open_modals")),e.find(".modal-backdrop").not(".iv-modal-stack").css("z-index",1039+10*e.data("num_open_modals")),e.find(".modal-backdrop").not("iv-modal-stack").addClass("iv-modal-stack"))}),n.bind("hidden.bs.modal",function(t){n.removeClass("iv-modal-stack"),e.data("num_open_modals",e.data("num_open_modals")-1)})}}}]),IndoorViewerWebApp.directive("triggerCursorViz",["$document","IV",function(e,t){return{restrict:"A",link:function(e,n,a){n.bind("shown.bs.modal",function(e){t.getMainView().getLayer(t.layers.CursorLayer).setVisibility(!1),t.getMainView().invalidateScene()}),n.bind("hidden.bs.modal",function(e){t.getMainView().getLayer(t.layers.CursorLayer).setVisibility(!0),t.getMainView().invalidateScene()})}}}]);var redirectAngularBaseURL=function(e,t){e.config(["$httpProvider",function(e){e.interceptors.push("middleware")}]),e.factory("middleware",[function(){return{request:function(e){return isUrlRelative(e.url)&&0!=e.url.indexOf("templates/")&&0!=e.url.indexOf("template/typeahead/")&&(e.url=t+e.url),e}}}])};IndoorViewerWebApp.directive("img",["IV",function(e){return{restrict:"E",priority:99,link:function(t,n,a,i){a.$observe("src",function(t){e.base_url&&isUrlRelative(t)&&0!=t.indexOf("data:")&&a.$set("src",e.base_url+t)})}}}]),IndoorViewerWebApp.directive("optionsDisabled",["$parse",function(e){var t=function(e,t,n,a,i){angular.forEach(n.find("option"),function(n,o){var r=angular.element(n);if(""!=r.val()){var s={};s[t]=a[o],r.attr("disabled",i(e,s))}})};return{priority:0,require:"ngModel",link:function(n,a,i,o){var r=i.optionsDisabled.match(/^\s*(.+)\s+for\s+(.+)\s+in\s+(.+)?\s*/),s=r[3],l=e(r[1]);n.$watch(s,function(e,i){e&&t(n,r[2],a,e,l)},!0),n.$watch(i.ngModel,function(i,o){var c=e(s)(n);i&&t(n,r[2],a,c,l)})}}}]),IndoorViewerWebApp.directive("initFocus",["$timeout",function(e){function t(e,t){t.bind("shown.bs.modal",function(){e[0].focus()})}function n(t){e(function(){t[0].focus()})}return function(e,a){var i=a.parents(".modal");i.length?t(a,i):n(a)}}]),IndoorViewerWebApp.directive("keepFocus",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,i){i.$parsers.unshift(function(t){return e(function(){n[0].focus()}),t})}}}]),IndoorViewerWebApp.directive("pressKey",[function(){var e={13:"enter",27:"esc"};return function(t,n,a){n.bind("keydown keypress",function(n){var i=e[n.which],o=JSON.parse(a.pressKey);i&&(t.$apply(function(){t.$eval(o[i]+"("+o.data+")")}),n.preventDefault())})}}]);var buttonDirective=["$compile","gettext",function(e,t){var n="btn panel-control-button",a={"ok-button":{"class":"btn-primary ok-button",text:t("Okay")},"save-button":{"class":"btn-primary save-button",text:t("Save")},"abort-button":{"class":"btn-default abort-button",text:t("Abort")},"cancel-button":{"class":"btn-default cancel-button",text:t("Cancel")},"close-button":{"class":"btn-default close-button",text:t("Close")},"discard-button":{"class":"btn-danger discard-button",text:t("Discard")},"delete-button":{"class":"btn-danger delete-button",text:t("Delete")},"undo-button":{"class":"btn-default undo-button",text:t("Undo")},"move-button":{"class":"btn-default move-button",text:t("Move")},"default-button":{"class":"btn-default",text:""}};return{restrict:"E",link:function(t,i,o,r){function s(e,t){var a=" "+n+" "+e["class"],o=t.type||"button",r='<button type="'+o+'" ';for(var s in t)if(!s.startsWith("$")){var l=t.$attr[s],c=t[s]+("class"===l?a:"");r+=l+'="'+c+'" '}t["class"]||(r+='class="'+a+'"'),t.inProgress&&(r+=' ng-disabled="'+t.inProgress+'"',r+=" ng-class=\"{'in-progress': "+t.inProgress+'}"');var d=i.text().trim()||e.text;i.children("span").length&&(d=i.children("span").text()),d="<span translate>"+d+"</span>";var u='<span class="spinner spinner-in-btn"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span>';return r+=">"+d+u+"</button>"}var l=i[0].tagName.toLowerCase(),c=a[l];if(c){var d=s(c,o),u=e(d)(t);i.replaceWith(u)}}}}];IndoorViewerWebApp.directive("okButton",buttonDirective).directive("saveButton",buttonDirective).directive("abortButton",buttonDirective).directive("cancelButton",buttonDirective).directive("closeButton",buttonDirective).directive("discardButton",buttonDirective).directive("deleteButton",buttonDirective).directive("undoButton",buttonDirective).directive("moveButton",buttonDirective).directive("defaultButton",buttonDirective),IndoorViewerWebApp.directive("resizeHandler",["$document",function(e){return{restrict:"A",link:function(t,n,a){var i=a.direction||"left",o=a.collapseThreshold||100,r=a.collapsedSize,s=a.minExpandedSize,l=!1;n.on("mousedown",function(t){function a(e,t){var a="left"===i?t.right-e:e-t.left;return n.parent().css("width",a+"px"),a}function c(e,t){var a="top"===i?t.bottom-e:e-t.top;return n.parent().css("height",a+"px"),a}function d(){var e=g()?n.parent().width():n.parent().height(),t=e<=o?r:Math.max(e,s);n.parent().css(p(),t+"px")}function u(e){e<=o?n.parent().addClass("collapsed"):n.parent().removeClass("collapsed")}function g(){return"left"===i||"right"===i}function p(){return g()?"width":"height"}l=!0,n.addClass("resizing"),e.on("mousemove",function(e){if(l){var t=n.parent()[0].getBoundingClientRect(),i=g()?a(e.clientX,t):c(e.clientY,t);u(i)}}).on("mouseup",function(e){l=!1,n.removeClass("resizing"),void 0!==r&&void 0!==s&&d()})})}}}]),IndoorViewerWebApp.directive("expandHandler",["$document",function(e){return{restrict:"A",link:function(e,t,n){function a(){var e=o(t.parent().width());return t.parent().css("width",e+"px"),e}function i(){var e=o(t.parent().height());return t.parent().css("height",e+"px"),e}function o(e){var t=e<=l?d:l;return t===l&&(d=Math.max(e,c)),t}function r(e){e<=l?t.parent().addClass("collapsed"):t.parent().removeClass("collapsed")}var s=n.direction||"horizontal",l=n.collapsedSize||15,c=n.expandedSize||375,d=c;t.on("click",function(e){var t="horizontal"===s?a():i();r(t)})}}}]),IndoorViewerWebApp.directive("resizeEvent",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){function a(){clearTimeout(o),o=setTimeout(function(){e.$apply(function(){e.$eval(n.resizeEvent)})},i)}var i=n.delay||0,o=void 0;window.addResizeEventListener(t[0],a)}}}]),IndoorViewerWebApp.filter("orderObjectBy",[function(){return function(e,t,n){var a=[];return angular.forEach(e,function(e){a.push(e)}),a.sort(function(e,n){return e[t].toString().toLowerCase()>n[t].toString().toLowerCase()?1:-1}),n&&a.reverse(),a}}]),IndoorViewerWebApp.filter("orderObjectByFunction",[function(){return function(e,t,n){var a=[];return angular.forEach(e,function(e){a.push(e)}),a.sort(function(e,n){return angular.isString(e[t]())?angular.isString(n[t]())?e[t]().toString().toLowerCase()>n[t]().toString().toLowerCase()?1:-1:1:-1}),n&&a.reverse(),a}}]),IndoorViewerWebApp.factory("ArcGISRouteFactory",["$resource","$q","RouteFactory",function(e,t,n){var a=function(e){try{var t=angular.fromJson(e);return t.provider="ArcGISRouteFactory",t}catch(n){return{error:e,exception:n}}},i=e("//service02.eggits.net/arcgis/rest/services/:service/:sub_service/GPServer/Route/execute",{f:"json",returnZ:"true","env:outSR":"4326",outputLines:"esriNAOutputLineTrueShape"},{get:{method:"GET",transformResponse:a}});i.service="CampusNavigator",i.sub_service="IndoorOutdoorRouting",i.getRoute=function(n,a,r){r.setName("Routing (ArcGIS)");var s={geometryType:"esriGeometryPoint",features:[{geometry:{x:n.geometry_.coordinates[0],y:n.geometry_.coordinates[1],spatialReference:{wkid:4326}},attributes:{height:n.geometry_.coordinates[2]}},{geometry:{x:a.geometry_.coordinates[0],y:a.geometry_.coordinates[1],spatialReference:{wkid:4326}},attributes:{height:a.geometry_.coordinates[2]}}],sr:{wkid:4326}},l=t.defer(),c=e("");return c.$promise=l.promise,i.get({service:i.service,sub_service:i.sub_service,InputLocations:s},function(e){o(e,r,l,c)},function(e){l.reject(e)}),c};var o=function(e,n,a,i){if(e.message=null,e.waypoints=null,e.instructions=null,e.geometry=null,!e||e.error||!e.results||e.results.length<2){var o=["Error"];return e.error&&(e.error.code&&o.push(e.error.code),e.error.details&&o.splice.apply(o,[o.length-1,0].concat(e.error.details)),e.error.message&&o.push(e.error.message)),e.message=o.join(" - "),delete e.name,angular.copy(e,i),void a.reject(e)}var c=e.results[1].value.features,d=e.results[2].value.features;e.geometry=e.results[0];for(var u=!1,g=!1,p=[],m=0,v=[],f=[],h=[],b=0;b<d.length;++b){var y=d[b].attributes.NodeType;if("indoor"!=y&&"stop"!=y||!g){if(("outdoor"==y||"stop"==y)&&u){for(;m<c.length;m++)if(c[m].attributes.Text.indexOf("transition")>=0){var _=v.length;v[_]=[],f[_]=[],h[_]=e.provider,s(v[_],c[m]),l(f[_],c[m]);break}m++}}else{var _=v.length;for(v[_]=[],f[_]=[],h[_]=e.provider;m<c.length&&(s(v[_],c[m]),l(f[_],c[m]),!(c[m].attributes.Text.indexOf("transition")>=0));m++);m++}if("indoor"==y){var _=v.length;v[_]=[],f[_]=[],h[_]="RouteFactory";var w=d[b++].attributes.IndoorNodeID,S=d[b].attributes.IndoorNodeID,E=r(w,S,v[_],f[_],n);p.push(E),g=!1,u=!0}else"outdoor"==y&&(g=!0,u=!1,b++)}n.addItems(p.length+1),n.itemDone(),n.setName("Routing (Indoor)"),t.all(p).then(function(){e.segments=[];for(var t=0;t<v.length;t++)e.segments.push({provider:h[t],waypoints:{features:v[t]},instructions:f[t]});angular.copy(e,i),a.resolve(e)})},r=function(e,t,a,i,o){return n.getRouteByNodeID(e,t).$promise.then(function(e){o.itemDone(),angular.copy(e.segments[0].waypoints.features,a),angular.copy(e.segments[0].instructions.features,i),i.length>=2&&(i.splice(0,1),i.splice(i.length-1,1))},function(){o.itemDone()})},s=function(e,t){if(t.geometry)for(var n=t.geometry.paths[0],a=0;a<n.length-1;++a){for(var i={geometry:{coordinates:[n[a],n[a+1]],type:"LineString"}},o=0;o<2;++o)i.geometry.coordinates[o].length<3&&(i.geometry.coordinates[o][2]=0);e.push(i)}},l=function(e,t){var n=t.attributes.Text,a="forward";n.indexOf("left")>=0?a="left":n.indexOf("right")>=0&&(a="right");var i,o,r,s=0;t.geometry&&t.geometry.paths&&(i=t.geometry.paths[0][0][0],o=t.geometry.paths[0][0][1],r=t.geometry.paths[0][0][2],t.geometry.paths[0].length>1&&(s=c(i,t.geometry.paths[0][1][0],o,t.geometry.paths[0][1][1]))),e.push({text:n,icon:a,bearing:s,coordinates:{x:i,y:o,z:r},original_geometry:t.geometry})},c=function(e,t,n,a){e*=Math.PI/180,t*=Math.PI/180,n*=Math.PI/180,a*=Math.PI/180;var i=t-e,o=Math.sin(i)*Math.cos(a),r=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(i);return 180*Math.atan2(o,r)/Math.PI};return i}]),IndoorViewerWebApp.factory("ArcGISSearchFactory",["$resource","GeoTransformationService",function(e,t){var n=function(e){var t=angular.fromJson(e).candidates;return t instanceof Array&&angular.forEach(t,function(e){a(e)}),t},a=function(e){e.location_=t.toLocal(e.location.x,e.location.y,0),e.geometry_={type:"point",coordinates:[e.location.x,e.location.y,0]},e.name=e.address,e.id=e.address,e.geo_registered=!0,e.read_only_=!0,e.id_routable_=!1,e.getCode=function(){return e.name},e.getDescription=function(){return""},e.getIcon=function(){return"img/poi/unknown.png"}},i=e("http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates",{f:"json",outSR:"{wkid:4326}",outFields:"Loc_name",country:"DEU",region:"Bayern",category:"POI,Street Name,Street Address"},{query:{method:"GET",isArray:!0,transformResponse:n}});return i.search=function(e,t,n){return i.query({SingleLine:e},t,n)},i}]),IndoorViewerWebApp.factory("BundlesFactory",["$resource",function(e){function t(e){return e=e instanceof Array?e:[e],JSON.stringify({bundles:e},stripCustomFields)}return e("res/bundles",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).bundles}},update:{method:"PUT",transformRequest:t}})}]),IndoorViewerWebApp.factory("CameraHeadFactory",["$resource",function(e){return e("res/camera_heads",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).camera_heads}}})}]),IndoorViewerWebApp.factory("ConfigFactory",["$resource",function(e){return e("res/config",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).configs}},update:{method:"PUT",transformRequest:function(e){return e instanceof Array?JSON.stringify({configs:e},stripCustomFields):JSON.stringify({configs:[e]},stripCustomFields)},transformResponse:function(){}},remove:{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("DatasetsFactory",["$resource","GeoTransformationService",function(e,t){function n(e){var t={directory:"img/",filename:"gridmap_fallback.png",res:.02,orientation:0,size:"POINT(500 500)",origin:"POINT(-5 -5)"};s[e.color]&&(e.color=s[e.color]),e.getDirectory=function(){return"data/"+e.name+"/"},e.isOctreeAvailable=function(){return"NAVVIS"==e.type},e.hasPanoramas=function(){return"NAVVIS"==e.type},e.getOctreeDirectory=function(){return e.getDirectory()+"ooc/"},e.getOctreeConfigFilename=function(){return e.getOctreeDirectory()+"ooc_config.js"},e.getOctreeDataFilename=function(){return e.getOctreeDirectory()+"ooc_data.dat"},e.getPotreeConfigFilename=function(){return"data/"+e.name+"/webcloud/cloud.js"},e.isGridmapAvailable=function(){return!!e.gridmap_filename},e.getGridmapDir=function(){return e.isGridmapAvailable()?e.getDirectory():t.directory},e.getGridmapFilename=function(){return e.isGridmapAvailable()?e.gridmap_filename:t.filename},e.getGridmapRes=function(){return e.isGridmapAvailable()?e.gridmap_res:t.res},e.getGridmapOrientation=function(){return e.isGridmapAvailable()?e.gridmap_orientation:t.orientation},e.getGridmapSize=function(){return e.isGridmapAvailable()?e.gridmap_size:t.size},e.getGridmapOrigin=function(){return e.isGridmapAvailable()?e.gridmap_origin:t.origin},e.getPointCloudObject=function(){return e.pcObj_||(e.pcObj_={}),e.pcObj_};var n=o.read(e.getGridmapSize());e.gridmap_size_=new THREE.Vector2(n.geometry.x,n.geometry.y);var a=o.read(e.getGridmapOrigin());e.gridmap_origin_=new THREE.Vector2(a.geometry.x,a.geometry.y),e.global_location_=r.parse(e.location).coordinates}function a(e){return e instanceof Array||(e=[e]),angular.forEach(e,function(e){e.global_location_&&(e.location=t.getPosGeometryString(e.global_location_))}),JSON.stringify({datasets:e},stripCustomFields)}function i(e){var t=angular.fromJson(e).datasets;return t?(t instanceof Array?t.forEach(n):n(t),t):t}var o=new OpenLayers.Format.WKT,r=new WKTParser,s={"#5AA7D4":"blue","#75A0F0":"blue","#9AA7D4":"purple","#5AFFFF":"cyan","#59F0A7":"lime","#18D500":"light green","#18D540":"green","#DBDB00":"yellow","#DBDB40":"yellow","#F07000":"deep orange","#F07040":"orange","#FF2020":"red"};return e("res/datasets",{},{query:{method:"GET",isArray:!0,transformResponse:i},update:{method:"PUT",transformRequest:a,transformResponse:function(){}}})}]),IndoorViewerWebApp.factory("EdgesFactory",["$resource",function(e){var t=function(e){try{var t=angular.fromJson(e).edges}catch(a){return{error:e}}return t instanceof Array&&angular.forEach(t,function(e){n(e)}),t},n=function(e){e.attributesMap_=a(e.attributes)},a=function(e){var t={};if(null==e||""==e)return t;if(e.indexOf("=")<0)return t;for(var n=e.substring(1,e.length-1).split(","),a=0,i=n.length;a<i;a++){var o=n[a].split("=");t[o[0].trim()]=o[1].trim()}return t},i=function(e){return angular.forEach(e,function(e){e.attributesMap_&&(e.attributes=o(e.attributesMap_))}),e instanceof Array?JSON.stringify({edges:e},stripCustomFields):JSON.stringify({edges:[e]},stripCustomFields)},o=function(e){var t="";return angular.forEach(e,function(n,a){t+=a.trim()+"=>"+(e[a].trim().indexOf(" ")>-1?'"'+e[a].trim()+'"':e[a].trim()?e[a].trim():'"NULL"'),t+=","}),t.substring(0,t.length-1)};return e("res/edges",{},{query:{method:"GET",isArray:!0,transformResponse:t},create:{method:"POST",transformRequest:function(e){return JSON.stringify({edges:[e]})},transformResponse:function(e){return angular.fromJson(e).edges[0]}},remove:{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",transformRequest:i,transformResponse:t}})}]),IndoorViewerWebApp.factory("FloorLevelFactory",["$resource",function(e){var t=function(e){return e instanceof Array||(e=[e]),JSON.stringify({floor_levels:e},stripCustomFields)};return e("res/floor_levels",{},{query:{method:"GET"},update:{method:"PUT",transformRequest:t},create:{method:"POST",transformRequest:t},"delete":{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("GroupFactory",["$resource",function(e){return e("",{id:"@id"},{queryGroups:{url:"api/groups",method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e)}},addGroup:{url:"api/groups",method:"PUT"},updateGroup:{url:"api/groups",method:"POST"},removeGroup:{url:"api/groups/:id",method:"DELETE"}})}]),IndoorViewerWebApp.factory("ImagesFactory",["$resource","GeoTransformationService",function(e,t){var n=function(e){return e instanceof Array||(e=[e]),angular.forEach(e,function(e){e.location_&&(e.location=t.getPosGeometryString(t.toGlobal(e.location_))),e.dataset_location_&&(e.dataset_location=t.getPosGeometryString(e.dataset_location_)),e.floor_location_&&(e.floor_location=t.getPosGeometryString(t.toGlobal(e.floor_location_))),e.dataset_floor_location_&&(e.dataset_floor_location=t.getPosGeometryString(e.dataset_floor_location_)),e.orientation_&&(e.orientation=Quaternion2SQLArray(e.orientation_)),e.dataset_orientation_&&(e.dataset_orientation=Quaternion2SQLArray(e.dataset_orientation_))}),JSON.stringify({images:e},stripCustomFields)};return e("res/images",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).images}},update:{method:"PUT",transformRequest:n,transformResponse:function(){}}})}]),angular.module("IVWebApp").factory("LicenseFactory",LicenseFactory),IndoorViewerWebApp.factory("MapMeshFactory",["$resource","GeoTransformationService",function(e,t){var n=function(e){return e instanceof Array||(e=[e]),angular.forEach(e,function(e){e.location_&&(e.location=t.getPosGeometryString(t.toGlobal(e.location_))),e.dataset_location_&&(e.dataset_location=t.getPosGeometryString(e.dataset_location_)),e.orientation_&&(e.orientation=Quaternion2SQLArray(e.orientation_)),e.dataset_orientation_&&(e.dataset_orientation=Quaternion2SQLArray(e.dataset_orientation_))}),JSON.stringify({map_meshes:e},stripCustomFields)};return e("res/map_meshes",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).map_meshs}},update:{method:"PUT",transformRequest:n,transformResponse:function(){}}})}]),IndoorViewerWebApp.factory("MeasureFactory",["$resource",function(e){return e("res/measure",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).measures}},create:{method:"POST",transformRequest:function(e){return JSON.stringify({measure:[e]})},transformResponse:function(e){return angular.fromJson(e).measures[0]}},update:{method:"PUT",transformRequest:function(e){return e instanceof Array?JSON.stringify({measure:e}):JSON.stringify({measure:[e]})}},remove:{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("NodesFactory",["$resource","GeoTransformationService",function(e,t){var n=new WKTParser,a=function(e){try{var t=angular.fromJson(e).nodes}catch(n){return{error:e}}return t instanceof Array&&angular.forEach(t,function(e){i(e)}),t},i=function(e){e.attributesMap_=o(e.attributes);var a=n.parse(e.geometry).coordinates;
return e.coordinates_local=t.toLocal.apply(this,a),e},o=function(e){var t={};if(null==e||""==e)return t;if(e.indexOf("=")<0)return t;for(var n=e.substring(1,e.length-1).split(","),a=0,i=n.length;a<i;a++){var o=n[a].split("=");t[o[0].trim()]=o[1].trim()}return t},r=function(e){return angular.forEach(e,function(e){e.attributesMap_&&(e.attributes=s(e.attributesMap_))}),e instanceof Array?JSON.stringify({nodes:e},stripCustomFields):JSON.stringify({nodes:[e]},stripCustomFields)},s=function(e){var t="";return angular.forEach(e,function(n,a){t+=a.trim()+"=>"+(e[a].trim().indexOf(" ")>-1?'"'+e[a].trim()+'"':e[a].trim()?e[a].trim():'"NULL"'),t+=","}),t.substring(0,t.length-1)};return e("res/nodes",{},{query:{method:"GET",isArray:!0,transformResponse:a},create:{method:"POST",transformRequest:function(e){return JSON.stringify({nodes:[e]})},transformResponse:function(e){return i(angular.fromJson(e).nodes[0])}},update:{method:"PUT",transformRequest:r},remove:{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("POIFactory",["$resource","$q","IV","GeoTransformationService","POITranslationsFactory","POITypeService","LanguageService",function(e,t,n,a,i,o,r){var s=new WKTParser,l=function(e){try{var t=angular.fromJson(e).pois}catch(n){return{error:e}}return t instanceof Array&&angular.forEach(t,function(e){g(e)}),t},c=function(e){return e instanceof Array||(e=[e]),angular.forEach(e,function(e){e.reference_marker?e.geometry_wkt=a.getPosGeometryString(e.geometry_.coordinates):e.geometry_wkt=a.getPosGeometryString(a.toGlobal(e.location_)),e.orientation_&&(e.orientation=Quaternion2SQLArray(e.orientation_)),e.dataset_location_&&(e.dataset_location=a.getPosGeometryString(e.dataset_location_)),e.dataset_orientation_&&(e.dataset_orientation=Quaternion2SQLArray(e.dataset_orientation_))}),JSON.stringify({pois:e},stripCustomFields)},d=function(){var e=t.defer();this.$done=e.promise;var n=this;return n.hasOwnProperty("id")?(p.update([n],function(){e.resolve()},function(){e.reject()}),angular.forEach(n.translations_,function(e,t){e&&(e.code||e.description)?(e.poi_id=n.id,n.translations_[e.language_key]=e.save()):delete n.translations_[t]})):p.create([n],function(t){var a=[];angular.forEach(n.translations_,function(e){(e.code||e.description)&&(e.poi_id=t[0].id,a.push(e))});var o=function(){angular.copy(t[0],n),n.$done=e.promise,g(n),n.translations_=i.getByPoiId({poi_id:n.id}),n.translations_.$promise.then(function(){e.resolve()})};i.create(a,o)},function(){e.reject()}),n},u=function(e,n){function a(){o.$remove(e),r.resolve()}var o=this,r=t.defer();return i.remove({poi_id:o.id},a,n),r.promise},g=function(e){angular.isString(e.reference_marker)&&(e.reference_marker="true"===e.reference_marker),angular.isString(e.visibilitycheck)&&(e.visibilitycheck="true"===e.visibilitycheck),e.geometry_=s.parse(e.geometry_wkt),e.reference_marker||(e.location_=a.toLocal(e.geometry_.coordinates[0],e.geometry_.coordinates[1],e.geometry_.coordinates[2])),e.orientation&&(e.orientation_=SQLArray2Quaternion(e.orientation)),e.dataset_location&&(e.dataset_location_=WKT2Vector(s,e.dataset_location)),e.dataset_orientation&&(e.dataset_orientation_=SQLArray2Quaternion(e.dataset_orientation)),e.geo_registered=!0,e.read_only_=!1,e.id_routable_=!0,e.getCode=function(e){var t=this.getTranslation(e);return t?t.code:""},e.getDescription=function(e){var t=this.getTranslation(e),a=t?t.description:"";if(n.base_url&&a)for(var i,o=/src=\"(.*?)\"/g,r=5;null!=(i=o.exec(a));){var s=i[1];isUrlRelative(s)&&0!=s.indexOf("data:")&&(a=a.slice(0,i.index+r)+n.base_url+a.slice(i.index+r))}return a},e.getTranslation=function(e){e=e||r.getDataLanguage();var t=this.translations_[e];return void 0==t||void 0==t.code?this.translations_[r.getFallbackLanguage()]:t},e.getIcon=function(){return this.icon&&""!==this.icon?this.icon:o.getType(this.poi_type)&&o.getType(this.poi_type).icon?o.getType(this.poi_type).icon:"img/dummy.jpg"},e.remove=u,e.save=d},p=e("res/pois/:id",{},{get:{method:"GET",isArray:!0,transformResponse:l},create:{method:"POST",isArray:!0,transformRequest:c,transformResponse:l},update:{method:"PUT",transformRequest:c,transformResponse:function(){}},remove:{method:"DELETE",params:{id:"@id"}}});return p.createPOIObject=function(){var e={};e.poi_type="",e.level="-1",e.translations_={};var t=i.createTranslationObject();return e.translations_[t.language_key]=t,e.current_language_=t,e.save=d,e.geo_registered=!0,e.read_only_=!1,e.id_routable_=!1,e.reference_marker=!1,e.importance=.5,e.visibilitycheck=!0,e},p.createReadOnlyPOI=function(e,t,n){var i={};return i.location_=e.clone(),i.geometry_={type:"point",coordinates:a.toGlobal(i.location_)},i.id=i.geometry_.coordinates[0]+","+i.geometry_.coordinates[1]+","+i.geometry_.coordinates[2],i.geo_registered=!0,i.read_only_=!0,i.id_routable_=!1,i.location_as_poi_=!0,i.getCode=function(){return t},i.getDescription=function(){return""},i.getIcon=function(){return n},i},p}]),IndoorViewerWebApp.factory("POITranslationsFactory",["$resource","LanguageService",function(e,t){var n=e("res/poi_translations/",{},{get:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e).poi_translations;return t}},create:{method:"POST",transformRequest:function(e){return JSON.stringify({poi_translations:e},stripCustomFields)},transformResponse:function(e){var t=angular.fromJson(e).poi_translations;return n.getTranslationsMap(t)}},update:{method:"PUT",transformRequest:function(e){return JSON.stringify({poi_translations:[e]},stripCustomFields)}},remove:{method:"DELETE",params:{poi_id:"@poi_id",id:"@id"}},query:{url:"res/poi_translations_search",method:"GET",isArray:!0,transformResponse:function(e){for(var n=angular.fromJson(e).poi_translations,a={},i=[],o=0;o<n.length;o++){var r=n[o];r.language_name_=t.getLanguageName(r.language_key),a[r.poi_id]={id:r.poi_id}}for(var s in a)i.push(a[s]);return i}},getByPoiId:{method:"GET",params:{poi_id:"@poi_id"},isArray:!1,transformResponse:function(e){var t=angular.fromJson(e).poi_translations;return n.getTranslationsMap(t)}}}),a=function(){var e=this;if(""==e.code&&""==e.description)n.remove({id:e.id}),e=void 0;else if(void 0==e.id){var t=n.create([e]);t.$promise.then(function(){e.id=t[e.language_key].id})}else n.update(e);return e};n.getTranslationsMap=function(e){var n={};for(var i in e){var o=e[i];o.language_name_=t.getLanguageName(o.language_key),o.save=a,n[o.language_key]=angular.copy(o)}return n},n.createTranslationObject=function(e){var n=e||t.getFallbackLanguage(),i={};return i.language_name_=t.getLanguageName(n),i.language_key=n,i.save=a,i};var i=function(e){return"~"+(e.replace(/[!:*@&"'§$%\/\(\)=\?|]/g,"").trim()+" ").replace(/\s+/g,":* ").trim().replace(/\s+/g," & ")};return n.search=function(e,t,a){return n.query({search_idx_col:i(e)},t,a)},n}]),IndoorViewerWebApp.factory("POITypeTranslationsFactory",["$resource","LanguageService",function(e,t){var n=translationsHelper(t),a=e("res/poi_type_translations",{},{create:{method:"POST",transformRequest:function(e){var t={};return t.poi_type_translations=e,JSON.stringify(t,stripCustomFields)},transformResponse:function(e){return angular.fromJson(e).poi_type_translations[0]}},update:{method:"PUT",transformRequest:function(e){var t={};return t.poi_type_translations=[e],JSON.stringify(t,stripCustomFields)}},remove:{method:"DELETE",params:{poi_type_id:"@poi_type_id",id:"@id"}},getByObjectId:{method:"GET",params:{poi_type_id:"@poi_type_id"},isArray:!1,transformResponse:function(e){var t=angular.fromJson(e).poi_type_translations;return angular.forEach(t,function(e){e.save=n.getSaveTranslationFunction(a)}),n.getTranslationsMap(t)}}});return a.createTranslationObject=n.getCreateTranslationFunction(a),a}]),IndoorViewerWebApp.factory("POITypesFactory",["$resource","$q","POITypeTranslationsFactory","LanguageService",function(e,t,n,a){var i=translationsHelper(a),o=function(){var e=t.defer();this.$done=e.promise;var a=this;return a.id?(s.update(a,function(){e.resolve()},function(t){e.reject(t)}),angular.forEach(a.translations_,function(e){e.hasOwnProperty("name")&&null!=e.name&&null!=e.save?(e.poi_type_id=a.id,a.translations_[e.language_key]=e.save()):delete a.translations_[e.language_key]})):s.create(a,function(t){var i=[];angular.forEach(a.translations_,function(e){e.hasOwnProperty("name")&&null!=e.name&&""!=e.name&&(e.poi_type_id=t.id,i.push(e))});var o=function(){a.id=t.id,r(a),a.$done=e.promise,e.resolve()};n.create(i,o)},function(t){e.reject(t)}),a},r=i.getAugmentFunction("poi_type_id",n,o),s=e("res/poi_types",{},{get:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e).types;return angular.forEach(t,r),t}},create:{method:"POST",transformRequest:function(e){var t={};return t.types=[e],JSON.stringify(t,stripCustomFields)},transformResponse:function(e){var t=angular.fromJson(e).types[0];return t}},update:{method:"PUT",transformRequest:function(e){var t={};return t.types=[e],JSON.stringify(t,stripCustomFields)}},remove:{method:"DELETE",params:{id:"@id"}}});return s.createTypeObject=function(){var e={};e.icon="",e.translations_={};var t=n.createTranslationObject();return e.translations_[t.language_key]=t,e.current_language_=t,e.save=o,e},s}]),IndoorViewerWebApp.factory("POITypeGroupTranslationsFactory",["$resource","LanguageService",function(e,t){var n=translationsHelper(t),a=e("res/poi_type_group_translations",{},{create:{method:"POST",transformRequest:function(e){var t={};return t.poi_type_group_translations=e,JSON.stringify(t,stripCustomFields)},transformResponse:function(e){return angular.fromJson(e).poi_type_group_translations[0]}},update:{method:"PUT",transformRequest:function(e){var t={};return t.poi_type_group_translations=[e],JSON.stringify(t,stripCustomFields)}},remove:{method:"DELETE",params:{poi_type_group_id:"@poi_type_group_id",id:"@id"}},getByObjectId:{method:"GET",params:{poi_type_group_id:"@poi_type_group_id"},isArray:!1,transformResponse:function(e){var t=angular.fromJson(e).poi_type_group_translations;return angular.forEach(t,function(e){e.save=n.getSaveTranslationFunction(a)}),n.getTranslationsMap(t)}}});return a.createTranslationObject=n.getCreateTranslationFunction(a),a}]),IndoorViewerWebApp.factory("POIGroupsFactory",["$resource","$q","POITypeGroupTranslationsFactory","LanguageService",function(e,t,n,a){var i=translationsHelper(a),o=function(){var e=t.defer();this.$done=e.promise;var a=this;return a.id?(s.update(a,function(){e.resolve()},function(t){e.reject(t)}),angular.forEach(a.translations_,function(e){e.hasOwnProperty("name")&&null!=e.name&&null!=e.save?(e.poi_type_group_id=a.id,a.translations_[e.language_key]=e.save()):delete a.translations_[e.language_key]})):s.create(a,function(t){var i=[];angular.forEach(a.translations_,function(e){e.hasOwnProperty("name")&&null!=e.name&&""!=e.name&&(e.poi_type_group_id=t.id,i.push(e))});var o=function(){a.id=t.id,r(a),a.$done=e.promise,e.resolve()};n.create(i,o)},function(t){e.reject(t)}),a},r=i.getAugmentFunction("poi_type_group_id",n,o),s=e("res/poi_type_groups",{},{get:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e).groups;return angular.forEach(t,r),t}},create:{method:"POST",transformRequest:function(e){var t={};return e.icon="not an icon. just a dummy field to make the request work",t.groups=[e],JSON.stringify(t,stripCustomFields)},transformResponse:function(e){return angular.fromJson(e).groups[0]}},update:{method:"PUT",transformRequest:function(e){return JSON.stringify({groups:[e]},stripCustomFields)}},remove:{method:"DELETE",params:{id:"@id"}}});return s.createGroupObject=function(){var e={};e.translations_={};var t=n.createTranslationObject();return e.translations_[t.language_key]=t,e.current_language_=t,e.save=o,e},s}]),IndoorViewerWebApp.factory("PolygonFactory",["$resource",function(e){var t=function(e){var t="POLYGON((";for(var n in e)t+=e[n].lon+" "+e[n].lat+",";return t=t.substring(0,t.length-1),t+="))"},n=function(e){e=e.replace("POLYGON((",""),e=e.replace("))","");var t=e.split("),("),n=[];for(var a in t){var i=t[a].split(","),o=[];for(var r in i){var s=i[r].split(" "),l={lon:parseFloat(s[0]),lat:parseFloat(s[1])};o.push(l)}n.push(o)}return n},a=function(e){var n=[];e instanceof Array||(e=[e]);for(var a in e){var i={name:e[a].name,type:e[a].type,polygon:t(e[a].polygon),z_min:parseFloat(e[a].z_min),z_max:parseFloat(e[a].z_max),vector_layer_id:parseInt(e[a].vector_layer_id)};e[a].id&&(i.id=e[a].id),n.push(i)}return JSON.stringify({polygons:n},stripCustomFields)},i=function(e){var t=angular.fromJson(e).polygons;for(var a in t){["building","floor"].indexOf(t[a].type)!=-1?t[a].editable=!0:t[a].editable=!1;var i=n(t[a].polygon);t[a].polygon=i[0],i.splice(0,1),t[a].holes=i}return t};return e("res/polygons",{},{query:{method:"GET",isArray:!0,transformResponse:i},update:{method:"PUT",transformRequest:a,transformResponse:function(){}},create:{method:"POST",isArray:!0,transformRequest:a,transformResponse:i},"delete":{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("PoseFactory",["$resource","GeoTransformationService","DatasetService",function(e,t,n){function a(e){return e instanceof Array||(e=[e]),angular.forEach(e,function(e){e.location_&&(e.location=t.getPosGeometryString(t.toGlobal(e.location_))),e.dataset_location_&&(e.dataset_location=t.getPosGeometryString(e.dataset_location_)),e.floor_location_&&(e.floor_location=t.getPosGeometryString(t.toGlobal(e.floor_location_))),e.dataset_floor_location_&&(e.dataset_floor_location=t.getPosGeometryString(e.dataset_floor_location_)),e.orientation_&&(e.orientation=Quaternion2SQLArray(e.orientation_)),e.dataset_orientation_&&(e.dataset_orientation=Quaternion2SQLArray(e.dataset_orientation_))}),JSON.stringify({poses:e},stripCustomFields)}function i(e){var t=new WKTParser,n=angular.fromJson(e).poses;return n.forEach(function(e){o(e,t)}),n}function o(e,t){e.dataset_location_=WKT2Vector(t,e.dataset_location),e.dataset_floor_location_=WKT2Vector(t,e.dataset_floor_location),e.dataset_orientation_=SQLArray2Quaternion(e.dataset_orientation),r(e)}function r(e){var t=n.datasetsIdMap[e.dataset_id],a=new THREE.Matrix4;a.compose(e.dataset_location_,e.dataset_orientation_,new THREE.Vector3(1,1,1));var i=new THREE.Matrix4;i.multiplyMatrices(t.m2w_,a),e.location_=new THREE.Vector3,e.orientation_=new THREE.Quaternion;var o=new THREE.Vector3;i.decompose(e.location_,e.orientation_,o),e.floor_location_=e.dataset_floor_location_.clone(),e.floor_location_.applyMatrix4(t.m2w_)}return e("res/poses",{},{query:{method:"GET",isArray:!0,transformResponse:i},update:{method:"PUT",transformRequest:a}})}]),IndoorViewerWebApp.factory("RouteFactory",["$resource",function(e){var t=function(e){try{var t=angular.fromJson(e);return{segments:[{provider:"RouteFactory",waypoints:t[0],instructions:t[1]}]}}catch(n){return{error:e,exception:n}}},n=e("api/route",{sourcePoi:"",targetPoi:"",simplify:1},{get:{method:"GET",transformResponse:t}});return n.getRoute=function(e,t){var a={};return e.id_routable_?a.sourcePoiId=e.id:(a.sourceX=e.geometry_.coordinates[0],a.sourceY=e.geometry_.coordinates[1],a.sourceZ=e.geometry_.coordinates[2]),t.id_routable_?a.targetPoiId=t.id:(a.targetX=t.geometry_.coordinates[0],a.targetY=t.geometry_.coordinates[1],a.targetZ=t.geometry_.coordinates[2]),n.get(a)},n.getRouteByNodeID=function(e,t){return n.get({sourceId:e,targetId:t})},n}]),IndoorViewerWebApp.factory("UserFactory",["$resource",function(e){return e("",{},{queryLoggedUser:{url:"api/user",method:"GET",isArray:!1,transformResponse:function(e){return angular.fromJson(e)}},queryUsers:{url:"api/users",method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e)}},addUser:{url:"api/users",method:"POST"},updateUserProfile:{url:"api/users/:id/profile",method:"PUT"},updateUserPrimaryGroups:{url:"api/users/:id/primary_groups",method:"PUT"},removeUser:{url:"api/users/:id",method:"DELETE"},logIn:{url:"login",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}},logOut:{url:"logout",method:"POST"},changePassword:{url:"api/users/:id/password",method:"PUT"}})}]),IndoorViewerWebApp.factory("VectorMapFactory",["$resource",function(e){var t=function(e){return e instanceof Array||(e=[e]),e.forEach(function(e){e.z_min=parseFloat(e.z_min),e.z_max=parseFloat(e.z_max),e.object_type=void 0,e.permissions=void 0}),JSON.stringify({vector_maps:e},stripCustomFields)};return e("res/vector_maps/:id",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){return angular.fromJson(e).vector_maps}},update:{method:"PUT",transformRequest:t,transformResponse:function(){}},remove:{method:"DELETE",params:{id:"@id"}}})}]),IndoorViewerWebApp.factory("VectorMapLayerFactory",["$resource",function(e){var t=function(e){var t=[];return e instanceof Array||(e=[e]),e.forEach(function(e,n){var a={id:e.id,visible:e.visible};"undefined"!=e.z_min&&(a.z_min=parseInt(e.z_min)),"undefined"!=e.z_max&&(a.z_max=parseInt(e.z_max)),t.push(a)}),JSON.stringify({layers:t},stripCustomFields)};return e("res/vector_layers/:id",{},{query:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e).vector_layers;return t}},update:{method:"PUT",transformRequest:t,transformResponse:function(){}},remove:{method:"DELETE",params:{id:"@id"}}})}]),window.IV.services.ArchitectureMarkerService=function(e,t,n,a,i,o){function r(){l.clearAllLocally(),t.query({},function(e){var t=new WKTParser;angular.forEach(e,function(e){c.push(new Measure(t.parseVector3(e.start_marker),t.parseVector3(e.end_marker),e.distance,e,l.unit,s(),o))})}),l.onUpdate()}function s(){return i.getUserInfo().default_group_write}var l=this;this.view=void 0,Measure.GeoTransformationService=e,this.data={createNewMeasureFlag:!1,stopUpdatingMeasureFlag:!1,newMarkerPosition:void 0,currentMeasure:void 0,currentView:void 0,lockXY:!1,lockZ:!1,menuShown:!1},this.unit=void 0,this.fetch=r,this.getPermissionGroup=s,this.onTransitionStart=function(){n.registerUpdateCallback(l.unique_id,function(e,t){e.showMeasurements===!0&&t.showMeasurements===!1?l.hideMeasurements():e.showMeasurements===!1&&t.showMeasurements===!0&&(r(),l.data.menuShown=!0)}),a.registerUpdateCallback(l.unique_id,function(){l.drawCurrentLine(a.cursor_pos_global)})};var c=[];this.noMeasure=function(){return 0==c.length},this.showMenu=function(){return this.data.menuShown},this.saveAll=function(){angular.forEach(c,function(e){e.isUpToDate()||e.isDeleted()||(e.setDbMeasure(t.create(e.getDbObject())),e.redraw())}),l.onUpdate()},this.areAnySaved=function(){function e(e){return e.isUpToDate()}return c.some(e)},this.lockToXY=function(){c[c.length-1].lockToXY(!0),c[c.length-1].lockToZ(!1)},this.lockToZ=function(){c[c.length-1].lockToXY(!1),c[c.length-1].lockToZ(!0)},this.lockAxes=function(e,t){this.data.lockXY=e,this.data.lockZ=t},this.getMeasurements=function(){return c},this.hideMeasurements=function(e){l.resetCurrentMeasurment(),!e&&l.hasUnsavedChanges()?angular.element("#eraseMarkers").modal("show"):l.clearAllLocally(),l.data.menuShown=!1,l.lockAxes(!1,!1)},this.clearAll=function(){angular.forEach(c,function(e){e.isDeleted()||e.remove()}),d()},this.clearAllLocally=function(){angular.forEach(c,function(e){e.destruct()}),d(),l.onUpdate()},this.setUnitAndRedrawAll=function(){angular.forEach(c,function(e){e.setUnit(l.unit),e.redraw()}),l.onUpdate()},this.hasUnsavedChanges=function(){function e(e){return!e.isUpToDate()&&!e.isDeleted()}return c.some(e)};var d=function(){c=[],l.data.currentMeasure=void 0,l.onUpdate()};this.resetCurrentMeasurment=function(){void 0!=this.data.currentMeasure&&(this.data.currentMeasure.destruct(),this.data.currentMeasure=void 0)},this.createANewArchitectureService=function(){void 0!=this.data.currentMeasure&&this.data.currentMeasure.destruct(),this.data.currentMeasure=new Measure(this.data.newMarkerPosition,(void 0),(void 0),(void 0),this.unit,s(),o)},this.stopUpdatingMeasure=function(){this.data.currentMeasure.updatePosition(l.lockToAxis(this.data.newMarkerPosition)),this.data.currentMeasure.setActive(!1),c.push(this.data.currentMeasure),this.data.currentMeasure=void 0},this.updateConfig=function(){n.config.showMeasurements=!0,invalidateAngular()},this.drawCurrentLine=function(e){void 0!=l.data.currentMeasure&&l.data.currentMeasure.updatePosition(l.lockToAxis(e))},this.lockToAxis=function(e){return this.data.lockXY?(e[0]=this.data.currentMeasure.getStart()[0],e[1]=this.data.currentMeasure.getStart()[1]):this.data.lockZ&&(e[2]=this.data.currentMeasure.getStart()[2]),e},l.onTransitionStart()},window.IV.services.ArchitectureMarkerService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("ArchitectureMarkerService",["GeoTransformationService","MeasureFactory","ViewMenuService","CursorService","UserService","gettextCatalog",window.IV.services.ArchitectureMarkerService]),window.IV.utils.SingleViewport=function(e,t){this.getWidth=function(){return e.getCurrentWidth()},this.getHeight=function(){return e.getCurrentHeight()},this.getCamera=function(){return t},this.getX=function(e){return e},this.getY=function(e){return e}},window.IV.services.CameraAndViewportService=function(e,t){var n=this,a=void 0,i={},o=void 0,r=100,s=10,l=150;this.fullWindowOn=!1,this.center_views_here=void 0,this.alignmentHelpers={TVCamera:{visibility:!1},SVCamera1:{visibility:!1},SVCamera2:{visibility:!1},defaultCamera:{visibility:!1}};var c;this.createANewBasicViewport=function(e,i,g,p,m,v,f,h,b,y,_,w,S,E,M){var C={};if(C.left=m,C.bottom=v,C.width=f,C.height=h,C.name=b,C.active=!0,C.bgColor=1644825,C.color=w,n.alignmentHelpers[b]&&(n.alignmentHelpers[b].colorCSS=S,n.alignmentHelpers[b].caption=E),"perspective"===e){s<i&&i<l?C.fieldOfView=i:C.fieldOfView=r,C.zoom=function(e,n,a){var i=d(this),r=u(i),l=this.fieldOfView;a?this.fieldOfView=Math.max(s,Math.min(r,this.fieldOfView/n)):(n*=6,this.fieldOfView=Math.max(s,Math.min(r,this.fieldOfView+n)));var g=(this.fieldOfView-l)/180*Math.PI,p=getEventPosition(e),m=o.normalizeCoordinates(p.x,p.y,0,this);o.currViewingDir.lon+=.5*(i>=1?g:g*i)*m.x,o.currViewingDir.lat-=.5*(i>=1?g/i:g)*m.y,window.clearTimeout(c),c=window.setTimeout(t.updateURL,1e3)},C.setfov=function(e){var t=u(d(this));this.fieldOfView=Math.max(s,Math.min(t,e))};var T=d(C);C.camera=new THREE.PerspectiveCamera(C.fieldOfView/T,T,.1,p),C.camera.up=y,C.camera.name=b}if("orthographic"===e){C.zoom=function(e,t,n){o.cameraZoomAndTranslate(t,n,.1,r,e),updateOrthographicCamera(this.camera,a)},C.camera=new THREE.OrthographicCamera,C.camera.near=g,C.camera.far=p,C.camera.userData.fov=i,updateOrthographicCamera(C.camera,a),C.camera.up=y,C.camera.name=b,C.camera.userData.type="orthographic";var k=angular.copy(C.camera.position);k.add(_),C.camera.lookAt(k),C.camera.updateMatrixWorld(),C.rotation_enabled=M}return C.getWidth=function(){return C.width*a.getCurrentWidth()},C.getHeight=function(){return C.height*a.getCurrentHeight()},C.getFOV=function(){return C.camera.userData.fov?C.camera.userData.fov:C.fieldOfView},C.getCamera=function(){return C.camera},C.getX=function(e){return e-C.left*a.getCurrentWidth()},C.getY=function(e){var t=1-(C.bottom+C.height),n=a.getCurrentHeight();return e-t*n},C},this.init=function(t){a=new HTMLContainer(t),angular.forEach(e.modes[e.modes.currentMode].viewports,function(e){i[e.name]=n.createANewBasicViewport(e.typeOfCamera,e.fieldOfView,e.near,e.far,e.left,e.bottom,e.width,e.height,e.name,e.upVector,e.cameraTargetPositionConstant,e.color,e.colorCSS,e.caption,e.rotation_enabled)})},this.passRefOfView=function(e){o=e},this.getDefaultCamera=function(){return i.defaultCamera.camera},this.refreshCameras=function(e){angular.forEach(i,function(t){if(t.camera instanceof THREE.PerspectiveCamera){var n=Math.PI/2-e.lat,a=e.lon,i=new THREE.Vector3(0,0,0);i.x=t.camera.position.x+Math.sin(n)*Math.cos(a),i.z=t.camera.position.z+Math.cos(n),i.y=t.camera.position.y+Math.sin(n)*Math.sin(a),t.camera.lookAt(i);var o=d(t);t.fieldOfView=Math.min(u(o),t.fieldOfView);var r=o>=1?t.fieldOfView/o:t.fieldOfView;t.camera.fov=r,t.camera.aspect=o,t.camera.updateProjectionMatrix()}})},this.renderViews=function(e,t,o){n.onWindowResize(e);var r,s,l,c;angular.forEach(i,function(n){n.active&&(r=Math.floor(a.getCurrentWidth()*n.left),s=Math.floor(a.getCurrentHeight()*n.bottom),l=Math.floor(a.getCurrentWidth()*n.width),c=Math.floor(a.getCurrentHeight()*n.height),e.setViewport(r,s,l,c),e.setScissor(r,s,l,c),e.setScissorTest(!0),e.setClearColor(n.bgColor,1),e.clear(),o.beforeRenderViewports(n),e.render(t,n.camera),o.afterRenderViewports(n))})},this.getViewport=function(e,t){var o=function(e,t,n){0===e.bottom&&t>n?l=e:e.bottom>0&&e.bottom<n&&(l=e)},r=e/a.getCurrentWidth(),s=1-t/a.getCurrentHeight(),l=!1;return angular.forEach(i,function(e){if(e.active){var t=e.bottom+e.height,n=e.left+e.width;0===e.left&&n>r?o(e,t,s):e.left>0&&e.left<r&&o(e,t,s)}}),l?l:n.getDefaultViewport()},this.getViewportByName=function(e){var t;return t=i[e],t?t:n.getDefaultViewport()},this.getDefaultViewport=function(){return i.defaultCamera},this.getXInViewport=function(e,t){return console.log("Method is deprecated, switch to equivalent class method"),getEventPosition(t).x-e.left*a.getCurrentWidth()},this.getYInViewport=function(e,t){console.log("Method is deprecated, switch to equivalent class method");var n=getEventPosition(t).y,i=1-(e.bottom+e.height),o=a.getCurrentHeight();return n-i*o},this.getWidthOfViewport=function(e){return console.log("Method is deprecated, switch to equivalent class method"),e.width*a.getCurrentWidth()},this.getHeightOfViewport=function(e){return console.log("Method is deprecated, switch to equivalent class method"),e.height*a.getCurrentHeight()},this.getFOV=function(e){return console.log("Method is deprecated, switch to equivalent class method"),e.fieldOfView},this.getCamera=function(e){return console.log("Method is deprecated, switch to equivalent class method"),e.camera},this.zoom=function(e,t,a){var i=getEventPosition(e),o=n.getViewport(i.x,i.y);o&&o.zoom(e,t,a)};var d=function(e){var t=e.width/e.height*a.getAspectRatio();return isNaN(t)?1:t},u=function(e){return Math.max(r,Math.min(l,e*r))};this.updateCameraPosition=function(e){i.defaultCamera.camera.position.copy(e)},this.moveInFreeFlight=function(t){var n=.1;"datasetAlignment"===e.modes.currentMode&&t.camera instanceof THREE.OrthographicCamera&&(n=1);var a=t.camera,i=t.camera.userData.fov?t.camera.userData.fov/r:t.camera.fov/r;return m(a,i*n)},this.flipFullDiv=function(e){e&&(n.fullWindowOn?(angular.forEach(i,function(e){e.active!==!0?e.active=!0:(e.left=e.oldLeft,e.bottom=e.oldBottom,e.width=e.oldWidth,e.height=e.oldHeight)}),n.fullWindowOn=!1):(e.oldLeft=e.left,e.oldBottom=e.bottom,e.oldWidth=e.width,e.oldHeight=e.height,e.left=0,e.bottom=0,e.width=1,e.height=1,n.fullWindowOn=!0,angular.forEach(i,function(t){t.name!==e.name&&(t.active=!1)})),invalidateAngular())},this.setViewports=function(){angular.forEach(i,function(e,t){"defaultCamera"!==t&&delete i[t]}),angular.forEach(e.modes[e.modes.currentMode].viewports,function(e){"defaultCamera"===e.name&&(i.defaultCamera.left=e.left,i.defaultCamera.bottom=e.bottom,i.defaultCamera.width=e.width,i.defaultCamera.height=e.height,i.defaultCamera.active||(i.defaultCamera.active=!0)),"defaultCamera"!==e.name&&(i[e.name]=n.createANewBasicViewport(e.typeOfCamera,e.fieldOfView,e.near,e.far,e.left,e.bottom,e.width,e.height,e.name,e.upVector,e.cameraTargetPositionConstant,e.color,e.colorCSS,e.caption,e.rotation_enabled))}),n.fullWindowOn=!1,o.invalidateScene()},this.onWindowResize=function(e){a.onResize(),e.setSize(a.getCurrentWidth(),a.getCurrentHeight()),angular.forEach(i,function(e){e.camera instanceof THREE.OrthographicCamera&&updateOrthographicCamera(e.camera,a)})},this.focusViewportsOnthisPosition=function(e){n.center_views_here=e,angular.forEach(i,function(t){t.camera.position.copy(e),t.camera.position.add(getTarget(t.camera.matrixWorld).multiplyScalar(-1*(4+t.camera.near)))}),o.invalidateScene()},this.translateSVCameras=function(e){i.SVCamera1.camera.position.add(e),i.SVCamera2.camera.position.add(e)},this.translateTVCamera=function(e){i.TVCamera.camera.position.add(e)},this.incFar=function(e,t){var n=e.camera,i=n.far+t,r=i-n.near;return r>.1&&r<200&&(i<200&&(n.far+=t),updateOrthographicCamera(n,a),o&&o.invalidateScene(),!0)};var g,p,m=function(e,t){var a=(new Date).getTime(),i=a-(g||a);if(g=a,!o)return d;var r=new THREE.Vector3(e.matrix.elements[0],e.matrix.elements[1],e.matrix.elements[2]),s=new THREE.Vector3(e.matrix.elements[4],e.matrix.elements[5],e.matrix.elements[6]),l=new THREE.Vector3(e.matrix.elements[8],e.matrix.elements[9],e.matrix.elements[10]);o.isKeyPressed(KeyEvent.DOM_VK_SHIFT)?t*=10:o.isKeyPressed(KeyEvent.DOM_VK_A)&&(t*=.1);var c=new THREE.Vector3(0,0,0);o.isKeyPressed(KeyEvent.DOM_VK_S)&&c.sub(r),o.isKeyPressed(KeyEvent.DOM_VK_F)&&c.add(r),o.isKeyPressed(KeyEvent.DOM_VK_E)&&c.add(s),o.isKeyPressed(KeyEvent.DOM_VK_D)&&c.sub(s),o.isKeyPressed(KeyEvent.DOM_VK_W)&&c.add(l),o.isKeyPressed(KeyEvent.DOM_VK_R)&&c.sub(l);var d=!1;return 0!=c.length()&&(p&&0!=p.length()&&(t*=i/16),c.setLength(t),e.position.add(c),d=!0),p=c,d&&(n.onUpdate(),o.invalidateScene()),d};this.onDragViewStart=function(e,t){var a=n.getViewport(e.x,e.y);return"defaultCamera"!==a.name?1==t:0==t},this.onDragView=function(e,t,a){if(!a)return!1;var i=n.getViewport(a.x,a.y);if("defaultCamera"!==i.name){var o=i.getWidth(),r=i.getHeight();return translateCamera(o,r,e,t,i.camera),n.onUpdate(),!0}return!1},this.getWidthInMeters=function(e){return a.getCurrentWidth()*e.camera.userData.fov/r}},window.IV.services.CameraAndViewportService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("CameraAndViewportService",["ModeService","URLService",window.IV.services.CameraAndViewportService]),window.IV.services.CameraHeadService=function(e){this.heads=null,this.headsIdMap={};var t="camera_head/",n=this,a=function(e){return angular.forEach(e,function(e){e.alpha_masks_=i(e.alpha_masks),e.meshes_=i(e.meshes),n.headsIdMap[e.id]=e}),e},i=function(e){return e?e.replace("{","").replace("}","").split(","):null},o=function(){n.heads=e.query({},function(){a(n.heads),n.onUpdate()})};this.fetchHeadData=function(e,n,a){e.alpha_masks_texture=[],e.meshes_geometry=[];var i=new THREE_IV.OBJLoader;e.loadingMeshes=0,angular.forEach(e.meshes_,function(a,o){e.loadingMeshes++,i.load(t+a,function(t){t.children[0].geometry.computeBoundingBox(),e.meshes_geometry[o]=t.children[0].geometry,e.loadingMeshes--,0==e.loadingMeshes&&n&&n()})}),angular.forEach(e.alpha_masks_,function(n,i){e.alpha_masks_texture[i]=THREE_IV.ImageUtils.loadTexture(t+n,{},function(e){a&&a()})})},this.headDataLoaded=function(e){return void 0!==e.loadingMeshes&&0===e.loadingMeshes},o()},window.IV.services.CameraHeadService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("CameraHeadService",["CameraHeadFactory",window.IV.services.CameraHeadService]),window.IV.services.ConfigService=function(e,t,n,a,i,o){function r(e){function t(t){return t.name===e}return s.config_array.filter(t)[0]}var s=this,l=n.defer();this.initialized=l.promise,this.config_array=null,this.grouped_configs=[],this.changed_configs={},this.overrides=null,this.configMap={};var c={};c[i.EFeature.ROUTING]=["layers.navgraph.visible","routing.enabled"],c[i.EFeature.ANALYST]=["tracking.code","tracking.enabled"],c[i.EFeature.USER_MANAGEMENT]=["auth.local.enabled"];var d=[{original:"layers.pointcloud.visible",alias:"pc"},{original:"core.init.lat",alias:"vlat"},{original:"core.init.lon",alias:"vlon"}],u=function(e){var t=void 0;for(var n in c)if(c[n].indexOf(e)>-1){t=n;break}return t};this.isConfigAvailable=function(e){var t=!0,n=u(e);return n&&(t=i.isFeatureEnabled(n)),t},this.fetch=function(){l=n.defer(),s.initialized=l.promise,s.grouped_configs=[],i.initialized.then(function(){s.config_array=e.query({},function(){s.updateConfigMap(),g()},l.reject)})};var g=function(){var e=angular.copy(s.config_array);angular.forEach(e,function(t,n){t.edit_in_form||delete e[n],
"enum"===t.type&&(t.possible_values_=t.possible_values.split(",")),"boolean"===t.type&&(t.value=!!s.isConfigAvailable(t.name)&&"true"===t.value)});var t=e.sort(function(e,t){return e.category.localeCompare(t.category)});if(t[0]){var n=s.grouped_configs[s.grouped_configs.push([])-1];n.category=t[0].category,angular.forEach(t,function(e){void 0!==e&&(0===n.category.localeCompare(e.category)?n.push(e):(n=s.grouped_configs[s.grouped_configs.push([])-1],n.category=e.category,n.push(e)))}),s.grouped_configs=s.grouped_configs.sort(function(e,t){return-e.length+t.length})}};this.setLocalDefaults=function(e){s.overrides=e,s.updateConfigMap()},this.updateConfigMap=function(e){var t=e||s.config_array;(s.config_array&&s.config_array.$resolved&&s.overrides||e)&&(angular.forEach(t,function(e){s.configMap[e.name]=e.value}),angular.forEach(s.overrides,function(e,t){s.configMap[t]=e}),s.updateFromURL(),l.resolve())},this.updateFromURL=function(){var e=t.search();angular.forEach(e,function(t,n){"tracking.code"!==n&&"tracking.enabled"!==n&&(d.forEach(function(t){t.alias===n&&(n=t.original),t.original===n&&delete e[t.original]}),s.configMap[n]=t)}),s.onUpdate()},this.saveConfig=function(e,t){for(var n=0;n<s.config_array.length;n++)if(s.config_array[n].name===e){var i=s.config_array[n].value;return s.config_array[n].value=t,s.config_array[n].$update(function(){s.configMap[e]=t},function(){s.config_array[n].value=i,a.showMessage(o.getString("Update failed"),o.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))})}return!1},this.saveConfigs=function(t){function n(){s.updateConfigMap(a)}var a=Object.keys(t).map(function(e){var n;return t[e].hasOwnProperty("value")?n=t[e]:(n=r(e),n.value=t[e]),n});return e.update(a,n).$promise},this.getBoolean=function(e,t){return"undefined"!=typeof s.configMap[e]&&null!==s.configMap[e]&&""!==s.configMap[e]?"true"===s.configMap[e]||s.configMap[e]===!0:t},this.getFloat=function(e,t){return"undefined"!=typeof s.configMap[e]&&null!==s.configMap[e]&&""!==s.configMap[e]?parseFloat(s.configMap[e]):t},this.getInteger=function(e,t){return"undefined"!=typeof s.configMap[e]&&null!==s.configMap[e]&&""!==s.configMap[e]?parseInt(s.configMap[e]):t},this.getString=function(e,t){return"undefined"!=typeof s.configMap[e]&&null!==s.configMap[e]?s.configMap[e]:t},this.getCSV=function(e,t,n){return"undefined"!=typeof s.configMap[e]&&null!==s.configMap[e]&&""!==s.configMap[e]?t?s.configMap[e].split(",").map(function(e){return parseInt(e,10)}):s.configMap[e].split(","):n},this.getNameByAlias=function(e){var t=null;return d.forEach(function(n){n.alias===e&&(t=n.original)}),t},this.getAliasByName=function(e){var t=null;return d.forEach(function(n){n.original===e&&(t=n.alias)}),t},this.updated=function(){s.onUpdate()},s.fetch()},window.IV.services.ConfigService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("ConfigService",["ConfigFactory","$location","$q","MessageReportingService","LicenseService","gettextCatalog",window.IV.services.ConfigService]),window.IV.services.CreditsService=function(e,t,n){var a=this;this.config={},this.version={},e.get("version.json").then(function(e){"$"==e.data.version[0]&&(e.data.version="0"),"$"==e.data.build[0]&&(e.data.build="0"),"$"==e.data.distro[0]&&(e.data.distro=""),"$"==e.data.commit[0]&&(e.data.commit=""),"$"==e.data.commit2[0]&&(e.data.commit2=""),"$"==e.data.branch[0]&&(e.data.branch="DEV"),"$"==e.data.versionstring[0]&&(e.data.versionstring="develop/src"),angular.copy(e.data,a.version)}),a.config.openSourceSoftwareUsed=void 0,this.fetchLicensesFile=function(i){a.config.openSourceSoftwareUsed?angular.element(document.querySelector(i)).modal("show"):e.get("licensesList.json").then(function(e){a.config.openSourceSoftwareUsed=e.data,angular.element(document.querySelector(i)).modal("show")},function(){t.showMessage(n.getString("Error"),n.getString("Could not fetch licenses of open source software used in IndoorViewer."))})}},window.IV.services.CreditsService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("CreditsService",["$http","MessageReportingService","gettextCatalog",window.IV.services.CreditsService]),window.IV.services.CursorService=function(e){var t=this;this.cursor_pos=void 0,this.cursor_normal=void 0,this.cursor_ori=void 0,this.cursor_pos_global=void 0,this.cursor_ori_global=void 0,this.cursor_pos_dataset=void 0,this.cursor_normal_dataset=void 0,this.cursor_ori_dataset=void 0,this.cursor_dataset=void 0,this.clicked=0,this.updateCursor=function(n,a,i,o,r){t.cursor_pos=angular.copy(n),t.cursor_normal=angular.copy(a),t.cursor_ori=new THREE.Quaternion,t.cursor_ori.setFromUnitVectors(new THREE.Vector3(1,0,0),a),t.cursor_pos_global=e.toGlobal(n),t.cursor_ori_global=t.cursor_ori,t.cursor_pos_dataset=angular.copy(o),t.cursor_normal_dataset=angular.copy(r),t.cursor_ori_dataset=new THREE.Quaternion,t.cursor_ori_dataset.setFromUnitVectors(new THREE.Vector3(1,0,0),r),t.cursor_dataset=i,invalidateAngular(),t.onUpdate()},this.getCursorData=function(){return{geometry:{type:"point",coordinates:t.cursor_pos_global},location:angular.copy(t.cursor_pos),orientation:angular.copy(t.cursor_ori),dataset_orientation:angular.copy(t.cursor_ori_dataset),dataset_location:angular.copy(t.cursor_pos_dataset),dataset_id:t.cursor_dataset?t.cursor_dataset.id:void 0}},this.onClick=function(){t.clicked++,invalidateAngular()}},window.IV.services.CursorService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("CursorService",["GeoTransformationService",window.IV.services.CursorService]),IndoorViewerWebApp.factory("DatasetAlignmentService",["ImageService","GeoTransformationService","MapMeshService","POIService","ImagesFactory","MapMeshFactory","POIFactory","DatasetsFactory","DatasetService","ProgressReportService","MessageReportingService","PoseFactory","gettextCatalog",function(e,t,n,a,i,o,r,s,l,c,d,u,g){var p=function(){function p(t){var l=[],c=[],u=[],p=function(){var t=e.images;return angular.forEach(t,function(e){e.dataset_id===b&&l.push(e)}),0===l.length||void i.update(l,function(){return f.itemDone(l.length),e.onUpdate(),!0},function(){return d.showMessage(g.getString("Error while saving"),g.getString("resource: images")),f.setPercentage(100),!1})},v=function(){var e=n.map_meshes;return angular.forEach(e,function(e){e.dataset_id===b&&c.push(e)}),0===c.length||void o.update(c,function(){return f.itemDone(c.length),n.onUpdate(),!0},function(){return d.showMessage(g.getString("Error while saving"),g.getString("resource: meshes")),f.setPercentage(100),!1})},h=function(){return angular.forEach(a.POIsMap,function(e){if(e.dataset_id===b){var t=angular.copy(e);u.push(t)}}),0===u.length||void r.update(u,function(){return f.itemDone(u.length),a.onUpdate(),!0},function(){return d.showMessage(g.getString("Error while saving"),g.getString("resource: POIs")),f.setPercentage(100),!1})},b=t.id,y=t.getGlobalState();t.orientation=y.orientation,t.global_location_=y.pos,s.update(t,function(){f.itemDone(),p(b),v(b),h(b),m(b)},function(){d.showMessage(g.getString("Error while saving"),g.getString("resource: datasets")),f.setPercentage(100)})}function m(e){function t(){f.itemDone()}function n(){d.showMessage(g.getString("Error while saving"),g.getString("resource: poses")),f.setPercentage(100)}f.addItems(1);var a=u.query({dataset_id:e},function(){a.length>0&&(f.addItems(1),u.update(a,t,n)),f.itemDone()},n)}var v=this;this.COLOR_DEFS={red:{use_rgb:!0,rgb_color:new THREE.Color(.84,0,0),rgb_string:"rgb(213,0,0)"},pink:{use_rgb:!0,rgb_color:new THREE.Color(.77,.07,.38),rgb_string:"rgb(197,17,98)"},purple:{use_rgb:!0,rgb_color:new THREE.Color(.67,0,1),rgb_string:"rgb(170,0,255)"},"deep purple":{use_rgb:!0,rgb_color:new THREE.Color(.38,0,.92),rgb_string:"rgb(98,0,234)"},indigo:{use_rgb:!0,rgb_color:new THREE.Color(.19,.31,1),rgb_string:"rgb(48,79,254)"},blue:{use_rgb:!0,rgb_color:new THREE.Color(.16,.38,1),rgb_string:"rgb(41,98,255)"},"light blue":{use_rgb:!0,rgb_color:new THREE.Color(0,.57,.92),rgb_string:"rgb(0,145,234)"},cyan:{use_rgb:!0,rgb_color:new THREE.Color(0,.72,.83),rgb_string:"rgb(0,184,212)"},teal:{use_rgb:!0,rgb_color:new THREE.Color(0,.75,.65),rgb_string:"rgb(0,191,165)"},green:{use_rgb:!0,rgb_color:new THREE.Color(0,.78,.33),rgb_string:"rgb(0,200,83)"},"light green":{use_rgb:!0,rgb_color:new THREE.Color(.39,.87,.09),rgb_string:"rgb(100,221,23)"},lime:{use_rgb:!0,rgb_color:new THREE.Color(.68,.92,0),rgb_string:"rgb(174,234,0)"},yellow:{use_rgb:!0,rgb_color:new THREE.Color(1,.84,0),rgb_string:"rgb(255,214,0)"},amber:{use_rgb:!0,rgb_color:new THREE.Color(1,.67,0),rgb_string:"rgb(255,171,0)"},orange:{use_rgb:!0,rgb_color:new THREE.Color(1,.43,0),rgb_string:"rgb(255,109,0)"},"deep orange":{use_rgb:!0,rgb_color:new THREE.Color(1,.24,0),rgb_string:"rgb(255,61,0)"}},this.dataset_colors={},l.initialized.then(function(){angular.forEach(l.datasetsIdMap,function(e,t){v.dataset_colors[t]=void 0})});var f;this.save=function(){v.updateDatasets(),v.saveAlignment()},this.saveAlignment=function(){f=c.addTask(g.getString("Saving alignment..."),1,!0);var t=l.getWritableDatasetIds();f.addItems(t.length),f.addItems(e.getNrOfImagesInDatasets(t)),f.addItems(a.getNrOfWritablePOIs()),f.addItems(n.getNrOfMapMeshesInDatasets(t)),angular.forEach(l.datasets,function(e){e.security_.can_write&&p(e)}),f.itemDone()},this.updateDatasets=function(){angular.forEach(l.datasetsIdMap,function(e){var t=e.getGlobalState();e.orientation=t.orientation,e.global_location_=t.pos}),t.setOffsetFromGlobal(l.datasets[0].global_location_)},this.translate=function(e,t){v.config.stateDirty=!0;var n=function(t){var n=t.m2w_;n.elements[12]+=e.x,n.elements[13]+=e.y,n.elements[14]+=e.z,t.m2w_inv_=(new THREE.Matrix4).getInverse(t.m2w_);var a=t.getPointCloudObject();a.pointCloudParticleSystemGroup&&(a.pointCloudParticleSystemGroup.matrixWorldNeedsUpdate=!0)};t?n(t):angular.forEach(v.config.selected,function(e){v.config.lock[e.id]||n(e)}),v.onUpdate()},this.cacheCurrentState=function(){v.config.cachedStates={},angular.forEach(v.config.selected,function(e){v.config.lock[e.id]||(v.config.cachedStates[e.id]=e.getState())})},this.undoTranslation=function(){angular.forEach(v.config.cachedStates,function(e,t){v.config.selected[t].setState(v.config.cachedStates[t])}),v.onUpdate(),v.config.cachedStates=void 0},this.rotate=function(e,t){v.config.stateDirty=!0;var n=function(e,t){if(e.m2w_){var n=e.m2w_,a=Math.atan2(n.elements[1],n.elements[0]),i=a+t,o=Math.cos(i),r=Math.sin(i);n.elements[0]=o,n.elements[1]=r,n.elements[4]=-r,n.elements[5]=o,e.m2w_inv_=(new THREE.Matrix4).getInverse(e.m2w_);var s=e.getPointCloudObject();s.pointCloudParticleSystemGroup&&(s.pointCloudParticleSystemGroup.matrixWorldNeedsUpdate=!0)}};if(t)n(t,e);else{var a=new THREE.Matrix4;a.makeRotationZ(e);var i=function(e,t,n){var i=t.m2w_,o=new THREE.Matrix4;o.getInverse(i);var r=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=e.m2w_;r.multiplyMatrices(o,c),s.multiplyMatrices(a,r),l.multiplyMatrices(i,s),e.m2w_.copy(l),e.m2w_inv_=(new THREE.Matrix4).getInverse(e.m2w_);var d=e.getPointCloudObject();d.pointCloudParticleSystemGroup&&(d.pointCloudParticleSystemGroup.matrixWorldNeedsUpdate=!0)};v.config.primary&&!v.config.lock[v.config.primary.id]&&n(v.config.primary,e),angular.forEach(v.config.selected,function(t){t===v.config.primary||v.config.lock[t.id]||i(t,v.config.primary,e)})}v.onUpdate()},this.generateXML=function(e,t,n){var a=function(e,n,a,i,o){s.writeStartElement("dataset"),s.writeElementString("name",e),s.writeElementString("title",escapeXMLTagContent(n)),s.writeElementString("level",a||""),s.writeElementString("pointcloud",t+"datasets_proc/"+e+"/pointcloud.ply"),s.writeElementString("path",t+"datasets_web/"+e),s.writeStartElement("Pose"),s.writeStartElement("position"),s.writeElementString("x",i.x.toString()),s.writeElementString("y",i.y.toString()),s.writeElementString("z",i.z.toString()),s.writeEndElement(),s.writeStartElement("orientation"),s.writeElementString("w",o._w.toString()),s.writeElementString("x",o._x.toString()),s.writeElementString("y",o._y.toString()),s.writeElementString("z",o._z.toString()),s.writeEndElement(),s.writeEndElement(),s.writeEndElement()},i=function(e){if(e){var t=e.getGlobalState();return{lon:t.pos[0],lat:t.pos[1],angle:t.orientation}}return!1},o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},r=e&&n[e.id]&&i(e);if(r){var s=new XMLWriter("UTF-8");return s.formatting="indented",s.indentChar=" ",s.indentation=2,s.writeStartDocument(),s.writeStartElement("bundle"),s.writeElementString("serial",o()),s.writeStartElement("georeference"),s.writeElementString("proj","+proj=tmerc +ellps=WGS84 +lon_0="+r.lon+" +lat_0="+r.lat),s.writeElementString("angle",r.angle.toString()),s.writeElementString("z","0"),s.writeElementString("comment",""),s.writeEndElement(),angular.forEach(n,function(t){var n=new THREE.Matrix4;n.multiplyMatrices(e.m2w_inv_,t.m2w_);var i=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Vector3;n.decompose(i,o,r),a(t.name,t.title,t.level,n.getPosition(),o)}),s.writeEndElement(),s.writeEndDocument(),s.flush()}return null}};return p.prototype=new window.IV.services.ParentAlignmentService,new p}]),function(){"use strict";function e(e,t,n,a,i){function o(){g.loadingDatasets=!0,g.loadingBundles=!0,d.length=0,u.length=0,e.get("api/datasets").then(function(e){d.length=0,Array.prototype.push.apply(d,e.data)})["finally"](function(){g.loadingDatasets=!1}),e.get("api/bundles").then(function(e){u.length=0,Array.prototype.push.apply(u,e.data)})["finally"](function(){g.loadingBundles=!1})}function r(t,a){g.caption=n.getString("Adding dataset"),e.post("api/datasets/"+t.name,a)}function s(t){g.caption=n.getString("Removing dataset"),e["delete"]("api/datasets/"+t.name).then(function(e){e.data.job_id||(o(),i.reinit())})}function l(t){g.caption=n.getString("Adding alignment bundle"),e.post("api/bundles/"+t.serial)}function c(t){g.caption=n.getString("Removing alignment bundle"),e["delete"]("api/bundles/"+t.serial)}var d=[],u=[],g={busy:!1,response:null,loadingDatasets:!1,loadingBundles:!1},p={},m={refresh:o,addDataset:r,removeDataset:s,addBundle:l,removeBundle:c,datasets:d,bundles:u,progress:g,locations:p};return m}e.$inject=["$http","$timeout","gettextCatalog","$q","IV"],angular.module("IVWebApp").factory("DatasetManagementService",e)}(),window.IV.services.DatasetService=function(e,t,n,a){this.datasets=[],this.datasetsIdMap={};var i=n.defer();this.initialized=i.promise;var o=this,r=function(e){if(0==e.length)return e;var n=!1;return angular.forEach(e,function(e){n|=e.visible,o.datasetsIdMap[e.id]=e}),n||(e[0].visible=!0),t.registerUpdateCallback(o.unique_id,function(){angular.forEach(o.datasetsIdMap,function(e){o.makeMatrix(e)})}),e};this.makeMatrix=function(e){var n=new THREE.Matrix4;n.identity().makeRotationZ(e.orientation).setPosition(t.toLocal.apply(this,e.global_location_)),e.m2w_?e.m2w_.copy(n):e.m2w_=n,e.m2w_inv_=(new THREE.Matrix4).getInverse(n),e.local2dataset=function(t){return t.applyMatrix4(e.m2w_inv_),t},e.dataset2local=function(t){return t.applyMatrix4(e.m2w_),t},e.dataset2localdir=function(t){return t.applyMatrix4(e.m2w_),t.x-=e.m2w_.elements[12],t.y-=e.m2w_.elements[13],t.z-=e.m2w_.elements[14],t},e.getState=function(){return e.m2w_.clone()},e.setState=function(t){e.m2w_.copy(t),e.m2w_inv_=(new THREE.Matrix4).getInverse(e.m2w_);var n=e.getPointCloudObject();n.pointCloudParticleSystemGroup&&(n.pointCloudParticleSystemGroup.matrixWorldNeedsUpdate=!0)},e.getGlobalState=function(){var n=e.m2w_;return{pos:t.toGlobal(new THREE.Vector3(n.elements[12],n.elements[13],n.elements[14])),orientation:Math.atan2(n.elements[1],n.elements[0])}},e.getCenter=function(){var t=new THREE.Vector3;return a.get(e.getPotreeConfigFilename()).then(function(n){return t.set((n.data.tightBoundingBox.lx+n.data.tightBoundingBox.ux)/2,(n.data.tightBoundingBox.ly+n.data.tightBoundingBox.uy)/2,(n.data.tightBoundingBox.lz+n.data.tightBoundingBox.uz)/2),(new THREE.Vector3).setFromMatrixPosition(e.m2w_).add(t)},function(){return a.get(e.getOctreeConfigFilename()).then(function(n){return t.set((n.data.bbX[1]+n.data.bbX[0])/2,(n.data.bbY[1]+n.data.bbY[0])/2,(n.data.bbZ[1]+n.data.bbZ[0])/2),(new THREE.Vector3).setFromMatrixPosition(e.m2w_).add(t)})})},e.getCenterGlobal=function(){return e.getCenter().then(function(e){return t.toGlobal(e)})},e.getLocalBoundingBox=function(){var t=new THREE.Box3,n=e.getPointCloudObject();return n.pointCloudObject?t.setFromObject(n.pointCloudObject):n.pointCloudParticleSystemGroup?t.setFromObject(n.pointCloudParticleSystemGroup):t=void 0,t}},this.fetch=function(){function t(){r(o.datasets),i.resolve(),o.onUpdate()}function a(){i.reject()}i=n.defer(),o.initialized=i.promise,this.datasets=e.query({},t,a)},this.activateDataset=function(e,t){for(var n=0;n<this.datasets.length;n++){var a=this.datasets[n].id==e;(a||t)&&(this.datasets[n].visible=a)}o.onUpdate(),invalidateAngular()},this.getWritableDatasetIds=function(){function e(e){return e.security_.can_write===!0}function t(e){return e.id}return o.datasets.filter(e).map(t)}},window.IV.services.DatasetService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("DatasetService",["DatasetsFactory","GeoTransformationService","$q","$http",window.IV.services.DatasetService]),IndoorViewerWebApp.service("FloorChangerService",["ImageService","DatasetService","VectorMapService","IV",function(e,t,n,a){var i=this;this.data={floors:[],current_floor:void 0,floor_above:void 0,floor_below:void 0};var o=!0,r=10;this.getCurrentFloor=function(){return i.data.current_floor},this.setFilterStatus=function(e){o=e,i.updateFloors(i.data.current_floor?i.data.current_floor.image:void 0)},this.getFilterStatus=function(){return o},this.setFilterRadius=function(e){r=e},this.getFilterRadius=function(){return r},this.updateFloors=function(n){if(0==t.datasets.length)return void s();if(!n)return i.data.floors=[],i.data.current_floor=void 0,i.data.floor_above=void 0,void(i.data.floor_below=void 0);var a=o?r:1/0,l={},c=e.cylinderSearch(n.location_,a);if(angular.forEach(c,function(e){var t=l[e.image.dataset_id];(!t||e.distance<t.distance)&&(l[e.image.dataset_id]=e)}),n.hidden){var d=l[n.dataset_id];console.warn("Image is hidden, attempting fallback to closest image from the same dataset:",d),d&&(n=d.image)}var u=[];angular.forEach(l,function(e,a){var o=t.datasetsIdMap[a],r={name:o.level&&o.level.length?o.level:o.title,dataset:t.datasetsIdMap[a],image:e.image,distance:e.distance};u.push(r),n===e.image&&(i.data.current_floor=r)}),u.sort(function(e,t){var n=e.image.floor_location_.z-t.image.floor_location_.z;return 0==n&&e.dataset.level&&t.dataset.level?e.dataset.level.localeCompare(t.dataset.level):n});for(var g=[],p=0,m=0;m<u.length;m++)m>0&&(!u[m].dataset.level||u[m].dataset.level!=u[m-1].dataset.level)&&p++,g[p]||(g[p]=[]),g[p].push(u[m]);for(var v=new THREE.Vector2(n.floor_location_.x,n.floor_location_.y),m=0;m<g.length;m++)g[m].sort(function(e,t){var n=new THREE.Vector2(e.image.floor_location_.x,e.image.floor_location_.y),a=new THREE.Vector2(t.image.floor_location_.x,t.image.floor_location_.y);return v.distanceTo(n)-v.distanceTo(a)});i.data.floors=[];for(var m=0;m<g.length;m++)i.data.floors.push(g[m][0]);for(var f,m=0;m<i.data.floors.length;m++)if(i.data.floors[m]===i.data.current_floor){f=m;break}i.data.floor_below=f>0?i.data.floors[f-1]:void 0,i.data.floor_above=f<i.data.floors.length-1?i.data.floors[f+1]:void 0,invalidateAngular()};var s=function(){if(n.registerUpdateCallback(i.unique_id,function(){s()}),i.data.floors=[],i.data.floor_above=void 0,i.data.floor_below=void 0,n.maps.forEach(function(e){0==e.name.indexOf("_")||i.data.floors.push({name:e.name})}),i.data.floors.sort(function(e,t){return e.name.localeCompare(t.name,void 0,{numeric:!0})}),0!=i.data.floors.length){i.data.current_floor||(i.data.current_floor=i.data.floors[0]);var e=!1;for(var t in i.data.floors){var a=i.data.floors[t];if(a.name===i.data.current_floor.name)e=!0;else{if(e){i.data.floor_above=a;break}e||(i.data.floor_below=a)}}}};this.changeFloor=function(e){var t=i.data.current_floor;i.data.current_floor=e,i.updateFloors(e.image),a.triggerEvent("floorChanged",{previous_floor:t,floor:e,filtered:o})},this.changeFloorByName=function(e){for(var t in i.data.floors)if(i.data.floors[t].name===e)return i.changeFloor(i.data.floors[t]),!0;return!1}}]);var FloorIntersectionService=function(e,t){this.get=function(n){var a=t.defer();return e.get("api/polygon/intersect?id="+n+"&type=building").success(function(e){a.resolve(e.polygons)}),a.promise}};IndoorViewerWebApp.service("FloorIntersectionService",["$http","$q",FloorIntersectionService]);var FloorLevelService=function(e,t,n,a){var i=this,o=1e3;this.floor_levels={},this.initialized=!1,this.scope={floor:null,levels:{}};var r=function(){};this.getActive=function(){return i.scope.floor},this.setActive=function(e){var a=n.defer();return null===e?(i.scope.floor=null,i.onUpdate("active floor"),a.resolve()):t.get(e).then(function(t){i.scope.floor=e,void 0===i.floor_levels[e]&&(i.floor_levels[e]={}),t.map(function(t){void 0===i.floor_levels[e][t.id]&&(i.floor_levels[e][t.id]={building:t.id,floor:e,name:null})}),i.onUpdate("active floor"),a.resolve(e)}),a.promise};var s={};this.saveLater=function(e){var t=e.floor,n=e.building;void 0===s[t]&&(s[t]={}),void 0!==s[t][n]&&a.cancel(s[t][n].promise),s[t][n]={floor_level:e,promise:a(function(){i.save(e),delete s[t][n]},o)}},this.save=function(t){void 0===t.name||null===t.name||0===t.name.length?i["delete"](t):void 0===t.id?e.create(t).$promise.then(function(e){t.id=e.floor_levels[0].id}):e.update(t)},this["delete"]=function(t){e["delete"]({id:t.id}),delete t.id},r()};FloorLevelService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("FloorLevelService",["FloorLevelFactory","FloorIntersectionService","$q","$timeout",FloorLevelService]),angular.module("IVWebApp").service("FlowService",FlowService),IndoorViewerWebApp.factory("GeoRegistrationService",["$http","DatasetsFactory","DatasetService","DatasetAlignmentService","ImageService","POIService","MapMeshService","GeoTransformationService","ProgressReportService",function(e,t,n,a,i,o,r,s,l){var c=function(){var t=this;this.mod_data={locations4326:{},orientations:{}},this.fetchGoogleMapsLibrary=function(e){var n="https://maps.googleapis.com",a="/maps/api/js?v=3&key=AIzaSyAcGZuNkwD3saIjKX_68PR0MGJ7S1NW1R0&callback=GeoRegistrationServiceInitOSM";if(e&&(n="http://www.google.cn"),"undefined"==typeof google||"undefined"==typeof google.maps){var i=document.createElement("script");i.type="text/javascript",i.src=n+a,e?i.onerror=GeoRegistrationServiceInitOSM:i.onerror=GeoRegistrationServiceFirstFail,document.body.appendChild(i)}else t.googleMapsLibraryFetched()},this.translate=function(e){t.config.stateDirty=!0,t.config.deltaTranslation=e},this.rotate=function(e){if(t.config.primary){t.config.stateDirty=!0,angular.forEach(t.config.selected,function(n,a){t.config.lock[a]||(t.mod_data.orientations[a]+=e)});var n=t.config.primary.id,a=i(t.mod_data.locations4326[n]),r=new THREE.Matrix4;r.getInverse(a);var s=new THREE.Matrix4;s.makeRotationZ(e);var l=void 0,c=void 0,d=void 0;angular.forEach(t.config.selected,function(e,u){if(u!==n&&!t.config.lock[u]){l=new THREE.Matrix4,c=new THREE.Matrix4,d=new THREE.Matrix4;var g=new THREE.Matrix4;g=i(t.mod_data.locations4326[u]),l.multiplyMatrices(r,g),c.multiplyMatrices(s,l),d.multiplyMatrices(a,c),t.mod_data.locations4326[u]=o(d)}})}};var i=function(e){var t=new THREE.Matrix4;return t.identity().makeRotationZ(0).setPosition(s.toLocal.apply(this,e))},o=function(e){var t=new THREE.Vector3,n=new THREE.Quaternion,a=new THREE.Vector3;return e.decompose(t,n,a),s.toGlobal(t)};this.updateDatasets=function(){angular.forEach(t.mod_data.locations4326,function(e,a){n.datasetsIdMap[a].global_location_=e,n.datasetsIdMap[a].orientation=t.mod_data.orientations[a]});var e=n.datasets[0].id;s.setOffsetFromGlobal(t.mod_data.locations4326[e])},this.save=function(){this.updateDatasets(),a.saveAlignment()},this.searchAddress=function(t){function n(e){function t(e){e.longitude=e.lon,e.latitude=e.lat}var n=angular.fromJson(e);return angular.forEach(n,t),n}var a={q:t,format:"json"};return e({url:"http://nominatim.openstreetmap.org/search",method:"GET",params:a,transformResponse:n})},this.googleMapsLibraryFetched=function(){t.config.googleMapsFetched=!0,invalidateAngular()}};return c.prototype=new window.IV.services.ParentAlignmentService,new c}]);var GeoRegistrationServiceFirstFail=function(){window.IV.injector.get("GeoRegistrationService").fetchGoogleMapsLibrary(!0)},GeoRegistrationServiceInitOSM=function(){window.IV.injector.get("GeoRegistrationService").googleMapsLibraryFetched()};window.IV.services.GeoTransformationService=function(e){var t=this,n=new OpenLayers.Projection("EPSG:4326"),a=new OpenLayers.Projection("EPSG:900913"),i=0,o=0,r=1,s=e.defer(),l={},c=new WKTParser;this.initialized=s.promise,this.initCoordinatesSystem=function(e,n){if(e.length>0){var a=c.parse(e[0].location).coordinates;t.setOffsetFromGlobal(a[0],a[1])}else{var i=n[0];if(i){var o=i.polygon[0];t.setOffsetFromGlobal(o.lon,o.lat)}else t.setOffsetFromGlobal(0)}},this.toLocal=function(e,t,s){if(0==i&&0==o)throw"GeoTransformationService not initialized";var l=new OpenLayers.LonLat(e,t);l.transform(n,a);var c=l.lon-i,d=l.lat-o;return c/=r,d/=r,new THREE.Vector3(c,d,s)},this.toGlobal=function(e){if(0==i&&0==o)throw"GeoTransformationService not initialized";var t=e.x*r+i,s=e.y*r+o,l=new OpenLayers.LonLat(t,s);return l.transform(a,n),[l.lon,l.lat,e.z]};var d=function(e,t){i=e,o=t,r=1/Math.cos(2*Math.atan(Math.exp(o*Math.PI/20037508.34))-Math.PI/2)};this.setOffsetFromGlobal=function(e,i){var o=new OpenLayers.LonLat(e,i);o.transform(n,a),d(o.lon,o.lat),s.resolve(),t.onUpdate()},this.onUpdate=function(){var e=arguments;angular.forEach(l,function(t){t.apply(this,e)})},this.registerUpdateCallback=function(e,t){l[e]=t},this.getLineGeometryString=function(e,t){var n="";return n="LINESTRING Z ("+e[0].toString()+" "+e[1].toString()+" "+e[2].toString()+" , "+t[0].toString()+" "+t[1].toString()+" "+t[2].toString()+")"},this.getPosGeometryString=function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z")?"POINT Z ("+e.x.toString()+" "+e.y.toString()+" "+e.z.toString()+")":"POINT Z ("+e[0].toString()+" "+e[1].toString()+" "+e[2].toString()+")"},this.getPosGeometryStringFromLocalPos=function(e){var n=t.toGlobal(e);return"POINT Z ("+n[0].toString()+" "+n[1].toString()+" "+n[2].toString()+")"},this.getMeterPerMercator=function(){return r}},IndoorViewerWebApp.service("GeoTransformationService",["$q",window.IV.services.GeoTransformationService]),angular.module("IVWebApp").service("GroupService",GroupService),window.IV.services.ImageService=function(e,t,n,a,i){this.images=[],this.imageById={};var o=i.defer();this.initialized=o.promise;var r=this;this.calculateLocalProperties=function(e,t){var a=n.datasetsIdMap[e.dataset_id];if(null==e.location_||null==e.orientation_||t){var i=new THREE.Matrix4;i.compose(e.dataset_location_,e.dataset_orientation_,new THREE.Vector3(1,1,1));var o=new THREE.Matrix4;o.multiplyMatrices(a.m2w_,i),e.location_=new THREE.Vector3,e.orientation_=new THREE.Quaternion;var r=new THREE.Vector3;o.decompose(e.location_,e.orientation_,r)}(null==e.floor_location_||t)&&(e.floor_location_=e.dataset_floor_location_.clone(),e.floor_location_.applyMatrix4(a.m2w_))};var s=function(e){if(0==e.length)return e;var a=new WKTParser;return angular.forEach(e,function(e){e.dataset_location_=WKT2Vector(a,e.dataset_location),e.dataset_floor_location_=WKT2Vector(a,e.dataset_floor_location),e.location_=WKT2Vector(a,e.location),e.floor_location_=WKT2Vector(a,e.floor_location),e.dataset_orientation_=SQLArray2Quaternion(e.dataset_orientation),e.orientation_=SQLArray2Quaternion(e.orientation);var i=n.datasetsIdMap[e.dataset_id];e.marker_color=i.color,r.imageById[e.id]=e,null==e.location_||null==e.orientation_||null==e.floor_location_?r.calculateLocalProperties(e):(e.location_=t.toLocal(e.location_.x,e.location_.y,e.location_.z),e.geo_registered=!0,e.floor_location_=t.toLocal(e.floor_location_.x,e.floor_location_.y,e.floor_location_.z))}),e};this.fetch=function(){r.images=[],r.imageById={},o=i.defer(),r.initialized=o.promise;var a=function(){n.initialized.then(function(){s(r.images),o.resolve(),r.onUpdate(),t.registerUpdateCallback(r.unique_id,function(){angular.forEach(r.images,function(e){r.calculateLocalProperties(e,!0)}),r.onUpdate()})})};r.images=e.query({},a,o.reject)},this.getFirstImage=function(){for(var e=0;e<r.images.length;e++)if(!r.images[e].hidden)return r.images[e]},this.getFirstImageInDataset=function(e){for(var t=0;t<r.images.length;t++)if(r.images[t].dataset_id==e&&!r.images[t].hidden)return r.images[t]},this.getImageInDataset=function(e,t){for(var n=0;n<r.images.length;n++)if(r.images[n].dataset_id==e&&parseInt(r.images[n].file_id)==t)return r.images[n]},this.getClosestImage=function(e,t,n,a){var i=1/0,o=null;n=n||4;for(var s=a?"location_":"floor_location_",l=0;l<r.images.length;l++){var c=r.images[l][s].distanceTo(t),d=Math.abs(r.images[l][s].z-t.z);c<i&&d<n&&areObjectCoordinatesCompatible(e,r.images[l])&&!r.images[l].hidden&&(i=c,o=r.images[l])}return{image:o,distance:i}},this.getRelatedImages=function(e,t,n){var a=e.location_,i=e.floor_location_;return r.images.filter(function(o){if(!areObjectCoordinatesCompatible(e,o)||o.hidden)return!1;var r=o.location_,s=o.floor_location_,l=Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2),c=Math.abs(s.z-i.z);return l<t&&c<n})},this.getClosestImageInDir=function(e,t,n,a){for(var i=e.location_,o=Math.pow(30,2),s=[],n=n||1,a=a||10,l=t.lon,c=new THREE.Vector3(Math.cos(l)*a*n,Math.sin(l)*a*n,0),d=(new THREE.Vector3).copy(i).add(c),u=0;u<r.images.length;u++){var g=r.images[u].location_,p=d.distanceToSquared(g);p<o&&!r.images[u].hidden&&s.push({image:r.images[u],distSq:p})}return s.sort(function(e,t){return e.distSq-t.distSq}),s.length>0&&s[0].image},this.cylinderSearch=function(e,t){e instanceof THREE.Vector2||(e=new THREE.Vector2(e.x,e.y));var n=[];return angular.forEach(r.images,function(a){var i=e.distanceTo(a.location_);i<t&&!a.hidden&&n.push({image:a,distance:i})}),n},this.getNrOfImagesInDatasets=function(e){var t=0;return angular.forEach(r.images,function(n){e.indexOf(n.dataset_id)>-1&&++t}),t}},window.IV.services.ImageService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("ImageService",["ImagesFactory","GeoTransformationService","DatasetService","CameraHeadService","$q",window.IV.services.ImageService]),angular.module("IVWebApp").service("JobsListService",JobsListService),angular.module("IVWebApp").service("LanguageService",LanguageService),angular.module("IVWebApp").service("LicenseService",["$q","gettext","LicenseFactory",LicenseService]),window.IV.services.MapMeshService=function(e,t,n){this.map_meshes=[],this.redraw_map_images=!1;var a=this;this.calculateLocalProperties=function(e,t){var a=n.datasetsIdMap[e.dataset_id];if(null==e.location_||null==e.orientation_||t){var i=new THREE.Matrix4;i.compose(e.dataset_location_,e.dataset_orientation_,new THREE.Vector3(1,1,1));var o=new THREE.Matrix4;o.multiplyMatrices(a.m2w_,i);var r=new THREE.Vector3;o.decompose(e.location_,e.orientation_,r)}};var i=function(e){if(0==e.length)return e;var a=new WKTParser;return angular.forEach(e,function(e){e.dataset_location_=o(a,e.dataset_location),e.location_=o(a,e.location),e.dataset_orientation_=r(e.dataset_orientation),e.orientation_=r(e.orientation);var i=n.datasetsIdMap[e.dataset_id];if(null==e.location_||null==e.orientation_){var s=new THREE.Matrix4;s.compose(e.dataset_location_,e.dataset_orientation_,new THREE.Vector3(1,1,1));var l=new THREE.Matrix4;l.multiplyMatrices(i.m2w_,s),e.location_=new THREE.Vector3,e.orientation_=new THREE.Quaternion;var c=new THREE.Vector3;l.decompose(e.location_,e.orientation_,c),
e.geo_registered=!1}else e.location_=t.toLocal(e.location_.x,e.location_.y,e.location_.z),e.geo_registered=!0}),e},o=function(e,t){var n=e.parse(t);return n?new THREE.Vector3(n.coordinates[0],n.coordinates[1],n.coordinates[2]):null},r=function(e){if(!e)return null;var t=angular.fromJson(e.replace("{","[").replace("}","]"));return t?new THREE.Quaternion(t[1],t[2],t[3],t[0]):null};this.fetch=function(){this.map_meshes=[];var o=function(){n.initialized.then(function(){i(a.map_meshes),a.onUpdate(),t.registerUpdateCallback(a.unique_id,function(){angular.forEach(a.map_meshes,function(e){a.calculateLocalProperties(e,!0)}),a.redraw_map_images=!0,a.onUpdate()})})};this.map_meshes=e.query({},o)},this.getNrOfMapMeshesInDatasets=function(e){var t=0;return angular.forEach(a.map_meshes,function(n){e.indexOf(n.dataset_id)>-1&&++t}),t}},window.IV.services.MapMeshService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("MapMeshService",["MapMeshFactory","GeoTransformationService","DatasetService",window.IV.services.MapMeshService]),window.IV.services.MapScaleService=function(){var e,t=this;this.scale_sizes=[1,5,10,50,100,500,1e3,5e3,1e4,5e4,1e5,5e5,1e6,5e6],this.min_scale_width=30,this.setViewport=function(t){e=t};var n=function(){if(e){for(var n=(e.getCamera().right-e.getCamera().left)/e.getWidth(),a=1,i=t.scale_sizes[0],o=i/n;o<t.min_scale_width&&a<t.scale_sizes.length;)i=t.scale_sizes[a++],o=i/n;return[i,o]}return[0,0]};this.getScaleUnit=function(){var e=n()[0];return e<1e3?e+" m":e/1e3+" km"},this.getScalePixels=function(){return n()[1]}},IndoorViewerWebApp.service("MapScaleService",[window.IV.services.MapScaleService]);var Measure=function(e,t,n,a,i,o,r){var s=this;Measure.upToDatelineMaterial=new THREE.LineBasicMaterial({color:2386831,transparent:!0,linewidth:5,depthTest:!1,depthWrite:!1,linecap:"round"}),Measure.newLineMaterial=new THREE.LineBasicMaterial({color:3381708,transparent:!0,linewidth:5,depthTest:!1,depthWrite:!1,linecap:"round"}),Measure.cylinderMaterial=new THREE.MeshLambertMaterial({color:11665408,transparent:!0,depthTest:!1,depthWrite:!1}),Measure.textBoxParameters={font_face:"Open Sans",font_size:60,border_width:2,border_color:"rgba(51,153,204,1)",background_color:"rgba(51,153,204,0.6)",padding:8},this.isUpToDate=function(){return f},this.isDeleted=function(){return R},this.setDbMeasure=function(e){v=e,l(void 0!=v?!0:!1)},this.redraw=function(e){this.destruct(),void 0==e&&(I=void 0),g()};var l=function(e){f=e,b=f?Measure.upToDatelineMaterial:Measure.newLineMaterial,b.needsUpdate};this.remove=function(){void 0!=v&&v.$remove(),s.destruct()},this.setNewEnd=function(e){E=p(w,e),l(!1),c(e)};var c=function(e){S=e,g()};this.setNewStart=function(e){E=p(e,S),l(!1),d(e)};var d=function(e){w=e,g()},u=function(e,t){w=e,c(t)};this.updatePosition=function(e){_=e,s.setNewEnd(Measure.parseGlobalToLocal(e))},this.setActive=function(e){M=e,I.dynamic=M};var g=function(){if(w=Measure.parseGlobalToLocal(y),S=Measure.parseGlobalToLocal(_),void 0!=E){var e=E/1e4>.2?E/1e4:.2,t=(Math.round(E*T/10*Math.pow(10,k))/Math.pow(10,k)).toString();k>0&&(t=t.split("."),t=r.getString("{{number}}.{{fraction}}",{number:t[0],fraction:t[1]},"Decimal Mark (Point or Comma)")),t=t+" "+C;var n=S.clone().sub(w);n.multiplyScalar(.5);var a=w.clone().add(n);if(void 0!=I){var i=I.vertices;i[i.length-2]=w,i[i.length-1]=S,I.verticesNeedUpdate=!0,I.boundingSphere=null}else{I=new THREE.Geometry,I.vertices.push(w),I.vertices.push(S),I.dynamic=M;var o=new THREE.Line(I,b);o.renderOrder=2,x=new THREE.Object3D,x.add(o),x.visible=!0}void 0!=O&&x.remove(O),void 0!=P&&x.remove(P),O=makeTextSprite(t,Measure.textBoxParameters),O.material.depthTest=O.material.depthWrite=!1;var l=O.material.map.image.width/O.material.map.image.height,c=.75*(e<1?e:1);O.scale.set(l*c,c,c);var d=new THREE.Vector3(a.x,a.y,a.z+.065);O.position.copy(d),O.renderOrder=2,P=new THREE.Mesh(h(),Measure.cylinderMaterial),P.name="deleteMarker",P.position.copy(a),P.renderOrder=2,P.onClick=function(){return s.remove(),R=!0,!0},x.add(P),x.add(O),scene.add(x)}};this.destruct=function(){void 0!=x&&scene.remove(x)},this.getDbObject=function(){return{start_marker:Measure.GeoTransformationService.getPosGeometryString(y),end_marker:Measure.GeoTransformationService.getPosGeometryString(_),distance:E,group_read:o,group_write:o}};var p=function(e,t){if(void 0!=e&&void 0!=t)return m(e.x,e.y,e.z,t.x,t.y,t.z)},m=function(e,t,n,a,i,o){var r=e-a,s=t-i,l=n-o;return 1e3*Math.sqrt(r*r+s*s+l*l)};Measure.roundRect=function(e,t,n,a,i,o){e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+a-o,n),e.quadraticCurveTo(t+a,n,t+a,n+o),e.lineTo(t+a,n+i-o),e.quadraticCurveTo(t+a,n+i,t+a-o,n+i),e.lineTo(t+o,n+i),e.quadraticCurveTo(t,n+i,t,n+i-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath(),e.fill(),e.stroke()},Measure.parseGlobalToLocal=function(e){return e instanceof THREE.Vector3?Measure.GeoTransformationService.toLocal(e.x,e.y,e.z):void 0!=e?Measure.GeoTransformationService.toLocal(e[0],e[1],e[2]):void 0},this.getStart=function(){return y},this.getEnd=function(){return _},this.setUnit=function(e){C=e.string,T=e.conversion,k=e.decimals};var v,f,h=function(){return new THREE.SphereGeometry(.02,12,12,(void 0),(void 0),0,Math.PI)},b=void 0;s.setDbMeasure(a);var y,_,w,S,E,M=void 0==v,C=i?i.string:"cm",T=i?i.conversion:1,k=i?i.decimals:0,x=void 0,I=void 0,O=void 0,P=void 0,R=!1;void 0==n?(y=e,_=t,s.setNewStart(Measure.parseGlobalToLocal(e)),s.setNewEnd(Measure.parseGlobalToLocal(t))):(y=e,_=t,E=n,u(Measure.parseGlobalToLocal(e),Measure.parseGlobalToLocal(t)))};window.IV.services.MenuService=function(e,t,n,a,i){function o(e){var t=e?g(e):void 0;return!!t&&t.fullscreen}function r(e){return"boolean"==typeof e&&(m=e),m}function s(t){return e.getBoolean(t||this.URLParamName,!0)}function l(){return s(this.URLParamName)&&t.datasets&&t.datasets.length}function c(e){function n(e){return e.security_.can_write}return!!s(e)&&t.datasets.filter(n).length>0}function d(){return s(this.URLParamName)&&isInIframe()}function u(){return n.isAdmin()||s(this.URLParamName)}function g(e){for(var t in p.config.options){var n=p.config.options[t];if(n.template===e)return n}}var p=this;this.isFullscreenMenu=o,this.verticalMenuOpened=r,this.keyboard_exclusive_state=!1,this.config={options:{datasets:{isVisible:l,keyboard_exclusive:!1,icon:"glyphicon glyphicon-align-justify",title:i("Datasets"),template:"templates/menu/DatasetsMenu.html",URLParamName:"menu.datasets.visible"},view:{isVisible:s,keyboard_exclusive:!1,icon:"glyphicon glyphicon-eye-open",title:i("View"),template:"templates/menu/ViewMenu.html",URLParamName:"menu.view.visible"},poi:{isVisible:s,keyboard_exclusive:!0,icon:"glyphicon glyphicon-map-marker",title:i("POIs"),template:"templates/menu/poi/MainPanel.html",URLParamName:"menu.poi.visible"},pointcloud:{isVisible:l,keyboard_exclusive:!1,icon:"glyphicon glyphicon-th",title:i("Point Cloud"),template:"templates/menu/PointCloudMenu.html",URLParamName:"menu.pointcloud.visible"},mode:{isVisible:function(){return!r()&&c("menu.mode.visible")},vertical_menu:!0,keyboard_exclusive:!1,icon:"glyphicon glyphicon-wrench",title:i("Mode"),template:"templates/menu/ModeMenu.html",URLParamName:"menu.mode.visible"},share:{isVisible:l,keyboard_exclusive:!0,icon:"fa fa-share-alt",title:i("Share"),template:"templates/menu/ShareMenu.html",URLParamName:"menu.share.visible"},newwindow:{isVisible:d,icon:"glyphicon glyphicon-fullscreen",title:i("Open in New Window"),onclick:function(){window.open(a.generateShareURL(),"_blank")},URLParamName:"menu.newwindow.visible"},settings:{isVisible:u,fullscreen:!0,keyboard_exclusive:!0,icon:"glyphicon glyphicon-cog",title:i("Settings"),template:"templates/menu/Settings.html",URLParamName:"menu.settings.visible"},login:{isVisible:s,keyboard_exclusive:!0,icon:"glyphicon glyphicon-user",title:i("Login"),template:"templates/menu/LoginMenu.html",URLParamName:"menu.login.visible",getClass:function(){return{"user-logged-in":n.isUserLoggedIn()}}},about:{isVisible:s,keyboard_exclusive:!1,icon:"glyphicon glyphicon-info-sign",title:i("About IndoorViewer"),template:"templates/menu/AboutMenu.html",URLParamName:"menu.about.visible"}},optionOrderInMenu:["datasets","view","poi","pointcloud","mode","share","newwindow","settings","login","about"]};var m=!1},window.IV.services.MenuService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("MenuService",["ConfigService","DatasetService","UserService","URLService","gettext",window.IV.services.MenuService]),window.IV.services.MessageReportingService=function(){var e=this;this.message={title:"",body:"",no_msgs_displayed:0},this.showMessage=function(t,n){e.message.title=t,e.message.body=n,e.message.no_msgs_displayed++,invalidateAngular()}},window.IV.services.MessageReportingService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("MessageReportingService",[window.IV.services.MessageReportingService]),window.IV.services.ModeService=function(e,t,n,a,i,o,r,s,l,c,d){function u(e){b(!0),d.setMainScene("panorama"),d.setSceneRendering("panorama",!0),angular.forEach(a.datasets,function(e){e.PCColorDefinition_&&delete e.PCColorDefinition_,i.deSelect(e)}),e||d.resetView()}function g(){e.config.show_inset_view=!1,d.setSceneRendering("panorama",!1),o.fetchGoogleMapsLibrary(!1)}function p(){h(!1,!0,!1,!1,!1,!1,!1),d.setMainScene("panorama"),d.setSceneRendering("panorama",!0)}function m(){e.config.show_inset_view=!1,d.setMainScene("map"),d.setSceneRendering("panorama",!1)}var v=this;this.modes={normal:{name:"normal",viewports:[{typeOfCamera:"perspective",fieldOfView:100,near:.1,far:100,left:0,bottom:0,width:1,height:1,name:"defaultCamera",upVector:new THREE.Vector3(0,0,1),color:627507,colorCSS:"#009933",caption:c("Perspective camera")}],CSSIconClass:"glyphicon glyphicon-eye-open",HTMLButtonTranslation:c("IndoorViewer")},datasetAlignment:{name:"datasetAlignment",viewports:[{typeOfCamera:"perspective",fieldOfView:100,near:.1,far:100,left:.5,bottom:.5,width:.5,height:.5,name:"defaultCamera",upVector:new THREE.Vector3(0,0,1),color:627507,colorCSS:"#009933",caption:c("Perspective camera")},{typeOfCamera:"orthographic",fieldOfView:11,near:0,far:50,left:0,bottom:.5,width:.5,height:.5,name:"TVCamera",upVector:new THREE.Vector3(0,1,0),cameraTargetPositionConstant:new THREE.Vector3(0,0,(-5)),color:16711680,colorCSS:"#FF0000",caption:c("Top view"),rotation_enabled:!1},{typeOfCamera:"orthographic",fieldOfView:11,near:0,far:2,left:.5,bottom:0,width:.5,height:.5,name:"SVCamera1",upVector:new THREE.Vector3(0,0,1),cameraTargetPositionConstant:new THREE.Vector3((-5),0,0),color:16776960,colorCSS:"#ffff00",caption:c("Side view (E->W)"),rotation_enabled:!0},{typeOfCamera:"orthographic",fieldOfView:11,near:0,far:2,left:0,bottom:0,width:.5,height:.5,name:"SVCamera2",upVector:new THREE.Vector3(0,0,1),cameraTargetPositionConstant:new THREE.Vector3(0,(-5),0),color:52479,colorCSS:"#00CCFF",caption:c("Side view (N->S)"),rotation_enabled:!0}],HTMLUITemplate:"templates/alignment/DatasetAlignmentPanel.html",CSSIconClass:"glyphicon glyphicon-tasks",HTMLButtonTranslation:c("Dataset alignment")},GeoRegistration:{name:"GeoRegistration",HTMLUITemplate:"templates/alignment/GeoRegistrationPanel.html",CSSIconClass:"glyphicon glyphicon-globe",HTMLButtonTranslation:c("Geo-Registration")},Building:{name:"Building",HTMLUITemplate:"templates/BuildingPicker.html",CSSIconClass:"glyphicon glyphicon-home",HTMLButtonTranslation:c("Building")},currentMode:"normal"},this.modesOrdered=[this.modes.GeoRegistration,this.modes.datasetAlignment,this.modes.Building],this.isEnabled=function(e){return"Building"!=e||s.getBoolean("modes.building.enabled",!1)};var f={};this.switchToMode=function(t,n){if(v.modes.currentMode!==t){switch("normal"===v.modes.currentMode&&y(),v.modes.currentMode=t,t){case"normal":u(n);break;case"GeoRegistration":g();break;case"datasetAlignment":p();break;case"Building":m();break;default:throw"Invalid mode: "+v.modes.currentMode}d.setSceneRendering("map",e.mapVisibility()),r.buildingsVisible("Building"===v.modes.currentMode),invalidateAngular()}};var h=function(a,i,o,r,s,l,c){t.setPOITypesVisibility(a),n.config.showPointCloud=i,n.config.maxDist=i?1/0:300,n.onUpdate("showPointCloud",!0),e.config.showPanoramas=o,e.config.show_inset_view=r,e.config.showNavGraph=s,e.config.showLocationMarkers=l,e.config.showMeasurements=c},b=function(a){void 0!==a&&t.setPOITypesVisibility(a),e.config.showPanoramas=f.panoramas,e.config.show_inset_view=f.inset_view,e.config.showNavGraph=f.navgraph,e.config.showLocationMarkers=f.location_markers,e.config.showMeasurements=f.measurements,n.config.showPointCloud=f.pointcloud},y=function(){f.panoramas=e.config.showPanoramas,f.inset_view=e.config.show_inset_view,f.navgraph=e.config.showNavGraph,f.location_markers=e.config.showLocationMarkers,f.measurements=e.config.showMeasurements,f.pointcloud=n.config.showPointCloud};y()},window.IV.services.ModeService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("ModeService",["ViewMenuService","POITypeService","PointCloudMenuService","DatasetService","DatasetAlignmentService","GeoRegistrationService","PolygonDrawingService","ConfigService","gettextCatalog","gettext","IV",window.IV.services.ModeService]),window.IV.services.NavGraphService=function(e,t,n,a,i,o,r,s){var l=this;l.isMovingNodes=!1,this.gettextCatalog=s,this.bundles=[],this.adjacencyList=new AdjacencyList,this.editing=new NavGraphEditing(l.adjacencyList,a,i,o,n,l),this.rendering={THRESH:15,THRESH_Z:2,nav_graph_present:!1},this.config={bundle_current:void 0};var c=null;this.initialized=null,this.clear=function(){c=null,l.initialized=null,l.bundles=[],l.adjacencyList=new AdjacencyList,l.editing.setAdjacencyList(l.adjacencyList)},this.fetch=function(){if(null===c){var e=r.addTask(s.getString("Loading navigation graph..."),2);l.clear(),c=t.defer(),l.initialized=c.promise,n.initialized.then(function(){a.query({},function(t){e.itemDone();var a=new WKTParser;angular.forEach(t,function(e){l.adjacencyList.addNode(e)}),n.registerUpdateCallback(l.unique_id,function(){angular.forEach(l.adjacencyList,function(e){var t=a.parse(e.geometry);if(t){var i=t.coordinates;e.coordinates_local=n.toLocal.apply(this,i)}})}),i.query({},function(t){l.adjacencyList.addEdges(t),o.query({},function(t){l.bundles=t,l.bundles.length>0&&(l.config.bundle_current=l.bundles[0].id),c.resolve(),e.itemDone()})})})})}},this.getBundle=function(e){function t(t){return t.id===e}return l.bundles.filter(t)[0]}},window.IV.services.NavGraphService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("NavGraphService",["$http","$q","GeoTransformationService","NodesFactory","EdgesFactory","BundlesFactory","ProgressReportService","gettextCatalog",window.IV.services.NavGraphService]),window.IV.services.POIService=function(e,t,n,a,i,o,r,s,l,c,d,u,g,p,m){var v=this,f=e.defer();this.initialized=f.promise,this.POIsMap={},this.config={show_search:!0,moving_POI:!1,poi_before_moving:void 0,original_full_screen:void 0,sn_share_URLs:{}},this.selected={poi:null},this.hover={poi:null,x:0,y:0,container:null},this.editing={poi:null},this.edited={},this.routing={start:null,end:null,route:null},this.enable_features={routing:!1,share:!0,view:!0,full_screen:!1,visibilitycheck:!1},this.providers=[s];var h=0,b={};this.movedToPOI={id:void 0,promise:void 0,transitioning:!1},this.clearRouting=function(){v.routing.start=null,v.routing.end=null},this.clearLocationAsPOI=function(){function e(e){return e&&e.location_as_poi_===!0}e(v.routing.start)&&(v.routing.start=null),e(v.routing.end)&&(v.routing.end=null)},this.selectPOI=function(e){v.config.moving_POI||(v.closePOI(),v.open_time=Date.now(),v.selected.poi=e,v.onUpdate(),m.triggerEvent("poiSelected",e))},this.closePOI=function(){v.selected.poi&&m.triggerEvent("poiClosed",v.selected.poi),v.open_time=null,v.selected.poi=null,v.hover.poi=null},this.calculateLocalProperties=function(e,t){var n=l.datasetsIdMap[e.dataset_id];if(n){if(null==e.location_||null==e.orientation_||t){var i=new THREE.Matrix4;i.compose(e.dataset_location_,e.dataset_orientation_,new THREE.Vector3(1,1,1));var o=new THREE.Matrix4;o.multiplyMatrices(n.m2w_,i),e.location_=new THREE.Vector3,e.orientation_=new THREE.Quaternion;var r=new THREE.Vector3;o.decompose(e.location_,e.orientation_,r)}}else e.location_=a.toLocal(e.geometry_.coordinates[0],e.geometry_.coordinates[1],e.geometry_.coordinates[2])},this.recalculateTextEditorSize=function(){var e=angular.element(document.querySelector("#cke_editor1")),t=angular.element(document.querySelector("#cke_1_contents"));e[0]&&t[0]&&n(function(){var n=100,a=angular.element(document.querySelector("#cke_1_top")),i=n+a.outerHeight(!0),o=angular.element(document.querySelector("#poiEditor")),r=40+(o.hasClass("full-window")?0:60),s=angular.element(document.querySelector("#poiEditor .modal-header")).outerHeight(!0),l=angular.element(document.querySelector(".poiModalForm")).outerHeight(!0),c=angular.element(document.querySelector("#upload_panel")).outerHeight(!0),d=angular.element(document.querySelector("#poiEditor .status-messages")).outerHeight(!0),u=angular.element(document.querySelector("#poiEditor .modal-footer")).outerHeight(!0),g=s+l+c+d+u+r,p=window.innerHeight-g;if(parseInt(e[0].style.height.replace("px",""))!==e.height()||""===e[0].style.height||p!==e.height()){var m=Math.max(p,i);t[0].style.height=m-a.outerHeight(!0)-15-2+"px",e[0].style.height=m-2+"px"}})},this.recalculatePOIDetailsBodyMaxHeight=function(){var e=50,t=14;n(function(){var n=angular.element(document.querySelector("#poi-details-panel > .panel-heading"));if(n[0]){for(var a=2*t,i=angular.element(document.querySelectorAll(".left-panel-element")),o=angular.element(document.querySelector("#poi-details-panel > .panel-body")),r=0,s=0;s<i.length;++s)r+=i[s].offsetHeight,i[s].offsetHeight>0&&(r+=t);a+=r;var l=window.innerHeight-a-n[0].offsetHeight;o[0].style["max-height"]=Math.max(l,e)+"px"}},0)},this.search=function(t){for(var n=function(e){for(var t=0;t<e.length;t++)if(v.POIsMap[e[t].id]){var n=v.POIsMap[e[t].id];u.getType(n.poi_type)?e[t]=n:e.splice(t,1)}},a=[],i=0;i<v.providers.length;i++)a[i]=v.providers[i].search(t,n).$promise;return e.all(a).then(function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t})},this.fetchAll=function(){return v.closePOI(),f=e.defer(),v.initialized=f.promise,v.POIsMap={},h=0,b={},a.initialized.then(function(){var t=i.get(),n=s.get();e.all([t.$promise,n.$promise]).then(function(){angular.forEach(t,function(e){void 0!==e.id&&(v.POIsMap[e.id]=e),e.dataset_id||h++,e.icon&&(b[e.icon]=!0),e.reference_marker&&v.calculateLocalProperties(e),e.translations_=y(e.id,n)}),f.resolve(),v.onUpdate(),a.registerUpdateCallback(v.unique_id,function(){angular.forEach(v.POIsMap,function(e){v.calculateLocalProperties(e,!0)}),v.onUpdate()})},f.reject)})};var y=function(e,t){var n=t.filter(function(t){return t.poi_id===e});return s.getTranslationsMap(n)};this.deletePOI=function(e,t,n){var a=e.id;return e.remove(function(){delete v.POIsMap[a],void 0!==t&&t(),v.hover.poi=null,v.selectPOI(null),v.editing.poi=void 0,v.onUpdate()},function(){void 0!==n&&n()})},this.createPOIObject=function(){return i.createPOIObject()},this.fetchById=function(e){return i.get({id:e},function(){},function(){g.showMessage(t.getString("Error while fetching"),"POI: "+e)})},this.cacheCursorPosition=function(){v.share.location_global=angular.copy(d.cursor_pos_global),v.share.location=angular.copy(d.cursor_pos),v.share.orientation=angular.copy(d.cursor_ori),v.share.dataset_id=d.cursor_dataset.id,v.share.dataset_location=angular.copy(d.cursor_pos_dataset),v.share.dataset_orientation=angular.copy(d.cursor_ori_dataset)},this.getPOIsOfType=function(e,t){var n=t||[];return angular.forEach(v.POIsMap,function(t){t.poi_type===e&&n.push(t)}),n},this.getPOIsOfGroup=function(e){var t=[];return u.getTypeGroup(e)&&angular.forEach(u.getTypeGroup(e).group_types_,function(e,n){v.getPOIsOfType(parseInt(n),t)}),t},this.deletePOIsOfType=function(e){var t=[];return angular.forEach(v.POIsMap,function(n){n.poi_type===e&&t.push(v.deletePOI(n))}),t},this.length=function(){return Object.keys(v.POIsMap).length-h},this.getUploadedIcons=function(){return b},this.uploadedCustomIcon=function(e){b[e]=!0},this.getLocationAsPOI=function(e,n){return n&&(e=a.toLocal(e.x,e.y,e.z)),!e&&m.getMainView().getImage()?e=m.getMainView().getImage().floor_location_:e||(e=m.getMainView().getCamera().position.clone().sub(new THREE.Vector3(0,0,1.9))),i.createReadOnlyPOI(e,t.getString("Current location"),"img/poi/unknown.png")},this.getNrOfWritablePOIs=function(){function e(e){return e.security_.can_write}var t=[];return angular.forEach(v.POIsMap,function(e){t.push(e)}),t.filter(e).length},this.initEnableFeatures=function(){c.initialized.then(function(){v.enable_features.editing=c.getBoolean("poi.editing.enabled",v.enable_features.editing),v.enable_features.share=c.getBoolean("poi.share.enabled",v.enable_features.share),v.enable_features.view=c.getBoolean("poi.view.enabled",v.enable_features.view),v.enable_features.full_screen=c.getBoolean("poi.fullscreen",v.enable_features.full_screen),v.enable_features.visibilitycheck=c.getBoolean("poi.visibilitycheck.enabled",v.enable_features.visibilitycheck),p.initialized.then(function(){v.enable_features.routing=p.isFeatureEnabled(p.EFeature.ROUTING)&&c.getBoolean("routing.enabled",v.enable_features.routing)}),invalidateAngular()})},c.registerUpdateCallback("POIService",function(){v.initEnableFeatures(),v.onUpdate()}),v.initEnableFeatures(),v.fetchAll()},window.IV.services.POIService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("POIService",["$q","gettextCatalog","$timeout","GeoTransformationService","POIFactory","POITypesFactory","POIGroupsFactory","POITranslationsFactory","DatasetService","ConfigService","CursorService","POITypeService","MessageReportingService","LicenseService","IV",window.IV.services.POIService]),window.IV.services.POITypeService=function(e,t,n,a,i,o){this.initialized;var r={},s={};this.config={editing:!1};var l=this;this.getPOITypesMap=function(){return r},this.getPOIGroupsMap=function(){return s},this.getType=function(e){return r[e]},this.getTypeGroup=function(e){return s[e]},this.addGroup=function(e,t){s[e.id]?(s[e.id].translations_=e.translations_,s[e.id].getName=e.getName,s[e.id].getTranslation=e.getTranslation,s[e.id].group_read=e.group_read,s[e.id].group_write=e.group_write):(s[e.id]=e,s[e.id].group_types_={},s[e.id].security_=e.security_||{can_write:!0}),t&&(s[e.id].translations_=c("group",e.id,t))},this.addType=function(e,t){e.type_selected_=!0,t&&(e.translations_=c("type",e.id,t)),r[e.id]?(delete s[r[e.id].group_id].group_types_[e.id],s[e.group_id].group_types_[e.id]={id:e.id,translations_:e.translations_,getName:e.getName,getTranslation:e.getTranslation}):s[e.group_id].group_types_[e.id]={id:e.id,translations_:e.translations_,getName:e.getName,getTranslation:e.getTranslation},r[e.id]=e},this.createTypeObject=function(){return t.createTypeObject()},this.createGroupObject=function(){return n.createGroupObject()};var c=function(e,t,n){var r=translationsHelper(o),s=n.filter(function(n){return t===("group"===e?n.poi_type_group_id:n.poi_type_id)});return angular.forEach(s,function(t){t.save=r.getSaveTranslationFunction("group"===e?i:a)}),r.getTranslationsMap(s)};this.setPOITypesVisibility=function(e,t){angular.forEach(r,function(n){(!t||t.indexOf(n.id)>-1)&&(n.type_selected_=e)}),"boolean"==typeof e&&l.onUpdate()},this.POITypeVisibility=function(e){return!(!e||!r[e])&&r[e].type_selected_},this.visible=function(){for(var e in r)if(r[e].type_selected_)return!0},this.createType=function(e){t.create(e,function(e){l.addType(e)},function(e){console.log(e)})},this.updateType=function(e){t.update(e,function(){l.addType(e)},function(e){console.log(e)})},this.deleteType=function(n,i,o){var s=e.defer(),l=r[n].group_id;return e.all(i).then(function(){a.remove({poi_type_id:n},function(){r[n].$remove?r[n].$remove(function(){d(n,l,s,o)}):t.remove({id:n},function(){d(n,l,s,o)})})},function(e){console.log(e)}),s.promise};var d=function(e,t,n,a){delete r[e],delete s[t].group_types_[e],n.resolve(),a()};this.deleteGroup=function(t,a,o){var r=e.defer();return e.all(a).then(function(){i.remove({poi_type_group_id:t},function(){s[t].$remove?s[t].$remove(function(){u(t,r,o)}):n.remove({id:t},function(){u(t,r,o)})})},function(e){console.log(e)}),r.promise};var u=function(e,t,n){delete s[e],t.resolve(),n()};this.fetchPOIGroupsAndTypes=function(){r={},s={};var o=n.get(),c=t.get(),d=i.get(),u=a.get();return e.all([o.$promise,c.$promise,d.$promise,u.$promise]).then(function(){angular.forEach(o,function(e){l.addGroup(e,d.poi_type_group_translations)}),angular.forEach(c,function(e){l.addType(e,u.poi_type_translations)}),l.onUpdate()})},l.initialized=l.fetchPOIGroupsAndTypes()},window.IV.services.POITypeService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("POITypeService",["$q","POITypesFactory","POIGroupsFactory","POITypeTranslationsFactory","POITypeGroupTranslationsFactory","LanguageService",window.IV.services.POITypeService]),window.IV.services.ParentAlignmentService=function(){var e=this;this.config={selected:{},map_data_present:{},googleMapsFetched:!1,zoomToAllSelected:{},transparent:!1,baseLayer:"false",primary:void 0,lock:{},deltaTranslation:void 0,refresh:void 0,stateDirty:!1,referenceDataset:void 0,path_to_data:"",institution_name:"",modal_task:void 0},this.toggleInSelected=function(t){void 0===e.config.selected[t.id]?e.select(t):e.deSelect(t)},this.deSelect=function(t){if(e.config.selected[t.id]&&(delete e.config.selected[t.id],e.config.lock[t.id]&&delete e.config.lock[t.id],e.config.primary===t)){e.config.primary=void 0;for(var n in e.config.selected){e.config.primary=e.config.selected[n];break}}},this.select=function(t){e.config.selected[t.id]=t,e.config.primary||(e.config.primary=t)},this.setZoomToAllSelected=function(){e.config.zoomToAllSelected=e.config.selected},this.selectAll=function(t,n){var a="GeoRegistration"===n;angular.forEach(t,function(t){(!a||a&&e.config.map_data_present[t.id])&&e.select(t)})},this.selectInverse=function(t){angular.forEach(t,function(t){e.toggleInSelected(t)})},this.unSelectAll=function(){angular.forEach(e.config.selected,function(t){e.deSelect(t)})},this.lockAll=function(){angular.forEach(e.config.selected,function(t){void 0===e.config.lock[t.id]&&(e.config.lock[t.id]=t)})},this.unlockAll=function(){angular.forEach(e.config.lock,function(t){delete e.config.lock[t.id]})},this.setAsPrimary=function(t){e.config.primary=t},this.toggleLock=function(t){void 0===e.config.lock[t.id]?e.config.lock[t.id]=t:delete e.config.lock[t.id]},this.toggleBaseLayer=function(){e.config.baseLayer=!0}},window.IV.services.ParentAlignmentService.prototype=new NotifyingAngularService,window.IV.services.PointCloudMenuService=function(e,t,n,a,i){function o(){return u.config.showPointCloud}function r(e){e?s()["finally"](function(){u.config.showPointCloud=!0}):(u.config.showPointCloud=!1,u.onUpdate("showPointCloud"))}function s(){return l().then(function(){u.config.potreeAvailable=!0,u.config.usePotree=!0,u.potreeAvailabilityChecked=!0,u.onUpdate("usePotree")},function(){u.config.potreeAvailable=!1,u.config.usePotree=!1,u.potreeAvailabilityChecked=!0,u.onUpdate("showPointCloud")})}function l(){return null===f&&(f=c()),f}function c(){return a.initialized.then(function(){var n=a.datasets.map(function(t){return e.get(t.getPotreeConfigFilename()).then(function(e){d(t,e.data)})});return t.all(n).then(function(){u.config.perspectiveMaterial.z[0]=u.config.orthoMaterial.z[0]=u.config.zMin,u.config.perspectiveMaterial.z[1]=u.config.orthoMaterial.z[1]=u.config.zMax})})}function d(e,t){var n=t.tightBoundingBox,a=new THREE.Vector3(n.lx,n.ly,n.lz),i=new THREE.Vector3(n.ux,n.uy,n.uz);a.applyMatrix4(e.m2w_),i.applyMatrix4(e.m2w_),void 0===u.config.zMin?(u.config.zMin=Math.floor(10*a.z)/10,u.config.zMax=Math.ceil(10*i.z)/10):(u.config.zMin=Math.min(Math.floor(10*a.z)/10,u.config.zMin),u.config.zMax=Math.max(Math.ceil(10*i.z)/10,u.config.zMax))}var u=this;this.enablePotreeIfAvailable=s,this.showPointClouds=r,this.potreeAvailabilityChecked=!1,this.isCloudVisible=o;var g={id:"0",name:i("Fixed"),maxSize:10},p={id:"1",name:i("Attenuated"),maxSize:1},m={id:"2",name:i("Adaptive"),maxSize:1},v=isPlatform("iOS")?p:m;this.config={showPointCloud:!1,opacity:.1,brightness:1e3,maxDist:300,maxDepth:6,hueOffset:0,hueScale:-.2,zBuffering:!1,distance_to_depth:[[8,8],[12,7],[25,6],[1/0,5]],same_res:!1,zMin:void 0,zMax:void 0,potreeAvailable:!1,usePotree:!1,pointCountTarget:4,minNodeSize:100,clientSidePicking:!0,perspectiveMaterial:{opacity:.4,brightness:1e3,z:[9.8,15.6],useEDL:!1,EDLRadius:3,EDLStrength:1,pointSize:.7,zBuffering:!1,pointSizeSelectedOption:p,colorStyleSelectedOption:{id:"0",name:i("Full color")},pointShapeSelectedOption:{id:"1",name:i("Circle")},normalsFiltering:!1},orthoMaterial:{opacity:.1,brightness:1e3,z:[9.8,15.6],pointSize:.7,colorStyleSelectedOption:{id:"0",name:i("Full color")},pointShapeSelectedOption:{id:"1",name:i("Circle")},zBuffering:!1,normalsFiltering:!0}},this.mode="normal",this.dropdownMenus={pointSizeOptions:[g,p,m],colorStyleOptions:[{id:"1",name:i("Single color")},{id:"0",name:i("Full color")},{id:"13",name:i("Tinted color")},{id:"3",name:i("Elevation")},{id:"11",name:i("Normals")}],pointShapeOptions:[{id:"0",name:i("Square")},{id:"1",name:i("Circle")}]},this.presets={colored:{name:"colored",caption:i("Colored"),settings:{pointSize:1,opacity:1,useEDL:!1},generalSettings:{},dropdowns:{pointSizeSelectedOption:v,colorStyleSelectedOption:{id:"0",name:i("Full color")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},shaded:{name:"shaded",caption:i("Shaded"),settings:{pointSize:1,useEDL:!0},generalSettings:{},dropdowns:{pointSizeSelectedOption:v,colorStyleSelectedOption:{id:"0",name:i("Full color")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},singleColorHighTransparency:{name:"singleColorHighTransparency",caption:i("Transparent color"),settings:{pointSize:.4,opacity:.25,brightness:1e3,useEDL:!1,zBuffering:!1},generalSettings:{},dropdowns:{pointSizeSelectedOption:v,colorStyleSelectedOption:{id:"1",name:i("Single color")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},tinted:{name:"tinted",caption:i("Tinted"),settings:{pointSize:1,opacity:.3},generalSettings:{},dropdowns:{colorStyleSelectedOption:{id:"13",name:i("Tinted color")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},singleColor:{name:"singleColor",caption:i("Single color"),settings:{pointSize:1,opacity:.3},generalSettings:{},dropdowns:{colorStyleSelectedOption:{id:"1",name:i("Single color")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},elevation:{name:"elevation",caption:i("Elevation"),settings:{pointSize:1,opacity:.3},generalSettings:{},dropdowns:{colorStyleSelectedOption:{id:"3",name:i("Elevation")},pointShapeSelectedOption:{id:"0",name:i("Square")}}},highPerformance:{name:"highPerformance",caption:i("High performance"),settings:{},generalSettings:{maxDist:50,pointCountTarget:1,maxDepth:4,minNodeSize:100},dropdowns:{}},balanced:{name:"balanced",caption:i("Balanced"),settings:{},generalSettings:{maxDist:150,maxDepth:5,pointCountTarget:4,minNodeSize:100},dropdowns:{}},highQuality:{name:"highQuality",caption:i("High quality"),settings:{},generalSettings:{maxDist:300,maxDepth:8,pointCountTarget:8,minNodeSize:100},dropdowns:{}}},this.settingsPanes=[{name:"quality",caption:i("Quality"),presets:[this.presets.highPerformance,this.presets.balanced,this.presets.highQuality],material:{},visibleSettings:{maxDist:!0,maxDepth:!0,clientSidePicking:!0,pointCountTarget:!0,minNodeSize:!0,usePotree:!0},visible:function(){return u.config.showPointCloud},currentPreset:"",collapsed:!0},{name:"perspective",caption:i("Appearance"),presets:[this.presets.colored,this.presets.elevation,this.presets.singleColorHighTransparency],material:this.config.perspectiveMaterial,visibleSettings:{zBuffering:!0,opacity:!0,brightness:!0,
colorStyle:!0,pointSizeMode:!0,pointSize:!0,pointShape:!0,edl:!0},visible:function(){return u.config.showPointCloud},currentPreset:"",collapsed:!0},{name:"ortho",caption:i("Alignment"),presets:[this.presets.tinted,this.presets.singleColor,this.presets.elevation],material:this.config.orthoMaterial,visibleSettings:{opacity:!0,colorStyle:!0,pointSize:!0,pointShape:!0,normalsFiltering:!0},visible:function(){return u.config.showPointCloud&&"datasetAlignment"==u.mode},currentPreset:"",collapsed:!0}],this.applyPreset=function(e,t,n){if(null!=e){n.currentPreset=e;for(var a in u.presets[e].settings)t[a]=u.presets[e].settings[a];for(var a in u.presets[e].dropdowns)t[a]&&(t[a]={},angular.copy(u.presets[e].dropdowns[a],t[a]));for(var a in u.presets[e].generalSettings)this.config[a]=u.presets[e].generalSettings[a];this.onUpdate("all")}},this.settingChangedCallback=function(e,t){this.onUpdate(e,t)},this.advancedSettingChangedCallback=function(e){e.currentPreset="",this.onUpdate("all")},this.applyPreset(isMobileBrowser()?"highPerformance":"balanced",null,this.settingsPanes[0]),this.applyPreset("colored",this.config.perspectiveMaterial,this.settingsPanes[1]),this.applyPreset("singleColor",this.config.orthoMaterial,this.settingsPanes[2]);var f=null;n.initialized.then(function(){u.config.showPointCloud=n.getBoolean("layers.pointcloud.visible",u.config.showPointCloud),u.config.showPointCloud&&s(),u.config.same_res=n.getBoolean("layers.pointcloud.same_res",!1),u.config.same_res&&console.log("Warning: loading all point cloud tiles at same resolution"),invalidateAngular()})},window.IV.services.PointCloudMenuService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("PointCloudMenuService",["$http","$q","ConfigService","DatasetService","gettext",window.IV.services.PointCloudMenuService]),window.IV.services.PointCloudServerService=function(e,t,n,a,i,o){function r(){s.auto_align_data.source.m2w_inv_.getInverse(s.auto_align_data.source.m2w_);var e=s.auto_align_data.source.getPointCloudObject();e.pointCloudParticleSystemGroup&&(e.pointCloudParticleSystemGroup.matrixWorldNeedsUpdate=!0),t.onUpdate()}var s=this;this.auto_align_data={source:void 0,target:void 0,vertical_alignment:!0,fetchedData:void 0,in_progress:!1,applied:!1,userAlignment:void 0},this.fetchAutoAlignment=function(){if(!s.auto_align_data.source||!s.auto_align_data.target)return void i.showMessage(a.getString("Select source dataset"),a.getString("Please select the source dataset from the drop down menu. The reference dataset is automatically selected as the target dataset."));if("NAVVIS"!=s.auto_align_data.source.type||"NAVVIS"!=s.auto_align_data.target.type)return void i.showMessage(a.getString("Automatic alignment"),a.getString("Auto-alignment is not available for imported point clouds."));var e=function(){var e=new THREE.Matrix4;return e.multiplyMatrices(s.auto_align_data.target.m2w_inv_,s.auto_align_data.source.m2w_),e.transpose()},t=a.getString("Automatic alignment"),o=n.addTask(t,1,!1,!0),r={source:s.auto_align_data.source.name,target:s.auto_align_data.target.name,verticalAlignment:+s.auto_align_data.vertical_alignment,userAlignment:Array.prototype.slice.call(e().elements)+""},l=function(e){var t="";return angular.forEach(e,function(e,n){t+="&"+n+"="+e}),t.length>0&&(t=t.substring(1)),t},c=function(e){var t="\n--",n=e.lastIndexOf(t);return JSON.parse(n<0?e:e.substring(n+t.length))};s.auto_align_data.source_backup_m=s.auto_align_data.source.m2w_.clone(),s.auto_align_data.in_progress=!0;var d=new XMLHttpRequest;d.onprogress=function(){var e;if(200===d.status&&d.responseText&&""!==d.responseText){var t;try{t=c(d.responseText)}catch(n){return}t.hasOwnProperty("transform")?(s.auto_align_data.fetchedData=t,s.auto_align_data.applied=!1,s.applyAutoAlignment()):e=a.getString("Malformed server response, please update and restart PointCloudServer.")}else if(200!==d.status&&0!==d.status)try{var o=JSON.parse(d.responseText).error;switch(o){case"PCS_TARGET_NOT_FOUND":e=a.getString("Server cannot find target point cloud.");break;case"PCS_SOURCE_NOT_FOUND":e=a.getString("Server cannot find source point cloud.");break;case"PCS_INVALID_USERALIGNMENT":e=a.getString("Server reports initial alignment is invalid.");break;default:e=a.getString("Server returned error value")+" "+o}}catch(r){e=d.statusText+" ("+d.status+")"}void 0!==e&&i.showMessage(a.getString("Error"),e)},d.onerror=function(){i.showMessage(a.getString("Error"),a.getString("Network error"))},d.onloadend=function(){s.auto_align_data.in_progress=!1,o.itemDone()},d.open("GET","pcs/align?"+l(r),!0),d.send()},this.applyAutoAlignment=function(){var e=new THREE.Matrix4;e.set.apply(e,s.auto_align_data.fetchedData.transform),s.auto_align_data.source.m2w_.multiplyMatrices(s.auto_align_data.target.m2w_,e),s.auto_align_data.applied=!0,r()},this.undoAutoAlignment=function(){s.auto_align_data.source.m2w_.copy(s.auto_align_data.source_backup_m),s.auto_align_data.applied=!1,r()}},IndoorViewerWebApp.service("PointCloudServerService",["$http","DatasetService","ProgressReportService","gettextCatalog","MessageReportingService","TextGenService",window.IV.services.PointCloudServerService]);var PolygonDrawingService=function(e,t,n,a,i,o){var r=this,s=!1,l=1e3;this.polygons=null;var c=null;this.initialized=null;this.data={activePolygon:null},this.fetchPolygons=function(n){if(null!==c)return c.promise;var a=t.defer();if(r.initialized=a.promise,null===r.polygons||n===!0){var s=e.query();c=a;var l=[];s.$promise.then(function(){for(var e=0;e<s.length;e++)l.push(s[e]);r.polygons=l,a.resolve(),c=null,i.initialized.then(function(){o.initCoordinatesSystem(i.datasets,r.polygons)})})}else a.resolve();return r.initialized};var d={};this.saveLater=function(e){var t=e.id;void 0!==t&&(void 0!==d[t]&&n.cancel(d[t].promise),d[t]={building:e,promise:n(function(){r.savePolygon(e),delete d[t]},l)})},this.savePolygon=function(n){var a=t.defer();return void 0===n.id?e.create(n).$promise.then(function(e){a.resolve(e),r.onUpdate("refresh polygons")}):(e.update(n),a.resolve()),a.promise},this.buildingsVisible=function(e){return"boolean"!=typeof e?r.buildings_visible:(r.buildings_visible=e,void r.onUpdate("building visibility"))},this.drawing=function(e){return"boolean"==typeof e||angular.isString(e)?void(s=e):s},this.activePolygon=function(e){return!angular.isObject(e)&&null!==e||r.drawing()!==!1?r.data.activePolygon:(r.data.activePolygon=e,invalidateAngular(),null!==e&&"floor"===e.type?a.setActive(e.id):a.setActive(null),r.onUpdate("active polygon"),void 0)},this.removePolygonsByLayer=function(e){var t=r.polygons.filter(function(t){return t.vector_layer_id!=e});r.polygons.length=0,$.extend(r.polygons,t)},this.fetchPolygons()};PolygonDrawingService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("PolygonDrawingService",["PolygonFactory","$q","$timeout","FloorLevelService","DatasetService","GeoTransformationService",PolygonDrawingService]),window.IV.services.ProgressReportService=function(e){function t(e,t,n,a,i,o){this.task_id=e,this.name=t,this.done_items=0,this.num_items=n,this.percentage=0,this.is_modal=a,this.hide_progress=i,this.compact=o}var n=this,a=0;t.prototype.itemDone=function(e){this.done_items+=void 0===e?1:e,this.percentage=100*this.done_items/this.num_items,this.percentage>=100&&i(this.task_id),invalidateAngular()},t.prototype.items=function(){return this.num_items},t.prototype.doneItems=function(){return this.done_items},t.prototype.addItems=function(e){this.num_items+=e,this.percentage=100*this.done_items/this.num_items,invalidateAngular()},t.prototype.setPercentage=function(e){this.percentage=e,this.percentage>=100&&i(this.task_id),invalidateAngular()},t.prototype.incrementPercentage=function(e){this.percentage+=e,this.percentage>=100&&i(this.task_id),invalidateAngular()},t.prototype.getPercentage=function(){return this.percentage},t.prototype.setName=function(e){this.name=e,invalidateAngular()},t.prototype.getName=function(){return this.name},this.data={tasks:{},is_modal:!1,is_visible:!1},this.addTask=function(e,i,o,r,s){var l=++a,c=new t(l,e,i,o,r===!0,s===!0);return n.data.tasks[l]=c,n.data.is_visible=!0,o&&!n.data.is_modal&&(n.data.is_modal=!0),invalidateAngular(),c};var i=function(t){e(function(){o(t)},1e3)},o=function(e){var t=n.data.tasks[e];if(t){var a=t.is_modal;delete n.data.tasks[e],0===Object.keys(n.data.tasks).length&&(n.data.is_visible=!1),a&&r()}},r=function(){var e=!1,t=Object.keys(n.data.tasks);for(var a in t){var i=t[a];if(n.data.tasks[i].is_modal){e=!0;break}}n.data.is_modal=e};this.tasks=function(){return Object.keys(n.data.tasks).length},this.compactOnly=function(){var e=Object.keys(n.data.tasks);for(var t in e)if(n.data.tasks[e[t]].compact!==!0)return!1;return!0},this.items=function(){return s(null,"num_items")},this.doneItems=function(){return s(null,"done_items")};var s=function(e,t){return e?void 0===n.data.tasks[e]?void 0:n.data.tasks[e][t]:l(t)},l=function(e){var t=0,a=Object.keys(n.data.tasks);for(var i in a){var o=a[i];t+=n.data.tasks[o][e]}return t}},IndoorViewerWebApp.service("ProgressReportService",["$timeout",window.IV.services.ProgressReportService]),window.IV.services.RaycastService=function(e,t,n,a){function i(e,t,n){var a=e.getCamera(),i=new THREE.Ray(a.position,t.sub(a.position));i.direction.normalize();var o=n.getPointCloudObject().pointCloudObject.pick(e.renderer,a,i,{view:e});if(o){var r=n.local2dataset(o.position.clone()),s=o.dataset_normal;return{position:o.position,normal:o.normal,camera_position:e.getCamera().position,dataset:n,dataset_pos:r,dataset_normal:s}}return!1}function o(t,n,a,i,o){var r=a.local2dataset(t.getCamera().position.clone()),s=a.local2dataset(n),l="pcs/pick?dataset="+a.name+"&x1="+r.x+"&y1="+r.y+"&z1="+r.z+"&x2="+s.x+"&y2="+s.y+"&z2="+s.z;e.get(l,{timeout:3e3}).success(function(e){if(e&&e.pos&&3==e.pos.length){var n=new THREE.Vector3(e.pos[0],e.pos[1],e.pos[2]),r=new THREE.Vector3(e.normal[0],e.normal[1],e.normal[2]),s=a.dataset2local(n.clone()),l=a.dataset2localdir(r.clone());return i(s,l,t.getCamera().position,a,n,r),!0}e.error&&console.log("Point picking failed: ",e),o&&o(e)}).error(function(e){return console.log("Point picking request failed: ",e),o&&o(e),!1})}function r(e){return e.getPointCloudObject().pointCloudObject&&e.getPointCloudObject().pointCloudContainer.visible&&e.getPointCloudObject().pointCloudObject.clientSidePicking===!0}function s(e,t){var n,a=Number.POSITIVE_INFINITY;return e.forEach(function(e){e&&t.distanceTo(e.position)<a&&(a=t.distanceTo(e.position),n=e)}),n}this.getCoordinates=function(e,n,l,c){var d=[],u=[],g=null;return!a.isCloudVisible()&&e.getImage()?(d[0]=t.datasetsIdMap[e.getImage().dataset_id],void o(e,n,d[0],l,c)):(t.datasets.forEach(function(t){r(t)&&(u[t.id]=i(e,n,t))}),g=s(u,e.getCamera().position),void(g?l(g.position,g.normal,g.camera_position,g.dataset,g.dataset_pos,g.dataset_normal):c()))}},IndoorViewerWebApp.service("RaycastService",["$http","DatasetService","GeoTransformationService","PointCloudMenuService",window.IV.services.RaycastService]),window.IV.services.RouteService=function(e,t,n,a,i,o,r){var s=this;this.routeData={waypoints:null,instructions:null,interpolated_curve:null,dim_control_point:null},this.render_options={single_floor:!1,highlight_instruction:-1},this.route_processing_parameters={spline_order:4,FLOOR_THRESH_Z:3,maximum_edge_length:3,smoothing_filter_span:10,noise_removal_span:5,curvature_threshold:.2,strict_increase_span_z:25,strict_increase_delta_z:.05},this.provider=n,this.requestRoute=function(e,t){var n=a.addTask(r.getString("Routing..."),1),i=function(e){s.routeData.waypoints=null,s.routeData.floors=null,s.routeData.instructions=null,s.routeData.geometry=null,s.routeData.interpolated_curve=null,s.routeData.message=e};return s.provider.getRoute(e,t,n).$promise.then(function(e){n.itemDone(),s.routeData.waypoints={features:[],type:"FeatureCollection"},s.routeData.floors=[],s.routeData.instructions=[],s.routeData.geometry=[],s.routeData.message=null,s.routeData.interpolated_curve=[],e.segments||i(r.getString("No route found"));for(var t=0;e.segments&&t<e.segments.length;++t){if(!e.segments[t].waypoints){i(r.getString("No route found"));break}var a={};"RouteFactory"==e.segments[t].provider?c(e.segments[t],a,0==t,t==e.segments.length-1):d(e.segments[t],a);for(var o=s.routeData.interpolated_curve.length/a.dim_control_point,l=0;l<a.floors.length;++l)a.floors[l][0]+=o,a.floors[l][1]+=o;for(var u=0;u<a.instructions.length;u++){var g=a.instructions[u].segments;if(g)for(var p=0;p<g.length;p++)g[p].start_index+=o,g[p].end_index+=o}s.routeData.floors=s.routeData.floors.concat(a.floors),s.routeData.waypoints.features=s.routeData.waypoints.features.concat(a.waypoints.features),s.routeData.instructions=s.routeData.instructions.concat(a.instructions),s.routeData.geometry=s.routeData.geometry.concat(a.geometry),s.routeData.interpolated_curve=s.routeData.interpolated_curve.concat(a.interpolated_curve),s.routeData.dim_control_point=a.dim_control_point}s.onUpdate()},function(e){n.itemDone(),i(r.getString("No route found")),s.render_options.highlight_instruction=-1,s.onUpdate()})};var l=function(e,n,a,i,l){for(var c=new window.IV.utils.RouteProcessor(t),d=e.waypoints.features[0].geometry.coordinates[0].length,u=c.getUniqueVerticesLinearArray(e.waypoints,d);u.length/d<5;)u=u.concat(u.slice(-3));var g=c.resizeEdges(u,d,e.waypoints,s.route_processing_parameters.maximum_edge_length),p=g[0],m=g[1],v=new window.IV.utils.BSplineInterpolator(s.route_processing_parameters.spline_order,p,d),f=c.smooth(c.removeNoise(v.curvature,s.route_processing_parameters.noise_removal_span,s.route_processing_parameters.curvature_threshold),s.route_processing_parameters.smoothing_filter_span),h=c.getFloors(v.interpolated_curve,d,s.route_processing_parameters.strict_increase_span_z,s.route_processing_parameters.strict_increase_delta_z);if(a.interpolated_curve=v.interpolated_curve,a.dim_control_point=v.dim_control_point,a.floors=h,n){var b=c.getSegmentsPerFloorPerRoute(v.interpolated_curve,d,f,s.route_processing_parameters.curvature_threshold,h),y=new window.IV.utils.InstructionGenerator(r,o,t),_=y.generateRouteInstructions(v.interpolated_curve,d,v.interpolated_curve_dcontrolpoints,h,b,m,i,l);a.instructions=y.collapseMicroInstructions(_)}},c=function(e,t,n,a){l(e,!0,t,n,a),t.instructions=t.instructions,t.waypoints=e.waypoints,t.floors=t.floors,t.geometry=e.geometry},d=function(e,n){var a=new window.IV.utils.RouteProcessor(t),i=e.waypoints.features[0].geometry.coordinates[0].length,o=a.getUniqueVerticesLinearArray(e.waypoints,i);n.interpolated_curve=o;var r=a.getFloors(n.interpolated_curve,i,s.route_processing_parameters.strict_increase_span_z,s.route_processing_parameters.strict_increase_delta_z);n.dim_control_point=i,n.floors=r,n.instructions=e.instructions,n.waypoints=e.waypoints,n.geometry=e.geometry};this.highlightRouteInstruction=function(e){s.render_options.highlight_instruction=e},this.toggle2DVisualization=function(){s.render_options.single_floor=!s.render_options.single_floor,s.onUpdate()},this.clear=function(){s.routeData.waypoints=null,s.routeData.floors=null,s.routeData.instructions=null,s.routeData.geometry=null,s.routeData.message=null,s.render_options.single_floor=!1,s.render_options.highlight_instruction=-1,s.onUpdate()},this.route=function(){if(o.routing.start&&o.routing.end)o.routing.start.id!==o.routing.end.id?s.requestRoute(o.routing.start,o.routing.end).then(function(){i.triggerEvent("routePlanned",s.routeData)},function(){i.triggerEvent("routePlanned",s.routeData)}):(s.clear(),s.routeData.message=r.getString("You selected the same POI as start and end"),i.triggerEvent("routePlanned",null));else if(o.routing.start||o.routing.end){var e=o.getLocationAsPOI();o.routing.start=o.routing.start||e,o.routing.end=o.routing.end||e}else s.clear(),i.triggerEvent("routePlanned",null)},this.moveToRouteInstruction=function(e){i.triggerEvent("routeInstructionClick",e),s.highlightRouteInstruction(e);var t=s.routeData.instructions[e].coordinates.x,n=s.routeData.instructions[e].coordinates.y,a=s.routeData.instructions[e].coordinates.z,o=s.routeData.instructions[e].bearing;i.moveToGeoLocation(new THREE.Vector3(t,n,a),!1,{lon:o,lat:0})}},window.IV.services.RouteService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("RouteService",["$http","GeoTransformationService","RouteFactory","ProgressReportService","IV","POIService","gettextCatalog",window.IV.services.RouteService]),window.IV.services.SocialService=function(e,t,n,a,i){var o=this;this.uploadScreenshot=function(){var a=e.getScreenShot(),i=dataURItoBlob(a[0]),o=n.defer(),r=o.promise;return t.upload({url:"share/image",method:"POST",withCredential:!0,file:i,fileFormDataName:"image"}).progress(function(){}).success(function(e){o.resolve([e.url,a[1],a[2]])}),r},this.moveToShareURLCommonCode=function(t,n,i,r){var s=function(e){t.location.href=a.generateSNShareURL(n,e)};i&&i.uploaded&&i.POIURL?s(i.POIURL):o.uploadScreenshot().then(function(t){var n=a.getBaseURL(),o=a.getDisplayedBaseURL(),l={image:t[0],width:t[1],height:t[2],fov:e.getMainView().getfov().toFixed(1),iv_base:n};n!=o&&(l.backlink_base=o),angular.extend(l,r);var c=JSON.stringify(l),d=btoa(c).replace("+","-").replace("/","_"),u=a.getBaseURL()+"share/link/"+d;i={uploaded:!0,POIURL:u},s(u)})}},window.IV.services.SocialService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("SocialService",["IV","$upload","$q","URLService","LanguageService",window.IV.services.SocialService]),angular.module("IVWebApp").service("StatusCheckService",StatusCheckService),angular.module("IVWebApp").service("TextGenService",TextGenService),window.IV.services.UIService=function(e,t){var n=this;this.config={};var a=["templates/menu/ShareMenu.html"];this.isTemplate3DCursorDependent=function(e){return a.indexOf(e)>-1},this.hideOpenPanels=function(){n.isTemplate3DCursorDependent(n.config.menu)&&(t.getMainView().getLayer(t.layers.CursorLayer).setVisibility(!0),t.getMainView().invalidateScene()),"templates/blank.html"!==n.config.menu&&(n.config.menu="templates/blank.html")},this.hideVerticalPanel=function(){"templates/blank.html"!==n.config.vertical_menu&&(n.config.vertical_menu="templates/blank.html")},this.isPanelOpen=function(){return void 0!==n.config.menu&&"templates/blank.html"!==n.config.menu},this.recalculateLeftPanelElementsBodyMaxHeight=function(){var t=70,n=20,a=14;e(function(){var e=angular.element(document.querySelectorAll(".left-panel-element-flexible-height:not(.full-window) > .panel-heading")),i=angular.element(document.querySelectorAll(".left-panel-element-flexible-height.full-window > .panel-heading"));if(0!=e.length||0!=i.length){for(var o=n+a,r=angular.element(document.querySelectorAll(".left-panel-element")),s=0;s<r.length;++s)o+=r[s].offsetHeight,r[s].offsetHeight>0&&(o+=a);for(var l=angular.element(document.querySelectorAll(".left-panel-element-flexible-height:not(.full-window) > .panel-body")),s=0;s<l.length;++s){var c=window.innerHeight-o-e[s].offsetHeight;l[s].style["max-height"]=Math.max(c,t)+"px"}for(var d=angular.element(document.querySelectorAll(".left-panel-element-flexible-height.full-window > .panel-body")),s=0;s<d.length;++s){var u=window.innerHeight-i[s].offsetHeight;d[s].style["max-height"]=Math.max(u,t)+"px"}}},0)}},window.IV.services.UIService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("UIService",["$timeout","IV",window.IV.services.UIService]),window.IV.services.URLService=function(e,t,n,a,i,o,r){var s,l=this,c=!1;this.setMainView=function(e){s=e},this.updateURL=function(t,n){if(!u){var a=e.search(),l=o.isCloudVisible();l?(a[r.getAliasByName("layers.pointcloud.visible")]="true",delete a.image,delete a.poi):delete a.pc,t&&t.poi&&!l?(a.poi=t.poi,delete a.image):t&&t.image&&!l?(a.image=t.image,delete a.poi):!s.getImage()||a.poi||l?i.initialized.then(function(){var t=i.toGlobal(s.getCamera().position),n=t[0].toFixed(8),o=t[1].toFixed(8),r=t[2].toFixed(3);isFinite(n)&&isFinite(o)&&(a.lon=n,a.lat=o,a.z=r),delete a.image,delete a.poi,e.search(a)}):(a.image=s.getImage().id,delete a.lon,delete a.lat,delete a.z),a[r.getAliasByName("core.init.lon")]=s.getViewDir().lon.toFixed(2),a[r.getAliasByName("core.init.lat")]=s.getViewDir().lat.toFixed(2),a.fov=s.getfov().toFixed(1),c=!0,n===!0&&e.replace(),e.search(a),invalidateAngular()}u=!1},this.resetURL=function(){c=!0,e.url("/")},this.generateShareURL=function(){if(s.getImage()&&!o.isCloudVisible())return l.generateURL("image",s.getImage().id,r.getAliasByName("core.init.lon"),s.getViewDir().lon.toFixed(2),r.getAliasByName("core.init.lat"),s.getViewDir().lat.toFixed(2),"fov",s.getfov().toFixed(1));var e=i.toGlobal(s.getCamera().position);return l.generateURL(r.getAliasByName("layers.pointcloud.visible"),"true","lon",e[0].toFixed(8),"lat",e[1].toFixed(8),"z",e[2].toFixed(3),r.getAliasByName("core.init.lon"),s.getViewDir().lon.toFixed(2),r.getAliasByName("core.init.lat"),s.getViewDir().lat.toFixed(2),"fov",s.getfov().toFixed(1))},this.generateJS=function(){return"var indoorViewer = new IndoorViewer("+s.getImage().id+", "+s.getViewDir().lon.toFixed(2)+", "+s.getViewDir().lat.toFixed(2)+");"},this.generateURL=function(){var t=e.absUrl(),n=t.replace(e.url(),"");n=n.replace("#",""),arguments.length&&(n+="#/?");for(var a=0;a<arguments.length;a+=2)n+=arguments[a]+"="+arguments[a+1],a!==arguments.length-2&&(n+="&");return n},this.getBaseURL=function(){var t=a.base_url;return t.startsWith("//")&&(t=e.protocol()+":"+t),t},this.getDisplayedBaseURL=function(){var t=e.absUrl(),n=t.replace(e.url(),"");return n.replace("#","")},this.getURLHost=function(){return e.host()};var d=null,u=!1;this.setUserLocationChangeCallback=function(e){d=e},this.preventNextChange=function(){u=!0},t.$on("$locationChangeStart",function(){c===!1&&angular.isFunction(d)&&d(),c=!1}),this.generateSNShareURL=function(e,t){if("facebook"===e)return"https://www.facebook.com/sharer/sharer.php?u="+t;if("google-plus"===e)return"https://plus.google.com/share?url="+t;if("twitter"===e){var a="?url="+encodeURIComponent(t)+"&dnt=true&hashtags=NavVis,IndoorViewer&lang="+n.getDataLanguage();return"https://twitter.com/intent/tweet"+a}return"linkedin"===e?"https://www.linkedin.com/shareArticle?url="+t:"xing"===e?"https://www.xing.com/spi/shares/new?url="+t:"tumblr"===e?"https://www.tumblr.com/share/link?url="+t:"pinterest"===e?"https://pinterest.com/pin/create/button/?url="+t:void 0},o.registerUpdateCallback(l.unique_id,function(e,t){"showPointCloud"==e&&l.updateURL()})},IndoorViewerWebApp.service("URLService",["$location","$rootScope","LanguageService","IV","GeoTransformationService","PointCloudMenuService","ConfigService",window.IV.services.URLService]),angular.module("IVWebApp").service("UserService",UserService),window.IV.services.UserTrackingService=function(e,t,n,a,i){this.enabled=!1;var o=this,r=Date.now(),s=null,l=null;this.trackLocationChange=function(e){null!=e.from&&(c("location","change",e.from.id+";"+i.base_url,Date.now()-r),r=Date.now())},this.trackPoiSelected=function(e){null===l&&e&&e.id&&(l=e.id,s=Date.now())},this.trackPoiClosed=function(e){e&&e.id&&l==e.id&&c("poi","visit",e.id+";"+i.base_url,Date.now()-s),l=null,s=null};var c=function(e,t,a,i){try{o.enabled&&("undefined"!=typeof i?_paq.push(["trackEvent",e,t,a,i]):_paq.push(["trackEvent",e,t,a]))}catch(r){n.log("Exception while trying to track an event. Perhaps the tracking code has not been set?")}};this.trackSearch=function(e,t,n){o.enabled&&Piwik.getAsyncTracker().trackSiteSearch(e,t,n)},a.initialized.then(function(){o.enabled=a.isConfigAvailable("tracking.enabled")&&a.getBoolean("tracking.enabled",o.enabled),o.enabled&&(i.addEventListener("locationChanged",o.trackLocationChange),i.addEventListener("poiSelected",o.trackPoiSelected),i.addEventListener("poiClosed",o.trackPoiClosed))})},IndoorViewerWebApp.service("UserTrackingService",["$q","$http","$log","ConfigService","IV",window.IV.services.UserTrackingService]);var VectorMapService=function(e,t,n,a,i){var o=this;o.maps=null,o.layers=null;var r=null;this.fetchMaps=function(i){if(null!==r)return r.promise;if(r=a.defer(),null===o.maps||i)return o.maps=e.query(),o.layers=t.query(),a.all([o.maps.$promise,o.layers.$promise]).then(function(){var e={};o.maps.forEach(function(t){e[t.id]=t,t.layers_=[]}),o.layers.forEach(function(t){e[t.vector_map_id].layers_.push(t),t.map_=e[t.vector_map_id]}),r.resolve(),r=null,n.fetchPolygons().then(function(){s()}),o.onUpdate("dataLoaded")}),r.promise;var l=r;return r.resolve(),r=null,l.promise},this.updateVisibility=function(e){o.onUpdate("updateVisibility",e),void 0!=e?t.update([e]):o.layers.length>0&&t.update(o.layers)},this.updateZ=function(t){e.update([t]),t.layers_.forEach(function(e){e.z_min=t.z_min,e.z_max=t.z_max}),o.onUpdate("updateVisibility")},this.removeLayers=function(e){var t=e.map(function(e){o.onUpdate("removeVectorLayer",e);var t=e.id;return e.$remove().then(function(){o.layers.splice(o.layers.indexOf(e),1),o.maps.forEach(function(e){e.layers_=e.layers_.filter(function(e){return void 0!==e.id})}),n.removePolygonsByLayer(t)})});return a.all(t).then(function(){s()})},this.removeMaps=function(e){var t=e.map(function(e){return o.removeLayers(e.layers_).then(function(){return e.$remove().then(function(){o.maps.splice(o.maps.indexOf(e),1)})})});return a.all(t)};var s=function(){var e=n.polygons,t={};o.maps.forEach(function(e){t[e.id]=e,e.stats_={polygons:0,vertices:0}});var a={};o.layers.forEach(function(e){a[e.id]=e,e.stats_={polygons:0,vertices:0}}),e.forEach(function(e){var n=a[e.vector_layer_id];if(n){var i=e.polygon.length;e.holes.forEach(function(e){i+=e.length}),n.stats_.polygons++,n.stats_.vertices+=i;var o=t[n.vector_map_id];o&&(o.stats_.polygons++,o.stats_.vertices+=i)}})}};VectorMapService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("VectorMapService",["VectorMapFactory","VectorMapLayerFactory","PolygonDrawingService","$q","$timeout",VectorMapService]),window.IV.services.ViewMenuService=function(e,t,n,a,i){var o=this;this.config={navGraphEnabled:!1,measurementsEnabled:!1,vectorMapEditorEnabled:!1,enableMultiMeasurement:!1,showPanoramas:!0,showNavGraph:!1,showLocationMarkers:!0,show_inset_view:!0,showMeasurements:!1,showVectorMapEditor:!1,main_scene:"panorama",hover_inset_view:!1},e.all([t.initialized,n.initialized]).then(function(){r(),invalidateAngular()});var r=function(){o.config.navGraphEnabled=n.isFeatureEnabled(n.EFeature.ROUTING),o.config.measurementsEnabled=n.isLicenseValid(),o.config.vectorMapEditorEnabled=t.getBoolean("layers.vector_map.visible",o.config.vectorMapEditorEnabled),o.config.showPanoramas=t.getBoolean("layers.panoramas.visible",o.config.showPanoramas),o.config.showLocationMarkers=t.getBoolean("layers.locations.visible",o.config.showLocationMarkers),o.config.show_inset_view=t.getBoolean("layers.map.visible",o.config.show_inset_view),o.config.showMeasurements=!1,o.config.showVectorMapEditor=!1,o.config.showNavGraph=o.config.navGraphEnabled&&t.getBoolean("layers.navgraph.visible",o.config.showNavGraph)};this.mapVisibility=function(){return o.config.show_inset_view||"map"===o.config.main_scene},this.panoramaVisibility=function(){return o.config.show_inset_view||"panorama"===o.config.main_scene}},window.IV.services.ViewMenuService.prototype=new NotifyingAngularService,IndoorViewerWebApp.service("ViewMenuService",["$q","ConfigService","LicenseService","MenuService","POIService",window.IV.services.ViewMenuService]);var AdjacencyList=function(){var e=this,t={},n=-1;this.createLocalId=function(){return n--},this.addNode=function(e){t[e.id]instanceof Object||(t[e.id]={ngResource:e})},this.addEdges=function(t){angular.forEach(t,function(t){e.addEdge(t)})},this.addEdge=function(e){t[e.source]instanceof Object?t[e.source][e.target]={mesh:void 0,ngResource:e}:(t[e.source]={},t[e.source][e.target]={mesh:void 0,ngResource:e}),t[e.target]instanceof Object?t[e.target][e.source]={mesh:void 0,ngResource:e,redundant:!0}:(t[e.target]={},t[e.target][e.source]={mesh:void 0,ngResource:e,redundant:!0})},this.getAdjacencyList=function(){return t},this.addEdgeMesh=function(e){var n=e.userData.source,a=e.userData.target;t[n][a].mesh=e,t[a][n].mesh=e},this.addNodeMesh=function(e){t[e.userData.id].mesh=e},this.updateEdgeVertices=function(e){var n=t[e];angular.forEach(n,function(t){if(void 0!==t.mesh){var a=t.mesh.userData.source==e?0:1;t.mesh.geometry.vertices[a].copy(n.mesh.position),t.mesh.geometry.verticesNeedUpdate=!0}})},this.doesEdgeExist=function(e,n){var a=t[e]?t[e][n]:void 0;return void 0===a?0:1},this.getEdgeMeshes=function(e,n){if(void 0!==n)return t[e][n].mesh;var a=t[e],i=[];return angular.forEach(a,function(e){e.ngResource&&i.push(e.mesh)}),i},this.getEdges=function(e,n){if(void 0!==n)return t[e][n].ngResource;var a=t[e],i=[];return angular.forEach(a,function(e){e.ngResource&&i.push(e.ngResource)}),i},this.getNode=function(e){return t[e]?t[e].ngResource:void 0},this.getNodeMesh=function(e){return t[e]?t[e].mesh:void 0},this.removeEdge=function(e,n){delete t[e][n],delete t[n][e]},this.removeNode=function(e){delete t[e]}},NavGraphEditing=function(e,t,n,a,i,o){function r(){function e(){}a.update(o.bundles).$promise["catch"](e)}var s=this;this.selected_nodes=[],this.nodes_data={},s.edges_data={},this.createNodeFlag=!1,this.newNodePosition=void 0,this.in_betw_edges=4,this.straighten_x_nodes=10,this.selectedElement={type:"",attributesMap:{},selected_key:"",selected_value:""},this.history_manager=new HistoryManager;var l=function(e){for(var t=-1,n=0;n<s.selected_nodes.length;++n)if(s.selected_nodes[n]&&s.selected_nodes[n].mesh.userData.id===e){t=n;break}return t};this.applySelection=function(){angular.forEach(s.selected_nodes,function(t){var n=e.getNodeMesh(t.id||t.mesh.userData.id);n&&(t.mesh=n)}),s.selected_nodes.length&&s.selectNode(s.selected_nodes[0].mesh)},this.toggleNode=function(e){var t=l(e.userData.id);0===t?s.deselectNode(e):s.selectNode(e)},this.deselectNode=function(e){var t=l(e.userData.id);t!==-1&&(s.selected_nodes[t].resetColor(),s.selected_nodes.splice(t,1),s.selected_nodes.length>0&&s.selected_nodes[0].makeCurrentlySelected(),s.selected_nodes.length>1&&s.selected_nodes[1].makeLastSelected())},this.deselectAllNodes=function(){angular.forEach(s.selected_nodes,function(e){e.resetColor()}),s.selected_nodes=[]},this.selectNode=function(e){if(!e)return!1;var t=l(e.userData.id),n=t>-1?s.selected_nodes[t]:new NavGraphNode(e,(void 0));t>-1&&s.selected_nodes.splice(t,1),s.selected_nodes.unshift(n);for(var a=0;a<s.selected_nodes.length;++a)0===a?s.selected_nodes[a].makeCurrentlySelected():1===a?s.selected_nodes[a].makeLastSelected():s.selected_nodes[a].resetColor()},this.moveNode=function(t,a,r){var l=e.getNode(t.userData.id);s.history_manager.checkLastOperation(NodeMoveOperation,t.userData.id)?s.history_manager.updateLastOperation({x:a.x,y:a.y,z:r?a.z:void 0}):s.history_manager.addOperation(new NodeMoveOperation(l,t,a.x,a.y,r?a.z:void 0,o,e,n,i,d))},this.moveNodeInZ=function(t,a){var r=s.selected_nodes[t].mesh,l=e.getNode(r.userData.id),c=a?r.position.z+.1:r.position.z-.1;s.history_manager.checkLastOperation(NodeMoveOperation,r.userData.id)?s.history_manager.updateLastOperation({z:c}):s.history_manager.addOperation(new NodeMoveOperation(l,r,(void 0),(void 0),c,o,e,n,i,d))},this.doesEdgeExist=function(){var t,n,a=s.selected_nodes.length;return a>0&&(t=s.selected_nodes[0].mesh.userData.id),a>1?(n=s.selected_nodes[1].mesh.userData.id,e.doesEdgeExist(t,n)):2},this.initAttributeEditor=function(t,n,a){var i=void 0;switch(t){case"edge":i=s.selected_nodes[n].mesh.userData.id;var o=s.selected_nodes[a].mesh.userData.id;s.selectedElement.type=t,s.selectedElement.attributesMap=g(e.getEdges(i,o).attributesMap_),s.selectedElement.selected_key="",s.selectedElement.selected_value="";break;case"node":i=s.selected_nodes[n].mesh.userData.id,s.selectedElement.type=t,s.selectedElement.source_id=i,s.selectedElement.attributesMap=g(e.getNode(i).attributesMap_),s.selectedElement.selected_key="",
s.selectedElement.selected_value=""}},this.saveAttributes=function(){var t=void 0;switch(s.selectedElement.type){case"edge":var n=1,a=0,i=s.selected_nodes[n].mesh.userData.id;t=s.selected_nodes[a].mesh.userData.id;var r=e.getEdges(t,i);angular.equals(r.attributesMap_,s.selectedElement.attributesMap)||s.history_manager.addOperation(new EdgeEditOperation(r,s.selectedElement.attributesMap,o));break;case"node":t=s.selectedElement.source_id;var l=e.getNode(t);angular.equals(l.attributesMap_,s.selectedElement.attributesMap)||s.history_manager.addOperation(new NodeEditOperation(l,s.selectedElement.attributesMap,o))}},this.clearSelectedElement=function(){s.selectedElement.type="",s.selectedElement.attributesMap={},s.selectedElement.selected_key="",s.selectedElement.selected_value=""},this.createEdge=function(){if(s.selected_nodes.length<2)return!1;var t=u(),a=t[0],r=t[1],l=i.toGlobal(a.position),c=i.toGlobal(r.position),g=a.position.distanceTo(r.position),p=d(g,l,c,a.userData.id,r.userData.id);return s.history_manager.addOperation(new EdgeCreateOperation(p,a,r,n,o,e)),!0},this.deleteNode=function(t){if(t>=s.selected_nodes.length)return!1;var n=s.selected_nodes[t].mesh.userData.id,a=e.getNode(n),i=e.getNodeMesh(n);return s.deselectNode(i),s.history_manager.addOperation(new NodeDeleteOperation(a,i,o,e)),!0},this.saveAndStopEditingNavGraph=function(){s.history_manager.getHistoryOperations().length?s.history_manager.saveAllOperations(function(e){var t="edge"===e.resource_type?s.edges_data:s.nodes_data,n="edge"===e.resource_type?e.resource.id:e.resource.id;t[n]||(t[n]=e.resource)},function(){s.saveAndStopEditingNavGraph()}):c()};var c=function(){var a=[],l=[];angular.forEach(s.edges_data,function(t){var n,o;n=e.getNodeMesh(t.source)?e.getNodeMesh(t.source).position:e.getNode(t.source).coordinates_local,o=e.getNodeMesh(t.target)?e.getNodeMesh(t.target).position:e.getNode(t.target).coordinates_local;var r=i.toGlobal(n),s=i.toGlobal(o),l=n.distanceTo(o),c=d(l,r,s,t.source,t.target,t.attributesMap_,t.id);a.push(c)}),a.length>0&&n.update(a),angular.forEach(s.nodes_data,function(t){var n=e.getNodeMesh(t.id);n&&l.push({geom_vertex:i.getPosGeometryStringFromLocalPos(n.position),id:t.id,attributes:"",attributesMap_:t.attributesMap_})}),l.length>0&&t.update(l),r(),s.nodes_data={},s.edges_data={},s.deselectAllNodes(),o.onUpdate()};this.undo=function(){s.history_manager.undoLastOperation()},this.selectEditingOperationResource=function(t){"node"===t.resource_type?s.selectNode(e.getNodeMesh(t.resource.id)):"edge"===t.resource_type&&(s.selectNode(e.getNodeMesh(t.resource.source)),s.selectNode(e.getNodeMesh(t.resource.target))),o.onUpdate("invalidateScene")},this.deleteEdge=function(){if(s.selected_nodes.length<2)return!1;var t=0,n=1,a=s.selected_nodes[t].mesh.userData.id,i=s.selected_nodes[n].mesh.userData.id,r=e.getEdges(a,i),l=e.getEdgeMeshes(r.source,r.target);return s.history_manager.addOperation(new EdgeDeleteOperation(r,l,s.selected_nodes[t].mesh,s.selected_nodes[n].mesh,o,e)),!0},this.createNode=function(n){s.newNodePosition=n?n:s.newNodePosition,s.history_manager.addOperation(new NodeCreateOperation(s.newNodePosition,o.config.bundle_current,t,i,o,e,s.deselectNode))};var d=function(e,t,n,a,r,s,l){var c={length:e,geometry:i.getLineGeometryString(t,n),source:a,target:r,bundle:o.config.bundle_current,attributes:""};return c.attributesMap_=s||{},l&&(c.id=l),c};this.addMultipleEdges=function(){s.doesEdgeExist()&&s.deleteEdge();var e=u(),t=e[0],n=e[0].position,a=e[1],i=e[1].position;s.selectNode(t);for(var o=1;o<s.in_betw_edges;++o){var r=angular.copy(n);s.createNode(r.lerp(i,o/s.in_betw_edges)),s.createEdge()}s.selectNode(a),s.createEdge()},this.straightenNodes=function(){var e=s.selected_nodes.length-1;if(s.straighten_x_nodes=Math.min(s.straighten_x_nodes,s.selected_nodes.length),!(s.straighten_x_nodes<=1)){for(var t=u(s.straighten_x_nodes-1),n=t[0].position,a=t[1].position,i=1;i<s.straighten_x_nodes-1;++i)s.moveNode(s.selected_nodes[e-i].mesh,a.clone().lerp(n,i/(s.straighten_x_nodes-1)),!0);o.onUpdate("invalidateScene")}};var u=function(e){var t=e?e:1,n=0,a=t,i=s.selected_nodes[n].mesh,o=s.selected_nodes[a].mesh;return[o,i]};this.toggleEdge=function(){return s.doesEdgeExist()?s.deleteEdge():s.createEdge()};var g=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};this.setAdjacencyList=function(t){e=t}},NavGraphNode=function(e,t){var n=new THREE.MeshLambertMaterial({color:49152,transparent:!0}),a=new THREE.MeshLambertMaterial({color:15132415,transparent:!0}),i=new THREE.MeshLambertMaterial({color:8421631,transparent:!0}),o=new THREE.MeshLambertMaterial({color:255,transparent:!0}),r=new THREE.MeshLambertMaterial({color:16711680,transparent:!0});this.mesh=void 0,this.originalPosition=void 0,this.id=void 0;var s=this;this.resetColor=function(){s.mesh.material=n},this.historyColor=function(){s.mesh.material=a},this.select=function(){s.mesh.material=r},this.makeLastSelected=function(){s.mesh.material=i},this.makeCurrentlySelected=function(e,t){0!==arguments.length&&(s.mesh=e,void 0!==t?s.originalPosition=angular.copy(t):s.originalPosition=angular.copy(s.mesh.position)),s.mesh.material=o},this.reset=function(){s.mesh.material=n,s.mesh.position.x=s.originalPosition.x,s.mesh.position.y=s.originalPosition.y},s.makeCurrentlySelected(e,t)},GroupState={NORMAL:"Normal",IN_EDIT:"InEdit",IN_ADDING:"InAdding",ADDED:"Added"},CheckState={CHECKED:"Checked",SEMI_CHECKED:"SemiChecked",UNCHECKED:"Unchecked"},GroupsTree=function(e,t,n){function a(t){var n=e.createGroupsArray(t);angular.forEach(n,i),o(n)}function i(e,t){e.local_id=e.id||ue++,e.state={enabled:!0,hover:!1,expanded:!1,check:CheckState.UNCHECKED,selected:!1,general:GroupState.NORMAL,excluded:void 0!==e.id&&e.id===re.excludeGroupId},t&&void 0!==t.local_id&&(e.parent=t),angular.forEach(e.child_groups,function(t){t.parent=e}),X(e),te(e)}function o(e){function t(e){return e.local_id}var n=e.map(t);ue=Math.max.apply(null,n)+1}function r(e,t){e.state.hover=t}function s(e,t){angular.forEach(e,function(e){r(e,t)})}function l(e){r(e,!1)}function c(e){return e.state.hover}function d(e){p(e)?u(e,!1):u(e,!0)}function u(e,t){R(e)&&(e.state.expanded=t)}function g(e,t){angular.forEach(e,function(e){u(e,t)})}function p(e){return e.state.expanded}function m(e,t){g(K(e,t),!0)}function v(e){b()?f(e,!1):f(e,!0)}function f(e,t){re.selectable&&R(e)&&(e.state.selected=t,se=t?e:void 0,ie())}function h(e,t){angular.forEach(e,function(e){f(e,t)})}function b(e){return e.state.selected}function y(){return se}function _(e,t){E(e)||M(e)?w(e,CheckState.UNCHECKED):w(e,t)}function w(e,t){R(e)&&(e.state.check=t)}function S(e,t){angular.forEach(e,function(e){w(e,t)})}function E(e){return C(e)===CheckState.CHECKED}function M(e){return C(e)===CheckState.SEMI_CHECKED}function C(e){return e.state.check}function T(e){return I(e)===GroupState.IN_ADDING}function k(e){return I(e)===GroupState.ADDED}function x(e){return I(e)===GroupState.IN_EDIT}function I(e){return e.state.general}function O(e,t){e.state.enabled=t}function P(e,t){angular.forEach(e,function(e){O(e,t)})}function R(e){return e.state.enabled}function V(e){return e.state.excluded}function A(e){return re[e]}function L(e,t){function n(e){var t={id:void 0,name:"",child_groups:[],attributes:[],security_:{can_write:!0}};return i(t,e),t}ae(t),u(e,!0);var a=n(e);a.state.general=GroupState.IN_ADDING,e.child_groups.unshift(a)}function D(e,t){var n=B(e,t);Y(n,t);return n.state.general=GroupState.ADDED,n}function N(e,t){for(var n=B(e,t),a=Y(n,t),i=0;i<a.child_groups.length;++i)if(a.child_groups[i].local_id==n.local_id){a.child_groups.splice(i,1);break}}function G(e){e.state.general=GroupState.NORMAL}function U(e,t){ae(t),e.previous_name=e.name,e.state.general=GroupState.IN_EDIT}function F(e){e.state.general=GroupState.ADDED}function H(e,t){var n=B(e,t);x(n)&&(n.name=n.previous_name,n.state.general=GroupState.NORMAL)}function z(e){n=e,a(n)}function j(e,t){return t.filter(function(t){return t.id==e})[0]}function B(e,t){return t.filter(function(t){return t.local_id==e})[0]}function W(e,t){var n=K(e,t);return n.unshift(e),n}function K(e,t){var n=[],a=Y(e,t);return a&&(n=n.concat(W(a,t))),n}function q(e){var t=J(e);return t.unshift(e),t}function J(e){var t=[];return angular.forEach(e.child_groups,function(e){t=t.concat(q(e))}),t}function Y(e,t){function n(t){return!!e.parent&&t.local_id===e.parent.local_id}return t.filter(n)[0]}function X(e){e.attributes_string=ne(e)}function Z(e){return e.map(function(e){return e.id})}function Q(e,t){function n(e){var t=function(e,t){return e-t};return e.sort(t).join(",")}return n(e)===n(t)}function ee(e){return e.filter(function(e){return e!==oe})}function te(e){function t(e){this.setAttribute(e,!this.isAttributeEnabled(e))}function n(e,t){t&&!this.isAttributeEnabled(e)?this.attributes.push(e):!t&&this.isAttributeEnabled(e)&&this.attributes.splice(this.attributes.indexOf(e),1)}function a(e){return this.attributes.indexOf(e)>-1}e.toggleAttribute=t,e.setAttribute=n,e.isAttributeEnabled=a}function ne(e){function t(e){return le[e]}var n=e.attributes?e.attributes.map(t):[];return 0===n.length?de:n.length==Object.keys(le).length?ce:n.join(", ")}function ae(e){angular.forEach(e,function(t){I(t)===GroupState.IN_ADDING&&N(t.local_id,e),x(t)&&H(t.local_id,e)})}function ie(){$(".group-attributes.open > button").trigger("click")}this.initGroup=i,this.hoverGroup=r,this.hoverGroups=s,this.mouseLeaveGroup=l,this.isGroupHovered=c,this.toggleGroupExpanded=d,this.expandGroup=u,this.expandGroups=g,this.isGroupExpanded=p,this.revealGroup=m,this.toggleGroupSelection=v,this.selectGroup=f,this.selectGroups=h,this.isGroupSelected=b,this.getSelectedGroup=y,this.toggleGroupChecked=_,this.checkGroup=w,this.checkGroups=S,this.isGroupChecked=E,this.isGroupSemiChecked=M,this.getGroupCheckState=C,this.isGroupInAddingState=T,this.isGroupInAddedState=k,this.isGroupInEditState=x,this.getGroupState=I,this.enableGroup=O,this.enableGroups=P,this.isGroupEnabled=R,this.isGroupExcluded=V,this.getConfig=A,this.addGroupInAddingState=L,this.acceptAddingGroup=D,this.cancelAddingGroup=N,this.goToGroupNormalState=G,this.goToGroupEditState=U,this.goToGroupAddedState=F,this.cancelUpdatingGroupName=H,this.updateGroupAttributesString=X,this.setGroups=z,this.getGroupById=j,this.getGroupByLocalId=B,this.getGroupWithAncestors=W,this.getGroupAncestors=K,this.getGroupWithDescendants=q,this.getGroupDescendants=J,this.getParentGroup=Y,this.getGroupsIds=Z,this.sameGroupsIds=Q,this.discardPublicGroup=ee;var oe=e.getPublicGroupId(),n=n||[],t=t||{},re={showChecks:t.showChecks||!1,showBadges:t.showBadges||!1,selectable:t.selectable||!1,showAttributes:t.showAttributes||!1,excludeGroupId:isFinite(t.excludeGroupId)?t.excludeGroupId:void 0,groupCheckByWritePermission:t.groupCheckByWritePermission||!1},se=void 0,le=t.attributeNames||{},ce=t.allAttributesText||"",de=t.noAttributesText||"",ue=0;a(n)},EdgeCreateOperation=function(e,t,n,a,i,o){var r=this;this.resource_type="edge",this.resource=e,this.wait_for_response=!0;var s=function(){r.resource.id=o.createLocalId(),o.addEdge(r.resource),i.onUpdate("createEdge",t,n)};s();var l=function(){var e=angular.copy(r.resource);return e.id=void 0,e.attributesMap_=void 0,e.source=t.userData.id,e.target=n.userData.id,e};this.save=function(e){return o.doesEdgeExist(r.resource.source,r.resource.target)?(t=o.getNodeMesh(t.userData.id),n=o.getNodeMesh(n.userData.id),a.create(l(),function(a){var i=o.getEdgeMeshes(r.resource.source,r.resource.target);i.userData.id=a.id,i.userData.source=t.userData.id,i.userData.target=n.userData.id,o.removeEdge(r.resource.source,r.resource.target),o.addEdge(a),o.addEdgeMesh(i),r.resource.id=a.id,r.resource.source=t.userData.id,r.resource.target=n.userData.id,e&&e()})):(r.wait_for_response=!1,!0)},this.undo=function(){var e=o.getEdgeMeshes(t.userData.id,n.userData.id);o.removeEdge(t.userData.id,n.userData.id),i.onUpdate("removeEdge",e)},this.getDescription=function(){return i.gettextCatalog.getString("Edge created")}};EdgeCreateOperation.prototype=Object.create(EditingOperation.prototype);var EdgeDeleteOperation=function(e,t,n,a,i,o){var r=this;this.resource_type="edge",this.resource=e;var s=function(){o.removeEdge(t.userData.source,t.userData.target),i.onUpdate("removeEdge",t)};s(),this.save=function(){return!(r.resource.id>=0)||r.resource.$remove()},this.undo=function(){o.addEdge(r.resource),i.onUpdate("createEdge",n,a)},this.getDescription=function(){return i.gettextCatalog.getString("Edge deleted")}};EdgeDeleteOperation.prototype=Object.create(EditingOperation.prototype);var EdgeEditOperation=function(e,t,n){var a=this;this.resource_type="edge",this.resource=e;var i=a.resource.attributesMap_,o=function(){a.resource.attributesMap_=t};o(),this.save=function(){},this.undo=function(){a.resource.attributesMap_=i},this.getDescription=function(){return n.gettextCatalog.getString("Edge edited")}};EdgeEditOperation.prototype=Object.create(EditingOperation.prototype);var HistoryManager=function(){var e=this,t=[];this.saveAllOperations=function(n,a){for(;t.length;){var i=t.shift(),o=i.save(function(){e.saveAllOperations(n,a)});if(i.wait_for_response===!0)return;void 0===o&&n&&n(i)}a&&a()},this.undoLastOperation=function(){t.length>0&&t.pop().undo()},this.getHistoryOperations=function(){return t},this.addOperation=function(e){t.push(e)},this.updateLastOperation=function(e){t[t.length-1].update(e)},this.checkLastOperation=function(e,n){return t[t.length-1]instanceof e&&t[t.length-1].resource.id===n}},NodeCreateOperation=function(e,t,n,a,i,o,r){var s=this;this.resource_type="node",this.wait_for_response=!0;var l=function(){var n=(new WKTParser).parse(a.getPosGeometryStringFromLocalPos(e)).coordinates;s.resource={id:o.createLocalId(),bundle:t,position:e,coordinates_local:a.toLocal.apply(this,n),attributesMap_:{}},o.addNode(s.resource),i.onUpdate("createNode",s.resource)};l();var c=function(){return{geometry:a.getPosGeometryStringFromLocalPos(s.resource.position),bundle:t}};this.save=function(e){return void 0===o.getNodeMesh(s.resource.id)?(s.wait_for_response=!1,!0):n.create(c(),function(t){var n=o.getNodeMesh(s.resource.id);n.userData.id=t.id,o.removeNode(s.resource),o.addNode(t),o.addNodeMesh(n),s.resource.id=t.id,e&&e()})},this.undo=function(){var e=o.getNodeMesh(s.resource.id);o.removeNode(s.resource.id),i.onUpdate("removeNode",e),r&&r(e)},this.getDescription=function(){return i.gettextCatalog.getString("Node created")}};NodeCreateOperation.prototype=Object.create(EditingOperation.prototype);var NodeDeleteOperation=function(e,t,n,a){var i=this;this.resource_type="node",this.resource=e;var o={},r=function(e){a.removeEdge(e.userData.source,e.userData.target),n.onUpdate("removeEdge",e)},s=function(e){a.removeNode(e.userData.id),n.onUpdate("removeNode",e)},l=function(){var e=a.getEdges(t.userData.id);angular.forEach(e,function(e){o[e.id]={source_mesh:a.getNodeMesh(e.source),target_mesh:a.getNodeMesh(e.target),object:e},r(a.getEdgeMeshes(e.source,e.target))}),s(t)};l(),this.save=function(){if(i.resource.id<0)return!0;var e=0;return Object.keys(o).length>0?angular.forEach(o,function(t){return t.object.$delete?void t.object.$delete({id:t.object.id},function(){++e===Object.keys(o).length&&i.resource.$remove()}):void(++e===Object.keys(o).length&&i.resource.$remove())}):i.resource.$remove(),!0},this.undo=function(){a.addNode(i.resource),n.onUpdate("createNode",i.resource),angular.forEach(o,function(e){a.addEdge(e.object),n.onUpdate("createEdge",e.source_mesh,e.target_mesh)}),o={}},this.getDescription=function(){return n.gettextCatalog.getString("Node deleted")}};NodeDeleteOperation.prototype=Object.create(EditingOperation.prototype);var NodeEditOperation=function(e,t,n){var a=this;this.resource_type="node",this.resource=e;var i=a.resource.attributesMap_,o=function(){a.resource.attributesMap_=t};o(),this.save=function(){},this.undo=function(){a.resource.attributesMap_=i},this.getDescription=function(){return n.gettextCatalog.getString("Node edited")}};NodeEditOperation.prototype=Object.create(EditingOperation.prototype);var NodeMoveOperation=function(e,t,n,a,i,o,r,s,l,c){var d=this;this.resource_type="node",this.resource=e;var u=t.position.clone();this.update=function(e){void 0!==e.x&&(t.position.x=e.x),void 0!==e.y&&(t.position.y=e.y),void 0!==e.z&&(t.position.z=e.z),r.updateEdgeVertices(t.userData.id),o.onUpdate()};var g=function(){d.update({x:n,y:a,z:i})};g(),this.save=function(){function e(e){var t=r.getNodeMesh(e.source),n=r.getNodeMesh(e.target),a=l.toGlobal(t.position),i=l.toGlobal(n.position),o=t.position.distanceTo(n.position);return c(o,a,i,t.userData.id,n.userData.id,e.attributesMap_,e.id)}var n=r.getEdges(t.userData.id),a=n.map(e);a.length>0&&s.update(a)},this.undo=function(){d.update({x:u.x,y:u.y,z:u.z})},this.getDescription=function(){return o.gettextCatalog.getString("Node moved")}};NodeMoveOperation.prototype=Object.create(EditingOperation.prototype),window.IV.utils.BSplineInterpolator=function(e,t,n){for(var a=function(e,t,n,a){for(var s=e-1,l=i(t[s],t[t.length-1-s],10*(n.length/a)),c=o("eq",l,t),d=r(l,t),u=Array.prototype.slice.call(new Float32Array(a*l.length)),g=0;g<l.length;g++){var p=l[g],m=c[g],v=d[g],f=Array.prototype.slice.call(new Float32Array(a*(s+1)*(s+1))),h=Array.prototype.slice.call(new Float32Array((s+1)*(s+1))),b=s-m;if(b>0){for(var y=v-s;y<v-m+1;y++){var _=y*a;f[_+0]=n[_+0],f[_+1]=n[_+1],f[_+2]=n[_+2]}for(var w=0;w<b;w++)for(var S=v,E=S-s+w;E<S-m;E++)h[(E+1)*(s+1)+w+1]=(p-t[E+1])/(t[E+s-w+1]-t[E+1]),f[(w+1)*(a*(s+1))+(E+1)*a+0]=f[w*(a*(s+1))+E*a+0]*(1-h[(E+1)*(s+1)+w+1])+f[w*(a*(s+1))+(E+1)*a+0]*h[(E+1)*(s+1)+w+1],f[(w+1)*(a*(s+1))+(E+1)*a+1]=f[w*(a*(s+1))+E*a+1]*(1-h[(E+1)*(s+1)+w+1])+f[w*(a*(s+1))+(E+1)*a+1]*h[(E+1)*(s+1)+w+1],f[(w+1)*(a*(s+1))+(E+1)*a+2]=f[w*(a*(s+1))+E*a+2]*(1-h[(E+1)*(s+1)+w+1])+f[w*(a*(s+1))+(E+1)*a+2]*h[(E+1)*(s+1)+w+1];u[g*a+0]=f[(s-m)*(a*(s+1))+(v-m)*a+0],u[g*a+1]=f[(s-m)*(a*(s+1))+(v-m)*a+1],u[g*a+2]=f[(s-m)*(a*(s+1))+(v-m)*a+2]}else if(v==t.length-1){var M=n.length/a;u[g*a+0]=n[(M-1)*a+0],u[g*a+1]=n[(M-1)*a+1],u[g*a+2]=n[(M-1)*a+2]}else u[g*a+0]=n[(v-s)*a+0],u[g*a+1]=n[(v-s)*a+1],u[g*a+2]=n[(v-s)*a+2]}return u},i=function(e,t,n){if("undefined"==typeof n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var a,i=Array(n);for(n--,a=n;a>=0;a--)i[a]=(a*t+(n-a)*e)/n;return i},o=function(e,t,n){switch(e){case"eq":for(var a=Array.prototype.slice.call(new Float32Array(t.length)),i=0;i<t.length;i++)for(var o=0;o<n.length;o++)n[o]==t[i]&&a[i]++;return a}},r=function(e,t){for(var n=Array.prototype.slice.call(new Float32Array(e.length)),a=0,i=-1,o=0;o<e.length;o++){var r=Math.floor(e[o]);if(i==r)n[o]=a-1;else{i=r;for(var s=a;s<t.length&&r==t[s];)a+=1,s++;n[o]=a-1}}return n},s=function(e,t,n,a,i){for(var o=e-1,r=n.length/a-1,s=t,l=Array.prototype.slice.call(new Float32Array(a*r)),c=0;c<r;c++)l[c*a+0]=o/(t[c+i+o+1]-t[c+1])*(n[(c+1)*a+0]-n[c*a+0]),l[c*a+1]=o/(t[c+i+o+1]-t[c+1])*(n[(c+1)*a+1]-n[c*a+1]),l[c*a+2]=o/(t[c+i+o+1]-t[c+1])*(n[(c+1)*a+2]-n[c*a+2]);if(i+1==1)l=[l[0*a+0],l[0*a+1],l[0*a+2]].concat(l);else{var d=l.length/a;l=l.concat([l[(d-1)*a+0],l[(d-1)*a+1],l[(d-1)*a+2]])}return[s,l]},l=function(e,t,n){for(var a=t.length/e,i=new Array(a),o=0;o<a;o++){var r=o*e,s=new THREE.Vector3(t[r+0],t[r+1],t[r+2]),l=new THREE.Vector3(n[r+0],n[r+1],n[r+2]);l.cross(s),i[o]=l.length()/Math.pow(s.lengthSq(),1.5)}return i},c=[],d=i(1,t.length/n-e),u=0,g=d[d.length-1]+1,p=0;p<e;p++)c=c.concat([u]);c=c.concat(d);for(var p=0;p<e;p++)c=c.concat([g]);this.spline_order=e,this.control_points=t,this.dim_control_point=n,this.interpolated_curve=a(e,c,t,n);var m=s(e,c,t,n,0),v=m[0],f=m[1];this.interpolated_curve_dcontrolpoints=a(e,v,f,n);var h=s(e-1,v,f,n,1),b=h[0],y=h[1];this.interpolated_curve_ddcontrolpoints=a(e,b,y,n),this.curvature=l(n,this.interpolated_curve_dcontrolpoints,this.interpolated_curve_ddcontrolpoints)},window.IV.utils.InstructionGenerator=function(e,t,n){this.route_instruction_parameters={minimum_straight_segment_length:3,minimum_turn_segment_length:1};var a={START:"O",FORWARD:"F",TURN:"T",END:"D",STAIRCASE:"ST",DOOR:"DO",ELEVATOR:"EL"},i={IS_DOOR:"is_door",ROOM_ID:"room_id",IS_STAIRCASE:"is_staircase",IS_ELEVATOR:"is_elevator",FLOOR_ID:"floor_id"},o=new THREE.Vector3(0,0,1),r=function(e,t,n,a,i,o,r,s,l,c){e[e.length]={text:t,icon:n,type:a,coordinates:{x:i,y:o,z:r},bearing:s,segment:l?l:{},additionalInstructions:c?c:[]}},s=function(e,t,n,a,i,o){var r=new THREE.Vector3(e,t,n),s=new THREE.Vector3(a,i,o),l=(new THREE.Vector3).subVectors(s,r);return Math.atan2(l.y,l.x)},l=function(t){for(var n=[],o=0;o<t.length;o++){var r=t[o][0],s=r.node.attributes,l=t[o][1],d=l.node.attributes,u="";if(s[i.IS_DOOR]){var g={fromRoom:s[i.ROOM_ID],toRoom:d[i.ROOM_ID]};u=s[i.ROOM_ID]&&d[i.ROOM_ID]&&s[i.ROOM_ID]!=d[i.ROOM_ID]?e.getString("enter from {{fromRoom}} into {{toRoom}}",g,"navigation instruction"):s[i.ROOM_ID]?e.getString("leave {{fromRoom}}",g,"navigation instruction"):d[i.ROOM_ID]?e.getString("enter {{toRoom}}",g,"navigation instruction"):e.getString("cross through door",null,"navigation instruction"),c(n,u,"",a.DOOR,s[i.ROOM_ID],d[i.ROOM_ID])}else if(r.edge.attributes[i.IS_STAIRCASE]){var g={fromFloor:s[i.FLOOR_ID],toFloor:d[i.FLOOR_ID]};u=s[i.FLOOR_ID]&&d[i.FLOOR_ID]?e.getString("use stairs to go from {{fromFloor}} to {{toFloor}}",g,"navigation instruction"):s[i.FLOOR_ID]?e.getString("use stairs to go from {{fromFloor}}",g,"navigation instruction"):d[i.FLOOR_ID]?e.getString("use stairs to go to {{toFloor}}",g,"navigation instruction"):e.getString("use stairs",null,"navigation instruction"),c(n,u,"",a.STAIRCASE,s[i.FLOOR_ID],d[i.FLOOR_ID])}else if(r.edge.attributes[i.IS_ELEVATOR]){var g={fromFloor:s[i.FLOOR_ID],toFloor:d[i.FLOOR_ID]};u=s[i.FLOOR_ID]&&d[i.FLOOR_ID]?e.getString("use elevator to go from {{fromFloor}} to {{toFloor}}",g,"navigation instruction"):s[i.FLOOR_ID]?e.getString("use elevator to go from {{fromFloor}}",g,"navigation instruction"):d[i.FLOOR_ID]?e.getString("use elevator to go to {{toFloor}}",g,"navigation instruction"):e.getString("use elevator",null,"navigation instruction"),c(n,u,"",a.ELEVATOR,s[i.FLOOR_ID],d[i.FLOOR_ID])}}return n},c=function(e,t,n,a,i,o){e[e.length]={text:t,icon:n,type:a,source:i,target:o}},d=function(e,t,n,a){for(var o=[],r=a.start_index+1;r<a.end_index;r++){var s=n[Math.floor((r-1)/10)],l=n[Math.floor(r/10)];l&&s.id!=l.id&&(s.properties.edge.attributes[i.IS_DOOR]||s.properties.edge.attributes[i.IS_STAIRCASE]||s.properties.edge.attributes[i.IS_ELEVATOR])&&(o[o.length]=[s.properties,l.properties])}return o},u=function(t){switch(t){case"slight_left":return e.getString("Turn slightly left",null,"navigation instruction");case"slight_right":return e.getString("Turn slightly right",null,"navigation instruction");case"left":return e.getString("Turn left",null,"navigation instruction");case"right":return e.getString("Turn right",null,"navigation instruction");case"sharp_left":return e.getString("Turn sharp left",null,"navigation instruction");case"sharp_right":return e.getString("Turn sharp right",null,"navigation instruction");default:return console.log("Unknown translation for",t),t}},g=function(e,t){var n="";return t*=180/Math.PI,t<=40?n="slight_"+(e>0?"left":"right"):t>40&&t<120?n=e>0?"left":"right":t>=120&&t<=180&&(n="sharp_"+(e>0?"left":"right")),n},p=function(e,t,n,a,i,o,r,s,l){e[e.length]={text:t,icon:n,type:a,coordinates:{x:i,y:o,z:r},bearing:s,segments:l?l:[]}},m=function(t){var n="",i="",o=e.getString(",",null,"navigation instruction – string used to glue separate instructions together")+" ";if(t.length>0){var r=0;i=" (";for(var s=0;s<t.length;s++){if(t[s].source==t[s].target)r++;else{if(r>0){var l={name:t[s+1-r].target,amount:r};t[s+1-r].target?t[s].type==a.DOOR?i+=e.getString("remain in {{name}} for {{amount}} doors",l,"navigation instruction")+o:t[s].type==a.STAIRCASE?i+=e.getString("leave the stairs at floor {{name}}",l,"navigation instruction")+o:t[s].type==a.ELEVATOR&&(i+=e.getString("leave the elevator at floor {{name}}",l,"navigation instruction")+o):t[s+1-r].type==a.DOOR?i+=e.getString("go through {{amount}} doors",l,"navigation instruction")+o:t[s+1-r].type==a.STAIRCASE?i+=e.getString("{{amount}} floors using stairs",l,"navigation instruction")+o:t[s+1-r].type==a.ELEVATOR&&(i+=e.getString("{{amount}} floors using elevator",l,"navigation instruction")+o),r=0}i+=t[s].text+", "}n+=t[s].type}if(r>0){var l={name:t[t.length-r].target,amount:r};t[t.length-r].target?t[t.length-r].type==a.DOOR?i+=e.getString("remain in {{name}} for {{amount}} doors",l,"navigation instruction")+o:t[t.length-r].type==a.STAIRCASE?i+=e.getString("leave the stairs at floor {{name}}",l,"navigation instruction")+o:t[t.length-r].type==a.ELEVATOR&&(i+=e.getString("leave the elevator at floor {{name}}",l,"navigation instruction")+o):t[t.length-r].type==a.DOOR?i+=e.getString("cross {{amount}} doors",l,"navigation instruction")+o:t[t.length-r].type==a.STAIRCASE?i+=e.getString("{{amount}} floors using stairs",l,"navigation instruction")+o:t[t.length-r].type==a.ELEVATOR&&(i+=e.getString("{{amount}} floors using elevator",l,"navigation instruction")+o),r=0}i=i.substring(0,i.length-2),i+=")"}return[i,n]};this.generateRouteInstructions=function(n,i,c,p,m,v,f,h){for(var b=[],y=0;y<m.length;y++)for(var _=0;_<m[y].length;_++){var w=m[y][_];if(0==_&&0==y&&f&&r(b,e.getString("Start here",null,"navigation instruction"),"start",a.START,n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],s(n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],n[(w.start_index+10)*i+0],n[(w.start_index+10)*i+1],n[(w.start_index+10)*i+2])),"Straight"===w.type&&w.length>=this.route_instruction_parameters.minimum_straight_segment_length)r(b,e.getString("Walk straight {{distance}} meters",{distance:Math.floor(w.length)},"navigation instruction"),"forward",a.FORWARD,n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],s(n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],n[(w.start_index+10)*i+0],n[(w.start_index+10)*i+1],n[(w.start_index+10)*i+2]),w,l(d(n,i,v,w)));else if("Turn"===w.type&&+w.length.toFixed(1)>=this.route_instruction_parameters.minimum_turn_segment_length){var S=new THREE.Vector3(n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2]),E=new THREE.Vector3(n[w.end_index*i+0],n[w.end_index*i+1],n[w.end_index*i+2]),M=new THREE.Vector3(c[w.start_index*i+0],c[w.start_index*i+1],c[w.start_index*i+2]),C=new THREE.Vector3(c[w.end_index*i+0],c[w.end_index*i+1],c[w.end_index*i+2]),T=new THREE.Vector3;T.crossVectors(o,M.normalize()).normalize();var k=new THREE.Matrix3;k.set(T.x,T.y,T.z,M.x,M.y,M.z,o.x,o.y,o.z),S.applyMatrix3(k),E.applyMatrix3(k);var x=E.clone().sub(S),I=M.angleTo(C),O=g(x.x,I),P=u(O);r(b,P,O,a.TURN,n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],s(n[w.start_index*i+0],n[w.start_index*i+1],n[w.start_index*i+2],n[(w.start_index+10)*i+0],n[(w.start_index+10)*i+1],n[(w.start_index+10)*i+2]),w,l(d(n,i,v,w)))}else if("FloorChange"===w.type){var R=l(d(n,i,v,w)),V=void 0;if(null==R||0==R.length){V=p[y][1];var A=p[y][2];A>0?r(b,e.getString("Use Staircase and go to a floor above",null,"navigation instruction"),"stairs_up",a.STAIRCASE,n[V*i+0],n[V*i+1],n[V*i+2],s(n[(V-10)*i+0],n[(V-10)*i+1],n[(V-10)*i+2],n[V*i+0],n[V*i+1],n[V*i+2]),w):A<0&&r(b,e.getString("Use Staircase and go to a floor below",null,"navigation instruction"),"stairs_down",a.STAIRCASE,n[V*i+0],n[V*i+1],n[V*i+2],s(n[(V-10)*i+0],n[(V-10)*i+1],n[(V-10)*i+2],n[V*i+0],n[V*i+1],n[V*i+2]),w)}else{V=p[y][1];var L=p[y][2];L>0?r(b,e.getString("Change the floor and go up",null,"navigation instruction"),R[0].type==a.STAIRCASE?"stairs_up":R[0].type==a.ELEVATOR?"elevator_up":"",R[0].type,n[V*i+0],n[V*i+1],n[V*i+2],s(n[(V-10)*i+0],n[(V-10)*i+1],n[(V-10)*i+2],n[V*i+0],n[V*i+1],n[V*i+2]),w,R):L<0&&r(b,e.getString("Change the floor and go down",null,"navigation instruction"),R[0].type==a.STAIRCASE?"stairs_down":R[0].type==a.ELEVATOR?"elevator_down":"",R[0].type,n[V*i+0],n[V*i+1],n[V*i+2],s(n[(V-10)*i+0],n[(V-10)*i+1],n[(V-10)*i+2],n[V*i+0],n[V*i+1],n[V*i+2]),w,R)}}_+1==m[y].length&&y+1==m.length&&h&&r(b,e.getString("Destination reached",null,"navigation instruction"),"red",a.END,n[w.end_index*i+0],n[w.end_index*i+1],n[w.end_index*i+2],s(n[w.end_index*i+0],n[w.end_index*i+1],n[w.end_index*i+2],t.routing.end.location_.x,t.routing.end.location_.y,t.routing.end.location_.z))}return b};var v=function(e){return e.charAt(0).toLowerCase()+e.slice(1)};this.collapseMicroInstructions=function(t){for(var i=[],o=0;o<t.length;o++){var r=t[o],s=m(r.additionalInstructions),l=t[o+1],c=void 0;if(l&&r.type==a.FORWARD&&l.type==a.TURN){var d=m(l.additionalInstructions);c=n.toGlobal({x:r.coordinates.x,y:r.coordinates.y,z:r.coordinates.z}),p(i,r.text+s[0]+e.getString(", then",null,"navigation instruction – glue word (go straight, then turn left)")+" "+v(l.text)+d[0],l.icon,r.type+s[1]+l.type+d[1],c[0],c[1],c[2],r.bearing,[r.segment,l.segment]),o++}else c=n.toGlobal({x:r.coordinates.x,y:r.coordinates.y,z:r.coordinates.z}),p(i,r.text+s[0],r.icon,r.type+s[1],c[0],c[1],c[2],r.bearing,[r.segment])}return i}},window.IV.utils.RouteProcessor=function(e){var t=function(e,t,n){if("undefined"==typeof n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var a,i=Array(n);for(n--,a=n;a>=0;a--)i[a]=(a*t+(n-a)*e)/n;return i};this.getUniqueVerticesLinearArray=function(t,n){for(var a=Array.apply(null,new Array(n*t.features.length)).map(Number.prototype.valueOf,0),i=0,o=0;t&&o<t.features.length;o++){var r=e.toLocal(t.features[o].geometry.coordinates[0][0],t.features[o].geometry.coordinates[0][1],t.features[o].geometry.coordinates[0][2]);if(i=o*n,a[i+0]=r.x,a[i+1]=r.y,a[i+2]=r.z,o==t.features.length-1){var s=e.toLocal(t.features[o].geometry.coordinates[1][0],t.features[o].geometry.coordinates[1][1],t.features[o].geometry.coordinates[1][2]);i=(o+1)*n,a[i+0]=s.x,a[i+1]=s.y,a[i+2]=s.z}}return a},this.resizeEdges=function(e,n,a,i){var o=e.length/n,r={},s=Array.apply(null,new Array(n)).map(Number.prototype.valueOf,0);s[0]=e[0*n+0],s[1]=e[0*n+1],s[2]=e[0*n+2];for(var l=1;l<o;l++){var c=new THREE.Vector3(e[(l-1)*n+0],e[(l-1)*n+1],e[(l-1)*n+2]),d=new THREE.Vector3(e[l*n+0],e[l*n+1],e[l*n+2]),u=Math.abs(c.distanceTo(d));if(u>i){for(var g=Math.floor(u/i),p=t(0,1,g+2),m=p.length,v=Array.apply(null,new Array(n*m)).map(Number.prototype.valueOf,0),f=0;f<m;f++){var h=c.clone().lerp(d,p[f]);v[f*n+0]=h.getComponent(0),v[f*n+1]=h.getComponent(1),v[f*n+2]=h.getComponent(2),f+1<m&&(r[s.length/n-1+f]=a.features[l-1])}s=s.concat(v.slice(n))}else r[s.length/n-1]=a.features[l-1],s=s.concat([e[l*n+0],e[l*n+1],e[l*n+2]])}return[s,r]},this.removeNoise=function(e,t,n){for(var a=0,i=-1,o=0;o<e.length;o++)if(e[o]>=n)i=i<0?o:i,a++;else{if(a<t&&a>0)for(var r=i;r<o;r++)e[r]=.1;i=-1,a=0}return e},this.smooth=function(e,t){for(var n=Array.apply(null,new Array(e.length)).map(Number.prototype.valueOf,0),a=0;a<e.length;a++){var i=a>=t/2?Math.floor(t/2):a;i=e.length-(a+1)<t/2?e.length-(a+1):i,n[a]=e[a];for(var o=1;o<=i;o++)n[a]+=e[a+o]+e[a-o];n[a]=n[a]/(2*i+1)}return n},this.getFloors=function(e,t,n,a){var i=e.length/t,o=0,r=0,s=[],l=0,c=0,d=0;s[r]=[],s[r][0]=l;for(var u=1;u<i;u++)c=e[u*t+2]-e[(u-1)*t+2],Math.abs(c)>a?(o++,d=c>0?1:-1):o>n?(s[r][1]=u-o,s[r][2]=d,r++,l=u,s[r]=[],s[r][0]=l,o=0,d=0):(o=0,d=0);return s[r][1]=u-1,s[r][2]=o>n?d:0,s},this.getSegmentsPerFloorPerRoute=function(e,t,n,a,i){for(var o=[],r=-1,s=-1,l=!1,c=!1,d=0,u=0,g=0,p=0,m=new THREE.Vector3(0,0,0),v=new THREE.Vector3(0,0,0),f=0;f<i.length;f++){o[f]=[],r=i[f][0],s=i[f][1],l=!1,c=!1,d=0,u=0,g=0,p=0;for(var h=r;h<s-1;h++)m.set(e[h*t+0],e[h*t+1],e[h*t+2]),v.set(e[(h+1)*t+0],e[(h+1)*t+1],e[(h+1)*t+2]),p+=Math.abs(v.distanceTo(m)),+n[h].toFixed(1)>=a?l?h+1==s-1&&(l=!1,g=h+1,o[f][o[f].length]={start_index:u,end_index:g,length:p,type:"Turn"},u=0,g=0,p=0):(l=!0,u=h,c&&(c=!1,o[f][o[f].length]={start_index:d,end_index:h,length:p,type:"Straight"},p=0)):(d=c?d:h,c=!0,l?(l=!1,g=h,d=h,o[f][o[f].length]={
start_index:u,end_index:g,length:p,type:"Turn"},u=0,g=0,p=0):h+1==s-1&&(c=!1,o[f][o[f].length]={start_index:d,end_index:h+1,length:p,type:"Straight"},p=0));if(f+1<i.length){for(p=0,h=s;h<i[f+1][0];h++)m.set(e[h*t+0],e[h*t+1],e[h*t+2]),v.set(e[(h+1)*t+0],e[(h+1)*t+1],e[(h+1)*t+2]),p+=Math.abs(v.distanceTo(m));o[f][o[f].length]={start_index:s,end_index:i[f+1][0],length:p,type:"FloorChange"}}}return o}},ParentAlignmentController.$inject=["$scope","$rootScope","$interval","dataService","DatasetAlignmentService","DatasetService","ModeService","$timeout","gettextCatalog"],IndoorViewerWebApp.controller("BodyController",["$scope","$timeout","ViewMenuService","ModeService","POIService","UserService","URLService","IV","ConfigService","GeoTransformationService","FloorChangerService","LicenseService","PointCloudMenuService",function(e,t,n,a,i,o,r,s,l,c,d,u,g){function p(){e.user_auth_config=o.getUserAuthConfig()}function m(){e.user_auth_config_state=e.AdminPanelConfigState.SUCCESS}function v(){e.user_auth_config_state=e.AdminPanelConfigState.ERROR}function f(){e.license_config_state=e.AdminPanelConfigState.SUCCESS,u.fetch()}function h(){e.license_config_state=e.AdminPanelConfigState.ERROR}e.visible=n.config,e.modes=a.modes,e.hover=i.hover,e.ConfigService=l,e.LicenseService=u,e.UserService=o,e.AdminPanelConfigState={PROVIDE_CONFIG:"PROVIDE_CONFIG",IN_PROGRESS:"IN_PROGRESS",SUCCESS:"SUCCESS",ERROR:"ERROR"},e.user_auth_config_state=e.AdminPanelConfigState.PROVIDE_CONFIG,e.license_config_state=e.AdminPanelConfigState.PROVIDE_CONFIG;var b=isMobileBrowser()?1.75:1.5,y=200;e.zoomMapView=function(e){s.getMapView().zoomView(void 0,e?-b:b,!1,y)},e.swapScenes=function(){var n=$("#mainScene"),a=$("#insetScene"),i=n.parent(),o=a.parent();return n.prependTo(o),a.prependTo(i),t(function(){s.getMainView().forceResize(),s.getMapView().forceResize()}),e.visible.main_scene="panorama"===e.visible.main_scene?"map":"panorama","panorama"===e.visible.main_scene?(d.setFilterStatus(!0),s.moveToLocation(s.getMainView().getImage())):d.setFilterStatus(!1),!0},e.setMainScene=function(t){return"panorama"!==t&&"map"!==t?(console.log("Such a scene doesn't exist."),!1):e.visible.main_scene!==t&&e.swapScenes()},e.setStartupView=function(){if(s.getMainView().getImage()&&!g.isCloudVisible())l.saveConfig("core.init.image",s.getMainView().getImage().id),l.saveConfig("core.init.location.lon",null),l.saveConfig("core.init.location.lat",null),l.saveConfig("core.init.location.z",null);else{var e=c.toGlobal(s.getMainView().getCamera().position);l.saveConfig("core.init.location.lon",e[0]),l.saveConfig("core.init.location.lat",e[1]),l.saveConfig("core.init.location.z",e[2]),l.saveConfig("core.init.image",null)}l.saveConfig("core.init.lon",s.getMainView().getViewDir().lon),l.saveConfig("core.init.lat",s.getMainView().getViewDir().lat);var t=s.getMapView().getCamera(),n=c.toGlobal(t.position),a=Math.min(Math.abs(t.right-t.left),Math.abs(t.top-t.bottom));l.saveConfig("core.init.map.lon",n[0]),l.saveConfig("core.init.map.lat",n[1]),l.saveConfig("core.init.map.fov",a),d.getCurrentFloor()&&l.saveConfig("core.init.map.floor",d.getCurrentFloor().name)},e.resetStartupView=function(){l.saveConfig("core.init.image",null),l.saveConfig("core.init.location.lon",null),l.saveConfig("core.init.location.lat",null),l.saveConfig("core.init.location.z",null),l.saveConfig("core.init.lon",null),l.saveConfig("core.init.lat",null),l.saveConfig("core.init.map.lon",null),l.saveConfig("core.init.map.lat",null),l.saveConfig("core.init.map.fov",null),l.saveConfig("core.init.map.floor",null)},e.initAdminPanel=function(){u.fetch(),p()},e.saveUserAuthConfig=function(){e.user_auth_config_state=e.AdminPanelConfigState.IN_PROGRESS,o.saveUserAuthConfig(e.user_auth_config).then(m,v)},e.disableUserAuthProvider=function(){e.user_auth_config["auth.local.provider.url"]="",e.user_auth_config["auth.iv.host.url"]="",e.user_auth_config["auth.local.key"]="",e.user_auth_config["auth.local.secret"]="",e.saveUserAuthConfig()},e.isAuthProviderConfigCorrect=function(){var t=!0;return angular.forEach(e.user_auth_config,function(e){e||(t=!1)}),t},e.copyIndoorViewerHostURLToConfig=function(){e.user_auth_config&&(e.user_auth_config["auth.iv.host.url"]=r.getBaseURL())},e.copyProviderURLToConfig=function(){var t="https",n="9443";e.user_auth_config&&(e.user_auth_config["auth.local.provider.url"]=t+"://"+r.getURLHost()+":"+n)},e.isUserAuthFeatureEnabled=function(){return u.isFeatureEnabled(u.EFeature.USER_MANAGEMENT)},e.saveLicense=function(t){e.license_config_state=e.AdminPanelConfigState.IN_PROGRESS,u.saveLicenseData(t).then(f,h)},e.reinitIV=function(){s.reinit()}}]),IndoorViewerWebApp.controller("BuildingPickerController",["$scope","PolygonDrawingService","FloorLevelService",function(e,t,n){e.drawing=t.drawing,e.data=t.data,e.polygon={enableDrawing:function(e){t.activePolygon(null),t.drawing(e)},"delete":function(){t.activePolygon()["delete"](),t.activePolygon(null)},onChange:function(e,n){t.activePolygon()&&e!==n&&t.saveLater(t.activePolygon())},names:{},polygons:null,select:function(e){t.activePolygon(e)}},e.getPolygonsByType=function(e){return t.polygons.filter(function(t){return t.type===e})},e.floor=n.scope,e.floor.onChange=function(t){n.saveLater(n.floor_levels[e.floor.floor][t])},n.registerUpdateCallback("BuildingPickerController",function(t){if("active floor"===t){var a=n.getActive();null===a?(e.floor.levels={},e.floor.num_levels=0):(e.floor.levels=n.floor_levels[a],e.floor.num_levels=Object.keys(e.floor.levels).length)}}),e.building={},t.fetchPolygons().then(function(){e.polygon.polygons=t.polygons,e.polygon.polygons.forEach(function(t){e.polygon.names[t.id]=t.name})})}]),IndoorViewerWebApp.controller("CreditsController",["$scope","CreditsService","ConfigService","LicenseService",function(e,t,n,a){e.current_year=(new Date).getFullYear(),e.config=t.config,e.version=t.version,e.LicenseService=a,e.fetchLicensesFile=function(e){t.fetchLicensesFile(e)},e.getPrivacyPolicy=function(){return n.getString("info.terms.privacy")},e.havePrivacyPolicy=function(){return void 0!==n.getString("info.terms.privacy")},e.getExtraCredits=function(){return n.getString("info.terms.extra",void 0)}}]);var DatasetAlignmentController=function(e,t,n,a,i,o,r,s,l,c){function d(){c.enablePotreeIfAvailable()}function u(e,t){t.getCenter().then(function(e){r.focusViewportsOnthisPosition(e)})}o.invoke(ParentAlignmentController,this,{$scope:e,$rootScope:t,$interval:n,dataService:a,DatasetAlignmentService:a,DatasetService:i}),e.auto_align_data=s.auto_align_data,e.config=a.config,e.alignmentHelpers=r.alignmentHelpers,e.config.AH={none_selected:!0,all_selected:!0},d(),e.$on("alignment.zoomToDataset",u),e.$watch("alignmentHelpers",function(t,n){e.config.AH={none_selected:!0,all_selected:!0},angular.forEach(e.alignmentHelpers,function(t){t.visibility&&(e.config.AH.none_selected=!1),t.visibility||(e.config.AH.all_selected=!1)}),r.onUpdate()},!0),e.floor=l.activePolygon(),e.fetchAutoAlignment=function(){s.fetchAutoAlignment()},e.applyAutoAlignment=function(){s.applyAutoAlignment()},e.undoAutoAlignment=function(){s.undoAutoAlignment()},e.getAutoAlignmentDatasets=function(){function e(e){return e.id!==t.primary.id&&e.security_.can_write===!0&&!(e.id in t.lock)}var t=a.config,n=[];return angular.forEach(t.selected,function(e){n.push(e)}),n.filter(e)},e.$watch("config.primary",function(t){t&&(e.auto_align_data.target=t)}),e.selectAllAHs=function(){angular.forEach(e.alignmentHelpers,function(e){e.visibility=!0})},e.deselectAllAHs=function(){angular.forEach(e.alignmentHelpers,function(e){e.visibility=!1})},e.downloadXML=function(){e.generateXML()};var g=function(t,n){e.floor&&(e.floor.id===m&&t!==n&&l.saveLater(e.floor),m=e.floor.id)},p=function(e,t){e!==t&&(g(e,t),l.onUpdate("z"))},m=-1;e.$watch("floor.name",g),e.$watch("floor.z_min",p),e.$watch("floor.z_max",p)};DatasetAlignmentController.prototype=Object.create(ParentAlignmentController.prototype),IndoorViewerWebApp.controller("DatasetAlignmentController",["$scope","$rootScope","$interval","DatasetAlignmentService","DatasetService","$injector","CameraAndViewportService","PointCloudServerService","PolygonDrawingService","PointCloudMenuService",DatasetAlignmentController]),function(){"use strict";function e(e,t,n,a,i,o,r,s,l,c){function d(){D.locationPickerMode=D.getDatasetsWithLocation().length?D.ELocationPickerMode.DATASET:D.ELocationPickerMode.CUSTOM,t.setDatasetQuery(O),e.refresh(),a.fetchGoogleMapsLibrary(!1)}function u(){D.locationReferenceDataset=D.getDatasetsWithLocation()[0],S()}function g(){D.addressToSearch="",D.addressNotFound=!1,D.olMap.updateMapSize(),E(!0,!0)}function p(t){function n(){e.addDataset(t,V())}D.datasetsToAddNames=t.name,I(n)}function m(e){e.percent=100*e.progress()}function v(e){function t(){angular.forEach(e,function(e){e.percent=0,F[e.uniqueIdentifier]=V()}),D.datasetUploader.upload()}function n(){angular.forEach(e,function(e){e.cancel()})}function a(e){return e.name}D.datasetsToAddNames=e.map(a).join(", "),I(t,n)}function f(e,t){if(e.percent=100,t){var n=angular.fromJson(t);e.errorMessage=n.msg}else e.errorMessage=c.getString("Upload failed.");delete F[e.uniqueIdentifier]}function h(e,t){var n=angular.fromJson(t).job_id;e.job_id=n,D.jobs[n]={},D.jobs[n].busy=!0,delete F[e.uniqueIdentifier]}function b(e){return!!D.jobs[e]&&D.jobs[e].busy}function y(e){return!!D.jobs[e]&&(!D.jobs[e].busy&&!D.jobs[e].success)}function _(e){o.$watch("vm.config.googleMapsFetched",function(t){t&&!D.olMap&&w(),e&&e()})}function w(){D.olMap=new OpenLayersMap(U,r,a,i),D.olMap.addClickHandler(T),D.locationReferenceDataset?S():E(!0,!0)}function S(){D.locationReferenceDataset&&(D.locationPickerMode=D.ELocationPickerMode.DATASET,M(D.locationReferenceDataset),D.olMap&&D.olMap.controlActivate("click",!1))}function E(e,t){D.locationPickerMode=D.ELocationPickerMode.CUSTOM,C(D.addingLocation,e,t),D.olMap&&D.olMap.controlActivate("click",!0)}function M(e){D.addingLocation.longitude=e.global_location_[0],D.addingLocation.latitude=e.global_location_[1],D.addingLocation.height=e.global_location_[2],D.addingLocation.orientation=Math.degrees(e.orientation),C(D.addingLocation,!0,!0)}function C(e,t,n){D.olMap&&(D.olMap.moveLocationMarkerTo(e),t&&D.olMap.zoomToLocation(e,n?L():void 0))}function T(e){A(e),E(!1,!1)}function k(){function e(e){A(e),E(!0,!0)}function t(){D.addressNotFound=!0}D.addressToSearch&&(D.addressNotFound=!1,a.searchAddress(D.addressToSearch).then(function(n){n.data&&n.data[0]?e(n.data[0]):t()},t))}function x(){return n.datasets}function I(e,t){D.addHandler=e,D.cancelHandler=t,$("#"+G).modal("show"),D.getDatasetsWithLocation().length||(D.locationPickerMode=D.ELocationPickerMode.CUSTOM);var n=D.locationPickerMode===D.ELocationPickerMode.DATASET?u:g;_(n)}function O(e){return F[e.uniqueIdentifier]}function P(){return R("longitude")&&R("latitude")&&R("height")&&R("orientation")}function R(e){return void 0!==D.addingLocation[e]&&""!==D.addingLocation[e]&&isFinite(D.addingLocation[e])}function V(){var e=angular.copy(D.addingLocation);return e.orientation=Math.radians(D.addingLocation.orientation),e}function A(e){D.addingLocation.longitude=e.longitude,D.addingLocation.latitude=e.latitude,D.addingLocation.height=D.addingLocation.height||0,D.addingLocation.orientation=D.addingLocation.orientation||0,invalidateAngular()}function L(){return R("longitude")&&R("latitude")?N:0}var D=this;this.ELocationPickerMode={DATASET:"dataset",CUSTOM:"custom"},this.initDatasetMode=u,this.initCustomMode=g,this.addDataset=p,this.removeDataset=e.removeDataset,this.addBundle=e.addBundle,this.removeBundle=e.removeBundle,this.filesSubmitted=v,this.uploadError=f,this.uploadSuccess=h,this.fileProgress=m,this.updateMapForReferenceDataset=S,this.updateMapForCustomLocation=E,this.isAddingLocationValid=P,this.isLocationFieldValid=R,this.searchAddress=k,this.getDatasetsWithLocation=x,this.isJobBusy=b,this.hasJobFailed=y,this.locationPickerMode=this.ELocationPickerMode.CUSTOM,this.datasets=e.datasets,this.bundles=e.bundles,this.progress=e.progress,this.datasetUploader=t.datasetUploader,this.config=a.config,this.datasetsToAddNames="",this.locationReferenceDataset=null,this.addingLocation={},this.addressToSearch="",this.addressNotFound=!1,this.olMap=void 0,this.COLOR_DEFS=l.COLOR_DEFS;var N=17,G="dataset-location-modal",U="open-layers-map-location-reference",F=e.locations;this.jobProgress=s.progress,this.jobs=s.jobs,d()}e.$inject=["DatasetManagementService","FlowService","DatasetService","GeoRegistrationService","ConfigService","$scope","$q","JobsListService","DatasetAlignmentService","gettextCatalog"],angular.module("IVWebApp").controller("DatasetManagementController",e)}(),IndoorViewerWebApp.controller("DatasetMenuController",["$scope","gettextCatalog","DatasetService","DatasetAlignmentService","ImageService","DatasetsFactory","IV","MessageReportingService","GroupService","PointCloudMenuService",function(e,t,n,a,i,o,r,s,l,c){l.preparePermissionsEditor(e,"dataset"),e.datasets=n.datasets,e.COLOR_DEFS=a.COLOR_DEFS,e.onUpdate=function(e){e&&(e.visible?a.select(e):a.deSelect(e)),n.onUpdate()},e.jumpToFirstImage=function(){for(var e=null,t=0;t<i.images.length;t++)if(i.images[t].dataset_id==this.dataset.id&&!i.images[t].hidden){e=i.images[t];break}e?r.moveToLocation(e):(this.dataset.getCenter().then(function(e){r.moveToGeoLocation(e,!0,void 0,void 0,void 0,void 0,!0)}),n.activateDataset(this.dataset.id),c.showPointClouds(!0))},e.selectAll=function(){angular.forEach(e.datasets,function(e){e.visible=!0,a.select(e)}),e.onUpdate()},e.deselectAll=function(){angular.forEach(e.datasets,function(e){e.visible=!1,a.deSelect(e)}),e.onUpdate()},e.setResourceToEdit=function(t){var n=t.pcObj_;t.pcObj_=null,e.edited=angular.copy(t),t.pcObj_=n,e.edited.state_={previousTitle:t.title,previousLevel:t.level,previousGroupRead:t.group_read,previousGroupWrite:t.group_write}},e.updateDataset=function(){function a(){i.title=e.edited.state_.previousTitle,i.level=e.edited.state_.previousLevel,i.group_read=e.edited.state_.previousGroupRead,i.group_write=e.edited.state_.previousGroupWrite,s.showMessage(t.getString("Update failed"),t.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))}var i=n.datasetsIdMap[e.edited.id];i.title=e.edited.title,i.level=e.edited.level,i.group_read=e.edited.group_read,i.group_write=e.edited.group_write,i.$update()["catch"](a)},e.getNumSelected=function(){function t(e){return e.visible}return e.datasets.filter(t).length}}]),IndoorViewerWebApp.controller("FloorChangerController",["$scope","FloorChangerService","DatasetService","ConfigService","UIService","ViewMenuService","ModeService","IV",function(e,t,n,a,i,o,r,s){e.data=t.data,e.isVisible=function(){return a.getBoolean("ui.floorchanger.visible",!0)&&"normal"===r.modes.currentMode&&e.data.floors.length&&!i.isPanelOpen()},e.changeFloor=function(e){t.changeFloor(e)},e.getClass=function(t){return e.data.current_floor&&t.name===e.data.current_floor.name?"active":""},e.getClassUp=function(){return e.data.floor_above?"":"disabled"},e.getClassDown=function(){return e.data.floor_below?"":"disabled"}}]),angular.module("IVWebApp").controller("GeoRegOLMController",GeoRegOLMController);var GeoRegistrationController=function(e,t,n,a,i,o,r,s,l,c){s.invoke(ParentAlignmentController,this,{$scope:e,$rootScope:t,$interval:n,dataService:a,DatasetAlignmentService:i,DatasetService:o}),e.toolbar={transparentDatasets:!0,layerSwitcher:!0,GuRM:!0},e.config=a.config,e.config.GuRM||(e.config.GuRM={}),e.config.GuRM.markers={},e.init=function(){angular.forEach(l.POIsMap,function(t){t.reference_marker&&(e.config.GuRM.markers[t.dataset_id]||(e.config.GuRM.markers[t.dataset_id]=[]),e.config.GuRM.markers[t.dataset_id].push({poi:t,data:{}}))})},e.hasReferenceMarkers=function(t){return e.config.GuRM.markers[parseInt(t)]},e.showModal=function(t,n){$(t).modal("show"),e.config.GuRM.status=void 0,e.config.GuRM.current_dataset=n,e.toggleAll(!0),e.recalculate_TuRM()},e.recalculate_TuRM=function(t){e.config.GuRM.error=!1,!t&&e.config.GuRM.three_D&&(t=3);var n=!1,i=0,r=[[0],[0],[0]],s=[[0],[0],[0]],l=[[],[],[]],d=[[],[],[]],u=[1,1],g=new OpenLayers.Projection("EPSG:900913"),p=new OpenLayers.Projection("EPSG:4326"),m=new window.IV.services.GeoTransformationService(c);if(angular.forEach(e.config.GuRM.markers[e.config.GuRM.current_dataset],function(e){if(e.data.selected){n||(m.setOffsetFromGlobal(e.poi.geometry_.coordinates[0],e.poi.geometry_.coordinates[1]),n=!0);var t=new THREE.Matrix4;t.identity().setPosition(m.toLocal(e.poi.geometry_.coordinates[0],e.poi.geometry_.coordinates[1],e.poi.geometry_.coordinates[2])),e.data.pos=(new THREE.Vector3).setFromMatrixPosition(t),r[0][0]+=e.poi.dataset_location_.x,r[1][0]+=e.poi.dataset_location_.y,r[2][0]+=e.poi.dataset_location_.z,s[0][0]+=e.data.pos.x,s[1][0]+=e.data.pos.y,s[2][0]+=e.data.pos.z,i++}}),0===i)return void angular.forEach(e.config.GuRM.markers[e.config.GuRM.current_dataset],function(e){e.data.error=void 0});r[0][0]/=i,r[1][0]/=i,r[2][0]/=i,s[0][0]/=i,s[1][0]/=i,s[2][0]/=i,angular.forEach(e.config.GuRM.markers[e.config.GuRM.current_dataset],function(e){e.data.selected&&(l[0].push(e.poi.dataset_location_.x-r[0][0]),l[1].push(e.poi.dataset_location_.y-r[1][0]),l[2].push(e.poi.dataset_location_.z-r[2][0]),d[0].push(e.data.pos.x-s[0][0]),d[1].push(e.data.pos.y-s[1][0]),d[2].push(e.data.pos.z-s[2][0]))});var v=numeric.transpose(l),f=numeric.dot(d,v),h=numeric.svd(f),b=h.U,y=numeric.transpose(h.V),_=numeric.dot(b,y),w=numeric.det(_);u.push(w);var S=numeric.diag(u),E=numeric.dot(b,S),M=numeric.dot(E,y),C=Math.atan2(M[1][0],M[0][0]);if(nearlyEqual(h.S[1],0)||nearlyEqual(h.S[1],h.S[2])||nearlyEqual(w,-1))return void(e.config.GuRM.error=!0);var T=numeric.sub(s,numeric.dot(M,r)),k=new THREE.Matrix4;k.identity().makeRotationZ(C).setPosition(new THREE.Vector3(T[0][0],T[1][0],T[2][0]));var x=m.toGlobal((new THREE.Vector3).setFromMatrixPosition(k)),I=new window.IV.services.GeoTransformationService(c);I.setOffsetFromGlobal(x[0],x[1]);var O=(new THREE.Matrix4).identity().makeRotationZ(C).setPosition(I.toLocal.apply(this,x)),P=function(e,t){var n=new window.IV.services.GeoTransformationService(c);return n.setOffsetFromGlobal(e.lon,e.lat),new THREE.Vector3(0,0,e.z).sub(n.toLocal(t.lon,t.lat,t.z)).length()};angular.forEach(e.config.GuRM.markers[e.config.GuRM.current_dataset],function(e){var n=new THREE.Matrix4;n.compose(e.poi.dataset_location_,e.poi.dataset_orientation_,new THREE.Vector3(1,1,1));var a=new THREE.Matrix4;a.multiplyMatrices(O,n);var i=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Vector3;a.decompose(i,o,r),e.data.new_global=I.toGlobal(i);var s=new OpenLayers.LonLat(e.data.new_global[0],e.data.new_global[1]),l=new OpenLayers.LonLat(e.poi.geometry_.coordinates[0],e.poi.geometry_.coordinates[1]);t&&3===t?(s.z=e.poi.geometry_.coordinates[2],l.z=e.data.new_global[2],e.data.error=P(s,l)):(s.z=0,l.z=0,e.data.error=P(s,l))});var R=o.datasetsIdMap[e.config.GuRM.current_dataset];a.setAsPrimary(R);var V=a.mod_data.locations4326[R.id],A=new OpenLayers.LonLat(V[0],V[1]);A.transform(p,g);var L=new OpenLayers.LonLat(x[0],x[1]);L.transform(p,g),e.config.GuRM.d_delta={x:L.lon-A.lon,y:L.lat-A.lat,z:x[2]-V[2]},e.config.GuRM.yaw_delta=C-a.mod_data.orientations[R.id],t||3===t||delete e.config.GuRM.d_delta.z},e.toggleAll=function(t){angular.forEach(e.config.GuRM.markers[e.config.GuRM.current_dataset],function(e){e.data.selected=t})},e.apply_GuRM=function(t){e.config.selected[e.config.GuRM.current_dataset]?($(t).modal("hide"),e.config.GuRM.apply=!0,e.config.GuRM.status=void 0):e.config.GuRM.status="GuRMModal.STATUS_NO_DATASETS"},e.downloadXML=function(){a.updateDatasets(),e.generateXML()},e.init()};GeoRegistrationController.prototype=Object.create(ParentAlignmentController.prototype),IndoorViewerWebApp.controller("GeoRegistrationController",["$scope","$rootScope","$interval","GeoRegistrationService","DatasetAlignmentService","DatasetService","ProgressReportService","$injector","POIService","$q",GeoRegistrationController]),angular.module("IVWebApp").controller("GroupController",GroupController),IndoorViewerWebApp.controller("HelpController",["$scope","$http","$location","URLService",function(e,t,n,a){e.feedback={},e.feedback_status="",e.waiting_for_response=!1,e.sendFeedback=function(i){if(e.feedback_status="",i){var o={};angular.forEach(e.feedback,function(e,t){t.indexOf("$")===-1&&e.$modelValue&&(o[e.$name]=e.$modelValue)}),o.address_bar_url=n.absUrl(),o.scene_state_url=a.generateShareURL(),o.device_pixel_ratio=window.devicePixelRatio,o.screen_width=window.screen.width,o.screen_height=window.screen.height,o.color_depth=window.screen.colorDepth,o.window_width=document.body.clientWidth,o.window_height=Math.max(window.innerHeight,document.body.clientHeight),e.waiting_for_response=!0,t({method:"POST",url:"api/feedbackmail",data:o}).success(function(t){e.waiting_for_response=!1,e.feedback_status=t}).error(function(t,n){e.waiting_for_response=!1,e.feedback_status="ERROR"})}}}]),function(){"use strict";function e(e,t,n){function a(){e.refreshJobsList(),e.showModalOnJobFinish(!1)}function i(e,t){t.stopPropagation(),r=e,$("#confirmJobCancel.modal").modal("show")}function o(){e.cancelJob(r)}var r;t.$on("$destroy",function(){e.progress.jobRunning||n.datasetUploader.isUploading()?e.showModalOnJobFinish(!0):e.clearTimeouts()}),$("#job-panel").on("hide.bs.collapse",function(){e.clearTimeouts(!0)}),$("#job-panel").on("show.bs.collapse",function(t){var n=$(t.target).attr("data-job-id");e.refreshJobDetails(n)}),this.jobs=e.jobs,this.progress=e.progress,this.showCancelModal=i,this.confirmJobCancel=o,a()}e.$inject=["JobsListService","$scope","FlowService"],angular.module("IVWebApp").controller("JobsListController",e)}(),IndoorViewerWebApp.controller("LanguageController",["$scope","LanguageService","POIService","localStorageService",function(e,t,n,a){e.getCurrentLanguage=t.getCurrentLanguage,e.getBrowserLocale=t.getBrowserLocale,e.languages=t.getRegisteredLanguages(),e.changeToLanguage=function(e){t.setLanguage(e),a.set("iv_lang_key",e),n.onUpdate()},e.resetToBrowserLanguage=function(){var t=e.getBrowserLocale();t?e.changeToLanguage(t):a.remove("iv_lang_key")}}]),IndoorViewerWebApp.controller("MapScaleController",["$scope","MapScaleService",function(e,t){e.scale_unit=t.getScaleUnit,e.scale_pixels=t.getScalePixels}]),IndoorViewerWebApp.controller("MeasurementsController",["$scope","ArchitectureMarkerService","UIService","UserService","gettextCatalog","localStorageService",function(e,t,n,a,i,o){function r(n,a){e.unitSelected=n,t.unit=n,a&&o.set("iv_unit_string",n.string)}function s(){var t=o.get("iv_unit_string");t?e.units.forEach(function(e){e.string==t&&r(e,!0)}):r(e.unitSelected,!1)}function l(){if(!a.isUserLoggedIn()&&!a.isGuest())return!1;var e=t.getPermissionGroup();return 0!==e||0===e&&a.getUserInfo().checkAttribute("can_make_public")}e.config=t.data,e.architectureMarkerService=t,e.isSaveAllowed=l,e.units=[{string:"cm",name:i.getString("Centimeter",null,"Unit name"),conversion:1,decimals:0},{string:"m",name:i.getString("Meter",null,"Unit name"),conversion:.01,decimals:2},{string:"in",name:i.getString("Inch",null,"Unit name"),conversion:1/2.54,decimals:1}],e.unitSelected=e.units[0],s(),e.$watch("[architectureMarkerService.showMenu(),architectureMarkerService.hasUnsavedChanges(),architectureMarkerService.areAnySaved()]",function(e){n.recalculateLeftPanelElementsBodyMaxHeight()},!0),e.$watch("config.createNewMeasureFlag",function(n,a){n===!0&&JSON.stringify(n)!=JSON.stringify(a)&&(t.createANewArchitectureService(),e.config.createNewMeasureFlag=!1)}),e.$watch("config.stopUpdatingMeasureFlag",function(n,a){n===!0&&JSON.stringify(n)!=JSON.stringify(a)&&(t.stopUpdatingMeasure(),e.config.stopUpdatingMeasureFlag=!1)}),e.selectUnit=function(e){r(e,!0),t.setUnitAndRedrawAll()}}]),IndoorViewerWebApp.controller("MenuController",["$scope","MenuService","UIService","UserService","ConfigService","IV",function(e,t,n,a,i,o){e.config=t.config,e.isUserLoggedIn=a.isUserLoggedIn,e.toggleMenu=function(a){var i=function(e){o.getMainView().getLayer(o.layers.CursorLayer).setVisibility(e),o.getMainView().invalidateScene()};e.config.options[a].onclick?e.config.options[a].onclick():e.parentObj.menu!=e.config.options[a].template?(n.isTemplate3DCursorDependent(e.config.options[a].template)?i(!1):n.isTemplate3DCursorDependent(e.parentObj.menu)&&i(!0),e.config.options[a].keyboard_exclusive&&(t.keyboard_exclusive_state=!0),e.config.options[a].vertical_menu?(t.verticalMenuOpened(!0),e.parentObj.vertical_menu=e.config.options[a].template):e.parentObj.menu=e.config.options[a].template):(i(!0),e.parentObj.menu="templates/blank.html",t.keyboard_exclusive_state=!1)}}]),IndoorViewerWebApp.controller("MessageReportingController",["$scope","$element","MessageReportingService",function(e,t,n){e.message=n.message,e.$watch("message",function(e,n){e&&""!==e.body&&""!==e.title&&angular.element(t[0].children[0]).modal("show")},!0)}]),IndoorViewerWebApp.controller("ModeController",["$scope","ModeService","CameraAndViewportService","ViewMenuService","POIService","PointCloudMenuService","DatasetAlignmentService","DatasetService","POITypeService","PolygonDrawingService","GeoRegistrationService","UIService","MenuService",function(e,t,n,a,i,o,r,s,l,c,d,u,g){e.modes=t.modes,e.modesOrdered=t.modesOrdered,e.config=a.config,e.$watch("config",function(e,t){void 0!==e&&JSON.stringify(e)!=JSON.stringify(t)&&a.onUpdate(t,e)},!0),e.datasets=s.datasets,e.switchToMode=function(a){a!==e.modes.currentMode&&("GeoRegistration"===e.modes.currentMode?d.updateDatasets():"datasetAlignment"===e.modes.currentMode&&r.updateDatasets(),t.switchToMode(a),"GeoRegistration"!==t.modes.currentMode&&n.setViewports(),"normal"===t.modes.currentMode&&(g.verticalMenuOpened(!1),u.hideVerticalPanel()),o.mode=a)},e.switchFeatures=function(){t.switchFeatures()},e.isModeEnabled=function(e){return t.isEnabled(e)}}]),IndoorViewerWebApp.controller("NavGraphEditingController",["$scope","NavGraphService","GroupService","UIService",function(e,t,n,a){n.preparePermissionsEditor(e,"bundle"),e.hidePanel=!1,e.navGraphService=t,e.editing=t.editing,e.$watch("visible.showNavGraph",function(e){a.recalculateLeftPanelElementsBodyMaxHeight()}),e.$watch("navGraphService.isMovingNodes",function(t){e.hidePanel=t}),e.$watch("navGraphService.editing.createNodeFlag",function(n,a){n===!0&&JSON.stringify(n)!=JSON.stringify(a)&&(t.editing.createNode(),e.navGraphService.editing.createNodeFlag=!1)},!0),e.$watch("navGraphService.config.bundle_current",function(n){e.edited=t.getBundle(n),e.edited&&(e.edited.state_={previousGroupRead:e.edited.group_read,previousGroupWrite:e.edited.group_write})}),e.openAttributeEditor=function(t,n,a){e.editing.initAttributeEditor(t,n,a),angular.element(document.querySelector("#editAttributes")).modal("show")},e.exitAttributesEditor=function(){e.editing.clearSelectedElement()},e.saveAndExitAttributesEditor=function(){e.editing.saveAttributes(),e.exitAttributesEditor()},e.addAttribute=function(){""!==e.editing.selectedElement.selected_key&&""!==e.editing.selectedElement.selected_value&&(e.editing.selectedElement.attributesMap[e.editing.selectedElement.selected_key]=e.editing.selectedElement.selected_value,e.editing.selectedElement.selected_key="",e.editing.selectedElement.selected_value="")},e.deleteAttribute=function(t){delete e.editing.selectedElement.attributesMap[t]},e.clearAttributeFields=function(){e.editing.selectedElement.selected_key="",e.editing.selectedElement.selected_value=""},e.getNrOfAttributes=function(){return Object.keys(e.editing.selectedElement.attributesMap).length},e.isHistoryEmpty=function(){return 0===e.editing.history_manager.getHistoryOperations().length}}]),IndoorViewerWebApp.controller("POIController",["$scope","$sce","POITypeService","POIService","RouteService","$upload","$location","CursorService","$q","gettextCatalog","ProgressReportService","IV","UserTrackingService","URLService","SocialService","GroupService","UIService","LanguageService","UserService",function(e,t,n,a,i,o,r,s,l,c,d,u,g,p,m,v,f,h,b){angular.element(document.querySelector("#editPOI")).on("show.bs.modal",function(){a.recalculateTextEditorSize()}),v.preparePermissionsEditor(e,"poi"),e.edited=a.edited,e.selected=a.selected,e.hover=a.hover,e.routing=a.routing,e.POIService=a,e.CursorService=s,e.editing=a.editing,e.save_status="",e.config=a.config,e.enable_features=a.enable_features,e.movedToPOI=a.movedToPOI,e.$watch("selected.poi",function(e){f.recalculateLeftPanelElementsBodyMaxHeight()},!0),e.getPOITypesMap=n.getPOITypesMap,e.search=function(e){return a.search(e)},e.warnings=[];var y=p.getBaseURL();CKEDITOR.plugins.addExternal("base64image",y+"dependencies/ckeditor_plugins/base64image/"),CKEDITOR.plugins.addExternal("insertsound",y+"dependencies/ckeditor_plugins/insertsound/"),CKEDITOR.plugins.addExternal("youtube",y+"dependencies/ckeditor_plugins/ckeditor-youtube-plugin/youtube/"),e.editorOptions={language:"en",entities_latin:!1,entities_greek:!1,entities_processNumerical:!1,toolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","TextColor"]},{name:"font",items:["FontSize"]},{name:"paragraph",items:["NumberedList","BulletedList"]},{name:"clipboard",items:["Undo","Redo"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"insert",items:["Table","base64image","insertsound","Youtube"]},{name:"document",items:["Source"]}],removeButtons:"Subscript,Superscript",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"link:advanced",height:"auto",extraAllowedContent:"div[*]; *(*); iframe[style,src,frameborder,width,height]",extraPlugins:"colorbutton,font,base64image,insertsound,youtube",removePlugins:"elementspath",resize_enabled:!1,customConfig:""},e.enlargeModalView=function(){var e=angular.element(document.querySelector("#poiEditor"));e.toggleClass("full-window"),a.recalculateTextEditorSize()},e.isFullWindow=function(){return angular.element(document.querySelector("#poiEditor")).hasClass("full-window")},e.$watch("editing",function(t,n){e.save_status=""},!0),e.$watch("CursorService.clicked",function(){e.config.moving_POI&&(e.setPoseFromCursor(),angular.copy(e.editing.poi,e.selected.poi),a.onUpdate())}),e.onPOIClick=function(){e.selectPOI(a.hover.poi)},e.selectPOI=function(t){e.search_term=t.name,angular.element("#poi-typeahead-search").val(e.search_term),a.selectPOI(t)},e.closePoi=function(){a.closePOI(),e.search_term="",angular.element("#poi-typeahead-search").val(e.search_term)},e.createPOIURL=function(){if(e.selected.poi){var t=r.absUrl(),n=t.replace(r.url(),"");return n=n.replace("#",""),n+"#/?poi="+e.selected.poi.id+"&fov="+u.getMainView().getfov().toFixed(1)}},e.isScreenNarrower=function(){return window.innerWidth<635},e.openEditor=function(t){angular.element(document.querySelector("#poiEditor #poi-editor-tab-home")).on("shown.bs.tab",function(){a.recalculateTextEditorSize()}),t?(e.editing.poi=a.createPOIObject(),e.setPoseFromCursor(),e.editing.language_options=e.formLanguageOptions(),e.edited.group_read=b.getDefaultGroupRead(),e.edited.group_write=b.getDefaultGroupWrite()):(e.editing.poi=angular.copy(e.selected.poi),e.editing.language_options=e.formLanguageOptions(),e.editing.poi.current_language_=e.editing.poi.getTranslation(),e.edited.group_read=e.editing.poi.group_read,e.edited.group_write=e.editing.poi.group_write),e.editing.create=t,e.edited.state_={previousGroupRead:e.edited.group_read,previousGroupWrite:e.edited.group_write},angular.element(document.querySelector("#editPOI")).modal("show");var n=CKEDITOR.instances.editor1;n&&n.on("paste",function(e){e.data.dataValue=Autolinker.link(e.data.dataValue)},n.element.$),invalidateAngular(),a.recalculateTextEditorSize()},e.exitEditor=function(t){e.editing.poi=void 0,e.warnings=[],t&&$("#"+t).modal("hide")},e.savePOI=function(t){function n(n){e.selected.poi=e.editing.poi,e.exitEditor(t),e.selected.poi.reference_marker&&a.calculateLocalProperties(e.selected.poi),a.POIsMap[e.selected.poi.id]=e.selected.poi,
a.onUpdate()}function i(){e.save_status=c.getString("Error in creating/updating the POI."),a.recalculateTextEditorSize()}var o=e.editing.poi.translations_[h.getFallbackLanguage()],r=!0;o&&o.hasOwnProperty("code")&&""!=o.code?e.warnings.name=!1:(e.fallback_language=h.getLanguageName(h.getFallbackLanguage()),o&&(e.editing.poi.current_language_=o),e.warnings.name=!0,r=!1),""===e.editing.poi.poi_type?(e.warnings.type=!0,r=!1):e.warnings.type=!1,r===!0?_().then(function(){e.editing.poi.group_read=e.edited.group_read,e.editing.poi.group_write=e.edited.group_write,e.editing.poi.save().$done.then(n,i),e.config.poi_before_moving=void 0,e.config.moving_POI=!1,e.enable_features.full_screen=e.config.original_full_screen}):a.recalculateTextEditorSize()};var _=function(){var t,n=l.defer(),a=0,i=0;t=e.editing.poi.description?e.editing.poi.description.lastIndexOf('src="data:image/png'):-1;for(var r=[],s=[],u=[],g=[],p=function(){if(i++,i==a){for(var t=0;t<a;t++)u[t]&&(e.editing.poi.description=e.editing.poi.description.substring(0,r[t]+1)+"poi/image/"+u[t]+e.editing.poi.description.substring(s[t]));m.setPercentage(100),n.resolve()}},m=null,v=function(e,t){if(m){var n=g[e];t?g[e]=100*t.loaded/t.total:g[e]=100,m.incrementPercentage((g[e]-n)/a)}};t>-1;){m||(m=d.addTask(c.getString("Uploading images..."),1)),a++;var f=t+4,h=e.editing.poi.description.indexOf('"',f+1),b=e.editing.poi.description.substring(f+1,h),y=dataURItoBlob(b);r.push(f),s.push(h),g.push(0),function(e,t,n){o.upload({url:"poi/image",method:"POST",withCredential:!0,file:y,fileFormDataName:"image"}).progress(function(e){v(n,e)}).success(function(e,t,a,i){u[n]=e.url,v(n),p()}).error(function(e,t,a,i){console.log("Error uploading base64 image"),u[n]=null,v(n),p()})}(f,h,r.length-1),t=e.editing.poi.description.lastIndexOf('src="data:image/png',t-1)}return 0==a&&n.resolve(),n.promise};e.deletePOI=function(t){var n=function(){e.exitEditor(t)},i=function(){e.save_status=c.getString("Error in deleting the POI."),a.recalculateTextEditorSize()};a.deletePOI(e.selected.poi,n,i)},e.startMovePOI=function(){e.config.moving_POI=!0,e.config.poi_before_moving=angular.copy(e.selected.poi),e.enable_features.full_screen&&(e.config.original_full_screen=e.enable_features.full_screen,e.enable_features.full_screen=!1)},e.cancelMovePOI=function(){e.config.poi_before_moving&&(angular.copy(e.config.poi_before_moving,e.selected.poi),e.config.poi_before_moving=void 0,a.onUpdate()),e.config.moving_POI=!1,e.enable_features.full_screen=e.config.original_full_screen},e.setPoseFromCursor=function(){var t=s.getCursorData();e.editing.poi.geometry_=t.geometry,e.editing.poi.location_=t.location,e.editing.poi.orientation_=t.orientation,e.editing.poi.dataset_orientation_=t.dataset_orientation,e.editing.poi.dataset_location_=t.dataset_location,e.editing.poi.dataset_id=t.dataset_id},e.goToPOI=function(){return e.config.screenshot={},e.movedToPOI.id=e.selected.poi.id,e.movedToPOI.promise=u.moveToPOI(e.selected.poi),e.movedToPOI.promise&&(e.movedToPOI.transitioning=!0,e.movedToPOI.promise.then(function(){e.movedToPOI.transitioning=!1})),e.movedToPOI.promise},e.buildShareURLs=function(){e.config.sn_share_URLs.twitter=p.generateSNShareURL("twitter",e.createPOIURL())},e.moveToShareURL=function(t,n){var a=function(){m.moveToShareURLCommonCode(t,n,e.config.screenshot,{type:"poi",id:e.selected.poi.id,lang:h.getDataLanguage()})},i=c.getString("Please wait for the page to load...");t.document.writeln('<html></head><body bgcolor=white onLoad="self.focus()">'+i+"</body></html>"),e.movedToPOI.id===e.selected.poi.id&&e.movedToPOI.promise?e.movedToPOI.promise.then(a):e.goToPOI().then(a)},e.routeFromHere=function(){e.routing.start=a.selected.poi,a.closePOI(),a.clearLocationAsPOI(),u.triggerEvent("routeStartSelected",e.routing.start)},e.routeToHere=function(){e.routing.end=a.selected.poi,a.closePOI(),a.clearLocationAsPOI(),u.triggerEvent("routeEndSelected",e.routing.end)},e.onFileSelect=function(t){for(var n=0;n<t.length;n++){var i=t[n];e.upload=o.upload({url:"poi/image",method:"POST",withCredential:!0,file:i,fileFormDataName:"image"}).progress(function(e){console.log("Progress percentage: "+parseInt(100*e.loaded/e.total))}).success(function(t,n,a,i){e.warnings.file_upload=!1;var o="",r=e.editing.poi.current_language_.description;if(i.file.type.indexOf("image")>-1){var s=$('<img id="dynamic">');s.attr("src","poi/image/"+t.url),s.css("width","inherit"),o=s[0].outerHTML}else if(i.file.type.indexOf("pdf")>-1){var l=document.createElement("IFRAME");l.setAttribute("src","poi/image/"+t.url),l.setAttribute("frameborder",0),l.setAttribute("width","100%"),l.setAttribute("height","480px"),l.setAttribute("frameborder",0),o=l.outerHTML}else i.file.type.indexOf("audio/")>-1&&(o='<audio controls><source src="poi/image/'+t.url+'"></source></audio>');e.editing.poi.current_language_.description=r?r+o:o}).error(function(t,n,i,o){415==n&&(e.warnings.file_upload=!0,a.recalculateTextEditorSize())})}},e.uploadPOIIcon=function(t,n,i){for(var r=0;r<t.length;r++){var s=t[r];e.upload=o.upload({url:n,method:"POST",withCredential:!0,file:s,fileFormDataName:i}).progress(function(e){console.log("Progress percentage: "+parseInt(100*e.loaded/e.total))}).success(function(t,i,o,r){e.editing.poi.icon=n+t.url,a.uploadedCustomIcon(n+t.url)})}},e.search_term="";var w=e.search_term,S=0,E=e.search_term,M=!1;e.trackSearch=function(){e.search_term?e.search_term.length>E.length?(M=!0,e.search_term.length>w.length&&(w=e.search_term,e.search(e.search_term,"search").then(function(e){S=e.length}))):M&&" "==e.search_term.substr(e.search_term.length-1,1)&&C(!1):M&&C(!1),E=e.search_term};var C=function(t){var n=function(){w="",M=!1};t?e.search(E,"search").then(function(e){g.trackSearch(E+" (successful)","poi",e.length),n()}):(g.trackSearch(w+" (failed)","poi",S),n())};e.openSearchedPoint=function(t){e.selectPOI(t),w=E,C(!0)},e.getUploadedIcons=function(){return a.getUploadedIcons()},e.getGroupName=function(e){return n.getTypeGroup(e.group_id)?n.getTypeGroup(e.group_id).getName():""},e.allLanguages=h.getAllDataLanguages(),e.newTranslationAdded=function(t,n){var a=angular.copy(n);a.save=t.translations_[h.getFallbackLanguage()].save,t.translations_[n.language_key]=a,t.current_language_=t.translations_[n.language_key],t.current_language_.group_=c.getString("Used languages"),e.editing.language_options=e.formLanguageOptions()},e.languageSelectChanged=function(t){t.current_language_.group_==c.getString("Unused languages")&&e.newTranslationAdded(t,t.current_language_)},e.formLanguageOptions=function(){if(e.editing.poi&&e.editing.poi.translations_){e.editing.language_options=[];for(var t in e.editing.poi.translations_){var n=e.editing.poi.translations_[t];n&&n.hasOwnProperty("language_key")&&(n.group_=c.getString("Used languages"),e.editing.language_options.push(n))}for(var t=0;t<e.allLanguages.length;t++){var n=e.allLanguages[t];if(void 0==e.editing.poi.translations_[n.key]){var a={};a.language_name_=n.nativeName,a.language_key=n.key,a.group_=c.getString("Unused languages"),e.editing.language_options.push(a)}}return e.editing.language_options}}}]);var openPOIShareWindow=function(e){var t=window.open();angular.element('[ng-controller="POIController"]').scope().moveToShareURL(t,e)};IndoorViewerWebApp.controller("POITypesController",["$scope","$upload","gettextCatalog","POITypeService","POIService","GroupService","UserService","LanguageService","MessageReportingService","IV",function(e,t,n,a,i,o,r,s,l,c){o.preparePermissionsEditor(e,"poi_type_group"),e.userInfo=r.getUserInfo(),e.getPOITypesMap=a.getPOITypesMap,e.getType=a.getType,e.getPOIGroupsMap=a.getPOIGroupsMap,e.config=a.config,e.type_editing,e.group_editing,e.associated_POIs=void 0,e.$watch("getPOITypesMap()",function(e,t){void 0!==e&&JSON.stringify(e)!=JSON.stringify(t)&&a.onUpdate(t)},!0),e.showAll=function(){a.setPOITypesVisibility(!0)},e.hideAll=function(){a.setPOITypesVisibility(!1)},e.setupTypeModal=function(t,n){if(e.type_editing={},n)e.type_editing=angular.copy(n),e.language_options=e.formLanguageOptionsFromObject(e.type_editing),e.type_editing.current_language_=e.type_editing.getTranslation();else{var i=a.createTypeObject();e.language_options=e.formLanguageOptionsFromObject(i),e.type_editing=i}e.type_editing.group_id=t.id,e.type_editing.group_read=t.group_read,e.type_editing.group_write=t.group_write,e.associated_POIs=void 0},e.exitEditor=function(t){e.type_editing=void 0,e.group_editing=void 0,e.show_warning=!1,t&&$("#"+t).modal("hide")},e.setupGroupModal=function(t){if(e.group_editing={},t)e.group_editing=angular.copy(t),e.language_options=e.formLanguageOptionsFromObject(e.group_editing),e.group_editing.current_language_=e.group_editing.getTranslation(),e.edited=e.group_editing;else{var n=a.createGroupObject();e.language_options=e.formLanguageOptionsFromObject(n),e.group_editing=n,e.edited=e.group_editing,e.edited.group_read=r.getDefaultGroupRead(),e.edited.group_write=r.getDefaultGroupWrite()}e.edited.state_={previousGroupRead:e.edited.group_read,previousGroupWrite:e.edited.group_write},e.associated_POIs=void 0},e.saveType=function(t,n){var i=n.translations_[s.getFallbackLanguage()];i&&i.hasOwnProperty("name")&&""!=i.name?n.save().$done.then(function(){a.addType(n),e.exitEditor(t)},function(e){console.log(e)}):(e.fallback_language=s.getLanguageName(s.getFallbackLanguage()),i&&(n.current_language_=i),e.show_warning=!0)},e.deleteType=function(t,n){t&&$("#"+t).modal("hide");var o=function(){e.type_editing={}};return a.deleteType(n,i.deletePOIsOfType(n),o)},e.saveGroup=function(t,i){function o(){a.addGroup(i)}function r(){l.showMessage(n.getString("Update failed"),n.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))}function c(){e.exitEditor(t)}var d=i.translations_[s.getFallbackLanguage()];d&&d.hasOwnProperty("name")&&""!=d.name?i.save().$done.then(o,r)["finally"](c):(e.fallback_language=s.getLanguageName(s.getFallbackLanguage()),d&&(i.current_language_=d),e.show_warning=!0)},e.deleteGroup=function(t,n){var i=function(t){var n=[];return angular.forEach(a.getTypeGroup(t).group_types_,function(t,a){n.push(e.deleteType(void 0,parseInt(a)))}),n};t&&$("#"+t).modal("hide");var o=function(){e.group_editing={}};return a.deleteGroup(n,i(n),o)},e.uploadPOITypeIconFile=function(n,a,i){for(var o=0;o<n.length;o++){var r=n[o];e.upload=t.upload({url:a,method:"POST",withCredential:!0,file:r,fileFormDataName:i}).progress(function(e){}).success(function(t,n,i,o){e.type_editing.icon=a+t.url})}},e.getPOIsOfType=function(t){return t?e.associated_POIs=i.getPOIsOfType(t):[]},e.getPOIsOfGroup=function(t){return t?e.associated_POIs=i.getPOIsOfGroup(t):[]},e.allLanguages=s.getAllDataLanguages(),e.newTranslationAdded=function(t,a){var i=angular.copy(a);i.save=t.translations_[s.getFallbackLanguage()].save,t.translations_[a.language_key]=i,t.current_language_=t.translations_[a.language_key],t.current_language_.group_=n.getString("Used languages"),e.language_options=e.formLanguageOptionsFromObject(t)},e.languageSelectChanged=function(t){t.current_language_.group_==n.getString("Unused languages")&&e.newTranslationAdded(t,t.current_language_)},e.formLanguageOptionsFromObject=function(t){if(t&&t.translations_){e.language_options=[];for(var a in t.translations_){var i=t.translations_[a];i&&i.hasOwnProperty("language_key")&&(i.group_=n.getString("Used languages"),e.language_options.push(i))}for(var a=0;a<e.allLanguages.length;a++){var i=e.allLanguages[a];if(void 0==t.translations_[i.key]){var o={};o.language_name_=i.nativeName,o.language_key=i.key,o.group_=n.getString("Unused languages"),e.language_options.push(o)}}return e.language_options}},e.getZoomLevel=function(){var e=c.getMapView().getViewport(),t=e.getCamera(),n=e.getWidth()/(t.right-t.left);return Number(n.toFixed(4))}}]),IndoorViewerWebApp.controller("PointCloudLayerController",["$scope","DatasetAlignmentService","DatasetService","CameraAndViewportService","ModeService","$q",function(e,t,n,a,i,o){e.config=t.config,e.modes=i.modes,e.cameraAndViewportService=a,e.dataset_colors=t.dataset_colors,e.$watch("modes.currentMode",function(e,a){e!==a&&"datasetAlignment"===e&&(angular.forEach(n.datasets,function(e){e.visible&&(t.select(e),r(e,e.color)),e.visible||t.deSelect(e)}),t.setZoomToAllSelected())}),e.$watchCollection("config.zoomToAllSelected",function(t){if(Object.keys(t).length>0){var n=new THREE.Vector3,i=[];angular.forEach(t,function(e){i.push(e.getCenter())}),o.all(i).then(function(i){angular.forEach(i,function(e){n.add(e)}),n.divideScalar(Object.keys(t).length),a.focusViewportsOnthisPosition(n),e.config.zoomToAllSelected={}})}}),e.$watchCollection("config.selected",function(){"datasetAlignment"===e.modes.currentMode&&angular.forEach(n.datasets,function(e){r(e)})}),e.$watch("dataset_colors",function(e,t){angular.forEach(e,function(e,a){if(t[a]&&e!==t[a]){var i=n.datasetsIdMap[a];r(i,e)}})},!0);var r=function(a,i){e.config.selected[a.id]?!i&&a.visible||(i&&(a.visible=!1,n.onUpdate(),a.color=i),a.visible=!0,a.PCColorDefinition_=t.COLOR_DEFS[a.color],e.dataset_colors[a.id]=a.color,n.onUpdate()):a.visible&&(a.visible=!1,a.PCColorDefinition_=e.dataset_colors[a.id]=void 0,n.onUpdate())}}]),IndoorViewerWebApp.controller("PointCloudMenuController",["$scope","gettextCatalog","PointCloudMenuService","ModeService",function(e,t,n,a){function i(n){1==n.material.useEDL?(e.tooltips[n.name].inactiveFromShading=t.getString("Inactive: Shading is enabled"),1==n.material.opacity?e.tooltips[n.name].inactiveFromShadingOpacity=t.getString("Inactive: Shading is enabled and opacity is 1"):e.tooltips[n.name].inactiveFromShadingOpacity=t.getString("Inactive: Shading is enabled")):1==n.material.opacity?(e.tooltips[n.name].inactiveFromShading="",e.tooltips[n.name].inactiveFromShadingOpacity=t.getString("Inactive: Opacity is 1")):(e.tooltips[n.name].inactiveFromShading="",e.tooltips[n.name].inactiveFromShadingOpacity="")}function o(){e.config.potreeAvailable||n.enablePotreeIfAvailable(),angular.forEach(n.settingsPanes,function(t){t.collapsed=!0,e.tooltips[t.name]={},i(t)})}function r(t,a){a=a||t,n.settingChangedCallback(a,e.config[t])}function s(e){n.advancedSettingChangedCallback(e),i(e)}function l(e,t,a){n.applyPreset(e,t,a),i(a)}e.config=n.config,e.dropdownMenus=n.dropdownMenus,e.settingsPanes=n.settingsPanes,e.mode=a.modes.currentMode,e.tooltips={},e.settingChangedCallback=r,e.advancedSettingChangedCallback=s,e.applyPreset=l,o()}]),IndoorViewerWebApp.controller("ProgressReportController",["$scope","ProgressReportService",function(e,t){e.data=t.data,e.isVisible=function(){return e.data.is_visible},e.isModal=function(){return e.data.is_modal},e.tasks=function(){return Object.keys(e.data.tasks).length},e.compactOnly=t.compactOnly}]),IndoorViewerWebApp.controller("RouteController",["$scope","POIService","RouteService","IV",function(e,t,n,a){e.selected=t.selected,e.routing=t.routing,e.route=n.routeData,e.toggle2DVisualization=function(){n.toggle2DVisualization()},e.reverseRoute=function(){var t=e.routing.start;e.routing.start=e.routing.end,e.routing.end=t,a.triggerEvent("routeStartSelected",e.routing.start),a.triggerEvent("routeEndSelected",e.routing.end)},e.$watch("[routing.start,routing.end]",function(e,t){angular.equals(e,t)||n.route()},!0),e.moveToRouteInstruction=function(e){n.moveToRouteInstruction(e)},e.routeInstructionMouseOver=function(e){a.triggerEvent("routeInstructionMouseOver",e)},e.routeInstructionMouseLeave=function(e){a.triggerEvent("routeInstructionMouseLeave",e)},e.selectPOI=function(e){t.selectPOI(e)}}]),IndoorViewerWebApp.controller("SettingsController",["$scope","$sce","ConfigService","ConfigFactory","MenuService","URLService","ImageService","IV","NavGraphService","UserService","GroupService","LicenseService","POIService","DatasetManagementService","MessageReportingService","gettextCatalog","gettext","TextGenService",function(e,t,n,a,i,o,r,s,l,c,d,u,g,p,m,v,f,h){function b(){return!0}function y(){return c.isAdmin()}function _(){function e(e){return e.security_.can_write}var t=c.getUserInfo(),n=d.getGroupsAsArray();return t.checkAttribute&&t.checkAttribute("can_create_user_groups")||n&&n.filter(e).length>0}function w(){return!u.isFeatureEnabled(u.EFeature.USER_MANAGEMENT)}function S(){x=n.changed_configs={}}function E(e){return"boolean"===e.type?n.getBoolean(e.name,!1):n.getString(e.name,"")}function M(){function t(t){var n=e.setting_pages[t];return n.isVisible()&&(!n.isDisabled||!n.isDisabled())}var n=Object.keys(e.setting_pages).filter(t);e.setCurrentPage(n[0])}e.warningDialogConfig={TITLE:f("Unsaved changes"),TEXT:f("Your changes are not saved and will be lost if you proceed. Are you sure you want to leave?")},e.bulk_editing_dialog_config={nr_of_group_content_usages:void 0},e.permissions_data={},e.expiring_license_translations={title:v.getString("Instance key is going to expire soon!"),instructions:t.trustAsHtml(v.getString("Your instance key of IndoorViewer is going to expire soon. Please extend it on {{url}} and import into this IndoorViewer instance using the administration panel in the settings. In case of any further questions, contact {{email}}.",{email:'<a href="mailto:support@navvis.com">support@navvis.com</a>',url:'<a href="https://portal.navvis.com" target="_blank">portal.navvis.com</a>'}))},u.isExpirationPeriod()&&m.showMessage(e.expiring_license_translations.title,e.expiring_license_translations.instructions);var C,T,k=angular.element(document.getElementById("unsaved-changes-dialog"));e.grouped_configs=n.grouped_configs;var x=n.changed_configs;e.loginURL=o.generateURL(i.config.options.login.URLParamName,"true"),e.hidden_images={},angular.forEach(r.imageById,function(t,n){t.hidden&&(e.hidden_images[n]=t)}),e.NO_HIDDEN_IMAGE=0===Object.keys(e.hidden_images).length,e.exit=function(){e.parentObj.menu="templates/blank.html",e.discardChangedConfigs(),i.keyboard_exclusive_state=!1},e.checkIfDataSaved=function(){!T&&e.permissions_data.isDataChanged&&e.permissions_data.isDataChanged()&&(C=!0,k.modal("show"))},e.warningCancelHandler=function(){T=void 0},e.warningContinueHandler=function(){e.setCurrentPage(T),T=void 0,k.modal("hide")},e.setting_order=["CONFIGURATION_EDITOR","ADMINISTRATION_PANEL","USERS","GROUPS","DATASETS","HIDDEN_IMAGES","LANGUAGE_PREFERENCE"],e.setting_pages={CONFIGURATION_EDITOR:{caption:f("Configuration"),template:"templates/settings/ConfigEditor.html",isVisible:y},ADMINISTRATION_PANEL:{caption:f("Administration"),template:"templates/settings/administration/AdminPanel.html",isVisible:y},USERS:{caption:f("Users"),template:"templates/settings/permissions/Users.html",post_action:e.checkIfDataSaved,isVisible:y,isDisabled:w},GROUPS:{caption:f("Groups"),template:"templates/settings/permissions/Groups.html",post_action:e.checkIfDataSaved,isVisible:_,isDisabled:w},DATASETS:{caption:f("Dataset management"),template:"templates/settings/dataset_management/DatasetManagement.html",isVisible:y},HIDDEN_IMAGES:{caption:f("Hidden images"),template:"templates/settings/HiddenImages.html",isVisible:y},LANGUAGE_PREFERENCE:{caption:f("Language"),template:"templates/settings/LanguagePreference.html",isVisible:b}},e.setCurrentPage=function(t){var n=e.current_page?e.setting_pages[e.current_page.key].post_action:void 0,a=e.setting_pages[t].pre_action,i=e.setting_pages[t].template;if(!e.setting_pages[t].isDisabled||!e.setting_pages[t].isDisabled()){if(n&&n(),!T&&C)return T=t,void(C=!1);a&&a(),i&&(e.current_page={key:t,template:i})}},e.getTranslationKey=function(e){return h.getText("ConfigurationEditor",e.toUpperCase().split(".").join("_"))},e.getConfigUnavailableText=function(t){return e.isConfigEnabled(t)?"":v.getString("This option is not available")},e.getConfigCategoryDisabledText=function(t){return e.isConfigCategoryEnabled(t)?"":v.getString("You do not have permission to change the startup view")},e.discardChangedConfigs=function(){angular.forEach(x,function(e){e.value=E(e)}),S()},e.saveChangedConfigs=function(){function t(){n.updateConfigMap(i),S(),e.saving_in_progress=!1}function a(){e.discardChangedConfigs(),e.saving_in_progress=!1}var i=Object.keys(x).map(function(e){return x[e]});e.saving_in_progress=!0,n.saveConfigs(x).then(t,a)},e.configChanged=function(e){x[e.name]?x[e.name]&&x[e.name].value==E(e)&&delete x[e.name]:x[e.name]=e},e.anyConfigsChanged=function(){return Object.keys(x).length>0},e.isConfigEnabled=function(e){return n.isConfigAvailable(e.name)&&e.security_.can_write},e.isConfigCategoryEnabled=function(t){function a(e){return e.category===t}function i(t){e.isConfigEnabled(t)||(o=!1)}var o=!0;return n.config_array.filter(a).forEach(i),o},e.moveToImage=function(t){e.exit(),s.moveToLocationID(t)},M()}]),IndoorViewerWebApp.controller("ShareMenuController",["$scope","URLService","SocialService","IV",function(e,t,n,a){e.showURL=!0,e.showJS=!1,e.URLService=t,e.screenshot={},e.sn_share_URLs={},e.init=function(){e.sn_share_URLs.twitter=t.generateSNShareURL("twitter",t.generateShareURL())},e.moveToShareURL=function(t,i){var o=a.getMainView();n.moveToShareURLCommonCode(t,i,e.screenshot,{type:"image",id:o.getImage().id,lon:o.getViewDir().lon.toFixed(2),lat:o.getViewDir().lat.toFixed(2)})},e.init()}]);var openShareWindow=function(e){var t=window.open();angular.element('[ng-controller="ShareMenuController"]').scope().moveToShareURL(t,e)};!function(){"use strict";function e(e,t,n,a,i){e.server_status=t.check(),e.show_status=!1,a.initialized.then(function(){e.show_status=a.getBoolean("ui.statuscheck.visible",!0)&&i.isAdmin()}),e.getGlobalStatus=t.getGlobalStatus}e.$inject=["$scope","StatusCheckService","CreditsService","ConfigService","UserService"],angular.module("IVWebApp").controller("StatusCheckController",e)}(),IndoorViewerWebApp.controller("UIController",["$scope","UIService","ConfigService","POIService","MenuService",function(e,t,n,a,i){e.parentObj=t.config,e.ConfigService=n,e.isVerticalMenuOpened=i.verticalMenuOpened,i.keyboard_exclusive_state=!1,e.hideOpenPanels=function(){i.isFullscreenMenu(e.parentObj.menu)||(t.hideOpenPanels(),i.keyboard_exclusive_state=!1)}}]),angular.module("IVWebApp").controller("UserController",UserController),IndoorViewerWebApp.controller("VectorMapEditingController",["$scope","$upload","gettextCatalog","VectorMapService","UIService","PolygonDrawingService","GroupService","UserService","MessageReportingService",function(e,t,n,a,i,o,r,s,l){e.vectorMapService=a,e.login_service=s,r.preparePermissionsEditor(e,"vector_map"),e.updateVisibility=function(e){a.updateVisibility(e)},e.toggleMapExpansion=function(e){e.expanded_=!e.expanded_,e.expanded_||e.layers_.forEach(function(e){e.selected_=!1})},e.toggleMapSelection=function(e){e.selected_=!e.selected_},e.toggleLayerSelection=function(e){e.selected_=!e.selected_,a.maps.forEach(function(e){e.selected_=!1})},e.selectAll=function(){a.maps.forEach(function(e){e.selected_=!1,e.expanded_&&e.layers_.forEach(function(e){e.selected_=!0})})},e.deselectAll=function(){a.maps.forEach(function(e){e.selected_=!1,e.layers_.forEach(function(e){e.selected_=!1})})};var c=function(){return a.layers.filter(function(e){return e.selected_===!0})},d=function(){return a.maps.filter(function(e){return e.selected_===!0})};e.selectionSetVisibility=function(e){c().forEach(function(t){t.visible=e}),a.updateVisibility()},e.anySelected=function(){return d().length>0||c().length>0},e.checkSelectionWritePermissions=function(){function e(e){return e.security_.can_write}var t=d(),n=c();return t.length===t.filter(e).length&&n.length===n.filter(e).length},e.selectionRemove=function(){a.removeLayers(c()),a.removeMaps(d())},e.toggleVisibility=function(e){e.visible=!e.visible,a.updateVisibility()};var u=function(){e.is_upload_progress=!1,e.is_upload_success=!1,e.is_upload_error=!1,invalidateAngular()},g=function(t){var n=!1;e.layers_with_invalid_polygons={},e.layers_with_invalid_loops={},e.layers_with_invalid_loops_depth={},angular.forEach(t.layer_metadata,function(t,a){t.invalid_polygons>0&&(e.layers_with_invalid_polygons[a]=t.invalid_polygons,n=!0),t.invalid_loops>0&&(e.layers_with_invalid_loops[a]=t.invalid_loops,e.layers_with_invalid_loops_depth[a]=t.invalid_loops_depth,n=!0)}),n&&$("#invalidPolygonsModal").modal("show")};e.uploadDXF=function(n){for(var i=0;i<n.length;i++){var o=n[i];e.upload=t.upload({url:"api/vectormaps/upload/",method:"POST",withCredential:!1,file:o,fileFormDataName:"file"}).progress(function(t){e.is_upload_progress=!0}).success(function(t,n,i,o){e.is_upload_progress=!1,e.is_upload_success=!0,e.upload_result=t,a.onUpdate("newLayersUploaded"),setTimeout(function(){u()},1e4),g(t)}).error(function(t){e.is_upload_progress=!1,e.is_upload_error=!0,setTimeout(function(){u()},15e3)})}},e.startEditing=function(t){e.edited=t,t.state_={inEdit:!0,previousName:t.name,previousGroupRead:t.group_read,previousGroupWrite:t.group_write}},e.endEditing=function(t){function i(){t.state_={},a.onUpdate("renamedMap")}function o(){e.cancelEditing(t),l.showMessage(n.getString("Update failed"),n.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))}t.$update().then(i,o)},e.cancelEditing=function(e){e.name=e.state_.previousName,e.group_read=e.state_.previousGroupRead,e.group_write=e.state_.previousGroupWrite,e.state_={}},u()}]),IndoorViewerWebApp.controller("ViewMenuController",["$scope","ViewMenuService","NavGraphService","ConfigService","IV","LicenseService",function(e,t,n,a,i,o){e.config=t.config,e.nav_graph_rendering=n.rendering,e.$watch("nav_graph_rendering",function(e,t){e.THRESH===t.THRESH&&e.THRESH_Z===t.THRESH_Z||n.onUpdate("CONSTANTS_CHANGED")},!0),e.$watch("config",function(e,n){void 0!==e&&JSON.stringify(e)!=JSON.stringify(n)&&(i.setSceneRendering("map",t.mapVisibility()),i.setSceneRendering("panorama",t.panoramaVisibility()),t.onUpdate(n,e))},!0)}]);var AbstractView=function(e){function t(){a&&console.log("AbstractView::onCameraMoveEnd"),"onCameraMoveEnd"in n&&n.onCameraMoveEnd(),i.forEach(function(e,t){e.onCameraMoveEnd&&e.onCameraMoveEnd()})}var n=this,a=!1,i=[];this.currentImage=null,this.currViewingDir={lon:0,lat:0},this.divContainer=void 0,this.scene=void 0,this.renderer=void 0,this.context_menu_element=$("#"+e),this.active=!0;var o,r=!1,s=[],l=null,c=function(){k(!0)},d=null,u=null,g=!1,p=1,m=!1,v=void 0,f=[],h=void 0,b=void 0,y=1e3,_=new THREE.Raycaster,w=function(){n.divContainer=new HTMLContainer(e);try{n.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch(t){return void $("#webGlMissing").show()}n.renderer.setClearColor(1644825,1),n.renderer.setSize(n.divContainer.getCurrentWidth(),n.divContainer.getCurrentHeight()),n.divContainer.appendChild(n.renderer.domElement),n.renderer.sortObjects=!0,n.scene=new THREE.Scene,n.scene.matrixAutoUpdate=!1;var a=new THREE.DirectionalLight(8355711);a.position.set(1,0,.5),a.position.normalize(),a.name="light1",n.scene.add(a),a=new THREE.DirectionalLight(8355711),a.position.set(-.7,.7,.5),a.position.normalize(),a.name="light2",n.scene.add(a),a=new THREE.DirectionalLight(8355711),a.position.set(-.7,-.7,-.5),a.position.normalize(),a.name="light3",n.scene.add(a);var i=Hammer(n.divContainer.getContainer(),{dragMinDistance:3});i.on("tap",A),i.on("doubletap",L),i.on("touch",F),i.on("mousemove",j),i.on("dragstart",B),i.on("drag",W),i.on("dragend",K),i.on("mousewheel",H),i.on("DOMMouseScroll",H),i.on("pinch",z),isPlatform("iOS")&&i.on("hold",D),window.addEventListener("keypress",M,!1),window.addEventListener("keydown",E,!1),window.addResizeEventListener(n.divContainer.getContainer(),C),$(function(){$.contextMenu({selector:"#"+e,reposition:!1,build:function(e,t){return V(t)}})}),TWEEN.setFPS(15)};n.rebuildContextMenu=function(e){S()&&n.context_menu_element.contextMenu("hide"),n.context_menu_element.contextMenu(e)};var S=function(){return n.context_menu_element.hasClass("context-menu-active")},E=function(e){return v&&v.object.onDragCancel&&e.keyCode===KeyEvent.DOM_VK_ESCAPE?(v.object.onDragCancel(),void(v=void 0)):void(n.onKeyDown&&n.onKeyDown(e))},M=function(e){var t=e.target.nodeName.toLowerCase();if(!("input"==t||"textarea"==t||"form-description"==e.target.id||e.target.className.indexOf("ta-text")>0))for(var n in i)if(i[n].onKeyPress&&i[n].onKeyPress(e))break},C=function(){n.divContainer.onResize(),n.invalidateScene()};this.forceResize=function(){window.forceResizeEvent(n.divContainer.getContainer())},this.addToScene=function(e){i.push(e)},this.getLayers=function(){return i},this.getLayer=function(e){for(var t in i)if(i[t]instanceof e)return i[t];return null},this.enableInsetViewHover=function(e){var t=IV.injector.get("ViewMenuService");t.config.hover_inset_view=e,invalidateAngular()},this.getImage=function(){return n.currentImage},this.invalidateScene=function(e){e&&f.push(e),!r&&n.active&&(r=!0,requestAnimationFrame(T))};var T=function(){r=!1,n.moveInScene&&n.moveInScene(),window.clearTimeout(l),s.length>0&&n.invalidateScene(),TWEEN.update(),k(!0),s.length||(l=setTimeout(c,200))},k=function(e){var t=r;P(),n.refreshCameras(n.currViewingDir),n.renderer.timeBudget=e?Number.POSITIVE_INFINITY:10,n.renderViews(n.renderer,n.scene),r&&!t&&console.log("FIXME: scene has been invalidated during rendering, this breaks on-demand rendering!"),R()};this.watchTween=function(e){s.push(e),n.invalidateScene()},this.forgetTween=function(e){var t=s.indexOf(e);t<0?console.error("Trying to remove non-existing tween"):(s.splice(t,1),n.invalidateScene())},this.onTransitionStart=function(e,t,a){n.currentImage=e;for(var o in i)if(i[o].onTransitionStart)try{i[o].onTransitionStart(e,t,a)}catch(r){console.log("Caught exception in layer: "+r.stack)}},this.onTransitionEnd=function(e){for(var t in i)i[t].onTransitionEnd&&i[t].onTransitionEnd(e)};var x=function(e){var t=getEventPosition(e);for(var n in i)i[n].onMouseMove&&i[n].onMouseMove(t)},I=function(e){if(n.currentImage){var t=getEventPosition(e),a=n.getPositionOnGroundPlane(t.x,t.y,n.currentImage.floor_location_.z);if(null!==a&&!(a.distanceTo(n.currentImage.floor_location_)>1e6))for(var o in i)i[o].onMouseMoveOnGroundPlane&&i[o].onMouseMoveOnGroundPlane(a)}},O=function(e,t){for(var n in i)if(i[n].onMouseWheel&&i[n].onMouseWheel(e,t))return!0;return!1},P=function(){for(var e in i)if(i[e].onBeforeRender){var t=n.getCamera();i[e].onBeforeRender(t)}};this.beforeRenderViewports=function(e){for(var t in i)i[t].onBeforeRenderViewport&&i[t].onBeforeRenderViewport(e)};var R=function(){for(var e in i)if(i[e].onAfterRender){var o=n.getCamera();i[e].onAfterRender(o)}h?!b&&equalVectors(h,n.getCamera().position)?(b=setTimeout(t,y),a&&console.log("Scheduled onCameraMoveEnd() in "+y+" ms ")):equalVectors(h,n.getCamera().position)||(a&&console.log("Update cancelled."),h=angular.copy(n.getCamera().position),clearTimeout(b),b=void 0):h=angular.copy(n.getCamera().position);for(var e=0;e<f.length;e++){var r=f[e];r()}f=[]};this.afterRenderViewports=function(e){for(var t in i)i[t].onAfterRenderViewport&&i[t].onAfterRenderViewport(e)};var V=function(e){var t=getEventPosition(e),a=[],o=0,r={},s=n.getObjectsUnderCursor(e),l=s.concat(i);for(var c in l){var d=l[c].object?l[c].object.onContextMenu:l[c].onContextMenu;if(d){var u=d(t);if(u===!1)return!1;if(u&&(u.key&&!r[u.key]||!u.key))if(r[u.key]=!0,u&&void 0!==u.name)a[o++]=u;else for(var g in u)a[o++]=u[g]}}return!!o&&{items:a}},A=function(e){var t=e.gesture.srcEvent,n=void 0!==t.button?t.button:0;S()||0!==n||(I(e),N(e,"onClick")||G(e,"onClick")||U(e,"onClick"))},L=function(e){I(e),N(e,"onDoubleClick")||G(e,"onDoubleClick")||U(e,"onDoubleClick")},D=function(e){n.rebuildContextMenu({x:e.gesture.touches[0].pageX,y:e.gesture.touches[0].pageY})},N=function(e,t){var a=n.getObjectsUnderCursor(e),i=getEventPosition(e);for(var o in a){var r=a[o].object;if(r[t]&&r[t](i)===!0)return e.gesture.preventDefault(),!0}return!1},G=function(e,t){var n=getEventPosition(e);for(var a in i)if(i[a][t]&&i[a][t](n)===!0)return e.gesture.preventDefault(),!0;return!1},U=function(e,t){if(t in n){var a=getEventPosition(e);
n[t](a)}},F=function(e){isPlatform("iOS")&&e.gesture.preventDefault(),q(),p=1},H=function(e){e.preventDefault();var t=getEventPosition(e),a=getMouseWheelDelta(e),i=n.getObjectsUnderCursor(e);for(var o in i){var r=i[o].object;if(r.onMouseWheel&&r.onMouseWheel(t,a))return}O(t,a)||n.onZoomView(e,a,!1)},z=function(e){e.gesture.preventDefault();var t=e.gesture.scale/p;p=e.gesture.scale,n.onZoomView(e,t,!0),g=!0},j=function(e){o=getEventPosition(e),x(e),I(e);var t=n.getObjectsUnderCursor(e),a=getEventPosition(e),i=n.getViewport(a.x,a.y),r=!1;for(var s in t){var l=t[s].object;if(l.onMouseOver&&(l!==d&&(null!==d&&d.onMouseOut&&d.onMouseOut(e,i),l.onMouseOver(e,i),d=l),l===d)){r=!0;break}}r||(null!==d&&d.onMouseOut&&d.onMouseOut(e,i),d=null)};this.getLastMousePosition=function(){return o?{x:o.x,y:o.y}:{x:0,y:0}};var B=function(e){if(e.gesture){e.gesture.preventDefault(),q();var t=e.gesture.startEvent.srcEvent,a=void 0!==t.button?t.button:0;if(0==a){var i=n.getObjectsUnderCursor(t);for(var o in i){var r=i[o].object;if(r.onDrag){var s=getEventPosition(t),l=n.getViewport(s.x,s.y);if(!l||r.onDragStart&&!r.onDragStart(s,l))continue;return void(v={object:r,viewport:l})}}}if(n.onDragViewStart){var s=getEventPosition(t);m=n.onDragViewStart(s,a)}}},W=function(e){if(e.gesture){if(e.gesture.preventDefault(),v){var t=getEventPosition(e);return void v.object.onDrag(t,v.viewport)}if(g&&(e.gesture.deltaX=0,e.gesture.deltaY=0,g=!1),m){var a=getEventPosition(e.gesture.startEvent.srcEvent);n.onDragView(e.gesture.deltaX,e.gesture.deltaY,a),e.gesture.startEvent.center.clientX=e.gesture.center.clientX,e.gesture.startEvent.center.clientY=e.gesture.center.clientY,e.gesture.startEvent.timeStamp=e.gesture.timeStamp,e.gesture.startEvent.lastDrag={timeStamp:e.gesture.timeStamp,deltaX:e.gesture.deltaX,deltaY:e.gesture.deltaY,deltaTime:e.gesture.deltaTime/1e3}}}},K=function(e){e.gesture&&(e.gesture.preventDefault(),e.gesture.stopDetect());var t=!1;if(m&&n.onDragViewEnd&&(n.onDragViewEnd(),m=!1,t=!0),v)return v.object.onDragEnd&&v.object.onDragEnd(),void(v=void 0);if(e.gesture&&t){var a=1e3,i=100*n.viewAngleToPixels(),o=.1;if(l=e.gesture.timeStamp-e.gesture.startEvent.lastDrag.timeStamp,!e.gesture.startEvent.lastDrag||l/1e3>o)return void(n.onSustainedDragViewEnd&&n.onSustainedDragViewEnd());var r=e.gesture.startEvent.lastDrag.deltaX,s=e.gesture.startEvent.lastDrag.deltaY,l=e.gesture.startEvent.lastDrag.deltaTime;if(0!=l){var c=getEventPosition(e.gesture.startEvent.srcEvent),d={vx:Math.max(-i,Math.min(i,r/l)),vy:Math.max(-i,Math.min(i,s/l))},g=0;u=new TWEEN.Tween(d).to({vx:0,vy:0},a).easing(TWEEN.Easing.Linear.EaseNone).onUpdate(function(e){var t=e-g;g=e,n.onDragView(d.vx*t,d.vy*t,c)}).onComplete(function(){n.forgetTween(u),u=null,n.onSustainedDragViewEnd&&n.onSustainedDragViewEnd()}).start(),n.watchTween(u)}}},q=function(){u&&(u.stop(),n.forgetTween(u),u=null)};this.unprojectScreenCoordinates=function(e,t,a,i){i||(i=n.getViewport(e,t));var o=n.normalizeCoordinates(e,t,void 0===a?1:a,i);return o.unproject(i.getCamera()),o},this.unprojectEvent=function(e,t){var a=getEventPosition(e);return n.unprojectScreenCoordinates(a.x,a.y,void 0===t?1:t)},this.normalizeCoordinates=function(e,t,a,i){var i=i||n.getViewport(e,t),o=i.getWidth(),r=i.getHeight();if(0==o||0==r)return new THREE.Vector3(0,0,a);var s=i.getX(e),l=i.getY(t),c=s/o*2-1,d=2*-(l/r)+1;return new THREE.Vector3(c,d,a)},this.getObjectsUnderCursor=function(e){var t=getEventPosition(e),a=n.getViewport(t.x,t.y),i=a.getCamera(),o=n.normalizeCoordinates(t.x,t.y,0,a);_.setFromCamera(o,i);var r=_.intersectObjects(n.scene.children,!0,!1);return r.sort(function(e,t){if(e.object.userData.is2D&&!t.object.userData.is2D)return-1;if(t.object.userData.is2D&&!e.object.userData.is2D)return 1;var n=e.distance-t.distance;return n<.001?e.object.position.distanceTo(i.position)-t.object.position.distanceTo(i.position):e.distance-t.distance}),r},this.getPositionOnGroundPlane=function(e,t,a,i){var i=i||n.getViewport(e,t),o=n.normalizeCoordinates(e,t,0,i);_.setFromCamera(o,i.getCamera());var r=new THREE.Plane(new THREE.Vector3(0,0,1),(-a));return _.ray.intersectPlane(r)},this.cameraZoomAndTranslate=function(e,t,a,i,o,r){var s=o?getEventPosition(o):r,l=n.getViewport(s.x,s.y),c=l.getCamera(),d=c.userData.fov;t?c.userData.fov/=e:c.userData.fov+=e*c.userData.fov*.1,c.userData.fov=Math.min(i,Math.max(a,c.userData.fov));var u=c.userData.fov/d,g=new THREE.Vector3(0,0,1).unproject(c),p=g.clone(),m=n.unprojectScreenCoordinates(s.x,s.y,1,l);g.subVectors(m,g).multiplyScalar(u).sub(p.subVectors(m,p)),c.position.sub(g)},this.canvasToDataURI=function(e){var t=n.renderer.domElement;return e=e||"image/jpeg",[t.toDataURL(e,.9),t.clientWidth,t.clientHeight]},w()};window.IV.updateCursor=!1,IndoorViewerWebApp.service("IndoorViewerFactory",["$location","$rootScope","CameraAndViewportService","ConfigService","CursorService","DatasetService","GeoTransformationService","GeoRegistrationService","DatasetAlignmentService","ImageService","MainViewService","MapMeshService","NavGraphService","ModeService","MapScaleService","MapViewService","POIService","POITypeService","ProgressReportService","MessageReportingService","PointCloudMenuService","StatusCheckService","URLService","ArchitectureMarkerService","$q","RouteService","PolygonDrawingService","FloorChangerService","LicenseService","gettextCatalog","LanguageService","MenuService","UIService",function(e,t,n,a,i,o,r,s,l,c,d,u,g,p,m,v,f,h,b,y,_,w,S,E,M,C,T,k,x,I,O,P,R){function V(s){function l(e,t){for(var n=t?e:j.getViewDir(),a=85/180*Math.PI;n.lon<0;)n.lon+=2*Math.PI;for(n.lon%=2*Math.PI;e.lon<0;)e.lon+=2*Math.PI;e.lon%=2*Math.PI,n.lon<e.lon&&e.lon-n.lon>Math.PI?e.lon-=2*Math.PI:n.lon>e.lon&&n.lon-e.lon>Math.PI&&(e.lon+=2*Math.PI),e.lat=Math.max(-a,Math.min(a,e.lat));var i=new TWEEN.Tween(n).to({lon:e.lon,lat:e.lat},F).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onUpdate(function(){j.updateOrientation(n)}).onComplete(function(){j.forgetTween(i)}).start();j.watchTween(i)}function V(e){var t=new TWEEN.Tween({fov:j.getfov()}).to({fov:e},F).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onUpdate(function(){j.updatefov(this.fov)}).onComplete(function(){j.forgetTween(t)}).start();j.watchTween(t)}function A(e,t){var n=new TWEEN.Tween(j.getCamera().position).to({x:e.x,y:e.y,z:e.z},F).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onComplete(function(){j.forgetTween(n),t()}).start();j.watchTween(n)}function L(e){if(_.isCloudVisible()||_.showPointClouds(!0),e.destinationPos&&e.destinationPos.length()>H){var t=r.toGlobal(e.destinationPos);r.setOffsetFromGlobal(t),e.destinationPos=r.toLocal(t),_.onUpdate("clearPointClouds")}var n=new THREE.Vector3(0,0,0);for(var a in z)z[a].onTransitionStart(void 0,F);if(U.triggerEvent("transitionStart",{duration:F}),J){var i=new THREE.Vector3(1,0,0).applyQuaternion(Y.orientation_);e.destinationNormal=i}if(e.destinationNormal)if(0==e.destinationNormal.length())n.subVectors(e.destinationPos,j.getCamera().position).negate().setLength(2),n.z=0,e.destinationPos.z=j.getCamera().position.z,e.viewDir=void 0;else if(J||e.destinationNormal.z<.9&&e.destinationNormal.z>-.9)e.destinationNormal.normalize(),e.viewDir={lon:Math.atan2(-e.destinationNormal.y,-e.destinationNormal.x),lat:Math.asin(-e.destinationNormal.z)},e.destinationNormal.setLength(2),n=e.destinationNormal;else if(e.destinationNormal.z<=-.9){e.destinationNormal.normalize();var s=j.getViewDir(),c=Math.PI/2-Math.asin(-e.destinationNormal.z)/2,d=s.lon,u=new THREE.Vector3(0,0,0);u.x=Math.sin(c)*Math.cos(d),u.z=Math.cos(c),u.y=Math.sin(c)*Math.sin(d),e.viewDir={lon:Math.atan2(u.y,u.x),lat:Math.asin(u.z)},u.setLength(2).negate(),n=u}else n.z=1.9;if(e.destinationPos){W&&j.getCamera().position.copy(e.destinationPos);var g=e.destinationPos.clone();g.add(n),"normal"===p.modes.currentMode&&o.datasets.forEach(function(t){N(t,e.destinationPos)&&o.activateDataset(t.id)}),A(g,function(){W&&(W=!1)})}e.viewDir&&!angular.equals(j.getViewDir(),e.viewDir)&&l(e.viewDir,W),e.fov&&V(e.fov)}function D(){o.datasets[0]&&o.datasets[0].getCenter().then(function(e){o.activateDataset(o.datasets[0].id),L({destinationPos:e})})}function N(e,t){return!e.visible&&r.toLocal(e.global_location_).distanceTo(t)<20}var G,U=this,F=2e3,H=1e4,z=[],j=void 0,B=void 0,W=!0,$=null,K=!1,q=null,J=!1,Y=null,X=!1;s=s||{};var Z={loadComplete:[],datasetChanged:[],transitionStart:[],transitionEnd:[],locationChanged:[],floorChanged:[],poiSelected:[],poiClosed:[],routeStartSelected:[],routeEndSelected:[],routePlanned:[],routeInstructionClick:[],routeInstructionMouseOver:[],routeInstructionMouseLeave:[],zoomedMap:[]},Q=function(e){z.push(e)};this.setSceneRendering=function(e,t){var n="panorama"===e?j:B;n.active=t};var ee=function(){o.datasets.length>0?r.initCoordinatesSystem(o.datasets):T.initialized.then(function(){r.initCoordinatesSystem(o.datasets,T.polygons)})},te=function(e){S.preventNextChange(),o.fetch(),o.initialized.then(function(){c.fetch(),ee(),M.all([c.initialized,a.initialized,f.initialized,h.initialized]).then(function(){ne(),U.moveToStartingLoc(!0,e),s.onLoadComplete&&s.onLoadComplete(),U.triggerEvent("loadComplete")}),u.fetch()})["finally"](function(){ie(),X=!1})},ne=function(){if(a.getString("core.init.view")&&U.setMainScene(a.getString("core.init.view")),a.getCSV("poi.types")){h.setPOITypesVisibility(!1);var e=a.getCSV("poi.types",!0);h.setPOITypesVisibility(!0,e)}},ae=function(){return angular.element("#mainScene").size()?(G=b.addTask("",1,!0,!0),window.addEventListener("beforeunload",function(e){if(U.triggerEvent("locationChanged",{from:$,to:null}),f.selected.poi&&U.triggerEvent("poiClosed",f.selected.poi.id),"datasetAlignment"===p.modes.currentMode)return e&&(e.returnValue=I.getString("Do you want to navigate away from the current page?")),I.getString("Do you want to navigate away from the current page?")}),t.$on("$locationChangeStart",function(e,t,n){"datasetAlignment"!==p.modes.currentMode||t.indexOf(S.getBaseURL())!==-1||window.confirm(I.getString("Do you want to navigate away from the current page?"))||e.preventDefault()}),a.setLocalDefaults(s),te(),n.init("mainScene"),j=d.create("mainScene"),B=v.create("insetScene"),Q(j),Q(B),m.setViewport(B.getViewport()),S.setMainView(j),void S.setUserLocationChangeCallback(function(){"normal"===p.modes.currentMode&&(a.updateFromURL(),U.moveToStartingLoc())})):void window.setTimeout(function(){ae()},200)};this.reinit=function(){X||(X=!0,w.check(),a.fetch(),E.fetch(),g.clear(),"normal"!==p.modes.currentMode?(p.switchToMode("normal",!0),n.setViewports(),P.verticalMenuOpened(!1),R.hideVerticalPanel()):_.isCloudVisible()&&!_.config.usePotree&&(_.config.showPointCloud=!1,_.onUpdate("showPointCloud",!1)),f.clearRouting(),G=b.addTask("",1,!1,!1),h.initialized=h.fetchPOIGroupsAndTypes(),f.fetchAll(),_.onUpdate("clearPointClouds"),te(!0))},this.moveToPOIID=function(e,t,n,a,i){var o=f.POIsMap[e];if(o)U.moveToPOI(o,t,n,a);else{var o=f.fetchById(e);o.$promise.then(function(){return o.length>0?U.moveToPOI(o[0],t,n,a):(i||y.showMessage(I.getString("POI with ID {{id}} not found",{id:e}),I.getString("Requested POI could not be found, moving to the first image instead.")),U.moveToLocationID())})}},this.moveToPOI=function(e,t,n,a){J=!0,Y=e;var i=U.moveToGeoLocation(e.location_,!0,n,void 0,a);return t||(f.selectPOI(e),invalidateAngular()),i&&i.then(function(){S.updateURL({poi:e.id}),invalidateAngular()}),$||void 0==e.level||k.changeFloorByName(e.level),J=!1,Y=null,i};var ie=function(){G.itemDone(),document.getElementById("modal-cover").style.visibility="hidden"};this.route=function(e,t,n){if(!x.isFeatureEnabled(x.EFeature.ROUTING)||!a.getBoolean("routing.enabled",!1))return!1;if(e instanceof Array||(e=numeric.parseCSV(e)[0]),t instanceof Array||(t=numeric.parseCSV(t)[0]),1===e.length?f.routing.start=f.POIsMap[e[0]]:3===e.length&&(f.routing.start=f.getLocationAsPOI((new THREE.Vector3).fromArray(e),!0)),1===t.length?f.routing.end=f.POIsMap[t[0]]:3===t.length&&(f.routing.end=f.getLocationAsPOI((new THREE.Vector3).fromArray(t),!0)),f.routing.start&&f.routing.end){var i=C.requestRoute(f.routing.start,f.routing.end).then(function(){if(n)return C.moveToRouteInstruction(0)});return!(!i||!n)&&i}},this.moveToStartingLoc=function(t,n){ie(),S.preventNextChange();var i=e.search(),o=_.isCloudVisible(),s={lon:a.getFloat("core.init.lon",0),lat:a.getFloat("core.init.lat",0)},l={lon:a.getFloat("core.init.location.lon"),lat:a.getFloat("core.init.location.lat"),z:a.getFloat("core.init.location.z")},c=i.fov?parseInt(i.fov):void 0;(isNaN(s.lon)||isNaN(s.lat))&&(s.lon=0,s.lat=0);var d;if(i["!"]||(d=0),"route.start"in i&&"route.end"in i&&U.route(i["route.start"],i["route.end"],!("image"in i||"poi"in i||"lon"in i&&"lat"in i)));else if("image"in i)U.moveToLocationID(parseInt(i.image),s,c,n);else if("poi"in i)void 0===i["core.init.lon"]&&void 0===i["core.init.lat"]&&void 0===i[a.getAliasByName("core.init.lon")]&&void 0===i[a.getAliasByName("core.init.lat")]&&(s=void 0),U.moveToPOIID(parseInt(i.poi),i["!"],s,c,n);else if("lon"in i&&"lat"in i&&U.moveToGeoLocation({x:parseFloat(i.lon),y:parseFloat(i.lat),z:parseFloat(i.z)},!1,o?s:void 0,d,void 0,void 0,o));else if(o&&!("image"in i)&&!("poi"in i)&&0!=s.lat&&0!=s.lon&&"lon"in i&&"lat"in i)L({viewDir:s});else if(o&&!("image"in i)&&!("poi"in i)&&"fov"in i&&"lon"in i&&"lat"in i)L({fov:c});else if(a.getInteger("core.init.image"))U.moveToLocationID(a.getInteger("core.init.image"),s,c,!0);else if(l.lon&&l.lat&&null!=l.z){var u=r.toLocal(l.lon,l.lat,l.z);L({destinationPos:u,viewDir:s,fov:c})}else U.moveToLocationID(null,t?s:void 0);var g=a.getFloat("core.init.map.lon"),p=a.getFloat("core.init.map.lat"),m=a.getFloat("core.init.map.fov"),v=a.getString("core.init.map.floor",""),f="map"===a.getString("core.init.view");if(f){if(void 0!==m){U.getMapView().divContainer.onResize();var h=U.getMapView().getViewport(),b=h.getWidth(),y=h.getHeight();U.getMapView().getCamera().userData.fov=100*m/Math.min(b,y)}void 0!==g&&void 0!==p&&r.initialized.then(function(){var e=r.toLocal(g,p,0);U.getMapView().moveMap(e,void 0,!0)})}$||""===v||k.changeFloorByName(v)},this.moveToLocationID=function(e,t,n,a){var i=void 0;return e&&(i=c.imageById[e]),!e||i||a||y.showMessage(I.getString("Image with ID {{id}} not found",{id:e}),I.getString("Requested image could not be found, moving to the first image instead.")),i||(i=c.getFirstImage()),i?U.moveToLocation(i,t,void 0,n):D()},this.moveToLocation=function(t,n,a,i){if(K)return void(q=arguments);t&&H<t.location_.length()&&(r.setOffsetFromGlobal(o.datasetsIdMap[t.dataset_id].global_location_),_.isCloudVisible()&&_.onUpdate("clearPointClouds")),void 0===a&&t&&(a=t.location_.distanceTo(j.getCamera().position)+1);for(var s in z)z[s].onTransitionStart(t,F,{viewDistance:a,view_dir:n||j.getViewDir()});if(U.triggerEvent("transitionStart",{previous_image:$,image:t,view_distance:a,view_dir:n||j.getViewDir(),duration:F}),t){o.activateDataset(t.dataset_id);var c=$;$=t,K=!0;var d={};jQuery.extend(d,t.location_),W&&j.getCamera().position.copy(d);var u=M.defer();if(A(d,function(){for(var e in z)z[e].onTransitionEnd(t);U.triggerEvent("transitionEnd",{previous_image:c,image:$}),W&&(W=!1),K=!1,U.triggerEvent("locationChanged",{from:c,to:$});var n=c?c.dataset_id:void 0;n!=$.dataset_id&&U.triggerEvent("datasetChanged",{previous_dataset:n,dataset:$.dataset_id}),u.resolve(),q&&(U.moveToLocation.apply(this,q),q=null)}),void 0===n||angular.equals(j.getViewDir(),n)||l(n,W),void 0!==i&&V(i),J===!1){var g=e.url();S.updateURL({image:t.id}),g!=e.url()&&invalidateAngular()}return u.promise}},this.isMoving=function(){return K},this.moveToGeoLocation=function(e,t,n,a,i,o,s){var l=e;t||(l=r.toLocal(e.x,e.y,e.z));var d=10,u=c.getClosestImage($,l),g=u.image,p=u.distance;if(null==g||p>d||s)return U.getMapView().moveMap(l),!!_.isCloudVisible()&&(L({destinationPos:l,destinationNormal:o,viewDir:n,fov:i}),!1);if(!n){var m=(new THREE.Vector3).subVectors(l,g.location_);m.normalize(),n={},n.lon=Math.atan2(m.y,m.x),void 0===a?n.lat=Math.asin(m.z):n.lat=a}return U.moveToLocation(g,n,void 0,i)},this.moveToDataset=function(e,t,n){var a=c.getImageInDataset(e,t);return a||(a=c.getFirstImageInDataset(e)),!!a&&U.moveToLocation(a,n)},this.getMainView=function(){return j},this.getMapView=function(){return B},this.resetView=function(){U.moveToLocation($)},this.setMainScene=function(e){return angular.element('[ng-controller="BodyController"]').scope().setMainScene(e)},this.swapScenes=function(){return angular.element('[ng-controller="BodyController"]').scope().swapScenes()},this.setPOITypesVisibility=function(e,t){h.setPOITypesVisibility(e,t)},this.getShareURL=function(){return S.generateShareURL()},this.setLanguage=function(e){O.setLanguage(e),f.onUpdate()},this.getLanguage=function(){return O.getCurrentLanguage()},this.getCurrentCursorPosition=function(){return i.getCursorData()},this.addEventListener=function(e,t){return e in Z&&(Z[e].push(t),!0)},this.triggerEvent=function(e,t){for(var n=0;n<Z[e].length;n++)Z[e][n](t)},this.getScreenShot=function(e){return j.canvasToDataURI(e)},ae()}this.create=function(e){return new V(e)}}]),IndoorViewerWebApp.service("MainViewService",["AlignmentHelpersFactory","CameraAndViewportService","CameraImageLayerFactory","CursorLayerFactory","ImageService","IV","LocationMarkerLayerFactory","MeasurementLayerFactory","MenuService","NavGraphLayerFactory","POILayerFactory","POIService","PointCloudLayerFactory","RaycastService","RouteLayerFactory","URLService","ViewMenuService","UIService","BuildingAlignmentLayerFactory","ConfigService","FloorChangerService","PointCloudLayerV2Factory","PointCloudMenuService",function(e,t,n,a,i,o,r,s,l,c,d,u,g,p,m,v,f,h,b,y,_,w,S){function E(E){AbstractView.call(this,E);var M=this,C=[],T=5,k=1,x=function(){var e=Hammer(M.divContainer.getContainer());e.on("doubletap",R),window.addEventListener("keyup",P,!1),window.addEventListener("resize",O,!1),t.passRefOfView(M),M.renderer.autoClear=!1,M.scene.name="MainScene",window.scene=M.scene},I=function(){o.addEventListener("floorChanged",D),o.addEventListener("transitionStart",L),M.addToScene(r.create(M,M.scene,{move_to_show:!1})),M.addToScene(d.create(M,M.scene,{poi_names_config:"poi.names.panoramas",poi_visibilitycheck:!0})),M.addToScene(n.create(M,M.scene,M.renderer));try{M.addToScene(g.create(M,M.scene)),M.addToScene(b.create(M,M.scene))}catch(t){if("SecurityError"!==t.name)throw t;console.log("PointCloudWorker not available")}M.addToScene(w.create(M,M.scene)),M.addToScene(m.create(M,M.scene,{visualization:"3d"})),M.addToScene(c.create(M,M.scene,M.getCamera(),M.renderer)),M.addToScene(s.create(M,M.scene)),M.addToScene(a.create(M,M.scene)),M.addToScene(e.create(M,M.scene))};this.moveInScene=function(){var e=M.getLastMousePosition(),n=M.getViewport(e.x,e.y);n&&t.moveInFreeFlight(n)&&o.getMapView().invalidateScene()};var O=function(e){M.divContainer.onResize(),u.recalculateTextEditorSize(),h.recalculateLeftPanelElementsBodyMaxHeight()};this.updateCameraPosition=function(e){t.updateCameraPosition(e),o.getMapView().invalidateScene()},this.updatefov=function(e){t.getDefaultViewport().setfov(e),M.invalidateScene()},this.updateOrientation=function(e){M.currViewingDir.lon=e.lon,M.currViewingDir.lat=e.lat,M.invalidateScene(),o.getMapView().invalidateScene()},this.getViewDir=function(){return M.currViewingDir},this.getfov=function(){return t.getDefaultViewport().fieldOfView},this.getCamera=function(){return t.getDefaultCamera()},this.isKeyPressed=function(e){return C[e]},this.onKeyDown=function(e){var n=e.target.nodeName.toLowerCase();if(!("input"==n||"textarea"==n||"select"==n||"form-description"==e.target.id||e.target.className.indexOf("ta-text")>0||l.keyboard_exclusive_state||e.altKey||e.ctrlKey||e.metaKey)){if(C[e.keyCode]=!0,M.isKeyPressed(KeyEvent.DOM_VK_UP)&&!o.isMoving()){var a=i.getClosestImageInDir(M.currentImage,M.currViewingDir,1,3);a&&o.moveToLocation(a)}else if(M.isKeyPressed(KeyEvent.DOM_VK_DOWN)&&!o.isMoving()){var a=i.getClosestImageInDir(M.currentImage,M.currViewingDir,-1,3);a&&o.moveToLocation(a)}else if(M.isKeyPressed(KeyEvent.DOM_VK_LEFT))A(20,0);else if(M.isKeyPressed(KeyEvent.DOM_VK_RIGHT))A(-20,0);else if(M.isKeyPressed(KeyEvent.DOM_VK_G)){var r=M.getLastMousePosition(),s=M.getViewport(r.x,r.y);s&&t.flipFullDiv(s)}M.invalidateScene()}};var P=function(e){C[e.keyCode]=!1,e.keyCode!=KeyEvent.DOM_VK_LEFT&&e.keyCode!=KeyEvent.DOM_VK_RIGHT||v.updateURL(null,!0)};this.onZoomView=function(e,n,a){t.zoom(e,n,a),M.invalidateScene(),o.getMapView().invalidateScene()},this.onDragViewStart=function(e,n){return"panorama"!=f.config.main_scene&&this.enableInsetViewHover(!0),t.onDragViewStart(e,n)},this.onDragView=function(e,n,a){t.onDragView(e,n,a)||A(e,n),M.invalidateScene()},this.onDragViewEnd=function(){"panorama"!=f.config.main_scene&&this.enableInsetViewHover(!1)},this.onSustainedDragViewEnd=function(){v.updateURL(null,!0)},this.onCameraMoveEnd=function(){S.isCloudVisible()&&v.updateURL()};var R=function(e){e.gesture.preventDefault(),o.isMoving()||p.getCoordinates(M,M.unprojectEvent(e),function(e,t,n,a){o.moveToGeoLocation(e,!0,M.getViewDir(),void 0,void 0,t,!a.hasPanoramas())},function(){V(e)})},V=function(e){var t=M.unprojectEvent(e).sub(M.getCamera().position);t.z=0,t.normalize(),t.multiplyScalar(T),t.add(M.getCamera().position);var n=i.getClosestImage(M.getImage(),t,k,!0);n.image&&o.moveToLocation(n.image)},A=function(e,n){var a=t.getDefaultViewport();if(0!=a.getWidth()&&0!=a.getHeight()){var i=e/a.getWidth(),r=n/a.getHeight(),s=a.getFOV()/180*Math.PI,l=s/a.getWidth()*a.getHeight(),c=85/180*Math.PI;M.currViewingDir.lon+=i*s,M.currViewingDir.lat+=r*l,M.currViewingDir.lat=Math.max(-c,Math.min(c,M.currViewingDir.lat)),o.getMapView().invalidateScene()}};M.viewAngleToPixels=function(){var e=t.getDefaultViewport();return e.getWidth()/e.getFOV()},this.getViewport=function(e,n){return t.getViewport(e,n)},this.refreshCameras=function(){t.refreshCameras(M.currViewingDir)},this.renderViews=function(){t.renderViews(M.renderer,M.scene,M)};var L=function(e){_.updateFloors(e.image)},D=function(e){e.floor.image&&"panorama"===f.config.main_scene&&o.moveToLocation(e.floor.image)};x(),y.initialized.then(function(){I()})}E.prototype=Object.create(AbstractView.prototype),this.create=function(e){return new E(e)}}]),IndoorViewerWebApp.service("MapViewService",["CameraFOVLayerFactory","ConfigService","LocationMarkerLayerFactory","MapImageLayerFactory","MapMeshLayerFactory","POILayerFactory","POIService","RouteLayerFactory","ViewMenuService","IV","PolygonLayerFactory","ImageService","FloorChangerService",function(e,t,n,a,i,o,r,s,l,c,d,u,g){function p(r){AbstractView.call(this,r);var g,p=this,m=1e3,v=1e3,f=new THREE.OrthographicCamera(0,0,0,0,.1,1e3),h=new window.IV.utils.SingleViewport(p.divContainer,f),b=new THREE.Vector3(0,0,(-1)),y=500,_=[],w=function(){f.userData.fov=10,f.up.set(0,1,0),f.position.set(0,0,y),p.renderer.setPixelRatio(isPlatform("iOS")&&window.devicePixelRatio||1),p.scene.name="MapScene"},S=function(){c.addEventListener("transitionStart",E),c.addEventListener("floorChanged",M),p.addToScene(d.create(p,p.scene)),p.addToScene(n.create(p,p.scene,{distance_threshold:200,circle_segments:8,hide_markers_timeout:500,marker_color:t.getInteger("core.map.marker.color",10468812),marker_blending:t.getInteger("core.map.marker.blending",THREE.SubtractiveBlending),draw_current_marker:!1})),p.addToScene(i.create(p,p.scene,{distance_threshold:200,show_floor:!1})),p.addToScene(a.create(p,p.scene)),p.addToScene(e.create(p,p.scene,p.currViewingDir)),p.addToScene(s.create(p,p.scene,{visualization:"2d"})),p.addToScene(o.create(p,p.scene,{distance_threshold:2e3,hide_unimportant:!0,poi_names_config:"poi.names.map"}));var r=t.getInteger("core.map.bg",4294967295);p.renderer.setClearColor(r>>8,(255&r)/255);var l=t.getFloat("core.map.angle",0)/180*Math.PI;f.up.set(Math.sin(l),Math.cos(l),0)};this.getCamera=function(){return f},this.getViewport=function(e,t){return h},this.onZoomView=function(e,t,n,a,i){p.cameraZoomAndTranslate(t,n,1.5,2e6,e,a),updateOrthographicCamera(f,p.divContainer),i||(c.triggerEvent("zoomedMap"),invalidateAngular(),p.invalidateScene())},this.zoomView=function(e,t,n,a){if(!e){var i=p.renderer.getSize();e={x:i.width/2,y:i.height/2}}var o={value:0},r=new TWEEN.Tween(o).to({value:t},void 0!==a?a:v).easing(TWEEN.Easing.Cubic.EaseInOut).onUpdate(function(){p.onZoomView(void 0,o.value,n,e,!0)}).onComplete(function(){c.triggerEvent("zoomedMap"),p.forgetTween(r)}).start();p.watchTween(r)},this.onDragViewStart=function(e,t){return 0==t&&("map"!=l.config.main_scene&&this.enableInsetViewHover(!0),!0)},this.onDragView=function(e,t,n){var a=p.divContainer.getCurrentWidth(),i=p.divContainer.getCurrentHeight();translateCamera(a,i,e,t,f),p.invalidateScene()},this.onDragViewEnd=function(){"map"!=l.config.main_scene&&this.enableInsetViewHover(!1)},this.viewAngleToPixels=function(){return 5},this.refreshCameras=function(e){if(f instanceof THREE.PerspectiveCamera){var t=Math.PI/2-e.lat,n=e.lon,a=new THREE.Vector3(f.position.x+Math.sin(t)*Math.cos(n),f.position.z+Math.cos(t),f.position.y+Math.sin(t)*Math.sin(n));f.lookAt(a);var i=p.divContainer.getAspectRatio();f.projectionMatrix=new THREE.Matrix4,f.projectionMatrix.makePerspective(f.fov,i,f.near,f.far)}else if(f instanceof THREE.OrthographicCamera){var a=f.position.clone();a.add(b),f.lookAt(a)}},this.renderViews=function(e,t){updateOrthographicCamera(f,p.divContainer),p.renderer.setSize(p.divContainer.getCurrentWidth(),p.divContainer.getCurrentHeight()),p.beforeRenderViewports(p.getViewport()),p.renderer.render(p.scene,f),p.afterRenderViewports(p.getViewport())},this.moveMap=function(e,t,n){n&&(_.slice().forEach(function(e){e.update(1/0),e.stop()}),_.length&&console.error("Tweens array not empty"));var a=new TWEEN.Tween(p.getCamera().position).to({x:e.x,y:e.y,z:y},void 0!==t?t:m).easing(TWEEN.Easing.Linear.EaseNone).onComplete(function(){p.forgetTween(a),_.splice(_.indexOf(a),1)}).start();p.watchTween(a),_.push(a)};var E=function(e){l.mapVisibility()&&e.image&&(g=e.image?e.image.floor_location_.z:void 0,p.moveMap(e.image.location_,e.duration))},M=function(e){e.floor.image&&(g=e.floor.image.floor_location_.z)};this.onClick=function(e,t){var n=10,a=2,i=p.getImage();if(i){var o=p.getPositionOnGroundPlane(e.x,e.y,g,t),r=u.getClosestImage(i,o,a);!c.isMoving()&&r.image&&r.distance<n&&c.moveToLocation(r.image)}},this.onDoubleClick=function(e,t){p.zoomView(e,-1,!1,200)},w(),t.initialized.then(function(){S()})}p.prototype=Object.create(AbstractView.prototype),this.create=function(e){return new p(e)}}]),IndoorViewerWebApp.service("AlignmentHelpersFactory",["CameraAndViewportService","IV","ModeService","CameraFOVLayerFactory",function(e,t,n,a){return window.IV.layers.AlignmentHelpers=function(i,o){var r,s,l,c,d,u,g,p,m,v,f=!1,h=new THREE.Object3D,b=new THREE.Object3D,y=new THREE.Object3D,_=new THREE.Object3D,w=new THREE.Object3D,S=15,E=e.alignmentHelpers,M=new THREE.Vector3(0,0,0),C=new THREE.Vector3((-1),0,0),T=new THREE.Vector3(0,1,0),k=new THREE.Vector3(0,(-1),0),x=new THREE.Vector3(0,0,1),I=new THREE.Vector3(0,0,(-1)),O=2,P=.1,R=function(e,t){return new THREE.MeshBasicMaterial({color:e,side:THREE.DoubleSide,opacity:t,transparent:!0,blending:THREE.AdditiveBlending})},V=function(e,t){e.userData.is2D=!0,e.renderOrder=1/0},A=function(e,t,n,a){var i=new THREE.PlaneGeometry(n,a),o=new THREE.Mesh(i,t);return V(o,t),o.name=e,o},L=function(e,t){var n=new THREE.Geometry,a=new THREE.Vector3(10,0,0),i=new THREE.Vector3((-10),0,0),o=new THREE.Vector3(0,10,0);n.vertices.push(a),n.vertices.push(i),n.vertices.push(o),n.faces.push(new THREE.Face3(0,2,1));var r=new THREE.Mesh(n,t);return V(r,t),r.name=e,r},D=function(){var e=new THREE.MeshBasicMaterial({opacity:.8,transparent:!0,blending:THREE.AdditiveBlending,vertexColors:THREE.VertexColors}),t=new THREE.Mesh(a.getConeGeometry([65433,39219,39219],S),e);return V(t,e),t},N=function(){var e=R(n.modes.datasetAlignment.viewports[2].color,.5);r=A("SV1 Plane",e,1,1);var e=R(n.modes.datasetAlignment.viewports[2].color,.3);s=L("SV1 Triangle",e),h.add(r),h.add(s);var e=R(n.modes.datasetAlignment.viewports[3].color,.6);l=A("SV2 Plane",e,1,1);var e=R(n.modes.datasetAlignment.viewports[3].color,.4);c=L("SV2 Triangle",e),b.add(l),b.add(c);var e=R(n.modes.datasetAlignment.viewports[1].color,.6);u=A("TV1 Plane",e,1,1),p=A("TV2 Plane",e,1,1);var e=R(n.modes.datasetAlignment.viewports[1].color,.4);g=L("TV1 Triangle",e),m=L("TV2 Triangle",e),_.add(u),_.add(g),w.add(p),w.add(m),d=D(),y.add(d)};this.onKeyPress=function(e){var t=String.fromCharCode(e.charCode).toLowerCase();if("z"===t||"y"===t)return E.TVCamera.visibility=!E.TVCamera.visibility,!0;if("x"===t)return E.SVCamera2.visibility=!E.SVCamera2.visibility,!0;if("c"===t)return E.SVCamera1.visibility=!E.SVCamera1.visibility,!0;if("v"===t)return E.defaultCamera.visibility=!E.defaultCamera.visibility,!0;if("b"===t){var n=!0;return n=!(E.defaultCamera.visibility&&E.SVCamera1.visibility&&E.SVCamera2.visibility&&E.TVCamera.visibility),E.defaultCamera.visibility=E.SVCamera1.visibility=E.SVCamera2.visibility=E.TVCamera.visibility=n,!0}return!1};var G=function(){e.registerUpdateCallback("AlignmentHelpers",function(){G(),i.invalidateScene()});var t=function(e,t,n,a){var i=new THREE.Matrix4;i.getInverse(t);var o=new THREE.Matrix4,r=new THREE.Matrix4,s=e;o.multiplyMatrices(i,s);var l=(new THREE.Vector3).setFromMatrixPosition(o);if(a)var c=a-n<O+P?P:O;else var c=P;var d=(n+c+l.z)/-1,u=l.addScaledVector(x,d);return o.setPosition(u),r.multiplyMatrices(t,o),r},n=function(n,i,o){var r=e.getViewportByName(n),s=e.getViewportByName(o);r.camera.updateMatrixWorld(),i.updateMatrixWorld(),a.updateMeshState(i,e.getDefaultViewport(),S),i.position.setFromMatrixPosition(t(r.camera.matrixWorld,s.camera.matrixWorld,s.camera.near)),i.onMouseOver||U(e.getViewportByName(n),void 0,i,o)},v=function(n,a,i,o){var r=e.getViewportByName(n),s=getTarget(r.camera).normalize(),l=e.getViewportByName(o);getTarget(l.camera).normalize();r.camera.updateMatrixWorld(),a.updateMatrixWorld(),i.updateMatrixWorld(),i.scale.copy(M).addScaledVector(T,r.camera.far-r.camera.near).addScaledVector(C,e.getWidthInMeters(r)).addScaledVector(x,1),a.position.setFromMatrixPosition(t(r.camera.matrixWorld,l.camera.matrixWorld,l.camera.near,l.camera.far)),i.position.copy(a.position).addScaledVector(s,r.camera.near+(r.camera.far-r.camera.near)/2),"TVCamera"===r.name?(a.quaternion.copy(l.camera.quaternion),i.quaternion.copy(l.camera.quaternion)):(a.quaternion.copy(r.camera.quaternion).multiply((new THREE.Quaternion).setFromUnitVectors(I,T)),i.quaternion.copy(a.quaternion)),a.onMouseOver||U(n,i,a,o)};E.TVCamera.visibility?(z(_,o),v("TVCamera",g,u,"SVCamera1"),z(w,o),v("TVCamera",m,p,"SVCamera2")):(o.remove(_),o.remove(w)),E.SVCamera1.visibility?(z(h,o),v("SVCamera1",s,r,"TVCamera")):o.remove(h),E.SVCamera2.visibility?(z(b,o),v("SVCamera2",c,l,"TVCamera")):o.remove(b),E.defaultCamera.visibility?(z(y,o),n("defaultCamera",d,"TVCamera")):o.remove(y)},U=function(n,a,o,r){o.onMouseOver=function(t,a){var o=e.getViewportByName(n);return a.name===r&&(1644825===o.bgColor&&(o.bgColor=2500134,i.invalidateScene()),!0)},o.onMouseOut=function(t,a){var o=e.getViewportByName(n);a.name===r&&1644825!=o.bgColor&&(o.bgColor=1644825,i.invalidateScene())},o.onMouseWheel=function(t,a){var o=e.getViewportByName(n);if(i.getViewport(t.x,t.y).name===r){var s=o.camera;if("defaultCamera"!==s.name){a=-a;var l=s.far-s.near;a*=a>0?l<O?P:O:l<O+1?P:O;var c=e.incFar(o,a);if(c){var d=getTarget(s).normalize();s.position.addScaledVector(d,-a/2)}}return!0}return!1},o.onDragStart=function(e,t){return t.name===r&&(v=i.unprojectScreenCoordinates(e.x,e.y,1,t),!0)},o.onDrag=function(r,s){var l=e.getViewportByName(n),c=i.unprojectScreenCoordinates(r.x,r.y,1,s),d=l.camera;if(i.isKeyPressed(KeyEvent.DOM_VK_SHIFT)){var u=H(c,v,o.position);if("defaultCamera"===d.name){var g=t.getMainView().currViewingDir;g.lon-=u,t.getMainView().updateOrientation(g)}else l.rotation_enabled&&d.rotateOnAxis(k,u);
}if(!i.isKeyPressed(KeyEvent.DOM_VK_SHIFT)){var p=(new THREE.Vector3).subVectors(c,v);a&&a.position.add(p),d.position.add(p)}v=c,i.invalidateScene()},a&&(a.onMouseOver=o.onMouseOver,a.onMouseOut=o.onMouseOut,a.onDragStart=o.onDragStart,a.onDrag=o.onDrag,a.onMouseWheel=o.onMouseWheel)},F=function(e,t){e.traverse(function(e){e.visible=t})};this.onBeforeRenderViewport=function(e){f||("TVCamera"===e.name?(F(h,!0),F(b,!0),F(y,!0)):(F(h,!1),F(b,!1),F(y,!1)),"SVCamera2"===e.name?F(w,!0):F(w,!1),"SVCamera1"===e.name?F(_,!0):F(_,!1))},this.onBeforeRender=function(){"datasetAlignment"===n.modes.currentMode&&G()};var H=function(e,t,n){if(void 0!==n&&void 0!==n.x&&void 0!==n.y){var a=new THREE.Vector3;a.subVectors(e,n);var i=new THREE.Vector3;i.subVectors(t,n)}else var a=e,i=t;var o=Math.atan2(a.y,a.x),r=Math.atan2(i.y,i.x);return r-o},z=function(e,t){var n=t.getObjectById(e.id);n||t.add(e)};N()},{create:function(e,t,n){return new window.IV.layers.AlignmentHelpers(e,t,n)}}}]),IndoorViewerWebApp.service("BuildingAlignmentLayerFactory",["ConfigService","PolygonDrawingService","GeoTransformationService","$q","DatasetAlignmentService","PointCloudMenuService",function(e,t,n,a,i,o){return window.IV.layers.BuildingAlignmentLayer=function(r,s){var l=this,c=void 0,d=!1,u=function(){d=!0,s.add(c)},g=function(){d=!1,s.remove(c)},p=function(){m()},m=function(){s.remove(c),c=new THREE.Object3D,a.all([e.initialized,n.initialized,t.fetchPolygons()]).then(function(e){var n=t.polygons;n=n.filter(function(e){return"floor"===e.type});for(var a=Object.keys(i.COLOR_DEFS),o=a.length,r=0;r<n.length;r++){var l=n[r],u=i.COLOR_DEFS[a[3*r%o]].rgb_color,g="0x";g+=Math.floor(128*(u.x+.5)).toString(16),g+=Math.floor(128*(u.y+.5)).toString(16),g+=Math.floor(128*(u.z+.5)).toString(16),l.color=parseInt(g)}n.map(f),d===!0&&s.add(c)})},v={},f=function(e){var a=[];e.polygon.map(function(t){var i=n.toLocal(t.lon,t.lat,e.z_min);a.push(new THREE.Vector2(i.x,i.y))}),a.pop();var i=new THREE.Shape(a),o=e.z_max-e.z_min;(o<1||isNaN(o))&&(o=10);var r=new THREE.ExtrudeGeometry(i,{amount:o,bevelEnabled:!1}),s=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:e.color,transparent:!0,opacity:.4}));s.position.set(0,0,e.z_min),s.onClick=function(){return t.activePolygon(e),!0},c.add(s),v[e.id]=s};t.registerUpdateCallback(l.unique_id,function(e){if("z"===e){var n=t.activePolygon();c.remove(v[n.id]),f(n)}"refresh polygons"===e&&m()}),o.registerUpdateCallback(l.unique_id,function(e,t){switch(e){case"showFloors":u();break;case"hideFloors":g()}r.invalidateScene()}),p()},{create:function(e,t,n){return new window.IV.layers.BuildingAlignmentLayer(e,t,n)}}}]),IndoorViewerWebApp.service("CameraFOVLayerFactory",["CameraAndViewportService","ConfigService","IV",function(e,t,n){var a=new THREE.Euler,i=5,o=3185610,r=[12303291,16777215,16777215],s=THREE.MultiplyBlending,l=function(e,t){t=t||i,1===e.length&&(e[1]=0,e[2]=0);var n=new THREE.Geometry,a=new THREE.Vector3(0,0,0),o=1,r=t*Math.tan(o/2),s=new THREE.Vector3(r,t,0),l=new THREE.Vector3((-r),t,0);return n.vertices.push(a),n.vertices.push(s),n.vertices.push(l),n.faces.push(new THREE.Face3(0,1,2)),n.computeFaceNormals(),n.faces[0].vertexColors[0]=new THREE.Color(e[0]),n.faces[0].vertexColors[1]=new THREE.Color(e[1]),n.faces[0].vertexColors[2]=new THREE.Color(e[2]),n},c=function(e,t){var n=new THREE.MeshBasicMaterial({transparent:!0,blending:e,vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1}),a=THREE_IV.ImageUtils.loadTexture("img/circle.png"),i=new THREE.MeshBasicMaterial({color:o,opacity:.7,side:THREE.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,map:a}),r=new THREE.Mesh(l(t.constructor===Array?t:[t]),n);r.renderOrder=1/0,r.name="cone";var s=new THREE.Mesh(new THREE.CircleGeometry(.5,12),i);s.renderOrder=1/0,s.name="position";var c=new THREE.Object3D;return c.add(r),c.add(s),c},d=function(e,t,n){n=n||i;var o=t.getCamera();e.position.copy(o.position),e.position.z=0,a.setFromQuaternion(o.quaternion,"ZYX"),e.rotation.z=a.z;var r=e.getObjectByName("cone")||e,s=t.getFOV()/180*Math.PI;r.geometry.vertices[1].x=n*Math.sin(s/2),r.geometry.vertices[2].x=-n*Math.sin(s/2),r.geometry.verticesNeedUpdate=!0};return window.IV.layers.CameraFOVLayer=function(n,a){var i=new THREE.Object3D;i.name="CameraFOVLayer";var o=null,l=function(){var e=t.getInteger("core.map.fov.blending"),n=t.getInteger("core.map.fov.color");void 0===e&&void 0===n?(e=s,n=r):void 0===e?e=THREE.SubtractiveBlending:void 0===n&&(n=12109260),e==THREE.SubtractiveBlending&&(n=16777215-n),o=c(e,n),a.add(o),a.add(i)};this.onBeforeRender=function(t){d(o,e.getDefaultViewport())},this.onBeforeRenderViewport=function(e){setMeshScreenSize(e,o.children[1],12,!1,!0)},t.initialized.then(function(){l()})},{create:function(e,t,n){return new window.IV.layers.CameraFOVLayer(e,t,n)},getConeGeometry:function(e,t){return l(e,t)},updateMeshState:function(e,t,n){return d(e,t,n)}}}]),IndoorViewerWebApp.service("CameraImageLayerFactory",["gettextCatalog","ViewMenuService","CameraHeadService","ConfigService","ModeService","MessageReportingService",function(e,t,n,a,i,o){return window.IV.layers.CameraImageLayer=function(r,s,l){function c(e){var t=Math.floor(Math.log(e.resolutions)/Math.log(2));return null!==y&&isMobileBrowser()&&(t=Math.min(t,y)),t}var d=this,u=null,g=function(){return{meshes:[],resolutions:[],resolutions_queued:[],image:null,head:null}},p=g(),m=g(),v=1,f=60,h=!1,b=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(2105376)),y=a.getInteger("layers.panoramas.mobile_max_res",null);this.onTransitionStart=function(e,a,i){if(!e)return void d.deleteCurrentImageSet();var o=function(e,t){n.heads.$promise.then(function(){var a=n.headsIdMap[e.camera_head];return n.headDataLoaded(a)?void _(e,t):void n.fetchHeadData(a,function(){_(e,t)},function(){r.invalidateScene()})})};t.registerUpdateCallback(d.unique_id,function(n){void 0!=n&&t.config.showPanoramas==n.showPanoramas||(t.config.showPanoramas?o(e,i):d.deleteCurrentImageSet())}),t.config.showPanoramas&&(o(e,i),h=!0)};var _=function(e,t){var a=n.headsIdMap[e.camera_head],i=t.viewDistance<.9*r.getCamera().far?t.viewDistance:.9*r.getCamera().far;if(u||(u=new THREE.Object3D,u.name="CameraImageLayer",s.add(u)),p.meshes.length>0&&(x(m.meshes),m=p),E(e,a,i),m.meshes.length>0)var o=w(m.meshes[0].geometry,i);m.image!==e&&angular.forEach(m.meshes,function(e){I(e,0,1e3*v,1e3*v),e.scale.copy(o)}),angular.forEach(p.meshes,function(e){I(e,1,1e3*v,1e3*v)})},w=function(e,t){var n=e.attributes.position.array[0],a=e.attributes.position.array[1],i=e.attributes.position.array[2],o=Math.sqrt(n*n+a*a+i*i),r=t/o;return new THREE.Vector3(r,r,r)};this.onTransitionEnd=function(e){h=!1,m.meshes.length>0&&(x(m.meshes),m=g()),r.invalidateScene()},this.onAfterRender=function(e){h||S(e)};var S=function(e){var t=new THREE.Frustum;t.setFromMatrix((new THREE.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse));for(var n=[],a=0;a<p.meshes.length;a++)t.intersectsObject(p.meshes[a])&&n.push(a);n.length>0&&M(p.image,p.head,!0,O,n)};this.deleteCurrentImageSet=function(){x(p.meshes),p=g(),r.invalidateScene()};var E=function(e,t,n){p=g(),p.image=e,p.head=t;var a=M(e,t,!1,O),i=w(t.meshes_geometry[0],n);angular.forEach(t.meshes_geometry,function(n,a){var o=k(e,n,t.alpha_masks_texture[a],a,e.location_,e.orientation_,!0,"+"==t.blending?THREE.AdditiveBlending:THREE.NormalBlending,i);p.meshes.push(o)}),angular.forEach(a,function(e){u.add(p.meshes[e.index])})},M=function(e,t,n,a,i){var o=new THREE.Vector3(0,0,(-1));o.transformDirection(r.getCamera().matrixWorld);var s=(new THREE.Quaternion).copy(e.orientation_).inverse().normalize();o.applyQuaternion(s);var l=new Array;if(n){var d=c(t),u=r.getCamera().fov*r.getCamera().aspect;u>f&&d>0&&(isMobileBrowser()||C(l,e,t,d,o,i),d--),C(l,e,t,d,o,i)}else C(l,e,t,0,o,i);return l.sort(function(e,t){return e.resolution!=t.resolution?e.resolution-t.resolution:e.dist-t.dist}),angular.forEach(l,function(n){var i=T(e,n.index,n.resolution,t);p.resolutions_queued[n.index]=n.resolution,THREE_IV.ImageUtils.loadTexture(i,{},function(e){a(n,e)})}),l},C=function(e,t,n,a,i,o){angular.forEach(n.meshes_geometry,function(n,r){if(!(o&&o.indexOf(r)<0||r in p.resolutions&&p.resolutions[r]>=a||r in p.resolutions_queued&&p.resolutions_queued[r]>=a)){var s=n.boundingBox,l=new THREE.Vector3((s.min.x+s.max.x)/2,(s.min.y+s.max.y)/2,(s.min.z+s.max.z)/2),c=Math.abs(l.angleTo(i));e.push({dist:c,index:r,image:t,resolution:a})}})},T=function(e,t,n,a){var i=a.tiles>0?Math.floor(t/a.tiles):0,o=a.tiles>0?t%a.tiles:0;return e.file_path+"/"+a.fn_format.replace(/\$ID100/g,e.file_id/100|0).replace(/\$ID/g,e.file_id).replace(/\$INDEX/g,t).replace(/\$CAM/g,i).replace(/\$RES/g,n).replace(/\$TILE/g,("00"+o).slice(-2))},k=function(e,t,n,a,i,o,r,s,l){var c=new THREE.Mesh(t);return c.position.copy(i),c.quaternion.copy(o),c.scale.copy(l),c.renderOrder=-(1e6-a-Math.random()),c.name="cam-"+e.file_path+"-"+e.file_id+"-"+a,c.material=new THREE.MeshBasicMaterial({map:b,transparent:void 0==r||r,depthWrite:!1,depthTest:!1,opacity:0,wireframe:!1,blending:s}),n&&(c.material.alphaMap=n),c},x=function(e){if(e)for(var t in e){var n=e[t];void 0!=n.material&&void 0!=n.material.map&&n.material.map!=b&&n.material.map.dispose(),u.remove(n)}},I=function(e,t,n,a){var i=new TWEEN.Tween(e.material).to({opacity:t},void 0==n?2e3:n).easing(TWEEN.Easing.Cubic.EaseInOut).delay(void 0==a?0:a).onComplete(function(){r.forgetTween(i)}).start();r.watchTween(i)},O=function(e,t){if(p.image!==e.image)return void t.dispose();if(void 0===p.resolutions[e.index])p.meshes[e.index].material.map=t,p.resolutions[e.index]=e.resolution,r.invalidateScene();else{var n=p.resolutions[e.index],a=e.resolution;n<a?(p.meshes[e.index].material.map.dispose(),p.meshes[e.index].material.map=t,p.resolutions[e.index]=a,r.invalidateScene()):t.dispose()}};this.onContextMenu=function(t){if("normal"===i.modes.currentMode&&r.currentImage&&r.currentImage.security_.can_write)return r.currentImage.hidden?{name:e.getString("Unhide current location"),icon:"paste",callback:function(t,n){r.currentImage.hidden=!1,r.currentImage.$update(function(){},function(){r.currentImage.hidden=!0,o.showMessage(e.getString("Update failed"),e.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))})}}:{name:e.getString("Hide current location"),icon:"cut",callback:function(t,n){r.currentImage.hidden=!0,r.currentImage.$update(function(){},function(){r.currentImage.hidden=!1,o.showMessage(e.getString("Update failed"),e.getString("Updating changes to server over REST interface failed. Reverting local changes to match server."))})}}}},{create:function(e,t,n){return new window.IV.layers.CameraImageLayer(e,t,n)}}}]),IndoorViewerWebApp.service("CursorLayerFactory",["CursorService","RaycastService",function(e,t){return window.IV.layers.CursorLayer=function(n,a,i){var o,r=this,s=!1,l=void 0;r.visible=!0,i=i||{},i.cursor_max_px_size=i.cursor_max_px_size||50;var c=function(){var e=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,opacity:.3,transparent:!0,depthTest:!1,depthWrite:!1}),t=new THREE.Matrix4;t.makeRotationFromEuler(new THREE.Euler(Math.PI/2,0,0));var n=new THREE.CylinderGeometry(.15,.15,.01,24);n.applyMatrix(t),o=new THREE.Mesh(n,e),o.name="picked_point",o.visible=!1,d(),a.add(o)},d=function(e){"architect"==e?(o.scale.set(1/3,1/3,1/3),o.material.color=new THREE.Color(3381708),o.material.opacity=.25):(o.scale.set(1,1,1),o.material.color=new THREE.Color(16777215),o.material.opacity=.3)};this.onMouseMove=function(e){l=n.unprojectScreenCoordinates(e.x,e.y),s||u()},this.onClick=function(t){return e.onClick(),!1},this.setVisibility=function(e){r.visible=e,o.visible=e,n.invalidateScene()},this.onBeforeRender=function(e){l&&!s&&u()},this.onBeforeRenderViewport=function(e){setMeshScreenSize(e,o,i.cursor_max_px_size,!0)};var u=function(){if(l&&r.visible){var a=l;s=!0,l=void 0,t.getCoordinates(n,a,function(t,a,i,l,c,d){var u=0!=a.length()?t.clone().add(a):i.clone();o.position.copy(t),o.lookAt(u),o.visible=r.visible,n.invalidateScene(),s=!1,e.updateCursor(t,a,l,c,d)},function(){o&&o.visible&&(o.visible=!1,n.invalidateScene()),s=!1})}};c()},{create:function(e,t,n){return new window.IV.layers.CursorLayer(e,t,n)}}}]),IndoorViewerWebApp.service("LocationMarkerLayerFactory",["ImageService","ViewMenuService","IV",function(e,t,n){return window.IV.layers.LocationMarkerLayer=function(a,i,o){var r=this,s=null,l=null,c=[],d=null,u=null,g=null,p=!1,m=null;o=o||{},o.distance_threshold=o.distance_threshold||20,o.distance_threshold_z=o.distance_threshold_z||2,o.circle_segments=o.circle_segments||12,o.move_to_show=void 0===o.move_to_show||o.move_to_show,o.hide_markers_timeout=o.hide_markers_timeout||3e3,o.marker_color=void 0!==o.marker_color?o.marker_color:16777215,o.marker_current_color=void 0!==o.marker_current_color?o.marker_current_color:3185610,o.marker_opacity=o.marker_opacity||.3,o.marker_current_opacity=o.marker_current_opacity||.6,o.marker_highlight_opacity=o.marker_highlight_opacity||.7,o.blending=void 0!==o.blending?o.blending:THREE.NormalBlending,o.draw_current_marker=void 0===o.draw_current_marker||o.draw_current_marker;var v=function(){n.addEventListener("floorChanged",f)},f=function(e){e.floor.image&&h(e.floor.image,e.filtered)};this.onTransitionEnd=function(n){n&&(e.registerUpdateCallback(r.unique_id,function(e){r.onTransitionEnd(n)}),t.registerUpdateCallback(r.unique_id,function(e,t){e.showLocationMarkers===!0&&t.showLocationMarkers===!1?(l&&(i.remove(l),l=void 0),a.invalidateScene()):e.showLocationMarkers===!1&&t.showLocationMarkers===!0&&r.onTransitionEnd(n)}),h(n,!0))};var h=function(e,n){l&&(i.remove(l),l=void 0),l=new THREE.Object3D,l.name="locations",i.add(l),l.visible=!0,t.config.showLocationMarkers===!0&&(_(e,l,n),a.invalidateScene())},b=function(){s=new THREE.CircleGeometry(.5,o.circle_segments)},y=function(){var e=THREE_IV.ImageUtils.loadTexture("img/circle.png");d=w(o.marker_color,0,e),g=w(o.marker_current_color,o.marker_current_opacity,e),u=w(o.marker_color,o.marker_highlight_opacity,THREE_IV.ImageUtils.loadTexture("img/arrow.png"))},_=function(t,i,r){for(var l=Math.pow(o.distance_threshold,2),c=e.getRelatedImages(t,l,o.distance_threshold_z),p=0;p<c.length;p++)if(t!=c[p]||o.draw_current_marker){var m=r&&t==c[p]?g:d,v=new THREE.Mesh(s,m);v.name="location",i.add(v),v.userData={image:c[p]},v.position.copy(c[p].floor_location_),v.quaternion.copy(c[p].orientation_),t!=c[p]&&(v.onClick=function(){var e=this.userData.image;return n.isMoving()||n.moveToLocation(e),!0},v.onMouseOver=function(e,t){if(this.material!==g&&a.getImage()){this.material=u;var n=(new THREE.Vector3).subVectors(this.position,a.getImage().location_),i=Math.atan2(n.y,n.x);this.rotation.set(0,0,i-Math.PI/2),a.invalidateScene()}},v.onMouseOut=function(){this.material=t==this.userData.image?g:d,this.quaternion.copy(this.userData.image.orientation_),a.invalidateScene()})}},w=function(e,t,n){var a=c[[e,t]];return a||(o.blending==THREE.SubtractiveBlending&&(e=16777215-e),a=new THREE.MeshBasicMaterial({color:e,opacity:t,side:THREE.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,map:n,blending:o.blending}),c[[e,t]]=a),a};this.onMouseMoveOnGroundPlane=function(e){o.move_to_show&&S(e)},this.onClick=function(e){return o.move_to_show||p||S(e),!1};var S=function(e){if(p)return void E();var t=new TWEEN.Tween(d).to({opacity:o.marker_opacity},300).easing(TWEEN.Easing.Linear.EaseNone).onComplete(function(){a.forgetTween(t),E()}).start();a.watchTween(t),p=!0},E=function(){m&&clearTimeout(m),m=setTimeout(M,o.hide_markers_timeout)},M=function(){var e=new TWEEN.Tween(d).to({opacity:0},300).easing(TWEEN.Easing.Linear.EaseNone).onComplete(function(){a.forgetTween(e),p=!1}).start();a.watchTween(e)};v(),b(),y()},{create:function(e,t,n){return new window.IV.layers.LocationMarkerLayer(e,t,n)}}}]),IndoorViewerWebApp.service("MapImageLayerFactory",["$http","MapMeshService","ViewMenuService","GeoTransformationService","IV","MapAttributionsService","ConfigService",function(e,t,n,a,i,o,r){return window.IV.layers.MapImageLayer=function(s,l,c){var d=this,u=null,g=null,p=null,m=null,v=new THREE.Frustum,f=[],h=null,b=0,y={},_=2,w=1,S=null;c=c||{};var E=function(){i.addEventListener("transitionStart",C),i.addEventListener("floorChanged",T),g=new THREE.PlaneGeometry(1,1),p=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!0,opacity:0,side:THREE.DoubleSide}),m=p.clone(),m.color=new THREE.Color(3355443),m.opacity=1,t.registerUpdateCallback(d.unique_id,function(){if(t.redraw_map_images){for(var e=0;e<t.map_meshes.length;e++)F(t.map_meshes[e]);t.redraw_map_images=!1}s.invalidateScene()}),n.registerUpdateCallback(d.unique_id,function(){n.mapVisibility()&&s.invalidateScene()}),a.initialized.then(M),a.registerUpdateCallback(d.unique_id,function(){var e=[];angular.forEach(f,function(t){var n=t.own_method;n&&(d.removeMapLayer(t),e.push(n()))}),angular.forEach(e,function(e){d.addMapLayer(e)})})},M=function(){r.initialized.then(function(){"osm"===r.getString("core.map.basemap")&&d.addMapLayer(d.createOSM())})};this.addMapLayer=function(e){e.root={children:[]},e.obj_group?(e.obj_group.position.copy(e.obj_group.position),e.offset=e.obj_group.position.clone().divide(e.obj_group.scale).applyQuaternion(e.obj_group.quaternion.clone().inverse()),e.obj_group.position.set(0,0,0)):e.obj_group=new THREE.Object3D,e.offset||(e.offset=new THREE.Vector3),e.obj_group.updateMatrixWorld(!0),e.cross_origin?(e.image_utils=angular.copy(THREE_IV.ImageUtils),e.image_utils.crossOrigin=e.cross_origin):e.image_utils=THREE_IV.ImageUtils,e.obj_group_added=!1,f.push(e),s.invalidateScene()},this.removeMapLayer=function(e){var t=f.indexOf(e);t>=0&&(A(e),f.splice(t,1),s.invalidateScene())},this.onContextMenu=function(e){return!1},this.onBeforeRender=function(e){if(!n.mapVisibility()&&u){for(var t in f)A(f[t]);l.remove(u),u=void 0}};var C=function(e){S=e.image?e.image.floor_location_.z:null,s.invalidateScene()},T=function(e){e.floor.image&&(S=e.floor.image.floor_location_.z,s.invalidateScene())};this.onAfterRender=function(e){n.mapVisibility()&&(h||b||(h=window.setTimeout(function(){k(e)},100)))};var k=function(e){h=null,u||(u=new THREE.Object3D,u.name="map_images",l.add(u)),G();var t=e.projectionMatrix.clone(),n=1.5;t.elements[0]/=n,t.elements[5]/=n,v.setFromMatrix((new THREE.Matrix4).multiplyMatrices(t,e.matrixWorldInverse));for(var a in f)x(e,f[a]);I(f)},x=function(e,t){if(O(t,new THREE.Vector3(0,0,0),t.tile_size_metric)){var n=new THREE.Vector3(t.tile_size_metric*-.5,0,0);n.applyMatrix4(t.obj_group.matrixWorld),n.project(e);var a=new THREE.Vector3(.5*t.tile_size_metric,0,0);a.applyMatrix4(t.obj_group.matrixWorld),a.project(e);var i=s.getViewport(),o=i.getWidth(),r=i.getHeight();if(o<=0||r<=0||isNaN(n.x)||isNaN(a.x))return;n.sub(a),n.x*=o/2,n.y*=r/2;var l=t.tile_size_px/n.length(),c=void 0===t.bias?0:t.bias,d=Math.ceil(-Math.log(l)/Math.log(2)-c);d=Math.max(d,0),d=Math.min(d,void 0===t.max_depth?1/0:t.max_depth),t.obj_group_added||(u.add(t.obj_group),t.obj_group_added=!0),R(t,t.root,d,t.tile_size_metric,0,0,"")}else A(t)},I=function(e){var t={};for(var n in f){var e=f[n];if(e.getAttributions)for(var n=0;n<e.obj_group.children.length;n++){var a=e.obj_group.children[n].userData.node;e.getAttributions(a,t)}}var i=[];for(var n in t)i.push({attribution:n,score:t[n].score});i.sort(function(e,t){return t.score-e.score});var r=i.map(function(e){return e.attribution}).join(", ");o.share.attributions=r},O=function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(n,a,i){var o=.5*i;return e.makeEmpty(),t.set(a.x-o,a.y-o,a.z).add(n.offset).applyMatrix4(n.obj_group.matrixWorld),e.expandByPoint(t),t.set(a.x-o,a.y+o,a.z).add(n.offset).applyMatrix4(n.obj_group.matrixWorld),e.expandByPoint(t),t.set(a.x+o,a.y-o,a.z).add(n.offset).applyMatrix4(n.obj_group.matrixWorld),e.expandByPoint(t),t.set(a.x+o,a.y+o,a.z).add(n.offset).applyMatrix4(n.obj_group.matrixWorld),e.expandByPoint(t),v.intersectsBox(e)}}(),P=new THREE.Vector3,R=function(e,t,n,a,i,o,r){if(0==n)return t.mesh||V(e,t,a,i,o),t.mesh_added||(e.obj_group.add(t.mesh),t.mesh.userData={node:t},t.mesh_added=!0),t.texture_loaded&&L(e,t),t.texture_loaded;for(var s=!0,l=[a*-.25,.25*a,a*-.25,.25*a],c=[.25*a,.25*a,a*-.25,a*-.25],d=0;d<4;d++){var u=i+l[d],g=o+c[d];P.set(u,g,0);var p=r+d;e.tile_present&&!e.tile_present[p]||(O(e,P,.5*a)?(t.children[d]||(t.children[d]={children:[]}),s&=R(e,t.children[d],n-1,.5*a,u,g,p)):t.children[d]&&(D(e,t.children[d]),L(e,t.children[d]),t.children[d]=void 0))}return s&&D(e,t),s},V=function(e,t,n,a,i){t.mesh=new THREE.Mesh(g,p),t.mesh.scale.set(n,n,1),t.mesh.position.x=a,t.mesh.position.y=i,t.texture_loaded=!1;var o=e.tile_size_metric/n,r=Math.log(o)/Math.log(2),l=a/n+.5*(o-1),c=-i/n+.5*(o-1),d=e.getTileURL(Math.round(r),Math.round(l),Math.round(c));t.depth=r,t.mesh.position.add(e.offset),t.mesh.renderOrder=-(1e6-r-100*(e.z_index||0)),t.mesh.material=t.mesh.material.clone(),t.mesh.material.map=e.image_utils.loadTexture(d,void 0,function(e){t.mesh?(t.texture_loaded=!0,t.mesh.material.opacity=1,s.invalidateScene()):e.dispose(),b--},function(){t.texture_loaded=!0,t.mesh.material=m,s.invalidateScene(),b--}),t.mesh.material.map.anisotropy=0,t.mesh.material.map.generateMipmaps=!1,t.mesh.material.map.minFilter=THREE.LinearFilter,t.mesh.material.map.magFilter=THREE.LinearFilter,b++},A=function(e){D(e,e.root),L(e,e.root),e.obj_group_added&&(e.obj_group.remove(e.obj_group),e.obj_group_added=!1)},L=function(e,t){for(var n in t.children){var a=t.children[n];a&&(D(e,a),L(e,a))}t.children=[]},D=function(e,t){t.mesh&&(e.obj_group.remove(t.mesh),t.texture_loaded&&t.mesh.material.map&&t.mesh.material.map.dispose()),t.mesh=null,t.mesh_added=!1,t.texture_loaded=!1},N=function(e){for(var n=[],a=-1,i=1/0,o=0;o<t.map_meshes.length;o++)if("tiled_image"==t.map_meshes[o].type){var r=Math.abs(e-t.map_meshes[o].location_.z);r<_&&r<i&&(a=o,i=r)}var s;a>=0&&(s=t.map_meshes[a].location_.z);for(var o=0;o<t.map_meshes.length;o++)if("tiled_image"==t.map_meshes[o].type){var r=Math.abs(s-t.map_meshes[o].location_.z);r<w&&n.push(o)}return n},G=function(){if(null!==S)for(var e=N(S),n=0;n<t.map_meshes.length;n++)e.indexOf(n)!=-1?U(t.map_meshes[n]):F(t.map_meshes[n])},U=function(e){if(!y[e.id]){var t=new THREE.Object3D;t.position.copy(e.location_),t.quaternion.copy(e.orientation_);var n=function(e){if(e){for(var t=[],n=[t],i=0;i<e.length;i++){var o=parseInt(e.substr(i,1),16),r=n.shift();if(1&o){var s={};r[0]=s,n.push(s)}if(2&o){var s={};r[1]=s,n.push(s)}if(4&o){var s={};r[2]=s,n.push(s)}if(8&o){var s={};r[3]=s,n.push(s)}}var l={};return a(l,t,""),l}},a=function(e,t,n){for(var i=0;i<4;i++)t[i]&&(e[n+i]=!0,a(e,t[i],n+i))},i={tile_size_px:e.tile_size_px,tile_size_metric:e.mesh_size,max_depth:e.max_depth,bitstream:e.quadtree,tile_present:n(e.quadtree),obj_group:t,getTileURL:function(t,n,a){var i=(e.file_path+"/"+e.file_id).replace(/\$DEPTH/g,t).replace(/\$X/g,n).replace(/\$Y/g,a);return i},getAttributions:function(e,t){t.NavVis={score:100}}};d.addMapLayer(i),y[e.id]=i}},F=function(e){var t=y[e.id];t&&(d.removeMapLayer(t),y[e.id]=void 0)};this.createOSM=function(){var e=new THREE.Object3D;e.position.copy(a.toLocal(0,0,0));var t=1/a.getMeterPerMercator();return e.scale.set(t,t,1),{own_method:d.createOSM,tile_size_px:256,tile_size_metric:40075017,max_depth:19,obj_group:e,bias:.5,z_index:-1,cross_origin:"anonymous",getTileURL:function(e,t,n){return r.getString("core.map.tile_url").replace(/\${z}/,e).replace(/\${x}/,t).replace(/\${y}/,n)},getAttributions:function(e,t){t["© Mapbox, © OpenStreetMap"]={score:50}}}},this.createArcGIS=function(t){var n=new THREE.Object3D;n.position.copy(a.toLocal(0,0,0));var i=1/a.getMeterPerMercator();n.scale.set(i,i,1);var o,r=[{url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/",depth:19,bias:.5,attribution:"http://static.arcgis.com/attribution/World_Topo_Map?f=json"},{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/",depth:18,bias:0,attribution:"http://static.arcgis.com/attribution/World_Imagery?f=json"},{url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/",depth:18,bias:0,attribution:null},{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/",depth:19,bias:.5,attribution:"http://static.arcgis.com/attribution/World_Street_Map?f=json"}],s=r[t];return s.attribution&&e.get(s.attribution).success(function(e){o=e.contributors}),{own_method:d.createArcGIS,tile_size_px:256,tile_size_metric:40075016.685574,max_depth:s.depth,obj_group:n,bias:s.bias,z_index:-1,cross_origin:"anonymous",getTileURL:function(e,t,n){return s.url+e+"/"+n+"/"+t},getAttributions:function(e,t){if(!o)return[];if(!e.attributions_cache){e.attributions_cache=[];for(var n=a.toGlobal(e.mesh.position.clone().applyMatrix4(e.mesh.matrixWorld)),i=n[0],r=n[1],s=0;s<o.length;++s)for(var l=o[s],c=0;c<l.coverageAreas.length;++c){var d=l.coverageAreas[c];e.depth<=d.zoomMax&&e.depth>=d.zoomMin&&r>=d.bbox[0]&&r<=d.bbox[2]&&i>=d.bbox[1]&&i<=d.bbox[3]&&(e.attributions_cache[l.attribution]={score:d.score})}}for(var u in e.attributions_cache)t[u]=e.attributions_cache[u]}}},E()},{create:function(e,t,n){return new window.IV.layers.MapImageLayer(e,t,n)}}}]),IndoorViewerWebApp.service("MapAttributionsService",[function(){this.share={attributions:""}}]),IndoorViewerWebApp.controller("MapAttributionsController",["$scope","MapAttributionsService",function(e,t){e.share=t.share}]),IndoorViewerWebApp.service("MapMeshLayerFactory",["MapMeshService","ViewMenuService",function(e,t){return window.IV.layers.MapMeshLayer=function(n,a,i){var o=this,r=null,s={},l={},c=null;i=i||{},i.distance_threshold=i.distance_threshold||200,i.height_threshold=i.height_threshold||2.5,i.show_wall=void 0===i.show_wall||i.show_wall,i.show_floor=void 0===i.show_floor||i.show_floor,this.onTransitionEnd=function(e){},this.onTransitionStart=function(n,i){!m()&&n&&(e.registerUpdateCallback(o.unique_id,function(e){o.onTransitionStart(n,i)}),t.registerUpdateCallback(o.unique_id,function(){t.mapVisibility()&&o.onTransitionStart(n,i)}),t.mapVisibility()?(r||(r=new THREE.Object3D,r.name="map_meshes",a.add(r)),d(e,n)):r&&(a.remove(r),r=void 0,angular.forEach(s,function(e){e.geometry.dispose()}),s={},l={}))};var d=function(e,t){var n=Math.pow(i.distance_threshold,2);c||(c={wall:new THREE.MeshLambertMaterial({color:"#26C2FF",opacity:1,transparent:!0,depthTest:!0,depthWrite:!0,shading:THREE.FlatShading}),floor:new THREE.MeshLambertMaterial({color:"#115975",opacity:1,transparent:!0,depthTest:!0,depthWrite:!0,shading:THREE.FlatShading})});for(var a=t.floor_location_,o=0;o<e.map_meshes.length;o++){var r=e.map_meshes[o].location_,s=Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2),l=Math.abs(a.z-r.z),d="wall"==e.map_meshes[o].type&&i.show_wall||"floor"==e.map_meshes[o].type&&i.show_floor;d&&s<n&&l<i.height_threshold&&areObjectCoordinatesCompatible(t,e.map_meshes[o])?g(e.map_meshes[o]):u(e.map_meshes[o])}},u=function(e){var t=e.file_path+"/"+e.file_id+".obj";r.remove(s[t]),l[t]=!1},g=function(e){var t=e.file_path+"/"+e.file_id+".obj",n=e.location_,a=e.orientation_;if(s[t])p(t);else{var i=new THREE_IV.OBJLoader;i.load(t,function(i){if(!s[t]){i.children[0].geometry.computeBoundingBox();var o=new THREE.Mesh(i.children[0].geometry,c[e.type]);o.position.copy(n),o.quaternion.copy(a),o.renderOrder=-1e5,s[t]=o}p(t)})}},p=function(e){!l[e]&&r&&(r.add(s[e]),n.invalidateScene(),l[e]=!0)},m=function(){var t=!1;return function(){if(t)return!0;for(var n=0;n<e.map_meshes.length;n++)if("wall"!=e.map_meshes[n].type&&"floor"!=e.map_meshes[n].type)return t=!0,!0;return!1}}()},{create:function(e,t,n){return new window.IV.layers.MapMeshLayer(e,t,n)}}}]),IndoorViewerWebApp.service("MeasurementLayerFactory",["ArchitectureMarkerService","ViewMenuService","CursorService","gettextCatalog","RaycastService",function(e,t,n,a,i){return window.IV.layers.MeasurementLayer=function(o,r){function s(){e.registerUpdateCallback(d.unique_id,function(e,t){o.invalidateScene()})}function l(t,a,i,o,r,s){n.updateCursor(t,a,o,r,s),e.data.newMarkerPosition=n.cursor_pos_global,e.data.createNewMeasureFlag=!0,invalidateAngular(),angular.element("#startCoordsX").val(n.cursor_pos.x),angular.element("#startCoordsY").val(n.cursor_pos.y),angular.element("#startCoordsZ").val(n.cursor_pos.z)}function c(t,a,i,o,r,s){n.updateCursor(t,a,o,r,s),e.data.newMarkerPosition=n.cursor_pos_global,e.data.stopUpdatingMeasureFlag=!0,e.onUpdate(),invalidateAngular()}var d=this;this.onTransitionStart=function(e){},this.onTransitionEnd=function(){},this.onContextMenu=function(n){function r(){var e=o.unprojectScreenCoordinates(n.x,n.y);i.getCoordinates(o,e,s?l:c)}if(t.config.showMeasurements){var s=!e.data.currentMeasure;return{name:s?a.getString("Start measurement"):a.getString("End measurement"),icon:s?"add":"quit",callback:r}}},s()},{create:function(e,t,n){return new window.IV.layers.MeasurementLayer(e,t,n)}}}]),IndoorViewerWebApp.service("NavGraphLayerFactory",["gettextCatalog","NavGraphService","ViewMenuService","CursorService",function(e,t,n,a){return window.IV.layers.NavGraphLayer=function(i,o,r,s){var l,c=this,d=15,u=2,g=null,p=null,m=(new THREE.MeshLambertMaterial({color:49152,transparent:!0}),null),v=function(){p=new THREE.CubeGeometry(.1,.1,.1),l=[new THREE.MeshLambertMaterial({color:192,transparent:!0}),new THREE.MeshLambertMaterial({color:49152,transparent:!0}),new THREE.MeshLambertMaterial({color:12582912,transparent:!0})],m=new THREE.LineBasicMaterial({color:12615680,transparent:!0,linewidth:1})};this.onTransitionEnd=function(){},this.onTransitionStart=function(e){c.onCameraMoveEnd(),t.registerUpdateCallback(c.unique_id,function(n){"CONSTANTS_CHANGED"===n?(d=t.rendering.THRESH,u=t.rendering.THRESH_Z,c.onTransitionStart(e)):("createEdge"===n?c.createEdge(arguments[1],arguments[2]):"removeEdge"===n?c.removeEdge(arguments[1]):"removeNode"===n?c.removeNode(arguments[1]):"createNode"===n&&c.createNode(arguments[1]),i.invalidateScene()),i.invalidateScene()})},this.onCameraMoveEnd=function(){n.registerUpdateCallback(c.unique_id,function(e,t){e.showNavGraph!=t.showNavGraph&&c.onCameraMoveEnd()}),n.config.showNavGraph?(t.fetch(),t.initialized.then(function(){f(),i.invalidateScene()})):(o.remove(g),i.invalidateScene())},this.onContextMenu=function(i){var o=t.getBundle(t.config.bundle_current);if(n.config.showNavGraph&&o&&o.security_.can_write)return{name:e.getString("Create node"),icon:"add",callback:function(e,n){t.editing.createNodeFlag||(t.editing.createNodeFlag=!0,t.editing.newNodePosition=a.cursor_pos,invalidateAngular())}}};var f=function(){o.remove(g),g=new THREE.Object3D,g.name="navgraph",o.add(g),t.rendering.nav_graph_present=!1;var e=r.position.clone();e.z-=i.getImage()?i.getImage().location_.z-i.getImage().floor_location_.z:1.9;var n=t.adjacencyList.getAdjacencyList();t.rendering.nav_graph_present=Object.keys(n).length>0,angular.forEach(n,function(a){var i=a.ngResource.coordinates_local.z-e.z;if(e.distanceTo(a.ngResource.coordinates_local)<d&&Math.abs(i)<u){var o=h(a.ngResource.coordinates_local,a.ngResource.id,i);g.add(o)}angular.forEach(a,function(i,o){if("ngResource"!==o&&"mesh"!==o&&!i.redundant){var r=a.ngResource.coordinates_local,s=n[o].ngResource.coordinates_local,l=Math.min(Math.abs(r.z-e.z),Math.abs(s.z-e.z));if((e.distanceTo(r)<d||e.distanceTo(s)<d)&&l<u){var c=new THREE.Geometry;c.vertices.push(r),c.vertices.push(s),c.dynamic=!0;var p=new THREE.Line(c,m);p.name="navGraphEdge",p.userData={type:"navGraphEdge",id:i.ngResource.id,source:i.ngResource.source,target:i.ngResource.target},g.add(p),t.adjacencyList.addEdgeMesh(p)}}})}),t.rendering.nav_graph_present&&t.editing.applySelection()};this.createEdge=function(e,n){var a=e.position,i=n.position,o=new THREE.Geometry;o.vertices.push(a),o.vertices.push(i),o.dynamic=!0;var r=new THREE.Line(o,m);r.name="navGraphEdge",r.userData={type:"navGraphEdge",
id:-1,source:e.userData.id,target:n.userData.id},g.add(r),t.adjacencyList.addEdgeMesh(r)},this.removeEdge=function(e){e instanceof Array?angular.forEach(e,function(e){g.remove(e)}):g.remove(e)},this.createNode=function(e){var t=void 0===e.mesh,n=e.mesh||h(e.coordinates_local,e.id,0);g.add(n),t&&n.onClick()},this.removeNode=function(e){g.remove(e)};var h=function(n,a,o){var r=1;o<-1?r=0:o>1&&(r=2);var s=new THREE.Mesh(p,l[r]);s.position.copy(n),s.name="navGraphNode",s.userData={type:"navGraphNode",id:a};var c=function(e){var n=t.adjacencyList.getNode(e),a=t.getBundle(n.bundle);return a&&a.security_.can_write};return t.adjacencyList.addNodeMesh(s),s.onClick=function(){c(s.userData.id)&&(t.editing.toggleNode(this),i.invalidateScene())},s.onDragStart=function(e,n){return t.isMovingNodes=!0,invalidateAngular(),!0},s.onDrag=function(e,n){if(c(s.userData.id)){t.editing.selectNode(this);var a=i.getPositionOnGroundPlane(e.x,e.y,s.position.z,n);null!==a&&(t.editing.moveNode(this,a),i.invalidateScene())}},s.onDragEnd=function(e,n){t.isMovingNodes=!1,invalidateAngular()},s.onContextMenu=function(n){if(c(s.userData.id))return{name:e.getString("Delete node"),icon:"delete",callback:function(e,n){s.onClick(),t.editing.deleteNode(0)}}},s};this.onKeyPress=function(e){return e.keycode===Keypress.DOM_VK_DELETE?t.editing.deleteNode(0):e.keycode===Keypress.DOM_VK_SPACE&&t.editing.toggleEdge()},v()},{create:function(e,t,n){return new window.IV.layers.NavGraphLayer(e,t,n)}}}]),IndoorViewerWebApp.service("POILayerFactory",["POIService","POITypeService","ConfigService","gettextCatalog","RaycastService","CursorService","UserService","FloorChangerService","IV","$timeout","PointCloudMenuService",function(e,t,n,a,i,o,r,s,l,c,d){function u(e,t,n){var a={},i=function(t){return Math.floor((t.y||t)/e)},o=function(t){return Math.floor((t.x||t)/e)},r=function(){return Object.keys(a).map(function(e){return parseInt(e,10)})},s=function(e){return a[e]?Object.keys(a[e]).map(function(e){return parseInt(e,10)}):[]},l=function(e,t){return a[e]||(a[e]={}),a[e][t]},c=function(e,a){var r=t/n,s={x:e.location_.x-r/2,y:e.location_.y-r/2,width:a?r+a.userData.text_width/n:r,height:a?a.material.map.image.height/n:r};return{row_start:i(s.y),row_end:i(s.y+s.height),column_start:o(s.x),column_end:o(s.x+s.width)}},d=function(e,t,n,i){if(!(isFinite(e)&&isFinite(t)&&isFinite(n)&&isFinite(i)))throw"Invalid arguments (grid range must be finite)";for(var o=e;o<=t;++o)for(var r=n;r<=i;++r)if(a[o]&&void 0!==a[o][r])return!0;return!1},u=function(e,t,n,i){for(var o=e;o<=t;++o)for(var r=n;r<=i;++r)a[o]||(a[o]={}),a[o][r]=!1},p=function(){var t=function(t,n,i,o){if(a[t]&&a[t][n]&&a[i]&&a[i][o]){var r=a[t][n],s=a[i][o];Math.abs(r.location_.x-s.location_.x)<e&&Math.abs(r.location_.y-s.location_.y)<e&&(g(r,s)===-1?delete a[i][o]:a[t][n])}};angular.forEach(r(),function(e){a[e]&&angular.forEach(s(e),function(n){t(e,n,e-1,n),t(e,n,e-1,n+1),t(e,n,e,n+1),t(e,n,e+1,n),t(e,n,e+1,n+1)})})};return{addToGrid:function(e,t){var n=e.location_,r=i(n),s=o(n),g=l(r,s);if(!g){var p=!0,m=c(e,t);d(m.row_start,m.row_end,m.column_start,m.column_end)?p=!1:u(m.row_start,m.row_end,m.column_start,m.column_end),p&&(a[r][s]=e)}},getArray:function(){var e=[];return p(),angular.forEach(r(),function(t){angular.forEach(s(t),function(n){var i=a[t][n];i&&e.push(i)})}),e}}}var g=function(t,n){return e.selected.poi&&t.id===e.selected.poi.id?-1:e.selected.poi&&n.id===e.selected.poi.id?1:t.importance>n.importance?-1:t.importance<n.importance?1:t.id<n.id?-1:1};return window.IV.layers.POILayer=function(s,d,p){function m(){return n.getBoolean(p.poi_names_config,!1)}var v=this,f=null,h=null,b=null,y={},_=new THREE.SphereGeometry(1,6,6),w=new THREE.MeshBasicMaterial({depthWrite:!1});p=p||{},p.poi_px_size=p.poi_px_size||32,p.distance_threshold=p.distance_threshold||8,p.height_threshold=p.height_threshold||2,p.hide_unimportant=p.hide_unimportant||!1,p.poi_names_config=p.poi_names_config||"",p.poi_visibilitycheck=p.poi_visibilitycheck||!1;var S,E=300,M=s.getViewport(),C=(M.getCamera().type,{text_box:{font_size:14,font_face:"Open Sans",font_color:"rgba(255,255,255,1)",background_blur:"rgba(0,0,0,1)",init_zero_scale:!0},offset:new THREE.Vector3(p.poi_px_size/2+5,0,0)}),T={},k=function(){if(l.addEventListener("transitionStart",I),l.addEventListener("floorChanged",x),p.hide_unimportant){var e;l.addEventListener("zoomedMap",function(){e&&clearTimeout(e),e=setTimeout(function(){O(h,!0),e=void 0},E)})}},x=function(e){e.filtered||O(e.floor.image)},I=function(n,a){e.registerUpdateCallback(v.unique_id,function(){I(n,!0)}),t.registerUpdateCallback(v.unique_id,function(){I(n,!0)}),O(n.image,a)},O=function(a,i){var o=a?a.location_:l.getMainView().getCamera().position;if(i||!S||!o.equals(S)){if(S=o.clone(),p.hide_unimportant){var r=M.getWidth(),v=M.getCamera().right-M.getCamera().left;if(!isFinite(v))throw"POI level of detail requires an orthographic camera";if(0===v)return void c(O,1e3,void 0,a);var y=r/v,_=p.poi_px_size/y,w=new u(_,p.poi_px_size,y)}d.remove(f),f=void 0,f=new THREE.Object3D,f.name="pois",d.add(f),d.remove(b),b=new THREE.Object3D,d.add(b),h=a;var E,C=p.distance_threshold*p.distance_threshold,T=[],k=[];angular.forEach(e.POIsMap,function(e){for(var t=!1,n=0;n<k.length;++n)if(1===g(k[n],e)){k.splice(n,0,e),t=!0;break}t||k.push(e)}),angular.forEach(k,function(n){if(!e.selected.poi||e.selected.poi.id!==n.id){var a=t.getType(n.poi_type);if(!a||!a.type_selected_)return;if(a.visibility_zoom_min&&y<a.visibility_zoom_min||a.visibility_zoom_max&&y>a.visibility_zoom_max)return}var i=n.location_;if(i){var r=Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2),s=Math.abs(o.z-i.z);r>C||s>p.height_threshold||(p.hide_unimportant?w.addToGrid(n,m()?V(n):void 0):T.push(n))}}),p.hide_unimportant&&(T=w.getArray()),angular.forEach(T,function(t){var a=t.location_;if(m()){var i=V(t);f.add(i)}var r=f.getObjectByName(t.id);if(void 0==r){E=new THREE.Geometry;var s=1;if(p.poi_visibilitycheck&&n.getBoolean("poi.visibilitycheck.enabled",!1)&&t.visibilitycheck&&t.orientation_){var l=new THREE.Vector3(1,0,0).applyQuaternion(t.orientation_),c=new THREE.Vector3(o.x-a.x,o.y-a.y,o.z-a.z),d=l.dot(c);d<0&&(s=.3)}r=new THREE.Points(E,R(e,t,s)),r.name=t.id,r.renderOrder=1,f.add(r)}else E=r.geometry;E.vertices.push(a),b.add(P(t))}),s.invalidateScene()}},P=function(t){var n=new THREE.Mesh(_,w);return n.name="poi",n.position.copy(t.location_),n.visible=!1,n.userData.ngResource=t,n.onContextMenu=function(t){var i=n.userData.ngResource;if(i.security_.can_write){var o=n;return{name:a.getString("Delete POI"),icon:"delete",callback:function(t,n){e.deletePOI(o.userData.ngResource),e.selected.poi&&e.selected.poi.id===o.userData.ngResource.id&&(e.closePOI(),invalidateAngular())}}}},n.onClick=function(){return e.selectPOI(t),A(t,s.getViewport(t.location_.x,t.location_.y),s),!0},n.onDoubleClick=function(){return l.moveToPOI(t),!0},n.onMouseOver=function(e,n){A(t,n,s)},n.onMouseOut=function(t,n){e.hover.poi=null,invalidateAngular()},n},R=function(e,n,a){if(n.icon&&""!==n.icon)var i=y[n.icon],o=!0;else var i=y[t.getType(n.poi_type).icon];return i||(i=new THREE.PointsMaterial({map:THREE_IV.ImageUtils.loadTexture(n.getIcon(),{},function(){s.invalidateScene()}),transparent:!0,opacity:a,depthWrite:!1,depthTest:!1,sizeAttenuation:!1,size:p.poi_px_size}),o?y[n.icon]=i:y[n.getIcon()+a]=i),i},V=function(e){var t=T[e.id];return t&&t.userData.text!=e.getTranslation().code&&(removeTextSprite(t),t=void 0),t||(t=makeTextSprite(e.getTranslation().code,C.text_box),T[e.id]=t),t.material.depthWrite=!1,t.material.depthTest=!1,t.userData.anchor_point=e.location_,t};this.onContextMenu=function(e){if(r.getUserInfo().checkAttribute("can_create_pois")&&(!t||t.visible()))return{name:a.getString("Create POI"),icon:"add",callback:function(t,n){var a=s.unprojectScreenCoordinates(e.x,e.y);i.getCoordinates(s,a,function(e,t,n,a,i,r){o.updateCursor(e,t,a,i,r);var s=angular.element(document.querySelector("#editPOI")).scope();s.openEditor(!0)})}}},this.onBeforeRenderViewport=function(e){if(b&&setMeshScreenSize(e,b.children,p.poi_px_size),m()){var t=Object.keys(T).map(function(e){return T[e]});setSpritePositionAndScreenSize(e,t,C.offset)}},this.onAfterRenderViewport=function(t){e.hover.poi&&e.hover.container==s.divContainer.getContainer().parentNode&&L(e.hover.poi.location_,t,s)},this.onCameraMoveEnd=function(){O()};var A=function(t,n,a){var i=t.location_;e.hover.poi=t,e.hover.container=a.divContainer.getContainer().parentNode,L(i,n,a)},L=function(t,n,a){var i={x:-1e3,y:-1e3},o=t.clone();o.project(n.getCamera());if(o.x>=-1&&o.x<=1&&o.y>=-1&&o.y<=1&&o.z<=1){o.x=(o.x+1)/2*n.getWidth(),o.y=(-o.y+1)/2*n.getHeight(),o.x+=n.getX(0),o.y+=n.getY(0);for(var r=a.divContainer.getContainer();r&&!r.classList.contains("indoorViewer");)o.x+=r.offsetLeft,o.y+=r.offsetTop,r=r.offsetParent}else o.x=i.x,o.y=i.y;e.hover.x=o.x,e.hover.y=o.y,invalidateAngular()};k()},{create:function(e,t,n){return new window.IV.layers.POILayer(e,t,n)}}}]),IndoorViewerWebApp.service("PointCloudLayerV2Factory",["CameraAndViewportService","ProgressReportService","PointCloudMenuService","DatasetAlignmentService","DatasetService","ModeService","ConfigService","PolygonDrawingService","$q","$rootScope","gettextCatalog",function(e,t,n,a,i,o,r,s,l,c,d){return window.IV.layers.PointCloudLayerV2=function(e,r){function s(){0!=Potree.pointLoadLimit&&(Potree.pointLoadLimit=0),Potree.PointCloudOctree.lru&&Potree.PointCloudOctree.lru.freeMemory()}function l(){_&&(_.setPercentage(100),_=void 0)}function c(e){angular.forEach(e,function(e){u(e)})}function u(e){e.pointCloudContainer&&(e.pointCloudContainer.visible=!1,e.pointCloudObject.perspectiveMaterial.dispose(),e.pointCloudObject.orthoMaterial.dispose(),e.pointCloudObject=void 0,e.pointCloudBBContainer=void 0,e.pointCloudContainer.parent.remove(e.pointCloudContainer),e.pointCloudContainer=void 0)}function g(e){return 1e3*e*1e3}function p(t,n){var i=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:8947848,wireframe:!0}));return i.scale.subVectors(t.boundingBox.max,t.boundingBox.min),i.position.addVectors(t.boundingBox.max,t.boundingBox.min).divideScalar(2),i.visible=!1,i.onMouseOver=function(e,t){("default"===document.body.style.cursor||""===document.body.style.cursor)&&t.getCamera()instanceof THREE.OrthographicCamera&&(document.body.style.cursor="move")},i.onMouseOut=function(){"move"===document.body.style.cursor&&(document.body.style.cursor="default")},i.onDragStart=function(t,n){if(y=e.unprojectScreenCoordinates(t.x,t.y,1,n),"datasetAlignment"===o.modes.currentMode&&n.getCamera()instanceof THREE.OrthographicCamera)return a.cacheCurrentState(),!0},i.onDrag=function(t,n){var i=e.unprojectScreenCoordinates(t.x,t.y,1,n),o=(new THREE.Vector3).subVectors(i,y);"SVCamera1"!==n.name&&"SVCamera2"!==n.name||(e.isKeyPressed(KeyEvent.DOM_VK_SHIFT)?o.x=o.y=0:e.isKeyPressed(KeyEvent.DOM_VK_A)&&(o.z=0)),a.translate(o),y=i,e.invalidateScene()},i.onDragCancel=function(){a.undoTranslation(),e.invalidateScene()},i.onContextMenu=function(e){if("datasetAlignment"===o.modes.currentMode)return n.visible?{name:"Hide "+n.title+"'s Point cloud",icon:"delete",key:"dataset"+n.id.toString()+"Pointcloud",callback:function(e,t){a.deSelect(n),invalidateAngular()}}:{name:"Show "+n.title+"'s Point cloud",icon:"add",key:"dataset"+n.id.toString()+"Pointcloud",callback:function(e,t){a.select(n),invalidateAngular()}}},i}function m(e,t){v(e),e.transparent=!0,e.color=a.COLOR_DEFS[t.color].rgb_color,e.pointOpacityType=Potree.PointOpacityType.ATTENUATED,e.normalsFiltering=!1,e.maxSize=500}function v(e){var t=n.config;e.pointSizeType=Number(t.perspectiveMaterial.pointSizeSelectedOption.id),e.opacity=R(Number(t.perspectiveMaterial.opacity)),e.pointShape=Number(t.perspectiveMaterial.pointShapeSelectedOption.id),e.alphaAttenuation=P(t.perspectiveMaterial.brightness),e.size=Number(t.perspectiveMaterial.pointSize),e.pointColorType=Number(t.perspectiveMaterial.colorStyleSelectedOption.id),e.heightMin=Number(t.perspectiveMaterial.z[0]),e.heightMax=Number(t.perspectiveMaterial.z[1])}function f(e,t){h(e),e.pointSizeType=Potree.PointSizeType.FIXED,e.alphaAttenuation=P(1e3),e.transparent=!0,e.color=a.COLOR_DEFS[t.color].rgb_color,e.pointOpacityType=Potree.PointOpacityType.ATTENUATED,e.normalsFilteringThreshold=.1}function h(e){var t=n.config;e.opacity=R(Number(t.orthoMaterial.opacity)),e.pointShape=Number(t.orthoMaterial.pointShapeSelectedOption.id),e.size=Number(t.orthoMaterial.pointSize),e.pointColorType=Number(t.orthoMaterial.colorStyleSelectedOption.id),e.heightMin=Number(t.orthoMaterial.z[0]),e.heightMax=Number(t.orthoMaterial.z[1]),e.normalsFiltering=t.orthoMaterial.normalsFiltering}var b,y,_,w=this,S=!1,E=3,M=1,C=100,T=1,k=0,x=0,I=new Array,O=function(){b=new THREE.Object3D,b.name="pointCloudGroup",r.add(b),e.getCamera().far=n.config.maxDist<300?n.config.maxDist:1e3,F=new H};this.onTransitionStart=function(t){i.registerUpdateCallback(w.unique_id,function(){e.invalidateScene()}),a.registerUpdateCallback(w.unique_id,function(){e.invalidateScene()}),n.registerUpdateCallback(w.unique_id,function(t,a){switch(t){case"showPointCloud":case"all":var o=n.config;if(!o.usePotree||!o.showPointCloud){s(),l(),c(I),V();break}angular.forEach(i.datasets,function(e){var t=e.getPointCloudObject().pointCloudObject;if(t){var n=t.perspectiveMaterial;v(n);var n=t.orthoMaterial;h(n),t.minimumNodePixelSize=o.minNodeSize,t.clientSidePicking=o.clientSidePicking,1!==t.perspectiveMaterial.opacity&&(t.perspectiveMaterial.depthWrite=o.perspectiveMaterial.zBuffering,t.perspectiveMaterial.depthTest=o.perspectiveMaterial.zBuffering)}}),S=o.perspectiveMaterial.useEDL,E=o.perspectiveMaterial.EDLRadius,M=o.perspectiveMaterial.EDLStrength,e.getCamera().far=o.maxDist<300?o.maxDist:1e3;break;case"clearPointClouds":c(I)}e.invalidateScene()})},this.onBeforeRender=function(){k=0},this.onBeforeRenderViewport=function(e){k++,V(e.getCamera()),n.config.usePotree&&n.config.showPointCloud&&(!S||e.getCamera()instanceof THREE.OrthographicCamera||(b.visible=!1))},this.onAfterRenderViewport=function(t){function a(e){if(e.failed)return!0;var t=!1;return angular.forEach(e.children,function(e){a(e)&&(t=!0)}),t}if(!n.config.usePotree||!n.config.showPointCloud)return s(),void l();Potree.PointCloudOctree.lru&&Potree.PointCloudOctree.lru.freeMemory(),!S||t.getCamera()instanceof THREE.OrthographicCamera||(b.visible=!0,F.render(e.renderer,t));for(var i=0,o=0;o<b.children.length;o++)void 0!==b.children[o].children[0]&&(b.children[o].children[0].root&&a(b.children[o].children[0].root)?i+=1:b.children[o].children[0].children.length&&(i+=b.children[o].children[0].progress));C+=i/b.children.length*100},this.onAfterRender=function(){T=k,n.config.usePotree&&n.config.showPointCloud&&i.datasets.length&&(C/=T,void 0===_&&100!=C&&(_=t.addTask(d.getString("Loading point cloud..."),1,!1,!1,!0)),void 0!==_&&(_.setPercentage(C),100==C&&(_=void 0)),100!=C&&e.invalidateScene(),C=0)};var P=function(e){var t=-5,n=1,a=1e3,i=e/a*(n-t)+t,o=Math.exp(i),r=Math.exp(n);return o/r*a},R=function(e){return e*e},V=function(t){if(Potree.pointLoadLimit=g(n.config.pointCountTarget),x=Potree.pointLoadLimit/T,I=[],angular.forEach(i.datasets,function(e){L(e,t);var a=e.getPointCloudObject();n.config.showPointCloud&&n.config.usePotree&&e.visible&&a.pointCloudObject&&I.push(a)}),n.config.showPointCloud&&n.config.usePotree){U(I,t,e.renderer);for(var a=0;a<I.length;a++)I[a].pointCloudObject.updateMaterial(I[a].pointCloudObject.material,I[a].pointCloudObject.visibleNodes,t,e.renderer),I[a].pointCloudObject.updateVisibleBounds()}},A=function(e,t){if(t(e))for(var n=e.children,a=0;a<8;a++)void 0!==n[a]&&A(n[a],t)},L=function(e,t){if(n.config.showPointCloud&&n.config.usePotree){var a=e.getPointCloudObject();if(!a.pointCloudContainer&&e.visible){N(e);var i=e.getPotreeConfigFilename();Potree.POCLoader.load(i,function(t){e.getPointCloudObject().pointCloudContainer&&D(t,e)})}var o=a.pointCloudObject;if(!o)return;if(0!==o.root.numPoints&&0==a.pointCloudBBContainer.children.length&&A(o.root,function(t){if(t.boundingBox.max.x-t.boundingBox.min.x<10){var n=p(t,e);return a.pointCloudBBContainer.add(n),!1}return!0}),e.PCColorDefinition_&&(!o.hasColor||o.hasColor&&!o.perspectiveMaterial.color.equals(e.PCColorDefinition_.rgb_color))){o.hasColor=!0;var r=e.PCColorDefinition_.rgb_color;o.orthoMaterial.color=r,o.perspectiveMaterial.color=r}t instanceof THREE.OrthographicCamera?(o.traverse(function(e){e.material=o.orthoMaterial}),o.minimumNodePixelSize=2*n.config.minNodeSize):(o.traverse(function(e){e.material=o.perspectiveMaterial}),o.minimumNodePixelSize=n.config.minNodeSize),a.pointCloudContainer.visible=e.visible}else{var a=e.getPointCloudObject();u(a)}},D=function(t,a){var i=new Potree.PointCloudOctree(t);i.name="pointCloudV2";var o=i.material;i.perspectiveMaterial=o,m(o,a),i.orthoMaterial=new Potree.PointCloudMaterial;var o=i.orthoMaterial;f(o,a),i.minimumNodePixelSize=n.config.minNodeSize,i.clientSidePicking=n.config.clientSidePicking,i.raycastable=!1,i.frustumCulled=!1,i.hasColor=!1;var r=a.getPointCloudObject();r.pointCloudObject=i,r.pointCloudContainer.add(i);var s=new THREE.Object3D;s.name="boundingBoxContainer",s.position.copy(i.position),s.matrixWorldNeedsUpdate=!0,r.pointCloudBBContainer=s,r.pointCloudContainer.add(s),e.invalidateScene()},N=function(e){var t=e.getPointCloudObject();if(!t.pointCloudContainer){var n=new THREE.Object3D;n.name="pointCloudContainer",b.add(n),t.pointCloudContainer=n,t.pointCloudContainer.matrix=e.m2w_,t.pointCloudContainer.matrixAutoUpdate=!1,t.pointCloudContainer.matrixWorldNeedsUpdate=!0}},G="",U=function(e,t,a){G=t.name;var i=0,o=0,r=new BinaryHeap(function(e){return 1/e.weight});t.updateMatrixWorld();for(var s=[],l=t.matrixWorldInverse,c=t.projectionMatrix,d=t.matrixWorld,u=0;u<e.length;u++){var g=e[u].pointCloudObject;g.numVisibleNodes=0,g.numVisiblePoints=0,g.visibleNodes=[],g.visibleGeometry=[],g.frustum=new THREE.Frustum;var p=g.matrixWorld,m=(new THREE.Matrix4).multiply(c).multiply(l).multiply(p);g.frustum.setFromMatrix(m);var v=(new THREE.Matrix4).getInverse(p),f=(new THREE.Matrix4).multiply(v).multiply(d);g.camObjPos=(new THREE.Vector3).setFromMatrixPosition(f),g.root instanceof Potree.PointCloudOctreeNode&&g.hideDescendants(g.root.sceneNode);for(var h=0;h<g.boundingBoxNodes.length;h++)g.boundingBoxNodes[h].visible=!1;if(g.frustum.intersectsBox(g.root.boundingBox)){var b=Number.MAX_VALUE;r.push({node:g.root,cloud:g,weight:b})}}for(;r.size()>0;){var y=r.pop(),_=y.node,w=y.parent,g=y.cloud,S=_.boundingBox,E=g.frustum.intersectsBox(S),M=E;if(M=M&&!(i+_.numPoints>x)){if(o++,i+=_.numPoints,g.numVisibleNodes++,g.numVisiblePoints+=_.numPoints,_ instanceof Potree.PointCloudOctreeGeometryNode){var C=_,T=C.geometry;if(("undefined"==typeof w||w instanceof Potree.PointCloudOctreeNode)&&C.loaded){var k=new Potree.PointCloudOctreeNode,I=new THREE.Points(T,g.material);I.visible=!1,k.octree=g,k.name=C.name,k.level=C.level,k.numPoints=C.numPoints,k.boundingBox=T.boundingBox,k.tightBoundingBox=T.tightBoundingBox,k.boundingSphere=k.boundingBox.getBoundingSphere(),k.geometryNode=C,k.parent=w,k.children={};for(var O in C.children)k.children[O]=C.children[O];if(I.boundingBox=k.boundingBox,I.boundingSphere=k.boundingSphere,I.numPoints=k.numPoints,I.level=k.level,I.frustumCulled=!1,k.sceneNode=I,"undefined"==typeof _.parent)g.root=k,g.add(k.sceneNode),I.matrixWorld.multiplyMatrices(g.matrixWorld,I.matrix);else{var P=parseInt(k.name[k.name.length-1]);w.sceneNode.add(I),w.children[P]=k,I.matrixWorld.multiplyMatrices(w.sceneNode.matrixWorld,I.matrix)}var R=function(e,t,n){return function(){var a=parseInt(t.name[t.name.length-1]);e.sceneNode.remove(t.sceneNode),e.children[a]=n}}(w,k,_);k.geometryNode.oneTimeDisposeHandlers.push(R),_=k}C.loaded||(s.push(_),g.visibleGeometry.push(_))}if(_ instanceof Potree.PointCloudOctreeNode){if(Potree.PointCloudOctree.lru.touch(_.geometryNode),_.sceneNode.visible=!0,_.sceneNode.material=g.material,g.visibleNodes.push(_),g.visibleGeometry.push(_.geometryNode),_.parent?_.sceneNode.matrixWorld.multiplyMatrices(_.parent.sceneNode.matrixWorld,_.sceneNode.matrix):_.sceneNode.matrixWorld.multiplyMatrices(g.matrixWorld,_.sceneNode.matrix),g.showBoundingBox&&!_.boundingBoxNode){var V;V=new THREE.BoxHelper(_.sceneNode),g.add(V),g.boundingBoxNodes.push(V),_.boundingBoxNode=V,_.boundingBoxNode.matrix.copy(_.sceneNode.matrixWorld),_.boundingBoxNode.matrixAutoUpdate=!1,_.boundingBoxNode.updateMatrixWorld()}else g.showBoundingBox?(_.boundingBoxNode.visible=!0,_.boundingBoxNode.matrixWorld.copy(_.sceneNode.matrixWorld)):!g.showBoundingBox&&_.boundingBoxNode&&(_.boundingBoxNode.visible=!1);g.generateDEM&&_.level<=2&&(_.dem||(_.dem=g.createDEM(_)))}for(var u=0;u<8;u++)if(_.children[u]){var b,A,L,D=_.children[u],N=D.boundingSphere,U=N.center.distanceTo(g.camObjPos),F=N.radius;if(t instanceof THREE.OrthographicCamera)L=F/t.top;else{var H=t.fov/2*Math.PI/180;L=1/Math.tan(H)*F/Math.sqrt(U*U-F*F)}A=a.domElement.clientHeight*L,D.screenPixelRadius=A,A<g.minimumNodePixelSize||g.material.spacing/Math.pow(2,D.level)<Math.pow(3,1-n.config.maxDepth)||(b=L,U-F<0&&(b=Number.MAX_VALUE),r.push({node:D,parent:_,cloud:g,weight:b}))}}}for(var z=Date.now(),j=.01,u=0;u<s.length&&(s[u].load(),!(Date.now()-z>j));u++);},F=null,H=function(){var e=null,t=null,n=function(){null==e&&(e=new Potree.EyeDomeLightingMaterial,t=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType}))},a=function(e,n){var a=e.getSize();t.setSize(a.width,a.height)};this.render=function(i,o){var r=o.getCamera(),s=i.getSize(),l=s.width,c=s.height;n(),a(i,o),i.setScissorTest(!1),i.clearTarget(t);for(var d=0;d<b.children.length;d++)if(void 0!==b.children[d].children[0]&&b.children[d].visible){var u=b.children[d].children[0];u.oldMaterial={},u.oldMaterial.minSize=u.material.minSize,u.oldMaterial.opacity=u.material.opacity,u.oldMaterial.transparent=u.material.transparent,u.oldMaterial.blending=u.material.blending,u.oldMaterial.depthTest=u.material.depthTest,u.oldMaterial.interpolate=u.material.interpolate,u.oldMaterial.weighted=u.material.weighted,u.oldMaterial.useLogarithmicDepthBuffer=u.material.useLogarithmicDepthBuffer,u.material.interpolate=!1,u.material.weighted=!1,u.material.useLogarithmicDepthBuffer=!1,u.material.blending=0,u.material.depthTest=!0,u.material.transparent=!1,u.material.minSize=2,u.material.opacity=1,u.material.useEDL=!0}i.render(b,r,t);for(var d=0;d<b.children.length;d++)if(void 0!==b.children[d].children[0]&&b.children[d].visible){var u=b.children[d].children[0];u.material.minSize=u.oldMaterial.minSize,u.material.useLogarithmicDepthBuffer=u.oldMaterial.useLogarithmicDepthBuffer,u.material.weighted=u.oldMaterial.weighted,u.material.interpolate=u.oldMaterial.interpolate,u.material.opacity=u.oldMaterial.opacity,u.material.transparent=u.oldMaterial.transparent,u.material.blending=u.oldMaterial.blending,u.material.depthTest=u.oldMaterial.depthTest,u.material.useEDL=!1}e.uniforms.screenWidth.value=l,e.uniforms.screenHeight.value=c,e.uniforms.near.value=r.near,e.uniforms.far.value=r.far,e.uniforms.colorMap.value=t.texture,e.uniforms.expScale.value=r.far,e.uniforms.edlScale.value=M,e.uniforms.radius.value=E,Potree.utils.screenPass.render(i,e),i.setScissorTest(!0)}};O()},{create:function(e,t,n){return new window.IV.layers.PointCloudLayerV2(e,t,n)}}}]),IndoorViewerWebApp.service("PointCloudLayerFactory",["gettextCatalog","CameraAndViewportService","ProgressReportService","PointCloudMenuService","DatasetAlignmentService","DatasetService","ModeService","IV","ConfigService","PolygonDrawingService","$q","$rootScope",function(e,t,n,a,i,o,r,s,l,c,d,u){return window.IV.layers.PointCloudLayer=function(l,c){var d,u,g,p,m,v=this,f=!1,h=1,b=new Array,y=0,_=new Worker(window.IV.base_url+"workers/PointCloudWorker.js"),w=!1,S=i.COLOR_DEFS[Object.keys(i.COLOR_DEFS)[0]].rgb_color,E=function(){_.addEventListener("message",function(e){N(e)},!1),u=new THREE.CubeGeometry(1,1,1),g=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!0,wireframe:!0,visible:w,side:THREE.DoubleSide}),p=new THREE.PlaneGeometry(2/3,2/3),m=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!0,opacity:.5,color:8388608,visible:w,side:THREE.DoubleSide})},M=function(e){var t=-5,n=1,a=1e3,i=e/a*(n-t)+t,o=Math.exp(i),r=Math.exp(n);return o/r*a};this.onTransitionStart=function(e){o.registerUpdateCallback(v.unique_id,function(){I()}),i.registerUpdateCallback(v.unique_id,function(){l.invalidateScene()}),a.registerUpdateCallback(v.unique_id,function(e,t){switch(e){case"showPointCloud":case"usePotree":I();break;case"opacity":c.traverse(function(e){"pointCloud"==e.name&&(e.material.opacity=t)});break;case"zBuffering":c.traverse(function(e){"pointCloud"==e.name&&(e.material.depthWrite=e.material.depthTest=t)});break;case"brightness":c.traverse(function(e){"pointCloud"==e.name&&(e.material.alphaAttenuation=M(t))});break;case"Depth culling":l.getCamera().far=t<300?t:1e3,I();break;case"PC resolution":I();break;case"color hueOffset":c.traverse(function(e){"pointCloud"==e.name&&(e.material.hueOffset=t)});break;case"color hueScale":c.traverse(function(e){"pointCloud"==e.name&&(e.material.hueScale=t)})}l.invalidateScene()})},this.changePCFixedSize=function(e){.1<h+e&&h+e<10&&(h+=e,l.invalidateScene())},this.onAfterRender=function(){a.config.showPointCloud&&!a.config.usePotree&&G(10)},this.onBeforeRenderViewport=function(e){a.config.showPointCloud&&!a.config.usePotree&&c.traverse(function(t){if("featureParticleSystem"===t.name||"pointCloud"===t.name)if(e.camera instanceof THREE.PerspectiveCamera){var n=e.getWidth()/(e.fieldOfView/180*Math.PI);t.material.angle2pixels=n,t.material.fixedSize=0}else t.material.fixedSize=h})},this.onCameraMoveEnd=function(){f&&console.log("PointCloudLayer::onCameraMoveEnd()"),I()};var C,T,k,x,I=function(){C=0,k=0,T=0,angular.forEach(o.datasets,function(e){e.visible&&e.isOctreeAvailable()&&C++}),angular.forEach(o.datasets,function(e){O(e)})},O=function(e){var t=e.getPointCloudObject();if(a.config.showPointCloud&&a.potreeAvailabilityChecked&&!a.config.usePotree){if(V(t,e.m2w_),t.pointcloud&&!t.pointcloudGeometry){var n=new THREE.BinaryLoader;n.load(s.base_href+t.pointcloud,function(e){t.pointcloudGeometry=e,console.debug("got pointcloud, "+e.vertices.length+" points."),t.pointCloudParticleSystemGroup.add(R(t,e,.03)),l.invalidateScene()})}var i=l.getCamera().position;P(i,e),t.pointCloudParticleSystemGroup&&t.pointCloudParticleSystemGroup.traverse(function(e){e.visible=!0})}else U(t);l.invalidateScene()},P=function(t,i){var o=a.config.maxDepth;if(i.visible&&i.isOctreeAvailable()){void 0===x&&(x=n.addTask(e.getString("Loading point cloud..."),1,!1,!1,!0));var r=i.getPointCloudObject();if(V(r,i.m2w_),!r.octreeLoaded)return void(r.octreeLoading||(r.octreeLoading=!0,A(i,function(e){r.octreeLoading=!1,r.octreeLoaded=!0,P(t,i)})));var s=[];for(var l in r.subOctrees){var c=r.subOctrees[l],d=new THREE.Vector3(c.center[0],c.center[1],c.center[2]);d.applyMatrix4(i.m2w_);var u,g=d.sub(t).length();for(var p in a.config.distance_to_depth)if(g<a.config.distance_to_depth[p][0]||a.config.same_res){u=a.config.distance_to_depth[p][1];break}var m=Math.min(u,Math.min(getDepth(c),o));if((!c.loading||c.loadingDepth!=m)&&g<a.config.maxDist)if(r.octreeParticleSystems&&r.subOctrees[c.key]&&r.octreeParticleSystems[c.key]){var v=r.octreeParticleSystems[c.key];v&&(v.octreeDepth<m||v.octreeDepth>m&&(g>25||v.octreeDepth>o))?s.push({dataset:i,subOctree:c,loadDepth:m,dist:g}):f&&console.log("Discarding "+v.octreeDepth+", "+m+", "+g)}else s.push({dataset:i,subOctree:c,loadDepth:m,dist:g})}s.sort(function(e,t){return e.dist-t.dist});for(var h in s){var b=s[h];b.dist<a.config.maxDist&&(D(b.dataset,b.subOctree,b.loadDepth),b.subOctree.loading&&f&&console.log("Request for depth "+b.loadDepth+" overrides pending request "+b.subOctree.loadingDepth),b.subOctree.loading=!0,b.subOctree.loadingDepth=b.loadDepth)}0==s.length&&(k++,C==k&&(x.setPercentage(100),x=void 0),f&&console.log("Firing reply because no trees are missing"))}else U(i.getPointCloudObject())},R=function(e,t,n){var i=a.config.hueOffset,o=a.config.hueScale;if(e.PCColorDefinition_)var r=e.PCColorDefinition_.use_rgb,s=e.PCColorDefinition_.rgb_color;else var r=!1,s=S;var l=new THREE.NVPointCloudMaterial({color:56576,transparent:!0,depthWrite:a.config.zBuffering,depthTest:a.config.zBuffering,size:n,sizeAttenuation:!0,alphaAttenuation:M(a.config.brightness),opacity:a.config.opacity,hueOffset:i,hueScale:o,useRGB:r,RGBColor:s}),c=new THREE.Points(t,l);return c.name="pointCloud",c.frustumCulled=!0,c.raycastable=!1,c},V=function(e,t){if(!e.pointCloudParticleSystemGroup){var n=new THREE.Object3D;n.name="pointCloudGroup",n.matrix=t,n.matrixAutoUpdate=!1,n.matrixWorldNeedsUpdate=!0,c.add(n),e.pointCloudParticleSystemGroup=n}},A=function(t,a){$.getJSON(t.getOctreeConfigFilename(),function(i){var o=new XMLHttpRequest;o.open("GET",t.getOctreeDirectory()+i.mergedSubData,!0),o.responseType="arraybuffer",o.onload=function(){if(200!=this.status)return void console.error("Loading merged subtree data failed: "+this.status+" ("+this.statusText+")")},o.send();var o=new XMLHttpRequest;o.open("GET",t.getOctreeDataFilename(),!0),o.responseType="arraybuffer",o.onload=function(){if(200!=this.status)return void console.error("Loading octree data failed: "+this.status+" ("+this.statusText+")");if(t.getPointCloudObject().pointCloudParticleSystemGroup){T++,void 0===x&&(x=n.addTask(e.getString("Loading point cloud..."),1,!1,!1,!0)),x.setPercentage(50*T/C),i.prefix=t.getOctreeDirectory();var r=t.getPointCloudObject();r.octreeConfigStruct=i,r.octreeConfigStruct.prefix=window.location.origin+window.location.pathname+r.octreeConfigStruct.prefix;var s=new Uint8Array(o.response),l=0,c=new Octree(s,i.imoDepth,i.oct_imo_res,function(e,n,a,o,s){n=i.subTrees.shift(),l++,n.center=[.5*(n.bbX[0]+n.bbX[1]),.5*(n.bbY[0]+n.bbY[1]),.5*(n.bbZ[0]+n.bbZ[1])],n.keys=new Int32Array(4),n.keys[0]=a,n.keys[1]=o,n.keys[2]=s,n.keys[3]=Math.log(e.res/n.res)/Math.log(2),r.subOctrees||(r.subOctrees=[]),r.subOctrees[n.key]=n,L(t,a,o,s)});a&&a(c)}},o.send()}).error(function(t,n,a){console.log(e.getString("Cannot load Octree point cloud: {{y}} {{z}}",{y:n,z:a}))})},L=function(t,n,a,o){var s=t.getPointCloudObject().octreeConfigStruct,c=(n+.5)*s.oct_imo_res+s.bbX[0],v=(a+.5)*s.oct_imo_res+s.bbY[0],f=(o+.5)*s.oct_imo_res+s.bbZ[0],h=new THREE.Mesh(u,g);h.position.set(c,v,f),h.scale.set(s.oct_imo_res,s.oct_imo_res,s.oct_imo_res),h.onMouseOver=function(e,t){("default"===document.body.style.cursor||""===document.body.style.cursor)&&t.getCamera()instanceof THREE.OrthographicCamera&&(document.body.style.cursor="move")},h.onMouseOut=function(){"move"===document.body.style.cursor&&(document.body.style.cursor="default")},h.onDragStart=function(e,t){if(d=l.unprojectScreenCoordinates(e.x,e.y,1,t),"datasetAlignment"===r.modes.currentMode&&t.getCamera()instanceof THREE.OrthographicCamera)return i.cacheCurrentState(),!0},h.onDrag=function(e,t){var n=l.unprojectScreenCoordinates(e.x,e.y,1,t),a=(new THREE.Vector3).subVectors(n,d);"SVCamera1"!==t.name&&"SVCamera2"!==t.name||(l.isKeyPressed(KeyEvent.DOM_VK_SHIFT)?a.x=a.y=0:l.isKeyPressed(KeyEvent.DOM_VK_A)&&(a.z=0)),i.translate(a),d=n,l.invalidateScene()},h.onDragCancel=function(){i.undoTranslation(),l.invalidateScene()},h.onDragEnd=function(){},h.onContextMenu=function(n){if("datasetAlignment"===r.modes.currentMode)return{name:e.getString("Hide {{title}}'s point cloud ",{title:t.title}),icon:"delete",key:"dataset"+t.id.toString()+"Pointcloud",callback:function(e,n){i.deSelect(t)}}};var b=t.getPointCloudObject();if(b.pointCloudParticleSystemGroup.add(h),w){var f=o*b.octreeConfigStruct.oct_imo_res+b.octreeConfigStruct.bbZ[0],y=new THREE.Mesh(p,m);y.position.set(c,v,f),y.scale.set(s.oct_imo_res,s.oct_imo_res,1),b.pointCloudParticleSystemGroup.add(y);
}},D=function(e,t,n){_.postMessage({cmd:"load",datasetId:e.id,octreeConfigStruct:e.getPointCloudObject().octreeConfigStruct,sub_octree:t,load_depth:n})},N=function(e){if("pointcloud"==e.data.cmd)b.push(e.data),l.invalidateScene();else if("status"==e.data.cmd){void 0!==x&&(x.setPercentage(50+e.data.percent/2),100==e.data.percent&&(x=void 0));var t=Math.round(e.data.percent);if(t>y+10||100===t){y=t,f&&console.log("PC loaded - "+Math.round(e.data.percent)+"%")}}},G=function(e){for(var t=(new Date).getTime(),n=0;n<b.length&&(new Date).getTime()-t<e;n++){var i=b[n],r=o.datasetsIdMap[i.datasetId].getPointCloudObject(),s=null;if(r.subOctrees)if(r.subOctrees[i.sub_octree.key].loading=!1,r.subOctrees[i.sub_octree.key].loadingDepth==i.sub_octree.load_depth){r.octreeParticleSystems||(r.octreeParticleSystems=[]);var c=r.octreeParticleSystems[i.sub_octree.key];if(c&&(F(c),r.pointCloudParticleSystemGroup&&r.pointCloudParticleSystemGroup.remove(c)),i.error)console.log("Discarding erroneous point cloud download");else if(a.config.showPointCloud&&!a.config.usePotree){for(var d=new THREE.Geometry,u=d.vertices,g=i.vertices,p=3*i.sub_octree.leaves,m=THREE.Vector3,v=0;v<p;)u.push(new m(g[v],g[v+1],g[v+2])),v+=3;s=R(r,d,i.sub_octree.res*i.sub_octree.res_scale),s.octreeDepth=i.sub_octree.load_depth,s.octreeMaxDepth=getDepth(i.sub_octree),s.position.set(i.sub_octree.center[0],i.sub_octree.center[1],i.sub_octree.center[2]),r.octreeParticleSystems[i.sub_octree.key]=s,r.pointCloudParticleSystemGroup&&r.pointCloudParticleSystemGroup.add(s)}else delete r.octreeParticleSystems[i.sub_octree.key]}else console.log("Discarding worker response "+i.sub_octree.key+" for wrong resolution "+i.sub_octree.load_depth+" (want "+r.subOctrees[i.sub_octree.key].loadingDepth+")")}b=b.slice(n),n>0&&l.invalidateScene()},U=function(e){if(e){if(e.pointCloudParticleSystemGroup&&(c.remove(e.pointCloudParticleSystemGroup),F(e.pointCloudParticleSystemGroup),delete e.pointCloudParticleSystemGroup),e.octreeParticleSystems){for(var t in e.octreeParticleSystems)F(e.octreeParticleSystems[t]);delete e.octreeParticleSystems}e.subOctrees=void 0,e.octreeLoaded=!1,e.octreeLoading=!1,e.octreeConfigStruct=void 0}},F=function(e){e.traverse(function(e){void 0!==e.geometry&&e.geometry!==u&&e.geometry!==p&&e.geometry.dispose(),void 0!==e.material&&e.material!==g&&e.material!==m&&e.material.dispose()})};this.onMouseWheel=function(e,n){if(l.isKeyPressed(KeyEvent.DOM_VK_A)){var a=-n;return t.changePCFixedSize(a),!0}},E()},{create:function(e,t,n){return new window.IV.layers.PointCloudLayer(e,t,n)}}}]),IndoorViewerWebApp.service("PolygonLayerFactory",["$q","gettextCatalog","ConfigService","PolygonDrawingService","VectorMapService","$rootScope","GeoTransformationService","ViewMenuService","ModeService","POITypeService","FloorChangerService","MessageReportingService","IV",function(e,t,n,a,i,o,r,s,l,c,d,u,g){return window.IV.layers.PolygonLayer=function(s,l){function p(e){e.meshes&&(E.remove(e.meshes.outline),E.remove(e.meshes.fill));for(var t in e.circles)E.remove(e.circles[t].outline),E.remove(e.circles[t].fill);var n=w.indexOf(e);n>=0&&delete w[n],e==C&&(C=null),e.$delete&&e.$delete(),a.onUpdate("refresh polygons"),s.invalidateScene()}function m(e){void 0!==e.meshes&&(null!==C&&(E.remove(C.meshes.fill),C.meshes.fill=te(C)[0],E.add(C.meshes.fill)),E.remove(e.meshes.fill),e.meshes.fill=te(e,!0)[0],E.add(e.meshes.fill),C=e,s.invalidateScene())}function v(e,t){k.polygon.push(e),null!==k.meshes.outline&&E.remove(k.meshes.outline),k.polygon.length>1&&(k.meshes.outline=ee(k)[0],E.add(k.meshes.outline)),t||k.circles.push(ne(e,k)),s.invalidateScene()}function f(){null!==k&&p(k),k={polygon:[],holes:[],circles:[],meshes:{outline:null,fill:null},name:null,type:null}}var h,b,y=this,_=s.getViewport(),w=[],S=new THREE.Object3D;S.name="PolygonLayer",S.matrixAutoUpdate=!1;var E=new THREE.Object3D;E.name="Buildings and Floors Scene Group",E.matrixAutoUpdate=!1;var M={},C=null,T={materials:{building:new THREE.MeshBasicMaterial({color:255,transparent:!0,opacity:.3}),floor:new THREE.MeshBasicMaterial({color:16750848,transparent:!0,opacity:.3})},highlight_materials:{building:new THREE.MeshBasicMaterial({color:3394815,transparent:!0,opacity:.3}),floor:new THREE.MeshBasicMaterial({color:16764006,transparent:!0,opacity:.3})},edge_materials:{building:new THREE.LineBasicMaterial({color:255,linewidth:3}),floor:new THREE.LineBasicMaterial({color:13399808,linewidth:3})},circle_fill_material:new THREE.MeshBasicMaterial({color:16777215}),circle_line_material:new THREE.LineBasicMaterial({color:0,linewidth:2}),heights:{building:100,floor:99},marker_heights:{building:102,floor:101}},k=null,x={},I={},O={materials_solid:{},materials_edge:{}},P=function(){THREE.Triangulation.setLibrary("earcut"),g.addEventListener("transitionStart",A),g.addEventListener("floorChanged",L),f(),R()},R=function(t){e.all([n.initialized,r.initialized,c.initialized,a.fetchPolygons(t),i.fetchMaps(t)]).then(function(e){w=a.polygons,V(),oe()})},V=function(){w.forEach(function(e,t){Z(e)}),K(),q(),i.layers.forEach(function(e){S.add(j(e)),B(e)});var e=g.getMainView().getImage();h=e?e.floor_location_.z:void 0,H(),s.invalidateScene()},A=function(e){D(e.image)},L=function(e){D(e.floor.image)},D=function(e){S.parent||l.add(S),h=e?e.floor_location_.z:void 0,H(),s.invalidateScene()},N=function(e,t){return t=t||e,void 0===O.materials_solid[t]&&(O.materials_solid[t]=new THREE.MeshBasicMaterial({color:e,transparent:!0,depthWrite:!1,wireframe:!1})),O.materials_solid[t]},G=function(e,t){return t=t||e,void 0===O.materials_edge[t]&&(O.materials_edge[t]=new THREE.LineBasicMaterial({color:e,linewidth:1,transparent:!0,depthWrite:!1})),O.materials_edge[t]},U=function(e,t){var n=void 0!==e.vector_layer_id?e.vector_layer_id:t;return e.solid?N(e.color,n):G(e.color,n)},F=function(e){var t;if(t=angular.isNumber(e)?e:e.id,!(t in x)){var n=new THREE.Object3D;n.matrixAutoUpdate=!1,n.name=e.name,x[t]={scene_group:n,polygons:[]}}return x[t]},H=function(){i.layers.forEach(function(e){z(e)})},z=function(e){for(var t=h,n=null!=e.z_min&&null!=e.z_max&&t>=e.z_min&&t<e.z_max,a=d.data.current_floor&&(e.map_.name==d.data.current_floor.name||0==e.map_.name.indexOf("_")),i=void 0==e.visible_style_||e.visible_style_,o=e.visible&&i&&(n||a),r=1/(b*b),s=F(e).polygons,l=s.length,c=0;c<l;++c)for(var u=s[c],g=!u.area||void 0===r||u.area>=r,p=u.meshes.length,m=0;m<p;++m){var v=u.meshes[m];v.visible=(void 0===v.material||0!=v.material.opacity&&o)&&g}e.derived_layer&&(e.derived_layer.visible=e.visible,z(e.derived_layer))},j=function(e){return F(e).scene_group},B=function(e){var t=F(e).scene_group,n=0,a=e.drawing_order/1e4;return void 0!==e.z_min&&null!==e.z_min?t.position.z=e.z_min+a:t.position.z=n+a,t.renderOrder=-1e3,t.updateMatrix(),e.derived_layer&&(e.derived_layer.z_min=e.z_min,e.derived_layer.z_max=e.z_max,e.derived_layer.drawing_order=e.drawing_order+1e-6,B(e.derived_layer)),z(e),t},W=function(e){if(null!=e.vector_layer_id){var t=F(e.vector_layer_id);e.meshes.forEach(function(e){t.scene_group.add(e)}),t.polygons.push(e)}},K=function(){var e,a=angular.copy(I);try{e=JSON.parse(n.getString("layers.polygon.vector_map_style","{}"))}catch(i){e={},u.showMessage(t.getString("Vector map style sheet"),t.getString("Failed to parse vector map style sheet:")+" "+i)}return!angular.equals(a,e)&&(I=e,q(),!0)},q=function(){if("background-color"in I){var e=I["background-color"];s.renderer.setClearColor(new THREE.Color(e),s.renderer.getClearAlpha())}i.layers.forEach(function(e){J(e)})},J=function(e){var t={};for(prop in I)if(prop&&prop.length&&"#"==prop[0]){var n=new RegExp(prop.substring(1),"i");null!=e.name.match(n)&&angular.extend(t,I[prop])}if(e.visible_style_=void 0,"visible"in t&&(e.visible_style_=1==t.visible),"poi_types"in t){var a=!1;t.poi_types.forEach(function(e){var t=c.POITypeVisibility(e);a=a||void 0===t||t}),e.visible_style_=a}("color"in t||"solid"in t)&&F(e).polygons.forEach(function(e){"color"in t&&(e.color=t.color),"solid"in t&&(e.solid=1==t.solid),e.meshes.forEach(function(t){t.material=U(e),t.material.color.set(e.color),t.material.needsUpdate=!0})});var i=t.zoom_min?parseFloat(t.zoom_min):void 0,o=t.zoom_max?parseFloat(t.zoom_max):void 0;if(F(e).polygons.forEach(function(e){var t=U(e);t.userData||(t.userData={}),t.userData.zoom_min=i,t.userData.zoom_max=o}),"outline"in t&&t.outline===!0&&e.id>=0){var r=$.extend({},e);r.name+=".outline",r.id*=-1,r.drawing_order+=1e-6;var s=F(r);if(!s.polygons.length){e.derived_layer=r;var l={};F(e).polygons.forEach(function(e){var t=$.extend({},e);t.solid=!1,t.meshes=void 0,t.id*=-1,t.vector_layer_id*=-1,t.color=new THREE.Color(t.color),t.color.getHSL(l),l.l+=l.l>.5?-.4:.4,t.color.setHSL(l.h,l.s,l.l),Z(t),s.polygons.push(t)}),S.add(j(r)),B(r)}}z(e),e.derived_layer&&J(e.derived_layer)},Y=function(e){for(var t in e.polygon){var n=e.polygon[t],a=r.toGlobal(n);n.lon=a[0],n.lat=a[1]}},X=function(e){var t=function(e){for(var t in e){var n=e[t],a=r.toLocal(n.lon,n.lat,0);n.x=a.x,n.y=a.y,n.z=a.z}};t(e.polygon);for(var n in e.holes)t(e.holes[n])},Z=function(e){!function(e){e["delete"]=function(){p(e)}}(e),X(e);var t=performance.now();Q(e);var n=performance.now()-t;if(e.vector_layer_id in M||(M[e.vector_layer_id]=0),M[e.vector_layer_id]+=n,e.circles=[],e.editable)for(var a=0;a<e.polygon.length-1;a++)e.circles.push(ne(e.polygon[a],e));W(e)},Q=function(e,t){["building","floor"].indexOf(e.type)!==-1?(e.meshes={outline:ee(e,!0)[0],fill:te(e,t)[0]},E.add(e.meshes.outline),E.add(e.meshes.fill),s.invalidateScene()):e.solid?e.meshes=te(e):e.meshes=ee(e)},ee=function(e,t){var n,a;"map"===e.type?(n=U(e),a=0):(n=T.edge_materials[e.type],a=T.heights[e.type]);var i=function(e){var i=new THREE.Geometry;for(var o in e)i.vertices.push(new THREE.Vector3(e[o].x,e[o].y,a));t===!0&&i.vertices.push(new THREE.Vector3(e[0].x,e[0].y,a));var r=new THREE.Line(i,n);return r.matrixAutoUpdate=!1,r.raycastable=!1,r},o=[i(e.polygon)];return e.holes.forEach(function(e){o.push(i(e))}),o},te=function(e,t){var n,i;"map"===e.type?(n=U(e),i=0):(n=t===!0?T.highlight_materials[e.type]:T.materials[e.type],i=T.heights[e.type]);var o=function(e,t){t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);return t},r=new THREE.Shape;o(e.polygon,r);for(var s in e.holes){var l=new THREE.Path;o(e.holes[s],l),r.holes.push(l)}var c=new THREE.ShapeGeometry(r),d=new THREE.Mesh(c,n);return d.position.z=i,d.updateMatrix(),d.matrixAutoUpdate=!1,d.raycastable=!1,["building","floor"].indexOf(e.type)!==-1&&(d.raycastable=!0,d.onClick=function(){return a.drawing()===!1&&a.activePolygon(e),!0}),[d]},ne=function(e,t){var n=new THREE.CircleGeometry(.6,16),i=new THREE.CircleGeometry(.6,16);i.vertices.shift();var o=new THREE.Mesh(n,T.circle_fill_material),r=new THREE.Line(i,T.circle_line_material);return o.position.x=r.position.x=e.x,o.position.y=r.position.y=e.y,o.position.z=r.position.z=T.marker_heights[t.type],o.updateMatrix(),r.updateMatrix(),o.onDrag=function(e,n){if(void 0!==t.circles){C!==t&&a.activePolygon(t);for(var i=-1,r=0;r<t.circles.length;r++)if(t.circles[r].fill===o){i=r;break}var l=s.getPositionOnGroundPlane(e.x,e.y,T.heights[t.type],n);t.polygon[i].x=l.x,t.polygon[i].y=l.y,0===i&&(t.polygon[t.polygon.length-1].x=l.x,t.polygon[t.polygon.length-1].y=l.y),E.remove(t.meshes.outline),E.remove(t.meshes.fill),Q(t,!0),o.position.x=l.x,o.position.y=l.y,o.updateMatrix();var c=t.circles[i].outline;c.position.x=l.x,c.position.y=l.y,c.updateMatrix(),Y(t),a.saveLater(t)}},E.add(o),E.add(r),{outline:r,fill:o}},ae=function(e){if(e){var t=!1;S.children.forEach(function(e){e===E&&(t=!0)}),t===!1&&S.add(E)}else S.remove(E)};o.$watch(function(){return a.drawing()},function(e){e===!1&&f()}),a.registerUpdateCallback(y.unique_id,function(e){if("active polygon"===e){var t=a.activePolygon();null!==t&&m(t)}else"building visibility"===e&&ae(a.buildingsVisible())}),i.registerUpdateCallback(y.unique_id,function(e,t){if("updateVisibility"==e)null!==i.layers&&(i.layers.forEach(function(e){B(e)}),H(),s.invalidateScene());else if("removeVectorLayer"==e){var n=j(t);S.remove(n),s.invalidateScene()}else"newLayersUploaded"==e&&R(!0)}),c.registerUpdateCallback(y.unique_id,function(){q(),i.layers.forEach(function(e){B(e)})}),n.registerUpdateCallback(y.unique_id,function(){K()&&i.layers.forEach(function(e){B(e)})}),this.onClick=function(e){var t=a.drawing();if(t!==!1){var n=s.getPositionOnGroundPlane(e.x,e.y,T.heights[t],_);return k.type=t,v(n),!0}return!1},this.onContextMenu=function(){if(a.drawing())return a.drawing(!1),k.polygon.length<3?void f():(v(k.polygon[0],!0),Y(k),k.name="building"===k.type?t.getString("New building"):t.getString("New floor"),a.savePolygon(k).then(function(e){f(),w.push(e[0]),Z(e[0]),a.activePolygon(e[0])}),!1)},this.onBeforeRenderViewport=function(e){var t=e.getCamera(),n=e.getWidth()/(t.right-t.left);if(!isNaN(n)){var a=b!=n;b=n,a|=ie(O.materials_solid,n),a|=ie(O.materials_edge,n,4),a&&H()}};var ie=function(e,t,n,a){var i=!1;for(var o in e){var r=e[o],s=r.userData&&r.userData.zoom_min||n,l=r.userData&&r.userData.zoom_max||a,c=Math.min(void 0!==l?Math.min(1,1-(t-l)/l):1,void 0!==s?Math.max(0,(t-s)/s):1);i|=0==r.opacity&&c>0||r.opacity>0&&0==c,r.opacity=c}return i},oe=function(){var e={};i.layers.forEach(function(t){e[t.id]=t});var t=0,n=Object.keys(M).sort(function(e,t){return M[e]-M[t]});for(var a in n){var o=n[a];if("null"!==o){t++||console.log("Polygon triangulation times (sorted in ascending order):");var r=e[o<0?-o:o],s=o<0?" (outlines)":"";console.log(r.map_.name+" / "+r.name+s+": "+M[o].toFixed(1)+" ms")}}M={}};P()},{create:function(e,t,n){return new window.IV.layers.PolygonLayer(e,t,n)}}}]),IndoorViewerWebApp.service("RouteLayerFactory",["RouteService","GeoTransformationService",function(e,t){return window.IV.layers.RouteLayer=function(n,a,i){function o(e){var t=[2];t[0]=9007199254740992,t[1]=-1;for(var n=0;e.segments&&n<e.segments.length;n++){var a=e.segments[n];a.start_index<t[0]?t[0]=a.start_index:t[0],a.end_index>t[1]?t[1]=a.end_index:t[1]}return t}var r=this,s=null;i=i||{},i.visualization=i.visualization||"None",i.distance_threshold=i.distance_threshold||100;var l=THREE_IV.ImageUtils.loadTexture("img/green.png"),c=THREE_IV.ImageUtils.loadTexture("img/red.png"),d=THREE_IV.ImageUtils.loadTexture("img/black_arrow_up.png"),u=THREE_IV.ImageUtils.loadTexture("img/stairs_up.png"),g=THREE_IV.ImageUtils.loadTexture("img/stairs_down.png"),p=THREE_IV.ImageUtils.loadTexture("img/forward_blue.png"),m=THREE_IV.ImageUtils.loadTexture("img/forward_orange.png"),v=3,f=(Math.PI/4,[]),h=((1+Math.sqrt(5))/2,30),b=(new THREE.Geometry,new THREE.LineBasicMaterial({color:16711680,linewidth:5,transparent:!0,opacity:.8})),y=new THREE.LineBasicMaterial({color:16711680,linewidth:5,transparent:!0,opacity:.4}),_=new THREE.PlaneGeometry(.5,.5),w=new THREE.MeshBasicMaterial({map:l,transparent:!0,opacity:1}),S=new THREE.MeshBasicMaterial({map:c,transparent:!0,opacity:1}),E=new THREE.MeshBasicMaterial({map:u,transparent:!0,opacity:1}),M=new THREE.MeshBasicMaterial({map:g,transparent:!0,opacity:1}),C=new THREE.MeshBasicMaterial({map:d,transparent:!0,opacity:1}),T=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),k=(new THREE.Vector3(0,0,1),new THREE.Matrix4),x=new THREE.PlaneGeometry(.5,.5),I=new THREE.MeshBasicMaterial({map:p,transparent:!0,opacity:1,depthWrite:!1,side:THREE.DoubleSide}),O=new THREE.MeshBasicMaterial({map:p,transparent:!0,opacity:.3,depthWrite:!1,side:THREE.DoubleSide}),P=new THREE.MeshBasicMaterial({map:m,transparent:!0,opacity:1,depthWrite:!1,side:THREE.DoubleSide}),R=new THREE.MeshBasicMaterial({map:m,transparent:!0,opacity:.3,depthWrite:!1,side:THREE.DoubleSide});this.onBeforeRender=function(e){if(f.length>0){var t=n.getViewport(0,0);f[0].geometry.boundingSphere&&setMeshScreenSize(t,f,32)}},this.onTransitionEnd=function(){},this.onTransitionStart=function(l){e.registerUpdateCallback(r.unique_id,function(){r.onTransitionStart(l)}),a.remove(s),s=new THREE.Object3D,s.name="3dRoute",a.add(s);var c=i.distance_threshold*i.distance_threshold;if(e.routeData.waypoints&&e.routeData.waypoints.features.length>0){var d=e.routeData.floors;if(n.getImage())var u=n.getImage().floor_location_;else{var g=n.getCamera().position.z,u={};u.z=g-1.9}var p=e.routeData.interpolated_curve,m=e.routeData.dim_control_point,T=p.length/m,k=new THREE.Vector3(0,0,0),D=new THREE.Vector3(0,0,0),N=!1,G=!1;if(N){for(var U=new THREE.Geometry,F=e.routeData.waypoints.features.length,H=0;H<F;H++){var z=t.toLocal(e.routeData.waypoints.features[H].geometry.coordinates[0][0],e.routeData.waypoints.features[H].geometry.coordinates[0][1],e.routeData.waypoints.features[H].geometry.coordinates[0][2]);U.vertices.push(new THREE.Vector3(z.x,z.y,z.z))}var j=new THREE.Line(U,b);s.add(j)}if(G){for(var B=new THREE.LineBasicMaterial({color:65280,linewidth:5,transparent:!0,depthTest:!1,depthWrite:!1}),W=new THREE.Geometry,T=p.length/m,H=0;H<T;H++){var $=H*m;W.vertices.push(new THREE.Vector3(p[$+0],p[$+1],p[$+2]))}var j=new THREE.Line(W,B);s.add(j)}if("2d"==i.visualization){f=[],k.set(p[d[0][0]*m+0],p[d[0][0]*m+1],p[d[0][0]*m+2]);var K=V(_,w,k);f[f.length]=K,s.add(K);for(var q=0;q<d.length;q++){var J=d[q][0],Y=d[q][1],X=d[q][2],Z=J;q>0&&(Z=d[q-1][1]);var U=new THREE.Geometry,Q=(p[J*m+2]+p[Y*m+2])/2,ee=+Q.toFixed(1)-+u.z.toFixed(1);if(+Math.abs(ee).toFixed(0)<v){k.set(p[J*m+0],p[J*m+1],p[J*m+2]),D.set(p[Y*m+0],p[Y*m+1],p[Y*m+2]);for(var H=Z;H<=Y;H++){var $=H*m;U.vertices.push(new THREE.Vector3(p[$+0],p[$+1],p[$+2]))}var j=new THREE.Line(U,b);if(s.add(j),X>0){var K=V(_,E,D);f[f.length]=K,s.add(K)}else if(X<0){var K=V(_,M,D);f[f.length]=K,s.add(K)}var te=Math.abs(D.distanceTo(k));if(te<h){var z=Math.floor((J+Y)/2);k.set(p[(z-1)*m+0],p[(z-1)*m+1],p[(z-1)*m+2]),D.set(p[z*m+0],p[z*m+1],p[z*m+2]);var K=A(_,C,D,k,D);f[f.length]=K,s.add(K)}else for(var ne=Math.ceil(te/h),ae=(Y-J)/ne,ie=1;ie<ne;ie++){var z=Math.floor(J+ae*ie);k.set(p[(z-1)*m+0],p[(z-1)*m+1],p[(z-1)*m+2]),D.set(p[z*m+0],p[z*m+1],p[z*m+2]);var K=A(_,C,D,k,D);f[f.length]=K,s.add(K)}}else if(!e.render_options.single_floor){for(var H=Z;H<=Y;H++){var $=H*m;U.vertices.push(new THREE.Vector3(p[$+0],p[$+1],p[$+2]))}var j=new THREE.Line(U,y);s.add(j)}}k.set(p[d[d.length-1][1]*m+0],p[d[d.length-1][1]*m+1],p[d[d.length-1][1]*m+2]);var K=V(_,S,k);f[f.length]=K,s.add(K)}if("3d"==i.visualization)for(var oe=1,re=0,H=1;H<T;H++){k.set(p[(H-1)*m+0],p[(H-1)*m+1],p[(H-1)*m+2]),D.set(p[H*m+0],p[H*m+1],p[H*m+2]);var se=Math.abs(D.distanceTo(k));if(re+=se,re>=oe){if(k.distanceToSquared(u)>c||D.distanceToSquared(u)>c)continue;var K=null,le=D.clone(),ee=le.z-u.z;if(e.render_options.highlight_instruction>=0){var ce=e.routeData.instructions[e.render_options.highlight_instruction],de=o(ce);K=H>de[0]&&H<de[1]?Math.abs(ee)<v?A(x,P,le,k,D):A(x,R,le,k,D):Math.abs(ee)<v?A(x,I,le,k,D):A(x,O,le,k,D)}else K=Math.abs(ee)<v?A(x,I,le,k,D):A(x,O,le,k,D);if(s.add(K),se>=2*oe)for(var ue=Math.floor(se/oe),ge=L(0,1,ue+2),pe=ge.length,me=(Array.apply(null,new Array(m*pe)).map(Number.prototype.valueOf,0),1);me<pe;me++){var ve=k.clone().lerp(D,ge[me]),fe=A(x,K.material,ve,k,D);s.add(fe)}re=0}}}n.invalidateScene()};var V=function(e,t,n){var a=new THREE.Mesh(e,t);return a.position.copy(n),a.position.z+=.1,a.rotationAutoUpdate=!0,a},A=function(e,t,n,a,i){var o=new THREE.Mesh(e,t);o.position.copy(n),o.position.z+=.1,o.rotationAutoUpdate=!0;var r=i.clone().sub(a);k.identity();var s=new THREE.Vector3;s.crossVectors(T,r.normalize()).normalize();var l=Math.acos(T.dot(r));return k.makeRotationAxis(s.normalize(),l),o.rotation.setFromRotationMatrix(k),o};"undefined"==typeof Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180});var L=function(e,t,n){if("undefined"==typeof n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var a,i=Array(n);for(n--,a=n;a>=0;a--)i[a]=(a*t+(n-a)*e)/n;return i}},{create:function(e,t,n){return new window.IV.layers.RouteLayer(e,t,n)}}}]),angular.module("IVWebApp").run(["$templateCache",function(e){e.put("index.html",'<!doctype html><html lang="en"><head><title>NavVis Indoor Viewer</title><link rel="icon" type="image/x-icon" href="favicon.ico"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="stylesheet" href="/bower_components/components-font-awesome/css/font-awesome.css"><link rel="stylesheet" href="/bower_components/jQuery-contextMenu/dist/jquery.contextMenu.css"><link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css"><link rel="stylesheet" href="/bower_components/jquery-ui/themes/base/jquery-ui.css"><script type="text/javascript">\n\t\t// Set a global base path used by ckeditor without query parameters and hash part (refs #8172, #8929)\n\t\t// http://docs.ckeditor.com/#!/api/CKEDITOR-property-basePath\n\t\tCKEDITOR_BASEPATH = window.location.href.split(/[?#]/)[0];\n\t</script><script src="/node_modules/string.prototype.startswith/startswith.js"></script><script src="/bower_components/jquery/jquery.js"></script><script src="/bower_components/angular/angular.js"></script><script src="/bower_components/angular-animate/angular-animate.js"></script><script src="/bower_components/angular-cookies/angular-cookies.js"></script><script src="/bower_components/angular-sanitize/angular-sanitize.js"></script><script src="/bower_components/ng-file-upload/angular-file-upload-shim.js"></script><script src="/bower_components/ng-file-upload/angular-file-upload.js"></script><script src="/bower_components/Autolinker.js/dist/Autolinker.js"></script><script src="/bower_components/numericjs/src/numeric.js"></script><script src="/bower_components/numericjs/src/svd.js"></script><script src="/bower_components/XMLWriter/XMLWriter.js"></script><script src="/bower_components/tweenjs/src/Tween.js"></script><script src="/bower_components/stats.js/build/Stats.js"></script><script src="/bower_components/jquery-ui/ui/jquery-ui.js"></script><script src="/bower_components/jQuery-contextMenu/dist/jquery.contextMenu.js"></script><script src="/bower_components/jQuery-contextMenu/dist/jquery.ui.position.js"></script><script src="/bower_components/angular-resource/angular-resource.js"></script><script src="/bower_components/angular-ui-slider/src/slider.js"></script><script src="/bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script><script src="/bower_components/ckeditor/ckeditor.js"></script><script src="/bower_components/ng-ckeditor/ng-ckeditor.js"></script><script src="/bower_components/hammerjs/hammer.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.js"></script><script src="/bower_components/three.js/build/three.js"></script><script src="/bower_components/threex.rendererstats/threex.rendererstats.js"></script><script src="/bower_components/earcut/src/earcut.js"></script><script src="/bower_components/three.js_triangulation/triangulation.js"></script><script src="/bower_components/potree-navvis/build/js/potree.js"></script><script src="/bower_components/potree-navvis/libs/other/BinaryHeap.js"></script><script src="/bower_components/openlayers2/build/OpenLayers.js"></script><script src="/bower_components/angular-gettext/dist/angular-gettext.js"></script><script src="/bower_components/angular-local-storage/dist/angular-local-storage.js"></script><script src="/bower_components/ng-flow/dist/ng-flow-standalone.min.js"></script><script src="/bower_components/angular-scroll-glue/src/scrollglue.js"></script><script src="/bower_components/angular-progress-arc/angular-progress-arc.js"></script></head><body><div class="indoorViewerFull" ng-include="" src="\'iv.html\'"></div><script type="text/javascript">\n\t\tvar indoorViewer = new IndoorViewer();\n\t</script></body></html>'),e.put("iv.html",'<div ng-controller="UIController" class="vertical-menu" ng-show="isVerticalMenuOpened()"><div class="resize-handler" resize-handler="" direction="left" collapsed-size="19" min-expanded-size="375" collapse-threshold="100"></div><i class="fa fa-arrow-right expand-handler" aria-hidden="true" expand-handler="" direction="horizontal" collapsed-size="19" expanded-size="375"></i><div ng-include="" src="parentObj.vertical_menu" class="vertical-menu-content"></div></div><div ng-controller="BodyController" class="indoorViewer"><div id="mainScene" class="mainScene" tabindex="0" ng-show="modes.currentMode !== \'GeoRegistration\'"></div><div ng-include="" src="\'templates/LayerControllersParent.html\'"></div><div id="openLayersMap" class="open-layers-map" resize-event="ol_map.updateMapSize()" delay="100" ng-show="modes.currentMode === \'GeoRegistration\'" ng-controller="GeoRegOLMController" style="width:100%; height:100%"></div><div id="insetPanel" ng-show="visible.show_inset_view" ng-class="{ hover: visible.hover_inset_view }"><div id="insetScene" class="insetScene" tabindex="1"><div class="map_info"><div id="scale_div" ng-controller="MapScaleController" class="map_scale" ng-cloak="" ng-style="{width: scale_pixels() + \'px\'}">{{scale_unit()}}</div><div ng-controller="MapAttributionsController" class="map_attributions" title="{{share.attributions}}">{{share.attributions}}</div></div></div><div id="insetSceneButton"><span ng-click="swapScenes()" class="glyphicon glyphicon-resize-full"></span></div></div><div ng-controller="POIController"><div id="poiHoverPanel" ng-show="hover.poi" ng-style="{left: hover.x, top: hover.y}"><div ng-if="hover.poi"><div class="vtop"><img ng-src="{{hover.poi.getIcon()}}" class="poiIcon"></div><div class="vcenter padding-left">{{hover.poi.getCode()}}</div></div></div></div><div id="mainSceneUI"><div ng-include="" src="\'templates/Panel.html\'"></div></div><div id="rightControls"><div id="floorChanger"><div ng-include="" src="\'templates/FloorChanger.html\'"></div></div><div id="mapZoomControls" ng-if="visible.main_scene === \'map\' && modes.currentMode === \'normal\'"><div class="btn-group-vertical"><button type="button" class="btn btn-default" ng-click="zoomMapView(true)"><i class="fa fa-plus"></i></button> <button type="button" class="btn btn-default" ng-click="zoomMapView(false)"><i class="fa fa-minus"></i></button></div></div></div><div id="BLLinks" ng-class="{\'above-map-info\' : visible.main_scene === \'map\'}"><div ng-include="" src="\'templates/BLLinks.html\'"></div></div><div id="mainSceneUI-panels" ng-controller="UIController" clicked-outside-this-panel="hideOpenPanels()"><div class="menu-option-form" ng-include="" src="parentObj.menu"></div></div><div><div ng-include="" src="\'templates/menu/ModalsInMenus.html\'" clicked-outside-this-panel="hideOpenPanels()"></div></div><div ng-controller="MessageReportingController"><div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">{{message.title}}</h3></div><div class="modal-body" ng-bind-html="message.body"></div><div class="modal-footer"><ok-button data-dismiss="modal"></ok-button></div></div></div></div></div><div id="webGlMissing" class="webGlMissing" style="display: none;"><div ng-include="" src="\'templates/WebGLMissing.html\'"></div></div><div ng-include="" src="\'templates/ProgressReport.html\'"></div><div ng-include="" src="\'templates/StatusCheck.html\'" ng-if="UserService.isAdmin()"></div><div id="modal-cover" class="modal-progress-bg"></div></div>'),e.put("trolley.html",'<!doctype html><html lang="en"><head><title>NavVis Indoor Viewer</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style media="screen" type="text/css">\n\t\tiframe {\n\t\t\tposition: fixed;\n\t\t\ttop: 0px;\n\t\t\tleft: 0px;\n\t\t\tbottom: 0px;\n\t\t\tright: 0px;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder: none;\n\t\t}\n\n\t\t#close-btn {\n\t\t\tposition: fixed;\n\t\t\tleft: 10px;\n\t\t\tbottom: 10px;\n\n\t\t\tpadding:  .75rem 1.5rem;\n\t\t\tfont-size: 1.5rem;\n\t\t\tborder-radius: .3rem;\n\t\t\tborder: none;\n\n\t\t\tcolor: white;\n\t\t\tbackground-color: #3399c8;\n\t\t\toutline: none;\n\n\t\t\tcursor: pointer;\n\t\t}\n\t</style><script src="IndoorViewerAPI.js"></script></head><body><iframe id="iv" class="frame" src="./#?menu.newwindow.visible=false" allowfullscreen=""></iframe><button type="button" id="close-btn" class="" onclick="closeWindow()">Close</button><script type="text/javascript">\n\n\t\t// Wait for iframe to be ready\n\t\tdocument.getElementById(\'iv\').onload = function()\n\t\t{\n\t\t\t// Get the IV object of our iframe\n\t\t\tvar IndoorViewer = document.getElementById(\'iv\').contentWindow.IV;\n\n\t\t\t// Observe changes in the URL\n\t\t\tIndoorViewer.injector.get(\'$rootScope\').$on(\'$locationChangeStart\', function(event, toState, toParams, fromState, fromParams)\n\t\t\t{\n\t\t\t\t// Prevent adding a new item to the history\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t};\n\n\t\tfunction closeWindow()\n\t\t{\n\t\t\twindow.close();\n\t\t}\n\n\t</script></body></html>'),e.put("templates/BLLinks.html",'<a ng-if="ConfigService.getString(\'feedback.recipient.email\', false)" href="#" class="feedback" title="{{\'Feedback\'|translate}}" data-toggle="modal" data-target="#feedbackForm" translate="">Feedback</a><div ng-controller="HelpController" class="modal" id="feedbackForm" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" translate="">Feedback form</h4></div><div class="modal-body"><form name="feedback" ng-submit="sendFeedback(feedback.$valid)" novalidate=""><div class="form-group"><span translate="" translate-context="followed by *-symbol (also translatable)">Fields marked with this symbol are required:</span> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span></div><div class="form-group"><label translate="">First name</label> <input type="text" class="form-control" name="first_name" ng-model="first_name"></div><div class="form-group"><label translate="">Last name</label> <input type="text" class="form-control" name="last_name" ng-model="last_name"></div><div class="form-group"><label translate="">Email address</label> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span> <input type="email" class="form-control" name="user_email" ng-model="user_email" required=""><p ng-show="feedback.email.$invalid && !feedback.email.$pristine" class="help-block" translate="">Please enter a valid email address</p></div><div class="form-group"><label translate="">Feedback type</label><select class="form-control" ng-model="feedback_type" name="feedback_type"><option value="{{\'Error\'|translate}}" translate="">Error</option><option value="{{\'Suggestion\'|translate}}" translate="">Suggestion</option></select></div><div class="form-group"><label translate="">Message</label> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span> <textarea style="resize: vertical" class="form-control" rows="5" name="message" ng-model="message" required="">\n\t\t\t\t\t\t</textarea></div><div class="form-group" style="text-align:right; margin-bottom:0"><span ng-show="waiting_for_response" class="spinner next-to-btngroup" style="margin-right: 5px"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span><div class="btn-group" role="group" aria-label="..."><button type="button" class="btn btn-default" data-dismiss="modal" translate="">Close</button> <button type="submit" class="btn btn-primary" ng-disabled="feedback.$invalid || waiting_for_response" translate="">Submit</button></div></div></form></div><div class="modal-footer" style="text-align:left; margin-top:0;"><div ng-if="feedback_status === \'ERROR\'" style="margin-bottom: 0px;" class="alert alert-danger"><span translate="">Error while sending feedback.</span></div><div ng-if="feedback_status === \'SUCCESS\'" style="margin-bottom: 0px;" class="alert alert-success"><span translate="">Your feedback has been sent successfully.</span></div></div></div></div></div>'),
e.put("templates/BuildingPicker.html",'<form ng-controller="BuildingPickerController" class="form-horizontal" role="form"><div><div ng-show="!drawing()" class="form-group"><div class="col-sm-12"><label translate="">New polygon</label></div><div class="col-sm-12"><button type="button" ng-click="polygon.enableDrawing(\'building\')" class="btn btn-default col-sm-6" translate="">Draw a building</button> <button type="button" ng-click="polygon.enableDrawing(\'floor\')" class="btn btn-default col-sm-6" translate="">Draw a floor</button></div></div><div class="form-group" ng-show="!drawing()"><div class="col-sm-12"><label class="control-label" translate="">Building</label><select class="form-control" ng-model="data.activePolygon" ng-change="polygon.select(data.activePolygon)" ng-options="building as building.name for building in getPolygonsByType(\'building\')"></select></div><div class="col-sm-12"><label class="control-label" translate="">Floor</label><select class="form-control" ng-model="data.activePolygon" ng-change="polygon.select(data.activePolygon)" ng-options="floor as floor.name for floor in getPolygonsByType(\'floor\')"></select></div></div><div ng-show="drawing()" translate="">Click on the map to add a vertex. Right-click anywhere to finish the polygon.</div><div ng-show="data.activePolygon && !drawing()" class="form-group"><div class="col-sm-12"><label translate="">Properties</label> <button type="button" ng-click="polygon.delete()" class="btn btn-default" style="float: right" translate="">Delete</button></div><div class="col-sm-12"><label class="control-label" translate="">Name</label> <input type="text" class="col-sm-12 form-control" ng-model="data.activePolygon.name" ng-change="polygon.onChange(data.activePolygon.name, \'{{ data.activePolygon.name }}\')"></div><div class="col-sm-6"><label class="control-label" translate="">Minimum height</label> <input type="number" class="col-sm-12 form-control" ng-model="data.activePolygon.z_min" step="0.01" ng-change="polygon.onChange(data.activePolygon.z_min, \'{{ data.activePolygon.z_min }}\')"></div><div class="col-sm-6"><label class="control-label" translate="">Maximum height</label> <input type="number" class="col-sm-12 form-control" ng-model="data.activePolygon.z_max" step="0.01" ng-change="polygon.onChange(data.activePolygon.z_max, \'{{ data.activePolygon.z_max }}\')"></div></div><div ng-show="floor.floor !== null" class="form-group"><div class="col-sm-12"><label translate="">Floor names for each building</label><div ng-repeat="level in floor.levels">{{ polygon.names[level.building] }}: <input type="text" class="col-sm-12 form-control" ng-model="floor.levels[level.building].name" ng-change="floor.onChange(level.building)" placeholder="{{data.activePolygon.name}}"></div><div ng-show="floor.num_levels === 0" translate="">This floor does not intersect any buildings.</div></div></div></div></form>'),e.put("templates/FloorChanger.html",'<div ng-controller="FloorChangerController" ng-show="isVisible()"><div class="btn-group-vertical"><button type="button" class="btn btn-default" ng-click="changeFloor(data.floor_above)" ng-class="getClassUp()"><i class="fa fa-arrow-up"></i></button> <button type="button" ng-repeat="floor in data.floors | reverse" class="btn btn-default" ng-click="changeFloor(floor)" ng-class="getClass(floor)" title="{{floor.dataset.title}}">{{floor.name}}</button> <button type="button" class="btn btn-default" ng-click="changeFloor(data.floor_below)" ng-class="getClassDown()"><i class="fa fa-arrow-down"></i></button></div></div>'),e.put("templates/LayerControllersParent.html",'<div ng-controller="PointCloudLayerController"><div ng-show="modes.currentMode ===\'datasetAlignment\'"><div class="viewport-label viewport-label-top-left" ng-show="cameraAndViewportService.getViewportByName(\'TVCamera\').active" style="background-color: {{modes.datasetAlignment.viewports[1].colorCSS}}"><span class="fa fa-camera"></span> {{modes.datasetAlignment.viewports[1].caption|translate}}</div><div class="viewport-label viewport-label-bottom-left" ng-show="cameraAndViewportService.getViewportByName(\'SVCamera2\').active" style="background-color: {{modes.datasetAlignment.viewports[3].colorCSS}}"><span class="fa fa-camera"></span> {{modes.datasetAlignment.viewports[3].caption|translate}}</div><div class="viewport-label viewport-label-bottom-right" ng-show="cameraAndViewportService.getViewportByName(\'SVCamera1\').active" style="background-color: {{modes.datasetAlignment.viewports[2].colorCSS}}"><span class="fa fa-camera"></span> {{modes.datasetAlignment.viewports[2].caption|translate}}</div><div ng-show="!cameraAndViewportService.fullWindowOn"><div class="viewport-separator horizontal-viewport-separator"></div><div class="viewport-separator vertical-viewport-separator"></div></div></div></div>'),e.put("templates/LeftPanel.html",'<script type="text/ng-template" id="template/typeahead/poi.html"><a tabindex="-1"> <div ng-bind-html="match.model.getCode() | typeaheadHighlight:query" class="poiSearchName"></div> </a></script><div ng-controller="POIController"><div class="search-box left-panel-element" ng-if="ConfigService.getBoolean(\'ui.search.visible\', true) && config.show_search"><div class="form"><div class="input-group"><input type="text" class="form-control" id="searchInput" ng-model="selected.poi" typeahead="poi as poi.getCode() for poi in search($viewValue, \'search\')" typeahead-template-url="template/typeahead/poi.html" typeahead-editable="false" placeholder="{{\'Search\'|translate}}" typeahead-on-select="selectPOI($item)"> <span class="input-group-addon"><span class="fa fa-search"></span></span></div></div></div><div ng-show="!LicenseService.isLicenseValid() && modes.currentMode === \'normal\'" class="alert alert-danger iv-panel-warning"><span class="fa fa-exclamation-triangle" aria-hidden="true"></span><div><strong translate="">Invalid instance key!</strong> <span translate="">This instance of IndoorViewer does not have an instance key or the existing instance key is currently not valid! Please contact your service provider to get a valid key.</span></div></div><div ng-hide="!selected.poi && !routing.start && !routing.end" ng-if="ConfigService.getBoolean(\'ui.poi_panel.visible\', true)"><div ng-include="" src="\'templates/poi/POIDetails.html\'"></div><div ng-include="" src="\'templates/Routing.html\'"></div></div></div><div class="left-panel-element" ng-class="hidePanel ? \'slide-left\' : \'slide-right\'" ng-include="" src="\'templates/NavGraphEditor.html\'" ng-controller="NavGraphEditingController"></div><div class="left-panel-element" ng-include="" src="\'templates/Measurements.html\'"></div><div class="left-panel-element" ng-include="" src="\'templates/VectorMapEditor.html\'"></div>'),e.put("templates/Measurements.html",'<div id="measurementsPanel" ng-controller="MeasurementsController"><div class="modal" id="eraseMarkers" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="erase-markers-unsaved-changes erase-markers-clear-all" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="erase-markers-unsaved-changes" translate="">Confirm</h4></div><div class="modal-body"><p translate="">You have unsaved changes.</p></div><div class="modal-footer"><abort-button data-dismiss="modal" ng-click="architectureMarkerService.updateConfig()"></abort-button><discard-button data-dismiss="modal" ng-click="architectureMarkerService.clearAllLocally()"></discard-button><save-button data-dismiss="modal" ng-click="architectureMarkerService.saveAll(); architectureMarkerService.clearAllLocally()"></save-button></div></div></div></div><div class="modal" id="clearMeasurements" tabindex="-1" role="dialog" aria-labelledby="clearMeasurementsLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="erase-markers-clear-all" translate="">Confirm</h4></div><div class="modal-body" translate="">All measurements will be deleted.</div><div class="modal-footer"><cancel-button data-dismiss="modal" ng-click="architectureMarkerService.updateConfig()"></cancel-button><delete-button data-dismiss="modal" ng-click="architectureMarkerService.clearAll()"></delete-button></div></div></div></div><div ng-if="architectureMarkerService.showMenu();" class="panel panel-default panel-autoscroll"><div class="panel-heading" translate="">Measurements</div><div class="panel-body"><div class="row"><div class="btn-group col-lg-12" data-toggle="buttons"><div class="btn btn-default" type="button" ng-click="architectureMarkerService.lockAxes(true, false)"><input type="radio" name="options" id="option1"> <span class="glyphicon glyphicon-resize-vertical"></span> <span translate="">Vertical</span></div><div class="btn btn-default" type="button" ng-click="architectureMarkerService.lockAxes(false, true)"><input type="radio" name="options" id="option2"> <span class="glyphicon glyphicon-resize-horizontal"></span> <span translate="">Horizontal</span></div><div class="btn btn-default active" type="button" ng-click="architectureMarkerService.lockAxes(false, false)"><input type="radio" name="options" id="option3" checked=""> <span class="glyphicon glyphicon-asterisk"></span> <span translate="">Free</span></div></div></div><div class="row space-from-top-between-rows"><div class="btn-group col-lg-12" data-toggle="buttons"><div class="btn btn-default" type="button" ng-repeat="unit in units" ng-click="selectUnit(unit)" ng-class="{active: unit == unitSelected}"><input type="radio" name="units" id="{{unit.string}}"> {{unit.name}}</div></div></div></div><div class="panel-footer" ng-if="isSaveAllowed() && (architectureMarkerService.areAnySaved() || architectureMarkerService.hasUnsavedChanges())"><div class="btn-toolbar"><save-button ng-show="architectureMarkerService.hasUnsavedChanges()" ng-click="architectureMarkerService.saveAll()"></save-button><delete-button ng-show="architectureMarkerService.areAnySaved()" data-toggle="modal" data-target="#clearMeasurements"></delete-button></div></div></div></div>'),e.put("templates/MenuBar.html",'<div ng-controller="MenuController"><div class="navbar navbar-default"><ul class="nav navbar-custom navbar-custom-right"><li ng-repeat="optionName in config.optionOrderInMenu" ng-show="config.options[optionName].isVisible()" ng-class="config.options[optionName].getClass()" title="{{config.options[optionName].title | translate}}"><a ng-click="toggleMenu(optionName)"><i class="{{config.options[optionName].icon}}"></i></a></li></ul></div></div>'),e.put("templates/NavGraphEditor.html",'<div class="modal in" id="editAttributes" tabindex="-1" role="dialog" aria-labelledby="editAttributes" aria-hidden="false"><div ng-include="" src="\'templates/navgraph/AttributeEditor.html\'"></div></div><div class="nav-graph-panel"><div class="modal in" id="bundle-make-non-public-warning-dialog" tabindex="-1" role="dialog" aria-labelledby="makeNotPublic" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div class="panel panel-default" ng-if="visible.showNavGraph"><div class="panel-heading" translate="">Navigation graph editor</div><div class="panel-body panel-autoscroll"><div class="row form-group" ng-if="!navGraphService.rendering.nav_graph_present"><div class="col-xs-12" translate="">No navigation graph</div></div><label translate="">Dataset bundle</label><div class="form-group"><select ng-options="bundle.id as bundle.id for bundle in navGraphService.bundles" ng-model="navGraphService.config.bundle_current"></select></div><div ng-if="!navGraphService.getBundle(navGraphService.config.bundle_current).security_.can_write" translate="">No permission to edit this navigation graph</div><div class="form" ng-if="navGraphService.rendering.nav_graph_present"><div ng-if="navGraphService.editing.selected_nodes.length"><label translate="">Edit nodes and edges</label><div class="form-group btn-toolbar"><div class="btn-group" style="margin-bottom:4px"><button type="button" class="btn btn-default" ng-click="navGraphService.editing.deleteNode(0)"><span translate="">Delete</span> <i class="fa fa-stop" style="color:#0000ff"></i></button><button type="button" class="btn btn-default" ng-click="openAttributeEditor(\'node\', 0)"><span translate="">Edit</span> <i class="fa fa-stop" style="color:#0000ff"></i></button></div><div class="btn-group" style="margin-bottom:4px"><button ng-if="navGraphService.editing.doesEdgeExist() === 0" type="button" class="btn btn-default" ng-click="navGraphService.editing.createEdge()" translate="">Create edge</button> <button ng-if="navGraphService.editing.doesEdgeExist() === 1" type="button" class="btn btn-default" ng-click="navGraphService.editing.deleteEdge()" translate="">Delete edge</button> <button ng-if="navGraphService.editing.doesEdgeExist() === 1" type="button" class="btn btn-default" ng-click="openAttributeEditor(\'edge\', 0, 1)" translate="">Edit edge</button></div><div class="btn-group" style="margin-bottom:4px"><button type="button" ng-if="navGraphService.editing.selected_nodes.length > 1" class="btn btn-default" ng-click="navGraphService.editing.deleteNode(1)"><span translate="">Delete</span> <i class="fa fa-stop" style="color:#8080FF"></i></button><button type="button" ng-if="navGraphService.editing.selected_nodes.length > 1" class="btn btn-default" ng-click="openAttributeEditor(\'node\', 1)"><span translate="">Edit</span> <i class="fa fa-stop" style="color:#8080FF"></i></button></div></div><label translate="">Raise or lower nodes</label><div class="form-group btn-toolbar"><div class="btn-group"><button type="button" class="btn btn-default" ng-click="navGraphService.editing.moveNodeInZ(0, false)">z- <i class="fa fa-sort-desc" style="color:#0000ff"></i></button> <button type="button" class="btn btn-default" ng-click="navGraphService.editing.moveNodeInZ(0, true)">z+ <i class="fa fa-sort-asc" style="color:#0000ff"></i></button></div><div class="btn-group"><button type="button" class="btn btn-default" ng-if="navGraphService.editing.selected_nodes.length > 1" ng-click="navGraphService.editing.moveNodeInZ(1, false)">z- <i class="fa fa-sort-desc" style="color:#8080FF"></i></button> <button type="button" class="btn btn-default" ng-if="navGraphService.editing.selected_nodes.length > 1" ng-click="navGraphService.editing.moveNodeInZ(1, true)">z+ <i class="fa fa-sort-asc" style="color:#8080FF"></i></button></div></div></div><div ng-if="navGraphService.getBundle(navGraphService.config.bundle_current).security_.can_write"><label translate="">Advanced</label><div class="form-group row"><div class="input-group col-md-4" style="float:left; padding:0 15px; margin-bottom:5px"><span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="navGraphService.editing.addMultipleEdges();" title="{{\'Insert n number of edges between selected nodes\'|translate}}" ng-disabled="navGraphService.editing.selected_nodes.length <= 1">-.-.-</button></span> <input type="text" class="form-control" ng-model="navGraphService.editing.in_betw_edges" style="max-height:32px" ng-disabled="navGraphService.editing.selected_nodes.length <= 1"></div><div class="input-group col-md-4" style="float:left; padding:0 15px; margin-bottom:5px"><span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="navGraphService.editing.straightenNodes();" title="{{\'Straighten the last n edges\'|translate}}" ng-disabled="navGraphService.editing.selected_nodes.length <= 1">----</button></span> <input type="text" class="form-control" ng-model="navGraphService.editing.straighten_x_nodes" style="max-height:32px" ng-disabled="navGraphService.editing.selected_nodes.length <= 1"></div></div><div class="form-group" ng-include="" src="\'templates/PermissionsEditor.html\'"></div><label translate="">Changes</label><div class="form-group btn-toolbar"><undo-button ng-click="navGraphService.editing.undo()" ng-disabled="isHistoryEmpty()" title="{{\'Undo last operation\'|translate}}"></undo-button><save-button ng-click="navGraphService.editing.saveAndStopEditingNavGraph()" title="{{\'Save all operations\'|translate}}"></save-button></div><div ng-hide="isHistoryEmpty()"><label translate="">History</label><div class="list-group"><div class="list-group-item navgraph-history-item" ng-repeat="editing_operation in navGraphService.editing.history_manager.getHistoryOperations() | reverse" ng-click="navGraphService.editing.selectEditingOperationResource(editing_operation)"><span>{{ editing_operation.getDescription() }}</span></div></div></div></div></div></div></div></div>'),e.put("templates/Panel.html",'<div id="UI" ng-controller="UIController" clicked-outside-this-panel="hideOpenPanels()"><div class="threeD-overlay" ng-include="" src="\'templates/LeftPanel.html\'" ng-show="modes.currentMode === \'normal\'"></div><div class="fixed-menu-bar" ng-include="" src="\'templates/MenuBar.html\'"></div><div ng-include="" src="\'templates/poi/POIDialogs.html\'" ng-controller="POIController"></div></div>'),e.put("templates/PermissionsEditor.html",'<div ng-show="UserService.isUserLoggedIn()" class="permissions-editor-inline"><div class="row"><div class="col-xs-6"><label translate="" translate-context="noun">View</label><select class="form-control" ng-model="edited.group_read" ng-options="group.id as (GroupService.getGroupIndent(group, \'-\') + \' \' + group.name) for group in GroupService.getGroupsAsArray()" options-disabled="!GroupService.isGroupSelectable(group) for group in GroupService.getGroupsAsArray()" ng-change="GroupService.groupChanged(edited, objectType)"></select></div><div class="col-xs-6"><label translate="" translate-context="noun">Edit</label><select class="form-control" ng-model="edited.group_write" ng-options="group.id as (GroupService.getGroupIndent(group, \'-\') + \' \' + group.name) for group in GroupService.getGroupsAsArray()" options-disabled="!GroupService.isGroupSelectable(group) for group in GroupService.getGroupsAsArray()" ng-change="GroupService.groupChanged(edited, objectType)"></select></div></div></div>'),e.put("templates/ProgressReport.html",'<div ng-cloak="" ng-controller="ProgressReportController" id="progress-wrapper"><div class="progress-report" ng-class="{ \'modal-progress\': isModal(), \'fade-out\': !isVisible(), \'compact-progress\': compactOnly() }"><div class="progress-report-container" ng-if="!compactOnly()"><div class="task" ng-repeat="task in data.tasks" ng-class="task.hide_progress ? \'no-progress\' : null" ng-if="!task.compact"><span class="spinner"><img ng-src="img/tail-spin.svg"></span>{{task.name}}<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" ng-attr-aria-valuenow="{{task.percentage > 1 ? task.percentage : 1}}" aria-valuemin="0" aria-valuemax="100" ng-style="{width: (task.percentage > 1 ? task.percentage : 1) + \'%\'}"><span class="sr-only" translate="" translate-params-percent="task.percentage">{{percent}}% complete</span></div></div></div></div><div class="compact-progress-container" ng-if="compactOnly()" ng-repeat="task in data.tasks"><progress-arc ng-if="task.percentage > 0 && task.percentage < 100" title="{{task.name}}" size="32" stroke-width="7" complete="task.percentage / 100"></progress-arc></div></div><div class="modal-progress-bg" ng-class="isVisible() && isModal() ? null : \'fade-out\'"></div></div>'),e.put("templates/Routing.html",'<div class="panel panel-default left-panel-element-flexible-height" ng-controller="RouteController" ng-hide="!routing.start && !routing.end"><div class="panel-heading"><div class="row"><div class="col-xs-6"><h3 class="panel-title"><div class="header-icon-empty"></div><span translate="">Route</span></h3></div><div class="col-xs-6 pull-right"><div class="btn-toolbar" role="toolbar"><div class="btn-group"><button title="{{\'Toggle 2D route rendering between current floor and all floors\'|translate}}" class="btn btn-default" type="button" ng-click="toggle2DVisualization()"><span class="glyphicon glyphicon-retweet"></span></button></div><div class="btn-group"><button title="{{\'Reverse route\'|translate}}" class="btn btn-default" type="button" ng-click="reverseRoute()"><span class="glyphicon glyphicon-random"></span></button></div><div class="btn-group"><button class="btn btn-default" type="button" ng-click="routing.start=null; routing.end=null"><span class="glyphicon glyphicon-remove"></span></button></div></div></div></div></div><div class="panel-body panel-autoscroll route-instructions-height"><div class="row"><div class="col-xs-2" translate="">From:</div><div class="col-xs-10"><span ng-hide="routing.start"><i translate="">Please select route start</i></span> <span ng-hide="!routing.start"><a href="" ng-click="selectPOI(routing.start)">{{routing.start.getCode()}}</a></span></div></div><div class="row"><div class="col-xs-2" translate="">To:</div><div class="col-xs-10"><span ng-hide="routing.end"><i translate="">Please select route destination</i></span> <span ng-hide="!routing.end"><a href="" ng-click="selectPOI(routing.end)">{{routing.end.getCode()}}</a></span></div></div><div class="route-instructions" ng-hide="!route.instructions && !route.message"><div class="row" ng-repeat="instruction in route.instructions track by $index"><div class="col-xs-1 vcenter"><img ng-src="img/{{instruction.icon.toLowerCase()}}.png" class="route-icon"></div><div class="col-xs-11 vcenter"><a href="" ng-click="moveToRouteInstruction($index)" ng-mouseover="routeInstructionMouseOver($index)" ng-mouseleave="routeInstructionMouseLeave($index)">{{instruction.text | translate}}</a></div></div><div class="row" ng-hide="!route.message"><div class="col-xs-12">{{route.message | translate}}</div></div></div></div></div>'),e.put("templates/StatusCheck.html",'<div ng-cloak="" ng-controller="StatusCheckController" id="status-check-wrapper" press-key=\'{ "esc" : "server_status.dismiss()" }\' tabindex="-1" init-focus=""><div class="modal-progress transparent" ng-show="!server_status.dismissed && show_status && getGlobalStatus() !== undefined && getGlobalStatus() !== \'UP\'"><div class="panel panel-default"><div class="panel-heading" translate="">The IndoorViewer server is not configured correctly</div><div class="panel-body"><p translate="">The following issues have been found:</p><ul><li ng-show="server_status.data.health.db.status === \'DOWN\'"><span translate="">The server database is not available.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#db-unavailable\')}}" translate="">Documentation</a></li><li ng-show="server_status.data.health.dataDir.readable === false"><span translate="">IndoorViewer cannot read the resources directory.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#resources-dir-unreadable\')}}" translate="">Documentation</a></li><li ng-show="server_status.optional.without_users_auth_with_datasets === false"><span translate="">No datasets have been added to this IndoorViewer installation. Please add some.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#no-datasets\')}}" translate="">Documentation</a></li><li ng-show="server_status.optional.logged_in_user_with_datasets === false"><span translate="">No datasets visible to you have been added to this IndoorViewer installation. Please add some, sign in with another account or ask the administrator to grant permission.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#no-datasets\')}}" translate="">Documentation</a></li><li ng-show="server_status.data.health.uploadDir.writable === false"><span translate="">IndoorViewer cannot write into the upload directory.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#no-datasets\')}}" translate="">Documentation</a></li><li ng-show="server_status.data.health.flyway.cause === \'pending\'"><span translate="">The database version is outdated.</span></li><li ng-show="server_status.data.health.flyway.cause === \'failed\'"><span translate="">Database migration has failed.</span></li><li ng-show="server_status.data.health.pcs.status === \'DOWN\'"><span translate="">PointCloudServer is not available.</span> <a ng-href="{{server_status.getDocsLink(\'troubleshooting.html#pcs-unavailable\')}}" translate="">Documentation</a></li><li ng-show="server_status.modeless.guest_with_datasets === false"><span translate="">You are a guest user without access to any dataset. Please sign in (and configure User Authentication provider in Settings menu if needed)</span></li></ul></div><div class="panel-footer" style="text-align:right"><ok-button ng-click="server_status.dismiss()"></ok-button></div></div></div></div>'),e.put("templates/VectorMapEditor.html",'<div ng-controller="VectorMapEditingController" class="vector-map-editor"><div class="modal in" id="vector_map-make-non-public-warning-dialog" tabindex="-1" role="dialog" aria-labelledby="makeNotPublic" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div class="panel panel-default" ng-if="visible.showVectorMapEditor"><div class="panel-heading" translate="">Vector map editor</div><div class="panel-body panel-autoscroll"><div class="alert alert-info" ng-if="vectorMapService.layers.length == 0" style="margin-bottom:0" translate="">No vector layers are present in the database yet.</div><ul class="list-group"><li ng-repeat="map in vectorMapService.maps | orderBy: \'name\'" class="list-group-item"><div><div class="row" ng-class="{\'selected\': map.selected_}" ng-click="toggleMapSelection(map); $event.stopPropagation()"><div class="col-md-1"><span ng-class="map.expanded_ ? \'glyphicon-chevron-down\' : \'glyphicon-chevron-right\'" class="icon expand-icon glyphicon" ng-click="toggleMapExpansion(map); $event.stopPropagation()"></span></div><div class="col-md-7"><span ng-if="!map.state_.inEdit">{{ map.name }} <span class="fa fa-pencil edit-button" aria-hidden="true" ng-show="map.security_.can_write" ng-click="startEditing(map); $event.stopPropagation()"></span></span> <span ng-if="map.state_.inEdit"><input class="form-control" ng-model="map.name" ng-if="map.state_.inEdit" ng-click="$event.stopPropagation()" press-key=\'{ "enter" : "endEditing(map)", "esc" : "cancelEditing(map)" }\' init-focus="" keep-focus=""> <button type="button" class="btn btn-default" ng-click="endEditing(map); $event.stopPropagation()"><span class="fa fa-check" aria-hidden="true"></span></button> <button type="button" class="btn btn-default" ng-click="cancelEditing(map); $event.stopPropagation()"><span class="fa fa-times" aria-hidden="true"></span></button></span><span ng-if="!map.state_.inEdit" class="badge" title="{{\'Polygons | Vertices\'|translate}}">{{map.stats_.polygons}} | {{map.stats_.vertices}}</span></div><div class="col-md-4" ng-show="map.security_.can_write"><input type="text" value="" size="5" placeholder="z_min" ng-model="map.z_min" ng-blur="vectorMapService.updateZ(map)" ng-model-options="{ updateOn: \'blur\' }" ng-click="$event.stopPropagation()"> <input type="text" value="" size="5" placeholder="z_max" ng-model="map.z_max" ng-blur="vectorMapService.updateZ(map)" ng-model-options="{ updateOn: \'blur\' }" ng-click="$event.stopPropagation()"></div></div></div><div ng-repeat="edited in [map]" ng-include="" src="\'templates/PermissionsEditor.html\'" ng-if="map.state_.inEdit"></div><ul class="list-group-item list-group" ng-if="map.expanded_" style="margin-bottom:20px"><li ng-repeat="layer in map.layers_ | orderBy: \'drawing_order\'" class="list-group-item"><div class="container"><div class="row" ng-class="{\'selected\': layer.selected_}" ng-click="toggleLayerSelection(layer); $event.stopPropagation()"><div class="col-md-11"><div class="data-set-icon thin-border-dark" style="background-color: {{layer.color}}"></div>{{ layer.name }}<span class="badge" title="{{\'Polygons | Vertices\'|translate}}">{{layer.stats_.polygons}} | {{layer.stats_.vertices}}</span></div><div class="col-md-1 toggle-visibility"><span class="glyphicon glyphicon-eye-open" ng-if="layer.visible" ng-click="toggleVisibility(layer); $event.stopPropagation()"></span> <span class="glyphicon glyphicon-eye-close" ng-if="!layer.visible" ng-click="toggleVisibility(layer); $event.stopPropagation()"></span></div></div></div></li></ul></li></ul></div><div class="panel-footer"><div class="btn-toolbar" role="toolbar"><div class="btn-group" role="group"><button title="{{\'Select all\'|translate}}" type="button" class="btn btn-default" ng-click="selectAll()"><span class="fa fa-check-square-o" aria-hidden="true"></span></button> <button title="{{\'Deselect all\'|translate}}" type="button" class="btn btn-default" ng-click="deselectAll()"><span class="fa fa-square-o" aria-hidden="true"></span></button></div><div class="btn-group" role="group"><button title="{{\'Show selected layers\'|translate}}" type="button" class="btn btn-default" ng-click="selectionSetVisibility(true)"><span class="glyphicon glyphicon-eye-open"></span></button> <button title="{{\'Hide selected layers\'|translate}}" type="button" class="btn btn-default" ng-click="selectionSetVisibility(false)"><span class="glyphicon glyphicon-eye-close"></span></button></div><div class="btn-group" role="group"><button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmDeleteLayer" ng-disabled="!anySelected() || !checkSelectionWritePermissions()" translate="">Delete</button></div><div class="btn-group" role="group"><span class="btn btn-default btn-file" ng-disabled="!login_service.getUserInfo().checkAttribute(\'can_create_polygons\')"><span translate="">Upload DXF</span> <input type="file" ng-file-select="uploadDXF($files)"></span></div></div></div><div class="alert alert-info" ng-if="is_upload_progress" style="margin:10px 15px" translate="">Uploading...</div><div class="alert alert-success" ng-if="is_upload_success" style="margin:10px 15px" translate="" translate-n="upload_result.count_layers" translate-params-amount="upload_result.count_layers" translate-plural="Upload successful: {{amount}} vector layers found.">Upload successful: one vector layer found.</div><div class="alert alert-danger" ng-if="is_upload_error" style="margin:10px 15px" translate="">Upload failed</div></div><div class="modal" id="invalidPolygonsModal" tabindex="-1" role="dialog" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" translate="">Layers with problematic polygons</h4></div><div class="modal-body"><ul><li ng-repeat="(layer_name, invalid_polygons) in layers_with_invalid_polygons"><em>{{layer_name}}:</em> <span translate="" translate-params-amount="invalid_polygons">{{amount}} of problematic polygons</span></li><li ng-repeat="(layer_name, invalid_loops) in layers_with_invalid_loops"><em>{{layer_name}}:</em> <span translate="" translate-params-amount="invalid_loops">{{amount}} discarded boundary loops</span> <span ng-if="layers_with_invalid_loops_depth[layer_name] > 0"><span translate="" translate-context="The comma in the beginning is because this is added to the \'{{amount}} discarded boundary loops\' string." translate-params-amount="layers_with_invalid_loops_depth[layer_name]">, {{amount}} discarded boundary loops because they are islands or intersect with another boundary loop</span></span></li></ul><span translate="">Please simplify your DXF file.</span></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" translate="">Okay</button></div></div></div></div><div class="modal" id="confirmDeleteLayer" tabindex="-1" role="dialog" aria-labelledby="confirmDelType" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" translate="">Confirm</h4></div><div class="modal-body" translate="">This action will delete the selected vector layers.</div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" translate="">Cancel</button> <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="selectionRemove()" translate="">Okay</button></div></div></div></div></div>'),
e.put("templates/WarningDialog.html",'<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">{{warningDialogConfig.TITLE | translate}}</h4></div><div class="modal-body"><p style="margin: 14px 0">{{warningDialogConfig.TEXT | translate}}</p></div><div class="modal-footer" style="margin-top: 0"><cancel-button ng-click="warningCancelHandler()" data-dismiss="modal"></cancel-button><ok-button ng-click="warningContinueHandler()">Continue</ok-button></div></div></div>'),e.put("templates/WebGLMissing.html",'<h1 translate="">Your browser or system does not support WebGL</h1><h2 translate="">WebGL could not be initialized.</h2><p><span translate="">Please make sure your browser and graphics hardware support WebGL.</span><br><span translate="">Recent versions of Google Chrome and Mozilla Firefox should work fine:</span> <a href="http://www.google.com/chrome/" target="_blank">Google Chrome,</a> <a href="http://www.mozilla.org/firefox" target="_blank">Mozilla Firefox</a></p><p><span translate="">You can visit this page for information on how to get a WebGL implementation:</span> <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">Getting a WebGL Implementation</a></p><p><span translate="">You can test if your browser supports WebGL with the following link:</span> <a href="http://get.webgl.org/" target="_blank">get.webgl.org</a></p>'),e.put("templates/blank.html",""),e.put("templates/alignment/AlignmentHelpers.html",'<div class="panel panel-default" style="margin-bottom: 10px"><div class="panel-heading"><a data-toggle="collapse" data-parent="#accordion" href="#collapse-alignment-view" aria-expanded="true" aria-controls="collapse-alignment-view" translate="">View configuration</a></div><div id="collapse-alignment-view" class="panel-collapse collapse"><div class="panel-body"><div class="checkbox"><label><input type="checkbox" ng-model="alignmentHelpers[\'TVCamera\'].visibility"><div class="data-set-icon" style="background: {{alignmentHelpers[\'TVCamera\'].colorCSS}}"></div>{{alignmentHelpers[\'TVCamera\'].caption | translate}}</label></div><div class="checkbox"><label><input type="checkbox" ng-model="alignmentHelpers[\'SVCamera2\'].visibility"><div class="data-set-icon" style="background: {{alignmentHelpers[\'SVCamera2\'].colorCSS}}"></div>{{alignmentHelpers[\'SVCamera2\'].caption | translate}}</label></div><div class="checkbox"><label><input type="checkbox" ng-model="alignmentHelpers[\'SVCamera1\'].visibility"><div class="data-set-icon" style="background: {{alignmentHelpers[\'SVCamera1\'].colorCSS}}"></div>{{alignmentHelpers[\'SVCamera1\'].caption | translate}}</label></div><div class="checkbox"><label><input type="checkbox" ng-model="alignmentHelpers[\'defaultCamera\'].visibility"><div class="data-set-icon" style="background: {{alignmentHelpers[\'defaultCamera\'].colorCSS}}"></div>{{alignmentHelpers[\'defaultCamera\'].caption | translate}}</label></div><br><div class="btn-group" role="group"><button title="{{\'Select all\'|translate}}" type="button" class="btn btn-default" ng-click="selectAllAHs()" ng-disabled="config.AH.all_selected"><span class="fa fa-check-square-o" aria-hidden="true"></span></button> <button title="{{\'Deselect all\'|translate}}" type="button" class="btn btn-default" ng-click="deselectAllAHs()" ng-disabled="config.AH.none_selected"><span class="fa fa-square-o" aria-hidden="true"></span></button></div></div></div></div>'),e.put("templates/alignment/AutoAlignmentPanel.html",'<div class="panel panel-default"><div class="panel-heading"><a data-toggle="collapse" data-parent="#accordion" href="#collapseAutoAlignment" aria-expanded="true" aria-controls="collapseAutoAlignment" translate="">Automatic alignment</a></div><div id="collapseAutoAlignment" class="panel-collapse collapse"><div class="panel-body"><div class="form-horizontal"><div style="max-width: 33em; margin-bottom: 1em;"><span translate="" translate-params-icon="\'<i class=\' + \'\\\'glyphicon glyphicon-star\\\'\' + \'></i>\'">Automatic fine-alignment transforms the dataset selected below in order to bring it into alignment with the reference dataset ({{icon}}). The datasets have to be coarsely aligned by hand and the dataset to align has to be unlocked.</span></div><div class="form-group"><label class="col-sm-2 control-label" for="autoAlignDataset" translate="">Dataset</label><div class="col-sm-10"><select id="autoAlignDataset" class="form-control" title="{{\'Dataset to be aligned\'|translate}}" ng-disabled="auto_align_data.in_progress" ng-model="auto_align_data.source" ng-options="dataset as dataset.title for dataset in getAutoAlignmentDatasets() | orderBy: \'title\'" ng-change="auto_align_data.fetchedData = undefined;"></select></div></div><div class="form-group"><label class="col-sm-2 control-label" translate="">Options</label><div class="col-sm-10"><div class="checkbox"><label><input type="checkbox" ng-model="auto_align_data.vertical_alignment" ng-disabled="auto_align_data.in_progress"> <span translate="">Align vertically</span></label></div></div></div><div class="form-group" ng-if="auto_align_data.fetchedData"><label class="col-sm-2 text-right" translate="">Result:</label><div class="col-sm-10" style="max-width: 25em;"><span ng-if="!auto_align_data.in_progress" style="font-weight: bold;"><span ng-if="auto_align_data.fetchedData.converged" translate="">Point clouds have converged.</span> <span ng-if="!auto_align_data.fetchedData.converged" translate="">Point clouds are not converging, please make sure there is sufficient overlap.</span><br></span> <span translate="" translate-params-inliers="auto_align_data.fetchedData.inliers" translate-params-iterations="auto_align_data.fetchedData.iterations" translate-params-error="(auto_align_data.fetchedData.inliers>0 ? auto_align_data.fetchedData.sad*1000/auto_align_data.fetchedData.inliers : 0)|number:0">{{inliers}} points used, mean error {{error}} mm after {{iterations}} iterations.</span></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button class="btn btn-default" type="button" ng-click="fetchAutoAlignment()" title="" ng-disabled="auto_align_data.in_progress" translate="">Align</button> <button ng-if="auto_align_data.fetchedData && !auto_align_data.applied" class="btn btn-default" type="button" ng-click="applyAutoAlignment()" title="" ng-disabled="auto_align_data.in_progress" translate="">Apply</button> <button ng-if="auto_align_data.fetchedData && auto_align_data.applied" class="btn btn-default" type="button" ng-click="undoAutoAlignment()" title="" ng-disabled="auto_align_data.in_progress" translate="">Undo</button></div></div></div></div></div></div>'),e.put("templates/alignment/DatasetAlignmentPanel.html",'<form ng-controller="DatasetAlignmentController" role="form"><div ng-include="" src="\'templates/alignment/MultipleDatasetSelector.html\'"></div><label translate="">Transform</label><div ng-if="isNonWritableDatasetSelected()" style="margin:10px 0"><span class="fa fa-exclamation-triangle"></span> <span style="text-align:justify" translate="">You do not have permission to edit selected datasets</span></div><div ng-include="" src="\'templates/alignment/RotatePanel.html\'"></div><div ng-include="" src="\'templates/alignment/TranslatePanel.html\'"></div><div ng-include="" src="\'templates/alignment/AlignmentHelpers.html\'"></div><div ng-include="" src="\'templates/alignment/AutoAlignmentPanel.html\'"></div><div ng-include="" src="\'templates/alignment/SaveAndGenerateXMLPanel.html\'"></div><div ng-include="" src="\'templates/alignment/FloorAlignment.html\'"></div></form>'),e.put("templates/alignment/FloorAlignment.html",'<span ng-show="floor"><label translate="">Floor alignment</label><div class="form-group"><div class="col-sm-12"><span translate="">Name</span> <input type="text" class="col-sm-12 form-control" ng-model="floor.name"></div><div class="col-sm-12"><span translate="">Minimum height</span> <input type="number" class="col-sm-12 form-control" step="0.1" ng-model="floor.z_min"></div><div class="col-sm-12"><span translate="">Maximum height</span> <input type="number" class="col-sm-12 form-control" step="0.1" ng-model="floor.z_max"></div></div></span>'),e.put("templates/alignment/GeoRegistrationPanel.html",'<form ng-controller="GeoRegistrationController" role="form"><div ng-include="" src="\'templates/alignment/MultipleDatasetSelector.html\'"></div><label translate="">Transform</label><div ng-if="isNonWritableDatasetSelected()" style="margin:10px 0"><span class="fa fa-exclamation-triangle"></span> <span style="text-align:justify" translate="">You do not have permission to edit selected datasets</span></div><div ng-include="" src="\'templates/alignment/RotatePanel.html\'"></div><div ng-include="" src="\'templates/alignment/TranslatePanel.html\'"></div><div ng-include="" src="\'templates/alignment/SaveAndGenerateXMLPanel.html\'"></div></form>'),e.put("templates/alignment/MultipleDatasetSelector.html",'<div class="form-group multiple-dataset-selector"><label title="{{\'Transformations are applied to all selected (and not locked) datasets\'|translate}}" translate="">Datasets</label><ul class="list-group" style="overflow-y: auto"><li class="list-group-item" ng-repeat="dataset in datasets| orderBy: \'title\'" ng-click="(modes.currentMode === \'GeoRegistration\' ? config.map_data_present[dataset.id] : true) ? toggleSelection(dataset) : \'\'" ng-class="config.selected[dataset.id] ? \'active\' : (modes.currentMode === \'GeoRegistration\' && !config.map_data_present[dataset.id] ? \'disabled\' : \'\')"><div class="data-set-controls"><div class="alert-item-info" ng-if="!dataset.security_.can_write && (modes.currentMode === \'GeoRegistration\' ? config.map_data_present[dataset.id] : true)" title="{{\'You do not have permission to edit this dataset\'|translate}}" style="display:inline-block"><span class="fa fa-exclamation-triangle"></span> <span></span></div><select class="form-control form-control-inline" ng-hide="modes.currentMode === \'GeoRegistration\' || !config.selected[dataset.id] || !dataset.security_.can_write" ng-model="dataset_colors[dataset.id]" ng-click="$event.stopPropagation()" style="margin-right:5px"><option style="background-color: {{COLOR_DEFS[color.key].rgb_string}}; color: white" ng-repeat="color in colors" ng-value="color.key" ng-selected="dataset_colors[dataset.id] === color.key">{{color.name}}</option></select><button ng-if="toolbar && toolbar.GuRM && hasReferenceMarkers(dataset.id)" class="btn btn-default" ng-click="showModal(\'#GuRM_modal\',dataset.id); $event.stopPropagation()" title="{{\'Geo-registration with reference markers of this dataset\'|translate}}" style="margin-right:5px"><span class="glyphicon glyphicon-map-marker"></span></button><div class="btn-group" ng-if="modes.currentMode === \'GeoRegistration\' ? config.map_data_present[dataset.id] : true" ng-click="$event.stopPropagation()"><button class="btn btn-default" ng-click="zoomTo(dataset)" title="{{\'Zoom map to dataset\'|translate}}"><i class="fa fa-crosshairs"></i></button><button class="btn btn-default" ng-disabled="!config.selected[dataset.id]" ng-click="setAsPrimary(dataset)" title="{{\'Select as reference dataset\'|translate}}"><span ng-class="config.primary === dataset ? \'glyphicon glyphicon-star\' : \'glyphicon glyphicon-star-empty\'"></span></button><button class="btn btn-default" ng-disabled="!config.selected[dataset.id]" ng-click="toggleLock(dataset)" title="{{\'Lock transformation\'|translate}}"><span ng-class="config.lock[dataset.id] === dataset ? \'fa fa-lock\' : \'fa fa-unlock-alt\'"></span></button></div><div class="alert-item-info" ng-if="modes.currentMode === \'GeoRegistration\' && !config.map_data_present[dataset.id]"><span class="fa fa-exclamation-triangle"></span> <span translate="">No map data</span></div></div><div class="data-set-info"><div class="data-set-icon thin-border" style="background-color: {{COLOR_DEFS[dataset.color].rgb_string}}"></div><div class="data-set-title">{{dataset.title}}</div></div></li></ul><div class="btn-toolbar"><div class="btn-group"><button class="btn btn-default" type="button" ng-click="selectAll()" title="{{\'Select all\'|translate}}"><span class="fa fa-check-square-o"></span></button> <button class="btn btn-default" type="button" ng-click="selectInverse()" title="{{\'Invert selection\'|translate}}"><span class="fa fa-random"></span></button> <button class="btn btn-default" type="button" ng-click="unSelectAll()" title="{{\'Deselect all\'|translate}}"><span class="fa fa-square-o"></span></button> <button class="btn btn-default" type="button" ng-click="zoomToAllSelected()" title="{{\'Adjust view to show selected datasets\'|translate}}"><i class="fa fa-crosshairs"></i></button> <button class="btn btn-default" type="button" ng-click="lockAll()" title="{{\'Lock selected datasets\'|translate}}"><span class="fa fa-lock"></span></button> <button class="btn btn-default" type="button" ng-click="unlockAll()" title="{{\'Unlock all\'|translate}}"><span class="fa fa-unlock-alt"></span></button></div><div class="btn-group" ng-if="toolbar"><button ng-if="toolbar && toolbar.transparentDatasets" type="button" ng-click="config.transparent=!config.transparent" title="{{\'Make all datasets except the reference dataset transparent\'|translate}}" ng-class="config.transparent? \'btn btn-default active\' : \'btn btn-default\'"><i class="fa fa-picture-o"></i></button> <button ng-if="toolbar && toolbar.layerSwitcher" type="button" ng-click="toggleBaseLayer()" title="{{\'Toggle map type\'|translate}}" class="btn btn-default"><i class="fa fa-map-o"></i></button></div></div></div>'),e.put("templates/alignment/RotatePanel.html",'<div class="form-group rotate-panel"><div class="btn-toolbar"><div class="btn-group"><button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(0.174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">10° <i class="fa fa-undo data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(0.0174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">1° <i class="fa fa-undo data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(0.00174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">0.1° <i class="fa fa-undo data-set-transform-icon"></i></button></div><div class="btn-group"><button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(-0.00174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">0.1° <i class="fa fa-repeat data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(-0.0174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">1° <i class="fa fa-repeat data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="rotate(-0.174532925)" ng-mouseleave="StopRotating()" ng-mouseup="StopRotating()">10° <i class="fa fa-repeat data-set-transform-icon"></i></button></div></div></div>'),e.put("templates/alignment/SaveAndGenerateXMLPanel.html",'<div class="form-group" style="float:none"><save-button ng-click="save()"></save-button></div><label translate="">XML-Export</label><div class="form-group"><label class="control-label">Reference dataset</label><select class="form-control" title="{{\'Reference dataset\'|translate}}" ng-model="config.referenceDataset" ng-options="dataset.title for (datase_id, dataset) in config.selected| orderBy: \'title\'"></select></div><div class="row"><div class="form-group col-sm-6"><input class="form-control" type="text" ng-model="config.institution_name" placeholder="{{\'Site name (optional)\'|translate}}" title="{{\'Downloaded file name will be (Site name)_(date:yyyy_mm_dd).xml\'|translate}}"></div><div class="form-group col-sm-6"><button class="form-control" type="button" ng-click="downloadXML()" ng-disabled="!config.referenceDataset || !anythingSelected()" translate="">Download</button></div></div>'),e.put("templates/alignment/TranslatePanel.html",'<div class="form-group translate-panel"><div class="btn-toolbar"><div class="btn-group"><button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(-0.02, 0, 0)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">-x <i class="fa fa-arrow-left data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(0.02, 0, 0)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">+x <i class="fa fa-arrow-right data-set-transform-icon"></i></button></div><div class="btn-group"><button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(0, -0.02, 0)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">-y <i class="fa fa-arrow-down data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(0, 0.02, 0)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">+y <i class="fa fa-arrow-up data-set-transform-icon"></i></button></div><div class="btn-group"><button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(0, 0, -0.02)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">-z <i class="fa fa-arrow-down data-set-transform-icon"></i></button> <button type="button" class="btn btn-default" ng-disabled="!anythingSelected() || isNonWritableDatasetSelected()" ng-mousedown="translate(0, 0, 0.02)" ng-mouseleave="StopTranslating()" ng-mouseup="StopTranslating()">+z <i class="fa fa-arrow-up data-set-transform-icon"></i></button></div></div></div>'),e.put("templates/menu/AboutMenu.html",'<div class="panel panel-default" ng-controller="CreditsController"><div class="panel-heading" translate="">About IndoorViewer</div><div class="panel-body"><div style="float: right"><a href="http://www.navvis.com" target="_blank"><img src="img/logos/logo_navvis_94h.png" alt="NavVis Logo" style="margin-top: -20px; margin-left: -20px; margin-right: -20px;"></a></div><div style="margin-top: .5em; font-size: 1.5em">IndoorViewer</div><div style="margin-top: .5em; font-size: 1em; font-style: italic;" title="Build {{version.build}} {{version.branch}} {{version.commit | limitTo:8}} {{version.commit2 | limitTo:8}}"><span translate="" translate-params-version="version.version" translate-context="IV version">Version {{version}}</span></div><div style="margin-top: 2em; margin-bottom: 1em"><p><span translate="" translate-params-year="current_year">Copyright © {{year}} NavVis GmbH.</span><br><span translate="">All rights reserved.</span></p></div><div ng-if="getExtraCredits()" style="margin-top: 1em"><p ng-bind-html="getExtraCredits()"></p></div><div style="margin-top: 1em; max-width: 25em"><span translate="" translate-context="Powered by many great software products: [...] any many more.">Powered by many great software products:</span><ul><li><a href="http://github.com/mrdoob/three.js" target="_blank" class="blue">Three.js WebGL</a></li><li><a href="http://angularjs.org" target="_blank">AngularJS</a></li><li translate="" translate-context="Powered by many great software products: [...] any many more.">and many more.</li></ul><a class="pull-right" href="" ng-click="fetchLicensesFile(\'#licensesOfUsedLibsModal\')" translate="">Third party licenses</a> <a class="pull-left" href="" data-toggle="modal" data-target="#privacyPolicy" ng-if="havePrivacyPolicy()" translate="">Privacy policy</a></div></div></div>'),e.put("templates/menu/DatasetsMenu.html",'<div ng-controller="DatasetMenuController"><div class="modal in" id="dataset-make-non-public-warning-dialog" tabindex="-1" role="dialog" aria-labelledby="makeNotPublic" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div class="panel panel-default"><div class="panel-heading" translate="">Datasets</div><div class="panel-body panel-autoscroll"><div class="row" ng-if="datasets.length == 0"><div class="col-xs-12" translate="">No datasets</div></div><ul class="nav" ng-if="datasets.length != 0"><li ng-repeat="dataset in datasets| orderBy: \'title\'" class="dataset"><input type="checkbox" id="{{\'dataset\' + dataset.id}}" ng-model="dataset.visible" ng-change="onUpdate(dataset)"> <label for="{{\'dataset\' + dataset.id}}"><div style="white-space: nowrap"><div class="data-set-jump"><a href="" ng-click="jumpToFirstImage()" title="{{\'Jump to first image\'|translate}}"><i class="glyphicon glyphicon-share-alt"></i></a></div><span style="cursor: pointer" class="fa fa-pencil-square-o" ng-class="{\'hide\': !dataset.security_.can_write}" ng-click="setResourceToEdit(dataset)" data-toggle="modal" data-target="#editDataset"></span><div class="data-set-icon" style="background: {{COLOR_DEFS[dataset.color].rgb_string}}"></div><div class="data-set-title">{{dataset.title}}</div></div><div class="data-set-name pull-left">{{dataset.name}}</div><div class="data-set-level pull-right">{{dataset.level}}</div></label></li></ul></div><div class="panel-footer" ng-if="datasets.length != 0"><div class="btn-group" role="group" aria-label="..."><button title="{{\'Select all\'|translate}}" type="button" class="btn btn-default" ng-click="selectAll()" ng-disabled="getNumSelected() === datasets.length"><span class="fa fa-check-square-o" aria-hidden="true"></span></button> <button title="{{\'Deselect all\'|translate}}" type="button" class="btn btn-default" ng-click="deselectAll()" ng-disabled="getNumSelected() === 0"><span class="fa fa-square-o" aria-hidden="true"></span></button></div></div></div><div class="modal" id="editDataset" tabindex="-1" role="dialog" aria-labelledby="editDataset" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" translate="">Edit dataset</h4></div><div class="modal-body"><form class="form"><div class="form-group"><label translate="">Title</label> <input type="text" class="form-control" ng-model="edited.title" init-focus=""></div><div class="form-group"><label translate="" translate-context="Level as in floor this dataset belongs to">Level</label> <input type="text" class="form-control" ng-model="edited.level"></div><div class="form-group" ng-include="" src="\'templates/PermissionsEditor.html\'" style="margin-top:20px"></div></form></div><div class="modal-footer"><cancel-button data-dismiss="modal"></cancel-button><ok-button data-dismiss="modal" ng-click="updateDataset()"></ok-button></div></div></div></div></div>'),e.put("templates/menu/LoginMenu.html",'<div ng-controller="UserController"><div ng-include="" src="\'templates/settings/permissions/SaveUserDialog.html\'"></div><div class="panel panel-default" id="login-panel"><div class="panel-heading" ng-class="{\'user-logged-in\' : isUserLoggedIn() }"><span ng-if="isUserLoggedIn()">{{ userInfo.getDisplayName() }}</span> <span ng-if="!isUserLoggedIn()" translate="">You are a guest</span></div><div class="panel-body"><div ng-if="!isUserLoggedIn()"><div ng-if="!loginInProgress && !passwordExpired"><form class="form-horizontal" ng-submit="localLogin()"><div class="form-group"><input class="form-control" ng-model="$parent.$parent.login" placeholder="{{\'Username\' | translate}}" init-focus=""></div><div class="form-group"><input type="password" class="form-control" ng-model="$parent.$parent.password" placeholder="{{\'Password\' | translate}}"></div><div class="form-group" ng-if="wrongUserCredentials"><span class="text-danger" translate="">Wrong username or password</span></div><ok-button type="submit" ng-show="!isUserLoggedIn()" ng-disabled="!$parent.$parent.login" style="margin-top:15px">Sign in</ok-button><ok-button ng-click="startOidcLogin()" ng-show="!isUserLoggedIn() && oidcLoginAvailable()" style="margin-top:15px">Sign in with OAuth</ok-button></form></div><div ng-if="passwordExpired"><form class="form-horizontal" ng-submit="changeExpiredPassword()"><div class="form-group"><div class="form-group"><span class="text-danger" ng-if="!passwordChangeFailed" translate="">This is the first login. For security reasons, please change your password.</span> <span class="text-danger" ng-if="passwordChangeFailed" translate="">Password change has failed</span></div><div class="form-group"><input type="password" class="form-control" ng-model="$parent.$parent.newPassword" placeholder="{{\'New password\' | translate}}"></div><div class="form-group"><input type="password" class="form-control" ng-model="$parent.$parent.repeatNewPassword" placeholder="{{\'Repeat new password\' | translate}}"></div><ok-button type="submit" ng-disabled="$parent.$parent.repeatNewPassword !== $parent.$parent.newPassword">Change password</ok-button></div></form></div><div ng-if="loginInProgress"><span class="spinner"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span></div></div><div class="userinfo-panel" ng-if="isUserLoggedIn()"><div class="form-group"><span ng-if="userInfo.groups === undefined || permissions_data.groups === undefined" class="spinner"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span><ul ng-if="userInfo.groups !== undefined && permissions_data.groups !== undefined" class="list-group user-groups-list"><li class="list-group-item user-group-header" ng-if="discardPublicGroup(userInfo.groups).length === 0" translate="">You are not a member of any group</li><div class="panel-group" ng-if="discardPublicGroup(userInfo.groups).length > 0"><div class="panel panel-default"><div class="panel-heading"><a data-toggle="collapse" href="#collapse-groups" translate="">Your groups</a></div><div id="collapse-groups" class="panel-collapse collapse in"><ul class="list-group"><li class="list-group-item user-group-item" ng-repeat="userGroup in getAllGroups()" ng-show="userGroup.id !== GroupService.getPublicGroupId()">{{userGroup.name}}</li></ul></div></div></div><li class="list-group-item user-group-header" ng-if="getNrOfUserAttributes(true) === getNrOfUserAttributes()" translate="">You have all permissions</li><li class="list-group-item user-group-header" ng-if="getNrOfUserAttributes(true) === 0" translate="">You do not have any permissions</li><div class="panel-group" ng-if="getNrOfUserAttributes(true) !== 0 && getNrOfUserAttributes(true) !== getNrOfUserAttributes()"><div class="panel panel-default"><div class="panel-heading"><a data-toggle="collapse" href="#collapse-attributes" translate="">Your permissions</a></div><div id="collapse-attributes" class="panel-collapse collapse"><ul class="list-group"><li class="list-group-item user-group-item" ng-repeat="(key, value) in userInfo.attributes" ng-if="value">{{GroupService.getGroupAttributesNames()[key]}}</li></ul></div></div></div></ul></div><ok-button ng-show="!logoutInProgress" ng-click="$parent.userToSave = userInfo" data-toggle="modal" data-target="#save-user-modal">Edit profile</ok-button><discard-button ng-show="!logoutInProgress" ng-click="localLogout()">Sign out</discard-button><div ng-if="logoutInProgress"><span class="spinner"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span></div></div></div></div></div>'),e.put("templates/menu/ModalsInMenus.html",'<div class="modal" id="licensesOfUsedLibsModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true" x-stack-modal="" ng-controller="CreditsController"><div class="modal-dialog-licenseText"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" translate="">Licenses of third party software</h4></div><div class="modal-body"><div><div class="row"><div class="col-sm-3" translate="">Name</div><div class="col-sm-6" translate="">Homepage</div><div class="col-sm-3" translate="">License</div></div><div ng-repeat="(name, data) in config.openSourceSoftwareUsed"><div class="row space-from-top-between-rows"><div class="col-sm-3">{{name}}</div><div class="col-sm-6"><a ng-href="{{data.homepageURL}}" target="_blank" class="blue">{{data.homepageURL}}</a></div><div class="col-sm-3"><a ng-click="data.show=!data.show" href=""><span translate="">Show license</span></a></div></div><div class="row space-from-top-between-rows" ng-show="data.show && data.sourceCodeURL!==\'\'"><div class="col-sm-12"><span translate="">Download source code:</span> <a ng-href="{{data.sourceCodeURL}}" target="_blank" class="blue">{{data.sourceCodeURL}}</a></div></div><div class="row space-from-top-between-rows" ng-show="data.show"><div class="col-sm-12"><span ng-repeat="licenseText in data.licenses"><pre>{{licenseText}}</pre></span></div></div></div></div></div><div class="modal-footer" style="margin-top:0px;"></div></div></div></div><div class="modal" id="setStartupViewModal" tabindex="-1" role="dialog" x-stack-modal="" aria-labelledby="setStartupViewModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="setStartupViewModalLabel" translate="">Confirm</h4></div><div class="modal-body" translate="">This will set the startup view for all users to the current view.</div><div class="modal-footer"><close-button data-dismiss="modal"></close-button><ok-button data-dismiss="modal" ng-click="setStartupView()"></ok-button></div></div></div></div><div class="modal" id="resetStartupViewModal" tabindex="-1" role="dialog" x-stack-modal="" aria-labelledby="setStartupViewModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="resetStartupViewModalLabel" translate="">Confirm</h4></div><div class="modal-body" translate="">This will reset the startup view for all users.</div><div class="modal-footer"><close-button data-dismiss="modal"></close-button><ok-button data-dismiss="modal" ng-click="resetStartupView()"></ok-button></div></div></div></div><div ng-controller="CreditsController" class="modal" id="privacyPolicy" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" translate="">Data Privacy Policy</h4></div><div class="modal-body" ng-bind-html="getPrivacyPolicy()"></div></div></div></div><div ng-controller="GeoRegistrationController" class="modal" id="GuRM_modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" translate="">Geo-registration with reference markers</h4></div><div class="modal-body"><div class="form-group"><div class="row"><div class="col-sm-6"></div><div class="col-sm-6" translate="">Error</div></div></div><div class="form-group"><div class="row" ng-repeat="object in config.GuRM.markers[config.GuRM.current_dataset]"><div class="col-sm-1"><div class="checkbox-inline"><label><input type="checkbox" ng-model="object.data.selected" ng-change="recalculate_TuRM()"></label></div></div><div class="col-sm-1"><img ng-src="{{object.poi.getIcon()}}" class="poiIcon"></div><div class="col-sm-4"><span title="{{object.poi.getCode()}}">{{object.poi.getCode()| limitTo:20}}</span></div><div class="col-sm-6" ng-if="object.data.error && !isNaN(object.data.error)">{{object.data.error.toFixed(3)}} <span translate="">meters</span></div></div></div><div class="form-group"><div class="checkbox"><label><input type="checkbox" ng-model="config.GuRM.three_D" ng-change="recalculate_TuRM();" translate=""> Also compute transform in height</label></div><button class="btn btn-default" type="button" ng-click="toggleAll(true);recalculate_TuRM();" title="{{\'Select all\'|translate}}"><span class="fa fa-check-square-o"></span></button> <button class="btn btn-default" type="button" ng-click="toggleAll(false);recalculate_TuRM();" title="{{\'Deselect all\'|translate}}"><span class="fa fa-square-o"></span></button></div><div class="form-group"><span ng-if="config.GuRM.error" class="text-danger" translate="">The reference markers selected could not yield a unique solution. This can usually happen because too few points are selected (less than 3), all points are on a point, all points are on a line, etc.</span></div><div class="form-group"><span ng-if="config.GuRM.status" class="text-danger" translate="">Please select one or more datasets to apply geo-registration to</span></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" translate="">Cancel</button> <button type="button" class="btn btn-primary" ng-click="apply_GuRM(\'#GuRM_modal\')" translate="">Okay</button></div></div></div></div><div class="modal" id="ivReinitModal" tabindex="-1" role="dialog" x-stack-modal="" aria-labelledby="ivReinitModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="ivReinitModalLabel" translate="">Task finished</h4></div><div class="modal-body" translate="">A task just finished. Do you want to reinitialize the IndoorViewer to load the new data? Unsaved changes may be lost.</div><div class="modal-footer"><close-button data-dismiss="modal"></close-button><ok-button data-dismiss="modal" ng-click="reinitIV()"></ok-button></div></div></div></div>'),
e.put("templates/menu/ModeMenu.html",'<div id="mode-menu-panel" class="panel panel-default no-select" ng-controller="ModeController" ng-init="switchToMode(modesOrdered[0].name)"><div class="panel-heading" style="text-align:center"><button type="button" ng-repeat="mode in modesOrdered" class="btn btn-default" ng-class="{\'active\': mode.name === modes.currentMode}" ng-click="switchToMode(mode.name)" ng-if="isModeEnabled(mode.name)"><span class="{{mode.CSSIconClass}}"></span> {{mode.HTMLButtonTranslation | translate}}</button> <i class="fa fa-times exit-icon" ng-click="switchToMode(\'normal\')"></i></div><div class="panel-body panel-autoscroll"><div ng-if="modes[modes.currentMode].HTMLUITemplate" ng-include="" src="modes[modes.currentMode].HTMLUITemplate"></div></div></div>'),e.put("templates/menu/PointCloudMenu.html",'<div class="panel panel-default panel-autoscroll pointcloud-panel" ng-controller="PointCloudMenuController"><div class="panel-heading" translate="">Point Cloud Options</div><div class="panel-body"><div class="checkbox"><label><input type="checkbox" ng-model="config.showPointCloud" ng-change="settingChangedCallback(\'showPointCloud\')"> <span translate="">Show point cloud</span></label></div><div ng-if="config.showPointCloud"><div ng-if="config.potreeAvailable"><div class="checkbox"><label><input type="checkbox" ng-model="config.usePotree" ng-change="settingChangedCallback(\'usePotree\')"> <span translate="">Advanced Renderer</span></label></div></div></div><div ng-if="config.usePotree == false"><div ng-if="config.showPointCloud"><div class="checkbox"><label><input type="checkbox" ng-model="config.zBuffering" ng-change="settingChangedCallback(\'zBuffering\')"> <span translate="">Use Z-Buffer</span></label></div><div class="row"><div class="col-sm-4 align-text" translate="">Opacity</div><div class="col-sm-4 align-slider"><div ui-slider="" min="0" max="1" step="0.01" use-decimals="" ng-model="config.opacity" ng-change="settingChangedCallback(\'opacity\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0" max="1" step="0.01" ng-model="config.opacity" ng-change="settingChangedCallback(\'opacity\')"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Brightness</div><div class="col-sm-4 align-slider"><div ui-slider="" min="1" max="1000" step="1" use-decimals="" ng-model="config.brightness" ng-change="settingChangedCallback(\'brightness\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="1" max="1000" step="1" ng-model="config.brightness" ng-change="settingChangedCallback(\'brightness\')"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Range</div><div class="col-sm-4 align-slider"><div ui-slider="" min="20" max="300" step="1" use-decimals="" ng-model="config.maxDist" ng-change="settingChangedCallback(\'maxDist\', \'Depth culling\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="20" max="300" step="1" ng-model="config.maxDist" ng-change="settingChangedCallback(\'maxDist\', \'Depth culling\')"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Level of Detail</div><div class="col-sm-4 align-slider"><div ui-slider="" min="2" max="8" step="1" use-decimals="" ng-model="config.maxDepth" ng-change="settingChangedCallback(\'maxDepth\', \'PC resolution\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="2" max="8" step="1" ng-model="config.maxDepth" ng-change="settingChangedCallback(\'maxDepth\', \'PC resolution\')"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Hue Offset</div><div class="col-sm-4 align-slider"><div ui-slider="" min="0" max="1" step="0.01" use-decimals="" ng-model="config.hueOffset" ng-change="settingChangedCallback(\'hueOffset\', \'color hueOffset\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0" max="1" step="0.01" ng-model="config.hueOffset" ng-change="settingChangedCallback(\'hueOffset\', \'color hueOffset\')"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Hue Scale</div><div class="col-sm-4 align-slider"><div ui-slider="" min="-1" max="1" step="0.01" use-decimals="" ng-model="config.hueScale" ng-change="settingChangedCallback(\'hueScale\', \'color hueScale\')"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="-1" max="1" step="0.01" ng-model="config.hueScale" ng-change="settingChangedCallback(\'hueScale\', \'color hueScale\')"></div></div></div></div><div ng-if="config.usePotree == true"><div ng-repeat="pane in settingsPanes" ng-include="\'templates/menu/PointCloudPane.html\'"></div></div></div></div>'),e.put("templates/menu/PointCloudPane.html",'<div ng-show="pane.visible()" id="pointcloud-pane" class="form-group"><label class="form-label">{{pane.caption|translate}}</label><br><div><select class="form-control" style="display: inline-block; width: calc(100% - 4em)" ng-model="pane.currentPreset" ng-options="preset.name as preset.caption | translate for preset in pane.presets" ng-change="applyPreset(pane.currentPreset, pane.material, pane)"><option value="" disabled="" ng-if="pane.currentPreset == \'\'" translate="">Custom</option></select><button type="button" class="btn btn-default" data-toggle="collapse" data-parent="#accordion" ng-href="{{\'#collapse\'+pane.name}}" aria-expanded="true" ng-aria-controls="{{\'collapse\'+pane.name}}" ng-click="pane.collapsed = !pane.collapsed" ng-class="pane.currentPreset == \'\' ? \'btn-primary\' : \'\'"><span ng-class="pane.collapsed? \'glyphicon glyphicon-chevron-down\' : \'glyphicon glyphicon-chevron-up\'"></span></button></div><div ng-attr-id="{{\'collapse\'+pane.name}}" class="collapse"><div class="panel-body"><div class="row" ng-if="pane.visibleSettings.opacity" title="{{tooltips[pane.name].inactiveFromShading}}"><div class="col-sm-4 align-text" translate="">Opacity</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="0" max="1" step="0.01" use-decimals="" ng-model="pane.material.opacity" ng-disabled="pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0" max="1" step="0.01" ng-model="pane.material.opacity" ng-disabled="pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.brightness" title="{{tooltips[pane.name].inactiveFromShadingOpacity}}"><div class="col-sm-4 align-text" translate="">Brightness</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="1" max="1000" step="1" use-decimals="" ng-model="pane.material.brightness" ng-disabled="pane.material.opacity == 1.0 || pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="1" max="1000" step="1" ng-model="pane.material.brightness" ng-disabled="pane.material.opacity == 1.0 || pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.colorStyle"><div class="col-sm-4 align-text" translate="">Color style</div><div class="col-sm-8 align-textbox"><select class="form-control" ng-options="option.name | translate for option in dropdownMenus.colorStyleOptions track by option.id" ng-model="pane.material.colorStyleSelectedOption" ng-change="advancedSettingChangedCallback(pane)"></select></div></div><div ng-if="pane.material.colorStyleSelectedOption.id == 3"><div class="row"><div class="col-sm-4 align-text" translate="">Height Range</div><div class="col-sm-8 align-slider hidden-xs"><div ui-slider="{range: true}" min="{{config.zMin}}" max="{{config.zMax}}" step="0.1" use-decimals="" ng-model="pane.material.z" ng-change="advancedSettingChangedCallback(pane)"></div></div></div><div class="row"><div class="col-sm-4"></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="{{config.zMin}}" max="{{config.zMax}}" step="0.1" ng-model="pane.material.z[0]" ng-change="advancedSettingChangedCallback(pane)"></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="{{config.zMin}}" max="{{config.zMax}}" step="0.1" ng-model="pane.material.z[1]" ng-change="advancedSettingChangedCallback(pane)"></div></div></div><div class="row" ng-if="pane.visibleSettings.pointSizeMode"><div class="col-sm-4 align-text" translate="">Point size mode</div><div class="col-sm-8 align-textbox"><select class="form-control" ng-options="option.name | translate for option in dropdownMenus.pointSizeOptions track by option.id" ng-model="pane.material.pointSizeSelectedOption" ng-change="advancedSettingChangedCallback(pane)"></select></div></div><div class="row" ng-if="pane.visibleSettings.pointSize"><div class="col-sm-4 align-text" translate="">Point size</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="0.01" max="{{pane.material.pointSizeSelectedOption.maxSize}}" step="0.01" use-decimals="" ng-model="pane.material.pointSize" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0.01" max="{{pane.material.pointSizeSelectedOption.maxSize}}" step="0.01" ng-model="pane.material.pointSize" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.pointShape"><div class="col-sm-4 align-text" translate="">Point shape</div><div class="col-sm-8 align-textbox"><select class="form-control" ng-options="option.name | translate for option in dropdownMenus.pointShapeOptions track by option.id" ng-model="pane.material.pointShapeSelectedOption" ng-change="advancedSettingChangedCallback(pane)"></select></div></div><div class="checkbox" ng-if="pane.visibleSettings.zBuffering"><label title="{{tooltips[pane.name].inactiveFromShadingOpacity}}"><input type="checkbox" ng-model="pane.material.zBuffering" ng-disabled="pane.material.opacity == 1.0 || pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"> <span translate="">Use Z-Buffer</span></label></div><div class="checkbox" ng-if="pane.visibleSettings.edl"><label><input type="checkbox" ng-model="pane.material.useEDL" ng-change="advancedSettingChangedCallback(pane)"> <span translate="">Shading</span></label></div><div ng-if="pane.visibleSettings.edl" ng-show="pane.material.useEDL"><div class="row"><div class="col-sm-4 align-text" translate="">Radius</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="1" max="5" step="0.05" use-decimals="" ng-model="pane.material.EDLRadius" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="1" max="5" step="0.05" ng-model="pane.material.EDLRadius" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row"><div class="col-sm-4 align-text" translate="">Strength</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="0" max="3" step="0.05" use-decimals="" ng-model="pane.material.EDLStrength" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0" max="3" step="0.05" ng-model="pane.material.EDLStrength" ng-change="advancedSettingChangedCallback(pane)"></div></div></div><div class="row" ng-if="pane.visibleSettings.maxDist"><div class="col-sm-4 align-text" translate="">Range</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="20" max="300" step="1" use-decimals="" ng-model="config.maxDist" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="20" max="300" step="1" ng-model="config.maxDist" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.maxDepth"><div class="col-sm-4 align-text" translate="">Level of Detail</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="2" max="8" step="1" use-decimals="" ng-model="config.maxDepth" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="2" max="8" step="1" ng-model="config.maxDepth" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.pointCountTarget"><div class="col-sm-4 align-text" translate="">Point count target (m)</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="0.2" max="15" step="0.1" use-decimals="" ng-model="config.pointCountTarget" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0.2" max="15" step="0.1" ng-model="config.pointCountTarget" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="row" ng-if="pane.visibleSettings.minNodeSize"><div class="col-sm-4 align-text" translate="">Minimum node size (px)</div><div class="col-sm-4 align-slider hidden-xs"><div ui-slider="" min="0" max="10000" step="10" use-decimals="" ng-model="config.minNodeSize" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="col-sm-4 align-textbox"><input type="number" class="form-control" min="0" max="10000" step="10" ng-model="config.minNodeSize" ng-change="advancedSettingChangedCallback(pane)"></div></div><div class="checkbox" ng-if="pane.visibleSettings.clientSidePicking"><label><input type="checkbox" ng-model="config.clientSidePicking" ng-change="advancedSettingChangedCallback(pane)"> <span translate="">Client-side picking</span></label></div><div class="checkbox" ng-if="pane.visibleSettings.normalsFiltering"><label><input type="checkbox" ng-model="pane.material.normalsFiltering" ng-change="advancedSettingChangedCallback(pane)"> <span translate="">Normals filtering</span></label></div></div></div></div>'),e.put("templates/menu/Settings.html",'<div ng-controller="SettingsController"><div class="modal in" id="unsaved-changes-dialog" tabindex="-1" role="dialog" aria-labelledby="unsavedChanges" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div id="settings-panel" class="panel panel-default full-window panel-autoscroll"><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" ng-click="exit()"><i class="fa fa-times exit-icon"></i></a><span class="caption">{{setting_pages[current_page.key].caption | translate}}</span><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#settings-navbar-list" aria-expanded="false"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><div id="settings-navbar-list" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li ng-repeat="key in setting_order" ng-if="setting_pages[key].isVisible()" ng-disabled="setting_pages[key].isDisabled()" ng-class="key === current_page.key ? \'active\' : \'\'" ng-click="setCurrentPage(key)" data-target="#settings-navbar-list.navbar-collapse.in" data-toggle="collapse"><a href="#" onclick="event.preventDefault();">{{setting_pages[key].caption | translate}}</a></li></ul></div></div></nav><div class="panel-body"><div class="alert alert-warning license-expiration-warning iv-panel-warning" ng-if="LicenseService.isExpirationPeriod()"><span class="fa fa-exclamation-triangle" aria-hidden="true"></span><div><p><strong>{{expiring_license_translations.title}}</strong></p><p ng-bind-html="expiring_license_translations.instructions"></p><p translate="" translate-params-days="LicenseService.daysUntilExpire">{{days}} days remaining</p></div></div><div ng-include="" src="current_page.template"></div></div></div></div>'),e.put("templates/menu/ShareMenu.html",'<div class="panel panel-default" ng-controller="ShareMenuController"><div class="panel-heading" translate="">Share location</div><div class="panel-body panel-autoscroll"><div class="form" ng-if="showURL"><div class="form-group"><label translate="">Web address</label><br><input readonly="" class="col-sm-12 linkToCopy" ng-value="URLService.generateShareURL()" onclick="this.select()" style="float:none"></div><div class="form-group" ng-if="showJS"><label translate="">JavaScript code</label><br><input readonly="" class="col-sm-12 linkToCopy" ng-value="URLService.generateJS()" onclick="this.select()" style="float:none"></div><div class="form-group" style="margin-bottom:0"><label translate="">Social networks</label><br><a onclick="openShareWindow(\'facebook\')" title="Facebook" class="btn azm-social azm-size-32 azm-r-square azm-facebook"><i class="fa fa-facebook"></i></a> <a onclick="openShareWindow(\'google-plus\')" title="Google+" class="btn azm-social azm-size-32 azm-r-square azm-google-plus"><i class="fa fa-google-plus"></i></a> <a title="Twitter" target="_blank" href="{{sn_share_URLs.twitter}}" class="btn azm-social azm-size-32 azm-r-square azm-twitter"><i class="fa fa-twitter"></i></a> <a onclick="openShareWindow(\'linkedin\')" title="LinkedIn" class="btn azm-social azm-size-32 azm-r-square azm-linkedin"><i class="fa fa-linkedin"></i></a> <a onclick="openShareWindow(\'xing\')" title="Xing" class="btn azm-social azm-size-32 azm-r-square azm-xing"><i class="fa fa-xing"></i></a> <a onclick="openShareWindow(\'tumblr\')" title="Tumblr" class="btn azm-social azm-size-32 azm-r-square azm-tumblr"><i class="fa fa-tumblr"></i></a></div></div></div></div>'),e.put("templates/menu/ViewMenu.html",'<div class="panel panel-default" ng-controller="ViewMenuController" id="viewMenu"><div class="panel-heading" translate="" translate-context="noun">View</div><div class="panel-body panel-autoscroll"><div class="checkbox"><label><input type="checkbox" ng-model="config.showPanoramas"> <span translate="">Show Panoramas</span></label></div><div class="checkbox"><label><input type="checkbox" ng-model="config.show_inset_view"> <span translate="">Show Mini View</span></label></div><div class="checkbox" ng-if="config.navGraphEnabled"><label><input type="checkbox" ng-model="config.showNavGraph"> <span translate="">Show Navigation Graph</span></label></div><div class="row" ng-if="config.showNavGraph && nav_graph_rendering.nav_graph_present"><div class="col-sm-3 align-text" translate="">Visibility radius</div><div class="col-sm-6 align-slider"><div ui-slider="" min="5" max="50" step="1" ng-model="nav_graph_rendering.THRESH"></div></div><div class="col-sm-3 align-textbox"><input type="text" class="form-control" ng-model="nav_graph_rendering.THRESH"></div></div><div class="row" ng-if="config.showNavGraph && nav_graph_rendering.nav_graph_present"><div class="col-sm-3 align-text" translate="">Vertical visibility</div><div class="col-sm-6 align-slider"><div ui-slider="" min="1" max="20" step="1" ng-model="nav_graph_rendering.THRESH_Z"></div></div><div class="col-sm-3 align-textbox"><input type="text" class="form-control" ng-model="nav_graph_rendering.THRESH_Z"></div></div><div class="checkbox"><label><input type="checkbox" ng-model="config.showLocationMarkers"> <span translate="">Show Location Markers</span></label></div><div class="checkbox" ng-if="config.measurementsEnabled"><label><input type="checkbox" ng-model="config.showMeasurements"> <span translate="">Show Measurements</span></label></div><div class="checkbox" ng-if="config.vectorMapEditorEnabled"><label><input type="checkbox" ng-model="config.showVectorMapEditor"> <span translate="">Show vector map editor</span></label></div></div></div>'),e.put("templates/navgraph/AttributeEditor.html",'<div id="attributeEditor" class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="editAttributesLabel"><span ng-if="editing.selectedElement.type === \'node\'" translate="">Edit node attributes</span> <span ng-if="editing.selectedElement.type !== \'node\'" translate="">Edit edge attributes</span></h4></div><div class="modal-body"><form id="attributeModalForm" class="form-horizontal" role="form"><div class="form-group"><label class="col-sm-3 control-label" translate="" translate-context="key as in key-value pair">Key</label><div class="col-sm-9"><input type="text" class="form-control" ng-model="editing.selectedElement.selected_key"></div></div><div class="form-group"><label class="col-sm-3 control-label" translate="">Value</label><div class="col-sm-9"><input type="text" class="form-control" ng-model="editing.selectedElement.selected_value"></div></div><div class="form-group"><div class="col-sm-12" style="text-align: right"><button type="button" class="btn btn-default" ng-click="clearAttributeFields()" translate="" translate-context="verb">Clear</button> <button type="button" class="btn btn-primary" ng-click="addAttribute()" translate="">Add</button></div></div></form><table class="table" ng-if="getNrOfAttributes()" style="text-align:center; margin-bottom:0"><tr style="border-bottom:1px solid rgb(204,204,204)"><td style="width:33%; font-weight:bold" translate="" translate-context="key as in key-value pair">Key</td><td style="width:33%; font-weight:bold" translate="">Value</td><td style="width:33%; font-weight:bold" translate="">Delete</td></tr><tr ng-repeat="(key, value) in editing.selectedElement.attributesMap" style="border-top:1px solid rgb(204,204,204)"><td style="width:33%">{{key}}</td><td style="width:33%">{{value}}</td><td style="width:33%"><span class="glyphicon glyphicon-trash" ng-click="deleteAttribute(key)" style="cursor:pointer"></span></td></tr></table></div><div class="modal-footer"><cancel-button data-dismiss="modal" ng-click="exitAttributesEditor()"></cancel-button><ok-button data-dismiss="modal" ng-click="saveAndExitAttributesEditor()"></ok-button></div></div></div>'),e.put("templates/poi/POIDetails.html",'<div class="modal in" id="poi-make-non-public-warning-dialog" tabindex="-1" role="dialog" aria-labelledby="makeNotPublic" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div id="poi-details-panel" class="left-panel-element-flexible-height" ng-class="enable_features.full_screen ? \'panel panel-default full-window\' : \'panel panel-default\'" ng-hide="!selected.poi"><div class="panel-heading"><div class="row"><div class="col-xs-6"><div class="vcenter"><img ng-src="{{selected.poi.getIcon()}}" class="poiIcon"></div><div class="vcenter padding-left"><h3 class="panel-title">{{selected.poi.getCode()}}</h3></div></div><div class="col-xs-6 pull-right"><div class="btn-toolbar" role="toolbar"><div class="btn-group"><button ng-if="enable_features.share" ng-click="goToPOI(); buildShareURLs();" class="btn btn-default" type="button" data-toggle="modal" data-target="#POI_URL"><span class="fa fa-share-alt"></span></button><button title="{{\'Edit\'|translate}}" ng-if="!selected.poi.read_only_ && selected.poi.security_.can_write" class="btn btn-default" type="button" data-toggle="modal" data-target="#editPOI" ng-click="openEditor(false)"><span class="fa fa-edit"></span> <span class="hidden-xs hidden-sm" translate="">Edit</span></button><button title="{{\'View\'|translate}}" ng-if="enable_features.view" class="btn btn-default" type="button" ng-click="goToPOI()"><span class="fa fa-search"></span> <span class="hidden-xs hidden-sm" translate="" translate-context="verb">View</span></button><button title="{{\'Route\'|translate}}" ng-if="enable_features.routing" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"><span class="fa fa-mail-forward"></span> <span class="hidden-xs hidden-sm" translate="">Route</span></button><ul class="dropdown-menu" ng-if="enable_features.routing" style="left:auto; right:0; text-align:center"><li ng-click="routeFromHere()" style="padding:5px 20px; cursor:pointer" translate="">Route from here</li><li ng-click="routeToHere()" style="padding:5px 20px; cursor:pointer" translate="">Route to here</li></ul></div><div class="btn-group"><button title="{{\'Close\'|translate}}" class="btn btn-default" type="button" ng-click="closePoi();"><span class="glyphicon glyphicon-remove"></span></button></div></div></div></div></div><div class="panel-body"><div ng-class="enable_features.full_screen ? \'full-window-scroll\' : \'panel-autoscroll\'" ng-bind-html="selected.poi.getDescription()"></div></div><ul class="list-group"><li ng-if="config.moving_POI" class="list-group-item"><cancel-button ng-click="cancelMovePOI()"></cancel-button><button class="btn btn-default" type="button" ng-click="savePOI();" style="margin-left:5px"><span class="glyphicon glyphicon-save"></span> <span translate="">Save position</span></button></li></ul></div>'),e.put("templates/poi/POIDialogs.html",'<div class="modal in" id="editPOI" tabindex="-1" role="dialog" aria-labelledby="editPOI" aria-hidden="false" ng-controller="POIController" x-stack-modal=""><div class="full-window" ng-include="" src="\'templates/poi/POIEditor.html\'"></div></div><div class="modal" id="POI_URL" tabindex="-1" role="dialog" aria-labelledby="POI_URL" aria-hidden="true" data-dismiss="modal" x-trigger-cursor-viz=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" aria-hidden="true" data-dismiss="modal">&times;</button> <span class="modal-title" translate="">Share POI</span></div><div class="modal-body"><div class="form-group"><label translate="">Link to this POI</label> <input readonly="" class="linkToCopy" ng-value="createPOIURL()" onclick="this.select()"></div><div class="form-group"><div class="form-group"><label translate="">Social networks</label><br><a ng-show="!movedToPOI.transitioning" onclick="openPOIShareWindow(\'facebook\')" title="Facebook" class="btn azm-social azm-size-32 azm-r-square azm-facebook"><i class="fa fa-facebook"></i></a> <a ng-show="!movedToPOI.transitioning" onclick="openPOIShareWindow(\'google-plus\')" title="Goole+" class="btn azm-social azm-size-32 azm-r-square azm-google-plus"><i class="fa fa-google-plus"></i></a> <a ng-show="!movedToPOI.transitioning" title="Twitter" target="_blank" href="{{config.sn_share_URLs.twitter}}" class="btn azm-social azm-size-32 azm-r-square azm-twitter"><i class="fa fa-twitter"></i></a> <a ng-show="!movedToPOI.transitioning" onclick="openPOIShareWindow(\'linkedin\')" title="LinkedIn" class="btn azm-social azm-size-32 azm-r-square azm-linkedin"><i class="fa fa-linkedin"></i></a> <a ng-show="!movedToPOI.transitioning" onclick="openPOIShareWindow(\'xing\')" title="Xing" class="btn azm-social azm-size-32 azm-r-square azm-xing"><i class="fa fa-xing"></i></a> <a ng-show="!movedToPOI.transitioning" onclick="openPOIShareWindow(\'tumblr\')" title="Tumblr" class="btn azm-social azm-size-32 azm-r-square azm-tumblr"><i class="fa fa-tumblr"></i></a> <span ng-show="movedToPOI.transitioning" class="spinner next-to-btngroup"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span></div></div></div><div class="modal-footer" style="margin-top:0px;"></div></div></div></div><div class="modal" id="custom_icons_list" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" aria-hidden="true" data-dismiss="modal">&times;</button><h4 class="modal-title" translate="">Recently uploaded icons</h4></div><div class="modal-body"><div class="row"><div class="col-sm-1" ng-repeat="(icon, unused) in getUploadedIcons()" data-dismiss="modal"><img ng-src="{{icon}}" ng-click="editing.poi.icon=icon" class="poiIcon"></div></div></div><div class="modal-footer"></div></div></div></div><div class="modal" id="global_position_form" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" aria-hidden="true" data-dismiss="modal">&times;</button><h4 class="modal-title" translate="">Global position of POI (reference marker)</h4></div><div class="modal-body"><form class="form"><div class="form-group"><div class="checkbox"><label><input type="checkbox" ng-model="editing.poi.reference_marker"> <span translate="">Use as reference marker</span></label></div></div><div class="form-group"><label translate="">Longitude</label> <input type="text" class="form-control" ng-model="editing.poi.geometry_.coordinates[0]" ng-disabled="!editing.poi.reference_marker"></div><div class="form-group"><label translate="">Latitude</label> <input type="text" class="form-control" ng-model="editing.poi.geometry_.coordinates[1]" ng-disabled="!editing.poi.reference_marker"></div><div class="form-group"><label translate="">Height (optional)</label> <input type="text" class="form-control" ng-model="editing.poi.geometry_.coordinates[2]" ng-disabled="!editing.poi.reference_marker"></div></form></div><div class="modal-footer"><cancel-button data-dismiss="modal"></cancel-button><ok-button data-dismiss="modal"></ok-button></div></div></div></div>'),e.put("templates/poi/POIEditor.html",'<div id="poiEditor" class="modal-dialog modal-poi-editor" ng-class="{\'full-window\' : isScreenNarrower()}"><div class="modal-content"><div class="modal-header" style="border-bottom: 0px"><button type="button" ng-click="enlargeModalView()" class="close glyphicon" ng-class="isFullWindow() ? \'glyphicon-resize-small\' : \'glyphicon-resize-full\'" ng-hide="isScreenNarrower()"></button><ul class="nav nav-tabs" role="tablist"><li id="poi-editor-tab-home" class="active" role="presentation"><a href="#poi_editor_home" aria-controls="poi_editor_home" role="tab" data-toggle="tab" translate="">Edit POI</a></li><li id="poi-editor-tab-advanced" role="presentation"><a href="#poi_editor_advanced" aria-controls="poi_editor_advanced" role="tab" data-toggle="tab" translate="">Advanced</a></li></ul></div><div class="modal-body"><div class="tab-content"><div role="tabpanel" class="tab-pane active" id="poi_editor_home"><form class="poiModalForm form-horizontal" role="form"><div class="form-group"><label class="col-sm-3 control-label" translate="">Name</label><div class="col-sm-9"><input type="text" class="form-control" placeholder="{{\'Enter name of POI\'|translate}}" ng-model="editing.poi.current_language_.code" init-focus=""></div></div><div class="form-group"><label class="col-sm-3 control-label" translate="">Category</label><div class="col-sm-9"><select class="form-control" ng-model="editing.poi.poi_type" ng-options="type.id as type.getName() group by getGroupName(type) for (id,type) in getPOITypesMap()"></select></div></div><div class="form-group"><label class="col-sm-3 control-label" translate="">Language</label><div class="col-sm-9"><select class="form-control" ng-model="editing.poi.current_language_" ng-change="languageSelectChanged(editing.poi)" ng-options="translation as translation.language_name_ group by translation.group_ for translation in editing.language_options"></select></div></div><div class="form-group" style="margin-left:0; margin-right:0" ng-include="" src="\'templates/PermissionsEditor.html\'"></div></form><textarea ckeditor="editorOptions" ng-model="editing.poi.current_language_.description"></textarea><div id="upload_panel" class="panel panel-default"><p style="display: inline-block;" translate="">Add media (images, PDF, or audio)</p><input type="file" ng-file-select="onFileSelect($files)" style="display: inline-block;"><div ng-file-drop="onFileSelect($files)" ng-file-drag-over-class="optional-css-class" ng-show="dropSupported" class="row"><div class="col-md-12" translate="">Drop files here</div></div></div></div><div role="tabpanel" class="tab-pane" id="poi_editor_advanced"><form class="poiModalForm form-horizontal" role="form"><div class="form-group"><label class="col-sm-3 control-label" translate="">Importance</label><div class="col-sm-9"><select class="form-control" ng-model="editing.poi.importance"><option value="0" translate="" translate-context="Levels of importance">Low</option><option value="0.5" translate="" translate-context="Levels of importance">Medium</option><option value="1" translate="" translate-context="Levels of importance">High</option></select></div></div><div class="form-group"><label class="col-sm-3 control-label" title="{{\'By default, POIs are displayed using the category icon. Upload a custom image to override the category icon.\'|translate}}" translate="">Icon</label><div class="col-sm-9"><button type="button" class="btn btn-default" title="{{\'By default, POIs are displayed using the category icon. Upload a custom image to override the category icon.\'|translate}}" ng-click="" data-toggle="modal" data-target="#custom_icons_list" style="display:inline-block; margin-right:5px"><i class="fa fa-list"></i></button> <input type="file" ng-file-select="uploadPOIIcon($files, \'poi/image/\', \'image\')" style="display:inline-block; margin-top:7px;"></div></div><div ng-if="editing.poi.icon" class="form-group"><label class="col-sm-3 control-label" translate="">Custom icon</label><div class="col-sm-9"><img ng-src="{{editing.poi.icon}}" class="poiIcon"> <button class="btn btn-default" type="button" ng-click="editing.poi.icon = null"><span class="glyphicon glyphicon-remove"></span> <span translate="">Remove icon</span></button></div></div><div class="form-group"><label class="col-sm-3 control-label" translate="">Position</label><div class="col-sm-9"><p class="form-control-static" style="display:inline-block; margin-right:8px"><span translate="" translate-params-lat="editing.poi.geometry_.coordinates[1] | number:5" translate-params-lon="editing.poi.geometry_.coordinates[0] | number:5" translate-params-height="editing.poi.geometry_.coordinates[2] | number:2">{{lat}} N {{lon}} E, Height: {{height}} m</span></p><button type="button" class="btn btn-default" title="{{\'Edit\'|translate}}" data-toggle="modal" data-target="#global_position_form" style="margin-top:-2px"><span class="fa fa-pencil-square-o"></span></button></div></div><div class="form-group"><label class="col-sm-3 control-label" translate="">Custom data</label><div class="col-sm-9"><input type="text" class="form-control" ng-model="editing.poi.custom_data"></div></div><div class="form-group" ng-if="enable_features.visibilitycheck"><label class="col-sm-3 control-label" translate="">Check visibility</label><div class="col-sm-9 poi-group"><input type="checkbox" ng-model="editing.poi.visibilitycheck"></div></div></form></div></div><div class="status-messages"><span class="help-inline ui-state-error-text" ng-show="warnings.file_upload"><br><span translate="">Unsupported media type</span></span><span class="help-inline ui-state-error-text" ng-show="warnings.name"><br><span translate="" translate-params-language="fallback_language">Please set the POI name in {{language}}</span></span><span id="no_type_warning" class="help-inline ui-state-error-text" ng-show="warnings.type"><br><span translate="">Please select a POI category</span></span><span class="help-inline ui-state-error-text" ng-show="save_status != \'\'"><br><span translate="" translate-params-status="save_status">Status: {{status}}</span></span></div></div><div class="modal-footer" style="margin-top:0"><delete-button class="float-left" ng-show="!editing.create" ng-click="deletePOI(\'editPOI\')"></delete-button><move-button ng-show="!editing.create" data-dismiss="modal" ng-click="startMovePOI()"></move-button><cancel-button ng-click="exitEditor(\'editPOI\')"></cancel-button><save-button ng-click="savePOI(\'editPOI\')"></save-button></div></div></div>'),
e.put("templates/settings/ConfigEditor.html",'<div id="settings-config-panel" class="panel panel-default"><div class="panel-heading" translate="">Configuration of this IndoorViewer instance</div><div class="panel-body"><form><div class="row"><div ng-repeat="group in grouped_configs"><div ng-if="$even" class="clearfix"></div><div class="col-md-6 panel-config-column"><div class="panel panel-default"><div class="panel-heading"><label>{{ getTranslationKey(group.category) | translate }}</label></div><div class="panel-body"><div class="form-group" ng-hide="config.hide" ng-repeat="config in group | orderBy : \'name\'"><div ng-if="config.type ===\'enum\'" title="{{getConfigUnavailableText(config)}}"><p>{{getTranslationKey(config.name)|translate}}</p><select class="form-control" style="width:auto" ng-model="config.value" ng-options="val for val in config.possible_values_" ng-disabled="!isConfigEnabled(config)" ng-change="configChanged(config)"></select></div><div ng-if="config.type ===\'string\' || config.type === \'csv\' || config.type === \'number\'" title="{{getConfigUnavailableText(config)}}"><p>{{getTranslationKey(config.name)|translate}}</p><input class="form-control" style="width:auto" placeholder="{{config.value}}" ng-model="config.value" ng-disabled="!isConfigEnabled(config)" ng-change="configChanged(config)"></div><div class="checkbox" ng-if="config.type ===\'boolean\' || config.type === null" title="{{getConfigUnavailableText(config)}}"><label><input type="checkbox" ng-model="config.value" ng-disabled="!isConfigEnabled(config)" ng-change="configChanged(config)"> {{getTranslationKey(config.name)|translate}}</label></div><div ng-if="config.type ===\'multiline\'" title="{{getConfigUnavailableText(config)}}"><p>{{getTranslationKey(config.name)|translate}}</p><textarea class="form-control" rows="3" placeholder="{{config.value}}" ng-model="config.value" ng-disabled="!isConfigEnabled(config)" ng-change="configChanged(config)"></textarea></div></div></div></div></div></div><div class="col-md-6 panel-config-column"><div class="panel panel-default"><div class="panel-heading"><label translate="">Starting location</label></div><div class="panel-body"><div class="form-group" title="{{getConfigCategoryDisabledText(\'startup.view\')}}"><p translate="">Set current view as global startup view</p><div class="form-group"><button class="form-control btn btn-default ng-binding" style="width: auto" data-toggle="modal" data-target="#setStartupViewModal" ng-disabled="!isConfigCategoryEnabled(\'startup.view\')"><span class="glyphicon glyphicon-screenshot"></span> <span translate="">Set startup view</span></button> <button class="form-control btn btn-danger ng-binding" style="width: auto" data-toggle="modal" data-target="#resetStartupViewModal" ng-disabled="!isConfigCategoryEnabled(\'startup.view\')"><span class="glyphicon glyphicon-trash"></span> <span translate="">Reset startup view</span></button></div></div></div></div></div></div><div class="row"><div class="col-md-6"></div><div class="col-md-6 panel-config-column"><div class="alert alert-info"><p><span translate-params-icon="\'<i class=\' + \'\\\'glyphicon glyphicon-user\\\'\' + \'></i>\'" translate="">If you hide the login menu ({{icon}}), bookmark this link to temporarily re-enable it and access this page:</span></p><a href="{{loginURL}}" target="_blank">{{loginURL}}</a></div></div></div></form></div><div class="panel-footer"><div class="control-buttons"><discard-button ng-click="discardChangedConfigs()" ng-disabled="!anyConfigsChanged() || saving_in_progress === true"></discard-button><save-button ng-click="saveChangedConfigs()" ng-disabled="!anyConfigsChanged()" in-progress="saving_in_progress === true"></save-button></div></div></div>'),e.put("templates/settings/HiddenImages.html",'<div class="panel panel-default"><div class="panel-heading" translate="">Hidden images</div><div class="panel-body"><div class="row"><div class="col-md-12" translate="">The following images are hidden and will not be used:</div></div><br><div class="row"><div class="col-md-1" ng-repeat="(id,image) in hidden_images"><a ng-click="moveToImage(id)">{{id}}</a></div><div class="col-md-12" ng-show="NO_HIDDEN_IMAGE" translate="">There are no hidden images</div></div><br><div class="row"><div class="col-md-12" translate="">Note: to unhide, click on a link above and use the option "Unhide current location" from the right-click menu.</div></div></div></div>'),e.put("templates/settings/LanguagePreference.html",'<div class="panel panel-default" ng-controller="LanguageController"><div class="panel-heading" translate="">Language</div><div class="panel-body"><div class="row"><div class="col-md-2"><div class="list-group"><a class="list-group-item" ng-repeat="language in languages" ng-click="changeToLanguage(language.key)" ng-class="{\'active\': getCurrentLanguage() === language.key}">{{language.language_name}}</a></div><button ng-if="getCurrentLanguage() !== getBrowserLocale()" type="button" class="btn btn-danger" title="{{\'Reset to browser default language\'|translate}}" ng-click="resetToBrowserLanguage()" translate="">Reset</button></div></div></div></div>'),e.put("templates/vectormap/LayerEditor.html",""),e.put("templates/menu/poi/AssociatedPOIs.html",'<div><div class="space-from-top-between-rows"></div><div ng-repeat="POI in associated_POIs"><img ng-src="{{POI.getIcon()}}" class="poiIcon"> {{POI.getCode()}}</div></div>'),e.put("templates/menu/poi/Existing.html",'<div class="list-group-item-heading"><span ng-if="group.security_.can_write" title="{{\'Edit category group\'|translate}}" ng-click="setupGroupModal(group)" data-toggle="modal" data-target="#AddNewGroup" class="poi-group-edit-btn fa fa-pencil-square-o" aria-hidden="true"></span>{{group.getName()}}</div><div class="checkbox" ng-repeat="type in group.group_types_ | orderObjectByFunction:\'getName\'"><label><input type="checkbox" ng-model="getType(type.id).type_selected_"><span ng-if="group.security_.can_write" title="{{\'Edit category\'|translate}}" ng-click="setupTypeModal(group, getType(type.id))" data-toggle="modal" data-target="#AddNewType" class="poi-type-edit-btn fa fa-pencil-square-o" aria-hidden="true"></span><img ng-src="{{getType(type.id).icon}}" class="poiIcon"><span title="{{type.id + \'. \' + type.getName()}}">{{type.getName()}}</span><span ng-show="group.security_.can_write" style="float:right; position:relative; top:6px; margin-left:10px">{{type.id}}</span></label></div>'),e.put("templates/menu/poi/MainPanel.html",'<div class="panel panel-default" ng-controller="POITypesController"><div class="modal in" id="poi_type_group-make-non-public-warning-dialog" tabindex="-1" role="dialog" aria-labelledby="makeNotPublic" aria-hidden="false" x-stack-modal=""><div ng-include="" src="\'templates/WarningDialog.html\'"></div></div><div class="panel-heading" translate="">POI category filter</div><div ng-include="" src="\'templates/menu/poi/NewAndExisting.html\'"></div></div>'),e.put("templates/menu/poi/NewAndExisting.html",'<div class="list-group panel-autoscroll"><div class="list-group-item poi-group" ng-if="userInfo.checkAttribute(\'can_create_poi_groups\')"><span title="{{\'Add a new category group\'|translate}}" ng-click="setupGroupModal()" data-toggle="modal" data-target="#AddNewGroup" class="poi-group-add-btn fa fa-plus" aria-hidden="true"></span></div><div class="list-group-item poi-group" data-ng-repeat="group in getPOIGroupsMap() | orderObjectByFunction: \'getName\'"><div ng-include="" src="\'templates/menu/poi/Existing.html\'"></div><div class="checkbox" ng-if="group.security_.can_write"><span title="{{\'Add a new category\'|translate}}" ng-click="setupTypeModal(group)" data-toggle="modal" data-target="#AddNewType" class="poi-type-add-btn fa fa-plus" aria-hidden="true"></span></div></div></div><div class="panel-footer"><div class="btn-group"><button title="{{\'Select all\'|translate}}" type="button" class="btn btn-default" ng-click="showAll()"><span class="fa fa-check-square-o" aria-hidden="true"></span></button><button title="{{\'Deselect all\'|translate}}" type="button" class="btn btn-default" ng-click="hideAll()"><span class="fa fa-square-o" aria-hidden="true"></span></button></div></div><div class="modal" id="AddNewType" tabindex="-1" role="dialog" aria-labelledby="AddNewType" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span> <span class="sr-only" translate="">Close</span></button><h4 ng-if="!type_editing.id" class="modal-title" translate="">Add a new category</h4><h4 ng-if="type_editing.id" class="modal-title" translate="">Edit category</h4></div><div class="modal-body"><div class="form-horizontal"><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_group_name" translate="">Category group</label><div class="col-sm-8"><select id="poi_type_group_name" class="form-control" ng-model="type_editing.group_id" ng-options="group.id as group.getName() for (id, group) in getPOIGroupsMap()" style="display:block; width:100%; margin-bottom:15px"></select></div></div><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_language" translate="">Language</label><div class="col-sm-8"><select id="poi_type_language" class="form-control" ng-model="type_editing.current_language_" ng-change="languageSelectChanged(type_editing)" ng-options="translation as translation.language_name_ group by translation.group_ for translation in language_options"></select></div></div><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_name" translate="">Category</label><div class="col-sm-8"><input id="poi_type_name" class="form-control" type="text" ng-model="type_editing.current_language_.name" init-focus=""></div></div><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_icon" translate="">Icon</label><div class="col-sm-8"><img class="poiIcon" style="display: inline-block" ng-src="{{type_editing.icon}}"> <input id="poi_type_icon" style="display: inline-block" type="file" ng-file-select="uploadPOITypeIconFile($files, \'poi/image/\', \'image\')"></div></div><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_visibility_zoom_min" translate="">Visible from zoom</label><div class="col-sm-8"><input id="poi_type_visibility_zoom_min" class="form-control" style="width: 90%; display: inline-block" type="number" min="0" max="100" step="any" ng-model="type_editing.visibility_zoom_min"> <i class="fa fa-files-o" ng-click="type_editing.visibility_zoom_min = getZoomLevel()" title="{{\'Copy current zoom\'|translate}}" style="margin-left: 5px; cursor: pointer"></i></div></div><div class="form-group"><label class="col-sm-4 control-label" for="poi_type_visibility_zoom_max" translate="">Visible up to zoom</label><div class="col-sm-8"><input id="poi_type_visibility_zoom_max" class="form-control" style="width: 90%; display: inline-block" type="number" min="0" max="100" step="any" ng-model="type_editing.visibility_zoom_max"> <i class="fa fa-files-o" ng-click="type_editing.visibility_zoom_max = getZoomLevel()" title="{{\'Copy current zoom\'|translate}}" style="margin-left: 5px; cursor: pointer"></i></div></div></div><div class="help-inline ui-state-error-text" ng-show="show_warning"><span translate="" translate-params-language="fallback_language">Please set the POI name in {{language}}</span></div></div><div class="modal-footer"><delete-button class="float-left" ng-show="type_editing.id" data-toggle="modal" data-target="#confirmDelType"></delete-button><cancel-button data-dismiss="modal"></cancel-button><ok-button ng-click="saveType(\'AddNewType\', type_editing)"></ok-button></div></div></div></div><div class="modal" id="confirmDelType" tabindex="-1" role="dialog" aria-labelledby="confirmDelType" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" translate="">Confirm</h4></div><div class="modal-body"><span translate="" translate-params-amount="getPOIsOfType(type_editing.id).length">{{amount}} of POIs associated with this category will also be deleted.</span><div ng-include="" src="\'templates/menu/poi/AssociatedPOIs.html\'"></div></div><div class="modal-footer"><cancel-button data-dismiss="modal"></cancel-button><delete-button data-dismiss="modal" ng-click="deleteType(\'AddNewType\', type_editing.id)"></delete-button></div></div></div></div><div class="modal" id="AddNewGroup" tabindex="-1" role="dialog" aria-labelledby="AddNewGroup" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span> <span class="sr-only" translate="">Cancel</span></button><h4 ng-if="!group_editing.id" class="modal-title" translate="">Add a new category group</h4><h4 ng-if="group_editing.id" class="modal-title" translate="">Edit category group</h4></div><div class="modal-body"><div class="form"><div class="form-group"><label style="margin-right:5px" translate="">Language</label><select ng-model="group_editing.current_language_" class="form-control" ng-change="languageSelectChanged(group_editing)" ng-options="translation as translation.language_name_ group by translation.group_ for translation in language_options"></select></div><div class="form-group"><label translate="">Category group</label> <input type="text" class="form-control" ng-model="group_editing.current_language_.name" init-focus=""></div><div class="form-group" ng-include="" src="\'templates/PermissionsEditor.html\'" style="margin-top:20px"></div></div><span class="help-inline ui-state-error-text" ng-show="show_warning"><span translate="" translate-params-language="fallback_language">Please set the POI name in {{language}}</span></span></div><div class="modal-footer"><delete-button class="float-left" ng-show="group_editing.id" data-toggle="modal" data-target="#confirmDelGroup"></delete-button><cancel-button data-dismiss="modal"></cancel-button><ok-button ng-click="saveGroup(\'AddNewGroup\', group_editing)"></ok-button></div></div></div></div><div class="modal" id="confirmDelGroup" tabindex="-1" role="dialog" aria-labelledby="confirmDelGroup" aria-hidden="true" x-stack-modal=""><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" translate="">Confirm</h4></div><div class="modal-body"><span translate="" translate-params-amount="getPOIsOfGroup(group_editing.id).length">{{amount}} of POIs associated with the sub-categories and all sub-categories will also be deleted.</span><div ng-include="" src="\'templates/menu/poi/AssociatedPOIs.html\'"></div></div><div class="modal-footer"><cancel-button data-dismiss="modal"></cancel-button><delete-button data-dismiss="modal" ng-click="deleteGroup(\'AddNewGroup\', group_editing.id)"></delete-button></div></div></div></div>'),e.put("templates/settings/administration/AdminPanel.html",'<div id="settings-admin-panel" class="panel panel-default" ng-init="initAdminPanel()"><div class="panel-heading" translate="">Administration panel</div><div class="panel-body"><form><div id="administration-panel"><ul class="nav nav-tabs nav-justified"><li role="presentation" class="active"><a href="#admin-license" role="tab" data-toggle="tab" translate="">Instance Key</a></li><li role="presentation"><a href="#admin-user-auth" role="tab" data-toggle="tab" translate="">OpenID Connect</a></li></ul><div class="tab-content"><div role="tabpanel" class="tab-pane active" id="admin-license" ng-include="" src="\'templates/settings/administration/LicenseConfig.html\'"></div><div role="tabpanel" class="tab-pane" id="admin-user-auth" ng-include="" src="\'templates/settings/administration/UserAuthConfig.html\'"></div></div></div></form></div></div>'),e.put("templates/settings/administration/LicenseConfig.html",'<h4 translate="">Current Instance Key</h4><div class="alert alert-danger" ng-if="!LicenseService.isLicenseValid()" translate="">Current instance key is not valid</div><div class="container-fluid"><div class="row"><dl class="col-sm-6 dl-horizontal"><dt translate="">Valid from</dt><dd>{{ LicenseService.getValidFrom() | date : \'mediumDate\'}}</dd><dt translate="">Expires on</dt><dd>{{ LicenseService.getExpirationDate() | date : \'mediumDate\'}}</dd><dt translate="">Licensed area</dt><dd>{{ LicenseService.getLicensedSqm() }} m<sup>2</sup></dd><dt ng-if="LicenseService.getLicensableSqm()" translate="">Currently in database</dt><dd ng-if="LicenseService.getLicensableSqm()">{{ LicenseService.getLicensableSqm() }} m<sup>2</sup></dd></dl><div class="col-sm-6"><strong translate="">Modules</strong><ul class="list-unstyled"><li ng-repeat="feature in LicenseService.getFeatures()"><span ng-if="LicenseService.isFeatureEnabled(feature)" class="text-success glyphicon glyphicon-ok-circle"></span> <span ng-if="!LicenseService.isFeatureEnabled(feature)" class="text-muted glyphicon glyphicon-ban-circle"></span> {{ LicenseService.getFeatureText(feature) | translate }}</li></ul></div></div></div><h4 translate="">Insert Instance Key</h4><form><div class="row"><div class="col-xs-12"><textarea class="form-control form-group" rows="8" ng-model="license_text" placeholder="{{\'Please paste the instance key here\'|translate}}">\n\t\t\t</textarea><div class="alert alert-info" ng-show="license_config_state === AdminPanelConfigState.IN_PROGRESS" translate="">Attempting to apply new instance key...</div><div class="alert alert-success" ng-show="license_config_state === AdminPanelConfigState.SUCCESS" translate="">New instance key has been successfully set</div><div class="alert alert-danger" ng-show="license_config_state === AdminPanelConfigState.ERROR" translate="">Sorry, there was an error applying the instance key</div></div></div><div class="footer"><button type="button" class="btn btn-primary panel-control-button" ng-click="saveLicense(license_text)" ng-disabled="!license_text" translate="">Save</button></div></form>'),e.put("templates/settings/administration/UserAuthConfig.html",'<div><div class="alert alert-warning" ng-if="!isUserAuthFeatureEnabled()" translate="">A fully functional User Authentication module is not available for this instance. Please upgrade your instance key and import it into IndoorViewer.</div><div class="row form-group" style="margin-top:15px"><div class="col-md-6"><div class="form-group" ng-class="{\'has-success\' : user_auth_config && user_auth_config[\'auth.iv.host.url\'], \'has-error\' : user_auth_config && !user_auth_config[\'auth.iv.host.url\']}"><p><span translate="">IV instance host URL</span> <i class="fa fa-files-o" ng-click="copyIndoorViewerHostURLToConfig()" title="{{\'Paste host URL of the current IV instance\'|translate}}" style="margin-left:5px; cursor:pointer"></i></p><input class="form-control" ng-model="user_auth_config[\'auth.iv.host.url\']" ng-disabled="!user_auth_config"></div></div><div class="col-md-6"><div class="form-group" ng-class="{\'has-success\' : user_auth_config && user_auth_config[\'auth.local.provider.url\'], \'has-error\' : user_auth_config && !user_auth_config[\'auth.local.provider.url\']}"><p><span translate="">Identity Server URL</span> <i class="fa fa-files-o" ng-click="copyProviderURLToConfig()" title="{{\'Guess Identity Server URL\'|translate}}" style="margin-left:5px; cursor:pointer"></i></p><input class="form-control" ng-model="user_auth_config[\'auth.local.provider.url\']" ng-disabled="!user_auth_config"></div><div class="form-group" ng-class="{\'has-success\' : user_auth_config && user_auth_config[\'auth.local.key\'], \'has-error\' : user_auth_config && !user_auth_config[\'auth.local.key\']}"><p translate="">Application key</p><input class="form-control" ng-model="user_auth_config[\'auth.local.key\']" ng-disabled="!user_auth_config"></div><div class="form-group" ng-class="{\'has-success\' : user_auth_config && user_auth_config[\'auth.local.secret\'], \'has-error\' : user_auth_config && !user_auth_config[\'auth.local.secret\']}"><p translate="">Application secret</p><input class="form-control" ng-model="user_auth_config[\'auth.local.secret\']" ng-disabled="!user_auth_config"></div></div></div><div class="row" ng-show="user_auth_config_state === AdminPanelConfigState.IN_PROGRESS"><div class="col-xs-12"><div class="alert alert-info" translate="">Configuring user authentication...</div></div></div><div class="row" ng-show="user_auth_config_state === AdminPanelConfigState.SUCCESS"><div class="col-xs-12"><div class="alert alert-success" translate="">User authentication configuration saved successfully</div></div></div><div class="row" ng-show="user_auth_config_state === AdminPanelConfigState.ERROR"><div class="col-xs-12"><div class="alert alert-danger" translate="">Could not save user authentication configuration</div></div></div><div class="footer"><div class="control-buttons"><discard-button ng-click="disableUserAuthProvider()" ng-disabled="user_auth_config_state === AdminPanelConfigState.IN_PROGRESS">Disable</discard-button><ok-button ng-click="saveUserAuthConfig()" ng-disabled="!isAuthProviderConfigCorrect() || user_auth_config_state === AdminPanelConfigState.IN_PROGRESS">Save</ok-button></div></div></div>'),e.put("templates/settings/dataset_management/DatasetLocationPicker.html",'<div class="modal" id="dataset-location-modal" tabindex="-1" role="dialog" aria-labelledby="dataset-location-modal" aria-hidden="true" data-backdrop="false" press-key=\'{"esc" : "vm.cancelHandler()"}\'><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="vm.cancelHandler()">&times;</button><h4 class="modal-title" translate="">Dataset Location</h4></div><div class="modal-body"><p class="form-group"><span translate="">Choose a location for added datasets:</span> <b>{{vm.datasetsToAddNames}}</b></p><div class="form-group"><div ng-show="vm.getDatasetsWithLocation().length"><label class="normal-font" ng-click="vm.initDatasetMode()"><input type="radio" name="location-radio-control" ng-model="vm.locationPickerMode" ng-value="vm.ELocationPickerMode.DATASET"> <span translate="">Reference dataset</span></label></div><div><label class="normal-font" ng-click="vm.initCustomMode()"><input type="radio" name="location-radio-control" ng-model="vm.locationPickerMode" ng-value="vm.ELocationPickerMode.CUSTOM"> <span translate="">Custom location</span></label></div></div><div class="form-group"><div class="relative" id="dataset-management-reference-dataset" ng-show="vm.locationPickerMode === vm.ELocationPickerMode.DATASET"><p class="form-group" translate="">Choose the location from a reference dataset.</p><select class="form-control" title="{{\'Reference dataset location\'|translate}}" ng-model="vm.locationReferenceDataset" ng-options="dataset as dataset.name for dataset in vm.getDatasetsWithLocation() | orderBy : \'name\'" ng-change="vm.updateMapForReferenceDataset()" style="width:calc(100% - 48px)"></select><button class="btn btn-default absolute-right" ng-click="vm.updateMapForReferenceDataset()" title="{{\'Focus map on current reference dataset\' | translate}}" style="bottom:1px"><i class="fa fa-crosshairs"></i></button></div><div id="dataset-management-custom-location" ng-show="vm.locationPickerMode === vm.ELocationPickerMode.CUSTOM"><p class="form-group" translate="">Enter an address or specify a custom location.</p><div class="form-group"><div class="input-group"><input class="form-control" ng-model="vm.addressToSearch" ng-change="vm.addressNotFound = false" press-key=\'{ "enter" : "vm.searchAddress()" }\' placeholder="{{\'Enter address here (e.g. \\\'Munich\\\')\'|translate}}" style="max-height:32px"><div class="input-group-btn"><button type="button" class="btn btn-primary" ng-click="vm.searchAddress()" ng-disabled="!vm.addressToSearch.length"><i class="fa fa-search" aria-hidden="true"></i></button></div></div><p ng-if="vm.addressNotFound" class="help-block">Location for address not found</p></div><div class="form-group row" ng-class="vm.isLocationFieldValid(\'longitude\') ? \'has-success\' : \'has-error\'"><label class="col-xs-5 control-label normal-font" translate="">Longitude</label> <input class="col-xs-7 form-control form-control-inline" ng-model="vm.addingLocation.longitude" ng-change="vm.updateMapForCustomLocation(true)"></div><div class="form-group row" ng-class="vm.isLocationFieldValid(\'latitude\') ? \'has-success\' : \'has-error\'"><label class="col-xs-5 control-label normal-font" translate="">Latitude</label> <input class="col-xs-7 form-control form-control-inline" ng-model="vm.addingLocation.latitude" ng-change="vm.updateMapForCustomLocation(true)"></div><div class="form-group row" ng-class="vm.isLocationFieldValid(\'height\') ? \'has-success\' : \'has-error\'"><label class="col-xs-5 control-label normal-font" translate="">Height</label> <input class="col-xs-7 form-control form-control-inline" ng-model="vm.addingLocation.height" ng-change="vm.updateMapForCustomLocation(true)"></div><div class="form-group row relative" ng-class="vm.isLocationFieldValid(\'orientation\') ? \'has-success\' : \'has-error\'"><label class="col-xs-5 control-label normal-font" translate="">Orientation angle (degrees)</label> <input class="col-xs-7 form-control form-control-inline" ng-model="vm.addingLocation.orientation" ng-change="vm.updateMapForCustomLocation(true)"><button class="btn btn-default absolute-bottom" ng-click="vm.updateMapForCustomLocation(true, true)" ng-disabled="!vm.isLocationFieldValid(\'longitude\') || !vm.isLocationFieldValid(\'latitude\')" title="{{\'Focus map on current location\' | translate}}" style="right:15px"><i class="fa fa-crosshairs"></i></button></div></div></div><div id="open-layers-map-location-reference" class="open-layers-map" ng-class="{\'crosshair\': vm.locationPickerMode === vm.ELocationPickerMode.CUSTOM}" resize-event="vm.olMap.updateMapSize()" delay="100"></div></div><div class="modal-footer"><cancel-button ng-click="vm.cancelHandler()" data-dismiss="modal"></cancel-button><ok-button ng-disabled="!vm.isAddingLocationValid()" ng-click="vm.addHandler()" data-dismiss="modal">Add</ok-button></div></div></div></div>'),e.put("templates/settings/dataset_management/DatasetManagement.html",'<div class="panel panel-default" ng-controller="DatasetManagementController as vm"><div ng-include="" src="\'templates/settings/dataset_management/DatasetLocationPicker.html\'"></div><div class="panel-heading" translate="">Alignment Bundles</div><div class="panel-body"><span ng-show="vm.bundles.length == 0 && !vm.progress.loadingBundles" translate="">No alignment bundles found</span> <span class="spinner" ng-show="vm.progress.loadingBundles"><img ng-src="img/tail-spin.svg"></span><div class="row" ng-repeat="bundle in vm.bundles"><div class="col-md-12 dataset-mgmt-row"><button type="button" class="btn btn-default" ng-hide="bundle.in_database" ng-click="vm.addBundle(bundle)" ng-disabled="vm.jobProgress.jobRunning"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> <button type="button" class="btn btn-default" ng-show="bundle.in_database" ng-click="vm.removeBundle(bundle)" ng-disabled="vm.jobProgress.jobRunning"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button><div><div ng-if="bundle.name">{{bundle.name}}</div><div ng-if="!bundle.name" translate="">Unknown file</div><div class="dataset-mgmt-name">{{bundle.serial}}</div></div></div></div></div><div class="panel-heading" translate="">Datasets</div><div class="panel-body"><span ng-show="vm.datasets.length == 0 && !vm.progress.loadingDatasets" translate="">No datasets found</span> <span class="spinner" ng-show="vm.progress.loadingDatasets"><img ng-src="img/tail-spin.svg"></span><div class="row" ng-repeat="dataset in vm.datasets | orderBy : \'title\'"><div class="col-md-12 dataset-mgmt-row"><button type="button" class="btn btn-default" ng-hide="dataset.in_database" ng-click="vm.addDataset(dataset)" ng-disabled="vm.jobProgress.jobRunning"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> <button type="button" class="btn btn-default" ng-show="dataset.in_database" ng-click="vm.removeDataset(dataset)" ng-disabled="vm.jobProgress.jobRunning"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button><div ng-show="dataset.color !== null" class="dataset-mgmt-icon" style="background: {{vm.COLOR_DEFS[dataset.color].rgb_string}}"></div><div><div>{{dataset.title}}</div><div class="dataset-mgmt-name">{{dataset.name}}</div></div></div></div></div><div class="panel panel-default"><div class="panel-heading" translate="">Import Point Clouds</div><div class="panel-body" flow-object="vm.datasetUploader" flow-init="" flow-file-error="vm.uploadError($file, $message)" flow-file-success="vm.uploadSuccess($file, $message)" flow-file-progress="vm.fileProgress($file)" flow-files-submitted="vm.filesSubmitted($files)" flow-error="vm.uploadError($file, $message)"><div class="form-group"><button type="button" class="btn btn-primary" flow-btn=""><span class="fa fa-upload" aria-hidden="true"></span> <span translate="">Upload and process file(s)</span></button> <em style="margin-left: 1em" translate="">Supported formats: ptx, ply, xyz, txt, pts and bin</em></div><div class="row animate-repeat" ng-repeat="file in $flow.files"><div class="col-md-3"><span>{{ file.name }}</span></div><div class="col-md-6"><div class="progress"><div class="progress-bar" ng-class="{ \'progress-bar-warning active\': file.isUploading(), \'progress-bar-danger\': file.error || vm.hasJobFailed(file.job_id), \'progress-bar-success\': file.isComplete() && !vm.isJobBusy(file.job_id), \'progress-bar-warning progress-bar-striped active\': file.isComplete() && vm.isJobBusy(file.job_id) }" role="progressbar" aria-valuenow="{{ file.percent }}" aria-valuemin="0" aria-valuemax="100" ng-style="{width: file.percent + \'%\'}" style="min-width: 2em;"><span ng-if="!file.error && !file.isComplete()" translate="" translate-params-progress="file.percent | number:0">{{ progress }}% complete</span><span ng-if="file.error">{{ file.errorMessage }}</span> <span ng-if="!file.error && file.isComplete() && vm.isJobBusy(file.job_id)">{{ vm.jobs[file.job_id].last_output }}</span> <span ng-if="!file.error && file.isComplete() && !vm.isJobBusy(file.job_id) && !vm.hasJobFailed(file.job_id)" translate="">Upload and processing done</span> <span ng-if="!file.error && file.isComplete() && vm.hasJobFailed(file.job_id)" translate="">Task has failed. Please check the Task Manager for more information.</span></div></div></div><div class="col-md-3"><button class="btn btn-default btn-xs" ng-click="file.cancel()" ng-show="file.isUploading() || file.paused"><i class="fa fa-times"></i></button> <button class="btn btn-default btn-xs" ng-click="file.pause()" ng-show="!file.paused && file.isUploading()"><span class="glyphicon glyphicon-pause"></span></button> <button class="btn btn-default btn-xs" ng-click="file.resume()" ng-show="file.paused"><span class="glyphicon glyphicon-play"></span></button></div></div></div></div><div class="panel panel-default" ng-controller="JobsListController as jobController"><div class="panel-heading" translate="">Task Manager</div><div id="job-panel" class="panel-body"><span ng-show="jobController.jobs.length == 0" translate="">No tasks found</span><div class="panel" ng-class="{\'panel-warning\': job.busy}" ng-repeat="job in jobController.jobs | reverse track by $index" ng-if="job.job_id"><div class="panel-heading" data-toggle="collapse" data-target="#{{\'job-\'+job.job_id}}" data-parent="#job-panel"><div class="row"><div class="col-md-9"><span ng-show="job.busy"><span class="fa fa-spin fa-circle-o-notch" title="{{\'Task is running\'|translate}}"></span></span> <span class="text-success fa fa-check-circle-o" ng-show="!job.busy && job.success" title="{{\'Task has successfully finished\'|translate}}"></span> <span class="text-danger fa fa-exclamation-circle" ng-show="!job.busy && !job.success" title="{{\'Task has failed\'|translate}}"></span> <strong>{{job.name}}</strong> <span>({{job.title}})</span></div><div class="col-md-3 text-right"><span ng-show="!job.busy">{{ job.start_time | date:\'yyyy-MM-dd HH:mm:ss\' }}</span> <span class="fa fa-times-circle-o" ng-show="job.busy" title="{{\'Cancel task\'|translate}}" ng-click="jobController.showCancelModal(job, $event)"></span></div></div></div><div id="{{\'job-\'+job.job_id}}" data-job-id="{{job.job_id}}" class="collapse job-details" scroll-glue=""><pre><code>{{job.output}}</code></pre></div></div></div><div class="modal" id="confirmJobCancel" tabindex="-1" role="dialog" aria-labelledby="confirmJobCancel" aria-hidden="true" data-backdrop="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" translate="">Confirm cancellation</h4></div><div class="modal-body" translate="">Do you really want to cancel this task?</div><div class="modal-footer"><close-button data-dismiss="modal"></close-button><ok-button data-dismiss="modal" ng-click="jobController.confirmJobCancel()"></ok-button></div></div></div></div></div></div>'),
e.put("templates/settings/permissions/Groups.html",'<div id="settings-groups-panel" class="panel panel-default" ng-controller="GroupController"><div class="panel-heading" translate="">Groups</div><div class="panel-body"><div class="btn-toolbar"><button title="{{\'Add a subgroup to the selected group\'|translate}}" type="button" class="btn btn-default btn-group" ng-if="userInfo.checkAttribute(\'can_create_user_groups\')" ng-click="addGroupInAddingState(groupsTree.getSelectedGroup())" ng-disabled="!groupsTree.getSelectedGroup() || groupsTree.getSelectedGroup().id === GroupService.getPublicGroupId()"><span class="fa fa-plus" aria-hidden="true"></span></button><div class="btn-group" title="{{getGroupNotWritableText(groupsTree.getSelectedGroup())}}"><button title="{{\'Edit a name of the selected group\'|translate}}" type="button" class="btn btn-default" ng-click="goToGroupEditState(groupsTree.getSelectedGroup())" ng-disabled="!groupsTree.getSelectedGroup() || !groupsTree.getSelectedGroup().security_.can_write"><span class="fa fa-pencil" aria-hidden="true"></span></button><button title="{{\'Remove the selected group and all its subgroups (also group connections with the users)\'|translate}}" type="button" class="btn btn-default" ng-click="removeGroup(groupsTree.getSelectedGroup())" ng-disabled="!groupsTree.getSelectedGroup() || !groupsTree.getSelectedGroup().security_.can_write"><span class="fa fa-trash-o" aria-hidden="true"></span></button></div></div><div ng-include="" src="\'templates/settings/permissions/GroupsTree.html\'"></div></div><div class="panel-footer"><div class="control-buttons"><discard-button ng-click="resetGroups()" ng-disabled="!isDataChanged() || addingInProgressCount" title="{{\'Reset all changes\'|translate}}"></discard-button><save-button ng-click="saveGroups()" ng-disabled="!isDataChanged() || addingInProgressCount" title="{{\'Save all changes\'|translate}}"></save-button></div></div></div>'),e.put("templates/settings/permissions/GroupsTree.html",'<div ng-if="!permissions_data.groups" style="margin-top:15px; text-align:center"><span class="spinner"><img class="in-btn-group" ng-src="img/tail-spin.svg"></span></div><div ng-if="permissions_data.groups && !permissions_data.groups.length" style="margin-top:15px; text-align:center"><span class="fa fa-exclamation-triangle"></span> <span translate="">No groups are visible to you</span></div><ul ng-if="permissions_data.groups && permissions_data.groups.length" class="list-group groups-tree" style="margin-top:15px; margin-bottom:0; text-align:left"><li ng-repeat="group in permissions_data.groups | orderBy: \'name\'" class="list-group-item" ng-if="!groupsTree.isGroupExcluded(group)" ng-class="{\'group-hover\': groupsTree.isGroupHovered(group), \'group-disabled\': !groupsTree.isGroupEnabled(group), \'group-expanded\': groupsTree.isGroupExpanded(group), \'group-semi-checked\': groupsTree.isGroupSemiChecked(group), \'group-selected\': groupsTree.isGroupSelected(group), \'group-in-adding\': groupsTree.isGroupInAddingState(group), \'group-in-edit\': groupsTree.isGroupInEditState(group), \'group-added\': groupsTree.isGroupInAddedState(group)}" ng-click="current_page.key == \'GROUPS\' ? toggleGroupSelected(group) : toggleGroupExpanded(group); $event.stopPropagation()" ng-mouseover="mouseOverGroup(group); $event.stopPropagation()" ng-mouseleave="mouseLeaveGroup(group); $event.stopPropagation()" ng-include="" src="\'templates/settings/permissions/GroupsTreeItem.html\'"></li></ul>'),e.put("templates/settings/permissions/GroupsTreeItem.html",'<div class="group-left-controls"><span ng-if="!group.child_groups || !group.child_groups.length" class="indent"></span><span ng-if="group.child_groups && group.child_groups.length" ng-class="groupsTree.isGroupExpanded(group) ? \'glyphicon-chevron-down\' : \'glyphicon-chevron-right\'" class="icon expand-icon glyphicon" ng-click="toggleGroupExpanded(group); $event.stopPropagation()"></span><span ng-if="groupsTree.getConfig(\'showChecks\')" ng-class="groupsTree.isGroupChecked(group) || groupsTree.isGroupSemiChecked(group) ? \'glyphicon-check\' : \'glyphicon-unchecked\'" class="icon check-icon check-enabled glyphicon" ng-click="toggleGroupChecked(group); $event.stopPropagation()"></span><span ng-if="!groupsTree.isGroupInAddingState(group) && !groupsTree.isGroupInEditState(group)" class="group-name">{{group.name}}</span><span ng-if="groupsTree.isGroupInAddingState(group) || groupsTree.isGroupInEditState(group)" class="group-controls"><input class="form-control" placeholder="{{\'Group name\'|translate}}" ng-model="group.name" ng-if="groupsTree.isGroupInAddingState(group)" ng-click="$event.stopPropagation()" press-key=\'{ "enter" : "acceptAddingGroup", "esc" : "cancelAddingGroup", "data" : {{group.local_id}} }\' init-focus="" keep-focus=""><input class="form-control" ng-model="group.name" ng-if="groupsTree.isGroupInEditState(group)" ng-click="$event.stopPropagation()" press-key=\'{ "enter" : "acceptUpdatingGroupName", "esc" : "cancelUpdatingGroupName", "data" : {{group.local_id}} }\' init-focus="" keep-focus=""> <button ng-if="groupsTree.isGroupInAddingState(group)" title="{{\'Add subgroup\'|translate}}" type="button" class="btn btn-default" ng-click="acceptAddingGroup(group.local_id); $event.stopPropagation()"><span class="fa fa-check" aria-hidden="true"></span></button> <button ng-if="groupsTree.isGroupInAddingState(group)" title="{{\'Cancel adding subgroup\'|translate}}" type="button" class="btn btn-default" ng-click="cancelAddingGroup(group.local_id); $event.stopPropagation()"><span class="fa fa-times" aria-hidden="true"></span></button> <button ng-if="!groupsTree.isGroupInAddingState(group)" title="{{\'Accept new name for this group\'|translate}}" type="button" class="btn btn-default" ng-click="acceptUpdatingGroupName(group.local_id); $event.stopPropagation()"><span class="fa fa-check" aria-hidden="true"></span></button> <button ng-if="!groupsTree.isGroupInAddingState(group)" title="{{\'Cancel editing group name\'|translate}}" type="button" class="btn btn-default" ng-click="cancelUpdatingGroupName(group.local_id); $event.stopPropagation()"><span class="fa fa-times" aria-hidden="true"></span></button></span></div><div class="group-right-controls"><div class="btn-group group-attributes" ng-show="groupsTree.getConfig(\'showAttributes\') && !groupsTree.isGroupInAddingState(group) && !groupsTree.isGroupInEditState(group)" title="{{getGroupNotWritableText(group)}}" style="color:black"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ng-disabled="group.id !== 0 && !group.security_.can_write"><span class="group-attributes-summary" style="{{group.id === 0 || group.security_.can_write ? \'margin-right:6px\' : \'\'}}">{{group.attributes_string || (\'Group permissions\'|translate)}}</span> <span ng-if="group.id === 0 || group.security_.can_write" class="caret"></span></button><ul class="dropdown-menu" ng-if="group.id === 0 || group.security_.can_write" style="left:auto; right:0; text-align:left"><li ng-repeat="(name, translation) in attributeNames" ng-click="toggleGroupAttribute(group, name); $event.stopPropagation()" ng-class="{ \'disabled\' : !isUserAllowedToChangeAttribute(name) }"><span class="check-icon glyphicon" ng-class="group.isAttributeEnabled(name) ? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span> {{translation}}</li></ul></div></div><ul class="list-group" ng-hide="!groupsTree.isGroupExpanded(group) || !group.child_groups.length"><li ng-repeat="group in group.child_groups | orderBy: \'name\'" class="list-group-item" ng-if="!groupsTree.isGroupExcluded(group)" ng-class="{\'group-hover\': groupsTree.isGroupHovered(group), \'group-disabled\': !groupsTree.isGroupEnabled(group), \'group-expanded\': groupsTree.isGroupExpanded(group), \'group-semi-checked\': groupsTree.isGroupSemiChecked(group), \'group-selected\': groupsTree.isGroupSelected(group), \'group-in-adding\': groupsTree.isGroupInAddingState(group), \'group-in-edit\': groupsTree.isGroupInEditState(group), \'group-added\': groupsTree.isGroupInAddedState(group)}" ng-click="current_page.key == \'GROUPS\' ? toggleGroupSelected(group) : toggleGroupExpanded(group); $event.stopPropagation()" ng-mouseover="mouseOverGroup(group); $event.stopPropagation()" ng-mouseleave="mouseLeaveGroup(group); $event.stopPropagation()" ng-include="" src="\'templates/settings/permissions/GroupsTreeItem.html\'"></li></ul>'),e.put("templates/settings/permissions/SaveUserDialog.html",'<div class="modal" id="delete-users-modal" tabindex="-1" role="dialog" data-backdrop="false" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-title="{{\'Close\'|translate}}">&times;</button><h4 class="modal-title" translate="">Delete selected users</h4></div><div class="modal-body" translate="">Selected users will be deleted.</div><div class="modal-footer"><cancel-button data-dismiss="modal"></cancel-button><delete-button data-dismiss="modal" ng-click="removeUsers(selectedUsers); deselectAllUsers()"></delete-button></div></div></div></div><div class="modal" id="save-user-modal" tabindex="-1" role="dialog" data-backdrop="false" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" ng-click="closeForm(userToSave.id)" aria-title="{{\'Close\'|translate}}">&times;</button><h4 class="modal-title"><span ng-if="userToSave.id === undefined" translate="">Add user</span> <span ng-if="userToSave.id !== undefined && !isCurrentUser(userToSave.id)" translate="">Edit user</span> <span ng-if="userToSave.id !== undefined && isCurrentUser(userToSave.id)" translate="">Edit profile</span></h4></div><div class="modal-body"><div class="form-group"><span translate="" translate-context="followed by *-symbol (also translatable)">Fields marked with this symbol are required:</span> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span></div><div class="form-group" ng-class="{\'has-success\' : isUsernameEditable(userToSave) && isUsernameFormatValid(userToSave.username) && getValidationResults().usernameUnique !== false, \'has-error\' : isUsernameEditable(userToSave) && (!isUsernameFormatValid(userToSave.username) || getValidationResults().usernameUnique === false)}"><p><span translate="">Username</span> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span></p><input class="form-control form-group" maxlength="{{getUsernameRequiredLength().max}}" ng-model="userToSave.username" ng-disabled="!isUsernameEditable(userToSave)" ng-change="getValidationResults().usernameUnique = true" init-focus=""><p ng-show="getValidationResults().usernameUnique === false" class="text-danger" translate="">Username is already being used</p><div ng-show="!isUsernameFormatValid(userToSave.username)"><p class="text-danger" style="margin-bottom:0" translate-params-min="{{getUsernameRequiredLength().min}}" translate-params-max="{{getUsernameRequiredLength().max}}" translate="">Required length: between {{min}} and {{max}}</p><p class="text-danger" translate-params-symbols="\'(. _ - @)\'" translate="">Allowed characters: alphanumeric with symbols {{symbols}}</p></div></div><div ng-if="userToSave.id === undefined" class="form-group" ng-class="{\'has-success\': isPasswordFormatValid(userToSave.password), \'has-error\': !isPasswordFormatValid(userToSave.password)}"><p><span translate="">Password</span> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span></p><input class="form-control" type="password" ng-model="userToSave.password"></div><div ng-if="userToSave.id === undefined" class="form-group" ng-class="{\'has-success\': isPasswordFormatValid(userToSave.repeat_password) && passwordsMatch(userToSave), \'has-error\': !isPasswordFormatValid(userToSave.repeat_password) || !passwordsMatch(userToSave)}"><p><span translate="">Repeat password</span> <span translate="" translate-context="Marker used for marking required fields in forms.">*</span></p><input class="form-control" type="password" ng-model="userToSave.repeat_password"></div><p ng-show="!passwordsMatch(userToSave)" ng-if="userToSave.id === undefined" class="text-danger" translate="">Passwords do not match</p><div class="form-group"><p translate="">First name</p><input class="form-control" ng-model="userToSave.first_name" ng-disabled="!isUserLocal(userToSave)"></div><div class="form-group"><p translate="">Last name</p><input class="form-control" ng-model="userToSave.last_name" ng-disabled="!isUserLocal(userToSave)"></div><div class="form-group"><p translate="">Email address</p><input class="form-control" ng-model="userToSave.email" ng-change="getValidationResults().emailFormat = true" ng-class="{\'has-error\' : getValidationResults().emailFormat === false}" ng-disabled="!isUserLocal(userToSave)"></div><p ng-show="getValidationResults().emailFormat === false" class="text-danger" translate="">Wrong email format</p><div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" ng-if="userToSave.id !== undefined && isUserLocal(userToSave)"><div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-change-password" aria-controls="collapse-change-password" translate="">Change password</a></h4></div><div id="collapse-change-password" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne"><div class="panel-body"><div class="form-group" ng-if="isCurrentPasswordNeeded(userToSave.id)"><p translate="">Current password</p><input class="form-control" type="password" ng-model="userToSave.password"></div><p ng-show="getValidationResults().currentPassword === false" class="text-danger" translate="">Invalid current password</p><div class="form-group" ng-if="userToSave.id !== undefined"><p translate="">New password</p><input class="form-control" type="password" ng-model="userToSave.new_password"></div><div class="form-group" ng-if="userToSave.id !== undefined"><p translate="">Repeat new password</p><input class="form-control" type="password" ng-model="userToSave.repeat_new_password"></div><p ng-show="!passwordsMatch(userToSave)" ng-if="userToSave.id !== undefined" class="text-danger" translate="">Passwords do not match</p></div></div></div></div></div><div class="modal-footer"><close-button data-dismiss="modal" ng-click="closeForm(userToSave.id)"></close-button><save-button ng-disabled="!isUserInfoValid(userToSave)" ng-click="saveUser(userToSave.id, userToSave.username, userToSave.password, userToSave.new_password, userToSave.first_name, userToSave.last_name, userToSave.email)"></save-button></div></div></div></div>'),e.put("templates/settings/permissions/Users.html",'<div id="settings-users-panel" class="panel panel-default" ng-controller="UserController"><div ng-include="" src="\'templates/settings/permissions/SaveUserDialog.html\'"></div><div class="panel-heading" translate="">Users</div><div class="panel-body"><div class="row" style="text-align:center"><div class="col-md-6" style="margin:5px 0;text-align:left"><div style="margin-bottom: 10px"><select multiple="" class="form-control" ng-model="selectedUsers" ng-change="updateGroupsForSelectedUsers()" ng-options="user.id as user.username for user in permissions_data.users | filter:isUserVisibleInList" options-disabled="!isUserEnabledInList(user) for user in permissions_data.users | filter:isUserVisibleInList" ng-disabled="!permissions_data.users || !permissions_data.groups" size="20" style="width:100%; max-height:400px; padding:10px"></select></div><div class="btn-toolbar"><div class="btn-group"><button title="{{\'Select all\'|translate}}" type="button" class="btn btn-default" ng-disabled="!permissions_data.users || !permissions_data.groups" ng-click="selectAllUsers()" aria-label="Select all"><span class="fa fa-check-square-o" aria-hidden="true"></span></button><button title="{{\'Deselect all\'|translate}}" type="button" class="btn btn-default" ng-disabled="!permissions_data.users || !permissions_data.groups" ng-click="deselectAllUsers()" aria-label="Deselect all"><span class="fa fa-square-o" aria-hidden="true"></span></button></div><button title="{{\'Refresh the list of users\'|translate}}" type="button" class="btn btn-default" ng-disabled="!permissions_data.users || !permissions_data.groups" ng-click="deselectAllUsers(); refreshUsersList()" aria-label="Refresh the list of users"><span class="fa fa-refresh" aria-hidden="true"></span></button></div><div class="btn-toolbar" style="position:absolute; right:15px; bottom:0"><div class="btn-group"><button title="{{\'Add user\'|translate}}" type="button" class="btn btn-default" ng-disabled="!permissions_data.users" ng-click="userToSave = {provider: \'LOCAL\'}" data-toggle="modal" data-target="#save-user-modal" aria-label="Add user"><span class="fa fa-plus" aria-hidden="true"></span></button><button title="{{\'Edit selected user\'|translate}}" type="button" class="btn btn-default" ng-disabled="selectedUsers.length != 1" ng-click="userToSave = getUserById(selectedUsers[0], permissions_data.users)" data-toggle="modal" data-target="#save-user-modal" aria-label="Edit selected user"><span class="fa fa-pencil-square-o" aria-hidden="true"></span></button><button title="{{\'Delete selected users\'|translate}}" type="button" class="btn btn-default" ng-disabled="!selectedUsers.length" data-toggle="modal" data-target="#delete-users-modal" aria-label="Delete selected users"><span class="fa fa-trash-o" aria-hidden="true"></span></button></div></div></div><div class="col-md-6" style="margin:5px 0"><div translate="">Membership</div><div ng-include="" src="\'templates/settings/permissions/GroupsTree.html\'"></div></div></div></div><div class="panel-footer"><div class="control-buttons"><discard-button ng-click="resetUserGroups()" ng-disabled="!isDataChanged() || addingInProgressCount || !permissions_data.users" title="{{\'Reset all changes\'|translate}}"></discard-button><save-button ng-click="saveUserGroups()" ng-disabled="!isDataChanged() || addingInProgressCount || !permissions_data.users" title="{{\'Save all changes\'|translate}}"></save-button></div></div></div>')}]);